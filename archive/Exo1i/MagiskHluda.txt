Project Path: arc_Exo1i_MagiskHluda_52bq51yy

Source Tree:

```txt
arc_Exo1i_MagiskHluda_52bq51yy
‚îú‚îÄ‚îÄ CMakeLists.txt
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ main.cpp
‚îú‚îÄ‚îÄ module_template
‚îÇ   ‚îú‚îÄ‚îÄ META-INF
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ google
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ android
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ update-binary
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ updater-script
‚îÇ   ‚îú‚îÄ‚îÄ customize.sh
‚îÇ   ‚îú‚îÄ‚îÄ post-fs-data.sh
‚îÇ   ‚îú‚îÄ‚îÄ service.sh
‚îÇ   ‚îî‚îÄ‚îÄ uninstall.sh
‚îú‚îÄ‚îÄ troubleshooting.md
‚îú‚îÄ‚îÄ utils.cpp
‚îú‚îÄ‚îÄ utils.h
‚îî‚îÄ‚îÄ webroot
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ package.json
    ‚îú‚îÄ‚îÄ script.js
    ‚îú‚îÄ‚îÄ styles.css
    ‚îî‚îÄ‚îÄ vite.config.js

```

`CMakeLists.txt`:

```txt
cmake_minimum_required(VERSION 3.16.3)
project(MagiskHluda)

set(CMAKE_CXX_STANDARD 20)


add_executable(MagiskHluda
        main.cpp
        utils.cpp
)

# Set the target architecture for Visual Studio (Win64)
if (MSVC)
    set_target_properties(MagiskHluda PROPERTIES
            VS_PLATFORM_TOOLSET_HOST_ARCHITECTURE x64
    )
endif ()

# Find the required packages
find_package(restclient-cpp CONFIG REQUIRED)
find_package(RapidJSON CONFIG REQUIRED)

# Link only utils.cpp to the required libraries
target_include_directories(MagiskHluda PUBLIC ${resclient-cpp_INCLUDE_DIRS} ${rapidjson_INCLUDE_DIRS})
target_link_libraries(MagiskHluda PUBLIC restclient-cpp rapidjson)

```

`README.md`:

```md
# **Florida on Boot: Seamlessly Start a More Undetectable Frida-server on Boot**

![GitHub repo size](https://img.shields.io/github/repo-size/Exo1i/MagiskHluda)
![GitHub downloads](https://img.shields.io/github/downloads/Exo1i/magiskhluda/total)

## **Overview**

This Magisk module is based on [Florida](https://github.com/Ylarod/Florida), a modified version of [Frida](https://github.com/frida/frida/) designed to be more undetectable. It ensures that Florida automatically starts on boot, providing a seamless experience for security testing and reverse engineering.

## **New Web UI for Easier Control**

A **web-based user interface** has been added, making it easier to manage the Florida server:

- **Start/Stop Server** button.
- Access to **command usage documentation**.
- Display for **server status**.
- Input for **custom parameters**.

This Web UI simplifies the management of the Florida server, allowing you to interact with it without needing a terminal.

## **System UI Crashes Warning**

Stopping the Florida server **may cause the System UI to crash**. This is a known issue and may cause temporary instability. Be cautious and save any important work before stopping the server.

## **Features & Benefits**

- **Powerful tool** for dynamic analysis, reverse engineering, and security testing.
- **Enhanced stealth**, making Florida a more undetectable version of Frida-server for Android.

## **Supported Architectures**

- arm64
- arm
- x86
- x86_64

## **Getting Started**

1. **Download the latest release:** Visit the [Releases](https://github.com/Exo1i/MagiskHluda/releases) page and download the latest ZIP file that corresponds to your device's architecture or just use the universal package.
2. **Install via Magisk/KSU/KSUN/APatch:** Use any root solution to install the module.

## **Automatic Updates**

- **Updates are checked every 12 hours**, ensuring you always have the latest version.

## **Troubleshooting**

If you encounter any issues, refer to the [Troubleshooting Guide](https://github.com/Exo1i/MagiskHluda/blob/main/troubleshooting.md).

## **Building from Source**

1. **Install dependencies:** Install `rapidjson` and `restclient-cpp` using [vcpkg](https://vcpkg.io/en/getting-started):
   ```bash
   ./vcpkg install rapidjson restclient-cpp
   ```
2. **Run the code:** Execute `main.cpp` in your preferred IDE (CLion or Visual Studio is recommended).

## **Credits**

Special thanks to:
- [StrongR-Frida by hzzheyang](https://github.com/hzzheyang/strongR-frida-android)
- [Florida](https://github.com/Ylarod/Florida)
- [magisk-frida by ViRb3](https://github.com/ViRb3/magisk-frida), particularly the enhancement request: [Issue #16](https://github.com/ViRb3/magisk-frida/issues/16)

## **Contributors**

Thanks to all contributors who have helped with this project!

<a href="https://github.com/Exo1i/MagiskHluda/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=Exo1i/MagiskHluda" />
</a>


## **Still Being Detected?**

If Florida is still being detected, consider using [ZygiskFrida](https://github.com/lico-n/ZygiskFrida) as an alternative.

## **Learning Journey**

This project is my **first semester project**, and it has been an invaluable learning experience. I have gained significant knowledge and skills along the way.


```

`main.cpp`:

```cpp
#include "utils.h"
#include <iostream>
#include "restclient-cpp/restclient.h"

std::string utils::latestTag = utils::getRecentTag();

int main() {
    try {
        RestClient::init();
        utils::createModuleProps();
        utils::createUpdateJson();
        utils::downloadServers();
        RestClient::disable();
        return 0;
    } catch (const std::exception &e) {
        std::cerr << "Error: " << e.what() << std::endl;
        RestClient::disable();
        return 1;
    }
}
```

`module_template/META-INF/com/google/android/update-binary`:

```
#!/sbin/sh

#################
# Initialization
#################

umask 022

# echo before loading util_functions
ui_print() { echo "$1"; }

require_new_magisk() {
  ui_print "*******************************"
  ui_print " Please install Magisk v20.4+! "
  ui_print "*******************************"
  exit 1
}

#########################
# Load util_functions.sh
#########################

OUTFD=$2
ZIPFILE=$3

mount /data 2>/dev/null

[ -f /data/adb/magisk/util_functions.sh ] || require_new_magisk
. /data/adb/magisk/util_functions.sh
[ $MAGISK_VER_CODE -lt 20400 ] && require_new_magisk

install_module
exit 0
```

`module_template/META-INF/com/google/android/updater-script`:

```
#MAGISK

```

`module_template/customize.sh`:

```sh
# shellcheck disable=SC2034
SKIPUNZIP=1

DEBUG=false
MIN_KSU_VERSION=10940
MIN_KSUD_VERSION=11575
MAX_KSU_VERSION=20000
MIN_APATCH_VERSION=10700
MIN_MAGISK_VERSION=20400

if [ "$ensure_bb" ]; then
    abort "! BusyBox not properly setup"
fi

# Installing from ksu
if [ "$BOOTMODE" ] && [ "$KSU" ]; then
  ui_print "- Installing from KernelSU app"
  ui_print "- KernelSU version: $KSU_KERNEL_VER_CODE (kernel) + $KSU_VER_CODE (ksud)"
  if ! [ "$KSU_KERNEL_VER_CODE" ] || [ "$KSU_KERNEL_VER_CODE" -lt "$MIN_KSU_VERSION" ]; then
    ui_print "! KernelSU version is too old!"
    abort "! Please update KernelSU to latest version!";
    elif [ "$KSU_KERNEL_VER_CODE" -ge "$MAX_KSU_VERSION" ]; then
    ui_print "! KernelSU version abnormal!"
    ui_print "! Please integrate KernelSU into your kernel"
    abort "as submodule instead of copying the source code.";
  fi
  if ! [ "$KSU_VER_CODE" ] || [ "$KSU_VER_CODE" -lt "$MIN_KSUD_VERSION" ]; then
    print_title "! ksud version is too old!" "! Please update KernelSU Manager to latest version"
    abort;
  fi

# installing from APatch
elif [ "$BOOTMODE" ] && [ "$APATCH" ]; then
  ui_print "- Installing from APatch app version $APATCH_VER_CODE"
  if ! [ "$APATCH_VER_CODE" ] || [ "$APATCH_VER_CODE" -lt "$MIN_APATCH_VERSION" ]; then
    ui_print "! APatch version is too old!"
    abort "! Please update APatch to latest version"
  fi

# Installing from magisk v20.4+
elif [ "$BOOTMODE" ] && [ "$MAGISK_VER_CODE" ]; then
  if [[ "$MAGISK_VER_CODE" -lt "$MIN_MAGISK_VERSION" ]]; then
    ui_print "*******************************"
    ui_print " Please install Magisk v20.4+! "
    ui_print "*******************************"
    abort;
  fi
  else
    print_title "- Installing from Magisk!"
fi

VERSION=$(grep_prop version "${TMPDIR}/module.prop")
print_title "- Installing Magisk Florida on boot $VERSION"

# check architecture
regex="^(arm(64)?|x(86|64))$"
if ! [[ "$ARCH" =~ $regex ]]; then
  abort "! Unsupported platform: $ARCH"
else
  ui_print "- Device platform: $ARCH"
fi

ui_print "- Extracting module files"
unzip -qq -o "$ZIPFILE" 'module.prop' -d "$MODPATH"
unzip -qq -o "$ZIPFILE" 'post-fs-data.sh' -d "$MODPATH"
unzip -qq -o "$ZIPFILE" 'service.sh' -d "$MODPATH"
unzip -qq -o "$ZIPFILE" 'uninstall.sh' -d "$MODPATH"
unzip -qq -o "$ZIPFILE" 'webroot/*' -d "$MODPATH"
mkdir -p "$MODPATH/system/bin"

if ! test -f "$MODPATH/module.cfg"; then
  {
  echo "port=27042"
  echo "parameters="
  echo "status=1"
   } >> "$MODPATH/module.cfg"
fi

# Handle architecture-specific files
case "$ARCH" in
  arm)
    BINARY_FILE="florida-arm.gz"
    ;;
  arm64)
    BINARY_FILE="florida-arm64.gz"
    ;;
  x86)
    BINARY_FILE="florida-x86.gz"
    ;;
  x86_64)
    BINARY_FILE="florida-x64.gz"
    ;;
  x64)
    BINARY_FILE="florida-x64.gz"
    ;;
  *)
    abort "! Unsupported architecture: $ARCH"
    ;;
esac

# Check if the specific arch binary exists
if ! unzip -l "$ZIPFILE" | grep -q "bin/$BINARY_FILE"; then
  ui_print "************************************"
  ui_print "! Binary not available for $ARCH arch"
  ui_print "! Please download the universal package"
  ui_print "! or the correct architecture package"
  ui_print "************************************"
  abort "Incompatible architecture package"
fi

ui_print "- Extracting Server File for $ARCH platform"
unzip -qq -o -j "$ZIPFILE" "bin/$BINARY_FILE" "$TMPDIR"

# Decompress based on file extension
if [[ "$BINARY_FILE" == *.gz ]]; then
  gzip -d "$TMPDIR/$BINARY_FILE"
  mv "$TMPDIR/florida-$ARCH" "$MODPATH/system/bin/florida"
fi

ui_print "- Setting permissions"
set_perm_recursive $MODPATH 0 0 0755 0644
set_perm $MODPATH/system/bin/florida 0 2000 0755 u:object_r:system_file:s0
```

`module_template/service.sh`:

```sh
#!/system/bin/sh

DEBUG=false
MODDIR=${0%/*}
MODULE_PROP="/data/adb/modules/magisk-hluda/module.prop"
MODULE_CFG="/data/adb/modules/magisk-hluda/module.cfg"

# Wait for boot completion
while [ "$(getprop sys.boot_completed)" != 1 ]; do
   sleep 1
done

# Additional stabilization delay
sleep 5

# Sync status from module.cfg to module.prop
if [ ! -f "$MODULE_CFG" ]; then
   sed -i 's/^description=.*/description=[Error: Config Missing ‚ö†Ô∏è]/' "$MODULE_PROP"
   exit 1
fi

# Source config and update initial status
. "$MODULE_CFG"
if [ "$status" = "1" ]; then
   sed -i 's/^description=.*/description=[Running‚úÖ]/' "$MODULE_PROP"
else
   sed -i 's/^description=.*/description=[Stopped‚ùå]/' "$MODULE_PROP"
fi

# Read configuration from module.cfg
if [ -f "$MODULE_CFG" ]; then
   # Source the config file to get variables
   . "$MODULE_CFG"

   # Check if service should start (status=1)
   if [ "$status" = "1" ]; then
       # Start service if not running
       if ! pgrep -x "florida" > /dev/null; then
           # Build command with port and parameters
           CMD="florida -D -l 0.0.0.0:$port"

           # Add additional parameters if specified
           if [ -n "$parameters" ]; then
               CMD="$CMD $parameters"
           fi

           # Execute the command and check result
           if ! $CMD; then
               sed -i 's/^description=.*/description=[Start Failed ‚ö†Ô∏è]/' "$MODULE_PROP"
           fi
       fi
   else
       # Update module.prop to show stopped status
       sed -i 's/^description=.*/description=[Stopped‚ùå]/' "$MODULE_PROP"
   fi
else
   # Log error if config file is missing
   echo "Error: module.cfg not found";
fi
```

`module_template/uninstall.sh`:

```sh
rm -rf /data/adb/magisk-hluda

```

`troubleshooting.md`:

```md
# Troubleshooting

## Try first
- Ensure `adb devices` shows your device
- Ensure `adb shell` opens a working shell on your device
- Try running `florida` [through an ADB shell](https://www.frida.re/docs/android/)
- Ensure Magisk is at a STABLE version and up-to-date
- Ensure MagiskHide is disabled
- Ensure you are on an AOSP-based ROM

## Not solved?
IDK I'm just a student :| , search for "frida-server + your error" or try opening an issue with some info about your device and any logs would be helpful, and I'll help if I can üòÉ.
```

`utils.cpp`:

```cpp
#include <fstream>
#include <filesystem>
#include <iostream>
#include <stdexcept>
#include <vector>
#include <chrono>
#include <algorithm>
#include "restclient-cpp/connection.h"
#include "restclient-cpp/restclient.h"
#include "rapidjson/document.h"
#include "utils.h"

namespace fs = std::filesystem;
const std::string basePath = "./module_template/";

std::string utils::getRecentTag()
{
    const std::string url = "https://api.github.com/repos/hzzheyang/strongR-frida-android/releases/latest";
    RestClient::Response response = RestClient::get(url);

    if (response.code != 200)
    {
        throw std::runtime_error("HTTP Error: " + std::to_string(response.code) + " " + response.body);
    }

    rapidjson::Document d;
    d.Parse(response.body.c_str());

    if (!d.HasMember("tag_name") || !d["tag_name"].IsString())
    {
        throw std::runtime_error("Invalid JSON response: missing or invalid 'tag_name'");
    }

    std::string tag = d["tag_name"].GetString();
    std::ofstream("currentTag.txt") << tag;
    return tag;
}

void download(const std::string& aarch)
{
    auto start = std::chrono::system_clock::now();

    std::cout << "Starting To Downloaded florida for arch: " + aarch + "\n";

    std::string url = "https://github.com/ylarod/florida/releases/download/" + utils::latestTag +
        "/florida-server-" + utils::latestTag + "-android-" + aarch + ".gz";

    std::unique_ptr<RestClient::Connection> pConnection(new RestClient::Connection(url));
    pConnection->FollowRedirects(true);
    RestClient::Response response = pConnection->get("/");

    if (response.code != 200)
    {
        throw std::runtime_error("Download failed: " + std::to_string(response.code) + " " + response.body);
    }
    std::string filename;
    if (aarch == "x86_64")
        filename = "bin/florida-x64.gz";
    else
        filename = "bin/florida-" + aarch + ".gz";

    std::ofstream downloadedFile(filename, std::ios::out | std::ios::binary);

    if (!downloadedFile)
    {
        throw std::runtime_error("Failed to open file for writing: " + filename);
    }

    downloadedFile.write(response.body.c_str(), response.body.length());

    auto end = std::chrono::system_clock::now();

    std::chrono::duration<double> elapsed_seconds = end - start;
    std::time_t end_time = std::chrono::system_clock::to_time_t(end);
    std::cout
        << "Successfully Downloaded florida for arch: " + aarch + ". Took " + to_string(elapsed_seconds.count()) +
        "s\n";
}

void utils::downloadServers()
{
    fs::create_directories("./bin");
    const std::vector<std::string> archs = {"arm", "arm64", "x86", "x86_64"};

    for (const auto& aarch : archs)
    {
        try
        {
            download(aarch);
        }
        catch (const std::exception& e)
        {
            std::cerr << "Error downloading " << aarch << ": " << e.what() << std::endl;
            throw std::runtime_error("Error downloading " + aarch + ": " + e.what());
        }
    }
}

void utils::createModuleProps()
{
    std::ofstream moduleProps(basePath + "module.prop");

    if (!moduleProps)
    {
        throw std::runtime_error("Failed to open module.prop for writing");
    }

    string versionCode = latestTag;
    versionCode.erase(std::remove(versionCode.begin(), versionCode.end(), '.'), versionCode.end());
    moduleProps << "id=magisk-hluda\n"
        << "name=Frida(Florida) Server on Boot\n"
        << "version=" << latestTag.substr(0, latestTag.find('-')) << '\n'
        << "versionCode=" << versionCode << '\n'
        << "author=The Community - Ylarod - Exo1i\n"
        << "description=Runs a stealthier frida-server on boot\n"
        << "updateJson=https://github.com/exo1i/magiskhluda/releases/latest/download/update.json";
}

void utils::createUpdateJson()
{
    string versionCode = latestTag;
    versionCode.erase(std::remove(versionCode.begin(), versionCode.end(), '.'), versionCode.end());

    std::ofstream updateJson("update.json");
    if (!updateJson)
    {
        throw std::runtime_error("Failed to open update.json for writing");
    }

    updateJson << "{\n"
        << R"(  "version": ")" << latestTag << "\",\n"
        << "  \"versionCode\": " << versionCode << ",\n"
        << R"(  "zipUrl": "https://github.com/exo1i/magiskhluda/releases/download/)"
        << latestTag << "/Magisk-Florida-Universal-" << latestTag << ".zip\",\n"
        << R"(  "changelog": "https://gist.githubusercontent.com/Exo1i/22b6b1aa3a78d421f30410bc1bf24212/raw/0ad35b77c347748a311a004b9e5a558bf97bf357/gistfile1.txt")"
        << "\n}\n";
}

```

`utils.h`:

```h
//
// Created by youss on 1/25/2024.
//
#include <iostream>

#ifndef MAGISKHLUDA_UTILS_H
#define MAGISKHLUDA_UTILS_H

using namespace std;

class utils {
public:
    static string latestTag;



    static void createModuleProps();

    static string getRecentTag();


    static void downloadServers();

    static void createUpdateJson();
};

#endif //MAGISKHLUDA_UTILS_H

```

`webroot/index.html`:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florida Server Control</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <h1>Florida Server Control</h1>

    <div class="card">
        <div class="form-group status-group">
            <label>Server Status:</label>
            <span id="serverStatus" class="status-indicator status-stopped"></span>
            <span id="serverStatusText">Stopped</span>
        </div>

        <div class="form-group">
            <label for="portInput">Port</label>
            <input type="number" id="portInput" value="27042" placeholder="Default: 27042" class="input">
        </div>

        <div class="form-group">
            <label for="customParams">Additional Parameters</label>
            <input type="text" id="customParams" placeholder="e.g., --token=secret123" class="input">
        </div>

        <div class="button-group">
            <button id="saveSettingsBtn" class="btn btn-success">Save Settings</button>
            <button id="toggleServerBtn" class="btn btn-primary">Start Server</button>
        </div>
    </div>

    <div class="card docs-card">
        <h2>Command Usage</h2>
        <pre class="command-help">
Usage:
  florida [OPTION?]

Help Options:
  -h, --help                            Show help options

Application Options:
  --version                             Output version information and exit
  -l, --listen=ADDRESS                  Listen on ADDRESS
  --certificate=CERTIFICATE             Enable TLS using CERTIFICATE
  --origin=ORIGIN                       Only accept requests with Origin header matching ORIGIN
  --token=TOKEN                         Require authentication using TOKEN
  --asset-root=ROOT                     Serve static files inside ROOT
  -d, --directory=DIRECTORY             Store binaries in DIRECTORY
  -D, --daemonize                       Detach and become a daemon
  --policy-softener=system|internal     Select policy softener
  -P, --disable-preload                 Disable preload optimization
  -C, --ignore-crashes                  Disable native crash reporter integration
  -v, --verbose                         Be verbose</pre>
    </div>
</div>

<!-- Warning Modal -->
<div id="warningDialog" class="modal">
    <div class="modal-content">
        <h2>‚ö†Ô∏è Warning</h2>
        <p>Stopping Frida server may cause System UI to restart.<br>Feel free to open a PR if you can fix this.</p>
        <div class="modal-buttons">
            <button class="btn btn-secondary" id="cancelStop">Cancel</button>
            <button class="btn btn-danger" id="confirmStop">Proceed</button>
        </div>
    </div>
</div>

<script type="module" src="script.js"></script>
</body>
</html>
```

`webroot/package.json`:

```json
{
  "name": "florida-web",
  "version": "1.0.0",
  "description": "Web interface for Florida",
  "browserslist": [
    "> 0.5%",
    "last 2 versions",
    "not dead"
  ],
  "dependencies": {
    "kernelsu": "^1.0.6",
    "terser": "^5.39.0",
    "vite": "^6.2.4"
  }
}

```

`webroot/script.js`:

```js
import {exec, toast} from 'kernelsu';

const statusIndicator = document.getElementById('serverStatus');
const statusText = document.getElementById('serverStatusText');
const toggleBtn = document.getElementById('toggleServerBtn');
const saveSettingsBtn = document.getElementById('saveSettingsBtn');
const portInput = document.getElementById('portInput');
const customParamsInput = document.getElementById('customParams');
const warningDialog = document.getElementById('warningDialog');
const cancelStop = document.getElementById('cancelStop');
const confirmStop = document.getElementById('confirmStop');

let isServerRunning = false;

const MODULE_PROP_PATH = '/data/adb/modules/magisk-hluda/module.prop';
const MODULE_SETTINGS_FILE = '/data/adb/modules/magisk-hluda/module.cfg';

async function initializeConfigFile() {
    try {
        const status = isServerRunning ? 1 : 0;
        const configContent = `port=${portInput.value}\nparameters=${customParamsInput.value}\nstatus=${status}`;
        await exec(`echo '${configContent}' > ${MODULE_SETTINGS_FILE}`);
        console.log('Created module.cfg with default values');
    } catch (error) {
        console.error('Error creating module.cfg:', error);
        toast('Failed to initialize config file');
    }
}

async function saveSettings() {
    try {
        // Validate port number
        const portNum = parseInt(portInput.value);
        if (isNaN(portNum) || portNum < 1 || portNum > 65535) {
            toast('Invalid port number. Using default port 27042');
            portInput.value = '27042';
        }

        // Check if config file exists
        const {errno} = await exec(`test -f ${MODULE_SETTINGS_FILE}`);

        if (errno !== 0) {
            await initializeConfigFile();
            return;
        }

        // Save port setting
        await exec(`sed -i "s/^port=.*/port=${portInput.value}/" ${MODULE_SETTINGS_FILE}`);

        // Save parameters setting (escape special characters)
        const escapedParams = customParamsInput.value
            .replace(/\//g, '\\/')
            .replace(/'/g, "\\'")
            .replace(/"/g, '\\"');
        await exec(`sed -i "s/^parameters=.*/parameters=${escapedParams}/" ${MODULE_SETTINGS_FILE}`);

        // Update status
        const currentStatus = isServerRunning ? 1 : 0;
        await exec(`sed -i "s/^status=.*/status=${currentStatus}/" ${MODULE_SETTINGS_FILE}`);

        toast('Settings saved successfully');
    } catch (error) {
        console.error('Failed to save settings:', error);
        toast(`Failed to save settings: ${error.message}`);
    }
}

async function loadSettings() {
    try {
        // Check if config file exists
        const {errno} = await exec(`test -f ${MODULE_SETTINGS_FILE}`);

        if (errno !== 0) {
            await initializeConfigFile();
            return;
        }

        // Read current settings
        const {stdout: portValue} = await exec(`grep "^port=" ${MODULE_SETTINGS_FILE} | cut -d= -f2`);
        const {stdout: paramsValue} = await exec(`grep "^parameters=" ${MODULE_SETTINGS_FILE} | cut -d= -f2-`);

        // Update input fields
        portInput.value = portValue.trim() || '27042';
        customParamsInput.value = paramsValue.trim() || '';

    } catch (error) {
        console.error('Failed to load settings:', error);
        toast(`Failed to load settings: ${error.message}`);
    }
}

async function updateModulePropStatus(running) {
    const status = running ? 'Running ‚úÖ' : 'Stopped ‚ùå';
    try {
        await exec(`sed -i "s/^description=.*/description=[${status}]/" ${MODULE_PROP_PATH}`);
    } catch (error) {
        console.error('Failed to update module.prop:', error);
    }
}

function updateStatus(running) {
    if (isServerRunning === running) return;
    isServerRunning = running;

    statusIndicator.classList.toggle('status-running', running);
    statusIndicator.classList.toggle('status-stopped', !running);
    statusText.textContent = running ? 'Running' : 'Stopped';
    toggleBtn.textContent = running ? 'Stop Server' : 'Start Server';
    toggleBtn.classList.toggle('btn-danger', running);
    toggleBtn.classList.toggle('btn-primary', !running);

    updateModulePropStatus(running);
}

async function checkServerStatus() {
    try {
        const {errno} = await exec('pgrep -f florida');
        updateStatus(errno === 0);
    } catch (error) {
        console.error('Error checking server status:', error);
        updateStatus(false);
    }
}

async function startServer(port, customParams) {
    const baseCommand = `florida -D -l 0.0.0.0:${port}`;
    const fullCommand = customParams ? `${baseCommand} ${customParams}` : baseCommand;

    try {
        const {errno, stderr} = await exec(fullCommand);

        if (errno !== 0 || stderr.trim()) {
            // Either command failed or there was error output
            const errorMsg = stderr.trim() || 'Unknown error occurred';
            toast(`Failed to start server: ${errorMsg}`);
            updateStatus(false);
            return;
        }

        // If we got here, command succeeded
        setTimeout(checkServerStatus, 500);
        toast('Server started successfully');
    } catch (error) {
        toast(`Failed to start server: ${error.message}`);
        updateStatus(false);
    }
}

async function stopServer() {
    try {
        // frida doesn't respond to sigterm properly, so sending sigkill
        const {errno} = await exec('pkill -SIGKILL -f florida');
        if (errno === 0) {
            updateStatus(false);
            toast('Server stopped successfully');
        } else {
            throw new Error('Server not running');
        }
    } catch (error) {
        toast(`Failed to stop server: ${error.message}`);
    }
}

// Event Listeners
saveSettingsBtn.addEventListener('click', saveSettings);

toggleBtn.addEventListener('click', async () => {
    const port = portInput.value || '27042';
    const customParams = customParamsInput.value;

    if (!isServerRunning) {
        await saveSettings();
        await startServer(port, customParams);
    } else {
        warningDialog.style.display = 'flex';
    }
});

cancelStop.addEventListener('click', () => {
    warningDialog.style.display = 'none';
});

confirmStop.addEventListener('click', async () => {
    warningDialog.style.display = 'none';
    await saveSettings();
    await stopServer();
});

// Initialize
loadSettings().then(() => {
    checkServerStatus();
    setInterval(checkServerStatus, 500);
});
```

`webroot/styles.css`:

```css
:root {
    --primary-color: #007bff;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --secondary-color: #6c757d;
    --background-color: #1e1e2e;
    --card-background: #2a2a3a;
    --text-color: #d4d4d4;
    --border-radius: 8px;
    --input-background: #363646;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    padding: 16px;
}

.container {
    max-width: 600px;
    margin: 0 auto;
}

h1 {
    text-align: center;
    margin: 20px 0;
    font-size: 24px;
}

h2 {
    font-size: 20px;
    margin-bottom: 16px;
}

.card {
    background: var(--card-background);
    border-radius: var(--border-radius);
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.status-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-running {
    background-color: var(--success-color);
    box-shadow: 0 0 8px var(--success-color);
}

.status-stopped {
    background-color: var(--danger-color);
    box-shadow: 0 0 8px var(--danger-color);
}

.input {
    width: 100%;
    padding: 10px;
    border: 1px solid #444;
    border-radius: var(--border-radius);
    background: var(--input-background);
    color: var(--text-color);
    font-size: 16px;
}

.input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.2s ease;
    flex: 1;
    min-width: 120px;
    color: white;
}

.btn-primary {
    background: var(--primary-color);
}

.btn-success {
    background: var(--success-color);
}

.btn-danger {
    background: var(--danger-color);
}

.btn-secondary {
    background: var(--secondary-color);
}

.btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

.btn:active {
    transform: translateY(0);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: var(--card-background);
    padding: 24px;
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 400px;
    text-align: center;
}

.modal-content h2 {
    margin-bottom: 16px;
}

.modal-content p {
    margin-bottom: 24px;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.command-help {
    background: var(--input-background);
    padding: 16px;
    border-radius: var(--border-radius);
    overflow-x: auto;
    font-size: 14px;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/* Mobile Enhancements */
@media (max-width: 480px) {
    body {
        padding: 12px;
    }

    .card {
        padding: 16px;
    }

    .button-group {
        flex-direction: column;
    }

    .btn {
        width: 100%;
    }

    .modal-content {
        width: 95%;
        padding: 16px;
    }
}
```

`webroot/vite.config.js`:

```js
import {defineConfig} from 'vite';

export default defineConfig({
    build: {
        outDir: '../module_template/webroot', minify: 'terser', sourcemap: false,
    }, base: './'
});

```