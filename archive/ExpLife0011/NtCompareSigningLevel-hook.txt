Project Path: arc_ExpLife0011_NtCompareSigningLevel-hook__gexvlos

Source Tree:

```txt
arc_ExpLife0011_NtCompareSigningLevel-hook__gexvlos
├── NtCompareSigningLevels-hook.sln
├── README.md
├── Usermode
│   ├── Usermode.vcxproj
│   ├── Usermode.vcxproj.filters
│   ├── Usermode.vcxproj.user
│   ├── commands.h
│   ├── globals.h
│   ├── main.cpp
│   ├── utils.h
│   └── x64
│       └── Release
│           ├── Usermode.Build.CppClean.log
│           ├── Usermode.log
│           ├── Usermode.tlog
│           │   ├── CL.command.1.tlog
│           │   ├── CL.read.1.tlog
│           │   ├── CL.write.1.tlog
│           │   ├── Usermode.lastbuildstate
│           │   ├── Usermode.write.1u.tlog
│           │   ├── link.command.1.tlog
│           │   ├── link.read.1.tlog
│           │   └── link.write.1.tlog
│           ├── Usermode.vcxproj.FileListAbsolute.txt
│           ├── main.obj
│           └── vc142.pdb
└── kernel
    ├── Drver.cpp
    ├── KdmapperTraces.h
    ├── kernel.inf
    ├── kernel.vcxproj
    ├── kernel.vcxproj.filters
    ├── kernel.vcxproj.user
    ├── undocumented.h
    ├── utils.h
    └── x64
        └── Release
            ├── Drver.obj
            ├── kernel.Build.CppClean.log
            ├── kernel.inf
            ├── kernel.log
            ├── kernel.tlog
            │   ├── CL.command.1.tlog
            │   ├── CL.read.1.tlog
            │   ├── CL.write.1.tlog
            │   ├── Inf2Cat.command.1.tlog
            │   ├── inf2cat-expand.3940.read.1.tlog
            │   ├── inf2cat-expand.3940.write.1.tlog
            │   ├── inf2cat-expand.read.1.tlog
            │   ├── inf2cat-expand.write.1.tlog
            │   ├── inf2cat.read.1.tlog
            │   ├── inf2cat.write.1.tlog
            │   ├── kernel.lastbuildstate
            │   ├── link.command.1.tlog
            │   ├── link.read.1.tlog
            │   ├── link.write.1.tlog
            │   ├── stampinf.command.1.tlog
            │   ├── stampinf.read.1.tlog
            │   └── stampinf.write.1.tlog
            └── vc142.pdb

```

`NtCompareSigningLevels-hook.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.30128.74
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "kernel", "kernel\kernel.vcxproj", "{35935BD3-F3F0-4EE6-8714-F79DC637BB57}"
EndProject
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "Usermode", "Usermode\Usermode.vcxproj", "{69E2667A-0121-4564-B689-4377844B8D56}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|ARM = Debug|ARM
		Debug|ARM64 = Debug|ARM64
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|ARM = Release|ARM
		Release|ARM64 = Release|ARM64
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|ARM.ActiveCfg = Debug|ARM
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|ARM.Build.0 = Debug|ARM
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|ARM.Deploy.0 = Debug|ARM
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|ARM64.ActiveCfg = Debug|ARM64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|ARM64.Build.0 = Debug|ARM64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|ARM64.Deploy.0 = Debug|ARM64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|x64.ActiveCfg = Debug|x64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|x64.Build.0 = Debug|x64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|x64.Deploy.0 = Debug|x64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|x86.ActiveCfg = Debug|Win32
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|x86.Build.0 = Debug|Win32
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Debug|x86.Deploy.0 = Debug|Win32
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|ARM.ActiveCfg = Release|ARM
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|ARM.Build.0 = Release|ARM
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|ARM.Deploy.0 = Release|ARM
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|ARM64.ActiveCfg = Release|ARM64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|ARM64.Build.0 = Release|ARM64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|ARM64.Deploy.0 = Release|ARM64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|x64.ActiveCfg = Release|x64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|x64.Build.0 = Release|x64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|x64.Deploy.0 = Release|x64
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|x86.ActiveCfg = Release|Win32
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|x86.Build.0 = Release|Win32
		{35935BD3-F3F0-4EE6-8714-F79DC637BB57}.Release|x86.Deploy.0 = Release|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Debug|ARM.ActiveCfg = Debug|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Debug|ARM64.ActiveCfg = Debug|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Debug|x64.ActiveCfg = Debug|x64
		{69E2667A-0121-4564-B689-4377844B8D56}.Debug|x64.Build.0 = Debug|x64
		{69E2667A-0121-4564-B689-4377844B8D56}.Debug|x86.ActiveCfg = Debug|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Debug|x86.Build.0 = Debug|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Release|ARM.ActiveCfg = Release|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Release|ARM64.ActiveCfg = Release|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Release|x64.ActiveCfg = Release|x64
		{69E2667A-0121-4564-B689-4377844B8D56}.Release|x64.Build.0 = Release|x64
		{69E2667A-0121-4564-B689-4377844B8D56}.Release|x86.ActiveCfg = Release|Win32
		{69E2667A-0121-4564-B689-4377844B8D56}.Release|x86.Build.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {EA61D945-7628-4713-B342-E3069D4077AA}
	EndGlobalSection
EndGlobal

```

`README.md`:

```md
# NtCompareSigningLevel-hook
swap the function pointer in NtCompareSigningLevels for undetected driver communication.

## （ABANDONED BECAUSE OF PATCHGUARD)

```

`Usermode/Usermode.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>16.0</VCProjectVersion>
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{69e2667a-0121-4564-b689-4377844b8d56}</ProjectGuid>
    <RootNamespace>Usermode</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <LinkIncremental>true</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <LinkIncremental>true</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_CRT_SECURE_NO_WARNINGS;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClCompile Include="main.cpp" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="commands.h" />
    <ClInclude Include="globals.h" />
    <ClInclude Include="utils.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`Usermode/Usermode.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;c++;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hh;hpp;hxx;h++;hm;inl;inc;ipp;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="commands.h">
      <Filter>Source Files</Filter>
    </ClInclude>
    <ClInclude Include="globals.h">
      <Filter>Source Files</Filter>
    </ClInclude>
    <ClInclude Include="utils.h">
      <Filter>Source Files</Filter>
    </ClInclude>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="main.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`Usermode/Usermode.vcxproj.user`:

```user
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup />
</Project>
```

`Usermode/commands.h`:

```h
#pragma once
#include	"utils.h"


enum	DRIVER_COMMAND : BYTE
{
	START_CONNECTION = 144,
	GET_BASE = 145,
	RESOLVE_RELATIVE_ADDR = 146,
	READ_MEMORY = 147,
	WRITE_MEMORY = 148,
	FIND_OUTBUFFER = 149,
	SIG_SCAN = 150,
	CLEAR_TRACES = 151,
	TEST = 152,
};


struct SigScanInput
{
	char	section[10];
	UCHAR	pattern[20];
	PVOID	moduleBase;
};


namespace Driver
{

	/*	get address of Output buffer (for read operations)		*/
	void	findOutBuffer()
	{
		BYTE		arg1[8];
		DWORD64		dArg1;

		arg1[0] = FIND_OUTBUFFER;

		memcpy(&dArg1, arg1, 8);

		NtCompareSigningLevels(dArg1, (DWORD64)globals::OutBuffer.buf);

		return;
	}


	DWORD64	getModuleBase(const wchar_t* moduleName, int procId)
	{
		wcscpy((wchar_t*)globals::InBuffer.buf, moduleName);

		NtCompareSigningLevels(GET_BASE, procId);


	
		return *(DWORD64*)globals::OutBuffer.buf;
	
	}

	template <typename T>
	T	Read(int	procId, int length, DWORD64 address)
	{
		BYTE	buffer1[8];


		buffer1[0] = READ_MEMORY;							/*	byte 1 for command ID	*/
		memcpy((PVOID)(buffer1 + 1), &procId, 4);			/*	byte 2-6 for process ID		*/
		memcpy((PVOID)(buffer1 + 5), &length, 3);			/*	byte 5-8 for length		*/
		

		DWORD64	arg1;

		memcpy(&arg1, buffer1, 8);

		NtCompareSigningLevels(arg1, address);
		
		return *(T*)globals::OutBuffer.buf;
	}

	template <typename T>
	T	Write(int	procId, int length, DWORD64 address, T* buffer)
	{
		BYTE	buffer1[8];


		buffer1[0] = WRITE_MEMORY;							/*	byte 1 for command ID	*/
		memcpy((PVOID)(buffer1 + 1), &procId, 4);			/*	byte 2-6 for process ID		*/
		memcpy((PVOID)(buffer1 + 5), &length, 3);			/*	byte 5-8 for length		*/


		DWORD64	arg1;

		memcpy(&arg1, buffer1, 8);
		memcpy(globals::InBuffer.buf, buffer, length);


		NtCompareSigningLevels(arg1, address);

		return *(T*)globals::OutBuffer.buf;
	}


	/*	starts connection with the  input buffer in usermode	*/

	int	startConnection()
	{
		BYTE		arg1[8];

		arg1[0] = START_CONNECTION;

		int currentPID = GetCurrentProcessId();

		memcpy((arg1 + 1), &currentPID, 4);


		DWORD64		dwordArg;
		memcpy(&dwordArg, arg1, 8);

		NtCompareSigningLevels(dwordArg, (DWORD64)globals::InBuffer.buf);

		Driver::findOutBuffer();

		return 0;
	}


	PVOID64	sigScan(const char* section, UCHAR* pattern, UCHAR wildcard, int length, PVOID moduleBase, int processId)
	{
		BYTE	arg1[8];

		arg1[0] = SIG_SCAN;
		arg1[1] = wildcard;

		memcpy((arg1 + 2), &length, 4);

		DWORD64	 dArg1;

		memcpy(&dArg1, arg1, 8);


		SigScanInput  input;


		strcpy(input.section, section);
		memcpy(input.pattern, pattern, length);
		input.moduleBase = moduleBase;


		memcpy(globals::InBuffer.buf, &input, sizeof(SigScanInput));

		NtCompareSigningLevels(dArg1, processId);

		return *(PVOID64*)(globals::OutBuffer.buf);
	}


	//ResolveRelativeAddress(_In_ PVOID Instruction, _In_ ULONG OffsetOffset, _In_ ULONG InstructionSize)
	PVOID		resolveRelativeAddress(PVOID instruction, int OffsetOffset, int InstructionSize)
	{
		BYTE	arg1[8];

		arg1[0] = RESOLVE_RELATIVE_ADDR;

		memcpy((arg1 + 1), &OffsetOffset, 3);
		memcpy((arg1 + 4), &InstructionSize, 4);


		DWORD64		dArg1;

		memcpy(&dArg1, arg1, 8);

		NtCompareSigningLevels(dArg1, (DWORD64)instruction);

		return *(PVOID*)(globals::OutBuffer.buf);
	}

	void	clearTraces()
	{
		NtCompareSigningLevels(CLEAR_TRACES, 0);
	}


	DWORD64	test()
	{
		cout << NtCompareSigningLevels(TEST, 0) << endl;

		return 0;
	}
}
```

`Usermode/globals.h`:

```h
#pragma once
#include	<iostream>
#include	<Windows.h>
#include	<TlHelp32.h>
#include	<string>


using namespace std;


typedef     DWORD64(NTAPI* pFnNtCompareSigningLevels)(DWORD64 a, DWORD64 b);
pFnNtCompareSigningLevels   NtCompareSigningLevels = 0;



/*	in case there needs to be more input than 16 bytes		*/

struct BYTE_BUFFER
{
	BYTE	data[50];
};

struct  Buffer
{
	BYTE_BUFFER*	buf;
};



namespace	globals
{
	Buffer	InBuffer;
	Buffer	OutBuffer;
}


namespace	offset
{
	DWORD	localplayer = 0x10f4f4;
	DWORD	health = 0xF8;
}
```

`Usermode/main.cpp`:

```cpp
#include    "commands.h"




int main()
{
    HMODULE  hModule = LoadLibrary(L"ntdll.dll");

    NtCompareSigningLevels = (pFnNtCompareSigningLevels)GetProcAddress(hModule, "NtCompareSigningLevels");


    globals::InBuffer.buf = new BYTE_BUFFER;
    globals::OutBuffer.buf = new BYTE_BUFFER;



    Driver::startConnection();
    Driver::clearTraces();


    int        processID = utils::FindProcessId(L"ac_client.exe");
    DWORD64    baseAddress = Driver::getModuleBase(L"ac_client.exe", processID);


    cout << "base address is: " << std::hex << baseAddress << endl;


    DWORD64    localPlayer = Driver::Read<int>(processID, 4, (baseAddress + offset::localplayer));
    DWORD64    health = Driver::Read<int>(processID, 4, (localPlayer + offset::health));


    cout << "current health is: " << std::dec << health << endl;



    int newHealth = 19991;
    Driver::Write<int>(processID, 4, (localPlayer + offset::health), &newHealth);


    Driver::test();

    cin.get();

    return 0;
}
```

`Usermode/utils.h`:

```h
#pragma once
#include "globals.h"


/*	general usermode utilities	*/

namespace  utils
{
	DWORD FindProcessId(const std::wstring& processName)
	{
		PROCESSENTRY32 processInfo;
		processInfo.dwSize = sizeof(processInfo);

		HANDLE processesSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL);
		if (processesSnapshot == INVALID_HANDLE_VALUE)
			return 0;

		Process32First(processesSnapshot, &processInfo);
		if (!processName.compare(processInfo.szExeFile))
		{
			CloseHandle(processesSnapshot);
			return processInfo.th32ProcessID;
		}

		while (Process32Next(processesSnapshot, &processInfo))
		{
			if (!processName.compare(processInfo.szExeFile))
			{
				CloseHandle(processesSnapshot);
				return processInfo.th32ProcessID;
			}
		}

		CloseHandle(processesSnapshot);
		return 0;
	}
}

```

`Usermode/x64/Release/Usermode.Build.CppClean.log`:

```log
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\vc142.pdb
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\main.obj
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\usermode.exe
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\usermode.pdb
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\usermode.ipdb
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\usermode.iobj
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\cl.command.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\cl.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\cl.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\link.command.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\link.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\link.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\usermode\x64\release\usermode.tlog\usermode.write.1u.tlog

```

`Usermode/x64/Release/Usermode.log`:

```log
  main.cpp
  Generating code
  Previous IPDB not found, fall back to full compilation.
  All 93 functions were compiled because no usable IPDB/IOBJ from previous compilation was found.
  Finished generating code
  Usermode.vcxproj -> C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\x64\Release\Usermode.exe

```

`Usermode/x64/Release/Usermode.tlog/CL.command.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\MAIN.CPP
/c /Zi /nologo /W3 /WX- /diagnostics:column /sdl /O2 /Oi /GL /D _CRT_SECURE_NO_WARNINGS /D NDEBUG /D _CONSOLE /D _UNICODE /D UNICODE /Gm- /EHsc /MD /GS /Gy /fp:precise /permissive- /Zc:wchar_t /Zc:forScope /Zc:inline /Fo"X64\RELEASE\\" /Fd"X64\RELEASE\VC142.PDB" /Gd /TP /FC C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\MAIN.CPP

```

`Usermode/x64/Release/Usermode.tlog/CL.read.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\MAIN.CPP
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\BIN\HOSTX86\X64\1033\CLUI.DLL
C:\WINDOWS\SYSTEM32\TZRES.DLL
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\COMMANDS.H
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\UTILS.H
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\GLOBALS.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\IOSTREAM
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\YVALS_CORE.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VCRUNTIME.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\SAL.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CONCURRENCYSAL.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VADEFS.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XKEYCHECK.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\ISTREAM
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\OSTREAM
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\IOS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XLOCNUM
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CLIMITS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\LIMITS.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CMATH
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\YVALS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CRTDBG.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VCRUNTIME_NEW_DEBUG.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VCRUNTIME_NEW.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CRTDEFS.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\USE_ANSI.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CSTDLIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\MATH.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_MATH.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\STDLIB.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_MALLOC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_SEARCH.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\STDDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WSTDLIB.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XTR1COMMON
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CSTDIO
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\STDIO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WSTDIO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_STDIO_CONFIG.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\ITERATOR
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\IOSFWD
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CSTRING
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\STRING.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_MEMORY.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_MEMCPY_S.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\ERRNO.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VCRUNTIME_STRING.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WSTRING.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CWCHAR
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\WCHAR.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WCONIO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WCTYPE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WDIRECT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WIO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_SHARE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WPROCESS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_WTIME.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\SYS\STAT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\SYS\TYPES.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XSTDDEF
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CSTDDEF
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\INITIALIZER_LIST
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XUTILITY
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\UTILITY
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\TYPE_TRAITS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\STREAMBUF
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XIOSBASE
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\SHARE.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\SYSTEM_ERROR
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\__MSVC_SYSTEM_ERROR_ABI.HPP
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CERRNO
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\STDEXCEPT
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\EXCEPTION
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\MALLOC.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VCRUNTIME_EXCEPTION.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\EH.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CORECRT_TERMINATE.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XSTRING
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XMEMORY
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CSTDINT
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\STDINT.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\LIMITS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CFLOAT
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\FLOAT.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\NEW
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XATOMIC.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\INTRIN0.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XCALL_ONCE.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XERRC.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XLOCALE
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\MEMORY
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\TYPEINFO
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\VCRUNTIME_TYPEINFO.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XFACET
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XLOCINFO
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\XLOCINFO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\CTYPE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UCRT\LOCALE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINDOWS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINAPIFAMILY.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINPACKAGEFAMILY.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SDKDDKVER.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\EXCPT.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\STDARG.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\MINWINDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SPECSTRINGS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SPECSTRINGS_STRICT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SPECSTRINGS_UNDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\DRIVERSPECS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SDV_DRIVERSPECS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINNT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\KERNELSPECS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\BASETSD.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\GUIDDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\PSHPACK4.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\POPPACK.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\PSHPACK2.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\PSHPACK8.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\PSHPACK1.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\APISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\KTMTYPES.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\APISETCCONV.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MINWINBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\APIQUERY2.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PROCESSENV.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\FILEAPIFROMAPP.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\FILEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\DEBUGAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\UTILAPISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\HANDLEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\ERRHANDLINGAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\FIBERSAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\NAMEDPIPEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PROFILEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\HEAPAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\IOAPISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SYNCHAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\INTERLOCKEDAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PROCESSTHREADSAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SYSINFOAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MEMORYAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\ENCLAVEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\THREADPOOLLEGACYAPISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\THREADPOOLAPISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\JOBAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\JOBAPI2.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WOW64APISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\LIBLOADERAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SECURITYBASEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\NAMESPACEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SYSTEMTOPOLOGYAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PROCESSTOPOLOGYAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SECURITYAPPCONTAINER.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\REALTIMEAPISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINERROR.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\TIMEZONEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINGDI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINUSER.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\TVOUT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINNLS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\DATETIMEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\STRINGAPISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINCON.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINCONTYPES.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\CONSOLEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\CONSOLEAPI2.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\CONSOLEAPI3.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINVER.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\VERRSRC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINREG.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\REASON.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINNETWK.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WNNC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\CDERR.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\DDE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\DDEML.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\DLGS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\LZEXPAND.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MMSYSTEM.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MMSYSCOM.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MCIAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MMISCAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MMISCAPI2.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PLAYSOUNDAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MMEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\TIMEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\JOYSTICKAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\NB30.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPCDCE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPCDCEP.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\RPCNSI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPCNTERR.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPCASYNC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SHELLAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINPERF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINSOCK.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\INADDR.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINCRYPT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\BCRYPT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\NCRYPT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\DPAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINEFS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINSCARD.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WTYPES.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPCNDR.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\RPCNSIP.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\RPCSAL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WTYPESBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINIOCTL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINSMCRD.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINSPOOL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PRSHT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OLE2.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OBJBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\COMBASEAPI.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\UNKNWNBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OBJIDLBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\CGUID.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\COML2API.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OBJIDL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\UNKNWN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PROPIDLBASE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OAIDL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\URLMON.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OLEIDL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\SERVPROV.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MSXML.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\PROPIDL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\OLEAUTO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\COMMDLG.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\STRALIGN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\WINSVC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\MCX.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\IMM.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\IME_CMODES.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\UM\TLHELP32.H
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\STRING
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\INCLUDE\CCTYPE

```

`Usermode/x64/Release/Usermode.tlog/CL.write.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\MAIN.CPP
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\X64\RELEASE\VC142.PDB
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\X64\RELEASE\MAIN.OBJ

```

`Usermode/x64/Release/Usermode.tlog/Usermode.lastbuildstate`:

```lastbuildstate
PlatformToolSet=v142:VCToolArchitecture=Native32Bit:VCToolsVersion=14.26.28801:TargetPlatformVersion=10.0.19041.0:
Release|x64|C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\|

```

`Usermode/x64/Release/Usermode.tlog/Usermode.write.1u.tlog`:

```tlog
^C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\Usermode\Usermode.vcxproj
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\x64\Release\Usermode.ipdb
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\x64\Release\Usermode.iobj

```

`Usermode/x64/Release/Usermode.tlog/link.command.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\X64\RELEASE\MAIN.OBJ
/OUT:"C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\USERMODE.EXE" /INCREMENTAL:NO /NOLOGO KERNEL32.LIB USER32.LIB GDI32.LIB WINSPOOL.LIB COMDLG32.LIB ADVAPI32.LIB SHELL32.LIB OLE32.LIB OLEAUT32.LIB UUID.LIB ODBC32.LIB ODBCCP32.LIB /MANIFEST /MANIFESTUAC:"level='asInvoker' uiAccess='false'" /manifest:embed /DEBUG /PDB:"C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\USERMODE.PDB" /SUBSYSTEM:CONSOLE /OPT:REF /OPT:ICF /LTCG:incremental /TLBID:1 /DYNAMICBASE /NXCOMPAT /IMPLIB:"C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\USERMODE.LIB" /MACHINE:X64 X64\RELEASE\MAIN.OBJ

```

`Usermode/x64/Release/Usermode.tlog/link.read.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\X64\RELEASE\MAIN.OBJ
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\KERNEL32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\USER32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\GDI32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\WINSPOOL.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\COMDLG32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\ADVAPI32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\SHELL32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\OLE32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\OLEAUT32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\UUID.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\ODBC32.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UM\X64\ODBCCP32.LIB
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\X64\RELEASE\MAIN.OBJ
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\BIN\HOSTX86\X64\C2.DLL
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\LIB\X64\MSVCPRT.LIB
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\LIB\X64\MSVCRT.LIB
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\LIB\X64\OLDNAMES.LIB
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\LIB\X64\VCRUNTIME.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\UCRT\X64\UCRT.LIB
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\BIN\HOSTX86\X64\1033\LINKUI.DLL
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\BIN\HOSTX86\X64\CVTRES.EXE
C:\WINDOWS\SYSTEM32\TZRES.DLL

```

`Usermode/x64/Release/Usermode.tlog/link.write.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\USERMODE\X64\RELEASE\MAIN.OBJ
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\USERMODE.EXE
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\USERMODE.PDB

```

`kernel/Drver.cpp`:

```cpp
#pragma once
#include    "KdmapperTraces.h"




enum	DRIVER_COMMAND : BYTE
{
    START_CONNECTION = 144,
    GET_BASE = 145,
    RESOLVE_RELATIVE_ADDR = 146,
    READ_MEMORY = 147,
    WRITE_MEMORY = 148,
    FIND_OUTBUFFER = 149,
    SIG_SCAN = 150,
    CLEAR_TRACES = 151,
    TEST = 152,
};

struct SigScanInput
{
    char	section[10];
    UCHAR	pattern[20];
    PVOID	moduleBase;
};




PVOID   handler(DWORD64    a, DWORD64   b)
{
    int length;
    memcpy(&length, ((char*)&a + 5), 3);


    int processId;
    memcpy(&processId, ((char*)&a + 1), 4);


    PEPROCESS   process;
    PsLookupProcessByProcessId((HANDLE)processId, &process);



    KFLOATING_SAVE     saveData;


    BYTE* arg1 = (BYTE*)&a;

    switch (arg1[0])
    {
        case START_CONNECTION:
        {
            PsLookupProcessByProcessId((HANDLE)processId, &Globals::userClient);

            Globals::inBufAddress = (BYTE_BUFFER*)(PVOID)b;

            DbgPrint("start  connection command, %p \n", Globals::inBufAddress);

            break;
        }

        case GET_BASE:
        {
            PVOID   baseAddr = Utils::getUserModuleBase(b);

            DbgPrint("baseAddr is %p \n", baseAddr);

            Utils::WriteMemory((ULONG64)Globals::outBufAddress, &baseAddr, sizeof(PVOID), Globals::userClient);

            break;

        }

        case READ_MEMORY:
        {
            DbgPrint("[+] read memory command address  %p ", b);
            DbgPrint("   length %i   ", length);
            DbgPrint("   process ID %i   \n", processId);

            KeSaveFloatingPointState(&saveData);

            BYTE_BUFFER buffer;


            Utils::ReadMemory(b, length, buffer.data, process);

            Utils::WriteMemory((ULONG64)Globals::outBufAddress, buffer.data, length, Globals::userClient);


            KeRestoreFloatingPointState(&saveData);

            return 0;
         
        }

        case WRITE_MEMORY:
        {
            DbgPrint("[+] write memory command address  %p ", b);
            DbgPrint("   length %i   ", length);
            DbgPrint("   process ID %i   \n", processId);


            BYTE_BUFFER    buffer;

            KeSaveFloatingPointState(&saveData);

            Utils::ReadMemory((ULONG64)Globals::inBufAddress, length, buffer.data, Globals::userClient);

            Utils::WriteMemory((ULONG64)b, (PVOID)buffer.data, length, process);

            KeRestoreFloatingPointState(&saveData);

            
            return 0;
        }

        case FIND_OUTBUFFER:
        {

            Globals::outBufAddress = (BYTE_BUFFER*)(PVOID)b;

            break;

        }

        case RESOLVE_RELATIVE_ADDR:
        {
            int     offsetOffset;
            int     instructionLen;




            memcpy(&offsetOffset, (arg1 + 1), 3);
            memcpy(&instructionLen, (arg1 + 4), 4);


            PVOID   address = Utils::ResolveRelativeAddress((PVOID)b, offsetOffset, instructionLen);

            Utils::WriteMemory((DWORD64)Globals::outBufAddress, &address, 8, Globals::userClient);

            break;
        }


        case CLEAR_TRACES:
        {
            cleanUnloadedDriverString();
            ClearPiddbCacheTable();

            break;
        }

        case SIG_SCAN:
        {

            UCHAR   wildcard = arg1[1];

            int     processId = b;

            int     patternLength = *(int*)(arg1 + 2);

            PVOID   foundAt;



            SigScanInput  input;


            Utils::ReadMemory((ULONG64)Globals::inBufAddress, sizeof(SigScanInput), &input, Globals::userClient);
            

            PEPROCESS   targetProcess;
            PsLookupProcessByProcessId((HANDLE)processId, &targetProcess);

            
            KAPC_STATE  apc;
            KeStackAttachProcess(targetProcess, &apc);


            Utils::BBScan(input.section, input.pattern, wildcard, patternLength, &foundAt, input.moduleBase);


            KeUnstackDetachProcess(&apc);



            Utils::WriteMemory((ULONG64)Globals::outBufAddress, &foundAt, sizeof(PVOID64), Globals::userClient);

            return 0;
        }

        case TEST:
        {
            return (PVOID)TEST;
        }

        default:
        {
            Globals::oldFuncPtrAddr(a, b);
        }
    }



    return 0;
}


NTSTATUS    Entry(_In_ _DRIVER_OBJECT* DriverObject, _In_ PUNICODE_STRING RegistryPath)
{
    NTSTATUS         status = STATUS_SUCCESS;
    ULONG            moduleSize;

    DWORD64          ntosBase = (DWORD64)Utils::getDriverBaseAddress(&moduleSize, "ntoskrnl.exe");




    /*  4c 8b 05 ? ? ? ? 33 c0 4d 85 c0 74 `*/
    Utils::BBScan(".PAGE", (PCUCHAR)"\x4C\x8B\x05\x00\x00\x00\x00\x33\xC0\x4D\x85\xC0\x74", '\x00', 13, 
        (PVOID*)&Globals::funcPtrAddress, (PVOID)ntosBase);


    if (Globals::funcPtrAddress != NULL)
    {
        Globals::funcPtrAddress = (NtCompareSigningLevelPtr)Utils::ResolveRelativeAddress(Globals::funcPtrAddress, 3, 7);

        DbgPrint("[1] NtCompareSigningLevels ptr location: %p \n", Globals::funcPtrAddress);

    }
    else
    {
        /*  48 8B 05 ? ? ? ? 48 85 c0 0F 84 ? ? ? ? 8a  */
        Utils::BBScan(".PAGE", (PCUCHAR)"\x4C\x8B\x05\x00\x00\x00\x00\x33\xC0\x4D\x85\xC0\x74", '\x00', 13, 
            (PVOID*)&Globals::funcPtrAddress, (PVOID)ntosBase);


        if (Globals::funcPtrAddress != NULL)
        {
            Globals::funcPtrAddress = (NtCompareSigningLevelPtr)Utils::ResolveRelativeAddress(Globals::funcPtrAddress, 3, 7);

            DbgPrint("[2] NtCompareSigningLevels ptr location: %p \n", Globals::funcPtrAddress);

        }
        else    /*      if step 3 fails, then there will be BSOD       */
        {

            UNICODE_STRING      ntCompareSigningLevel;
            RtlInitUnicodeString(&ntCompareSigningLevel, L"NtCompareSigningLevels");


            Globals::funcPtrAddress = (NtCompareSigningLevelPtr)MmGetSystemRoutineAddress(&ntCompareSigningLevel);

            DWORD64  instruction = (DWORD64)Globals::funcPtrAddress + 4;

            instruction = (DWORD64)Utils::ResolveRelativeAddress((PVOID)instruction, 3, 7);


            DbgPrint("[3] NtCompareSigningLevels ptr location: %p \n", Globals::funcPtrAddress);
        }
    }

    KIRQL   irql = Utils::disableWP();


    /*  save old address    */
    Globals::oldFuncPtrAddr = *(NtCompareSigningLevelPtr*)Globals::funcPtrAddress;

    *(NtCompareSigningLevelPtr*)Globals::funcPtrAddress = (NtCompareSigningLevelPtr)handler;

    Utils::enableWP(irql);


    return     status;
}






NTSTATUS mapperEntry(PDRIVER_OBJECT driver_obj, PUNICODE_STRING registry_path)
{
    DbgPrint("driver start \n");

    Entry(NULL, NULL);

    return STATUS_SUCCESS;
}
```

`kernel/KdmapperTraces.h`:

```h
#pragma once

#include "utils.h"

BOOLEAN IsUnloadedDriverEntryEmpty(
	_In_ PMM_UNLOADED_DRIVER Entry
)
{
	if (Entry->Name.MaximumLength == 0 ||
		Entry->Name.Length == 0 ||
		Entry->Name.Buffer == NULL)
	{
		return TRUE;
	}

	return FALSE;
}


UNICODE_STRING DriverName = RTL_CONSTANT_STRING(L"iqvw64e.sys");
UNICODE_STRING NewDriverName = RTL_CONSTANT_STRING(L"pl92qgz.sys");



PMM_UNLOADED_DRIVER MmUnloadedDrivers;

PULONG			MmLastUnloadedDriver;

UCHAR			MmUnloadedDriverSig[] = "\x4C\x8B\x00\x00\x00\x00\x00\x4C\x8B\xC9\x4D\x85\x00\x74";
UCHAR			MmUnloadedDriverSig2[] = "\x48\x8B\x15\x00\x00\x00\x00\x48\x8B\xF1\x48\x85\xd2";

NTSTATUS findMMunloadedDrivers()
{
	PVOID MmUnloadedDriversPtr = NULL;

	Utils::BBScan(".PAGE", MmUnloadedDriverSig, 0x00, sizeof(MmUnloadedDriverSig) - 1, (PVOID*)(&MmUnloadedDriversPtr));


	if (MmUnloadedDriversPtr == NULL) {
		DbgPrint("Unable to find MmUnloadedDriver sig, trying 2nd sig\n");
		
		Utils::BBScan(".PAGE", MmUnloadedDriverSig2, 0x00, sizeof(MmUnloadedDriverSig2) - 1, (PVOID*)(&MmUnloadedDriversPtr));

		if (MmUnloadedDriversPtr == NULL)
		{
			DbgPrint("failed!\n");
		}
	}

	DbgPrint("MmUnloadedDriversPtr address found: %p  \n", MmUnloadedDriversPtr);


	MmUnloadedDrivers = *(PMM_UNLOADED_DRIVER*)Utils::ResolveRelativeAddress(MmUnloadedDriversPtr, 3, 7);

	DbgPrint("MmUnloadedDrivers real location is: %p\n", &MmUnloadedDrivers);

	return STATUS_SUCCESS;
}



UCHAR	 PiDDBLockPtr_sig[] = "\x48\x8D\x0D\x00\x00\x00\x00\xE8\x00\x00\x00\x00\x4C\x8B\x8C";

/*	48 83 25 ? ? ? ? 00 48 8D 0D ? ? ? ? 48 83 25 ? ? ? ? 00  48 83 25 ? ? ? ? 00	
	+8 for PiddbLock instruction
*/
UCHAR	 PiDDBLockPtr_sig2[] = "\x48\x83\x25\xCC\xCC\xCC\xCC\x00\x48\x8D\x0D\xCC\xCC\xCC\xCC\xCC\x48\x83\x25\xCC\xCC\xCC\xCC\x00\x48\x83\x25\xCC\xCC\xCC\xCC\x00";


/*	48 8D 0D ? ? ? ? 48 8b d0 e8 ? ? ? ? 33 d2	*/
UCHAR	PiDDBCacheTablePtr_sig[] = "\x48\x8D\x0D\x00\x00\x00\x00\x48\x8b\xd0\xe8\x00\x00\x00\x00\x33\xd2";
UCHAR	PiDDBCacheTablePtr_sig2[] = "\x66\x03\xD2\x48\x8D\x0D";



bool LocatePiDDB(PERESOURCE* lock, PRTL_AVL_TABLE* table)
{
	PVOID PiDDBLockPtr = nullptr, PiDDBCacheTablePtr = nullptr;

	Utils::BBScan(".PAGE", PiDDBLockPtr_sig, 0, sizeof(PiDDBLockPtr_sig) - 1, reinterpret_cast<PVOID*>(&PiDDBLockPtr));


	if (PiDDBLockPtr != NULL)
	{
		DbgPrint("found PiDDBLockPtr sig. Piddblockptr is: %p\n", PiDDBLockPtr);
	}
	else
	{
		DbgPrint("PiDDBLockPtr not found, using second sig \n");


		Utils::BBScan(".PAGE", PiDDBLockPtr_sig2, 0xCC, sizeof(PiDDBLockPtr_sig2) - 1, reinterpret_cast<PVOID*>(&PiDDBLockPtr));

		PiDDBLockPtr = (PVOID64)((DWORD64)PiDDBLockPtr + 8);

		if (PiDDBLockPtr == NULL)
		{
			DbgPrint("failed to find PiDDBLock!!! \n");
		}
	}


	Utils::BBScan(".PAGE", PiDDBCacheTablePtr_sig, 0, sizeof(PiDDBCacheTablePtr_sig) - 1, reinterpret_cast<PVOID*>(&PiDDBCacheTablePtr));
	
	if (PiDDBCacheTablePtr != NULL)
	{
		DbgPrint("found PiDDBCacheTablePtr sig. PiDDBCacheTablePtr is: %p\n", PiDDBCacheTablePtr);
	}
	else
	{
		DbgPrint("failed to find PiDDBCacheTable, try 2nd sig \n");

		Utils::BBScan(".PAGE", PiDDBCacheTablePtr_sig2, 0, sizeof(PiDDBCacheTablePtr_sig2) - 1, reinterpret_cast<PVOID*>(&PiDDBCacheTablePtr));

		PiDDBCacheTablePtr = PVOID((uintptr_t)PiDDBCacheTablePtr + 3);
	}


	*lock = (PERESOURCE)(Utils::ResolveRelativeAddress(PiDDBLockPtr, 3, 7));

	*table = (PRTL_AVL_TABLE)(Utils::ResolveRelativeAddress(PiDDBCacheTablePtr, 3, 7));

	return true;
}





BOOLEAN ClearPiddbCacheTable()
{
	PERESOURCE PiDDBLock = NULL;

	PRTL_AVL_TABLE PiDDBCacheTable = NULL;

	NTSTATUS Status = LocatePiDDB(&PiDDBLock, &PiDDBCacheTable);


	if (PiDDBCacheTable == NULL || PiDDBLock == NULL)
	{
		DbgPrint("LocatePIDDB lock and/or cachetable not found\n");

		return Status;
	}
	else
	{
		DbgPrint("Successfully found PiddbCachetable and lock!!!1111\n");
		DbgPrint("PiddbLock: %p\n", PiDDBLock);
		DbgPrint("PiddbCacheTable: %p\n", PiDDBCacheTable);

		PIDCacheobj Entry;

		UNICODE_STRING DriverName = RTL_CONSTANT_STRING(L"iqvw64e.sys");

		Entry.DriverName = DriverName;

		Entry.TimeDateStamp = 0x5284EAC3;


		ExAcquireResourceExclusiveLite(PiDDBLock, TRUE);
		PIDCacheobj* pFoundEntry = (PIDCacheobj*)RtlLookupElementGenericTableAvl(PiDDBCacheTable, &Entry);


		if (pFoundEntry == NULL)
		{
			DbgPrint("pFoundEntry not found !!!\n");

			// release ddb resource lock
			ExReleaseResourceLite(PiDDBLock);

			return FALSE;
		}
		else
		{


			pFoundEntry->DriverName = NewDriverName;
			pFoundEntry->TimeDateStamp = 0x5889EAC3


		/*	DbgPrint("Found iqvw64e.sys in PiDDBCachetable!!\n");
			//unlink from list

			RemoveEntryList(&pFoundEntry->List);

			RtlDeleteElementGenericTableAvl(PiDDBCacheTable, pFoundEntry);

			// release the ddb resource lock

			ExReleaseResourceLite(PiDDBLock);*/

			DbgPrint("Clear success and finish !!!\n");

			return TRUE;
		}

	}
}



BOOLEAN isMmUnloadedDriversFilled()
{
	PMM_UNLOADED_DRIVER entry;

	for (ULONG Index = 0; Index < MM_UNLOADED_DRIVERS_SIZE; ++Index)
	{
		entry = &MmUnloadedDrivers[Index];

		if (entry->Name.Buffer == NULL || entry->Name.Length == 0 || entry->Name.MaximumLength == 0)
		{
			return FALSE;
		}

	}
	return TRUE;
}




BOOLEAN cleanUnloadedDriverString()
{
	findMMunloadedDrivers();
	BOOLEAN cleared = FALSE;
	BOOLEAN Filled = isMmUnloadedDriversFilled();

	DbgPrint("about to clear mmunload\n");

	for (ULONG Index = 0; Index < MM_UNLOADED_DRIVERS_SIZE; ++Index)
	{


		PMM_UNLOADED_DRIVER Entry = &MmUnloadedDrivers[Index];

		if (RtlCompareUnicodeString(&DriverName, &Entry->Name, TRUE))
		{
			if (Index == 0)
			{
				DbgPrint("destroyed MmUnloaded Driver!!!\n");

				RtlZeroMemory(Entry, sizeof(MM_UNLOADED_DRIVER));
			}
			else
			{
				//random 7 letter name
				RtlCopyUnicodeString(&Entry->Name, &NewDriverName);
				Entry->UnloadTime = MmUnloadedDrivers[Index - 1].UnloadTime - 130;

				DbgPrint("DONE randomizing name inside CleanUnloadedDriverString\n");
			}
			return TRUE;
		}
	}
	DbgPrint("cannot find iqvw64e.sys!!!!111 cleanunloadeddriverstring fail!!1111\n");

	return FALSE;
}


BOOLEAN		clearKdmapperTraces()
{
	BOOLEAN		status;
	status = cleanUnloadedDriverString();
	if (status == FALSE)
	{
		DbgPrint("problem with mmunloadeddrivers\n");
	}
	status = ClearPiddbCacheTable();
	if (status == FALSE)
	{
		DbgPrint("problem with PiddbCacheTable\n");
	}
	return	 status;
}
```

`kernel/kernel.inf`:

```inf
;
; kernel.inf
;

[Version]
Signature="$WINDOWS NT$"
Class=Sample ; TODO: edit Class
ClassGuid={78A1C341-4539-11d3-B88D-00C04FAD5171} ; TODO: edit ClassGuid
Provider=%ManufacturerName%
CatalogFile=kernel.cat
DriverVer= ; TODO: set DriverVer in stampinf property pages
PnpLockDown=1

[DestinationDirs]
DefaultDestDir = 12
kernel_Device_CoInstaller_CopyFiles = 11

; ================= Class section =====================

[ClassInstall32]
Addreg=SampleClassReg

[SampleClassReg]
HKR,,,0,%ClassName%
HKR,,Icon,,-5

[SourceDisksNames]
1 = %DiskName%,,,""

[SourceDisksFiles]
kernel.sys  = 1,,
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll=1 ; make sure the number matches with SourceDisksNames

;*****************************************
; Install Section
;*****************************************

[Manufacturer]
%ManufacturerName%=Standard,NT$ARCH$

[Standard.NT$ARCH$]
%kernel.DeviceDesc%=kernel_Device, Root\kernel ; TODO: edit hw-id

[kernel_Device.NT]
CopyFiles=Drivers_Dir

[Drivers_Dir]
kernel.sys

;-------------- Service installation
[kernel_Device.NT.Services]
AddService = kernel,%SPSVCINST_ASSOCSERVICE%, kernel_Service_Inst

; -------------- kernel driver install sections
[kernel_Service_Inst]
DisplayName    = %kernel.SVCDESC%
ServiceType    = 1               ; SERVICE_KERNEL_DRIVER
StartType      = 3               ; SERVICE_DEMAND_START
ErrorControl   = 1               ; SERVICE_ERROR_NORMAL
ServiceBinary  = %12%\kernel.sys

;
;--- kernel_Device Coinstaller installation ------
;

[kernel_Device.NT.CoInstallers]
AddReg=kernel_Device_CoInstaller_AddReg
CopyFiles=kernel_Device_CoInstaller_CopyFiles

[kernel_Device_CoInstaller_AddReg]
HKR,,CoInstallers32,0x00010000, "WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll,WdfCoInstaller"

[kernel_Device_CoInstaller_CopyFiles]
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll

[kernel_Device.NT.Wdf]
KmdfService =  kernel, kernel_wdfsect
[kernel_wdfsect]
KmdfLibraryVersion = $KMDFVERSION$

[Strings]
SPSVCINST_ASSOCSERVICE= 0x00000002
ManufacturerName="<Your manufacturer name>" ;TODO: Replace with your manufacturer name
ClassName="Samples" ; TODO: edit ClassName
DiskName = "kernel Installation Disk"
kernel.DeviceDesc = "kernel Device"
kernel.SVCDESC = "kernel Service"

```

`kernel/kernel.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM">
      <Configuration>Debug</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM">
      <Configuration>Release</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{35935BD3-F3F0-4EE6-8714-F79DC637BB57}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    <RootNamespace>kernel</RootNamespace>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
    <Driver_SpectreMitigation>Spectre</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <TreatWarningAsError>false</TreatWarningAsError>
      <BufferSecurityCheck>false</BufferSecurityCheck>
    </ClCompile>
    <Link>
      <EntryPointSymbol>mapperEntry</EntryPointSymbol>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <Inf Include="kernel.inf" />
  </ItemGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="Drver.cpp" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="KdmapperTraces.h" />
    <ClInclude Include="undocumented.h" />
    <ClInclude Include="utils.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`kernel/kernel.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <Inf Include="kernel.inf">
      <Filter>Driver Files</Filter>
    </Inf>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="Drver.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="undocumented.h">
      <Filter>Source Files</Filter>
    </ClInclude>
    <ClInclude Include="utils.h">
      <Filter>Source Files</Filter>
    </ClInclude>
    <ClInclude Include="KdmapperTraces.h">
      <Filter>Source Files</Filter>
    </ClInclude>
  </ItemGroup>
</Project>
```

`kernel/kernel.vcxproj.user`:

```user
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <SignMode>Off</SignMode>
  </PropertyGroup>
</Project>
```

`kernel/undocumented.h`:

```h
#pragma once
#include    <ntdef.h>
#include    <ntifs.h>
#include    <windef.h>
#include    <Ntstrsafe.h>
#include    <intrin.h>


#define MM_UNLOADED_DRIVERS_SIZE 50
#define IMAGE_SCN_CNT_INITIALIZED_DATA 0x00000040
#define IMAGE_SCN_CNT_UNINITIALIZED_DATA 0x00000080
#define IMAGE_SCN_CNT_CODE 0x00000020
#define IMAGE_SCN_MEM_EXECUTE 0x20000000
#define IMAGE_SCN_MEM_DISCARDABLE 0x02000000
#define IMAGE_NT_SIGNATURE 0x00004550
#define IMAGE_DOS_SIGNATURE 0x5A4D // MZ
#define STANDARD_RIGHTS_ALL 0x001F0000L
#define IMAGE_NUMBEROF_DIRECTORY_ENTRIES        16




typedef enum _SYSTEM_INFORMATION_CLASS
{
    SystemBasicInformation = 0,
    SystemProcessorInformation = 1,             // obsolete...delete
    SystemPerformanceInformation = 2,
    SystemTimeOfDayInformation = 3,
    SystemPathInformation = 4,
    SystemProcessInformation = 5,
    SystemCallCountInformation = 6,
    SystemDeviceInformation = 7,
    SystemProcessorPerformanceInformation = 8,
    SystemFlagsInformation = 9,
    SystemCallTimeInformation = 10,
    SystemModuleInformation = 11,
    SystemLocksInformation = 12,
    SystemStackTraceInformation = 13,
    SystemPagedPoolInformation = 14,
    SystemNonPagedPoolInformation = 15,
    SystemHandleInformation = 16,
    SystemObjectInformation = 17,
    SystemPageFileInformation = 18,
    SystemVdmInstemulInformation = 19,
    SystemVdmBopInformation = 20,
    SystemFileCacheInformation = 21,
    SystemPoolTagInformation = 22,
    SystemInterruptInformation = 23,
    SystemDpcBehaviorInformation = 24,
    SystemFullMemoryInformation = 25,
    SystemLoadGdiDriverInformation = 26,
    SystemUnloadGdiDriverInformation = 27,
    SystemTimeAdjustmentInformation = 28,
    SystemSummaryMemoryInformation = 29,
    SystemMirrorMemoryInformation = 30,
    SystemPerformanceTraceInformation = 31,
    SystemObsolete0 = 32,
    SystemExceptionInformation = 33,
    SystemCrashDumpStateInformation = 34,
    SystemKernelDebuggerInformation = 35,
    SystemContextSwitchInformation = 36,
    SystemRegistryQuotaInformation = 37,
    SystemExtendServiceTableInformation = 38,
    SystemPrioritySeperation = 39,
    SystemVerifierAddDriverInformation = 40,
    SystemVerifierRemoveDriverInformation = 41,
    SystemProcessorIdleInformation = 42,
    SystemLegacyDriverInformation = 43,
    SystemCurrentTimeZoneInformation = 44,
    SystemLookasideInformation = 45,
    SystemTimeSlipNotification = 46,
    SystemSessionCreate = 47,
    SystemSessionDetach = 48,
    SystemSessionInformation = 49,
    SystemRangeStartInformation = 50,
    SystemVerifierInformation = 51,
    SystemVerifierThunkExtend = 52,
    SystemSessionProcessInformation = 53,
    SystemLoadGdiDriverInSystemSpace = 54,
    SystemNumaProcessorMap = 55,
    SystemPrefetcherInformation = 56,
    SystemExtendedProcessInformation = 57,
    SystemRecommendedSharedDataAlignment = 58,
    SystemComPlusPackage = 59,
    SystemNumaAvailableMemory = 60,
    SystemProcessorPowerInformation = 61,
    SystemEmulationBasicInformation = 62,
    SystemEmulationProcessorInformation = 63,
    SystemExtendedHandleInformation = 64,
    SystemLostDelayedWriteInformation = 65,
    SystemBigPoolInformation = 66,
    SystemSessionPoolTagInformation = 67,
    SystemSessionMappedViewInformation = 68,
    SystemHotpatchInformation = 69,
    SystemObjectSecurityMode = 70,
    SystemWatchdogTimerHandler = 71,
    SystemWatchdogTimerInformation = 72,
    SystemLogicalProcessorInformation = 73,
    SystemWow64SharedInformation = 74,
    SystemRegisterFirmwareTableInformationHandler = 75,
    SystemFirmwareTableInformation = 76,
    SystemModuleInformationEx = 77,
    SystemVerifierTriageInformation = 78,
    SystemSuperfetchInformation = 79,
    SystemMemoryListInformation = 80,
    SystemFileCacheInformationEx = 81,
    MaxSystemInfoClass = 82  // MaxSystemInfoClass should always be the last enum

} SYSTEM_INFORMATION_CLASS;

typedef struct _IMAGE_DATA_DIRECTORY
{
    ULONG VirtualAddress;
    ULONG Size;
} IMAGE_DATA_DIRECTORY, * PIMAGE_DATA_DIRECTORY;


typedef struct _SYSTEM_THREADS
{
    LARGE_INTEGER  KernelTime;
    LARGE_INTEGER  UserTime;
    LARGE_INTEGER  CreateTime;
    ULONG    WaitTime;
    PVOID    StartAddress;
    CLIENT_ID   ClientID;
    KPRIORITY   Priority;
    KPRIORITY   BasePriority;
    ULONG    ContextSwitchCount;
    ULONG    ThreadState;
    KWAIT_REASON  WaitReason;
    ULONG    Reserved; //Add
}SYSTEM_THREADS, * PSYSTEM_THREADS;

typedef struct _SYSTEM_PROCESS_INFORMATION {
    ULONG                   NextEntryOffset;
    ULONG                   NumberOfThreads;
    LARGE_INTEGER           Reserved[3];
    LARGE_INTEGER           CreateTime;
    LARGE_INTEGER           UserTime;
    LARGE_INTEGER           KernelTime;
    UNICODE_STRING          ImageName;
    KPRIORITY               BasePriority;
    HANDLE                  ProcessId;
    HANDLE                  InheritedFromProcessId;
    ULONG                   HandleCount;
    ULONG                   Reserved2[2];
    ULONG                   PrivatePageCount;
    VM_COUNTERS             VirtualMemoryCounters;
    IO_COUNTERS             IoCounters;
    SYSTEM_THREADS           Threads[1];
} SYSTEM_PROCESS_INFORMATION, * PSYSTEM_PROCESS_INFORMATION;



typedef struct _RTL_PROCESS_MODULE_INFORMATION
{
    HANDLE Section;         // Not filled in
    PVOID MappedBase;
    PVOID ImageBase;
    ULONG ImageSize;
    ULONG Flags;
    USHORT LoadOrderIndex;
    USHORT InitOrderIndex;
    USHORT LoadCount;
    USHORT OffsetToFileName;
    UCHAR  FullPathName[MAXIMUM_FILENAME_LENGTH];
} RTL_PROCESS_MODULE_INFORMATION, * PRTL_PROCESS_MODULE_INFORMATION;


typedef struct _RTL_PROCESS_MODULES
{
    ULONG NumberOfModules;
    RTL_PROCESS_MODULE_INFORMATION Modules[1];
} RTL_PROCESS_MODULES, * PRTL_PROCESS_MODULES;



typedef struct _IMAGE_SECTION_HEADER {
    BYTE  Name[8];
    union {
        DWORD PhysicalAddress;
        DWORD VirtualSize;
    } Misc;
    DWORD VirtualAddress;
    DWORD SizeOfRawData;
    DWORD PointerToRawData;
    DWORD PointerToRelocations;
    DWORD PointerToLinenumbers;
    WORD  NumberOfRelocations;
    WORD  NumberOfLinenumbers;
    DWORD Characteristics;
} IMAGE_SECTION_HEADER, * PIMAGE_SECTION_HEADER;


typedef struct _IMAGE_FILE_HEADER // Size=20
{
    USHORT Machine;
    USHORT NumberOfSections;
    ULONG TimeDateStamp;
    ULONG PointerToSymbolTable;
    ULONG NumberOfSymbols;
    USHORT SizeOfOptionalHeader;
    USHORT Characteristics;
} IMAGE_FILE_HEADER, * PIMAGE_FILE_HEADER;

typedef struct _IMAGE_OPTIONAL_HEADER64
{
    USHORT Magic;
    UCHAR MajorLinkerVersion;
    UCHAR MinorLinkerVersion;
    ULONG SizeOfCode;
    ULONG SizeOfInitializedData;
    ULONG SizeOfUninitializedData;
    ULONG AddressOfEntryPoint;
    ULONG BaseOfCode;
    ULONGLONG ImageBase;
    ULONG SectionAlignment;
    ULONG FileAlignment;
    USHORT MajorOperatingSystemVersion;
    USHORT MinorOperatingSystemVersion;
    USHORT MajorImageVersion;
    USHORT MinorImageVersion;
    USHORT MajorSubsystemVersion;
    USHORT MinorSubsystemVersion;
    ULONG Win32VersionValue;
    ULONG SizeOfImage;
    ULONG SizeOfHeaders;
    ULONG CheckSum;
    USHORT Subsystem;
    USHORT DllCharacteristics;
    ULONGLONG SizeOfStackReserve;
    ULONGLONG SizeOfStackCommit;
    ULONGLONG SizeOfHeapReserve;
    ULONGLONG SizeOfHeapCommit;
    ULONG LoaderFlags;
    ULONG NumberOfRvaAndSizes;
    struct _IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER64, * PIMAGE_OPTIONAL_HEADER64;


typedef struct _IMAGE_NT_HEADERS64 {
    DWORD                   Signature;
    IMAGE_FILE_HEADER       FileHeader;
    IMAGE_OPTIONAL_HEADER64 OptionalHeader;
} IMAGE_NT_HEADERS64, * PIMAGE_NT_HEADERS64;


typedef struct _PEB32
{
    UCHAR InheritedAddressSpace;
    UCHAR ReadImageFileExecOptions;
    UCHAR BeingDebugged;
    UCHAR BitField;
    ULONG Mutant;
    ULONG ImageBaseAddress;
    ULONG Ldr;
    ULONG ProcessParameters;
    ULONG SubSystemData;
    ULONG ProcessHeap;
    ULONG FastPebLock;
    ULONG AtlThunkSListPtr;
    ULONG IFEOKey;
    ULONG CrossProcessFlags;
    ULONG UserSharedInfoPtr;
    ULONG SystemReserved;
    ULONG AtlThunkSListPtr32;
    ULONG ApiSetMap;
} PEB32, * PPEB32;


typedef struct _PEB_LDR_DATA32
{
    ULONG Length;
    UCHAR Initialized;
    ULONG SsHandle;
    LIST_ENTRY32 InLoadOrderModuleList;
    LIST_ENTRY32 InMemoryOrderModuleList;
    LIST_ENTRY32 InInitializationOrderModuleList;
} PEB_LDR_DATA32, * PPEB_LDR_DATA32;


typedef struct _LDR_DATA_TABLE_ENTRY
{
    LIST_ENTRY InLoadOrderLinks;
    LIST_ENTRY InMemoryOrderLinks;
    LIST_ENTRY InInitializationOrderLinks;
    PVOID DllBase;
    PVOID EntryPoint;
    ULONG SizeOfImage;
    UNICODE_STRING FullDllName;
    UNICODE_STRING BaseDllName;
    ULONG Flags;
    USHORT LoadCount;
    USHORT TlsIndex;
    LIST_ENTRY HashLinks;
    ULONG TimeDateStamp;
} LDR_DATA_TABLE_ENTRY, * PLDR_DATA_TABLE_ENTRY;
typedef struct _LDR_DATA_TABLE_ENTRY32
{
    LIST_ENTRY32 InLoadOrderLinks;
    LIST_ENTRY32 InMemoryOrderLinks;
    LIST_ENTRY32 InInitializationOrderLinks;
    ULONG DllBase;
    ULONG EntryPoint;
    ULONG SizeOfImage;
    UNICODE_STRING32 FullDllName;
    UNICODE_STRING32 BaseDllName;
    ULONG Flags;
    USHORT LoadCount;
    USHORT TlsIndex;
    LIST_ENTRY32 HashLinks;
    ULONG TimeDateStamp;
} LDR_DATA_TABLE_ENTRY32, * PLDR_DATA_TABLE_ENTRY32;

typedef struct _PEB_LDR_DATA
{
    ULONG Length;
    UCHAR Initialized;
    PVOID SsHandle;
    LIST_ENTRY InLoadOrderModuleList;
    LIST_ENTRY InMemoryOrderModuleList;
    LIST_ENTRY InInitializationOrderModuleList;
} PEB_LDR_DATA, * PPEB_LDR_DATA;

typedef struct _PEB
{
    UCHAR InheritedAddressSpace;
    UCHAR ReadImageFileExecOptions;
    UCHAR BeingDebugged;
    UCHAR BitField;
    PVOID Mutant;
    PVOID ImageBaseAddress;
    PPEB_LDR_DATA Ldr;
    PVOID ProcessParameters;
    PVOID SubSystemData;
    PVOID ProcessHeap;
    PVOID FastPebLock;
    PVOID AtlThunkSListPtr;
    PVOID IFEOKey;
    PVOID CrossProcessFlags;
    PVOID KernelCallbackTable;
    ULONG SystemReserved;
    ULONG AtlThunkSListPtr32;
    PVOID ApiSetMap;
} PEB, * PPEB;



typedef struct _MM_UNLOADED_DRIVER
{
    UNICODE_STRING 	    Name;
    PVOID 			    ModuleStart;
    PVOID 			    ModuleEnd;
    ULONG64 		    UnloadTime;
} MM_UNLOADED_DRIVER, * PMM_UNLOADED_DRIVER;


typedef struct PiDDBCacheEntry
{
    LIST_ENTRY		List;
    UNICODE_STRING	DriverName;
    ULONG			TimeDateStamp;
    NTSTATUS		LoadStatus;
    char			_0x0028[16]; // data from the shim engine, or uninitialized memory for custom drivers
}PIDCacheobj;


extern "C"
{

    NTSTATUS NTAPI MmCopyVirtualMemory
    (
        PEPROCESS SourceProcess,
        PVOID SourceAddress,
        PEPROCESS TargetProcess,
        PVOID TargetAddress,
        SIZE_T BufferSize,
        KPROCESSOR_MODE PreviousMode,
        PSIZE_T ReturnSize
    );


    NTSYSAPI NTSTATUS NTAPI ZwQuerySystemInformation
    (
        IN SYSTEM_INFORMATION_CLASS SystemInformationClass,
        OUT PVOID SystemInformation,
        IN ULONG SystemInformationLength,
        OUT PULONG ReturnLength OPTIONAL
    );

    NTSYSAPI PIMAGE_NT_HEADERS NTAPI RtlImageNtHeader(IN PVOID   ModuleAddress);



    EXTERN_C NTKERNELAPI PVOID NTAPI PsGetProcessWow64Process(
        _In_ PEPROCESS Process
    );

    EXTERN_C NTKERNELAPI  PPEB NTAPI PsGetProcessPeb(IN PEPROCESS Process);
}
```

`kernel/utils.h`:

```h
#pragma once
#include	 "undocumented.h"


struct BYTE_BUFFER
{
    BYTE	data[50];
};



typedef __int64(__fastcall* NtCompareSigningLevelPtr)(DWORD64, DWORD64);



namespace   Globals
{
    NtCompareSigningLevelPtr    funcPtrAddress;
    NtCompareSigningLevelPtr    oldFuncPtrAddr;
    BYTE_BUFFER*                inBufAddress;
    BYTE_BUFFER*                outBufAddress;
    PEPROCESS                   userClient;
}


namespace Utils
{
    PVOID getDriverBaseAddress(OUT PULONG pSize, const char* driverName)
    {
        NTSTATUS Status = STATUS_SUCCESS;
        ULONG Bytes = 0;
        PRTL_PROCESS_MODULES arrayOfModules;


        PVOID			DriverBase = 0;
        ULONG64			DriverSize = 0;


        //get size of system module information
        Status = ZwQuerySystemInformation(SystemModuleInformation, 0, Bytes, &Bytes);
        if (Bytes == 0)
        {
            DbgPrint("%s: Invalid SystemModuleInformation size\n");
            return NULL;
        }


        arrayOfModules = (PRTL_PROCESS_MODULES)ExAllocatePoolWithTag(NonPagedPool, Bytes, 0x45454545); //array of loaded kernel modules
        RtlZeroMemory(arrayOfModules, Bytes); //clean memory


        Status = ZwQuerySystemInformation(SystemModuleInformation, arrayOfModules, Bytes, &Bytes);

        if (NT_SUCCESS(Status))
        {
            PRTL_PROCESS_MODULE_INFORMATION pMod = arrayOfModules->Modules;
            for (int i = 0; i < arrayOfModules->NumberOfModules; ++i)
            {
                //list the module names:

                DbgPrint("Image name: %s\n", pMod[i].FullPathName + pMod[i].OffsetToFileName);
                // path name plus some amount of characters will lead to the name itself
                const char* DriverName = (const char*)pMod[i].FullPathName + pMod[i].OffsetToFileName;

                if (strcmp(DriverName, driverName) == 0)
                {
                    DbgPrint("found driver\n");


                    DriverBase = pMod[i].ImageBase;
                    DriverSize = pMod[i].ImageSize;

                    DbgPrint("kernel module Size : %i\n", DriverSize);
                    DbgPrint("kernel module Base : %p\n", DriverBase);


                    if (arrayOfModules)
                        ExFreePoolWithTag(arrayOfModules, 0x45454545); // 'ENON'


                    if (pSize != NULL)
                    {
                        *pSize = DriverSize;
                    }

                    return DriverBase;
                }
            }
        }
        if (arrayOfModules)
            ExFreePoolWithTag(arrayOfModules, 0x45454545); // 'ENON'


        if (pSize != NULL)
        {
            *pSize = DriverSize;
        }
        return (PVOID)DriverBase;
    }



    PVOID64     findPattern(BYTE* pattern, int patternSize, BYTE    wildCard, ULONG64 startAddress, ULONG64   endAddress)
    {
        bool found = false;

        if (!MmIsAddressValid((PVOID)startAddress))
        {
            return 0;
        }

        for (BYTE* i = (BYTE*)startAddress; i < (BYTE*)(endAddress - patternSize); ++i)
        {
            found = true;

            for (int j = 0; j < patternSize; ++j)
            {
                if ((pattern[j] != i[j]) && (pattern[j] != wildCard))
                {
                    found = false;
                    break;
                }
            }
            if (found == true)
            {
                return (PVOID64)i;
            }
        }

        return 0;
    }


    PVOID GetUserModule(IN PEPROCESS pProcess, IN PUNICODE_STRING ModuleName, IN BOOLEAN isWow64)
    {
        ASSERT(pProcess != NULL);
        if (pProcess == NULL)
            return NULL;


            LARGE_INTEGER time = { 0 };
            time.QuadPart = -250ll * 10 * 1000;     // 250 msec.

            // Wow64 process
            if (isWow64)
            {
                PPEB32 pPeb32 = (PPEB32)PsGetProcessWow64Process(pProcess);
                if (pPeb32 == NULL)
                {
                    return NULL;
                }

                // Wait for loader a bit
                for (INT i = 0; !pPeb32->Ldr && i < 10; i++)
                {
                    KeDelayExecutionThread(KernelMode, TRUE, &time);
                }

                // Still no loader
                if (!pPeb32->Ldr)
                {
                    return NULL;
                }

                // Search in InLoadOrderModuleList
                for (PLIST_ENTRY32 pListEntry = (PLIST_ENTRY32)((PPEB_LDR_DATA32)pPeb32->Ldr)->InLoadOrderModuleList.Flink;
                    pListEntry != &((PPEB_LDR_DATA32)pPeb32->Ldr)->InLoadOrderModuleList;
                    pListEntry = (PLIST_ENTRY32)pListEntry->Flink)
                {
                    UNICODE_STRING ustr;
                    PLDR_DATA_TABLE_ENTRY32 pEntry = CONTAINING_RECORD(pListEntry, LDR_DATA_TABLE_ENTRY32, InLoadOrderLinks);

                    RtlUnicodeStringInit(&ustr, (PWCH)pEntry->BaseDllName.Buffer);

                    if (RtlCompareUnicodeString(&ustr, ModuleName, TRUE) == 0)
                        return (PVOID)pEntry->DllBase;
                }
            }
            // Native process
            else
            {
                PPEB pPeb = PsGetProcessPeb(pProcess);
                if (!pPeb)
                {
                    return NULL;
                }

                // Wait for loader a bit
                for (INT i = 0; !pPeb->Ldr && i < 10; i++)
                {
                    KeDelayExecutionThread(KernelMode, TRUE, &time);
                }

                // Still no loader
                if (!pPeb->Ldr)
                {
                    return NULL;
                }

                // Search in InLoadOrderModuleList
                for (PLIST_ENTRY pListEntry = pPeb->Ldr->InLoadOrderModuleList.Flink;
                    pListEntry != &pPeb->Ldr->InLoadOrderModuleList;
                    pListEntry = pListEntry->Flink)
                {
                    PLDR_DATA_TABLE_ENTRY pEntry = CONTAINING_RECORD(pListEntry, LDR_DATA_TABLE_ENTRY, InLoadOrderLinks);
                    if (RtlCompareUnicodeString(&pEntry->BaseDllName, ModuleName, TRUE) == 0)
                        return pEntry->DllBase;
                }
            }
        


        return NULL;
    }

    KIRQL disableWP()
    {
        KIRQL	tempirql = KeRaiseIrqlToDpcLevel();

        ULONG64  cr0 = __readcr0();

        cr0 &= 0xfffffffffffeffff;

        __writecr0(cr0);

        _disable();

        return tempirql;

    }


    void enableWP(KIRQL		tempirql)
    {
        ULONG64	cr0 = __readcr0();

        cr0 |= 0x10000;

        _enable();

        __writecr0(cr0);

        KeLowerIrql(tempirql);
    }


    VOID	WriteMemory(ULONG64 address, PVOID buffer, SIZE_T size, PEPROCESS process)
    {

        KAPC_STATE  apc_state;
        KeStackAttachProcess(process, &apc_state);
        if (MmIsAddressValid((PVOID)address) && MmIsAddressValid((PVOID)(address + size)))
        {
            KIRQL   tempirql = disableWP();

            RtlCopyMemory((PVOID64)address, buffer, size);

            enableWP(tempirql);
        }
        KeUnstackDetachProcess(&apc_state);

    }
    VOID	ReadMemory(ULONG64 address, SIZE_T size, PVOID outBuffer, PEPROCESS process)
    {
        KAPC_STATE  apc_state;

        KeStackAttachProcess(process, &apc_state);


        if (MmIsAddressValid((PVOID64)address) && MmIsAddressValid((PVOID64)(address + size)))
        {
            RtlCopyMemory(outBuffer, (PVOID64)address, size);
        }

        KeUnstackDetachProcess(&apc_state);

        return;
    }

    NTSTATUS BBSearchPattern(IN PCUCHAR pattern, IN UCHAR wildcard, IN ULONG_PTR len, IN const VOID* base, IN ULONG_PTR size, OUT PVOID* ppFound)
    {
        ASSERT(ppFound != NULL && pattern != NULL && base != NULL);
        if (ppFound == NULL || pattern == NULL || base == NULL)
            return STATUS_INVALID_PARAMETER;

        for (ULONG_PTR i = 0; i < size - len; i++)
        {
            BOOLEAN found = TRUE;
            for (ULONG_PTR j = 0; j < len; j++)
            {
                if (pattern[j] != wildcard && pattern[j] != ((PCUCHAR)base)[i + j])
                {
                    found = FALSE;
                    break;
                }
            }

            if (found != FALSE)
            {
                *ppFound = (PUCHAR)base + i;
                return STATUS_SUCCESS;
            }
        }

        return STATUS_NOT_FOUND;
    }



    NTSTATUS BBScan(IN PCCHAR section, IN PCUCHAR pattern, IN UCHAR wildcard, IN ULONG_PTR len, OUT PVOID* ppFound, PVOID base = nullptr)
    {

        //ASSERT(ppFound != NULL);
        if (ppFound == NULL)
            return STATUS_ACCESS_DENIED; //STATUS_INVALID_PARAMETER

        if (nullptr == base)
            base = Utils::getDriverBaseAddress(NULL, "ntoskrnl.exe");
        if (base == nullptr)
            return STATUS_ACCESS_DENIED; //STATUS_NOT_FOUND;

        PIMAGE_NT_HEADERS64 pHdr = (PIMAGE_NT_HEADERS64)RtlImageNtHeader(base);
        if (!pHdr)
            return STATUS_ACCESS_DENIED; // STATUS_INVALID_IMAGE_FORMAT;

        //PIMAGE_SECTION_HEADER pFirstSection = (PIMAGE_SECTION_HEADER)(pHdr + 1);
        PIMAGE_SECTION_HEADER pFirstSection = (PIMAGE_SECTION_HEADER)((uintptr_t)&pHdr->FileHeader + pHdr->FileHeader.SizeOfOptionalHeader + sizeof(IMAGE_FILE_HEADER));

        PVOID ptr = NULL;

        for (PIMAGE_SECTION_HEADER pSection = pFirstSection; pSection < pFirstSection + pHdr->FileHeader.NumberOfSections; pSection++)
        {

            ANSI_STRING s1, s2;
            RtlInitAnsiString(&s1, section);
            RtlInitAnsiString(&s2, (PCCHAR)pSection->Name);
            if (((RtlCompareString(&s1, &s2, TRUE) == 0) || (pSection->Characteristics & IMAGE_SCN_CNT_CODE) || (pSection->Characteristics & IMAGE_SCN_MEM_EXECUTE)))
            {
                NTSTATUS status = BBSearchPattern(pattern, wildcard, len, (PUCHAR)base + pSection->VirtualAddress, pSection->Misc.VirtualSize, &ptr);
                if (NT_SUCCESS(status)) {
                    *(PULONG64)ppFound = (ULONG_PTR)(ptr); //- (PUCHAR)base
                    DbgPrint("found\r\n");
                    return status;
                }
                //we continue scanning because there can be multiple sections with the same name.
            }
        }

        return STATUS_ACCESS_DENIED; //STATUS_NOT_FOUND;
    }


    PVOID ResolveRelativeAddress(_In_ PVOID Instruction, _In_ ULONG OffsetOffset, _In_ ULONG InstructionSize)
    {
        ULONG_PTR Instr = (ULONG_PTR)Instruction;
        LONG RipOffset = *(PLONG)(Instr + OffsetOffset);
        PVOID ResolvedAddr = (PVOID)(Instr + InstructionSize + RipOffset);

        return ResolvedAddr;
    }



    PVOID		getUserModuleBase(int processId)
    {
        wchar_t			moduleName[24];
        UNICODE_STRING	uModuleNmae;


        KAPC_STATE	apc;
        KeStackAttachProcess(Globals::userClient, &apc);

        wcscpy(moduleName, (wchar_t*)Globals::inBufAddress);

        KeUnstackDetachProcess(&apc);




        RtlInitUnicodeString(&uModuleNmae, moduleName);

        PEPROCESS	process;
        PsLookupProcessByProcessId((HANDLE)processId, &process);


        BOOLEAN		isWow64 = (PsGetProcessWow64Process(process) != NULL) ? TRUE : FALSE;

        KeStackAttachProcess(process, &apc);

        PVOID	moduleBase = Utils::GetUserModule(process, &uModuleNmae, isWow64);

        KeUnstackDetachProcess(&apc);



        return moduleBase;
    }

    
}
```

`kernel/x64/Release/kernel.Build.CppClean.log`:

```log
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\vc142.pdb
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\drver.obj
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel\kernel.cat
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel.sys
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel.pdb
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.inf
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel.inf
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\cl.command.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\cl.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\cl.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat-expand.12992.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat-expand.12992.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat-expand.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat-expand.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat.command.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\inf2cat.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\link.command.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\link.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\link.write.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\stampinf.command.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\stampinf.read.1.tlog
c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\kernel\x64\release\kernel.tlog\stampinf.write.1.tlog

```

`kernel/x64/Release/kernel.inf`:

```inf
;
; kernel.inf
;

[Version]
Signature="$WINDOWS NT$"
Class=Sample ; TODO: edit Class
ClassGuid={78A1C341-4539-11d3-B88D-00C04FAD5171} ; TODO: edit ClassGuid
Provider=%ManufacturerName%
CatalogFile=kernel.cat
DriverVer = 09/14/2020,23.10.8.220
PnpLockDown=1

[DestinationDirs]
DefaultDestDir = 12
kernel_Device_CoInstaller_CopyFiles = 11

; ================= Class section =====================

[ClassInstall32]
Addreg=SampleClassReg

[SampleClassReg]
HKR,,,0,%ClassName%
HKR,,Icon,,-5

[SourceDisksNames]
1 = %DiskName%,,,""

[SourceDisksFiles]
kernel.sys  = 1,,
;


;*****************************************
; Install Section
;*****************************************

[Manufacturer]
%ManufacturerName%=Standard,NTamd64

[Standard.NTamd64]
%kernel.DeviceDesc%=kernel_Device, Root\kernel ; TODO: edit hw-id

[kernel_Device.NT]
CopyFiles=Drivers_Dir

[Drivers_Dir]
kernel.sys

;-------------- Service installation
[kernel_Device.NT.Services]
AddService = kernel,%SPSVCINST_ASSOCSERVICE%, kernel_Service_Inst

; -------------- kernel driver install sections
[kernel_Service_Inst]
DisplayName    = %kernel.SVCDESC%
ServiceType    = 1               ; SERVICE_KERNEL_DRIVER
StartType      = 3               ; SERVICE_DEMAND_START
ErrorControl   = 1               ; SERVICE_ERROR_NORMAL
ServiceBinary  = %12%\kernel.sys

;
;--- kernel_Device Coinstaller installation ------
;

[kernel_Device.NT.CoInstallers]
AddReg=kernel_Device_CoInstaller_AddReg
CopyFiles=kernel_Device_CoInstaller_CopyFiles

[kernel_Device_CoInstaller_AddReg]
;


[kernel_Device_CoInstaller_CopyFiles]
;


[kernel_Device.NT.Wdf]
KmdfService =  kernel, kernel_wdfsect
[kernel_wdfsect]
KmdfLibraryVersion = 1.15

[Strings]
SPSVCINST_ASSOCSERVICE= 0x00000002
ManufacturerName="<Your manufacturer name>" ;TODO: Replace with your manufacturer name
ClassName="Samples" ; TODO: edit ClassName
DiskName = "kernel Installation Disk"
kernel.DeviceDesc = "kernel Device"
kernel.SVCDESC = "kernel Service"

```

`kernel/x64/Release/kernel.log`:

```log
  Building 'kernel' with toolset 'WindowsKernelModeDriver10.0' and the 'Universal' target platform.
  Stamping x64\Release\kernel.inf
  Stamping [Version] section with DriverVer=09/14/2020,23.10.8.220
  Drver.cpp
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\undocumented.h(17,1): warning C4005: 'STANDARD_RIGHTS_ALL': macro redefinition
C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\km\wdm.h(5230): message : see previous definition of 'STANDARD_RIGHTS_ALL'
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\utils.h(57,31): warning C4018: '<': signed/unsigned mismatch
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\utils.h(83,34): warning C4244: '=': conversion from 'ULONG64' to 'ULONG', possible loss of data
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\utils.h(96,22): warning C4244: '=': conversion from 'ULONG64' to 'ULONG', possible loss of data
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\KdmapperTraces.h(143,10): warning C4244: 'return': conversion from 'NTSTATUS' to 'BOOLEAN', possible loss of data
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\KdmapperTraces.h(153,31): warning C4459: declaration of 'DriverName' hides global declaration
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\KdmapperTraces.h(20,16): message : see declaration of 'DriverName'
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\KdmapperTraces.h(219,10): warning C4189: 'cleared': local variable is initialized but not referenced
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\KdmapperTraces.h(220,10): warning C4189: 'Filled': local variable is initialized but not referenced
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(65,57): warning C4244: 'argument': conversion from 'DWORD64' to 'int', possible loss of data
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(160,33): warning C4456: declaration of 'processId' hides previous local declaration
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(36,9): message : see declaration of 'processId'
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(160,31): warning C4244: 'initializing': conversion from 'DWORD64' to 'int', possible loss of data
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(211,75): warning C4100: 'RegistryPath': unreferenced formal parameter
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(211,40): warning C4100: 'DriverObject': unreferenced formal parameter
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(284,65): warning C4100: 'registry_path': unreferenced formal parameter
C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\kernel\Drver.cpp(284,37): warning C4100: 'driver_obj': unreferenced formal parameter
  kernel.vcxproj -> C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\x64\Release\kernel.sys
  Driver is 'Universal'.
  ........................
  Signability test complete.
  
  Errors:
  None
  
  Warnings:
  None
  
  Catalog generation complete.
  C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\x64\Release\kernel\kernel.cat

```

`kernel/x64/Release/kernel.tlog/CL.command.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\DRVER.CPP
/c /IX64\RELEASE\ /Zi /nologo /W4 /WX- /diagnostics:column /Ox /Os /Oy- /D _WIN64 /D _AMD64_ /D AMD64 /D _WIN32_WINNT=0x0A00 /D WINVER=0x0A00 /D WINNT=1 /D NTDDI_VERSION=0x0A000008 /D KMDF_VERSION_MAJOR=1 /D KMDF_VERSION_MINOR=15 /GF /Gm- /Zp8 /GS- /guard:cf /Gy /fp:precise /Qspectre /Zc:wchar_t- /Zc:forScope /Zc:inline /GR- /Fo"X64\RELEASE\\" /Fd"X64\RELEASE\VC142.PDB" /Gz /wd4603 /wd4627 /wd4986 /wd4987 /FI"C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WARNING.H" /FC /kernel -cbstring -d2epilogunwind  /d1nodatetime /d1import_no_registry /d2AllowCompatibleILVersions /d2Zi+  C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\DRVER.CPP

```

`kernel/x64/Release/kernel.tlog/CL.read.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\DRVER.CPP
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS
C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\VC\TOOLS\MSVC\14.26.28801\BIN\HOSTX86\X64\1033\CLUI.DLL
C:\WINDOWS\SYSTEM32\TZRES.DLL
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WARNING.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SUPPRESS.H
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\KDMAPPERTRACES.H
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\UTILS.H
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\UNDOCUMENTED.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\NTDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\CTYPE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\CRTDEFS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SPECSTRINGS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SAL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\CONCURRENCYSAL.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SPECSTRINGS_STRICT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SPECSTRINGS_UNDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\DRIVERSPECS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SDV_DRIVERSPECS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\VADEFS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINAPIFAMILY.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINPACKAGEFAMILY.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\KERNELSPECS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\BASETSD.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\GUIDDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\STRING.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\EXCPT.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\SDKDDKVER.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\NTIFS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\NTDDK.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\WDM.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\NTSTATUS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\BUGCODES.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\NTIOLOGC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\MCE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\PSHPACK4.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\POPPACK.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\PSHPACK1.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\DPFILTER.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\APISET.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\KTMTYPES.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\EVNTPROV.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\DEVPROPDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\NTNLS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\WINDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\SHARED\MINWINDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\NTSTRSAFE.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\STDIO.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\SWPRINTF.INL
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\STDARG.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\INTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\SETJMP.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\STDDEF.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\IMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\WMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\NMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\SMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\TMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\PMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\EMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\XMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\MMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\MALLOC.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\LIMITS.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\ZMMINTRIN.H
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\INCLUDE\10.0.19041.0\KM\CRT\AMMINTRIN.H

```

`kernel/x64/Release/kernel.tlog/CL.write.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\DRVER.CPP
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\VC142.PDB
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\DRVER.OBJ

```

`kernel/x64/Release/kernel.tlog/Inf2Cat.command.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\
/os:10_x64 /driver:C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\x64\Release\kernel\ /driver: /os:10_x64 C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\

```

`kernel/x64/Release/kernel.tlog/inf2cat-expand.3940.read.1.tlog`:

```tlog
#Command: "C:\Windows\system32\expand.exe" "c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel\kernel.sys" "C:\Users\jguo5\AppData\Local\Temp\WST\ed5428c3-d866-49ef-b836-975364786d1d\001"
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\KERNEL.SYS
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS

```

`kernel/x64/Release/kernel.tlog/inf2cat-expand.3940.write.1.tlog`:

```tlog
#Command: "C:\Windows\system32\expand.exe" "c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel\kernel.sys" "C:\Users\jguo5\AppData\Local\Temp\WST\ed5428c3-d866-49ef-b836-975364786d1d\001"
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\

```

`kernel/x64/Release/kernel.tlog/inf2cat-expand.read.1.tlog`:

```tlog
#Command: "C:\Windows\system32\expand.exe" "c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel\kernel.inf" "C:\Users\jguo5\AppData\Local\Temp\WST\ed5428c3-d866-49ef-b836-975364786d1d\000"
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\KERNEL.INF
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS

```

`kernel/x64/Release/kernel.tlog/inf2cat-expand.write.1.tlog`:

```tlog
#Command: "C:\Windows\system32\expand.exe" "c:\users\jguo5\source\repos\ntcomparesigninglevels-hook\x64\release\kernel\kernel.inf" "C:\Users\jguo5\AppData\Local\Temp\WST\ed5428c3-d866-49ef-b836-975364786d1d\000"
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\

```

`kernel/x64/Release/kernel.tlog/inf2cat.read.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\
C:\WINDOWS\MICROSOFT.NET\FRAMEWORK64\V2.0.50727\MSCORWKS.DLL
C:\WINDOWS\MICROSOFT.NET\FRAMEWORK64\V4.0.30319\CLR.DLL
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\BIN\10.0.19041.0\X86\INF2CAT.EXE
C:\WINDOWS\MICROSOFT.NET\FRAMEWORK64\V4.0.30319\CONFIG\MACHINE.CONFIG
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS
C:\WINDOWS\ASSEMBLY\NATIVEIMAGES_V4.0.30319_64\MSCORLIB\8B0445CE5A447AD49F5D2104153DDBD4\MSCORLIB.NI.DLL.AUX
C:\WINDOWS\ASSEMBLY\PUBPOL1.DAT
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\BIN\10.0.19041.0\X86\MICROSOFT.UNIVERSALSTORE.HARDWAREWORKFLOW.SUBMISSIONBUILDER.DLL
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\BIN\10.0.19041.0\X86\MICROSOFT.UNIVERSALSTORE.HARDWAREWORKFLOW.CATALOGS.DLL
C:\WINDOWS\ASSEMBLY\NATIVEIMAGES_V4.0.30319_64\SYSTEM\692CEE7F35BC369DF5D159F8C5627C5D\SYSTEM.NI.DLL.AUX
C:\WINDOWS\ASSEMBLY\NATIVEIMAGES_V4.0.30319_64\SYSTEM.CORE\C93AFFB73B44FEA7FCB1A88839FBC9AF\SYSTEM.CORE.NI.DLL.AUX
C:\WINDOWS\ASSEMBLY\NATIVEIMAGES_V4.0.30319_64\SYSTEM.XML\BC239FFF46A8F02F99383A032EE436D1\SYSTEM.XML.NI.DLL.AUX
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\BIN\10.0.19041.0\X86\MICROSOFT.UNIVERSALSTORE.HARDWAREWORKFLOW.CABINETS.DLL
C:\WINDOWS\ASSEMBLY\NATIVEIMAGES_V4.0.30319_64\WINDOWSBASE\962C5A5503E5C7C3D703860A42175FB9\WINDOWSBASE.NI.DLL.AUX
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\BIN\10.0.19041.0\X86\MICROSOFT.UNIVERSALSTORE.HARDWAREWORKFLOW.INFREADER.DLL
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\KERNEL.INF
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\BIN\10.0.19041.0\X86\WINDOWSPROTECTEDFILES.XML
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\KERNEL.CAT

```

`kernel/x64/Release/kernel.tlog/inf2cat.write.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL\KERNEL.CAT

```

`kernel/x64/Release/kernel.tlog/kernel.lastbuildstate`:

```lastbuildstate
PlatformToolSet=WindowsKernelModeDriver10.0:VCToolArchitecture=Native32Bit:VCToolsVersion=14.26.28801:TargetPlatformVersion=10.0.19041.0:
Release|x64|C:\Users\jguo5\source\repos\NtCompareSigningLevels-hook\|

```

`kernel/x64/Release/kernel.tlog/link.command.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\DRVER.OBJ
/OUT:"C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL.SYS" /VERSION:"10.0" /INCREMENTAL:NO /NOLOGO /WX /SECTION:"INIT,d" "C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\BUFFEROVERFLOWFASTFAILK.LIB" "C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\NTOSKRNL.LIB" "C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\HAL.LIB" "C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\WMILIB.LIB" "C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\WDF\KMDF\X64\1.15\WDFLDR.LIB" "C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\WDF\KMDF\X64\1.15\WDFDRIVERENTRY.LIB" /NODEFAULTLIB /MANIFEST:NO /DEBUG /PDB:"C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL.PDB" /SUBSYSTEM:NATIVE,"10.00" /Driver /OPT:REF /OPT:ICF /ENTRY:"mapperEntry" /RELEASE /IMPLIB:"C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL.LIB" /MERGE:"_TEXT=.text;_PAGE=PAGE" /MACHINE:X64 /PROFILE /guard:cf /kernel /IGNORE:4198,4010,4037,4039,4065,4070,4078,4087,4089,4221,4108,4088,4218,4218,4235 /osversion:10.0 /pdbcompress /debugtype:pdata X64\RELEASE\DRVER.OBJ

```

`kernel/x64/Release/kernel.tlog/link.read.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\DRVER.OBJ
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\BUFFEROVERFLOWFASTFAILK.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\NTOSKRNL.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\HAL.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\10.0.19041.0\KM\X64\WMILIB.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\WDF\KMDF\X64\1.15\WDFLDR.LIB
C:\PROGRAM FILES (X86)\WINDOWS KITS\10\LIB\WDF\KMDF\X64\1.15\WDFDRIVERENTRY.LIB
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\DRVER.OBJ
C:\WINDOWS\GLOBALIZATION\SORTING\SORTDEFAULT.NLS
C:\WINDOWS\SYSTEM32\TZRES.DLL

```

`kernel/x64/Release/kernel.tlog/link.write.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\DRVER.OBJ
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL.SYS
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\X64\RELEASE\KERNEL.PDB

```

`kernel/x64/Release/kernel.tlog/stampinf.command.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\KERNEL.INF
-d "*" -a "amd64" -v "*" -k "1.15"  -x -f x64\Release\kernel.inf -d "*" -a "amd64" -v "*" -k "1.15"  -x C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\KERNEL.INF

```

`kernel/x64/Release/kernel.tlog/stampinf.read.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\KERNEL.INF
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\KERNEL.INF

```

`kernel/x64/Release/kernel.tlog/stampinf.write.1.tlog`:

```tlog
^C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\KERNEL.INF
C:\USERS\JGUO5\SOURCE\REPOS\NTCOMPARESIGNINGLEVELS-HOOK\KERNEL\X64\RELEASE\KERNEL.INF

```