Directory structure:
└── wazuh-wazuh/
    ├── README.md
    ├── BUGS
    ├── CONFIG
    ├── CONTRIBUTORS
    ├── INSTALL
    ├── install.sh
    ├── LICENSE
    ├── SECURITY.md
    ├── upgrade.sh
    ├── VERSION.json
    ├── .clang-format
    ├── .clang-tidy
    ├── api/
    │   ├── Makefile
    │   ├── setup.py
    │   ├── api/
    │   │   ├── __init__.py
    │   │   ├── alogging.py
    │   │   ├── api_exception.py
    │   │   ├── authentication.py
    │   │   ├── configuration.py
    │   │   ├── constants.py
    │   │   ├── encoder.py
    │   │   ├── error_handler.py
    │   │   ├── middlewares.py
    │   │   ├── pytest.ini
    │   │   ├── signals.py
    │   │   ├── uri_parser.py
    │   │   ├── util.py
    │   │   ├── validator.py
    │   │   ├── configuration/
    │   │   │   └── api.yaml
    │   │   ├── controllers/
    │   │   │   ├── __init__.py
    │   │   │   ├── active_response_controller.py
    │   │   │   ├── agent_controller.py
    │   │   │   ├── cluster_controller.py
    │   │   │   ├── default_controller.py
    │   │   │   ├── event_controller.py
    │   │   │   ├── mitre_controller.py
    │   │   │   ├── overview_controller.py
    │   │   │   ├── rootcheck_controller.py
    │   │   │   ├── security_controller.py
    │   │   │   ├── syscheck_controller.py
    │   │   │   ├── task_controller.py
    │   │   │   ├── util.py
    │   │   │   └── test/
    │   │   │       ├── conftest.py
    │   │   │       ├── test_active_response_controller.py
    │   │   │       ├── test_agent_controller.py
    │   │   │       ├── test_cluster_controller.py
    │   │   │       ├── test_controller_util.py
    │   │   │       ├── test_default_controller.py
    │   │   │       ├── test_event_controller.py
    │   │   │       ├── test_mitre_controller.py
    │   │   │       ├── test_overview_controller.py
    │   │   │       ├── test_rootcheck_controller.py
    │   │   │       ├── test_security_controller.py
    │   │   │       ├── test_syscheck_controller.py
    │   │   │       ├── test_task_controller.py
    │   │   │       └── utils.py
    │   │   ├── models/
    │   │   │   ├── __init__.py
    │   │   │   ├── active_response_model.py
    │   │   │   ├── agent_added_model.py
    │   │   │   ├── agent_group_added_model.py
    │   │   │   ├── agent_inserted_model.py
    │   │   │   ├── base_model_.py
    │   │   │   ├── basic_info_model.py
    │   │   │   ├── configuration_model.py
    │   │   │   ├── event_ingest_model.py
    │   │   │   ├── security_model.py
    │   │   │   ├── security_token_response_model.py
    │   │   │   └── test/
    │   │   │       └── test_model.py
    │   │   └── test/
    │   │       ├── test_alogging.py
    │   │       ├── test_authentication.py
    │   │       ├── test_configuration.py
    │   │       ├── test_encoder.py
    │   │       ├── test_error_handler.py
    │   │       ├── test_middlewares.py
    │   │       ├── test_signals.py
    │   │       ├── test_uri_parser.py
    │   │       ├── test_util.py
    │   │       ├── test_validator.py
    │   │       └── data/
    │   │           ├── test_xml_1.xml
    │   │           ├── test_xml_2.xml
    │   │           ├── test_xml_ko_1.xml
    │   │           └── test_xml_ko_2.xml
    │   ├── scripts/
    │   │   └── wazuh_manager_apid.py
    │   ├── service/
    │   │   └── inst-api-functions.sh
    │   ├── test/
    │   │   ├── __init__.py
    │   │   └── integration/
    │   │       ├── README.md
    │   │       ├── common.yaml
    │   │       ├── conftest.py
    │   │       ├── pytest.ini
    │   │       ├── run_tests.py
    │   │       ├── tavern_utils.py
    │   │       ├── test_active_response_endpoints.tavern.yaml
    │   │       ├── test_agent_DELETE_endpoints.tavern.yaml
    │   │       ├── test_agent_GET_endpoints.tavern.yaml
    │   │       ├── test_agent_POST_endpoints.tavern.yaml
    │   │       ├── test_agent_PUT_endpoints.tavern.yaml
    │   │       ├── test_cluster_endpoints.tavern.yaml
    │   │       ├── test_default_endpoints.tavern.yaml
    │   │       ├── test_event_endpoints.tavern.yaml
    │   │       ├── test_mitre_endpoints.tavern.yaml
    │   │       ├── test_overview_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_active_response_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_agent_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_cluster_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_event_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_mitre_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_overview_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_rootcheck_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_security_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_syscheck_endpoints.tavern.yaml
    │   │       ├── test_rbac_black_task_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_active_response_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_agent_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_all_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_cluster_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_event_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_mitre_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_overview_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_rootcheck_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_security_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_syscheck_endpoints.tavern.yaml
    │   │       ├── test_rbac_white_task_endpoints.tavern.yaml
    │   │       ├── test_rootcheck_endpoints.tavern.yaml
    │   │       ├── test_security_DELETE_endpoints.tavern.yaml
    │   │       ├── test_security_GET_endpoints.tavern.yaml
    │   │       ├── test_security_POST_endpoints.tavern.yaml
    │   │       ├── test_security_PUT_endpoints.tavern.yaml
    │   │       ├── test_syscheck_endpoints.tavern.yaml
    │   │       ├── test_task_endpoints.tavern.yaml
    │   │       └── mapping/
    │   │           ├── README.md
    │   │           ├── _test_mapping.py
    │   │           └── integration_test_api_endpoints.json
    │   └── wrappers/
    │       └── generic_wrapper.sh
    ├── architecture/
    │   ├── centralized_configuration/
    │   │   ├── Readme.md
    │   │   └── 001-sequence.puml
    │   ├── data_provider/
    │   │   ├── Readme.md
    │   │   └── 001-sequence-windows-store-packages-info.puml
    │   ├── dbsync/
    │   │   └── 001-sequence-initialization-with-persistence.puml
    │   ├── FIM/
    │   │   └── db/
    │   │       ├── 001-class-testtool.puml
    │   │       ├── 002-sequence-testtool.puml
    │   │       ├── class.puml
    │   │       ├── ER-diagram.puml
    │   │       └── sequence_diagram.puml
    │   ├── metrics/
    │   │   ├── Readme.md
    │   │   ├── 001-remoted-received.puml
    │   │   ├── 002-remoted-send.puml
    │   │   ├── 003-analysisd-received.puml
    │   │   ├── 004-analysisd-received-localfile.puml
    │   │   └── 005-analysisd-written.puml
    │   ├── router-pubsub/
    │   │   ├── Readme.md
    │   │   ├── 001-sequence-initialize.puml
    │   │   ├── 002-sequence-publisher.puml
    │   │   └── 003-sequence-subscriber.puml
    │   ├── syscollector/
    │   │   ├── Readme.md
    │   │   ├── 001-sequence-wm-syscollector.puml
    │   │   ├── 002-sequence-syscollector.puml
    │   │   └── 003-sequence-manager-side.puml
    │   ├── vulnerability-scanner/
    │   │   └── policyManager/
    │   │       └── 001-sequence-config-validation.puml
    │   ├── wazuh-db/
    │   │   ├── Readme.md
    │   │   └── 001-vacuum.puml
    │   ├── wm_azure/
    │   │   ├── Readme.md
    │   │   └── 001-sequence.puml
    │   ├── wm_gcp/
    │   │   ├── Readme.md
    │   │   └── 001-sequence.puml
    │   ├── wm_github/
    │   │   ├── Readme.md
    │   │   ├── 001-sequence.puml
    │   │   └── 002-sequence-scan-block.puml
    │   ├── wm_office365/
    │   │   ├── Readme.md
    │   │   ├── 001-sequence.puml
    │   │   └── 002-sequence-scan-block.puml
    │   └── wm_sca/
    │       ├── Readme.md
    │       └── 001-sequence.puml
    ├── comments/
    │   └── 34352.md
    ├── docs/
    │   ├── README.md
    │   ├── book.toml
    │   ├── build.sh
    │   ├── server.sh
    │   ├── SUMMARY.md
    │   ├── dev/
    │   │   ├── build-sources.md
    │   │   ├── package-generation.md
    │   │   ├── run-sources.md
    │   │   ├── setup.md
    │   │   └── test-execution.md
    │   ├── js/
    │   │   └── mermaid-init.js
    │   └── ref/
    │       ├── README.md
    │       ├── architecture.md
    │       ├── backup-restore.md
    │       ├── compatibility.md
    │       ├── configuration.md
    │       ├── description.md
    │       ├── glossary.md
    │       ├── performance.md
    │       ├── security.md
    │       ├── uninstall.md
    │       ├── upgrade.md
    │       ├── getting-started/
    │       │   ├── README.md
    │       │   ├── installation.md
    │       │   ├── packages.md
    │       │   └── requirements.md
    │       └── modules/
    │           ├── README.md
    │           ├── agent_info/
    │           │   ├── README.md
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   └── database-schema.md
    │           ├── cluster/
    │           │   ├── README.md
    │           │   └── lb.md
    │           ├── control/
    │           │   ├── README.md
    │           │   └── architecture.md
    │           ├── engine/
    │           │   ├── README.md
    │           │   ├── api-events-reference.html
    │           │   ├── api-events-reference.md
    │           │   ├── api-reference.html
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── internal-tools.md
    │           │   ├── ref-output.md
    │           │   ├── ref-parser.md
    │           │   ├── spec-events.yaml
    │           │   └── spec.yaml
    │           ├── fim/
    │           │   ├── README.md
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   ├── database-schema.md
    │           │   └── windows-registry-monitoring.md
    │           ├── inventory-sync/
    │           │   ├── README.md
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   ├── flatbuffers.md
    │           │   └── test-tools.md
    │           ├── logcollector/
    │           │   ├── README.md
    │           │   └── configuration.md
    │           ├── rbac/
    │           │   └── README.md
    │           ├── remoted/
    │           │   ├── README.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   ├── event-protocol.md
    │           │   ├── quick-reference.md
    │           │   └── stateless-metadata.md
    │           ├── rootcheck/
    │           │   ├── README.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   └── output-samples.md
    │           ├── sca/
    │           │   ├── README.md
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   ├── custom-policies.md
    │           │   ├── database-schema.md
    │           │   └── output-samples.md
    │           ├── server-api/
    │           │   ├── README.md
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── authentication.md
    │           │   ├── configuration.md
    │           │   └── testing.md
    │           ├── syscollector/
    │           │   ├── README.md
    │           │   ├── api-reference.md
    │           │   ├── architecture.md
    │           │   ├── configuration.md
    │           │   ├── database-schema.md
    │           │   └── events.md
    │           ├── utils/
    │           │   ├── flatbuffers/
    │           │   │   └── README.md
    │           │   ├── schema-validator/
    │           │   │   ├── README.md
    │           │   │   ├── api-reference.md
    │           │   │   └── integration-guide.md
    │           │   └── sync-protocol/
    │           │       ├── README.md
    │           │       ├── api-reference.md
    │           │       ├── integration-guide.md
    │           │       ├── lifecycle.md
    │           │       ├── persistence-performance.md
    │           │       └── sequence-diagrams.md
    │           └── vulnerability-scanner/
    │               ├── README.md
    │               ├── api-reference.md
    │               ├── architecture.md
    │               ├── configuration.md
    │               ├── events.md
    │               ├── flatbuffers.md
    │               └── test-tools.md
    ├── etc/
    │   ├── agent.conf
    │   ├── internal_options.conf
    │   ├── local_internal_options-win.conf
    │   ├── local_internal_options.conf
    │   ├── ossec-agent.conf
    │   ├── ossec-local.conf
    │   ├── ossec-server.conf
    │   ├── preloaded-vars.conf
    │   ├── wazuh-manager.conf
    │   ├── wpk_root.pem
    │   └── templates/
    │       ├── br/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── cn/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── config/
    │       │   ├── README.md
    │       │   ├── almalinux/
    │       │   │   ├── sca.files
    │       │   │   ├── 10/
    │       │   │   │   └── sca.files
    │       │   │   ├── 8/
    │       │   │   │   └── sca.files
    │       │   │   └── 9/
    │       │   │       └── sca.files
    │       │   ├── alpine/
    │       │   │   └── rootcheck.agent.template
    │       │   ├── amzn/
    │       │   │   ├── 1/
    │       │   │   │   └── sca.files
    │       │   │   ├── 2/
    │       │   │   │   └── sca.files
    │       │   │   └── 2023/
    │       │   │       └── sca.files
    │       │   ├── bsd/
    │       │   │   ├── localfile-commands.template
    │       │   │   └── wodle-syscollector.template
    │       │   ├── centos/
    │       │   │   ├── rootcheck.agent.template
    │       │   │   ├── rootcheck.manager.template
    │       │   │   ├── sca.files
    │       │   │   ├── 10/
    │       │   │   │   └── sca.files
    │       │   │   ├── 6/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 7/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 8/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   └── 9/
    │       │   │       └── sca.files
    │       │   ├── darwin/
    │       │   │   ├── localfile-commands.template
    │       │   │   ├── localfile-extra.template
    │       │   │   ├── sca.files
    │       │   │   ├── sca.template
    │       │   │   ├── syscheck.agent.template
    │       │   │   ├── syscheck.manager.template
    │       │   │   ├── wodle-syscollector.template
    │       │   │   ├── 15/
    │       │   │   │   ├── localfile-extra.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 16/
    │       │   │   │   └── sca.files
    │       │   │   ├── 17/
    │       │   │   │   └── sca.files
    │       │   │   ├── 18/
    │       │   │   │   └── sca.files
    │       │   │   ├── 19/
    │       │   │   │   └── sca.files
    │       │   │   ├── 20/
    │       │   │   │   └── sca.files
    │       │   │   ├── 21/
    │       │   │   │   └── sca.files
    │       │   │   ├── 22/
    │       │   │   │   └── sca.files
    │       │   │   ├── 23/
    │       │   │   │   └── sca.files
    │       │   │   ├── 24/
    │       │   │   │   └── sca.files
    │       │   │   └── 25/
    │       │   │       └── sca.files
    │       │   ├── debian/
    │       │   │   ├── rootcheck.agent.template
    │       │   │   ├── rootcheck.manager.template
    │       │   │   ├── sca.files
    │       │   │   ├── 10/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 11/
    │       │   │   │   └── sca.files
    │       │   │   ├── 12/
    │       │   │   │   └── sca.files
    │       │   │   ├── 13/
    │       │   │   │   └── sca.files
    │       │   │   ├── 7/
    │       │   │   │   └── sca.files
    │       │   │   ├── 8/
    │       │   │   │   └── sca.files
    │       │   │   └── 9/
    │       │   │       └── sca.files
    │       │   ├── fedora/
    │       │   │   ├── rootcheck.agent.template
    │       │   │   ├── rootcheck.manager.template
    │       │   │   ├── sca.files
    │       │   │   ├── 29/
    │       │   │   │   └── sca.files
    │       │   │   ├── 30/
    │       │   │   │   └── sca.files
    │       │   │   ├── 31/
    │       │   │   │   └── sca.files
    │       │   │   ├── 32/
    │       │   │   │   └── sca.files
    │       │   │   ├── 33/
    │       │   │   │   └── sca.files
    │       │   │   ├── 34/
    │       │   │   │   └── sca.files
    │       │   │   └── 41/
    │       │   │       └── sca.files
    │       │   ├── generic/
    │       │   │   ├── agent-upgrade.manager.template
    │       │   │   ├── ar-commands.template
    │       │   │   ├── ar-definitions.template
    │       │   │   ├── auth.template
    │       │   │   ├── cluster.template
    │       │   │   ├── global-ar.template
    │       │   │   ├── global.template
    │       │   │   ├── header-comments.template
    │       │   │   ├── localfile-commands.template
    │       │   │   ├── logging.template
    │       │   │   ├── remote-secure.template
    │       │   │   ├── rootcheck.agent.template
    │       │   │   ├── rootcheck.manager.template
    │       │   │   ├── sca.files
    │       │   │   ├── sca.manager.files
    │       │   │   ├── sca.template
    │       │   │   ├── syscheck.agent.template
    │       │   │   ├── syscheck.manager.template
    │       │   │   ├── wodle-indexer.manager.template
    │       │   │   ├── wodle-syscollector.template
    │       │   │   ├── wodle-vulnerability-detection.manager.template
    │       │   │   └── localfile-logs/
    │       │   │       ├── apache-logs.template
    │       │   │       ├── audit-logs.template
    │       │   │       ├── ossec-logs.template
    │       │   │       ├── pgsql-logs.template
    │       │   │       ├── snort-logs.template
    │       │   │       └── syslog-logs.template
    │       │   ├── ol/
    │       │   │   ├── 10/
    │       │   │   │   └── sca.files
    │       │   │   └── 9/
    │       │   │       └── sca.files
    │       │   ├── rhel/
    │       │   │   ├── rootcheck.agent.template
    │       │   │   ├── rootcheck.manager.template
    │       │   │   ├── sca.files
    │       │   │   ├── 10/
    │       │   │   │   └── sca.files
    │       │   │   ├── 6/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 7/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 8/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   └── 9/
    │       │   │       ├── rootcheck.agent.template
    │       │   │       ├── rootcheck.manager.template
    │       │   │       └── sca.files
    │       │   ├── rocky/
    │       │   │   ├── sca.files
    │       │   │   ├── 10/
    │       │   │   │   └── sca.files
    │       │   │   ├── 8/
    │       │   │   │   └── sca.files
    │       │   │   └── 9/
    │       │   │       └── sca.files
    │       │   ├── sles/
    │       │   │   ├── sca.files
    │       │   │   ├── 12/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   ├── 15/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   └── 16/
    │       │   │       ├── rootcheck.agent.template
    │       │   │       ├── rootcheck.manager.template
    │       │   │       └── sca.files
    │       │   ├── suse/
    │       │   │   ├── sca.files
    │       │   │   ├── 12/
    │       │   │   │   ├── rootcheck.agent.template
    │       │   │   │   ├── rootcheck.manager.template
    │       │   │   │   └── sca.files
    │       │   │   └── 15/
    │       │   │       ├── rootcheck.agent.template
    │       │   │       ├── rootcheck.manager.template
    │       │   │       └── sca.files
    │       │   ├── ubuntu/
    │       │   │   ├── rootcheck.agent.template
    │       │   │   ├── rootcheck.manager.template
    │       │   │   ├── sca.files
    │       │   │   ├── 12/
    │       │   │   │   └── 04/
    │       │   │   │       └── sca.files
    │       │   │   ├── 14/
    │       │   │   │   └── 04/
    │       │   │   │       └── sca.files
    │       │   │   ├── 16/
    │       │   │   │   └── 04/
    │       │   │   │       └── sca.files
    │       │   │   ├── 18/
    │       │   │   │   └── 04/
    │       │   │   │       └── sca.files
    │       │   │   ├── 20/
    │       │   │   │   └── 04/
    │       │   │   │       └── sca.files
    │       │   │   ├── 22/
    │       │   │   │   └── 04/
    │       │   │   │       └── sca.files
    │       │   │   └── 24/
    │       │   │       └── 04/
    │       │   │           └── sca.files
    │       │   └── windows/
    │       │       ├── 10/
    │       │       │   └── profile.template
    │       │       ├── 2008/
    │       │       │   └── profile.template
    │       │       ├── 2008R2/
    │       │       │   └── profile.template
    │       │       ├── 2012/
    │       │       │   └── profile.template
    │       │       ├── 2012R2/
    │       │       │   └── profile.template
    │       │       ├── 2016/
    │       │       │   └── profile.template
    │       │       ├── 2019/
    │       │       │   └── profile.template
    │       │       ├── 7/
    │       │       │   └── profile.template
    │       │       ├── 8/
    │       │       │   └── profile.template
    │       │       └── 8.1/
    │       │           └── profile.template
    │       ├── de/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── el/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── en/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── es/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── fr/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── hu/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── it/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── jp/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── nl/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── pl/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── ru/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       ├── sr/
    │       │   ├── language.txt
    │       │   ├── messages.txt
    │       │   ├── errors/
    │       │   │   ├── 0x1-location.txt
    │       │   │   ├── 0x2-beroot.txt
    │       │   │   ├── 0x3-dependencies.txt
    │       │   │   ├── 0x4-installtype.txt
    │       │   │   └── 0x5-build.txt
    │       │   └── messages/
    │       │       ├── 0x101-initial.txt
    │       │       ├── 0x102-installhelp.txt
    │       │       ├── 0x103-thanksforusing.txt
    │       │       ├── 0x105-noboot.txt
    │       │       ├── 0x106-logs.txt
    │       │       ├── 0x107-ar.txt
    │       │       ├── 0x108-ar-enabled.txt
    │       │       └── 0x109-castore.txt
    │       └── tr/
    │           ├── language.txt
    │           ├── messages.txt
    │           ├── errors/
    │           │   ├── 0x1-location.txt
    │           │   ├── 0x2-beroot.txt
    │           │   ├── 0x3-dependencies.txt
    │           │   ├── 0x4-installtype.txt
    │           │   └── 0x5-build.txt
    │           └── messages/
    │               ├── 0x101-initial.txt
    │               ├── 0x102-installhelp.txt
    │               ├── 0x103-thanksforusing.txt
    │               ├── 0x105-noboot.txt
    │               ├── 0x106-logs.txt
    │               ├── 0x107-ar.txt
    │               ├── 0x108-ar-enabled.txt
    │               └── 0x109-castore.txt
    ├── framework/
    │   ├── __init__.py
    │   ├── Makefile
    │   ├── pytest.ini
    │   ├── requirements-dev.txt
    │   ├── requirements-wodles-dev.txt
    │   ├── requirements-wodles.txt
    │   ├── requirements.txt
    │   ├── setup.py
    │   ├── .python-version
    │   ├── cpython/
    │   │   ├── README.md
    │   │   ├── compile.sh
    │   │   ├── generate-cpython.sh
    │   │   └── custom/
    │   │       ├── Setup.local
    │   │       └── Setup.stdlib.in
    │   ├── examples/
    │   │   └── get_agents.py
    │   ├── scripts/
    │   │   ├── __init__.py
    │   │   ├── agent_groups.py
    │   │   ├── agent_upgrade.py
    │   │   ├── cluster_control.py
    │   │   ├── rbac_control.py
    │   │   ├── wazuh_manager_clusterd.py
    │   │   └── tests/
    │   │       ├── test_agent_groups.py
    │   │       ├── test_agent_upgrade.py
    │   │       ├── test_cluster_control.py
    │   │       ├── test_rbac_control.py
    │   │       └── test_wazuh_manager_clusterd.py
    │   ├── wazuh/
    │   │   ├── __init__.py
    │   │   ├── __main__.py
    │   │   ├── active_response.py
    │   │   ├── agent.py
    │   │   ├── cluster.py
    │   │   ├── event.py
    │   │   ├── manager.py
    │   │   ├── mitre.py
    │   │   ├── rootcheck.py
    │   │   ├── security.py
    │   │   ├── stats.py
    │   │   ├── syscheck.py
    │   │   ├── task.py
    │   │   ├── core/
    │   │   │   ├── __init__.py
    │   │   │   ├── active_response.py
    │   │   │   ├── agent.py
    │   │   │   ├── common.py
    │   │   │   ├── configuration.py
    │   │   │   ├── exception.py
    │   │   │   ├── InputValidator.py
    │   │   │   ├── manager.py
    │   │   │   ├── mitre.py
    │   │   │   ├── pyDaemonModule.py
    │   │   │   ├── results.py
    │   │   │   ├── security.py
    │   │   │   ├── stats.py
    │   │   │   ├── task.py
    │   │   │   ├── utils.py
    │   │   │   ├── wazuh_queue.py
    │   │   │   ├── wazuh_socket.py
    │   │   │   ├── wdb.py
    │   │   │   ├── wdb_http.py
    │   │   │   ├── wlogging.py
    │   │   │   ├── cluster/
    │   │   │   │   ├── __init__.py
    │   │   │   │   ├── client.py
    │   │   │   │   ├── cluster.json
    │   │   │   │   ├── cluster.py
    │   │   │   │   ├── common.py
    │   │   │   │   ├── control.py
    │   │   │   │   ├── local_client.py
    │   │   │   │   ├── local_server.py
    │   │   │   │   ├── master.py
    │   │   │   │   ├── server.py
    │   │   │   │   ├── utils.py
    │   │   │   │   ├── worker.py
    │   │   │   │   ├── dapi/
    │   │   │   │   │   ├── __init__.py
    │   │   │   │   │   ├── dapi.py
    │   │   │   │   │   └── tests/
    │   │   │   │   │       └── test_dapi.py
    │   │   │   │   ├── hap_helper/
    │   │   │   │   │   ├── __init__.py
    │   │   │   │   │   ├── hap_helper.py
    │   │   │   │   │   ├── proxy.py
    │   │   │   │   │   ├── wazuh.py
    │   │   │   │   │   └── tests/
    │   │   │   │   │       ├── __init__.py
    │   │   │   │   │       ├── test_hap_helper.py
    │   │   │   │   │       ├── test_proxy.py
    │   │   │   │   │       └── test_wazuh.py
    │   │   │   │   └── tests/
    │   │   │   │       ├── __init__.py
    │   │   │   │       ├── conftest.py
    │   │   │   │       ├── test_client.py
    │   │   │   │       ├── test_cluster.py
    │   │   │   │       ├── test_cluster_name_sync.py
    │   │   │   │       ├── test_cluster_name_sync_integration.py
    │   │   │   │       ├── test_common.py
    │   │   │   │       ├── test_control.py
    │   │   │   │       ├── test_disconnected_agents_sync.py
    │   │   │   │       ├── test_local_client.py
    │   │   │   │       ├── test_local_server.py
    │   │   │   │       ├── test_master.py
    │   │   │   │       ├── test_server.py
    │   │   │   │       ├── test_utils.py
    │   │   │   │       ├── test_worker.py
    │   │   │   │       └── data/
    │   │   │   │           └── ruleset/
    │   │   │   │               └── VERSION
    │   │   │   ├── indexer/
    │   │   │   │   ├── base.py
    │   │   │   │   ├── credential_manager.py
    │   │   │   │   ├── disconnected_agents.py
    │   │   │   │   ├── indexer.py
    │   │   │   │   ├── max_version_components.py
    │   │   │   │   └── tests/
    │   │   │   │       ├── test_credential_manager.py
    │   │   │   │       ├── test_max_version_cluster_name.py
    │   │   │   │       └── test_max_version_cluster_name_simple.py
    │   │   │   └── tests/
    │   │   │       ├── __init__.py
    │   │   │       ├── test_active_response.py
    │   │   │       ├── test_agent.py
    │   │   │       ├── test_common.py
    │   │   │       ├── test_configuration.py
    │   │   │       ├── test_exception.py
    │   │   │       ├── test_input_validator.py
    │   │   │       ├── test_manager.py
    │   │   │       ├── test_mitre.py
    │   │   │       ├── test_pyDaemonModule.py
    │   │   │       ├── test_results.py
    │   │   │       ├── test_security.py
    │   │   │       ├── test_stats.py
    │   │   │       ├── test_task.py
    │   │   │       ├── test_utils.py
    │   │   │       ├── test_wazuh_queue.py
    │   │   │       ├── test_wazuh_socket.py
    │   │   │       ├── test_wdb.py
    │   │   │       ├── test_wdb_http.py
    │   │   │       ├── test_wlogging.py
    │   │   │       └── data/
    │   │   │           ├── configuration/
    │   │   │           │   ├── ar.conf
    │   │   │           │   ├── local_internal_options.conf
    │   │   │           │   ├── trojan.txt
    │   │   │           │   ├── wazuh-manager.conf
    │   │   │           │   ├── default/
    │   │   │           │   │   ├── agent.conf
    │   │   │           │   │   ├── agent1.conf
    │   │   │           │   │   ├── indexer.conf
    │   │   │           │   │   ├── journald.conf
    │   │   │           │   │   ├── journald1.conf
    │   │   │           │   │   ├── merged.mg
    │   │   │           │   │   ├── options.conf
    │   │   │           │   │   ├── options1.conf
    │   │   │           │   │   ├── rcl.conf
    │   │   │           │   │   ├── rootkit_files.txt
    │   │   │           │   │   ├── rootkit_trojans.txt
    │   │   │           │   │   ├── synchronization.conf
    │   │   │           │   │   └── vulnerability_detection.conf
    │   │   │           │   └── multigroup/
    │   │   │           │       └── agent.conf
    │   │   │           ├── etc/
    │   │   │           │   └── shared/
    │   │   │           │       └── ar.conf
    │   │   │           ├── manager/
    │   │   │           │   └── ossec_log.json
    │   │   │           ├── stats/
    │   │   │           │   ├── hourly-average/
    │   │   │           │   │   ├── 0
    │   │   │           │   │   ├── 1
    │   │   │           │   │   ├── 10
    │   │   │           │   │   ├── 11
    │   │   │           │   │   ├── 12
    │   │   │           │   │   ├── 13
    │   │   │           │   │   ├── 14
    │   │   │           │   │   ├── 15
    │   │   │           │   │   ├── 16
    │   │   │           │   │   ├── 17
    │   │   │           │   │   ├── 18
    │   │   │           │   │   ├── 19
    │   │   │           │   │   ├── 2
    │   │   │           │   │   ├── 20
    │   │   │           │   │   ├── 21
    │   │   │           │   │   ├── 22
    │   │   │           │   │   ├── 23
    │   │   │           │   │   ├── 24
    │   │   │           │   │   ├── 3
    │   │   │           │   │   ├── 4
    │   │   │           │   │   ├── 5
    │   │   │           │   │   ├── 6
    │   │   │           │   │   ├── 7
    │   │   │           │   │   ├── 8
    │   │   │           │   │   └── 9
    │   │   │           │   └── weekly-average/
    │   │   │           │       └── 0/
    │   │   │           │           ├── 0
    │   │   │           │           ├── 1
    │   │   │           │           ├── 10
    │   │   │           │           ├── 11
    │   │   │           │           ├── 12
    │   │   │           │           ├── 13
    │   │   │           │           ├── 14
    │   │   │           │           ├── 15
    │   │   │           │           ├── 16
    │   │   │           │           ├── 17
    │   │   │           │           ├── 18
    │   │   │           │           ├── 19
    │   │   │           │           ├── 2
    │   │   │           │           ├── 20
    │   │   │           │           ├── 21
    │   │   │           │           ├── 22
    │   │   │           │           ├── 23
    │   │   │           │           ├── 24
    │   │   │           │           ├── 3
    │   │   │           │           ├── 4
    │   │   │           │           ├── 5
    │   │   │           │           ├── 6
    │   │   │           │           ├── 7
    │   │   │           │           ├── 8
    │   │   │           │           └── 9
    │   │   │           ├── test_agent/
    │   │   │           │   ├── client.keys
    │   │   │           │   ├── schema_global_test.sql
    │   │   │           │   └── add_manual/
    │   │   │           │       └── add_manual_use_cases.yaml
    │   │   │           ├── test_database/
    │   │   │           │   └── schema_global_test.sql
    │   │   │           ├── test_load_wazuh_xml/
    │   │   │           │   ├── 10000-backslash_rule_test.xml
    │   │   │           │   ├── agent_backslash_query.conf
    │   │   │           │   └── agent_new_line_query.conf
    │   │   │           ├── test_load_wazuh_xml_ko/
    │   │   │           │   └── invalid_utf8.xml
    │   │   │           └── utils/
    │   │   │               └── test_config.xml
    │   │   ├── rbac/
    │   │   │   ├── __init__.py
    │   │   │   ├── auth_context.py
    │   │   │   ├── decorators.py
    │   │   │   ├── orm.py
    │   │   │   ├── preprocessor.py
    │   │   │   ├── utils.py
    │   │   │   ├── default/
    │   │   │   │   ├── policies.yaml
    │   │   │   │   ├── relationships.yaml
    │   │   │   │   ├── roles.yaml
    │   │   │   │   ├── rules.yaml
    │   │   │   │   └── users.yaml
    │   │   │   └── tests/
    │   │   │       ├── __init__.py
    │   │   │       ├── test_auth_context.py
    │   │   │       ├── test_decorators.py
    │   │   │       ├── test_default_configuration.py
    │   │   │       ├── test_orm.py
    │   │   │       ├── test_preprocessor.py
    │   │   │       ├── utils.py
    │   │   │       └── data/
    │   │   │           ├── jwt_secret
    │   │   │           ├── RBAC_auth-roles.json
    │   │   │           ├── RBAC_authorization_contexts.json
    │   │   │           ├── RBAC_decorators_permissions_black.json
    │   │   │           ├── RBAC_decorators_permissions_white.json
    │   │   │           ├── RBAC_decorators_resourceless_black.json
    │   │   │           ├── RBAC_decorators_resourceless_white.json
    │   │   │           ├── RBAC_postprocessor.json
    │   │   │           ├── RBAC_preprocessor_policies.json
    │   │   │           ├── RBAC_rules_roles.json
    │   │   │           └── schema_security_test.sql
    │   │   └── tests/
    │   │       ├── test_active_response.py
    │   │       ├── test_agent.py
    │   │       ├── test_cluster.py
    │   │       ├── test_event.py
    │   │       ├── test_manager.py
    │   │       ├── test_mitre.py
    │   │       ├── test_rootcheck.py
    │   │       ├── test_security.py
    │   │       ├── test_stats.py
    │   │       ├── test_syscheck.py
    │   │       ├── test_task.py
    │   │       ├── util.py
    │   │       └── data/
    │   │           ├── schema_global_test.sql
    │   │           ├── schema_syscheck_test.sql
    │   │           ├── schema_syscollector_000.sql
    │   │           ├── schema_tasks_test.sql
    │   │           ├── agent/
    │   │           │   ├── client.keys
    │   │           │   ├── multigroups/
    │   │           │   │   └── 8901bc10/
    │   │           │   │       └── merged.mg
    │   │           │   └── shared/
    │   │           │       ├── agent-template.conf
    │   │           │       ├── ar.conf
    │   │           │       ├── default/
    │   │           │       │   ├── agent.conf
    │   │           │       │   └── merged.mg
    │   │           │       ├── group-1/
    │   │           │       │   ├── agent.conf
    │   │           │       │   └── merged.mg
    │   │           │       ├── group-2/
    │   │           │       │   ├── agent.conf
    │   │           │       │   └── merged.mg
    │   │           │       └── group-empty/
    │   │           │           └── non-readable-file
    │   │           ├── etc/
    │   │           │   └── shared/
    │   │           │       └── ar.conf
    │   │           ├── security/
    │   │           │   ├── policies_test_cases.yml
    │   │           │   ├── rbac_catalog.yml
    │   │           │   ├── role_policies_test_cases.yml
    │   │           │   ├── roles_test_cases.yml
    │   │           │   ├── sanitize_policies.yaml
    │   │           │   ├── schema_security_test.sql
    │   │           │   ├── users_roles_test_cases.yml
    │   │           │   ├── users_test_cases.yml
    │   │           │   └── default/
    │   │           │       ├── default_cases.yml
    │   │           │       ├── migration_policies.yml
    │   │           │       ├── mock_relationships.yml
    │   │           │       └── new_default_policies.yml
    │   │           └── var/
    │   │               └── upgrade/
    │   │                   └── wazuh_agent_v3.9.0_linux_x86_64.wpk
    │   └── wrappers/
    │       └── generic_wrapper.sh
    ├── packages/
    │   ├── README.md
    │   ├── build.sh
    │   ├── generate_package.sh
    │   ├── debs/
    │   │   ├── amd64/
    │   │   │   ├── agent/
    │   │   │   │   ├── Dockerfile
    │   │   │   │   └── certificates/
    │   │   │   │       └── cacert.pem
    │   │   │   ├── binutils/
    │   │   │   │   └── Dockerfile
    │   │   │   ├── gcc/
    │   │   │   │   └── Dockerfile
    │   │   │   └── manager/
    │   │   │       └── Dockerfile
    │   │   ├── arm64/
    │   │   │   ├── agent/
    │   │   │   │   └── Dockerfile
    │   │   │   ├── binutils/
    │   │   │   │   └── Dockerfile
    │   │   │   ├── gcc/
    │   │   │   │   └── Dockerfile
    │   │   │   └── manager/
    │   │   │       └── Dockerfile
    │   │   ├── armhf/
    │   │   │   └── agent/
    │   │   │       └── Dockerfile
    │   │   ├── i386/
    │   │   │   └── agent/
    │   │   │       ├── Dockerfile
    │   │   │       └── certificates/
    │   │   │           └── cacert.pem
    │   │   ├── SPECS/
    │   │   │   ├── wazuh-agent/
    │   │   │   │   └── debian/
    │   │   │   │       ├── changelog
    │   │   │   │       ├── compat
    │   │   │   │       ├── conffiles
    │   │   │   │       ├── control
    │   │   │   │       ├── copyright
    │   │   │   │       ├── postinst
    │   │   │   │       ├── postrm
    │   │   │   │       ├── preinst
    │   │   │   │       ├── prerm
    │   │   │   │       ├── rules
    │   │   │   │       ├── templates
    │   │   │   │       ├── wazuh-agent.lintian-overrides
    │   │   │   │       └── source/
    │   │   │   │           └── format
    │   │   │   └── wazuh-manager/
    │   │   │       └── debian/
    │   │   │           ├── changelog
    │   │   │           ├── compat
    │   │   │           ├── conffiles
    │   │   │           ├── control
    │   │   │           ├── copyright
    │   │   │           ├── postinst
    │   │   │           ├── postrm
    │   │   │           ├── preinst
    │   │   │           ├── prerm
    │   │   │           ├── rules
    │   │   │           ├── wazuh-manager.lintian-overrides
    │   │   │           └── source/
    │   │   │               └── format
    │   │   └── utils/
    │   │       ├── gen_permissions.sh
    │   │       └── helper_function.sh
    │   ├── macos/
    │   │   ├── entitlements.plist
    │   │   ├── generate_wazuh_packages.sh
    │   │   ├── uninstall.sh
    │   │   ├── package_files/
    │   │   │   ├── build.sh
    │   │   │   ├── introduction.txt
    │   │   │   ├── postinstall.sh
    │   │   │   └── preinstall.sh
    │   │   └── specs/
    │   │       └── build-info.json
    │   ├── rpms/
    │   │   ├── amd64/
    │   │   │   ├── agent/
    │   │   │   │   ├── CentOS-Base.repo
    │   │   │   │   └── Dockerfile
    │   │   │   ├── binutils/
    │   │   │   │   └── Dockerfile
    │   │   │   ├── gcc/
    │   │   │   │   └── Dockerfile
    │   │   │   └── manager/
    │   │   │       └── Dockerfile
    │   │   ├── arm64/
    │   │   │   ├── agent/
    │   │   │   │   └── Dockerfile
    │   │   │   ├── binutils/
    │   │   │   │   └── Dockerfile
    │   │   │   ├── gcc/
    │   │   │   │   └── Dockerfile
    │   │   │   └── manager/
    │   │   │       └── Dockerfile
    │   │   ├── armhf/
    │   │   │   └── agent/
    │   │   │       └── Dockerfile
    │   │   ├── i386/
    │   │   │   └── agent/
    │   │   │       ├── CentOS-Base.repo
    │   │   │       └── Dockerfile
    │   │   ├── SPECS/
    │   │   │   ├── wazuh-agent.spec
    │   │   │   └── wazuh-manager.spec
    │   │   └── utils/
    │   │       ├── build_deps.sh
    │   │       └── helper_function.sh
    │   ├── windows/
    │   │   ├── Dockerfile
    │   │   ├── entrypoint.sh
    │   │   ├── generate_compiled_windows_agent.sh
    │   │   └── generate_wazuh_msi.ps1
    │   └── wpk/
    │       ├── README.md
    │       ├── generate_wpk_package.sh
    │       ├── run.sh
    │       ├── wpkpack.py
    │       ├── common/
    │       │   └── Dockerfile
    │       └── test/
    │           ├── README.md
    │           ├── deb_upgrade/
    │           │   └── Dockerfile
    │           └── rpm_upgrade/
    │               └── Dockerfile
    ├── ruleset/
    │   ├── README.md
    │   └── sca/
    │       ├── amazon/
    │       │   └── cis_amazon_linux_1.yml
    │       ├── applications/
    │       │   ├── cis_apache_24.yml
    │       │   ├── cis_iis_10.yml
    │       │   ├── cis_mysql5-6_community.yml
    │       │   ├── cis_mysql5-6_enterprise.yml
    │       │   ├── cis_postgre-sql-13.yml
    │       │   ├── cis_sqlserver_2012.yml
    │       │   ├── cis_sqlserver_2014.yml
    │       │   ├── cis_sqlserver_2016.yml
    │       │   ├── cis_sqlserver_2017.yml
    │       │   ├── cis_sqlserver_2019.yml
    │       │   └── web_vulnerabilities.yml
    │       ├── centos/
    │       │   └── 6/
    │       │       └── cis_centos6_linux.yml
    │       ├── darwin/
    │       │   ├── 15/
    │       │   │   └── cis_apple_macOS_10.11.yml
    │       │   ├── 16/
    │       │   │   └── cis_apple_macOS_10.12.yml
    │       │   ├── 17/
    │       │   │   └── cis_apple_macOS_10.13.yml
    │       │   ├── 18/
    │       │   │   └── cis_apple_macOS_10.14.yml
    │       │   ├── 19/
    │       │   │   └── cis_apple_macOS_10.15.yml
    │       │   ├── 20/
    │       │   │   └── cis_apple_macOS_11.1.yml
    │       │   ├── 21/
    │       │   │   └── cis_apple_macOS_12.0.yml
    │       │   ├── 22/
    │       │   │   └── cis_apple_macOS_13.x.yml
    │       │   ├── 23/
    │       │   │   └── cis_apple_macOS_14.x.yml
    │       │   ├── 24/
    │       │   │   └── cis_apple_macOS_15.x.yml
    │       │   └── 25/
    │       │       └── cis_apple_macOS_26.x.yml
    │       ├── debian/
    │       │   ├── cis_debian7.yml
    │       │   ├── cis_debian8.yml
    │       │   └── cis_debian9.yml
    │       ├── mongodb/
    │       │   └── cis_mongodb_36.yml
    │       ├── nginx/
    │       │   └── cis_nginx_1.yml
    │       ├── oracledb/
    │       │   └── cis_oracle_database_19c.yml
    │       ├── rhel/
    │       │   └── 6/
    │       │       └── cis_rhel6_linux.yml
    │       ├── sles/
    │       │   └── 12/
    │       │       └── cis_sles12_linux.yml
    │       └── ubuntu/
    │           ├── cis_ubuntu14-04.yml
    │           └── cis_ubuntu16-04.yml
    ├── src/
    │   ├── Readme.md
    │   ├── build.py
    │   ├── CMakeLists.txt
    │   ├── Doxyfile
    │   ├── Makefile
    │   ├── active-response/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── active_responses.h
    │   │   └── src/
    │   │       ├── active_responses.c
    │   │       ├── disable-account.c
    │   │       ├── firewalld-drop.c
    │   │       ├── host-deny.c
    │   │       ├── ip-customblock.c
    │   │       ├── kaspersky.c
    │   │       ├── kaspersky.py
    │   │       ├── netsh.c
    │   │       ├── restart-wazuh.c
    │   │       ├── restart.sh
    │   │       ├── route-null.c
    │   │       ├── wazuh-slack.c
    │   │       └── firewalls/
    │   │           ├── default-firewall-drop.c
    │   │           ├── ipfw.c
    │   │           ├── npf.c
    │   │           └── pf.c
    │   ├── addagent/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── manage_agents.h
    │   │   └── src/
    │   │       ├── main.c
    │   │       ├── manage_agents.c
    │   │       ├── manage_keys.c
    │   │       └── read_from_user.c
    │   ├── ci/
    │   │   ├── __init__.py
    │   │   ├── build_tools.py
    │   │   ├── run_check.py
    │   │   ├── utils.py
    │   │   ├── input/
    │   │   │   ├── astyle.config
    │   │   │   ├── rtr_input.json
    │   │   │   └── test_tool_config.json
    │   │   └── tests/
    │   │       ├── __init__.py
    │   │       ├── conftest.py
    │   │       └── syscheckd/
    │   │           └── test_check_module.py
    │   ├── client-agent/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   ├── agentd.h
    │   │   │   └── state.h
    │   │   └── src/
    │   │       ├── agcom.c
    │   │       ├── agentd.c
    │   │       ├── buffer.c
    │   │       ├── config.c
    │   │       ├── event-forward.c
    │   │       ├── main.c
    │   │       ├── notify.c
    │   │       ├── receiver.c
    │   │       ├── reload_agent.c
    │   │       ├── request.c
    │   │       ├── rotate_log.c
    │   │       ├── sendmsg.c
    │   │       ├── sendmsg.h
    │   │       ├── start_agent.c
    │   │       ├── startup_gate.c
    │   │       └── state.c
    │   ├── config/
    │   │   ├── README.md
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   ├── active-response.h
    │   │   │   ├── authd-config.h
    │   │   │   ├── client-config.h
    │   │   │   ├── config.h
    │   │   │   ├── global-config.h
    │   │   │   ├── indexer-config.h
    │   │   │   ├── localfile-config.h
    │   │   │   ├── remote-config.h
    │   │   │   ├── rootcheck-config.h
    │   │   │   ├── syscheck-config.h
    │   │   │   └── wazuh_db-config.h
    │   │   └── src/
    │   │       ├── active-response.c
    │   │       ├── authd-config.c
    │   │       ├── authd-key-request-config.c
    │   │       ├── buffer-config.c
    │   │       ├── client-config.c
    │   │       ├── cluster-config.c
    │   │       ├── config.c
    │   │       ├── global-config.c
    │   │       ├── indexer-config.c
    │   │       ├── labels-config.c
    │   │       ├── localfile-config.c
    │   │       ├── remote-config.c
    │   │       ├── rootcheck-config.c
    │   │       ├── socket-config.c
    │   │       ├── syscheck-config.c
    │   │       ├── wazuh_db-config.c
    │   │       ├── wmodules-agent-upgrade.c
    │   │       ├── wmodules-aws.c
    │   │       ├── wmodules-azure.c
    │   │       ├── wmodules-command.c
    │   │       ├── wmodules-config.c
    │   │       ├── wmodules-docker.c
    │   │       ├── wmodules-gcp.c
    │   │       ├── wmodules-github.c
    │   │       ├── wmodules-key-request.c
    │   │       ├── wmodules-ms-graph.c
    │   │       ├── wmodules-office365.c
    │   │       ├── wmodules-sca.c
    │   │       ├── wmodules-syscollector.c
    │   │       ├── wmodules-task-manager.c
    │   │       └── wmodules-vulnerability-detection.c
    │   ├── data_provider/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   ├── sysInfo.h
    │   │   │   ├── sysInfo.hpp
    │   │   │   └── sysInfoInterface.h
    │   │   ├── qa/
    │   │   │   ├── hardware_schema.json
    │   │   │   ├── network_schema.json
    │   │   │   ├── packages_schema.json
    │   │   │   ├── ports_schema.json
    │   │   │   ├── requirements.txt
    │   │   │   ├── test_hardware.py
    │   │   │   ├── test_macports.py
    │   │   │   ├── test_network.py
    │   │   │   ├── test_packages.py
    │   │   │   └── test_ports.py
    │   │   ├── src/
    │   │   │   ├── sharedDefs.h
    │   │   │   ├── sysInfo.cpp
    │   │   │   ├── sysInfoCommonBSD.cpp
    │   │   │   ├── sysInfoFreeBSD.cpp
    │   │   │   ├── sysInfoLinux.cpp
    │   │   │   ├── sysInfoMac.cpp
    │   │   │   ├── sysInfoOpenBSD.cpp
    │   │   │   ├── sysInfoUnix.cpp
    │   │   │   ├── sysInfoWin.cpp
    │   │   │   ├── utilsWrapperLinux.cpp
    │   │   │   ├── utilsWrapperLinux.hpp
    │   │   │   ├── utilsWrapperMac.cpp
    │   │   │   ├── utilsWrapperMac.hpp
    │   │   │   ├── UtilsWrapperUnix.cpp
    │   │   │   ├── UtilsWrapperUnix.hpp
    │   │   │   ├── utilsWrapperWin.cpp
    │   │   │   ├── utilsWrapperWin.hpp
    │   │   │   ├── extended_sources/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── browser_extensions/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   ├── chrome.hpp
    │   │   │   │   │   │   ├── firefox.hpp
    │   │   │   │   │   │   ├── ie_explorer.hpp
    │   │   │   │   │   │   └── safari_darwin.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   ├── chrome.cpp
    │   │   │   │   │   │   ├── firefox.cpp
    │   │   │   │   │   │   ├── ie_explorer.cpp
    │   │   │   │   │   │   └── safari_darwin.cpp
    │   │   │   │   │   └── tests/
    │   │   │   │   │       ├── CMakeLists.txt
    │   │   │   │   │       ├── main.cpp
    │   │   │   │   │       ├── test_chrome_darwin.cpp
    │   │   │   │   │       ├── test_chrome_linux.cpp
    │   │   │   │   │       ├── test_chrome_windows.cpp
    │   │   │   │   │       ├── test_firefox_darwin.cpp
    │   │   │   │   │       ├── test_firefox_linux.cpp
    │   │   │   │   │       ├── test_firefox_windows.cpp
    │   │   │   │   │       ├── test_ie_explorer_windows.cpp
    │   │   │   │   │       ├── test_safari_darwin.cpp
    │   │   │   │   │       ├── darwin/
    │   │   │   │   │       │   └── mock-user/
    │   │   │   │   │       │       └── Library/
    │   │   │   │   │       │           └── Application Support/
    │   │   │   │   │       │               ├── Firefox/
    │   │   │   │   │       │               │   └── Profiles/
    │   │   │   │   │       │               │       └── 4l9id9xy.default-release/
    │   │   │   │   │       │               │           └── extensions.json
    │   │   │   │   │       │               └── Google/
    │   │   │   │   │       │                   └── Chrome/
    │   │   │   │   │       │                       ├── Default/
    │   │   │   │   │       │                       │   ├── Preferences
    │   │   │   │   │       │                       │   ├── Secure Preferences
    │   │   │   │   │       │                       │   └── Extensions/
    │   │   │   │   │       │                       │       ├── ext1/
    │   │   │   │   │       │                       │       │   └── 1.2.3/
    │   │   │   │   │       │                       │       │       ├── manifest.json
    │   │   │   │   │       │                       │       │       └── _locales/
    │   │   │   │   │       │                       │       │           └── en/
    │   │   │   │   │       │                       │       │               └── messages.json
    │   │   │   │   │       │                       │       ├── ext2/
    │   │   │   │   │       │                       │       │   └── 1.2.3/
    │   │   │   │   │       │                       │       │       ├── manifest.json
    │   │   │   │   │       │                       │       │       └── _locales/
    │   │   │   │   │       │                       │       │           ├── en/
    │   │   │   │   │       │                       │       │           │   └── messages.json
    │   │   │   │   │       │                       │       │           └── en_US/
    │   │   │   │   │       │                       │       │               └── messages.json
    │   │   │   │   │       │                       │       └── ext3/
    │   │   │   │   │       │                       │           └── 1.2.3/
    │   │   │   │   │       │                       │               ├── manifest.json
    │   │   │   │   │       │                       │               └── _locales/
    │   │   │   │   │       │                       │                   ├── en/
    │   │   │   │   │       │                       │                   │   └── messages.json
    │   │   │   │   │       │                       │                   └── en_US/
    │   │   │   │   │       │                       │                       └── messages.json
    │   │   │   │   │       │                       └── Profile 1/
    │   │   │   │   │       │                           ├── Preferences
    │   │   │   │   │       │                           ├── Secure Preferences
    │   │   │   │   │       │                           └── Extensions/
    │   │   │   │   │       │                               ├── ext1/
    │   │   │   │   │       │                               │   └── 1.2.3/
    │   │   │   │   │       │                               │       ├── manifest.json
    │   │   │   │   │       │                               │       └── _locales/
    │   │   │   │   │       │                               │           ├── en/
    │   │   │   │   │       │                               │           │   └── messages.json
    │   │   │   │   │       │                               │           └── en_US/
    │   │   │   │   │       │                               │               └── messages.json
    │   │   │   │   │       │                               └── ext2/
    │   │   │   │   │       │                                   └── 1.2.3/
    │   │   │   │   │       │                                       ├── manifest.json
    │   │   │   │   │       │                                       └── _locales/
    │   │   │   │   │       │                                           └── en/
    │   │   │   │   │       │                                               └── messages.json
    │   │   │   │   │       ├── input_files/
    │   │   │   │   │       │   └── apps_mock_dir/
    │   │   │   │   │       │       ├── darker.app/
    │   │   │   │   │       │       │   └── Contents/
    │   │   │   │   │       │       │       └── PlugIns/
    │   │   │   │   │       │       │           └── darker Extension.appex/
    │   │   │   │   │       │       │               └── Contents/
    │   │   │   │   │       │       │                   └── Info.plist
    │   │   │   │   │       │       ├── JSONPeep.app/
    │   │   │   │   │       │       │   └── Contents/
    │   │   │   │   │       │       │       └── PlugIns/
    │   │   │   │   │       │       │           └── JSONPeep Extension.appex/
    │   │   │   │   │       │       │               └── Contents/
    │   │   │   │   │       │       │                   └── Info.plist
    │   │   │   │   │       │       └── zoom.us.app/
    │   │   │   │   │       │           └── Contents/
    │   │   │   │   │       │               ├── Info.plist
    │   │   │   │   │       │               └── PlugIns/
    │   │   │   │   │       │                   └── ZoomAudioDevice.driver/
    │   │   │   │   │       │                       └── Contents/
    │   │   │   │   │       │                           └── Info.plist
    │   │   │   │   │       ├── linux/
    │   │   │   │   │       │   └── mock-user/
    │   │   │   │   │       │       ├── snap/
    │   │   │   │   │       │       │   └── firefox/
    │   │   │   │   │       │       │       └── common/
    │   │   │   │   │       │       │           └── .mozilla/
    │   │   │   │   │       │       │               └── firefox/
    │   │   │   │   │       │       │                   └── pwd5bwxx.default/
    │   │   │   │   │       │       │                       └── extensions.json
    │   │   │   │   │       │       └── .config/
    │   │   │   │   │       │           └── google-chrome/
    │   │   │   │   │       │               ├── Default/
    │   │   │   │   │       │               │   ├── Preferences
    │   │   │   │   │       │               │   ├── Secure Preferences
    │   │   │   │   │       │               │   └── Extensions/
    │   │   │   │   │       │               │       ├── ext1/
    │   │   │   │   │       │               │       │   └── 1.2.3/
    │   │   │   │   │       │               │       │       ├── manifest.json
    │   │   │   │   │       │               │       │       └── _locales/
    │   │   │   │   │       │               │       │           └── en/
    │   │   │   │   │       │               │       │               └── messages.json
    │   │   │   │   │       │               │       ├── ext2/
    │   │   │   │   │       │               │       │   └── 1.2.3/
    │   │   │   │   │       │               │       │       ├── manifest.json
    │   │   │   │   │       │               │       │       └── _locales/
    │   │   │   │   │       │               │       │           ├── en/
    │   │   │   │   │       │               │       │           │   └── messages.json
    │   │   │   │   │       │               │       │           └── en_US/
    │   │   │   │   │       │               │       │               └── messages.json
    │   │   │   │   │       │               │       └── ext3/
    │   │   │   │   │       │               │           └── 1.2.3/
    │   │   │   │   │       │               │               ├── manifest.json
    │   │   │   │   │       │               │               └── _locales/
    │   │   │   │   │       │               │                   ├── en/
    │   │   │   │   │       │               │                   │   └── messages.json
    │   │   │   │   │       │               │                   └── en_US/
    │   │   │   │   │       │               │                       └── messages.json
    │   │   │   │   │       │               └── Profile 1/
    │   │   │   │   │       │                   ├── Preferences
    │   │   │   │   │       │                   ├── Secure Preferences
    │   │   │   │   │       │                   └── Extensions/
    │   │   │   │   │       │                       ├── ext1/
    │   │   │   │   │       │                       │   └── 1.2.3/
    │   │   │   │   │       │                       │       ├── manifest.json
    │   │   │   │   │       │                       │       └── _locales/
    │   │   │   │   │       │                       │           ├── en/
    │   │   │   │   │       │                       │           │   └── messages.json
    │   │   │   │   │       │                       │           └── en_US/
    │   │   │   │   │       │                       │               └── messages.json
    │   │   │   │   │       │                       └── ext2/
    │   │   │   │   │       │                           └── 1.2.3/
    │   │   │   │   │       │                               ├── manifest.json
    │   │   │   │   │       │                               └── _locales/
    │   │   │   │   │       │                                   └── en/
    │   │   │   │   │       │                                       └── messages.json
    │   │   │   │   │       └── windows/
    │   │   │   │   │           └── mock-user/
    │   │   │   │   │               └── AppData/
    │   │   │   │   │                   ├── Local/
    │   │   │   │   │                   │   └── Google/
    │   │   │   │   │                   │       └── Chrome/
    │   │   │   │   │                   │           └── User Data/
    │   │   │   │   │                   │               ├── Default/
    │   │   │   │   │                   │               │   ├── Preferences
    │   │   │   │   │                   │               │   ├── Secure Preferences
    │   │   │   │   │                   │               │   └── Extensions/
    │   │   │   │   │                   │               │       ├── ext1/
    │   │   │   │   │                   │               │       │   └── 1.2.3/
    │   │   │   │   │                   │               │       │       ├── manifest.json
    │   │   │   │   │                   │               │       │       └── _locales/
    │   │   │   │   │                   │               │       │           └── en/
    │   │   │   │   │                   │               │       │               └── messages.json
    │   │   │   │   │                   │               │       ├── ext2/
    │   │   │   │   │                   │               │       │   └── 1.2.3/
    │   │   │   │   │                   │               │       │       ├── manifest.json
    │   │   │   │   │                   │               │       │       └── _locales/
    │   │   │   │   │                   │               │       │           └── en/
    │   │   │   │   │                   │               │       │               └── messages.json
    │   │   │   │   │                   │               │       └── ext3/
    │   │   │   │   │                   │               │           └── 1.2.3/
    │   │   │   │   │                   │               │               ├── manifest.json
    │   │   │   │   │                   │               │               └── _locales/
    │   │   │   │   │                   │               │                   └── en/
    │   │   │   │   │                   │               │                       └── messages.json
    │   │   │   │   │                   │               └── Profile 1/
    │   │   │   │   │                   │                   ├── Preferences
    │   │   │   │   │                   │                   ├── Secure Preferences
    │   │   │   │   │                   │                   └── Extensions/
    │   │   │   │   │                   │                       ├── ext1/
    │   │   │   │   │                   │                       │   └── 1.2.3/
    │   │   │   │   │                   │                       │       ├── manifest.json
    │   │   │   │   │                   │                       │       └── _locales/
    │   │   │   │   │                   │                       │           └── en/
    │   │   │   │   │                   │                       │               └── messages.json
    │   │   │   │   │                   │                       └── ext2/
    │   │   │   │   │                   │                           └── 1.2.3/
    │   │   │   │   │                   │                               ├── manifest.json
    │   │   │   │   │                   │                               └── _locales/
    │   │   │   │   │                   │                                   └── en/
    │   │   │   │   │                   │                                       └── messages.json
    │   │   │   │   │                   └── Roaming/
    │   │   │   │   │                       └── Mozilla/
    │   │   │   │   │                           └── Firefox/
    │   │   │   │   │                               └── Profiles/
    │   │   │   │   │                                   └── hgi5kcav.default-release/
    │   │   │   │   │                                       └── extensions.json
    │   │   │   │   ├── disk_and_devices/
    │   │   │   │   │   └── empty_file
    │   │   │   │   ├── groups/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   ├── groups_darwin.hpp
    │   │   │   │   │   │   ├── groups_linux.hpp
    │   │   │   │   │   │   ├── groups_windows.hpp
    │   │   │   │   │   │   ├── user_groups_darwin.hpp
    │   │   │   │   │   │   ├── user_groups_linux.hpp
    │   │   │   │   │   │   └── user_groups_windows.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   ├── groups_darwin.cpp
    │   │   │   │   │   │   ├── groups_linux.cpp
    │   │   │   │   │   │   ├── groups_windows.cpp
    │   │   │   │   │   │   ├── user_groups_darwin.cpp
    │   │   │   │   │   │   ├── user_groups_linux.cpp
    │   │   │   │   │   │   └── user_groups_windows.cpp
    │   │   │   │   │   └── tests/
    │   │   │   │   │       ├── CMakeLists.txt
    │   │   │   │   │       ├── main.cpp
    │   │   │   │   │       ├── test_groups_darwin.cpp
    │   │   │   │   │       ├── test_groups_linux.cpp
    │   │   │   │   │       ├── test_groups_windows.cpp
    │   │   │   │   │       ├── test_user_groups_darwin.cpp
    │   │   │   │   │       ├── test_user_groups_linux.cpp
    │   │   │   │   │       └── test_user_groups_windows.cpp
    │   │   │   │   ├── kernel_modules/
    │   │   │   │   │   └── empty_file
    │   │   │   │   ├── services/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   ├── launchd_darwin.hpp
    │   │   │   │   │   │   ├── services_windows.hpp
    │   │   │   │   │   │   └── systemd_units_linux.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   ├── launchd_darwin.cpp
    │   │   │   │   │   │   ├── services_windows.cpp
    │   │   │   │   │   │   └── systemd_units_linux.cpp
    │   │   │   │   │   └── tests/
    │   │   │   │   │       ├── CMakeLists.txt
    │   │   │   │   │       ├── main.cpp
    │   │   │   │   │       ├── test_launchd_darwin.cpp
    │   │   │   │   │       ├── test_services_windows.cpp
    │   │   │   │   │       └── test_systemd_units_linux.cpp
    │   │   │   │   ├── users/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   ├── logged_in_users_darwin.hpp
    │   │   │   │   │   │   ├── logged_in_users_linux.hpp
    │   │   │   │   │   │   ├── logged_in_users_win.hpp
    │   │   │   │   │   │   ├── shadow_linux.hpp
    │   │   │   │   │   │   ├── sudoers_unix.hpp
    │   │   │   │   │   │   ├── users_darwin.hpp
    │   │   │   │   │   │   ├── users_linux.hpp
    │   │   │   │   │   │   └── users_windows.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   ├── logged_in_users_darwin.cpp
    │   │   │   │   │   │   ├── logged_in_users_linux.cpp
    │   │   │   │   │   │   ├── logged_in_users_win.cpp
    │   │   │   │   │   │   ├── shadow_linux.cpp
    │   │   │   │   │   │   ├── sudoers_unix.cpp
    │   │   │   │   │   │   ├── users_darwin.cpp
    │   │   │   │   │   │   ├── users_linux.cpp
    │   │   │   │   │   │   └── users_windows.cpp
    │   │   │   │   │   └── tests/
    │   │   │   │   │       ├── CMakeLists.txt
    │   │   │   │   │       ├── main.cpp
    │   │   │   │   │       ├── test_logged_in_users_darwin.cpp
    │   │   │   │   │       ├── test_logged_in_users_linux.cpp
    │   │   │   │   │       ├── test_logged_in_users_win.cpp
    │   │   │   │   │       ├── test_shadow_linux.cpp
    │   │   │   │   │       ├── test_sudoers_unix.cpp
    │   │   │   │   │       ├── test_users_darwin.cpp
    │   │   │   │   │       ├── test_users_linux.cpp
    │   │   │   │   │       └── test_users_windows.cpp
    │   │   │   │   ├── wifi/
    │   │   │   │   │   └── empty_file
    │   │   │   │   └── wrappers/
    │   │   │   │       ├── unix/
    │   │   │   │       │   ├── iutmpx_wrapper.hpp
    │   │   │   │       │   ├── utmpx_wrapper.hpp
    │   │   │   │       │   ├── darwin/
    │   │   │   │       │   │   ├── browser_extensions_wrapper.hpp
    │   │   │   │       │   │   ├── group_wrapper.hpp
    │   │   │   │       │   │   ├── ibrowser_extensions_wrapper.hpp
    │   │   │   │       │   │   ├── igroup_wrapper.hpp
    │   │   │   │       │   │   ├── iopen_directory_utils_wrapper.hpp
    │   │   │   │       │   │   ├── ipasswd_wrapper.hpp
    │   │   │   │       │   │   ├── iuuid_wrapper.hpp
    │   │   │   │       │   │   ├── od_wrapper.hpp
    │   │   │   │       │   │   ├── od_wrapper.mm
    │   │   │   │       │   │   ├── open_directory_utils_wrapper.hpp
    │   │   │   │       │   │   ├── passwd_wrapper.hpp
    │   │   │   │       │   │   └── uuid_wrapper.hpp
    │   │   │   │       │   └── linux/
    │   │   │   │       │       ├── browser_extensions_wrapper.hpp
    │   │   │   │       │       ├── dbus_wrapper.hpp
    │   │   │   │       │       ├── group_wrapper.hpp
    │   │   │   │       │       ├── ibrowser_extensions_wrapper.hpp
    │   │   │   │       │       ├── idbus_wrapper.hpp
    │   │   │   │       │       ├── igroup_wrapper.hpp
    │   │   │   │       │       ├── ipasswd_wrapper.hpp
    │   │   │   │       │       ├── ishadow_wrapper.hpp
    │   │   │   │       │       ├── isystem_wrapper.hpp
    │   │   │   │       │       ├── passwd_wrapper.hpp
    │   │   │   │       │       ├── shadow_wrapper.hpp
    │   │   │   │       │       └── system_wrapper.hpp
    │   │   │   │       └── windows/
    │   │   │   │           ├── browser_extensions_wrapper.hpp
    │   │   │   │           ├── groups_utils_wrapper.cpp
    │   │   │   │           ├── groups_utils_wrapper.hpp
    │   │   │   │           ├── ibrowser_extensions_wrapper.hpp
    │   │   │   │           ├── ie_extensions_wrapper.hpp
    │   │   │   │           ├── igroups_utils_wrapper.hpp
    │   │   │   │           ├── iie_extensions_wrapper.hpp
    │   │   │   │           ├── iservices_utils_wrapper.hpp
    │   │   │   │           ├── iusers_utils_wrapper.hpp
    │   │   │   │           ├── iwinapi_wrappers.hpp
    │   │   │   │           ├── iwindows_api_wrapper.hpp
    │   │   │   │           ├── iwinsvc_wrapper.hpp
    │   │   │   │           ├── services_utils_wrapper.cpp
    │   │   │   │           ├── services_utils_wrapper.hpp
    │   │   │   │           ├── users_utils_wrapper.cpp
    │   │   │   │           ├── users_utils_wrapper.hpp
    │   │   │   │           ├── winapi_wrappers.hpp
    │   │   │   │           ├── windows_api_wrapper.hpp
    │   │   │   │           └── winsvc_wrapper.hpp
    │   │   │   ├── hardware/
    │   │   │   │   ├── architectureDependantARMMac.cpp
    │   │   │   │   ├── architectureDependantX86_64Mac.cpp
    │   │   │   │   ├── factoryHardwareFamilyCreator.h
    │   │   │   │   ├── hardwareImplMac.h
    │   │   │   │   ├── hardwareInterface.h
    │   │   │   │   ├── hardwareWrapperImplMac.h
    │   │   │   │   └── hardwareWrapperInterface.h
    │   │   │   ├── network/
    │   │   │   │   ├── inetworkInterface.h
    │   │   │   │   ├── inetworkWrapper.h
    │   │   │   │   ├── networkBSDWrapper.h
    │   │   │   │   ├── networkFamilyDataAFactory.h
    │   │   │   │   ├── networkInterfaceBSD.cpp
    │   │   │   │   ├── networkInterfaceBSD.h
    │   │   │   │   ├── networkInterfaceLinux.cpp
    │   │   │   │   ├── networkInterfaceLinux.h
    │   │   │   │   ├── networkInterfaceWindows.cpp
    │   │   │   │   ├── networkInterfaceWindows.h
    │   │   │   │   ├── networkLinuxWrapper.h
    │   │   │   │   └── networkWindowsWrapper.h
    │   │   │   ├── osinfo/
    │   │   │   │   ├── sysOsInfoInterface.h
    │   │   │   │   ├── sysOsInfoWin.cpp
    │   │   │   │   ├── sysOsInfoWin.h
    │   │   │   │   ├── sysOsParsers.cpp
    │   │   │   │   └── sysOsParsers.h
    │   │   │   ├── packages/
    │   │   │   │   ├── appxWindowsWrapper.h
    │   │   │   │   ├── berkeleyDbWrapper.h
    │   │   │   │   ├── berkeleyRpmDbHelper.h
    │   │   │   │   ├── brewWrapper.h
    │   │   │   │   ├── iberkeleyDbWrapper.h
    │   │   │   │   ├── ipackageInterface.h
    │   │   │   │   ├── ipackageWrapper.h
    │   │   │   │   ├── macportsWrapper.h
    │   │   │   │   ├── modernPackageDataRetriever.hpp
    │   │   │   │   ├── packageFamilyDataAFactory.h
    │   │   │   │   ├── packageLinuxApkParserHelper.h
    │   │   │   │   ├── packageLinuxDataRetriever.h
    │   │   │   │   ├── packageLinuxParserApk.cpp
    │   │   │   │   ├── packageLinuxParserDeb.cpp
    │   │   │   │   ├── packageLinuxParserExtra.cpp
    │   │   │   │   ├── packageLinuxParserHelper.h
    │   │   │   │   ├── packageLinuxParserHelperExtra.h
    │   │   │   │   ├── packageLinuxParserRpm.cpp
    │   │   │   │   ├── packageLinuxParserSnap.cpp
    │   │   │   │   ├── packageLinuxRpmParserHelper.h
    │   │   │   │   ├── packageLinuxRpmParserHelperLegacy.h
    │   │   │   │   ├── packageMac.cpp
    │   │   │   │   ├── packageMac.h
    │   │   │   │   ├── packagesNPM.hpp
    │   │   │   │   ├── packagesPYPI.hpp
    │   │   │   │   ├── packagesWindows.cpp
    │   │   │   │   ├── packagesWindows.h
    │   │   │   │   ├── packagesWindowsParserHelper.h
    │   │   │   │   ├── pkgWrapper.h
    │   │   │   │   ├── rpmlib.h
    │   │   │   │   ├── rpmlibWrapper.h
    │   │   │   │   ├── rpmPackageManager.cpp
    │   │   │   │   └── rpmPackageManager.h
    │   │   │   └── ports/
    │   │   │       ├── iportInterface.h
    │   │   │       ├── iportWrapper.h
    │   │   │       ├── portBSDWrapper.h
    │   │   │       ├── portImpl.h
    │   │   │       ├── portLinuxWrapper.h
    │   │   │       └── portWindowsWrapper.h
    │   │   ├── tests/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── mocks/
    │   │   │   │   └── mock_sysinfo.hpp
    │   │   │   ├── sysInfo/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfo_test.cpp
    │   │   │   │   ├── sysInfo_test.h
    │   │   │   │   ├── sysInfoParsers_test.cpp
    │   │   │   │   ├── sysInfoParsers_test.h
    │   │   │   │   ├── sysOsInfo_test.cpp
    │   │   │   │   └── sysOsInfo_test.h
    │   │   │   ├── sysInfoHardwareMac/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── osPrimitives_mock.h
    │   │   │   │   ├── sysInfoHardwareMac_test.cpp
    │   │   │   │   ├── sysInfoHardwareMac_test.h
    │   │   │   │   ├── sysInfoHardwareWrapperARMMac_test.cpp
    │   │   │   │   ├── sysInfoHardwareWrapperARMMac_test.h
    │   │   │   │   ├── sysInfoHardwareWrapperMac_test.cpp
    │   │   │   │   └── sysInfoHardwareWrapperMac_test.h
    │   │   │   ├── sysInfoNetworkBSD/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoNetworkBSD_test.cpp
    │   │   │   │   └── sysInfoNetworkBSD_test.h
    │   │   │   ├── sysInfoNetworkLinux/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoNetworkLinux_test.cpp
    │   │   │   │   └── sysInfoNetworkLinux_test.h
    │   │   │   ├── sysInfoNetworkWindows/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoNetworkWindows_test.cpp
    │   │   │   │   └── sysInfoNetworkWindows_test.h
    │   │   │   ├── sysInfoPackageLinuxParserRpm/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoPackageLinuxParserRPM_test.cpp
    │   │   │   │   └── sysInfoPackageLinuxParserRPM_test.hpp
    │   │   │   ├── sysInfoPackages/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoPackagesNPM_test.cpp
    │   │   │   │   ├── sysInfoPackagesNPM_test.hpp
    │   │   │   │   ├── sysInfoPackagesPYPI_test.cpp
    │   │   │   │   └── sysInfoPackagesPYPI_test.hpp
    │   │   │   ├── sysInfoPackagesBerkeleyDB/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoPackagesBerkeleyDB_test.cpp
    │   │   │   │   └── sysInfoPackagesBerkeleyDB_test.h
    │   │   │   ├── sysInfoPackagesLinuxHelper/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoPackagesLinuxHelper_test.cpp
    │   │   │   │   └── sysInfoPackagesLinuxHelper_test.h
    │   │   │   ├── sysInfoPackagesMAC/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── pkgWrapper_test.cpp
    │   │   │   │   ├── pkgWrapper_test.h
    │   │   │   │   ├── sysInfoMacPackages_test.cpp
    │   │   │   │   ├── sysInfoMacPackages_test.h
    │   │   │   │   └── input_files/
    │   │   │   │       ├── com.wazuh.pkg.wazuh-agent.plist
    │   │   │   │       ├── org.R-project.x86_64.R.GUI.pkg.plist
    │   │   │   │       ├── us.zoom.pkg.videomeeting.plist
    │   │   │   │       ├── PKGWrapperTest_LongVersion.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NameDifferentExecutable.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NameFirst.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NoDescription.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NoGroups.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NoNameButExecutable.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NoNameNoExecutable.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NoVendor.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       ├── PKGWrapperTest_NoVersion.app/
    │   │   │   │       │   └── Contents/
    │   │   │   │       │       └── Info.plist
    │   │   │   │       └── PKGWrapperTest_ShortVersion.app/
    │   │   │   │           └── Contents/
    │   │   │   │               └── Info.plist
    │   │   │   ├── sysInfoPorts/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── sysInfoPort_test.cpp
    │   │   │   │   └── sysInfoPort_test.h
    │   │   │   ├── sysInfoRpmPackageManager/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── RpmPackageManager_test.cpp
    │   │   │   │   └── RpmPackageManager_test.h
    │   │   │   └── sysInfoWin/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── main.cpp
    │   │   │       ├── sysInfoWin_test.cpp
    │   │   │       └── sysInfoWin_test.h
    │   │   └── testtool/
    │   │       ├── Readme.md
    │   │       ├── CMakeLists.txt
    │   │       ├── cmdLineActions.h
    │   │       └── main.cpp
    │   ├── engine/
    │   │   ├── apidoc.json
    │   │   ├── CMakeLists.txt
    │   │   ├── COPYING-engine
    │   │   ├── LICENSE-engine
    │   │   ├── .clang-format
    │   │   ├── .clang-tidy
    │   │   ├── docs/
    │   │   │   └── Doxyfile.in
    │   │   ├── internal_packages/
    │   │   │   ├── build.sh
    │   │   │   ├── generate_package.sh
    │   │   │   ├── test_package.sh
    │   │   │   ├── debs/
    │   │   │   │   ├── Dockerfile
    │   │   │   │   └── SPECS/
    │   │   │   │       ├── build_venv.sh
    │   │   │   │       ├── changelog
    │   │   │   │       ├── conffiles
    │   │   │   │       ├── control
    │   │   │   │       ├── copyright
    │   │   │   │       ├── postinst
    │   │   │   │       ├── postrm
    │   │   │   │       ├── preinst
    │   │   │   │       ├── prerm
    │   │   │   │       ├── rules
    │   │   │   │       ├── wazuh-internal-tools.links
    │   │   │   │       └── source/
    │   │   │   │           └── format
    │   │   │   └── rpms/
    │   │   │       ├── Dockerfile
    │   │   │       └── SPECS/
    │   │   │           └── wazuh-internal-tools.spec
    │   │   ├── ruleset/
    │   │   │   ├── outputs/
    │   │   │   │   ├── file-output-integrations.yml
    │   │   │   │   └── indexer.yml
    │   │   │   └── schemas/
    │   │   │       ├── allowed-fields.json
    │   │   │       ├── ecs_types.json
    │   │   │       ├── engine-schema.json
    │   │   │       ├── enrichment-geo.json
    │   │   │       ├── exclude-enrichment-geo.json
    │   │   │       ├── wazuh-decoders.template.json
    │   │   │       ├── wazuh-filters.json
    │   │   │       └── wazuh-logpar-overrides.json
    │   │   ├── source/
    │   │   │   ├── main.cpp
    │   │   │   ├── stackExecutor.hpp
    │   │   │   ├── api/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── adapter/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── adapter/
    │   │   │   │   │   │           ├── adapter.hpp
    │   │   │   │   │   │           └── helpers.hpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       ├── include/
    │   │   │   │   │       │   └── api/
    │   │   │   │   │       │       └── adapter/
    │   │   │   │   │       │           └── baseHandler_test.hpp
    │   │   │   │   │       └── src/
    │   │   │   │   │           ├── generic_request.pb.cc
    │   │   │   │   │           ├── generic_request.pb.h
    │   │   │   │   │           ├── generic_request.proto
    │   │   │   │   │           └── unit/
    │   │   │   │   │               └── adapter_test.cpp
    │   │   │   │   ├── archiver/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── archiver/
    │   │   │   │   │   │           └── handlers.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   └── handlers.cpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── unit/
    │   │   │   │   │               └── handlers_test.cpp
    │   │   │   │   ├── cmcrud/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── cmcrud/
    │   │   │   │   │   │           └── handlers.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   └── handlers.cpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── unit/
    │   │   │   │   │               └── handlers_test.cpp
    │   │   │   │   ├── event/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── event/
    │   │   │   │   │   │           ├── handlers.hpp
    │   │   │   │   │   │           └── ndJsonParser.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   └── handlers.cpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── unit/
    │   │   │   │   │               ├── handlers_test.cpp
    │   │   │   │   │               └── ndJsonParser_test.cpp
    │   │   │   │   ├── geo/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── geo/
    │   │   │   │   │   │           └── handlers.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   └── handlers.cpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── unit/
    │   │   │   │   │               └── handlers_test.cpp
    │   │   │   │   ├── include/
    │   │   │   │   │   └── api/
    │   │   │   │   │       └── handlers.hpp
    │   │   │   │   ├── rawevtindexer/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── rawevtindexer/
    │   │   │   │   │   │           └── handlers.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   └── handlers.cpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── unit/
    │   │   │   │   │               └── handlers_test.cpp
    │   │   │   │   ├── router/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── include/
    │   │   │   │   │   │   └── api/
    │   │   │   │   │   │       └── router/
    │   │   │   │   │   │           └── handlers.hpp
    │   │   │   │   │   ├── src/
    │   │   │   │   │   │   └── handlers.cpp
    │   │   │   │   │   └── test/
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── unit/
    │   │   │   │   │               └── handlers_test.cpp
    │   │   │   │   ├── shared/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   └── include/
    │   │   │   │   │       └── api/
    │   │   │   │   │           └── shared/
    │   │   │   │   │               └── constants.hpp
    │   │   │   │   └── tester/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── include/
    │   │   │   │       │   └── api/
    │   │   │   │       │       └── tester/
    │   │   │   │       │           └── handlers.hpp
    │   │   │   │       ├── src/
    │   │   │   │       │   └── handlers.cpp
    │   │   │   │       └── test/
    │   │   │   │           └── src/
    │   │   │   │               └── unit/
    │   │   │   │                   └── handlers_test.cpp
    │   │   │   ├── archiver/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── archiver/
    │   │   │   │   │       └── archiver.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── archiver/
    │   │   │   │   │       └── iarchiver.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── archiver.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── archiver/
    │   │   │   │       │       └── mockArchiver.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               └── archiver_test.cpp
    │   │   │   ├── base/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── benchmark/
    │   │   │   │   │   └── src/
    │   │   │   │   │       └── eventParser_bench.cpp
    │   │   │   │   ├── include/
    │   │   │   │   │   └── base/
    │   │   │   │   │       ├── baseTypes.hpp
    │   │   │   │   │       ├── dotPath.hpp
    │   │   │   │   │       ├── error.hpp
    │   │   │   │   │       ├── eventParser.hpp
    │   │   │   │   │       ├── expression.hpp
    │   │   │   │   │       ├── graph.hpp
    │   │   │   │   │       ├── json.hpp
    │   │   │   │   │       ├── libwazuhshared.hpp
    │   │   │   │   │       ├── logging.hpp
    │   │   │   │   │       ├── lruCache.hpp
    │   │   │   │   │       ├── name.hpp
    │   │   │   │   │       ├── process.hpp
    │   │   │   │   │       ├── result.hpp
    │   │   │   │   │       ├── timer.hpp
    │   │   │   │   │       ├── ymlFormat.hpp
    │   │   │   │   │       └── utils/
    │   │   │   │   │           ├── communityId.hpp
    │   │   │   │   │           ├── defer.hpp
    │   │   │   │   │           ├── generator.hpp
    │   │   │   │   │           ├── getExceptionStack.hpp
    │   │   │   │   │           ├── hash.hpp
    │   │   │   │   │           ├── ipUtils.hpp
    │   │   │   │   │           ├── observer.hpp
    │   │   │   │   │           ├── provider.hpp
    │   │   │   │   │           ├── sanitizers.hpp
    │   │   │   │   │           ├── singletonLocator.hpp
    │   │   │   │   │           ├── singletonLocatorStrategies.hpp
    │   │   │   │   │           ├── stringUtils.hpp
    │   │   │   │   │           ├── subscriber.hpp
    │   │   │   │   │           └── timeUtils.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── eventParser.cpp
    │   │   │   │   │   ├── expression.cpp
    │   │   │   │   │   ├── json.cpp
    │   │   │   │   │   ├── libwazuhshared.cpp
    │   │   │   │   │   ├── logging.cpp
    │   │   │   │   │   ├── process.cpp
    │   │   │   │   │   └── utils/
    │   │   │   │   │       ├── communityId.cpp
    │   │   │   │   │       ├── ipUtils.cpp
    │   │   │   │   │       ├── stringUtils.cpp
    │   │   │   │   │       └── timeUtils.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── include/
    │   │   │   │       │   └── base/
    │   │   │   │       │       ├── behaviour.hpp
    │   │   │   │       │       ├── functionExecutor.hpp
    │   │   │   │       │       ├── mockSingletonManager.hpp
    │   │   │   │       │       └── threadSynchronizer.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               ├── dotPath_test.cpp
    │   │   │   │               ├── error_test.cpp
    │   │   │   │               ├── eventParser_test.cpp
    │   │   │   │               ├── expression_test.cpp
    │   │   │   │               ├── graph_test.cpp
    │   │   │   │               ├── ipUtils_test.cpp
    │   │   │   │               ├── json_test.cpp
    │   │   │   │               ├── logger_test.cpp
    │   │   │   │               ├── name_test.cpp
    │   │   │   │               ├── process_test.cpp
    │   │   │   │               ├── result_test.cpp
    │   │   │   │               ├── stringUtils_test.cpp
    │   │   │   │               ├── timer_test.cpp
    │   │   │   │               └── utils/
    │   │   │   │                   ├── communityId_test.cpp
    │   │   │   │                   ├── singletonLocator_test.cpp
    │   │   │   │                   └── timeUtils_test.cpp
    │   │   │   ├── bk/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── bk/
    │   │   │   │   │       ├── rx/
    │   │   │   │   │       │   └── controller.hpp
    │   │   │   │   │       └── taskf/
    │   │   │   │   │           └── controller.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── bk/
    │   │   │   │   │       └── icontroller.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── rx/
    │   │   │   │   │   │   ├── controller.cpp
    │   │   │   │   │   │   ├── exprBuilder.hpp
    │   │   │   │   │   │   └── tracer.hpp
    │   │   │   │   │   └── taskf/
    │   │   │   │   │       ├── controller.cpp
    │   │   │   │   │       ├── exprBuilder.hpp
    │   │   │   │   │       └── tracer.hpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── bk/
    │   │   │   │       │       └── mockController.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── component/
    │   │   │   │               ├── bk_test.cpp
    │   │   │   │               └── bk_test.hpp
    │   │   │   ├── builder/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── builder/
    │   │   │   │   │       ├── allowedFields.hpp
    │   │   │   │   │       └── builder.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── builder/
    │   │   │   │   │       ├── iallowedFields.hpp
    │   │   │   │   │       ├── ibuilder.hpp
    │   │   │   │   │       ├── ipolicy.hpp
    │   │   │   │   │       └── ivalidator.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── allowedFields.cpp
    │   │   │   │   │   ├── builder.cpp
    │   │   │   │   │   ├── iregistry.hpp
    │   │   │   │   │   ├── register.hpp
    │   │   │   │   │   ├── registry.hpp
    │   │   │   │   │   ├── syntax.hpp
    │   │   │   │   │   ├── builders/
    │   │   │   │   │   │   ├── argument.hpp
    │   │   │   │   │   │   ├── baseHelper.cpp
    │   │   │   │   │   │   ├── baseHelper.hpp
    │   │   │   │   │   │   ├── buildCtx.hpp
    │   │   │   │   │   │   ├── builders.hpp
    │   │   │   │   │   │   ├── helperParser.hpp
    │   │   │   │   │   │   ├── ibuildCtx.hpp
    │   │   │   │   │   │   ├── types.hpp
    │   │   │   │   │   │   ├── utils.hpp
    │   │   │   │   │   │   ├── enrichment/
    │   │   │   │   │   │   │   ├── enrichment.cpp
    │   │   │   │   │   │   │   ├── enrichment.hpp
    │   │   │   │   │   │   │   └── geo.cpp
    │   │   │   │   │   │   ├── opfilter/
    │   │   │   │   │   │   │   ├── exists.cpp
    │   │   │   │   │   │   │   ├── exists.hpp
    │   │   │   │   │   │   │   ├── filter.cpp
    │   │   │   │   │   │   │   ├── filter.hpp
    │   │   │   │   │   │   │   ├── opBuilderHelperFilter.cpp
    │   │   │   │   │   │   │   ├── opBuilderHelperFilter.hpp
    │   │   │   │   │   │   │   ├── startsWith.cpp
    │   │   │   │   │   │   │   └── startsWith.hpp
    │   │   │   │   │   │   ├── opmap/
    │   │   │   │   │   │   │   ├── kvdb.cpp
    │   │   │   │   │   │   │   ├── kvdb.hpp
    │   │   │   │   │   │   │   ├── map.cpp
    │   │   │   │   │   │   │   ├── map.hpp
    │   │   │   │   │   │   │   ├── mmdb.cpp
    │   │   │   │   │   │   │   ├── mmdb.hpp
    │   │   │   │   │   │   │   ├── opBuilderHelperMap.cpp
    │   │   │   │   │   │   │   └── opBuilderHelperMap.hpp
    │   │   │   │   │   │   ├── optransform/
    │   │   │   │   │   │   │   ├── array.cpp
    │   │   │   │   │   │   │   ├── array.hpp
    │   │   │   │   │   │   │   ├── hlp.cpp
    │   │   │   │   │   │   │   ├── hlp.hpp
    │   │   │   │   │   │   │   ├── windows.cpp
    │   │   │   │   │   │   │   └── windows.hpp
    │   │   │   │   │   │   └── stage/
    │   │   │   │   │   │       ├── check.cpp
    │   │   │   │   │   │       ├── check.hpp
    │   │   │   │   │   │       ├── fileOutput.cpp
    │   │   │   │   │   │       ├── fileOutput.hpp
    │   │   │   │   │   │       ├── first_of.cpp
    │   │   │   │   │   │       ├── first_of.hpp
    │   │   │   │   │   │       ├── indexerOutput.cpp
    │   │   │   │   │   │       ├── indexerOutput.hpp
    │   │   │   │   │   │       ├── map.cpp
    │   │   │   │   │   │       ├── map.hpp
    │   │   │   │   │   │       ├── normalize.cpp
    │   │   │   │   │   │       ├── normalize.hpp
    │   │   │   │   │   │       ├── outputs.cpp
    │   │   │   │   │   │       ├── outputs.hpp
    │   │   │   │   │   │       ├── parse.cpp
    │   │   │   │   │   │       └── parse.hpp
    │   │   │   │   │   └── policy/
    │   │   │   │   │       ├── asset.hpp
    │   │   │   │   │       ├── assetBuilder.cpp
    │   │   │   │   │       ├── assetBuilder.hpp
    │   │   │   │   │       ├── factory.cpp
    │   │   │   │   │       ├── factory.hpp
    │   │   │   │   │       ├── iassetBuilder.hpp
    │   │   │   │   │       ├── policy.cpp
    │   │   │   │   │       └── policy.hpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── builder/
    │   │   │   │       │       ├── mockAllowedFields.hpp
    │   │   │   │       │       ├── mockBuilder.hpp
    │   │   │   │       │       ├── mockPolicy.hpp
    │   │   │   │       │       └── mockValidator.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── expressionCmp.hpp
    │   │   │   │           ├── component/
    │   │   │   │           │   ├── builder_test.cpp
    │   │   │   │           │   ├── definitions.hpp
    │   │   │   │           │   └── validator_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── allowedFields_test.cpp
    │   │   │   │               ├── mockBuildCtx.hpp
    │   │   │   │               ├── mockRegistry.hpp
    │   │   │   │               ├── registry_test.cpp
    │   │   │   │               ├── builders/
    │   │   │   │               │   ├── baseBuilders_test.cpp
    │   │   │   │               │   ├── baseBuilders_test.hpp
    │   │   │   │               │   ├── helperParser_test.cpp
    │   │   │   │               │   ├── opfilter/
    │   │   │   │               │   │   ├── arrayContains_test.cpp
    │   │   │   │               │   │   ├── endsWith_test.cpp
    │   │   │   │               │   │   ├── exists_test.cpp
    │   │   │   │               │   │   ├── filter_test.cpp
    │   │   │   │               │   │   ├── intCmp_test.cpp
    │   │   │   │               │   │   ├── ip_test.cpp
    │   │   │   │               │   │   ├── is_ipv4_test.cpp
    │   │   │   │               │   │   ├── is_ipv6_test.cpp
    │   │   │   │               │   │   ├── is_test_session_test.cpp
    │   │   │   │               │   │   ├── keys_exist_in_list_test.cpp
    │   │   │   │               │   │   ├── match_test.cpp
    │   │   │   │               │   │   ├── numberCmp_test.cpp
    │   │   │   │               │   │   ├── regex_test.cpp
    │   │   │   │               │   │   ├── startsWith_test.cpp
    │   │   │   │               │   │   ├── strCmp_test.cpp
    │   │   │   │               │   │   └── types_test.cpp
    │   │   │   │               │   ├── opmap/
    │   │   │   │               │   │   ├── array_extract_key_obj_test.cpp
    │   │   │   │               │   │   ├── arrayObj_to_MapKv_test.cpp
    │   │   │   │               │   │   ├── floatCalc_test.cpp
    │   │   │   │               │   │   ├── hash_test.cpp
    │   │   │   │               │   │   ├── iana_protocol_test.cpp
    │   │   │   │               │   │   ├── intCalc_test.cpp
    │   │   │   │               │   │   ├── ip_test.cpp
    │   │   │   │               │   │   ├── kvdb_test.cpp
    │   │   │   │               │   │   ├── map_test.cpp
    │   │   │   │               │   │   ├── mmdb_test.cpp
    │   │   │   │               │   │   ├── networkCommunityId_test.cpp
    │   │   │   │               │   │   ├── regex_test.cpp
    │   │   │   │               │   │   ├── strTransform_test.cpp
    │   │   │   │               │   │   ├── syslogFacilityAndSeverityName_test.cpp
    │   │   │   │               │   │   ├── time_test.cpp
    │   │   │   │               │   │   ├── toBool_test.cpp
    │   │   │   │               │   │   └── toInt_test.cpp
    │   │   │   │               │   ├── optransform/
    │   │   │   │               │   │   ├── array_test.cpp
    │   │   │   │               │   │   ├── hlp_test.cpp
    │   │   │   │               │   │   ├── jsonTransform_test.cpp
    │   │   │   │               │   │   ├── objectGet_test.cpp
    │   │   │   │               │   │   ├── scaInternal_test.cpp
    │   │   │   │               │   │   ├── strTransform_test.cpp
    │   │   │   │               │   │   └── windows_test.cpp
    │   │   │   │               │   └── stage/
    │   │   │   │               │       ├── check_test.cpp
    │   │   │   │               │       ├── fileOutput_test.cpp
    │   │   │   │               │       ├── first_of_test.cpp
    │   │   │   │               │       ├── indexerOutput_test.cpp
    │   │   │   │               │       ├── map_test.cpp
    │   │   │   │               │       ├── normalize_test.cpp
    │   │   │   │               │       ├── outputs_test.cpp
    │   │   │   │               │       └── parse_test.cpp
    │   │   │   │               └── policy/
    │   │   │   │                   ├── assetBuilder_test.cpp
    │   │   │   │                   ├── factory_test.cpp
    │   │   │   │                   ├── factory_test.hpp
    │   │   │   │                   └── mockAssetBuilder.hpp
    │   │   │   ├── cmcrud/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── cmcrud/
    │   │   │   │   │       └── cmcrudservice.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── cmcrud/
    │   │   │   │   │       └── icmcrudservice.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── cmcrudservice.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── cmcrud/
    │   │   │   │       │       └── mockcmcrud.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── cmcrud_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               └── cmcrudservice_test.cpp
    │   │   │   ├── cmstore/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── benchmark/
    │   │   │   │   │   └── src/
    │   │   │   │   │       └── cmsync_bench.cpp
    │   │   │   │   ├── include/
    │   │   │   │   │   └── cmstore/
    │   │   │   │   │       └── cmstore.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── cmstore/
    │   │   │   │   │       ├── categories.hpp
    │   │   │   │   │       ├── dataintegration.hpp
    │   │   │   │   │       ├── datakvdb.hpp
    │   │   │   │   │       ├── datapolicy.hpp
    │   │   │   │   │       ├── detail.hpp
    │   │   │   │   │       ├── icmstore.hpp
    │   │   │   │   │       └── types.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── cachens.cpp
    │   │   │   │   │   ├── cachens.hpp
    │   │   │   │   │   ├── cmstore.cpp
    │   │   │   │   │   ├── fileutils.hpp
    │   │   │   │   │   ├── storens.cpp
    │   │   │   │   │   └── storens.hpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── cmstore/
    │   │   │   │       │       └── mockcmstore.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── cmstore_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── cachens_test.cpp
    │   │   │   │               └── cmstore_test.cpp
    │   │   │   ├── cmsync/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── cmsync/
    │   │   │   │   │       └── cmsync.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── cmsync/
    │   │   │   │   │       └── icmsync.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── cmsync.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── cmsync/
    │   │   │   │       │       └── mockcmsync.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── cmsync_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               └── cmsync_test.cpp
    │   │   │   ├── conf/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── conf/
    │   │   │   │   │       ├── conf.hpp
    │   │   │   │   │       ├── fileLoader.hpp
    │   │   │   │   │       ├── keys.hpp
    │   │   │   │   │       └── unitconf.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── conf.cpp
    │   │   │   │   │   └── fileLoader.cpp
    │   │   │   │   └── test/
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── fileLoader_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── conf_test.cpp
    │   │   │   │               ├── mockFileLoader.hpp
    │   │   │   │               ├── unitconf_test.cpp
    │   │   │   │               └── utils.hpp
    │   │   │   ├── defs/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── defs/
    │   │   │   │   │       └── defs.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── defs/
    │   │   │   │   │       └── idefinitions.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── defs.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── defs/
    │   │   │   │       │       ├── failDef.hpp
    │   │   │   │       │       ├── mockDefinitions.hpp
    │   │   │   │       │       └── singleDef.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               └── defs_test.cpp
    │   │   │   ├── fastqueue/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── benchmark/
    │   │   │   │   │   ├── README.md
    │   │   │   │   │   └── src/
    │   │   │   │   │       ├── comparison_bench.cpp
    │   │   │   │   │       ├── cqueue_bench.cpp
    │   │   │   │   │       └── stdqueue_bench.cpp
    │   │   │   │   ├── include/
    │   │   │   │   │   └── fastqueue/
    │   │   │   │   │       ├── cqueue.hpp
    │   │   │   │   │       ├── ratelimiter.hpp
    │   │   │   │   │       └── stdqueue.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── fastqueue/
    │   │   │   │   │       └── iqueue.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── cqueue.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── queue/
    │   │   │   │       │       └── mockQueue.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── component/
    │   │   │   │               ├── cqueue_test.cpp
    │   │   │   │               └── stdqueue_test.cpp
    │   │   │   ├── geo/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── geo/
    │   │   │   │   │       ├── downloader.hpp
    │   │   │   │   │       └── manager.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── geo/
    │   │   │   │   │       ├── idownloader.hpp
    │   │   │   │   │       ├── ilocator.hpp
    │   │   │   │   │       └── imanager.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── dbHandle.hpp
    │   │   │   │   │   ├── dbInstance.hpp
    │   │   │   │   │   ├── downloader.cpp
    │   │   │   │   │   ├── locator.cpp
    │   │   │   │   │   ├── locator.hpp
    │   │   │   │   │   └── manager.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── geo/
    │   │   │   │       │       ├── mockLocator.hpp
    │   │   │   │       │       └── mockManager.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── generateTestDB.pl
    │   │   │   │           ├── mockDownloader.hpp
    │   │   │   │           ├── testdb.mmdb
    │   │   │   │           ├── component/
    │   │   │   │           │   └── manager_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── locator_test.cpp
    │   │   │   │               └── manager_test.cpp
    │   │   │   ├── hlp/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── hlp/
    │   │   │   │   │       ├── abstractParser.hpp
    │   │   │   │   │       ├── hlp.hpp
    │   │   │   │   │       └── parser.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── syntax.hpp
    │   │   │   │   │   └── parsers/
    │   │   │   │   │       ├── alphanumeric.cpp
    │   │   │   │   │       ├── between.cpp
    │   │   │   │   │       ├── bool.cpp
    │   │   │   │   │       ├── date.cpp
    │   │   │   │   │       ├── dsv_csv.cpp
    │   │   │   │   │       ├── encodings.cpp
    │   │   │   │   │       ├── eof.cpp
    │   │   │   │   │       ├── file.cpp
    │   │   │   │   │       ├── ignore.cpp
    │   │   │   │   │       ├── ip.cpp
    │   │   │   │   │       ├── json.cpp
    │   │   │   │   │       ├── kvmap.cpp
    │   │   │   │   │       ├── literal.cpp
    │   │   │   │   │       ├── number.cpp
    │   │   │   │   │       ├── number.hpp
    │   │   │   │   │       ├── parse_field.cpp
    │   │   │   │   │       ├── parse_field.hpp
    │   │   │   │   │       ├── quoted.cpp
    │   │   │   │   │       ├── text.cpp
    │   │   │   │   │       ├── web.cpp
    │   │   │   │   │       └── xml.cpp
    │   │   │   │   └── test/
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               ├── alnum_test.cpp
    │   │   │   │               ├── between_test.cpp
    │   │   │   │               ├── binary_test.cpp
    │   │   │   │               ├── bool_test.cpp
    │   │   │   │               ├── date_test.cpp
    │   │   │   │               ├── dsv_csv_test.cpp
    │   │   │   │               ├── eof_test.cpp
    │   │   │   │               ├── file_test.cpp
    │   │   │   │               ├── hlp_test.cpp
    │   │   │   │               ├── hlp_test.hpp
    │   │   │   │               ├── ignore_test.cpp
    │   │   │   │               ├── ip_test.cpp
    │   │   │   │               ├── json_test.cpp
    │   │   │   │               ├── kvmap_test.cpp
    │   │   │   │               ├── literal_test.cpp
    │   │   │   │               ├── numeric_test.cpp
    │   │   │   │               ├── quoted_test.cpp
    │   │   │   │               ├── text_test.cpp
    │   │   │   │               ├── web_test.cpp
    │   │   │   │               └── xml_test.cpp
    │   │   │   ├── httpsrv/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── httpsrv/
    │   │   │   │   │       └── server.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── httpsrv/
    │   │   │   │   │       └── iserver.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── server.cpp
    │   │   │   │   └── test/
    │   │   │   │       └── src/
    │   │   │   │           ├── generic_request.pb.cc
    │   │   │   │           ├── generic_request.pb.h
    │   │   │   │           ├── generic_request.proto
    │   │   │   │           ├── component/
    │   │   │   │           │   └── server_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               └── server_test.cpp
    │   │   │   ├── kvdbioc/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── kvdbioc/
    │   │   │   │   │       ├── dbHandle.hpp
    │   │   │   │   │       ├── dbInstance.hpp
    │   │   │   │   │       └── manager.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── kvdbioc/
    │   │   │   │   │       ├── helpers.hpp
    │   │   │   │   │       ├── iManager.hpp
    │   │   │   │   │       ├── iReadOnlyHandler.hpp
    │   │   │   │   │       └── types.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── dbHandle.cpp
    │   │   │   │   │   ├── dbInstance.cpp
    │   │   │   │   │   └── manager.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── kvdbioc/
    │   │   │   │       │       ├── mockManager.hpp
    │   │   │   │       │       └── mockReadOnlyHandler.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── kvdb_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── kvdb_handler_test.cpp
    │   │   │   │               └── kvdb_manager_test.cpp
    │   │   │   ├── kvdbstore/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── kvdbstore/
    │   │   │   │   │       ├── kvdbHandler.hpp
    │   │   │   │   │       └── kvdbManager.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── kvdbstore/
    │   │   │   │   │       ├── ikvdbhandler.hpp
    │   │   │   │   │       └── ikvdbmanager.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── kvdbHandler.cpp
    │   │   │   │   │   └── kvdbManager.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── kvdbstore/
    │   │   │   │       │       ├── mockKvdbHandler.hpp
    │   │   │   │       │       └── mockKvdbManager.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── kvdb_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── kvdb_handler_test.cpp
    │   │   │   │               └── kvdb_manager_test.cpp
    │   │   │   ├── logicexpr/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── logicexpr/
    │   │   │   │   │       ├── evaluator.hpp
    │   │   │   │   │       ├── logicexpr.hpp
    │   │   │   │   │       ├── parser.hpp
    │   │   │   │   │       ├── token.hpp
    │   │   │   │   │       └── tokenizer.hpp
    │   │   │   │   └── test/
    │   │   │   │       └── src/
    │   │   │   │           ├── evaluator_test.cpp
    │   │   │   │           ├── logicexpr_test.cpp
    │   │   │   │           ├── parser_test.cpp
    │   │   │   │           ├── token_test.cpp
    │   │   │   │           └── tokenizer_test.cpp
    │   │   │   ├── logpar/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── logpar/
    │   │   │   │   │       ├── logpar.hpp
    │   │   │   │   │       └── registerParsers.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── logpar.cpp
    │   │   │   │   └── test/
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               ├── logpar_test.cpp
    │   │   │   │               └── logpar_test.hpp
    │   │   │   ├── metrics/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── metrics/
    │   │   │   │   │       └── manager.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── metrics/
    │   │   │   │   │       ├── imanager.hpp
    │   │   │   │   │       └── imetric.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── manager.cpp
    │   │   │   │   │   ├── ot.hpp
    │   │   │   │   │   ├── otLogger.hpp
    │   │   │   │   │   ├── exporter/
    │   │   │   │   │   │   ├── indexerMetricsExporter.cpp
    │   │   │   │   │   │   ├── indexerMetricsExporter.hpp
    │   │   │   │   │   │   ├── metricSerializer.hpp
    │   │   │   │   │   │   ├── pointDataSerializer.hpp
    │   │   │   │   │   │   └── scopeSerializer.hpp
    │   │   │   │   │   └── metric/
    │   │   │   │   │       ├── allMetrics.hpp
    │   │   │   │   │       ├── doubleCounter.hpp
    │   │   │   │   │       ├── doubleHistogram.hpp
    │   │   │   │   │       ├── intUpDownCounter.hpp
    │   │   │   │   │       ├── metric.hpp
    │   │   │   │   │       ├── uIntCounter.hpp
    │   │   │   │   │       └── uIntHistogram.hpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── metrics/
    │   │   │   │       │       ├── mockManager.hpp
    │   │   │   │       │       ├── mockMetric.hpp
    │   │   │   │       │       ├── noOpManager.hpp
    │   │   │   │       │       └── noOpMetric.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── metrics_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── main.cpp
    │   │   │   │               ├── manager_test.cpp
    │   │   │   │               ├── mocks_test.cpp
    │   │   │   │               ├── exporter/
    │   │   │   │               │   └── indexerMetricsExporter_test.cpp
    │   │   │   │               └── metrics/
    │   │   │   │                   └── metrics_test.cpp
    │   │   │   ├── parsec/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── parsec/
    │   │   │   │   │       └── parsec.hpp
    │   │   │   │   └── test/
    │   │   │   │       └── src/
    │   │   │   │           └── parsec_test.cpp
    │   │   │   ├── proto/
    │   │   │   │   ├── readme.md
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── generateCode.sh
    │   │   │   │   ├── include/
    │   │   │   │   │   └── eMessages/
    │   │   │   │   │       ├── readme.md
    │   │   │   │   │       ├── archiver.pb.cc
    │   │   │   │   │       ├── archiver.pb.h
    │   │   │   │   │       ├── crud.pb.cc
    │   │   │   │   │       ├── crud.pb.h
    │   │   │   │   │       ├── eMessage.h
    │   │   │   │   │       ├── engine.pb.cc
    │   │   │   │   │       ├── engine.pb.h
    │   │   │   │   │       ├── geo.pb.cc
    │   │   │   │   │       ├── geo.pb.h
    │   │   │   │   │       ├── graph.pb.cc
    │   │   │   │   │       ├── graph.pb.h
    │   │   │   │   │       ├── metrics.pb.cc
    │   │   │   │   │       ├── metrics.pb.h
    │   │   │   │   │       ├── rawevtindexer.pb.cc
    │   │   │   │   │       ├── rawevtindexer.pb.h
    │   │   │   │   │       ├── request_response.pb.cc
    │   │   │   │   │       ├── request_response.pb.h
    │   │   │   │   │       ├── router.pb.cc
    │   │   │   │   │       ├── router.pb.h
    │   │   │   │   │       ├── tester.pb.cc
    │   │   │   │   │       └── tester.pb.h
    │   │   │   │   └── src/
    │   │   │   │       ├── archiver.proto
    │   │   │   │       ├── crud.proto
    │   │   │   │       ├── engine.proto
    │   │   │   │       ├── geo.proto
    │   │   │   │       ├── graph.proto
    │   │   │   │       ├── metrics.proto
    │   │   │   │       ├── rawevtindexer.proto
    │   │   │   │       ├── request_response.proto
    │   │   │   │       ├── router.proto
    │   │   │   │       └── tester.proto
    │   │   │   ├── queue/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── queue/
    │   │   │   │   │       └── concurrentQueue.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── queue/
    │   │   │   │   │       └── iqueue.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── concurrentQueue.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── queue/
    │   │   │   │       │       └── mockQueue.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── component/
    │   │   │   │               └── queue_test.cpp
    │   │   │   ├── rawevtindexer/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── rawevtindexer/
    │   │   │   │   │       └── raweventindexer.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── rawevtindexer/
    │   │   │   │   │       └── iraweventindexer.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── raweventindexer.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── rawevtindexer/
    │   │   │   │       │       └── mockraweventindexer.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── raweventindexer_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               └── raweventindexer_test.cpp
    │   │   │   ├── router/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── router/
    │   │   │   │   │       └── orchestrator.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── router/
    │   │   │   │   │       ├── iapi.hpp
    │   │   │   │   │       └── types.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── entryConverter.cpp
    │   │   │   │   │   ├── entryConverter.hpp
    │   │   │   │   │   ├── environment.cpp
    │   │   │   │   │   ├── environment.hpp
    │   │   │   │   │   ├── environmentBuilder.hpp
    │   │   │   │   │   ├── epsCounter.hpp
    │   │   │   │   │   ├── irouter.hpp
    │   │   │   │   │   ├── itester.hpp
    │   │   │   │   │   ├── iworker.hpp
    │   │   │   │   │   ├── orchestrator.cpp
    │   │   │   │   │   ├── router.cpp
    │   │   │   │   │   ├── router.hpp
    │   │   │   │   │   ├── table.cpp
    │   │   │   │   │   ├── table.hpp
    │   │   │   │   │   ├── tester.cpp
    │   │   │   │   │   ├── tester.hpp
    │   │   │   │   │   ├── worker.cpp
    │   │   │   │   │   └── worker.hpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── router/
    │   │   │   │       │       ├── mockRouter.hpp
    │   │   │   │       │       └── mockTester.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   ├── fakeStore.hpp
    │   │   │   │           │   ├── router_test.cpp
    │   │   │   │           │   └── tester_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── entryConverter_test.cpp
    │   │   │   │               ├── environment_test.cpp
    │   │   │   │               ├── environmentBuilder_test.cpp
    │   │   │   │               ├── epsCounter_test.cpp
    │   │   │   │               ├── mockRouter.hpp
    │   │   │   │               ├── mockTester.hpp
    │   │   │   │               ├── mockWorker.hpp
    │   │   │   │               ├── orchestrator_test.cpp
    │   │   │   │               ├── router_test.cpp
    │   │   │   │               ├── table_test.cpp
    │   │   │   │               └── tester_test.cpp
    │   │   │   ├── scheduler/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── scheduler/
    │   │   │   │   │       └── scheduler.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── scheduler/
    │   │   │   │   │       └── ischeduler.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── scheduler.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── scheduler/
    │   │   │   │       │       └── mockScheduler.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── component/
    │   │   │   │               └── scheduler_test.cpp
    │   │   │   ├── schemf/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── schemf/
    │   │   │   │   │       ├── field.hpp
    │   │   │   │   │       └── schema.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── schemf/
    │   │   │   │   │       ├── ischema.hpp
    │   │   │   │   │       ├── ivalidator.hpp
    │   │   │   │   │       └── type.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── field.cpp
    │   │   │   │   │   ├── schema.cpp
    │   │   │   │   │   ├── validator.cpp
    │   │   │   │   │   ├── validator.hpp
    │   │   │   │   │   └── valueValidators.hpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── schemf/
    │   │   │   │       │       ├── emptySchema.hpp
    │   │   │   │       │       ├── mockSchema.hpp
    │   │   │   │       │       └── straightValidator.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   ├── schema_test.cpp
    │   │   │   │           │   └── validator_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               └── field_test.cpp
    │   │   │   ├── store/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── drivers/
    │   │   │   │   │   └── fileDriver/
    │   │   │   │   │       ├── include/
    │   │   │   │   │       │   └── store/
    │   │   │   │   │       │       └── drivers/
    │   │   │   │   │       │           └── fileDriver.hpp
    │   │   │   │   │       └── src/
    │   │   │   │   │           └── fileDriver.cpp
    │   │   │   │   ├── include/
    │   │   │   │   │   └── store/
    │   │   │   │   │       └── store.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── store/
    │   │   │   │   │       ├── idriver.hpp
    │   │   │   │   │       ├── istore.hpp
    │   │   │   │   │       └── utils.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── store.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── store/
    │   │   │   │       │       ├── mockDriver.hpp
    │   │   │   │       │       └── mockStore.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               ├── fileDriver_test.cpp
    │   │   │   │               └── store_test.cpp
    │   │   │   ├── streamlog/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── benchmark/
    │   │   │   │   │   ├── analyze_results.py
    │   │   │   │   │   └── src/
    │   │   │   │   │       └── async_vs_sync_bench.cpp
    │   │   │   │   ├── include/
    │   │   │   │   │   └── streamlog/
    │   │   │   │   │       └── logger.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── streamlog/
    │   │   │   │   │       └── ilogger.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── channel.cpp
    │   │   │   │   │   ├── channel.hpp
    │   │   │   │   │   └── logger.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── streamlog/
    │   │   │   │       │       └── mockStreamlog.hpp
    │   │   │   │       └── src/
    │   │   │   │           ├── component/
    │   │   │   │           │   └── logger_test.cpp
    │   │   │   │           └── unit/
    │   │   │   │               ├── channel_test.cpp
    │   │   │   │               └── logger_test.cpp
    │   │   │   ├── wiconnector/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── wiconnector/
    │   │   │   │   │       └── windexerconnector.hpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   └── wiconnector/
    │   │   │   │   │       └── iwindexerconnector.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── windexerconnector.cpp
    │   │   │   │   └── test/
    │   │   │   │       ├── mocks/
    │   │   │   │       │   └── wiconnector/
    │   │   │   │       │       └── mockswindexerconnector.hpp
    │   │   │   │       └── src/
    │   │   │   │           └── unit/
    │   │   │   │               └── wic_test.cpp
    │   │   │   └── yml/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── include/
    │   │   │       │   └── yml/
    │   │   │       │       └── yml.hpp
    │   │   │       ├── src/
    │   │   │       │   └── yml.cpp
    │   │   │       └── test/
    │   │   │           └── src/
    │   │   │               └── unit/
    │   │   │                   ├── testFile.yml
    │   │   │                   └── yml_test.cpp
    │   │   ├── standalone/
    │   │   │   ├── README.md
    │   │   │   ├── docker-entrypoint.sh
    │   │   │   ├── generate_package.sh
    │   │   │   └── run_engine.sh
    │   │   ├── test/
    │   │   │   ├── README.md
    │   │   │   ├── setupEnvironment.py
    │   │   │   ├── acceptance_test/
    │   │   │   │   ├── README.md
    │   │   │   │   ├── acceptance_test.sh
    │   │   │   │   ├── requirements.txt
    │   │   │   │   ├── analysisd/
    │   │   │   │   │   ├── config/
    │   │   │   │   │   │   ├── local_internal_options.conf
    │   │   │   │   │   │   └── ossec.conf
    │   │   │   │   │   └── ruleset/
    │   │   │   │   │       ├── decoders/
    │   │   │   │   │       │   └── decoder.xml
    │   │   │   │   │       └── rules/
    │   │   │   │   │           └── rule.xml
    │   │   │   │   ├── engine/
    │   │   │   │   │   └── ruleset/
    │   │   │   │   │       ├── decoders/
    │   │   │   │   │       │   └── decoder.yml
    │   │   │   │   │       ├── rules/
    │   │   │   │   │       │   └── rule.yml
    │   │   │   │   │       └── schemas/
    │   │   │   │   │           └── wazuh-decoders.json
    │   │   │   │   └── utils/
    │   │   │   │       ├── benchmark_tool.go
    │   │   │   │       ├── graphics_generator.py
    │   │   │   │       ├── monitor.py
    │   │   │   │       ├── process_stats.py
    │   │   │   │       ├── send_logs_n_measure_time.go
    │   │   │   │       ├── test_logs.txt
    │   │   │   │       └── utils.py
    │   │   │   ├── engine-test-utils/
    │   │   │   │   ├── README.md
    │   │   │   │   ├── pyproject.toml
    │   │   │   │   └── src/
    │   │   │   │       ├── api_utils/
    │   │   │   │       │   ├── __init__.py
    │   │   │   │       │   └── commands.py
    │   │   │   │       └── engine_handler/
    │   │   │   │           ├── __init__.py
    │   │   │   │           └── handler.py
    │   │   │   ├── helper_tests/
    │   │   │   │   ├── README.md
    │   │   │   │   ├── configuration_files/
    │   │   │   │   │   └── config.env
    │   │   │   │   ├── engine-helper-test/
    │   │   │   │   │   ├── pyproject.toml
    │   │   │   │   │   └── src/
    │   │   │   │   │       ├── generator_runner/
    │   │   │   │   │       │   ├── __init__.py
    │   │   │   │   │       │   └── __main__.py
    │   │   │   │   │       └── helper_test/
    │   │   │   │   │           ├── __init__.py
    │   │   │   │   │           ├── __main__.py
    │   │   │   │   │           ├── initial_state.py
    │   │   │   │   │           ├── runner.py
    │   │   │   │   │           ├── definition_types/
    │   │   │   │   │           │   ├── __init__.py
    │   │   │   │   │           │   ├── types.py
    │   │   │   │   │           │   └── utils.py
    │   │   │   │   │           ├── documentation_generator/
    │   │   │   │   │           │   ├── __init__.py
    │   │   │   │   │           │   ├── documentation.py
    │   │   │   │   │           │   ├── exporter.py
    │   │   │   │   │           │   ├── generate.py
    │   │   │   │   │           │   ├── html_generator.py
    │   │   │   │   │           │   ├── mark_down_generator.py
    │   │   │   │   │           │   ├── pdf_generator.py
    │   │   │   │   │           │   └── types.py
    │   │   │   │   │           └── test_cases_generator/
    │   │   │   │   │               ├── __init__.py
    │   │   │   │   │               ├── argument.py
    │   │   │   │   │               ├── buildtime_cases.py
    │   │   │   │   │               ├── generate.py
    │   │   │   │   │               ├── generator.py
    │   │   │   │   │               ├── parser.py
    │   │   │   │   │               ├── runtime_cases.py
    │   │   │   │   │               ├── template.py
    │   │   │   │   │               ├── test_data.py
    │   │   │   │   │               ├── validate.py
    │   │   │   │   │               └── validator.py
    │   │   │   │   ├── helpers_description/
    │   │   │   │   │   ├── filter/
    │   │   │   │   │   │   ├── array_contains.yml
    │   │   │   │   │   │   ├── array_contains_any.yml
    │   │   │   │   │   │   ├── array_not_contains.yml
    │   │   │   │   │   │   ├── array_not_contains_any.yml
    │   │   │   │   │   │   ├── binary_and.yml
    │   │   │   │   │   │   ├── contains.yml
    │   │   │   │   │   │   ├── ends_with.yml
    │   │   │   │   │   │   ├── exists.yml
    │   │   │   │   │   │   ├── exists_key_in.yml
    │   │   │   │   │   │   ├── int_equal.yml
    │   │   │   │   │   │   ├── int_greater.yml
    │   │   │   │   │   │   ├── int_greater_or_equal.yml
    │   │   │   │   │   │   ├── int_less.yml
    │   │   │   │   │   │   ├── int_less_or_equal.yml
    │   │   │   │   │   │   ├── int_not_equal.yml
    │   │   │   │   │   │   ├── ip_cidr_match.yml
    │   │   │   │   │   │   ├── is_array.yml
    │   │   │   │   │   │   ├── is_boolean.yml
    │   │   │   │   │   │   ├── is_ipv4.yml
    │   │   │   │   │   │   ├── is_ipv6.yml
    │   │   │   │   │   │   ├── is_not_array.yml
    │   │   │   │   │   │   ├── is_not_boolean.yml
    │   │   │   │   │   │   ├── is_not_null.yml
    │   │   │   │   │   │   ├── is_not_number.yml
    │   │   │   │   │   │   ├── is_not_object.yml
    │   │   │   │   │   │   ├── is_not_string.yml
    │   │   │   │   │   │   ├── is_null.yml
    │   │   │   │   │   │   ├── is_number.yml
    │   │   │   │   │   │   ├── is_object.yml
    │   │   │   │   │   │   ├── is_public_ip.yml
    │   │   │   │   │   │   ├── is_string.yml
    │   │   │   │   │   │   ├── is_test_session.yml
    │   │   │   │   │   │   ├── keys_exist_in_list.yml
    │   │   │   │   │   │   ├── kvdb_match.yml
    │   │   │   │   │   │   ├── kvdb_not_match.yml
    │   │   │   │   │   │   ├── match_value.yml
    │   │   │   │   │   │   ├── not_exists.yml
    │   │   │   │   │   │   ├── number_equal.yml
    │   │   │   │   │   │   ├── number_greater.yml
    │   │   │   │   │   │   ├── number_greater_or_equal.yml
    │   │   │   │   │   │   ├── number_less.yml
    │   │   │   │   │   │   ├── number_less_or_equal.yml
    │   │   │   │   │   │   ├── number_not_equal.yml
    │   │   │   │   │   │   ├── regex_match.yml
    │   │   │   │   │   │   ├── regex_not_match.yml
    │   │   │   │   │   │   ├── starts_with.yml
    │   │   │   │   │   │   ├── string_equal.yml
    │   │   │   │   │   │   ├── string_greater.yml
    │   │   │   │   │   │   ├── string_greater_or_equal.yml
    │   │   │   │   │   │   ├── string_less.yml
    │   │   │   │   │   │   ├── string_less_or_equal.yml
    │   │   │   │   │   │   └── string_not_equal.yml
    │   │   │   │   │   ├── map/
    │   │   │   │   │   │   ├── array_extract_key_obj.yml
    │   │   │   │   │   │   ├── arrayObj_to_MapKv.yml
    │   │   │   │   │   │   ├── as.yml
    │   │   │   │   │   │   ├── concat.yml
    │   │   │   │   │   │   ├── concat_any.yml
    │   │   │   │   │   │   ├── date_from_epoch.yml
    │   │   │   │   │   │   ├── date_to_epoch.yml
    │   │   │   │   │   │   ├── decode_base16.yml
    │   │   │   │   │   │   ├── downcase.yml
    │   │   │   │   │   │   ├── float_calculate.yml
    │   │   │   │   │   │   ├── geoip.yml
    │   │   │   │   │   │   ├── get_date.yml
    │   │   │   │   │   │   ├── hex_to_number.yml
    │   │   │   │   │   │   ├── iana_protocol_name_to_number.yml
    │   │   │   │   │   │   ├── iana_protocol_number_to_name.yml
    │   │   │   │   │   │   ├── int_calculate.yml
    │   │   │   │   │   │   ├── ip_version.yml
    │   │   │   │   │   │   ├── join.yml
    │   │   │   │   │   │   ├── network_community_id.yml
    │   │   │   │   │   │   ├── regex_extract.yml
    │   │   │   │   │   │   ├── sha1.yml
    │   │   │   │   │   │   ├── syslog_extract_facility.yml
    │   │   │   │   │   │   ├── syslog_extract_severity.yml
    │   │   │   │   │   │   ├── system_epoch.yml
    │   │   │   │   │   │   ├── to_bool.yml
    │   │   │   │   │   │   ├── to_int.yml
    │   │   │   │   │   │   ├── to_string.yml
    │   │   │   │   │   │   └── upcase.yml
    │   │   │   │   │   └── transformation/
    │   │   │   │   │       ├── array_append.yml
    │   │   │   │   │       ├── array_append_any.yml
    │   │   │   │   │       ├── array_append_unique.yml
    │   │   │   │   │       ├── array_append_unique_any.yml
    │   │   │   │   │       ├── delete.yml
    │   │   │   │   │       ├── delete_fields_with_value.yml
    │   │   │   │   │       ├── discard_events.yml
    │   │   │   │   │       ├── erase_custom_fields.yml
    │   │   │   │   │       ├── get_key_in.yml
    │   │   │   │   │       ├── kvdb_decode_bitmask.yml
    │   │   │   │   │       ├── kvdb_get.yml
    │   │   │   │   │       ├── kvdb_get_array.yml
    │   │   │   │   │       ├── kvdb_get_merge.yml
    │   │   │   │   │       ├── kvdb_get_merge_recursive.yml
    │   │   │   │   │       ├── merge.yml
    │   │   │   │   │       ├── merge_key_in.yml
    │   │   │   │   │       ├── merge_recursive_key_in.yml
    │   │   │   │   │       ├── parse_alphanumeric.yml
    │   │   │   │   │       ├── parse_between.yml
    │   │   │   │   │       ├── parse_binary.yml
    │   │   │   │   │       ├── parse_bool.yml
    │   │   │   │   │       ├── parse_byte.yml
    │   │   │   │   │       ├── parse_csv.yml
    │   │   │   │   │       ├── parse_date.yml
    │   │   │   │   │       ├── parse_double.yml
    │   │   │   │   │       ├── parse_dsv.yml
    │   │   │   │   │       ├── parse_file.yml
    │   │   │   │   │       ├── parse_float.yml
    │   │   │   │   │       ├── parse_fqdn.yml
    │   │   │   │   │       ├── parse_half_float.yml
    │   │   │   │   │       ├── parse_integer.yml
    │   │   │   │   │       ├── parse_ip.yml
    │   │   │   │   │       ├── parse_json.yml
    │   │   │   │   │       ├── parse_key_value.yml
    │   │   │   │   │       ├── parse_long.yml
    │   │   │   │   │       ├── parse_quoted.yml
    │   │   │   │   │       ├── parse_short.yml
    │   │   │   │   │       ├── parse_unsigned_long.yml
    │   │   │   │   │       ├── parse_uri.yml
    │   │   │   │   │       ├── parse_useragent.yml
    │   │   │   │   │       ├── parse_xml.yml
    │   │   │   │   │       ├── rename.yml
    │   │   │   │   │       ├── replace.yml
    │   │   │   │   │       ├── sanitize_fields.yml
    │   │   │   │   │       ├── split.yml
    │   │   │   │   │       └── trim.yml
    │   │   │   │   └── mmdb/
    │   │   │   │       ├── testdb-asn.mmdb
    │   │   │   │       └── testdb-city.mmdb
    │   │   │   └── integration_tests/
    │   │   │       ├── README.md
    │   │   │       ├── configuration_files/
    │   │   │       │   └── config.env
    │   │   │       ├── crud_cm/
    │   │   │       │   ├── environment.py
    │   │   │       │   ├── features/
    │   │   │       │   │   └── crud_cm.feature
    │   │   │       │   └── steps/
    │   │   │       │       └── crud_cm.py
    │   │   │       ├── crud_ns/
    │   │   │       │   ├── environment.py
    │   │   │       │   ├── features/
    │   │   │       │   │   └── crud_ns.feature
    │   │   │       │   └── steps/
    │   │   │       │       └── crud_ns.py
    │   │   │       ├── engine-it/
    │   │   │       │   ├── README.md
    │   │   │       │   ├── pyproject.toml
    │   │   │       │   └── src/
    │   │   │       │       └── integration_test/
    │   │   │       │           ├── __init__.py
    │   │   │       │           ├── __main__.py
    │   │   │       │           ├── core.py
    │   │   │       │           └── initial_state.py
    │   │   │       ├── geo/
    │   │   │       │   ├── environment.py
    │   │   │       │   ├── data/
    │   │   │       │   │   ├── base.md5
    │   │   │       │   │   └── base.mmdb
    │   │   │       │   ├── features/
    │   │   │       │   │   └── geo.feature
    │   │   │       │   └── steps/
    │   │   │       │       └── geo_steps.py
    │   │   │       ├── router/
    │   │   │       │   ├── environment.py
    │   │   │       │   ├── features/
    │   │   │       │   │   └── api.feature
    │   │   │       │   └── steps/
    │   │   │       │       └── api_steps.py
    │   │   │       └── tester/
    │   │   │           ├── environment.py
    │   │   │           ├── features/
    │   │   │           │   └── api.feature
    │   │   │           └── steps/
    │   │   │               └── api_steps.py
    │   │   └── tools/
    │   │       ├── README.md
    │   │       ├── check_ASAN.sh
    │   │       ├── check_Valgrind.sh
    │   │       ├── compare_expected.py
    │   │       ├── download_mmdbs.sh
    │   │       ├── flat_output.py
    │   │       ├── http_bypass.go
    │   │       ├── update_expected.py
    │   │       ├── write_message.go
    │   │       ├── api-communication/
    │   │       │   ├── README.md
    │   │       │   ├── pyproject.toml
    │   │       │   └── src/
    │   │       │       └── api_communication/
    │   │       │           ├── __init__.py
    │   │       │           ├── client.py
    │   │       │           ├── endpoints.py
    │   │       │           └── proto/
    │   │       │               ├── __init__.py
    │   │       │               ├── archiver_pb2.py
    │   │       │               ├── archiver_pb2.pyi
    │   │       │               ├── crud_pb2.py
    │   │       │               ├── crud_pb2.pyi
    │   │       │               ├── engine_pb2.py
    │   │       │               ├── engine_pb2.pyi
    │   │       │               ├── geo_pb2.py
    │   │       │               ├── geo_pb2.pyi
    │   │       │               ├── graph_pb2.py
    │   │       │               ├── graph_pb2.pyi
    │   │       │               ├── metrics_pb2.py
    │   │       │               ├── metrics_pb2.pyi
    │   │       │               ├── rawevtindexer_pb2.py
    │   │       │               ├── rawevtindexer_pb2.pyi
    │   │       │               ├── request_response_pb2.py
    │   │       │               ├── request_response_pb2.pyi
    │   │       │               ├── router_pb2.py
    │   │       │               ├── router_pb2.pyi
    │   │       │               ├── tester_pb2.py
    │   │       │               └── tester_pb2.pyi
    │   │       ├── devContainer/
    │   │       │   ├── README.md
    │   │       │   ├── download_devContainer.sh
    │   │       │   ├── e2e/
    │   │       │   │   ├── docker-compose.yml
    │   │       │   │   ├── init.sh
    │   │       │   │   ├── wazuh_copy_certs.sh
    │   │       │   │   ├── wazuh-dashboard/
    │   │       │   │   │   ├── Dockerfile
    │   │       │   │   │   └── entrypoint.sh
    │   │       │   │   └── wazuh-indexer/
    │   │       │   │       ├── Dockerfile
    │   │       │   │       └── entrypoint.sh
    │   │       │   ├── scripts/
    │   │       │   │   ├── create_struct_standalone.sh
    │   │       │   │   ├── event_sock_v2.go
    │   │       │   │   ├── fix_wazuh_dash.sh
    │   │       │   │   ├── fix_wazuh_indexer.sh
    │   │       │   │   ├── mount_wazuh_proc.sh
    │   │       │   │   ├── purge_wazuh.sh
    │   │       │   │   ├── toggle_archive.sh
    │   │       │   │   └── wazuh_stream_socket.go
    │   │       │   └── .devcontainer/
    │   │       │       ├── devcontainer.json
    │   │       │       ├── Dockerfile
    │   │       │       └── reinstall-cmake.sh
    │   │       ├── docker/
    │   │       │   ├── README.md
    │   │       │   ├── Dockerfile
    │   │       │   └── scripts/
    │   │       │       ├── build-and-install-engine.sh
    │   │       │       ├── EntryPoint.sh
    │   │       │       └── reinstall-cmake.sh
    │   │       ├── engine-bench/
    │   │       │   ├── README.md
    │   │       │   ├── pyproject.toml
    │   │       │   └── src/
    │   │       │       └── engine_bench/
    │   │       │           ├── __init__.py
    │   │       │           ├── __main__.py
    │   │       │           └── scripts/
    │   │       │               ├── flamegraph.pl
    │   │       │               └── stackcollapse-perf.pl
    │   │       ├── engine-schema/
    │   │       │   ├── README.md
    │   │       │   ├── engine_schema.py
    │   │       │   └── src/
    │   │       │       └── engine_schema/
    │   │       │           ├── __init__.py
    │   │       │           ├── __main__.py
    │   │       │           ├── field.py
    │   │       │           ├── fields.template.json
    │   │       │           ├── generate.py
    │   │       │           ├── logpar_types.json
    │   │       │           ├── resource_handler.py
    │   │       │           ├── cmds/
    │   │       │           │   ├── __init__.py
    │   │       │           │   ├── _types.py
    │   │       │           │   └── generate.py
    │   │       │           └── drivers/
    │   │       │               ├── __init__.py
    │   │       │               └── ecs.py
    │   │       ├── engine-suite/
    │   │       │   ├── README.md
    │   │       │   ├── pyproject.toml
    │   │       │   ├── setup.cfg
    │   │       │   ├── setup.py
    │   │       │   └── src/
    │   │       │       ├── engine_archiver/
    │   │       │       │   ├── README.md
    │   │       │       │   ├── __init__.py
    │   │       │       │   ├── __main__.py
    │   │       │       │   └── cmds/
    │   │       │       │       ├── __init__.py
    │   │       │       │       ├── activate.py
    │   │       │       │       ├── deactivate.py
    │   │       │       │       └── status.py
    │   │       │       ├── engine_private/
    │   │       │       │   ├── README.md
    │   │       │       │   ├── __init__.py
    │   │       │       │   ├── __main__.py
    │   │       │       │   └── cmds/
    │   │       │       │       ├── __init__.py
    │   │       │       │       ├── cm/
    │   │       │       │       │   ├── __init__.py
    │   │       │       │       │   ├── delete.py
    │   │       │       │       │   ├── get.py
    │   │       │       │       │   ├── list.py
    │   │       │       │       │   ├── policy_delete.py
    │   │       │       │       │   ├── policy_upsert.py
    │   │       │       │       │   └── upsert.py
    │   │       │       │       ├── geo/
    │   │       │       │       │   ├── __init__.py
    │   │       │       │       │   ├── get.py
    │   │       │       │       │   └── list.py
    │   │       │       │       ├── ns/
    │   │       │       │       │   ├── __init__.py
    │   │       │       │       │   ├── create.py
    │   │       │       │       │   ├── delete.py
    │   │       │       │       │   ├── import_ns.py
    │   │       │       │       │   └── list.py
    │   │       │       │       └── rawevt/
    │   │       │       │           ├── __init__.py
    │   │       │       │           ├── disable.py
    │   │       │       │           ├── enable.py
    │   │       │       │           └── status.py
    │   │       │       ├── engine_public/
    │   │       │       │   ├── README.md
    │   │       │       │   ├── __init__.py
    │   │       │       │   ├── __main__.py
    │   │       │       │   └── cmds/
    │   │       │       │       ├── __init__.py
    │   │       │       │       └── cm/
    │   │       │       │           ├── __init__.py
    │   │       │       │           ├── logtest_cleanup.py
    │   │       │       │           ├── policy_validate.py
    │   │       │       │           ├── upsert.py
    │   │       │       │           └── validate.py
    │   │       │       ├── engine_router/
    │   │       │       │   ├── README.md
    │   │       │       │   ├── __init__.py
    │   │       │       │   ├── __main__.py
    │   │       │       │   └── cmds/
    │   │       │       │       ├── __init__.py
    │   │       │       │       ├── add.py
    │   │       │       │       ├── delete.py
    │   │       │       │       ├── eps_activate.py
    │   │       │       │       ├── eps_deactivate.py
    │   │       │       │       ├── eps_get.py
    │   │       │       │       ├── eps_update.py
    │   │       │       │       ├── get.py
    │   │       │       │       ├── ingest.py
    │   │       │       │       ├── list.py
    │   │       │       │       ├── reload.py
    │   │       │       │       └── update.py
    │   │       │       ├── engine_test/
    │   │       │       │   ├── README.md
    │   │       │       │   ├── __init__.py
    │   │       │       │   ├── __main__.py
    │   │       │       │   ├── api_connector.py
    │   │       │       │   ├── base_tester_integration.py
    │   │       │       │   ├── input_collector.py
    │   │       │       │   ├── raw_tester_integration.py
    │   │       │       │   ├── tester_integration.py
    │   │       │       │   ├── cmds/
    │   │       │       │   │   ├── __init__.py
    │   │       │       │   │   ├── add.py
    │   │       │       │   │   ├── create.py
    │   │       │       │   │   ├── delete.py
    │   │       │       │   │   ├── get.py
    │   │       │       │   │   ├── list.py
    │   │       │       │   │   ├── run.py
    │   │       │       │   │   ├── run_raw.py
    │   │       │       │   │   ├── session.py
    │   │       │       │   │   ├── session_add.py
    │   │       │       │   │   ├── session_delete.py
    │   │       │       │   │   ├── session_delete_all.py
    │   │       │       │   │   ├── session_get.py
    │   │       │       │   │   ├── session_list.py
    │   │       │       │   │   └── session_reload.py
    │   │       │       │   ├── conf/
    │   │       │       │   │   ├── __init__.py
    │   │       │       │   │   ├── event_tester_template.py
    │   │       │       │   │   ├── integration.py
    │   │       │       │   │   └── store.py
    │   │       │       │   └── event_splitters/
    │   │       │       │       ├── __init__.py
    │   │       │       │       ├── base_splitter.py
    │   │       │       │       ├── dynamic_multi_line.py
    │   │       │       │       ├── eventchannel.py
    │   │       │       │       ├── multi_line.py
    │   │       │       │       └── single_line.py
    │   │       │       └── shared/
    │   │       │           ├── __init__.py
    │   │       │           ├── default_settings.py
    │   │       │           ├── dumpers.py
    │   │       │           └── executor.py
    │   │       └── evtx2xml/
    │   │           ├── README.md
    │   │           ├── MANIFEST.in
    │   │           ├── requirements.txt
    │   │           ├── setup.py
    │   │           └── evtx2xml/
    │   │               ├── __init__.py
    │   │               └── evtx_to_xml.py
    │   ├── external/
    │   │   └── CMakeLists.txt
    │   ├── generated_headers/
    │   │   └── .gitkeep
    │   ├── init/
    │   │   ├── add_localfiles.sh
    │   │   ├── adduser.sh
    │   │   ├── darwin-addusers.sh
    │   │   ├── darwin-delete-oldusers.sh
    │   │   ├── darwin-init.sh
    │   │   ├── delete-oldusers.sh
    │   │   ├── dist-detect.sh
    │   │   ├── functions.sh
    │   │   ├── fw-check.sh
    │   │   ├── gen_ossec.sh
    │   │   ├── init.sh
    │   │   ├── inst-functions.sh
    │   │   ├── language.sh
    │   │   ├── pkg_installer.sh
    │   │   ├── register_configure_agent.sh
    │   │   ├── replace_manager_ip.sh
    │   │   ├── shared.sh
    │   │   ├── template-select.sh
    │   │   ├── update-indexer.sh
    │   │   ├── update.sh
    │   │   ├── wazuh-client.sh
    │   │   ├── wazuh-local.sh
    │   │   ├── wazuh-server.sh
    │   │   ├── templates/
    │   │   │   ├── ossec-hids-debian.init
    │   │   │   ├── ossec-hids-gentoo.init
    │   │   │   ├── ossec-hids-rh.init
    │   │   │   ├── ossec-hids-suse.init
    │   │   │   ├── ossec-hids.init
    │   │   │   ├── wazuh-agent.service
    │   │   │   └── wazuh-manager.service
    │   │   └── wazuh/
    │   │       └── wazuh.sh
    │   ├── logcollector/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   ├── journal_log.h
    │   │   │   ├── logcollector.h
    │   │   │   └── macos_log.h
    │   │   └── src/
    │   │       ├── config.c
    │   │       ├── journal_log.c
    │   │       ├── lccom.c
    │   │       ├── logcollector.c
    │   │       ├── macos_log.c
    │   │       ├── main.c
    │   │       ├── read_audit.c
    │   │       ├── read_command.c
    │   │       ├── read_djb_multilog.c
    │   │       ├── read_fullcommand.c
    │   │       ├── read_journald.c
    │   │       ├── read_json.c
    │   │       ├── read_macos.c
    │   │       ├── read_mssql_log.c
    │   │       ├── read_multiline.c
    │   │       ├── read_multiline_regex.c
    │   │       ├── read_mysql_log.c
    │   │       ├── read_nmapg.c
    │   │       ├── read_ossecalert.c
    │   │       ├── read_postgresql_log.c
    │   │       ├── read_snortfull.c
    │   │       ├── read_syslog.c
    │   │       ├── read_ucs2_be.c
    │   │       ├── read_ucs2_le.c
    │   │       ├── read_win_el.c
    │   │       ├── read_win_event_channel.c
    │   │       ├── state.c
    │   │       └── state.h
    │   ├── monitord/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── monitord.h
    │   │   └── src/
    │   │       ├── main.c
    │   │       ├── moncom.c
    │   │       ├── monitor_actions.c
    │   │       ├── monitord.c
    │   │       └── sign_log.c
    │   ├── os_auth/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── auth.h
    │   │   └── src/
    │   │       ├── auth.c
    │   │       ├── authcom.c
    │   │       ├── config.c
    │   │       ├── generate_cert.c
    │   │       ├── generate_cert.h
    │   │       ├── key_request.c
    │   │       ├── key_request.h
    │   │       ├── local-server.c
    │   │       └── main-server.c
    │   ├── os_execd/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── execd.h
    │   │   └── src/
    │   │       ├── config.c
    │   │       ├── exec.c
    │   │       ├── execd.c
    │   │       ├── main.c
    │   │       └── wcom.c
    │   ├── remoted/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── remoted.h
    │   │   └── src/
    │   │       ├── agent_metadata_db.c
    │   │       ├── agent_metadata_db.h
    │   │       ├── ar-forward.c
    │   │       ├── bulk.c
    │   │       ├── bulk.h
    │   │       ├── config.c
    │   │       ├── main.c
    │   │       ├── manager.c
    │   │       ├── netbuffer.c
    │   │       ├── netcounter.c
    │   │       ├── queue.c
    │   │       ├── remcom.c
    │   │       ├── remoted.c
    │   │       ├── request.c
    │   │       ├── secure.c
    │   │       ├── sendmsg.c
    │   │       ├── shared_download.c
    │   │       ├── shared_download.h
    │   │       ├── state.c
    │   │       ├── state.h
    │   │       ├── syslog.c
    │   │       └── syslogtcp.c
    │   ├── rootcheck/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── rootcheck.h
    │   │   └── src/
    │   │       ├── check_open_ports.c
    │   │       ├── check_rc_dev.c
    │   │       ├── check_rc_if.c
    │   │       ├── check_rc_pids.c
    │   │       ├── check_rc_ports.c
    │   │       ├── check_rc_readproc.c
    │   │       ├── check_rc_sys.c
    │   │       ├── common.c
    │   │       ├── common_rcl.c
    │   │       ├── config.c
    │   │       ├── os_string.c
    │   │       ├── rootcheck-config.c
    │   │       ├── rootcheck.c
    │   │       ├── rootcheck.conf
    │   │       ├── run_rk_check.c
    │   │       ├── unix-process.c
    │   │       ├── win-common.c
    │   │       └── win-process.c
    │   ├── selinux/
    │   │   └── wazuh.te
    │   ├── shared/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   ├── agent_op.h
    │   │   │   ├── agent_validate_op.h
    │   │   │   ├── agentd_query.h
    │   │   │   ├── ar.h
    │   │   │   ├── atomic.h
    │   │   │   ├── audit_op.h
    │   │   │   ├── auth_client.h
    │   │   │   ├── batch_queue_op.h
    │   │   │   ├── binaries_op.h
    │   │   │   ├── bqueue_op.h
    │   │   │   ├── buffer_op.h
    │   │   │   ├── bzip2_op.h
    │   │   │   ├── check_cert_op.h
    │   │   │   ├── cluster_utils.h
    │   │   │   ├── cryptography.h
    │   │   │   ├── custom_output_search.h
    │   │   │   ├── debug_op.h
    │   │   │   ├── defs.h
    │   │   │   ├── dll_load_notify.h
    │   │   │   ├── engine_external.h
    │   │   │   ├── enrollment_op.h
    │   │   │   ├── exec_op.h
    │   │   │   ├── expression.h
    │   │   │   ├── file-queue.h
    │   │   │   ├── file_op.h
    │   │   │   ├── fs_op.h
    │   │   │   ├── hash_op.h
    │   │   │   ├── hashmap_op.h
    │   │   │   ├── help.h
    │   │   │   ├── http_op.h
    │   │   │   ├── indexed_queue_op.h
    │   │   │   ├── json-queue.h
    │   │   │   ├── json_op.h
    │   │   │   ├── labels_op.h
    │   │   │   ├── list_op.h
    │   │   │   ├── log_builder.h
    │   │   │   ├── log_rotate.h
    │   │   │   ├── logging_helper.h
    │   │   │   ├── math_op.h
    │   │   │   ├── mem_op.h
    │   │   │   ├── module_limits.h
    │   │   │   ├── mq_op.h
    │   │   │   ├── notify_op.h
    │   │   │   ├── os_err.h
    │   │   │   ├── os_ip.h
    │   │   │   ├── os_utils.h
    │   │   │   ├── privsep_op.h
    │   │   │   ├── pthreads_op.h
    │   │   │   ├── queue_linked_op.h
    │   │   │   ├── queue_op.h
    │   │   │   ├── randombytes.h
    │   │   │   ├── rbtree_op.h
    │   │   │   ├── rc.h
    │   │   │   ├── read-agents.h
    │   │   │   ├── read-alert.h
    │   │   │   ├── regex_op.h
    │   │   │   ├── remoted_op.h
    │   │   │   ├── request_op.h
    │   │   │   ├── rwlock_op.h
    │   │   │   ├── schedule_scan.h
    │   │   │   ├── sec.h
    │   │   │   ├── shared.h
    │   │   │   ├── sig_op.h
    │   │   │   ├── socket_forwarder.h
    │   │   │   ├── ssl_op.h
    │   │   │   ├── startup_gate_op.h
    │   │   │   ├── store_op.h
    │   │   │   ├── string_op.h
    │   │   │   ├── sym_load.h
    │   │   │   ├── syscheck_op.h
    │   │   │   ├── sysinfo_utils.h
    │   │   │   ├── time_op.h
    │   │   │   ├── url.h
    │   │   │   ├── utf8_op.h
    │   │   │   ├── utf8_winapi_wrapper.h
    │   │   │   ├── validate_op.h
    │   │   │   ├── vector_op.h
    │   │   │   ├── version_op.h
    │   │   │   ├── wait_op.h
    │   │   │   ├── wazuhdb_op.h
    │   │   │   ├── wazuhdb_queries_op.h
    │   │   │   ├── yaml2json.h
    │   │   │   └── error_messages/
    │   │   │       ├── debug_messages.h
    │   │   │       ├── error_messages.h
    │   │   │       ├── information_messages.h
    │   │   │       └── warning_messages.h
    │   │   ├── os_crypto/
    │   │   │   ├── aes/
    │   │   │   │   ├── aes_op.c
    │   │   │   │   └── aes_op.h
    │   │   │   ├── blowfish/
    │   │   │   │   ├── bf_op.c
    │   │   │   │   └── bf_op.h
    │   │   │   ├── hmac/
    │   │   │   │   ├── hmac.c
    │   │   │   │   └── hmac.h
    │   │   │   ├── md5/
    │   │   │   │   ├── md5_op.c
    │   │   │   │   └── md5_op.h
    │   │   │   ├── md5_sha1_sha256/
    │   │   │   │   ├── md5_sha1_sha256_op.c
    │   │   │   │   └── md5_sha1_sha256_op.h
    │   │   │   ├── sha1/
    │   │   │   │   ├── sha1_op.c
    │   │   │   │   └── sha1_op.h
    │   │   │   ├── sha256/
    │   │   │   │   ├── sha256_op.c
    │   │   │   │   └── sha256_op.h
    │   │   │   ├── sha512/
    │   │   │   │   ├── sha512_op.c
    │   │   │   │   └── sha512_op.h
    │   │   │   ├── shared/
    │   │   │   │   ├── keys.c
    │   │   │   │   └── msgs.c
    │   │   │   └── signature/
    │   │   │       ├── signature.c
    │   │   │       └── signature.h
    │   │   ├── os_net/
    │   │   │   ├── os_net.c
    │   │   │   └── os_net.h
    │   │   ├── os_regex/
    │   │   │   ├── os_match.c
    │   │   │   ├── os_match_compile.c
    │   │   │   ├── os_match_execute.c
    │   │   │   ├── os_match_free_pattern.c
    │   │   │   ├── os_regex.c
    │   │   │   ├── os_regex.h
    │   │   │   ├── os_regex_compile.c
    │   │   │   ├── os_regex_execute.c
    │   │   │   ├── os_regex_free_pattern.c
    │   │   │   ├── os_regex_internal.h
    │   │   │   ├── os_regex_maps.c
    │   │   │   ├── os_regex_match.c
    │   │   │   ├── os_regex_startswith.c
    │   │   │   ├── os_regex_str.c
    │   │   │   └── os_regex_strbreak.c
    │   │   ├── os_xml/
    │   │   │   ├── os_xml.c
    │   │   │   ├── os_xml.h
    │   │   │   ├── os_xml_access.c
    │   │   │   ├── os_xml_internal.h
    │   │   │   ├── os_xml_node_access.c
    │   │   │   ├── os_xml_variables.c
    │   │   │   └── os_xml_writer.c
    │   │   ├── os_zlib/
    │   │   │   ├── os_zlib.c
    │   │   │   └── os_zlib.h
    │   │   └── src/
    │   │       ├── agent_op.c
    │   │       ├── agent_validate_op.c
    │   │       ├── agentd_query.c
    │   │       ├── atomic.c
    │   │       ├── audit_op.c
    │   │       ├── auth_client.c
    │   │       ├── b64.c
    │   │       ├── batch_queue_op.c
    │   │       ├── binaries_op.c
    │   │       ├── bqueue_op.c
    │   │       ├── buffer_op.c
    │   │       ├── bzip2_op.c
    │   │       ├── check_cert_op.c
    │   │       ├── cluster_utils.c
    │   │       ├── compress_log.c
    │   │       ├── cryptography.c
    │   │       ├── custom_output_search_replace.c
    │   │       ├── debug_op.c
    │   │       ├── dll_load_notify.c
    │   │       ├── engine_external.c
    │   │       ├── enrollment_op.c
    │   │       ├── exec_op.c
    │   │       ├── expression.c
    │   │       ├── file-queue.c
    │   │       ├── file_op.c
    │   │       ├── fs_op.c
    │   │       ├── hash_op.c
    │   │       ├── hashmap_op.c
    │   │       ├── help.c
    │   │       ├── http_op.c
    │   │       ├── indexed_queue_op.c
    │   │       ├── json-queue.c
    │   │       ├── json_op.c
    │   │       ├── labels_op.c
    │   │       ├── list_op.c
    │   │       ├── log_builder.c
    │   │       ├── log_rotate.c
    │   │       ├── logging_helper.c
    │   │       ├── math_op.c
    │   │       ├── mem_op.c
    │   │       ├── module_limits.c
    │   │       ├── mq_op.c
    │   │       ├── notify_op.c
    │   │       ├── os_utils.c
    │   │       ├── privsep_op.c
    │   │       ├── pthreads_op.c
    │   │       ├── queue_linked_op.c
    │   │       ├── queue_op.c
    │   │       ├── randombytes.c
    │   │       ├── rbtree_op.c
    │   │       ├── read-agents.c
    │   │       ├── read-alert.c
    │   │       ├── regex_op.c
    │   │       ├── remoted_op.c
    │   │       ├── request_op.c
    │   │       ├── rwlock_op.c
    │   │       ├── schedule_scan.c
    │   │       ├── sig_op.c
    │   │       ├── ssl_op.c
    │   │       ├── startup_gate_op.c
    │   │       ├── store_op.c
    │   │       ├── string_op.c
    │   │       ├── sym_load.c
    │   │       ├── syscheck_op.c
    │   │       ├── sysinfo_utils.c
    │   │       ├── time_op.c
    │   │       ├── url.c
    │   │       ├── utf8_op.c
    │   │       ├── utf8_winapi_wrapper.c
    │   │       ├── validate_op.c
    │   │       ├── vector_op.c
    │   │       ├── version_op.c
    │   │       ├── wait_op.c
    │   │       ├── wazuhdb_op.c
    │   │       ├── wazuhdb_queries_op.c
    │   │       └── yaml2json.c
    │   ├── shared_modules/
    │   │   ├── agent_metadata/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   └── metadata_provider.h
    │   │   │   ├── src/
    │   │   │   │   └── metadata_provider.cpp
    │   │   │   └── tests/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── main.cpp
    │   │   │       └── test_metadata_provider.cpp
    │   │   ├── common/
    │   │   │   └── commonDefs.h
    │   │   ├── content_manager/
    │   │   │   ├── README.md
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── doc/
    │   │   │   │   └── components/
    │   │   │   │       ├── API_DOWNLOADER.md
    │   │   │   │       ├── CLEANUP_CONTENT.md
    │   │   │   │       ├── CTI_OAUTH_PROVIDERS.md
    │   │   │   │       ├── CTI_OFFSET_DOWNLOADER.md
    │   │   │   │       ├── CTI_SNAPSHOT_DOWNLOADER.md
    │   │   │   │       ├── EXECUTION_CONTEXT.md
    │   │   │   │       ├── FILE_DOWNLOADER.md
    │   │   │   │       ├── GZIP_DECOMPRESSOR.md
    │   │   │   │       ├── OFFLINE_DOWNLOADER.md
    │   │   │   │       ├── PUB_SUB_PUBLISHER.md
    │   │   │   │       ├── XZ_DECOMPRESSOR.md
    │   │   │   │       └── ZIP_DECOMPRESSOR.md
    │   │   │   ├── include/
    │   │   │   │   ├── content_manager.h
    │   │   │   │   ├── contentManager.hpp
    │   │   │   │   ├── contentRegister.hpp
    │   │   │   │   └── sharedDefs.hpp
    │   │   │   ├── src/
    │   │   │   │   ├── action.hpp
    │   │   │   │   ├── actionOrchestrator.hpp
    │   │   │   │   ├── contentModule.cpp
    │   │   │   │   ├── contentModuleFacade.cpp
    │   │   │   │   ├── contentModuleFacade.hpp
    │   │   │   │   ├── contentProvider.hpp
    │   │   │   │   ├── dataDecoder.hpp
    │   │   │   │   ├── factoryDecoder.hpp
    │   │   │   │   ├── onDemandManager.cpp
    │   │   │   │   ├── onDemandManager.hpp
    │   │   │   │   ├── registryProviderDecoder.hpp
    │   │   │   │   └── components/
    │   │   │   │       ├── APIDownloader.hpp
    │   │   │   │       ├── cleanUpContent.hpp
    │   │   │   │       ├── componentsHelper.hpp
    │   │   │   │       ├── ctiCredentialsProvider.hpp
    │   │   │   │       ├── CtiDownloader.hpp
    │   │   │   │       ├── CtiOffsetDownloader.hpp
    │   │   │   │       ├── ctiProductsProvider.hpp
    │   │   │   │       ├── ctiSignedUrlProvider.hpp
    │   │   │   │       ├── CtiSnapshotDownloader.hpp
    │   │   │   │       ├── executionContext.hpp
    │   │   │   │       ├── factoryCleaner.hpp
    │   │   │   │       ├── factoryContentUpdater.hpp
    │   │   │   │       ├── factoryDecompressor.hpp
    │   │   │   │       ├── factoryDownloader.hpp
    │   │   │   │       ├── factoryOffsetUpdater.hpp
    │   │   │   │       ├── factoryVersionUpdater.hpp
    │   │   │   │       ├── fileDownloader.hpp
    │   │   │   │       ├── gzipDecompressor.hpp
    │   │   │   │       ├── offlineDownloader.hpp
    │   │   │   │       ├── pubSubPublisher.hpp
    │   │   │   │       ├── pubSubPublisherExceptions.hpp
    │   │   │   │       ├── skipStep.hpp
    │   │   │   │       ├── updateCtiApiOffset.hpp
    │   │   │   │       ├── updateOffline.hpp
    │   │   │   │       ├── updaterContext.hpp
    │   │   │   │       ├── XZDecompressor.hpp
    │   │   │   │       └── zipDecompressor.hpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── component/
    │   │   │   │   │   ├── action_test.cpp
    │   │   │   │   │   ├── action_test.hpp
    │   │   │   │   │   ├── actionOrchestrator_test.cpp
    │   │   │   │   │   ├── actionOrchestrator_test.hpp
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── contentManager_test.cpp
    │   │   │   │   │   ├── contentManager_test.hpp
    │   │   │   │   │   ├── contentModuleFacade_test.cpp
    │   │   │   │   │   ├── contentModuleFacade_test.hpp
    │   │   │   │   │   ├── contentProvider_test.cpp
    │   │   │   │   │   ├── contentProvider_test.hpp
    │   │   │   │   │   ├── contentRegister_test.cpp
    │   │   │   │   │   ├── contentRegister_test.hpp
    │   │   │   │   │   ├── pubSubPublisher_test.cpp
    │   │   │   │   │   ├── pubSubPublisher_test.hpp
    │   │   │   │   │   ├── fakes/
    │   │   │   │   │   │   └── fakeServer.hpp
    │   │   │   │   │   ├── input_files/
    │   │   │   │   │   │   └── sample.txt
    │   │   │   │   │   └── mocks/
    │   │   │   │   │       └── mockRouterProvider.hpp
    │   │   │   │   └── unit/
    │   │   │   │       ├── APIDownloader_test.cpp
    │   │   │   │       ├── APIDownloader_test.hpp
    │   │   │   │       ├── cleanUpContent_test.cpp
    │   │   │   │       ├── cleanUpContent_test.hpp
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── componentsHelper_test.cpp
    │   │   │   │       ├── componentsHelper_test.hpp
    │   │   │   │       ├── conditionSync_test.cpp
    │   │   │   │       ├── conditionSync_test.hpp
    │   │   │   │       ├── ctiCredentialsProvider_test.cpp
    │   │   │   │       ├── ctiCredentialsProvider_test.hpp
    │   │   │   │       ├── CtiDownloader_test.cpp
    │   │   │   │       ├── CtiDownloader_test.hpp
    │   │   │   │       ├── CtiDownloaderOAuth_test.cpp
    │   │   │   │       ├── CtiDownloaderOAuth_test.hpp
    │   │   │   │       ├── CtiOffsetDownloader_test.cpp
    │   │   │   │       ├── CtiOffsetDownloader_test.hpp
    │   │   │   │       ├── ctiProductsProvider_test.cpp
    │   │   │   │       ├── ctiProductsProvider_test.hpp
    │   │   │   │       ├── ctiSignedUrlProvider_test.cpp
    │   │   │   │       ├── ctiSignedUrlProvider_test.hpp
    │   │   │   │       ├── CtiSnapshotDownloader_test.cpp
    │   │   │   │       ├── CtiSnapshotDownloader_test.hpp
    │   │   │   │       ├── executionContext_test.cpp
    │   │   │   │       ├── executionContext_test.hpp
    │   │   │   │       ├── factoryCleaner_test.cpp
    │   │   │   │       ├── factoryCleaner_test.hpp
    │   │   │   │       ├── factoryDecompressor_test.cpp
    │   │   │   │       ├── factoryDecompressor_test.hpp
    │   │   │   │       ├── factoryDownloader_test.cpp
    │   │   │   │       ├── factoryDownloader_test.hpp
    │   │   │   │       ├── factoryOffsetUpdater_test.cpp
    │   │   │   │       ├── factoryOffsetUpdater_test.hpp
    │   │   │   │       ├── factoryVersionUpdater_test.cpp
    │   │   │   │       ├── factoryVersionUpdater_test.hpp
    │   │   │   │       ├── fileDownloader_test.cpp
    │   │   │   │       ├── fileDownloader_test.hpp
    │   │   │   │       ├── gzipDecompressor_test.cpp
    │   │   │   │       ├── gzipDecompressor_test.hpp
    │   │   │   │       ├── main.cpp
    │   │   │   │       ├── offlineDownloader_test.cpp
    │   │   │   │       ├── offlineDownloader_test.hpp
    │   │   │   │       ├── pubSubPublisher_test.cpp
    │   │   │   │       ├── pubSubPublisher_test.hpp
    │   │   │   │       ├── skipStep_test.cpp
    │   │   │   │       ├── skipStep_test.hpp
    │   │   │   │       ├── updateCtiApiOffset_test.cpp
    │   │   │   │       ├── updateCtiApiOffset_test.hpp
    │   │   │   │       ├── updateOffline_test.cpp
    │   │   │   │       ├── updateOffline_test.hpp
    │   │   │   │       ├── XZDecompressor_test.cpp
    │   │   │   │       ├── XZDecompressor_test.hpp
    │   │   │   │       ├── zipDecompressor_test.cpp
    │   │   │   │       ├── zipDecompressor_test.hpp
    │   │   │   │       ├── fakes/
    │   │   │   │       │   └── fakeServer.hpp
    │   │   │   │       └── mocks/
    │   │   │   │           └── MockRouterProvider.hpp
    │   │   │   └── testtool/
    │   │   │       ├── CMakeLists.txt
    │   │   │       └── main.cpp
    │   │   ├── dbsync/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── dbsync_doxygen.conf
    │   │   │   ├── example/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── main.cpp
    │   │   │   ├── include/
    │   │   │   │   ├── db_exception.h
    │   │   │   │   ├── dbsync.h
    │   │   │   │   ├── dbsync.hpp
    │   │   │   │   └── idbsync.hpp
    │   │   │   ├── integrationTests/
    │   │   │   │   ├── Readme.md
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── fim/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── fimIntegrationTest.cpp
    │   │   │   │       ├── fimIntegrationTest.h
    │   │   │   │       └── main.cpp
    │   │   │   ├── smokeTests/
    │   │   │   │   ├── Readme.md
    │   │   │   │   ├── config.json
    │   │   │   │   ├── InsertionUpdateDeleteSelect/
    │   │   │   │   │   ├── Readme.md
    │   │   │   │   │   ├── deleteRows.json
    │   │   │   │   │   ├── inputSelectRows.json
    │   │   │   │   │   ├── inputSyncRowInsert.json
    │   │   │   │   │   └── inputSyncRowModified.json
    │   │   │   │   ├── snapshotsUpdate/
    │   │   │   │   │   ├── Readme.md
    │   │   │   │   │   ├── insertData.json
    │   │   │   │   │   └── updateWithSnapshot.json
    │   │   │   │   ├── triggerActions/
    │   │   │   │   │   ├── Readme.md
    │   │   │   │   │   ├── addTableRelationship.json
    │   │   │   │   │   ├── deleteRows.json
    │   │   │   │   │   ├── insertDataProcesses.json
    │   │   │   │   │   └── insertDataSocket.json
    │   │   │   │   └── txnOperation/
    │   │   │   │       ├── Readme.md
    │   │   │   │       ├── closeTxn.json
    │   │   │   │       ├── createTxn.json
    │   │   │   │       ├── fullyGetDeletedRows.json
    │   │   │   │       ├── inputSyncRowInsertTxn.json
    │   │   │   │       ├── inputSyncRowModifiedTxn.json
    │   │   │   │       └── pksGetDeletedRows.json
    │   │   │   ├── src/
    │   │   │   │   ├── dbengine.h
    │   │   │   │   ├── dbengine_factory.h
    │   │   │   │   ├── dbsync.cpp
    │   │   │   │   ├── dbsync_implementation.cpp
    │   │   │   │   ├── dbsync_implementation.h
    │   │   │   │   ├── dbsyncPipelineFactory.cpp
    │   │   │   │   ├── dbsyncPipelineFactory.h
    │   │   │   │   └── sqlite/
    │   │   │   │       ├── isqlite_wrapper.h
    │   │   │   │       ├── sqlite_dbengine.cpp
    │   │   │   │       ├── sqlite_dbengine.h
    │   │   │   │       ├── sqlite_wrapper.cpp
    │   │   │   │       ├── sqlite_wrapper.h
    │   │   │   │       └── sqlite_wrapper_factory.h
    │   │   │   ├── tests/
    │   │   │   │   ├── Readme.md
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── dbengine/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── dbengine_test.cpp
    │   │   │   │   │   ├── dbengine_test.h
    │   │   │   │   │   └── main.cpp
    │   │   │   │   ├── interface/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── dbsync_test.cpp
    │   │   │   │   │   ├── dbsync_test.h
    │   │   │   │   │   └── main.cpp
    │   │   │   │   ├── mocks/
    │   │   │   │   │   ├── mock_dbsync.hpp
    │   │   │   │   │   ├── sqlitefactory_mock.h
    │   │   │   │   │   └── sqlitewrapper_mock.h
    │   │   │   │   ├── pipelineFactory/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── dbsyncPipelineFactory_test.cpp
    │   │   │   │   │   ├── dbsyncPipelineFactory_test.h
    │   │   │   │   │   └── main.cpp
    │   │   │   │   └── sqlite/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── main.cpp
    │   │   │   │       ├── sqlite_test.cpp
    │   │   │   │       └── sqlite_test.h
    │   │   │   └── testtool/
    │   │   │       ├── Readme.md
    │   │   │       ├── action.h
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── cmdArgsHelper.h
    │   │   │       ├── factoryAction.h
    │   │   │       ├── main.cpp
    │   │   │       ├── testContext.h
    │   │   │       └── input/
    │   │   │           ├── closeTxn.json
    │   │   │           ├── config.json
    │   │   │           ├── config_template.json
    │   │   │           ├── createTxn.json
    │   │   │           ├── deleteRows.json
    │   │   │           ├── getDeletedRowsOnlyPKs.json
    │   │   │           ├── input2.json
    │   │   │           ├── input3.json
    │   │   │           ├── input6.json
    │   │   │           ├── inputSelectRows.json
    │   │   │           ├── inputSyncRowInsert.json
    │   │   │           ├── inputSyncRowInsertTxn.json
    │   │   │           ├── inputSyncRowModified.json
    │   │   │           ├── inputSyncRowModifiedTxn.json
    │   │   │           ├── insertData.json
    │   │   │           └── updateWithSnapshot.json
    │   │   ├── file_helper/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── file_io/
    │   │   │   │   ├── include/
    │   │   │   │   │   ├── file_io_utils.hpp
    │   │   │   │   │   ├── file_io_wrapper.hpp
    │   │   │   │   │   ├── ifile_io_utils.hpp
    │   │   │   │   │   └── ifile_io_wrapper.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── file_io_utils.cpp
    │   │   │   │   │   └── file_io_wrapper.cpp
    │   │   │   │   └── tests/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── file_io_utils_test.cpp
    │   │   │   │       └── mocks/
    │   │   │   │           ├── mock_file_io_utils.hpp
    │   │   │   │           └── mock_file_io_wrapper.hpp
    │   │   │   └── filesystem/
    │   │   │       ├── include/
    │   │   │       │   ├── filesystem_utils.hpp
    │   │   │       │   ├── filesystem_wrapper.hpp
    │   │   │       │   ├── ifilesystem_utils.hpp
    │   │   │       │   └── ifilesystem_wrapper.hpp
    │   │   │       ├── src/
    │   │   │       │   ├── filesystem_utils.cpp
    │   │   │       │   ├── filesystem_wrapper.cpp
    │   │   │       │   ├── filesystem_wrapper_unix.cpp
    │   │   │       │   └── filesystem_wrapper_win.cpp
    │   │   │       └── tests/
    │   │   │           ├── CMakeLists.txt
    │   │   │           ├── filesystem_utils_test.cpp
    │   │   │           └── mocks/
    │   │   │               ├── mock_filesystem_utils.hpp
    │   │   │               └── mock_filesystem_wrapper.hpp
    │   │   ├── indexer_connector/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   └── indexerConnector.hpp
    │   │   │   ├── qa/
    │   │   │   │   ├── requirements.txt
    │   │   │   │   ├── test_efficacy_log.py
    │   │   │   │   └── test_data/
    │   │   │   │       ├── test_abuse_control_indexer_connector/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   ├── data.json
    │   │   │   │       │   ├── event_delete.json
    │   │   │   │       │   ├── event_insert.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_abuse_control_no_data_loss_on_indexer_failure/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   ├── data.json
    │   │   │   │       │   ├── event_delete.json
    │   │   │   │       │   ├── event_insert.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_add_bulk_indexer_connector/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   ├── event_delete.json
    │   │   │   │       │   ├── event_insert.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_bulk_indexer_413_connector/
    │   │   │   │       │   ├── base.json
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_error_handling_404_index_not_found/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_error_handling_resource_already_exists/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_error_handling_shard_limit_exceeded/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_initialize_indexer_connector/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   └── template.json
    │   │   │   │       ├── test_update_mappings_connector/
    │   │   │   │       │   ├── config.json
    │   │   │   │       │   ├── event_insert_1.json
    │   │   │   │       │   ├── event_insert_2.json
    │   │   │   │       │   ├── template.json
    │   │   │   │       │   ├── template2.json
    │   │   │   │       │   └── update.json
    │   │   │   │       └── test_update_mappings_connector_legacy/
    │   │   │   │           ├── config.json
    │   │   │   │           ├── event_insert_1.json
    │   │   │   │           ├── event_insert_2.json
    │   │   │   │           ├── template.json
    │   │   │   │           ├── template2.json
    │   │   │   │           └── update.json
    │   │   │   ├── src/
    │   │   │   │   ├── indexerConnectorAsync.cpp
    │   │   │   │   ├── indexerConnectorAsyncImpl.hpp
    │   │   │   │   ├── indexerConnectorSync.cpp
    │   │   │   │   ├── indexerConnectorSyncImpl.hpp
    │   │   │   │   ├── monitoring.hpp
    │   │   │   │   └── serverSelector.hpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── component/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── fakeIndexer.hpp
    │   │   │   │   │   ├── indexerConnector_test.cpp
    │   │   │   │   │   ├── indexerConnector_test.hpp
    │   │   │   │   │   └── main.cpp
    │   │   │   │   └── unit/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── indexerConnectorAsync_test.cpp
    │   │   │   │       ├── indexerConnectorSync_test.cpp
    │   │   │   │       ├── main.cpp
    │   │   │   │       ├── monitoring_test.cpp
    │   │   │   │       ├── serverSelector_test.cpp
    │   │   │   │       ├── serverSelector_test.hpp
    │   │   │   │       └── mocks/
    │   │   │   │           ├── MockHTTPRequest.hpp
    │   │   │   │           └── MockServerSelector.hpp
    │   │   │   └── testtool/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── cmdArgParser.hpp
    │   │   │       ├── docker-compose.yml
    │   │   │       ├── main.cpp
    │   │   │       └── input/
    │   │   │           ├── config.json
    │   │   │           └── example.json
    │   │   ├── keystore/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   └── keyStore.hpp
    │   │   │   ├── qa/
    │   │   │   │   ├── requirements.txt
    │   │   │   │   └── test_keystore.py
    │   │   │   ├── src/
    │   │   │   │   ├── argsParser.hpp
    │   │   │   │   ├── keyStore.cpp
    │   │   │   │   └── main.cpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── component/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── keyStoreComponent_test.cpp
    │   │   │   │       ├── keyStoreComponent_test.hpp
    │   │   │   │       └── main.cpp
    │   │   │   └── testtool/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── main.cpp
    │   │   │       └── testtoolArgsParser.hpp
    │   │   ├── router/
    │   │   │   ├── readme.md
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   ├── commonDefs.h
    │   │   │   │   ├── iRouterProvider.hpp
    │   │   │   │   ├── router.h
    │   │   │   │   ├── routerModule.hpp
    │   │   │   │   ├── routerProvider.hpp
    │   │   │   │   └── routerSubscriber.hpp
    │   │   │   ├── src/
    │   │   │   │   ├── publisher.hpp
    │   │   │   │   ├── remoteProvider.hpp
    │   │   │   │   ├── remoteSubscriber.hpp
    │   │   │   │   ├── remoteSubscriptionManager.hpp
    │   │   │   │   ├── router.cpp
    │   │   │   │   ├── routerFacade.cpp
    │   │   │   │   ├── routerFacade.hpp
    │   │   │   │   ├── routerModuleGateway.hpp
    │   │   │   │   ├── subscriber.hpp
    │   │   │   │   └── wazuh-db/
    │   │   │   │       ├── endpointGetV1AgentsIds.hpp
    │   │   │   │       ├── endpointGetV1AgentsIdsGroups.hpp
    │   │   │   │       ├── endpointGetV1AgentsIdsGroupsParam.hpp
    │   │   │   │       ├── endpointGetV1AgentsParamGroups.hpp
    │   │   │   │       ├── endpointGetV1AgentsSync.hpp
    │   │   │   │       ├── endpointPostV1AgentsRestartInfo.hpp
    │   │   │   │       ├── endpointPostV1AgentsSummary.hpp
    │   │   │   │       ├── endpointPostV1AgentsSync.hpp
    │   │   │   │       └── gateway.hpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── benchmark/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   └── localBenchmark.cpp
    │   │   │   │   ├── component/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── interface_c_module_test.cpp
    │   │   │   │   │   ├── interface_c_module_test.hpp
    │   │   │   │   │   ├── interface_c_test.cpp
    │   │   │   │   │   ├── interface_c_test.hpp
    │   │   │   │   │   ├── interface_module_test.cpp
    │   │   │   │   │   ├── interface_module_test.hpp
    │   │   │   │   │   ├── interface_test.cpp
    │   │   │   │   │   ├── interface_test.hpp
    │   │   │   │   │   ├── main.cpp
    │   │   │   │   │   ├── remoteSubscriptionManager_test.cpp
    │   │   │   │   │   └── remoteSubscriptionManager_test.hpp
    │   │   │   │   └── unit/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── endpointGetV1AgentsIds_test.cpp
    │   │   │   │       ├── endpointGetV1AgentsIdsGroups_test.cpp
    │   │   │   │       ├── endpointGetV1AgentsIdsGroupsParam_test.cpp
    │   │   │   │       ├── endpointGetV1AgentsParamGroups_test.cpp
    │   │   │   │       ├── endpointGetV1AgentsSync_test.cpp
    │   │   │   │       ├── endpointPostV1AgentsRestartInfo_test.cpp
    │   │   │   │       ├── endpointPostV1AgentsSummary_test.cpp
    │   │   │   │       ├── endpointPostV1AgentsSync_test.cpp
    │   │   │   │       ├── main.cpp
    │   │   │   │       ├── publisher_test.cpp
    │   │   │   │       ├── remoteProvider_test.cpp
    │   │   │   │       ├── remoteSubscriber_test.cpp
    │   │   │   │       ├── remoteSubscriptionManager_test.cpp
    │   │   │   │       ├── router_subscriber_c_interface_test.cpp
    │   │   │   │       ├── routerApi_test.cpp
    │   │   │   │       ├── routerFacade_test.cpp
    │   │   │   │       ├── routerModule_test.cpp
    │   │   │   │       ├── routerProvider_test.cpp
    │   │   │   │       ├── routerSubscriber_test.cpp
    │   │   │   │       └── subscriber_test.cpp
    │   │   │   └── testtool/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── cmdArgsParser.hpp
    │   │   │       └── main.cpp
    │   │   ├── schema_validator/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   ├── schemaResources.hpp
    │   │   │   │   ├── schemaValidator.hpp
    │   │   │   │   └── schemaValidator_c.h
    │   │   │   ├── src/
    │   │   │   │   ├── schemaValidator.cpp
    │   │   │   │   └── schemaValidator_c.cpp
    │   │   │   └── tests/
    │   │   │       ├── CMakeLists.txt
    │   │   │       └── schemaValidator_test.cpp
    │   │   ├── sync_protocol/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   ├── agent_sync_protocol.hpp
    │   │   │   │   ├── agent_sync_protocol_c_interface.h
    │   │   │   │   ├── agent_sync_protocol_c_interface_types.h
    │   │   │   │   ├── agent_sync_protocol_c_wrapper.hpp
    │   │   │   │   ├── agent_sync_protocol_types.hpp
    │   │   │   │   ├── iagent_sync_protocol.hpp
    │   │   │   │   ├── ipersistent_queue.hpp
    │   │   │   │   └── isync_message_transport.hpp
    │   │   │   ├── src/
    │   │   │   │   ├── agent_sync_protocol.cpp
    │   │   │   │   ├── agent_sync_protocol_c_interface.cpp
    │   │   │   │   ├── ipersistent_queue_storage.hpp
    │   │   │   │   ├── logging_helper.hpp
    │   │   │   │   ├── mqueue_transport.cpp
    │   │   │   │   ├── mqueue_transport.hpp
    │   │   │   │   ├── persistent_queue.cpp
    │   │   │   │   ├── persistent_queue.hpp
    │   │   │   │   ├── persistent_queue_storage.cpp
    │   │   │   │   ├── persistent_queue_storage.hpp
    │   │   │   │   ├── sync_message_transport.cpp
    │   │   │   │   └── sync_message_transport.hpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── main.cpp
    │   │   │   │   ├── test_agent_sync_protocol.cpp
    │   │   │   │   ├── test_agent_sync_protocol_datacontext.cpp
    │   │   │   │   ├── test_mqueue_transport.cpp
    │   │   │   │   ├── test_persistent_queue.cpp
    │   │   │   │   ├── test_persistent_queue_storage.cpp
    │   │   │   │   ├── test_sync_protocol_integration.cpp
    │   │   │   │   └── mocks/
    │   │   │   │       └── mock_agent_sync_protocol.hpp
    │   │   │   └── testtool/
    │   │   │       ├── CMakeLists.txt
    │   │   │       └── main.cpp
    │   │   └── utils/
    │   │       ├── abstractLocking.hpp
    │   │       ├── abstractWait.h
    │   │       ├── archiveHelper.hpp
    │   │       ├── asyncValueDispatcher.hpp
    │   │       ├── builder.hpp
    │   │       ├── byteArrayHelper.h
    │   │       ├── cacheLRU.hpp
    │   │       ├── certHelper.hpp
    │   │       ├── chainOfResponsability.hpp
    │   │       ├── cjsonSmartDeleter.hpp
    │   │       ├── CMakeLists.txt
    │   │       ├── cmdHelper.h
    │   │       ├── conditionSync.hpp
    │   │       ├── customDeleter.hpp
    │   │       ├── defer.hpp
    │   │       ├── encodingWindowsHelper.h
    │   │       ├── epollWrapper.hpp
    │   │       ├── evpHelper.hpp
    │   │       ├── filterMsgDispatcher.hpp
    │   │       ├── functionTraits.hpp
    │   │       ├── globHelper.h
    │   │       ├── hashHelper.h
    │   │       ├── homedirHelper.hpp
    │   │       ├── jsonArrayParser.hpp
    │   │       ├── jsonIO.hpp
    │   │       ├── linuxInfoHelper.h
    │   │       ├── loggerHelper.h
    │   │       ├── makeUnique.h
    │   │       ├── mapWrapperSafe.h
    │   │       ├── msgDispatcher.h
    │   │       ├── networkHelper.h
    │   │       ├── networkUnixHelper.h
    │   │       ├── numericHelper.h
    │   │       ├── observer.hpp
    │   │       ├── opensslPrimitives.hpp
    │   │       ├── osPrimitives.hpp
    │   │       ├── osPrimitivesImplMac.h
    │   │       ├── osPrimitivesInterfaceMac.h
    │   │       ├── packet.hpp
    │   │       ├── pipelineNodesImp.h
    │   │       ├── pipelinePattern.h
    │   │       ├── promiseFactory.h
    │   │       ├── provider.hpp
    │   │       ├── reflectiveJson.hpp
    │   │       ├── registryHelper.h
    │   │       ├── rocksDBColumnFamily.hpp
    │   │       ├── rocksDBIterator.hpp
    │   │       ├── rocksDBOptions.hpp
    │   │       ├── rocksDBQueue.hpp
    │   │       ├── rocksDBQueueCF.hpp
    │   │       ├── rocksDBSharedBuffers.hpp
    │   │       ├── rocksDBWrapper.hpp
    │   │       ├── roundRobinSelector.hpp
    │   │       ├── rsaHelper.hpp
    │   │       ├── singleton.hpp
    │   │       ├── socketClient.hpp
    │   │       ├── socketDBWrapper.hpp
    │   │       ├── socketDBWrapperException.hpp
    │   │       ├── socketServer.hpp
    │   │       ├── socketWrapper.hpp
    │   │       ├── sqlite3Wrapper.hpp
    │   │       ├── sqliteWrapperTemp.h
    │   │       ├── stdFileSystemHelper.hpp
    │   │       ├── stringHelper.h
    │   │       ├── subscriber.hpp
    │   │       ├── threadDispatcher.h
    │   │       ├── threadEventDispatcher.hpp
    │   │       ├── threadSafeMultiQueue.hpp
    │   │       ├── threadSafeQueue.h
    │   │       ├── timeHelper.h
    │   │       ├── uniqueFD.hpp
    │   │       ├── wazuhDBQueryBuilder.hpp
    │   │       ├── windowsHelper.h
    │   │       ├── xzHelper.hpp
    │   │       ├── zlibHelper.hpp
    │   │       ├── benchmark/
    │   │       │   ├── CMakeLists.txt
    │   │       │   ├── main.cpp
    │   │       │   └── rocksdbqueue_test.cpp
    │   │       ├── flatbuffers/
    │   │       │   ├── CMakeLists.txt
    │   │       │   ├── schemas/
    │   │       │   │   ├── CMakeLists.txt
    │   │       │   │   └── inventorySync.fbs
    │   │       │   └── src/
    │   │       │       ├── argsParser.hpp
    │   │       │       └── main.cpp
    │   │       ├── mocks/
    │   │       │   ├── chainOfResponsabilityMock.h
    │   │       │   ├── sqlite3WrapperMock.hpp
    │   │       │   └── sqliteWrapperTempMock.h
    │   │       ├── tests/
    │   │       │   ├── archiveHelper_test.cpp
    │   │       │   ├── archiveHelper_test.hpp
    │   │       │   ├── asyncValueDispatcher_test.cpp
    │   │       │   ├── byteArrayHelper_test.cpp
    │   │       │   ├── byteArrayHelper_test.h
    │   │       │   ├── cacheLRU_test.cpp
    │   │       │   ├── cacheLRU_test.h
    │   │       │   ├── CMakeLists.txt
    │   │       │   ├── cmdHelper_test.cpp
    │   │       │   ├── cmdHelper_test.h
    │   │       │   ├── encodingWindows_test.cpp
    │   │       │   ├── encodingWindows_test.h
    │   │       │   ├── evpHelper_test.cpp
    │   │       │   ├── evpHelper_test.hpp
    │   │       │   ├── filterMsgDispatcher_test.cpp
    │   │       │   ├── filterMsgDispatcher_test.h
    │   │       │   ├── globHelper_test.cpp
    │   │       │   ├── globHelper_test.h
    │   │       │   ├── hashHelper_test.cpp
    │   │       │   ├── hashHelper_test.h
    │   │       │   ├── jsonArrayParser_test.cpp
    │   │       │   ├── jsonArrayParser_test.hpp
    │   │       │   ├── linuxInfoHelper_test.cpp
    │   │       │   ├── linuxInfoHelper_test.h
    │   │       │   ├── loggerHelper_test.cpp
    │   │       │   ├── loggerHelper_test.h
    │   │       │   ├── main.cpp
    │   │       │   ├── mapWrapperSafe_test.cpp
    │   │       │   ├── mapWrapperSafe_test.h
    │   │       │   ├── msgDispatcher_test.cpp
    │   │       │   ├── msgDispatcher_test.h
    │   │       │   ├── numericHelper_test.cpp
    │   │       │   ├── numericHelper_test.h
    │   │       │   ├── pipelineNodes_test.cpp
    │   │       │   ├── pipelineNodes_test.h
    │   │       │   ├── reflectiveJson_test.cpp
    │   │       │   ├── reflectiveJson_test.hpp
    │   │       │   ├── registryHelper_test.cpp
    │   │       │   ├── registryHelper_test.h
    │   │       │   ├── rocksDBQueue_test.cpp
    │   │       │   ├── rocksDBQueue_test.hpp
    │   │       │   ├── rocksDBSafeQueue_test.cpp
    │   │       │   ├── rocksDBSafeQueue_test.hpp
    │   │       │   ├── rocksDBSafeQueuePrefix_test.cpp
    │   │       │   ├── rocksDBSafeQueuePrefix_test.hpp
    │   │       │   ├── rocksDBWrapper_test.cpp
    │   │       │   ├── rocksDBWrapper_test.hpp
    │   │       │   ├── rsaHelper_test.cpp
    │   │       │   ├── rsaHelper_test.hpp
    │   │       │   ├── socket_test.cpp
    │   │       │   ├── socket_test.hpp
    │   │       │   ├── socketDBWrapper_test.cpp
    │   │       │   ├── socketDBWrapper_test.hpp
    │   │       │   ├── socketServer_test.cpp
    │   │       │   ├── socketServer_test.hpp
    │   │       │   ├── socketWrapper_test.cpp
    │   │       │   ├── socketWrapper_test.hpp
    │   │       │   ├── stdFileSystemHelper_test.cpp
    │   │       │   ├── stdFileSystemHelper_test.hpp
    │   │       │   ├── stringHelper_test.cpp
    │   │       │   ├── stringHelper_test.h
    │   │       │   ├── threadDispatcher_test.cpp
    │   │       │   ├── threadDispatcher_test.h
    │   │       │   ├── threadEventDispatcher_test.cpp
    │   │       │   ├── threadEventDispatcher_test.hpp
    │   │       │   ├── threadSafeMultiQueue_test.cpp
    │   │       │   ├── threadSafeMultiQueue_test.hpp
    │   │       │   ├── threadSafeQueue_test.cpp
    │   │       │   ├── threadSafeQueue_test.h
    │   │       │   ├── timeHelper_test.cpp
    │   │       │   ├── timeHelper_test.h
    │   │       │   ├── wazuhDBQueryBuilder_test.cpp
    │   │       │   ├── wazuhDBQueryBuilder_test.hpp
    │   │       │   ├── windowsHelper_test.cpp
    │   │       │   ├── windowsHelper_test.h
    │   │       │   ├── xzHelper_test.cpp
    │   │       │   ├── xzHelper_test.hpp
    │   │       │   ├── zlibHelper_test.cpp
    │   │       │   ├── zlibHelper_test.hpp
    │   │       │   ├── input_files/
    │   │       │   │   ├── archiveHelper/
    │   │       │   │   │   ├── content_example1.json
    │   │       │   │   │   └── content_example2.json
    │   │       │   │   └── zlibHelper/
    │   │       │   │       └── not_compressed.json
    │   │       │   └── mocks/
    │   │       │       ├── MockFileIO.hpp
    │   │       │       ├── MockFileSystem.hpp
    │   │       │       └── MockJsonIO.hpp
    │   │       └── xz/
    │   │           ├── fileDataCollector.hpp
    │   │           ├── fileDataProvider.hpp
    │   │           ├── iDataCollector.hpp
    │   │           ├── iDataProvider.hpp
    │   │           ├── stringDataProvider.hpp
    │   │           ├── vectorDataCollector.hpp
    │   │           ├── vectorDataProvider.hpp
    │   │           └── wrapper.hpp
    │   ├── syscheckd/
    │   │   ├── CMakeLists.txt
    │   │   ├── include/
    │   │   │   └── syscheck.h
    │   │   └── src/
    │   │       ├── config.c
    │   │       ├── fim_diff_changes.c
    │   │       ├── fim_scan.c
    │   │       ├── main.c
    │   │       ├── run_check.c
    │   │       ├── run_realtime.c
    │   │       ├── syscheck.c
    │   │       ├── syscom.c
    │   │       ├── db/
    │   │       │   ├── CMakeLists.txt
    │   │       │   ├── include/
    │   │       │   │   ├── db.h
    │   │       │   │   ├── db.hpp
    │   │       │   │   └── fimCommonDefs.h
    │   │       │   ├── smokeTests/
    │   │       │   │   ├── config.json
    │   │       │   │   ├── configWindows.json
    │   │       │   │   ├── atomicFileOperations/
    │   │       │   │   │   ├── CountFiles.json
    │   │       │   │   │   ├── DeleteFile.json
    │   │       │   │   │   ├── GetFile.json
    │   │       │   │   │   ├── SyncRow_1.json
    │   │       │   │   │   ├── SyncRow_2.json
    │   │       │   │   │   └── SyncRow_3.json
    │   │       │   │   ├── FimDBTransaction/
    │   │       │   │   │   ├── CountFiles.json
    │   │       │   │   │   ├── GetDeletedRows.json
    │   │       │   │   │   ├── StartTransaction.json
    │   │       │   │   │   ├── StartTransactionRegistryData.json
    │   │       │   │   │   ├── StartTransactionRegistryKey.json
    │   │       │   │   │   ├── SyncTxnRows_1.json
    │   │       │   │   │   ├── SyncTxnRows_2.json
    │   │       │   │   │   ├── SyncTxnRowsRegistryData_1.json
    │   │       │   │   │   ├── SyncTxnRowsRegistryData_2.json
    │   │       │   │   │   ├── SyncTxnRowsRegistryKey_1.json
    │   │       │   │   │   └── SyncTxnRowsRegistryKey_2.json
    │   │       │   │   └── integrityOps/
    │   │       │   │       ├── GetDeletedRows.json
    │   │       │   │       ├── StartTransaction.json
    │   │       │   │       ├── StartTransactionRegistryData.json
    │   │       │   │       ├── StartTransactionRegistryKey.json
    │   │       │   │       ├── SyncTxnRows_1.json
    │   │       │   │       ├── SyncTxnRowsRegistryData_1.json
    │   │       │   │       └── SyncTxnRowsRegistryKey_1.json
    │   │       │   ├── src/
    │   │       │   │   ├── db.cpp
    │   │       │   │   ├── dbFileItem.cpp
    │   │       │   │   ├── dbFileItem.hpp
    │   │       │   │   ├── dbItem.hpp
    │   │       │   │   ├── dbRegistryKey.cpp
    │   │       │   │   ├── dbRegistryKey.hpp
    │   │       │   │   ├── dbRegistryValue.cpp
    │   │       │   │   ├── dbRegistryValue.hpp
    │   │       │   │   ├── file.cpp
    │   │       │   │   ├── fimDB.cpp
    │   │       │   │   ├── fimDB.hpp
    │   │       │   │   ├── fimDBSpecialization.h
    │   │       │   │   ├── fimDBSpecializationWindows.cpp
    │   │       │   │   ├── fimDBSpecializationWindows.hpp
    │   │       │   │   └── registry.cpp
    │   │       │   ├── tests/
    │   │       │   │   ├── CMakeLists.txt
    │   │       │   │   └── db/
    │   │       │   │       ├── ComponentTest/
    │   │       │   │       │   ├── dbInterface/
    │   │       │   │       │   │   ├── CMakeLists.txt
    │   │       │   │       │   │   ├── dbTest.cpp
    │   │       │   │       │   │   ├── dbTest.h
    │   │       │   │       │   │   └── main.cpp
    │   │       │   │       │   ├── fileInterface/
    │   │       │   │       │   │   ├── CMakeLists.txt
    │   │       │   │       │   │   ├── fileTest.cpp
    │   │       │   │       │   │   └── main.cpp
    │   │       │   │       │   └── registryInterface/
    │   │       │   │       │       ├── CMakeLists.txt
    │   │       │   │       │       ├── main.cpp
    │   │       │   │       │       └── registryTest.cpp
    │   │       │   │       ├── dbItem/
    │   │       │   │       │   ├── FileItem/
    │   │       │   │       │   │   ├── CMakeLists.txt
    │   │       │   │       │   │   ├── dbFileItemTest.cpp
    │   │       │   │       │   │   ├── dbFileItemTest.h
    │   │       │   │       │   │   ├── dbFileItemTestWindows.cpp
    │   │       │   │       │   │   └── main.cpp
    │   │       │   │       │   ├── RegistryKey/
    │   │       │   │       │   │   ├── CMakeLists.txt
    │   │       │   │       │   │   ├── dbRegistryKeyTest.cpp
    │   │       │   │       │   │   ├── dbRegistryKeyTest.h
    │   │       │   │       │   │   └── main.cpp
    │   │       │   │       │   └── RegistryValue/
    │   │       │   │       │       ├── CMakeLists.txt
    │   │       │   │       │       ├── dbRegistryValueTest.cpp
    │   │       │   │       │       ├── dbRegistryValueTest.h
    │   │       │   │       │       └── main.cpp
    │   │       │   │       └── FIMDB/
    │   │       │   │           └── fimDBTests/
    │   │       │   │               ├── CMakeLists.txt
    │   │       │   │               ├── fimDBImpTests.cpp
    │   │       │   │               ├── fimDBImpTests.hpp
    │   │       │   │               └── main.cpp
    │   │       │   └── testtool/
    │   │       │       ├── Readme.md
    │   │       │       ├── action.h
    │   │       │       ├── CMakeLists.txt
    │   │       │       ├── cmdArgsHelper.h
    │   │       │       ├── factoryAction.h
    │   │       │       ├── main.cpp
    │   │       │       └── testContext.h
    │   │       ├── ebpf/
    │   │       │   ├── CMakeLists.txt
    │   │       │   ├── include/
    │   │       │   │   ├── bounded_queue.hpp
    │   │       │   │   ├── bpf_helpers.h
    │   │       │   │   ├── dynamic_library_wrapper.h
    │   │       │   │   ├── ebpf_whodata.h
    │   │       │   │   ├── ebpf_whodata.hpp
    │   │       │   │   └── wrapper_bpf.h
    │   │       │   ├── src/
    │   │       │   │   ├── ebpf_whodata.cpp
    │   │       │   │   ├── modern-arm.bpf.c
    │   │       │   │   └── modern.bpf.c
    │   │       │   └── tests/
    │   │       │       ├── CMakeLists.txt
    │   │       │       ├── fimEbpfWhodataTest/
    │   │       │       │   ├── close_libbpf_test.cpp
    │   │       │       │   ├── CMakeLists.txt
    │   │       │       │   ├── ebpf_mock_utils.hpp
    │   │       │       │   ├── ebpf_whodata_test.cpp
    │   │       │       │   ├── healthcheck_event_test.cpp
    │   │       │       │   ├── init_bpf_obj_test.cpp
    │   │       │       │   ├── init_libbpf_test.cpp
    │   │       │       │   ├── init_ring_buffer_test.cpp
    │   │       │       │   └── pop_event_test.cpp
    │   │       │       └── unit/
    │   │       │           ├── bounded_queue_test.cpp
    │   │       │           └── CMakeLists.txt
    │   │       ├── file/
    │   │       │   ├── events.c
    │   │       │   ├── file.c
    │   │       │   └── file.h
    │   │       ├── recovery/
    │   │       │   ├── recovery.c
    │   │       │   └── recovery.h
    │   │       ├── registry/
    │   │       │   ├── events.c
    │   │       │   ├── registry.c
    │   │       │   └── registry.h
    │   │       └── whodata/
    │   │           ├── audit_healthcheck.c
    │   │           ├── audit_parse.c
    │   │           ├── audit_rule_handling.c
    │   │           ├── syscheck_audit.c
    │   │           ├── syscheck_audit.h
    │   │           └── win_whodata.c
    │   ├── unit_tests/
    │   │   ├── Readme.md
    │   │   ├── agent.cmake
    │   │   ├── CMakeLists.txt
    │   │   ├── server.cmake
    │   │   ├── Toolchain-win32.cmake
    │   │   ├── winagent.cmake
    │   │   ├── active-response/
    │   │   │   ├── CMakeLists.txt
    │   │   │   └── test_active-response.c
    │   │   ├── addagent/
    │   │   │   ├── CMakeLists.txt
    │   │   │   └── test_manage_keys.c
    │   │   ├── client-agent/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_agcom.c
    │   │   │   ├── test_agentd.c
    │   │   │   ├── test_agentd_state.c
    │   │   │   ├── test_buffer.c
    │   │   │   ├── test_notify.c
    │   │   │   └── test_start_agent.c
    │   │   ├── config/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_client-config_validate_ipv6_link_local_interface.c
    │   │   │   ├── test_cluster.c
    │   │   │   └── test_indexer.c
    │   │   ├── config_files/
    │   │   │   ├── test_anti_tampering.conf
    │   │   │   ├── test_anti_tampering_invalid.conf
    │   │   │   ├── test_anti_tampering_no.conf
    │   │   │   ├── test_empty_config.conf
    │   │   │   ├── test_global.conf
    │   │   │   ├── test_global_no_cti_url.conf
    │   │   │   ├── test_internal_options.conf
    │   │   │   ├── test_local_internal_options.conf
    │   │   │   ├── test_syscheck.conf
    │   │   │   ├── test_syscheck2.conf
    │   │   │   ├── test_syscheck3.conf
    │   │   │   ├── test_syscheck4.conf
    │   │   │   ├── test_syscheck_config_win.conf
    │   │   │   ├── test_syscheck_max_dir.conf
    │   │   │   ├── test_syscheck_top_level.conf
    │   │   │   ├── test_syscheck_top_level_win.conf
    │   │   │   ├── test_syscheck_win.conf
    │   │   │   ├── test_syscheck_win2.conf
    │   │   │   ├── test_syscheck_win3.conf
    │   │   │   ├── test_syscheck_win4.conf
    │   │   │   ├── test_syscheck_win_max_dir.conf
    │   │   │   ├── test_vulnerability_detection.conf
    │   │   │   ├── test_vulnerability_detection_duplicate_configuration.conf
    │   │   │   ├── test_vulnerability_detection_invalid_index_status_setting.conf
    │   │   │   └── test_vulnerability_detection_multiple_configuration.conf
    │   │   ├── logcollector/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_journal_log.c
    │   │   │   ├── test_lccom.c
    │   │   │   ├── test_localfile-config.c
    │   │   │   ├── test_logcollector.c
    │   │   │   ├── test_macos_log.c
    │   │   │   ├── test_read_journal.c
    │   │   │   ├── test_read_macos.c
    │   │   │   ├── test_read_multiline.c
    │   │   │   ├── test_read_multiline_regex.c
    │   │   │   ├── test_read_syslog.c
    │   │   │   ├── test_read_win_event_channel.c
    │   │   │   └── test_state.c
    │   │   ├── monitord/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_monitor_actions.c
    │   │   │   └── test_monitord.c
    │   │   ├── os_auth/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_auth.c
    │   │   │   ├── test_auth_add.c
    │   │   │   ├── test_auth_key_request.c
    │   │   │   ├── test_auth_parse.c
    │   │   │   ├── test_auth_validate.c
    │   │   │   ├── test_authd-config.c
    │   │   │   └── test_generate_cert.c
    │   │   ├── os_crypto/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── aes/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_aes_op.c
    │   │   │   ├── blowfish/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_blowfish_op.c
    │   │   │   ├── hmac/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_hmac_op.c
    │   │   │   ├── md5/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_md5_op.c
    │   │   │   ├── md5_sha1_sha256/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_md5_sha1_sha256_op.c
    │   │   │   ├── sha1/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_sha1_op.c
    │   │   │   ├── sha256/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_sha256_op.c
    │   │   │   ├── sha512/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_sha512_op.c
    │   │   │   └── shared/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── test_keys.c
    │   │   │       └── test_msgs.c
    │   │   ├── os_execd/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_execd.c
    │   │   │   ├── test_get_command_by_name.c
    │   │   │   └── test_win_execd.c
    │   │   ├── os_net/
    │   │   │   ├── CMakeLists.txt
    │   │   │   └── test_os_net.c
    │   │   ├── os_regex/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_os_regex.c
    │   │   │   ├── test_os_regex_execute.c
    │   │   │   ├── test_os_regex_execute.json
    │   │   │   ├── test_os_regex_execute.md
    │   │   │   └── test_os_regex_match.c
    │   │   ├── os_xml/
    │   │   │   ├── CMakeLists.txt
    │   │   │   └── test_os_xml.c
    │   │   ├── os_zlib/
    │   │   │   ├── CMakeLists.txt
    │   │   │   └── test_os_zlib.c
    │   │   ├── remoted/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_bulk.c
    │   │   │   ├── test_manager.c
    │   │   │   ├── test_netbuffer.c
    │   │   │   ├── test_remcom.c
    │   │   │   ├── test_remote-config.c
    │   │   │   ├── test_remote-state.c
    │   │   │   ├── test_save_ctrlmsg_thread.c
    │   │   │   ├── test_secure.c
    │   │   │   ├── test_sendmsg.c
    │   │   │   └── test_syslogtcp.c
    │   │   ├── shared/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_agent_op.c
    │   │   │   ├── test_atomic.c
    │   │   │   ├── test_audit_op.c
    │   │   │   ├── test_batch_queue_op.c
    │   │   │   ├── test_binaries_op.c
    │   │   │   ├── test_bqueue.c
    │   │   │   ├── test_buffer_op.c
    │   │   │   ├── test_bzip2_op.c
    │   │   │   ├── test_custom_output_search_replace.c
    │   │   │   ├── test_enrollment_op.c
    │   │   │   ├── test_expression.c
    │   │   │   ├── test_file_op.c
    │   │   │   ├── test_fs_op.c
    │   │   │   ├── test_hashmap_op.c
    │   │   │   ├── test_indexed_queue_op.c
    │   │   │   ├── test_json-queue.c
    │   │   │   ├── test_json_op.c
    │   │   │   ├── test_labels_op.c
    │   │   │   ├── test_list_op.c
    │   │   │   ├── test_log_builder.c
    │   │   │   ├── test_module_limits.c
    │   │   │   ├── test_mq_op.c
    │   │   │   ├── test_privsep_op.c
    │   │   │   ├── test_queue_linked_op.c
    │   │   │   ├── test_queue_op.c
    │   │   │   ├── test_rbtree_op.c
    │   │   │   ├── test_read-alert.c
    │   │   │   ├── test_remoted_op.c
    │   │   │   ├── test_rwlock_op.c
    │   │   │   ├── test_schedule_scan.c
    │   │   │   ├── test_ssl_op.c
    │   │   │   ├── test_string_op.c
    │   │   │   ├── test_syscheck_op.c
    │   │   │   ├── test_sysinfo_utils.c
    │   │   │   ├── test_time_op.c
    │   │   │   ├── test_url.c
    │   │   │   ├── test_utf8_op.c
    │   │   │   ├── test_validate_op.c
    │   │   │   ├── test_version_op.c
    │   │   │   ├── test_wazuhdb_op.c
    │   │   │   └── test_wazuhdb_queries_op.c
    │   │   ├── syscheckd/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── expect_fim_diff_changes.c
    │   │   │   ├── expect_run_check.c
    │   │   │   ├── test_config.c
    │   │   │   ├── test_fim.h
    │   │   │   ├── test_fim_diff_changes.c
    │   │   │   ├── test_fim_scan.c
    │   │   │   ├── test_fim_sync_limits.c
    │   │   │   ├── test_recovery.c
    │   │   │   ├── test_run_check.c
    │   │   │   ├── test_run_realtime.c
    │   │   │   ├── test_syscheck.c
    │   │   │   ├── test_syscom.c
    │   │   │   ├── utils.c
    │   │   │   ├── registry/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── test_events.c
    │   │   │   │   └── test_registry.c
    │   │   │   └── whodata/
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── test_audit_healthcheck.c
    │   │   │       ├── test_audit_parse.c
    │   │   │       ├── test_audit_rule_handling.c
    │   │   │       ├── test_syscheck_audit.c
    │   │   │       └── test_syscheck_ebpf.c
    │   │   ├── wazuh_db/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── test_wazuh_db-config.c
    │   │   │   ├── test_wazuh_db_state.c
    │   │   │   ├── test_wdb.c
    │   │   │   ├── test_wdb_com.c
    │   │   │   ├── test_wdb_global_parser.c
    │   │   │   ├── test_wdb_metadata.c
    │   │   │   ├── test_wdb_parser.c
    │   │   │   ├── test_wdb_pool.c
    │   │   │   ├── test_wdb_task.c
    │   │   │   ├── test_wdb_task_parser.c
    │   │   │   └── test_wdb_upgrade.c
    │   │   ├── wazuh_modules/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── agent_upgrade/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── test_wm_agent_upgrade.c
    │   │   │   │   ├── test_wm_agent_upgrade_agent.c
    │   │   │   │   ├── test_wm_agent_upgrade_com.c
    │   │   │   │   ├── test_wm_agent_upgrade_commands.c
    │   │   │   │   ├── test_wm_agent_upgrade_manager.c
    │   │   │   │   ├── test_wm_agent_upgrade_parsing.c
    │   │   │   │   ├── test_wm_agent_upgrade_tasks.c
    │   │   │   │   ├── test_wm_agent_upgrade_tasks_callbacks.c
    │   │   │   │   ├── test_wm_agent_upgrade_upgrades.c
    │   │   │   │   └── test_wm_agent_upgrade_validate.c
    │   │   │   ├── aws/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_aws.c
    │   │   │   ├── azure/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_azure.c
    │   │   │   ├── command/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_command.c
    │   │   │   ├── control/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_control.c
    │   │   │   ├── database/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_database.c
    │   │   │   ├── docker/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_docker.c
    │   │   │   ├── exec/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_exec.c
    │   │   │   ├── gcp/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── test_wm_gcp.c
    │   │   │   │   └── test_wmodules_gcp.c
    │   │   │   ├── github/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_github.c
    │   │   │   ├── ms_graph/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_ms_graph.c
    │   │   │   ├── office365/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_office365.c
    │   │   │   ├── scheduling/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── test_wmodules_scheduling.c
    │   │   │   │   ├── wmodules_scheduling_helpers.c
    │   │   │   │   └── wmodules_scheduling_helpers.h
    │   │   │   ├── task_manager/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── test_wm_task_manager.c
    │   │   │   │   ├── test_wm_task_manager_commands.c
    │   │   │   │   └── test_wm_task_manager_parsing.c
    │   │   │   ├── vulnerability_detection/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   └── test_wm_vulnerability_detection.c
    │   │   │   └── wmodules/
    │   │   │       ├── CMakeLists.txt
    │   │   │       └── test_wmodules.c
    │   │   ├── win32/
    │   │   │   ├── CMakeLists.txt
    │   │   │   └── test_win_utils.c
    │   │   └── wrappers/
    │   │       ├── common.c
    │   │       ├── common.h
    │   │       ├── externals/
    │   │       │   ├── audit/
    │   │       │   │   ├── libaudit_wrappers.c
    │   │       │   │   └── libaudit_wrappers.h
    │   │       │   ├── bzip2/
    │   │       │   │   ├── bzlib_wrappers.c
    │   │       │   │   └── bzlib_wrappers.h
    │   │       │   ├── cJSON/
    │   │       │   │   ├── cJSON_wrappers.c
    │   │       │   │   └── cJSON_wrappers.h
    │   │       │   ├── openssl/
    │   │       │   │   ├── bio_wrappers.c
    │   │       │   │   ├── bio_wrappers.h
    │   │       │   │   ├── digest_wrappers.c
    │   │       │   │   ├── digest_wrappers.h
    │   │       │   │   ├── evp_wrappers.c
    │   │       │   │   ├── evp_wrappers.h
    │   │       │   │   ├── init_wrappers.c
    │   │       │   │   ├── init_wrappers.h
    │   │       │   │   ├── pem_wrappers.c
    │   │       │   │   ├── pem_wrappers.h
    │   │       │   │   ├── rsa_wrappers.c
    │   │       │   │   ├── rsa_wrappers.h
    │   │       │   │   ├── ssl_init_wrappers.c
    │   │       │   │   ├── ssl_init_wrappers.h
    │   │       │   │   ├── ssl_lib_wrappers.c
    │   │       │   │   ├── ssl_lib_wrappers.h
    │   │       │   │   ├── x509_wrapppers.c
    │   │       │   │   └── x509_wrapppers.h
    │   │       │   ├── pcre2/
    │   │       │   │   ├── pcre2_wrappers.c
    │   │       │   │   └── pcre2_wrappers.h
    │   │       │   ├── procpc/
    │   │       │   │   ├── readproc_wrappers.c
    │   │       │   │   └── readproc_wrappers.h
    │   │       │   ├── sqlite/
    │   │       │   │   ├── sqlite3_wrappers.c
    │   │       │   │   └── sqlite3_wrappers.h
    │   │       │   └── zlib/
    │   │       │       ├── zlib_wrappers.c
    │   │       │       └── zlib_wrappers.h
    │   │       ├── libc/
    │   │       │   ├── stdio_wrappers.c
    │   │       │   ├── stdio_wrappers.h
    │   │       │   ├── stdlib_wrappers.c
    │   │       │   ├── stdlib_wrappers.h
    │   │       │   ├── string_wrappers.c
    │   │       │   ├── string_wrappers.h
    │   │       │   ├── time_wrappers.c
    │   │       │   └── time_wrappers.h
    │   │       ├── linux/
    │   │       │   ├── dlfcn_wrappers.c
    │   │       │   ├── dlfcn_wrappers.h
    │   │       │   ├── ebpf_wrappers.c
    │   │       │   ├── ebpf_wrappers.h
    │   │       │   ├── inotify_wrappers.c
    │   │       │   ├── inotify_wrappers.h
    │   │       │   ├── socket_wrappers.c
    │   │       │   ├── socket_wrappers.h
    │   │       │   ├── wait_wrappers.c
    │   │       │   └── wait_wrappers.h
    │   │       ├── macos/
    │   │       │   ├── libplist_wrappers.c
    │   │       │   ├── libplist_wrappers.h
    │   │       │   ├── libwazuh_wrappers.c
    │   │       │   ├── libwazuh_wrappers.h
    │   │       │   ├── libc/
    │   │       │   │   ├── stdio_wrappers.c
    │   │       │   │   └── stdio_wrappers.h
    │   │       │   └── posix/
    │   │       │       ├── dirent_wrappers.c
    │   │       │       └── dirent_wrappers.h
    │   │       ├── posix/
    │   │       │   ├── dirent_wrappers.c
    │   │       │   ├── dirent_wrappers.h
    │   │       │   ├── grp_wrappers.c
    │   │       │   ├── grp_wrappers.h
    │   │       │   ├── pthread_wrappers.c
    │   │       │   ├── pthread_wrappers.h
    │   │       │   ├── pwd_wrappers.c
    │   │       │   ├── pwd_wrappers.h
    │   │       │   ├── select_wrappers.c
    │   │       │   ├── select_wrappers.h
    │   │       │   ├── signal_wrappers.c
    │   │       │   ├── signal_wrappers.h
    │   │       │   ├── stat_wrappers.c
    │   │       │   ├── stat_wrappers.h
    │   │       │   ├── time_wrappers.c
    │   │       │   ├── time_wrappers.h
    │   │       │   ├── unistd_wrappers.c
    │   │       │   └── unistd_wrappers.h
    │   │       ├── wazuh/
    │   │       │   ├── client-agent/
    │   │       │   │   ├── buffer_wrappers.c
    │   │       │   │   ├── buffer_wrappers.h
    │   │       │   │   ├── notify_wrappers.c
    │   │       │   │   ├── notify_wrappers.h
    │   │       │   │   ├── start_agent.c
    │   │       │   │   └── start_agent.h
    │   │       │   ├── config/
    │   │       │   │   ├── syscheck_config_wrappers.c
    │   │       │   │   └── syscheck_config_wrappers.h
    │   │       │   ├── data_provider/
    │   │       │   │   ├── sysInfo_wrappers.c
    │   │       │   │   └── sysInfo_wrappers.h
    │   │       │   ├── logcollector/
    │   │       │   │   ├── logcollector_wrappers.c
    │   │       │   │   ├── logcollector_wrappers.h
    │   │       │   │   ├── macos_log_wrappers.c
    │   │       │   │   └── macos_log_wrappers.h
    │   │       │   ├── monitord/
    │   │       │   │   ├── monitord_wrappers.c
    │   │       │   │   └── monitord_wrappers.h
    │   │       │   ├── os_auth/
    │   │       │   │   ├── os_auth_wrappers.c
    │   │       │   │   └── os_auth_wrappers.h
    │   │       │   ├── os_crypto/
    │   │       │   │   ├── keys_wrappers.c
    │   │       │   │   ├── keys_wrappers.h
    │   │       │   │   ├── md5_op_wrappers.c
    │   │       │   │   ├── md5_op_wrappers.h
    │   │       │   │   ├── msgs_wrappers.c
    │   │       │   │   ├── msgs_wrappers.h
    │   │       │   │   ├── sha1_op_wrappers.c
    │   │       │   │   ├── sha1_op_wrappers.h
    │   │       │   │   ├── sha256_op_wrappers.c
    │   │       │   │   ├── sha256_op_wrappers.h
    │   │       │   │   ├── signature_wrappers.c
    │   │       │   │   └── signature_wrappers.h
    │   │       │   ├── os_execd/
    │   │       │   │   ├── exec_wrappers.c
    │   │       │   │   └── exec_wrappers.h
    │   │       │   ├── os_net/
    │   │       │   │   ├── os_net_wrappers.c
    │   │       │   │   └── os_net_wrappers.h
    │   │       │   ├── os_regex/
    │   │       │   │   ├── os_regex_wrappers.c
    │   │       │   │   └── os_regex_wrappers.h
    │   │       │   ├── os_xml/
    │   │       │   │   ├── os_xml_wrappers.c
    │   │       │   │   └── os_xml_wrappers.h
    │   │       │   ├── remoted/
    │   │       │   │   ├── agent_metadata_wrappers.c
    │   │       │   │   ├── agent_metadata_wrappers.h
    │   │       │   │   ├── config_wrappers.c
    │   │       │   │   ├── config_wrappers.h
    │   │       │   │   ├── manager_wrappers.c
    │   │       │   │   ├── manager_wrappers.h
    │   │       │   │   ├── netbuffer_wrappers.c
    │   │       │   │   ├── netbuffer_wrappers.h
    │   │       │   │   ├── netcounter_wrappers.c
    │   │       │   │   ├── netcounter_wrappers.h
    │   │       │   │   ├── queue_wrappers.c
    │   │       │   │   ├── queue_wrappers.h
    │   │       │   │   ├── remoted_op_wrappers.c
    │   │       │   │   ├── remoted_op_wrappers.h
    │   │       │   │   ├── request_wrappers.c
    │   │       │   │   ├── request_wrappers.h
    │   │       │   │   ├── shared_download_wrappers.c
    │   │       │   │   ├── shared_download_wrappers.h
    │   │       │   │   ├── state_wrappers.c
    │   │       │   │   └── state_wrappers.h
    │   │       │   ├── shared/
    │   │       │   │   ├── agent_op_wrappers.c
    │   │       │   │   ├── agent_op_wrappers.h
    │   │       │   │   ├── atomic_wrappers.c
    │   │       │   │   ├── atomic_wrappers.h
    │   │       │   │   ├── audit_op_wrappers.c
    │   │       │   │   ├── audit_op_wrappers.h
    │   │       │   │   ├── auth_client_wrappers.c
    │   │       │   │   ├── auth_client_wrappers.h
    │   │       │   │   ├── b64_wrappers.c
    │   │       │   │   ├── b64_wrappers.h
    │   │       │   │   ├── batch_queue_op_wrappers.c
    │   │       │   │   ├── batch_queue_op_wrappers.h
    │   │       │   │   ├── binaries_op_wrappers.c
    │   │       │   │   ├── binaries_op_wrappers.h
    │   │       │   │   ├── bqueue_op_wrappers.c
    │   │       │   │   ├── bqueue_op_wrappers.h
    │   │       │   │   ├── check_cert_op_wrappers.c
    │   │       │   │   ├── check_cert_op_wrappers.h
    │   │       │   │   ├── cluster_op_wrappers.c
    │   │       │   │   ├── cluster_op_wrappers.h
    │   │       │   │   ├── cluster_utils_wrappers.c
    │   │       │   │   ├── cluster_utils_wrappers.h
    │   │       │   │   ├── debug_op_wrappers.c
    │   │       │   │   ├── debug_op_wrappers.h
    │   │       │   │   ├── exec_op_wrappers.c
    │   │       │   │   ├── exec_op_wrappers.h
    │   │       │   │   ├── expression_wrappers.c
    │   │       │   │   ├── expression_wrappers.h
    │   │       │   │   ├── file_op_wrappers.c
    │   │       │   │   ├── file_op_wrappers.h
    │   │       │   │   ├── fs_op_wrappers.c
    │   │       │   │   ├── fs_op_wrappers.h
    │   │       │   │   ├── hash_op_wrappers.c
    │   │       │   │   ├── hash_op_wrappers.h
    │   │       │   │   ├── indexed_queue_op_wrappers.c
    │   │       │   │   ├── indexed_queue_op_wrappers.h
    │   │       │   │   ├── json_op_wrappers.c
    │   │       │   │   ├── json_op_wrappers.h
    │   │       │   │   ├── json_queue_wrappers.c
    │   │       │   │   ├── json_queue_wrappers.h
    │   │       │   │   ├── labels_op_wrappers.c
    │   │       │   │   ├── labels_op_wrappers.h
    │   │       │   │   ├── list_op_wrappers.c
    │   │       │   │   ├── list_op_wrappers.h
    │   │       │   │   ├── mq_op_wrappers.c
    │   │       │   │   ├── mq_op_wrappers.h
    │   │       │   │   ├── notify_op_wrappers.c
    │   │       │   │   ├── notify_op_wrappers.h
    │   │       │   │   ├── os_utils_wrappers.c
    │   │       │   │   ├── os_utils_wrappers.h
    │   │       │   │   ├── privsep_op_wrappers.c
    │   │       │   │   ├── privsep_op_wrappers.h
    │   │       │   │   ├── pthreads_op_wrappers.c
    │   │       │   │   ├── pthreads_op_wrappers.h
    │   │       │   │   ├── queue_linked_op_wrappers.c
    │   │       │   │   ├── queue_linked_op_wrappers.h
    │   │       │   │   ├── queue_op_wrappers.c
    │   │       │   │   ├── queue_op_wrappers.h
    │   │       │   │   ├── randombytes_wrappers.c
    │   │       │   │   ├── randombytes_wrappers.h
    │   │       │   │   ├── rbtree_op_wrappers.c
    │   │       │   │   ├── rbtree_op_wrappers.h
    │   │       │   │   ├── read-agents_wrappers.c
    │   │       │   │   ├── read-agents_wrappers.h
    │   │       │   │   ├── rwlock_op_wrappers.c
    │   │       │   │   ├── rwlock_op_wrappers.h
    │   │       │   │   ├── schedule_scan_wrappers.c
    │   │       │   │   ├── schedule_scan_wrappers.h
    │   │       │   │   ├── shared.cmake
    │   │       │   │   ├── ssl_op_wrappers.c
    │   │       │   │   ├── ssl_op_wrappers.h
    │   │       │   │   ├── string_op_wrappers.c
    │   │       │   │   ├── string_op_wrappers.h
    │   │       │   │   ├── sym_load_wrappers.c
    │   │       │   │   ├── sym_load_wrappers.h
    │   │       │   │   ├── syscheck_op_wrappers.c
    │   │       │   │   ├── syscheck_op_wrappers.h
    │   │       │   │   ├── sysinfo_utils_wrappers.c
    │   │       │   │   ├── sysinfo_utils_wrappers.h
    │   │       │   │   ├── time_op_wrappers.c
    │   │       │   │   ├── time_op_wrappers.h
    │   │       │   │   ├── url_wrappers.c
    │   │       │   │   ├── url_wrappers.h
    │   │       │   │   ├── utf8_op_wrappers.c
    │   │       │   │   ├── utf8_op_wrappers.h
    │   │       │   │   ├── utf8_winapi_wrapper_wrappers.c
    │   │       │   │   ├── utf8_winapi_wrapper_wrappers.h
    │   │       │   │   ├── validate_op_wrappers.c
    │   │       │   │   ├── validate_op_wrappers.h
    │   │       │   │   ├── vector_op_wrappers.c
    │   │       │   │   ├── vector_op_wrappers.h
    │   │       │   │   ├── version_op_wrappers.c
    │   │       │   │   ├── version_op_wrappers.h
    │   │       │   │   ├── wazuhdb_queries_op_wrappers.c
    │   │       │   │   └── wazuhdb_queries_op_wrappers.h
    │   │       │   ├── shared_modules/
    │   │       │   │   ├── agent_sync_protocol_wrappers.c
    │   │       │   │   ├── agent_sync_protocol_wrappers.h
    │   │       │   │   ├── router_wrappers.c
    │   │       │   │   ├── router_wrappers.h
    │   │       │   │   ├── schema_validator_wrappers.c
    │   │       │   │   └── schema_validator_wrappers.h
    │   │       │   ├── syscheckd/
    │   │       │   │   ├── audit_parse_wrappers.c
    │   │       │   │   ├── audit_parse_wrappers.h
    │   │       │   │   ├── audit_rule_handling_wrappers.c
    │   │       │   │   ├── audit_rule_handling_wrappers.h
    │   │       │   │   ├── config_wrappers.c
    │   │       │   │   ├── config_wrappers.h
    │   │       │   │   ├── create_db_wrappers.c
    │   │       │   │   ├── create_db_wrappers.h
    │   │       │   │   ├── fim_db_wrappers.c
    │   │       │   │   ├── fim_db_wrappers.h
    │   │       │   │   ├── fim_diff_changes_wrappers.c
    │   │       │   │   ├── fim_diff_changes_wrappers.h
    │   │       │   │   ├── fim_recovery_wrappers.c
    │   │       │   │   ├── fim_recovery_wrappers.h
    │   │       │   │   ├── fim_sync_wrappers.c
    │   │       │   │   ├── fim_sync_wrappers.h
    │   │       │   │   ├── registry.c
    │   │       │   │   ├── registry.h
    │   │       │   │   ├── run_check_wrappers.c
    │   │       │   │   ├── run_check_wrappers.h
    │   │       │   │   ├── run_realtime_wrappers.c
    │   │       │   │   ├── run_realtime_wrappers.h
    │   │       │   │   ├── syscheck_audit_wrappers.c
    │   │       │   │   ├── syscheck_audit_wrappers.h
    │   │       │   │   ├── syscom_wrappers.c
    │   │       │   │   ├── syscom_wrappers.h
    │   │       │   │   ├── win_whodata_wrappers.c
    │   │       │   │   └── win_whodata_wrappers.h
    │   │       │   ├── wazuh_db/
    │   │       │   │   ├── wdb_global_wrappers.c
    │   │       │   │   ├── wdb_global_wrappers.h
    │   │       │   │   ├── wdb_metadata_wrappers.c
    │   │       │   │   ├── wdb_metadata_wrappers.h
    │   │       │   │   ├── wdb_pool_wrappers.c
    │   │       │   │   ├── wdb_pool_wrappers.h
    │   │       │   │   ├── wdb_state_wrappers.c
    │   │       │   │   ├── wdb_state_wrappers.h
    │   │       │   │   ├── wdb_task_wrappers.c
    │   │       │   │   ├── wdb_task_wrappers.h
    │   │       │   │   ├── wdb_wrappers.c
    │   │       │   │   └── wdb_wrappers.h
    │   │       │   └── wazuh_modules/
    │   │       │       ├── wm_agent_upgrade_agent_wrappers.c
    │   │       │       ├── wm_agent_upgrade_agent_wrappers.h
    │   │       │       ├── wm_agent_upgrade_wrappers.c
    │   │       │       ├── wm_agent_upgrade_wrappers.h
    │   │       │       ├── wm_exec_wrappers.c
    │   │       │       ├── wm_exec_wrappers.h
    │   │       │       ├── wm_task_manager_wrappers.c
    │   │       │       ├── wm_task_manager_wrappers.h
    │   │       │       ├── wmodules_wrappers.c
    │   │       │       └── wmodules_wrappers.h
    │   │       └── windows/
    │   │           ├── aclapi_wrappers.c
    │   │           ├── aclapi_wrappers.h
    │   │           ├── errhandlingapi_wrappers.c
    │   │           ├── errhandlingapi_wrappers.h
    │   │           ├── fileapi_wrappers.c
    │   │           ├── fileapi_wrappers.h
    │   │           ├── handleapi_wrappers.c
    │   │           ├── handleapi_wrappers.h
    │   │           ├── heapapi_wrappers.c
    │   │           ├── heapapi_wrappers.h
    │   │           ├── io_wrappers.c
    │   │           ├── io_wrappers.h
    │   │           ├── ntsecapi_wrappers.c
    │   │           ├── ntsecapi_wrappers.h
    │   │           ├── processthreadsapi_wrappers.c
    │   │           ├── processthreadsapi_wrappers.h
    │   │           ├── sddl_wrappers.c
    │   │           ├── sddl_wrappers.h
    │   │           ├── securitybaseapi_wrappers.c
    │   │           ├── securitybaseapi_wrappers.h
    │   │           ├── stat64_wrappers.c
    │   │           ├── stat64_wrappers.h
    │   │           ├── stringapiset_wrappers.c
    │   │           ├── stringapiset_wrappers.h
    │   │           ├── synchapi_wrappers.c
    │   │           ├── synchapi_wrappers.h
    │   │           ├── sysinfoapi_wrappers.c
    │   │           ├── sysinfoapi_wrappers.h
    │   │           ├── system_calls_wrappers.c
    │   │           ├── system_calls_wrappers.h
    │   │           ├── timezoneapi_wrappers.c
    │   │           ├── timezoneapi_wrappers.h
    │   │           ├── url_wrappers.c
    │   │           ├── url_wrappers.h
    │   │           ├── winbase_wrappers.c
    │   │           ├── winbase_wrappers.h
    │   │           ├── winevt_wrappers.c
    │   │           ├── winevt_wrappers.h
    │   │           ├── winreg_wrappers.c
    │   │           ├── winreg_wrappers.h
    │   │           ├── winsock_wrappers.c
    │   │           ├── winsock_wrappers.h
    │   │           └── libc/
    │   │               ├── kernel32_wrappers.c
    │   │               ├── kernel32_wrappers.h
    │   │               ├── stdio_wrappers.c
    │   │               └── stdio_wrappers.h
    │   ├── util/
    │   │   ├── CMakeLists.txt
    │   │   └── src/
    │   │       └── verify-agent-conf.c
    │   ├── wazuh_db/
    │   │   ├── CMakeLists.txt
    │   │   ├── embed_sql.cmake
    │   │   ├── include/
    │   │   │   ├── wdb.h
    │   │   │   └── wdb_pool.h
    │   │   ├── schemas/
    │   │   │   ├── schema_global.sql
    │   │   │   ├── schema_global_upgrade_v1.sql
    │   │   │   ├── schema_global_upgrade_v2.sql
    │   │   │   ├── schema_global_upgrade_v3.sql
    │   │   │   ├── schema_global_upgrade_v4.sql
    │   │   │   ├── schema_global_upgrade_v5.sql
    │   │   │   ├── schema_global_upgrade_v6.sql
    │   │   │   ├── schema_global_upgrade_v7.sql
    │   │   │   └── schema_task_manager.sql
    │   │   └── src/
    │   │       ├── main.c
    │   │       ├── wdb.c
    │   │       ├── wdb_com.c
    │   │       ├── wdb_global.c
    │   │       ├── wdb_metadata.c
    │   │       ├── wdb_parser.c
    │   │       ├── wdb_pool.c
    │   │       ├── wdb_state.c
    │   │       ├── wdb_state.h
    │   │       ├── wdb_task.c
    │   │       └── wdb_upgrade.c
    │   ├── wazuh_modules/
    │   │   ├── CMakeLists.txt
    │   │   ├── agent_info/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── agent_info_impl/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   └── agent_info_impl.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   └── agent_info_impl.cpp
    │   │   │   │   └── tests/
    │   │   │   │       ├── agent_info_basic_test.cpp
    │   │   │   │       ├── agent_info_cluster_coordination_test.cpp
    │   │   │   │       ├── agent_info_coordination_test.cpp
    │   │   │   │       ├── agent_info_dbsync_test.cpp
    │   │   │   │       ├── agent_info_events_test.cpp
    │   │   │   │       ├── agent_info_integration_test.cpp
    │   │   │   │       ├── agent_info_integrity_test.cpp
    │   │   │   │       ├── agent_info_logging_test.cpp
    │   │   │   │       ├── agent_info_metadata_test.cpp
    │   │   │   │       ├── agent_info_mock.cpp
    │   │   │   │       ├── agent_info_successful_coordination_test.cpp
    │   │   │   │       ├── agent_info_utils_test.cpp
    │   │   │   │       └── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   └── agent_info.h
    │   │   │   └── src/
    │   │   │       └── agent_info.cpp
    │   │   ├── include/
    │   │   │   ├── wmodules.h
    │   │   │   └── wmodules_def.h
    │   │   ├── inventory_sync/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   ├── inventory_sync.h
    │   │   │   │   └── inventorySync.hpp
    │   │   │   ├── qa/
    │   │   │   │   ├── README.md
    │   │   │   │   ├── flatbuffers_manager.py
    │   │   │   │   ├── generate_flatbuffers.py
    │   │   │   │   ├── pytest.ini
    │   │   │   │   ├── requirements.txt
    │   │   │   │   ├── run_tests.py
    │   │   │   │   ├── test_inventory_sync_integration.py
    │   │   │   │   ├── wazuh_agent_controller.py
    │   │   │   │   ├── expected_data/
    │   │   │   │   │   ├── basic_flow.json
    │   │   │   │   │   ├── data_clean_multiple_indices_flow.json
    │   │   │   │   │   ├── data_clean_single_index_flow.json
    │   │   │   │   │   ├── data_context_multiple_flow.json
    │   │   │   │   │   ├── data_context_single_flow.json
    │   │   │   │   │   ├── groups_delta_flow.json
    │   │   │   │   │   ├── metadata_delta_flow.json
    │   │   │   │   │   ├── module_check_match_flow.json
    │   │   │   │   │   ├── module_check_mismatch_flow.json
    │   │   │   │   │   ├── nodata_flow.json
    │   │   │   │   │   ├── reqret_end_flow.json
    │   │   │   │   │   └── simple_reqret_test.json
    │   │   │   │   └── test_data/
    │   │   │   │       ├── basic_flow.json
    │   │   │   │       ├── data_clean_multiple_indices_flow.json
    │   │   │   │       ├── data_clean_single_index_flow.json
    │   │   │   │       ├── data_context_multiple_flow.json
    │   │   │   │       ├── data_context_single_flow.json
    │   │   │   │       ├── groups_delta_flow.json
    │   │   │   │       ├── metadata_delta_flow.json
    │   │   │   │       ├── module_check_match_flow.json
    │   │   │   │       ├── module_check_mismatch_flow.json
    │   │   │   │       ├── nodata_flow.json
    │   │   │   │       ├── reqret_end_flow.json
    │   │   │   │       └── simple_reqret_test.json
    │   │   │   ├── src/
    │   │   │   │   ├── agentSession.hpp
    │   │   │   │   ├── context.hpp
    │   │   │   │   ├── gapSet.hpp
    │   │   │   │   ├── inventorySync.cpp
    │   │   │   │   ├── inventorySyncFacade.hpp
    │   │   │   │   ├── inventorySyncQueryBuilder.hpp
    │   │   │   │   └── responseDispatcher.hpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── benchmark/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   └── processing.cpp
    │   │   │   │   └── unit/
    │   │   │   │       ├── agentSession_test.cpp
    │   │   │   │       ├── gapSet_test.cpp
    │   │   │   │       ├── mock_agentSession.hpp
    │   │   │   │       └── responseDispatcher_test.cpp
    │   │   │   └── testtool/
    │   │   │       ├── README.md
    │   │   │       ├── CMakeLists.txt
    │   │   │       ├── main.cpp
    │   │   │       └── test_data/
    │   │   │           ├── config.json
    │   │   │           ├── INPUT_000.json
    │   │   │           ├── INPUT_001.json
    │   │   │           └── INPUT_002.json
    │   │   ├── sca/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── include/
    │   │   │   │   ├── sca.h
    │   │   │   │   └── sca.hpp
    │   │   │   ├── sca_impl/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── include/
    │   │   │   │   │   ├── isca_policy.hpp
    │   │   │   │   │   ├── logging_helper.hpp
    │   │   │   │   │   ├── sca_impl.hpp
    │   │   │   │   │   ├── sca_recovery_utils.hpp
    │   │   │   │   │   └── sca_utils.hpp
    │   │   │   │   ├── src/
    │   │   │   │   │   ├── check_condition_evaluator.cpp
    │   │   │   │   │   ├── check_condition_evaluator.hpp
    │   │   │   │   │   ├── sca_checksum.cpp
    │   │   │   │   │   ├── sca_checksum.hpp
    │   │   │   │   │   ├── sca_event_handler.cpp
    │   │   │   │   │   ├── sca_event_handler.hpp
    │   │   │   │   │   ├── sca_impl.cpp
    │   │   │   │   │   ├── sca_policy.cpp
    │   │   │   │   │   ├── sca_policy.hpp
    │   │   │   │   │   ├── sca_policy_check.cpp
    │   │   │   │   │   ├── sca_policy_check.hpp
    │   │   │   │   │   ├── sca_policy_check_win.cpp
    │   │   │   │   │   ├── sca_policy_loader.cpp
    │   │   │   │   │   ├── sca_policy_loader.hpp
    │   │   │   │   │   ├── sca_policy_parser.cpp
    │   │   │   │   │   ├── sca_policy_parser.hpp
    │   │   │   │   │   ├── sca_sync_manager.cpp
    │   │   │   │   │   ├── sca_sync_manager.hpp
    │   │   │   │   │   └── sca_utils.cpp
    │   │   │   │   └── tests/
    │   │   │   │       ├── check_condition_evaluator_test.cpp
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── command_rule_evaluator_test.cpp
    │   │   │   │       ├── directory_rule_evaluator_test.cpp
    │   │   │   │       ├── file_rule_evaluator_test.cpp
    │   │   │   │       ├── process_rule_evaluator_test.cpp
    │   │   │   │       ├── registry_rule_evaluator_test.cpp
    │   │   │   │       ├── rule_creation_test.cpp
    │   │   │   │       ├── sca_checksum_test.cpp
    │   │   │   │       ├── sca_dataclean_test.cpp
    │   │   │   │       ├── sca_event_handler_test.cpp
    │   │   │   │       ├── sca_policy_loader_test.cpp
    │   │   │   │       ├── sca_policy_parser_test.cpp
    │   │   │   │       ├── sca_recovery_test.cpp
    │   │   │   │       ├── sca_recovery_utils_test.cpp
    │   │   │   │       ├── sca_sync_manager_test.cpp
    │   │   │   │       ├── sca_test.cpp
    │   │   │   │       ├── sca_utils_test.cpp
    │   │   │   │       └── mocks/
    │   │   │   │           ├── sca_event_handler_mock.hpp
    │   │   │   │           ├── sca_policy_loader_mock.hpp
    │   │   │   │           └── sca_sca_mock.hpp
    │   │   │   └── src/
    │   │   │       └── sca.cpp
    │   │   ├── src/
    │   │   │   ├── main.c
    │   │   │   ├── module_query_errors.h
    │   │   │   ├── wm_agent_info.c
    │   │   │   ├── wm_agent_info.h
    │   │   │   ├── wm_aws.c
    │   │   │   ├── wm_aws.h
    │   │   │   ├── wm_azure.c
    │   │   │   ├── wm_azure.h
    │   │   │   ├── wm_command.c
    │   │   │   ├── wm_command.h
    │   │   │   ├── wm_content_manager.c
    │   │   │   ├── wm_content_manager.h
    │   │   │   ├── wm_control.c
    │   │   │   ├── wm_control.h
    │   │   │   ├── wm_database.c
    │   │   │   ├── wm_database.h
    │   │   │   ├── wm_docker.c
    │   │   │   ├── wm_docker.h
    │   │   │   ├── wm_download.c
    │   │   │   ├── wm_download.h
    │   │   │   ├── wm_exec.c
    │   │   │   ├── wm_gcp.c
    │   │   │   ├── wm_gcp.h
    │   │   │   ├── wm_github.c
    │   │   │   ├── wm_github.h
    │   │   │   ├── wm_inventory_sync.c
    │   │   │   ├── wm_inventory_sync.h
    │   │   │   ├── wm_ms_graph.c
    │   │   │   ├── wm_ms_graph.h
    │   │   │   ├── wm_office365.c
    │   │   │   ├── wm_office365.h
    │   │   │   ├── wm_router.c
    │   │   │   ├── wm_router.h
    │   │   │   ├── wm_sca.c
    │   │   │   ├── wm_sca.h
    │   │   │   ├── wm_syscollector.c
    │   │   │   ├── wm_syscollector.h
    │   │   │   ├── wm_task_general.c
    │   │   │   ├── wm_task_general.h
    │   │   │   ├── wm_vulnerability_scanner.c
    │   │   │   ├── wm_vulnerability_scanner.h
    │   │   │   ├── wmcom.c
    │   │   │   ├── wmodules.c
    │   │   │   ├── agent_upgrade/
    │   │   │   │   ├── wm_agent_upgrade.c
    │   │   │   │   ├── wm_agent_upgrade.h
    │   │   │   │   ├── agent/
    │   │   │   │   │   ├── wm_agent_upgrade_agent.c
    │   │   │   │   │   ├── wm_agent_upgrade_agent.h
    │   │   │   │   │   └── wm_agent_upgrade_com.c
    │   │   │   │   └── manager/
    │   │   │   │       ├── wm_agent_upgrade_commands.c
    │   │   │   │       ├── wm_agent_upgrade_manager.c
    │   │   │   │       ├── wm_agent_upgrade_manager.h
    │   │   │   │       ├── wm_agent_upgrade_parsing.c
    │   │   │   │       ├── wm_agent_upgrade_parsing.h
    │   │   │   │       ├── wm_agent_upgrade_tasks.c
    │   │   │   │       ├── wm_agent_upgrade_tasks.h
    │   │   │   │       ├── wm_agent_upgrade_tasks_callbacks.c
    │   │   │   │       ├── wm_agent_upgrade_upgrades.c
    │   │   │   │       ├── wm_agent_upgrade_upgrades.h
    │   │   │   │       ├── wm_agent_upgrade_validate.c
    │   │   │   │       └── wm_agent_upgrade_validate.h
    │   │   │   └── task_manager/
    │   │   │       ├── wm_task_manager.c
    │   │   │       ├── wm_task_manager.h
    │   │   │       ├── wm_task_manager_commands.c
    │   │   │       ├── wm_task_manager_parsing.c
    │   │   │       ├── wm_task_manager_parsing.h
    │   │   │       ├── wm_task_manager_tasks.c
    │   │   │       └── wm_task_manager_tasks.h
    │   │   ├── syscollector/
    │   │   │   ├── CMakeLists.txt
    │   │   │   ├── norm_config.json
    │   │   │   ├── include/
    │   │   │   │   ├── syscollector.h
    │   │   │   │   ├── syscollector.hpp
    │   │   │   │   └── syscollectorNormalizer.hpp
    │   │   │   ├── src/
    │   │   │   │   ├── syscollector.cpp
    │   │   │   │   ├── syscollectorImp.cpp
    │   │   │   │   ├── syscollectorNormalizer.cpp
    │   │   │   │   └── syscollectorTablesDef.hpp
    │   │   │   ├── tests/
    │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   ├── sysCollectorImp/
    │   │   │   │   │   ├── CMakeLists.txt
    │   │   │   │   │   ├── main.cpp
    │   │   │   │   │   ├── syscollector_vd_tests.cpp
    │   │   │   │   │   └── syscollectorImp_test.h
    │   │   │   │   └── sysNormalizer/
    │   │   │   │       ├── CMakeLists.txt
    │   │   │   │       ├── main.cpp
    │   │   │   │       ├── sysNormalizer_test.cpp
    │   │   │   │       ├── sysNormalizer_test.h
    │   │   │   │       ├── test_config.h
    │   │   │   │       └── test_input.h
    │   │   │   └── testtool/
    │   │   │       ├── Readme.md
    │   │   │       ├── CMakeLists.txt
    │   │   │       └── main.cpp
    │   │   └── vulnerability_scanner/
    │   │       ├── CMakeLists.txt
    │   │       ├── doc/
    │   │       │   └── rtr.md
    │   │       ├── include/
    │   │       │   ├── vulnerability_scanner.h
    │   │       │   ├── vulnerabilityScanner.hpp
    │   │       │   └── vulnerabilityScannerDefs.hpp
    │   │       ├── qa/
    │   │       │   ├── Readme.md
    │   │       │   ├── requirements.txt
    │   │       │   ├── test_efficacy_log.py
    │   │       │   ├── test_policy_change_log.py
    │   │       │   └── test_data/
    │   │       │       ├── config.json
    │   │       │       ├── 001/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   └── input_001.json
    │   │       │       ├── 002/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   ├── expected_002.json
    │   │       │       │   ├── input_001.json
    │   │       │       │   └── input_002.json
    │   │       │       ├── 003/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   ├── expected_002.json
    │   │       │       │   ├── input_001.json
    │   │       │       │   └── input_002.json
    │   │       │       ├── 004/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   └── input_001.json
    │   │       │       ├── 005/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   └── input_001.json
    │   │       │       ├── 006/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   └── input_001.json
    │   │       │       ├── 007/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   └── input_001.json
    │   │       │       ├── 008/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   ├── expected_002.json
    │   │       │       │   ├── input_001.json
    │   │       │       │   └── input_002.json
    │   │       │       ├── 009/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   ├── expected_002.json
    │   │       │       │   ├── input_001.json
    │   │       │       │   └── input_002.json
    │   │       │       ├── 010/
    │   │       │       │   ├── Readme.md
    │   │       │       │   ├── expected_001.json
    │   │       │       │   └── input_001.json
    │   │       │       └── 011/
    │   │       │           ├── Readme.md
    │   │       │           ├── expected_001.json
    │   │       │           └── input_001.json
    │   │       ├── schemas/
    │   │       │   ├── cve5.fbs
    │   │       │   ├── packageTranslation.fbs
    │   │       │   ├── vulnerabilityCandidate.fbs
    │   │       │   ├── vulnerabilityDescription.fbs
    │   │       │   └── vulnerabilityRemediations.fbs
    │   │       ├── src/
    │   │       │   ├── vulnerabilityScanner.cpp
    │   │       │   ├── vulnerabilityScannerFacade.cpp
    │   │       │   ├── vulnerabilityScannerFacade.hpp
    │   │       │   ├── databaseFeedManager/
    │   │       │   │   ├── CMakeLists.txt
    │   │       │   │   ├── databaseFeedManager.cpp
    │   │       │   │   ├── databaseFeedManager.hpp
    │   │       │   │   ├── databaseFeedManagerException.hpp
    │   │       │   │   ├── eventContext.hpp
    │   │       │   │   ├── eventDecoder.hpp
    │   │       │   │   ├── feedIndexer.hpp
    │   │       │   │   ├── globalData.hpp
    │   │       │   │   ├── storeModel.hpp
    │   │       │   │   ├── updateCVECandidates.hpp
    │   │       │   │   ├── updateCVEDescription.hpp
    │   │       │   │   ├── updateCVERemediations.hpp
    │   │       │   │   └── updateHotfixes.hpp
    │   │       │   └── scanOrchestrator/
    │   │       │       ├── agentReScanListException.hpp
    │   │       │       ├── buildAllAgentListContext.hpp
    │   │       │       ├── CMakeLists.txt
    │   │       │       ├── descriptionsHelper.hpp
    │   │       │       ├── factoryOrchestrator.hpp
    │   │       │       ├── fieldAlertHelper.hpp
    │   │       │       ├── scanAgentList.hpp
    │   │       │       ├── scanContext.hpp
    │   │       │       ├── scannerHelper.hpp
    │   │       │       ├── scanOrchestrator.hpp
    │   │       │       ├── scanOrchestrator_defs.hpp
    │   │       │       ├── factory/
    │   │       │       │   ├── eventDetailsBuilder.hpp
    │   │       │       │   ├── eventGetContext.hpp
    │   │       │       │   ├── eventGetCve.hpp
    │   │       │       │   ├── eventSendReport.hpp
    │   │       │       │   ├── osScanner.hpp
    │   │       │       │   ├── packageScanner.hpp
    │   │       │       │   └── resultIndexer.hpp
    │   │       │       └── versionMatcher/
    │   │       │           ├── iVersionObjectInterface.hpp
    │   │       │           ├── versionMatcher.hpp
    │   │       │           ├── versionObjectCalVer.cpp
    │   │       │           ├── versionObjectCalVer.hpp
    │   │       │           ├── versionObjectDpkg.hpp
    │   │       │           ├── versionObjectMajorMinor.cpp
    │   │       │           ├── versionObjectMajorMinor.hpp
    │   │       │           ├── versionObjectPEP440.cpp
    │   │       │           ├── versionObjectPEP440.hpp
    │   │       │           ├── versionObjectRpm.hpp
    │   │       │           ├── versionObjectSemVer.cpp
    │   │       │           └── versionObjectSemVer.hpp
    │   │       ├── tests/
    │   │       │   ├── CMakeLists.txt
    │   │       │   ├── benchmark/
    │   │       │   │   ├── CMakeLists.txt
    │   │       │   │   └── versionMatcherBenchmark.cpp
    │   │       │   ├── component/
    │   │       │   │   ├── CMakeLists.txt
    │   │       │   │   ├── databaseFeedManager_test.cpp
    │   │       │   │   ├── databaseFeedManager_test.hpp
    │   │       │   │   ├── main.cpp
    │   │       │   │   ├── vulnerabilityScannerFacade_test.cpp
    │   │       │   │   └── vulnerabilityScannerFacade_test.hpp
    │   │       │   ├── mocks/
    │   │       │   │   ├── globalMocks.hpp
    │   │       │   │   ├── MockContentRegister.hpp
    │   │       │   │   ├── MockDatabaseFeedManager.hpp
    │   │       │   │   ├── MockFactoryOrchestrator.hpp
    │   │       │   │   ├── MockGlobalData.hpp
    │   │       │   │   ├── MockIndexerConnector.hpp
    │   │       │   │   ├── MockOsDataCache.hpp
    │   │       │   │   ├── MockPolicyManager.hpp
    │   │       │   │   ├── MockReportDispatcher.hpp
    │   │       │   │   ├── MockRouterSubscriber.hpp
    │   │       │   │   ├── MockScanContext.hpp
    │   │       │   │   ├── MockSocketDBWrapper.hpp
    │   │       │   │   ├── MockUnixSocketRequest.hpp
    │   │       │   │   ├── TrampolineContentRegister.hpp
    │   │       │   │   ├── TrampolineFactoryOrchestrator.hpp
    │   │       │   │   ├── TrampolineGlobalData.hpp
    │   │       │   │   ├── TrampolineIndexerConnector.hpp
    │   │       │   │   ├── TrampolineOsDataCache.hpp
    │   │       │   │   ├── TrampolineRouterSuscribe.hpp
    │   │       │   │   ├── TrampolineScanContext.hpp
    │   │       │   │   └── TrampolineSocketDBWrapper.hpp
    │   │       │   └── unit/
    │   │       │       ├── buildAllAgentListContext_test.cpp
    │   │       │       ├── buildAllAgentListContext_test.hpp
    │   │       │       ├── CMakeLists.txt
    │   │       │       ├── databaseFeedManager_test.cpp
    │   │       │       ├── databaseFeedManager_test.h
    │   │       │       ├── eventDecoder_test.cpp
    │   │       │       ├── eventDecoder_test.hpp
    │   │       │       ├── eventDetailsBuilder_test.cpp
    │   │       │       ├── eventDetailsBuilder_test.hpp
    │   │       │       ├── eventGetContext_test.cpp
    │   │       │       ├── eventGetContext_test.hpp
    │   │       │       ├── eventGetCve_test.cpp
    │   │       │       ├── eventGetCve_test.hpp
    │   │       │       ├── eventSendReport_test.cpp
    │   │       │       ├── eventSendReport_test.hpp
    │   │       │       ├── factoryOrchestrator_test.cpp
    │   │       │       ├── factoryOrchestrator_test.hpp
    │   │       │       ├── feedIndexer_test.cpp
    │   │       │       ├── feedIndexer_test.hpp
    │   │       │       ├── globalData_test.cpp
    │   │       │       ├── globalData_test.hpp
    │   │       │       ├── main.cpp
    │   │       │       ├── osScanner_test.cpp
    │   │       │       ├── osScanner_test.hpp
    │   │       │       ├── packageScanner_test.cpp
    │   │       │       ├── packageScanner_test.hpp
    │   │       │       ├── resultIndexer_test.cpp
    │   │       │       ├── resultIndexer_test.hpp
    │   │       │       ├── scanAgentList_test.cpp
    │   │       │       ├── scanAgentList_test.hpp
    │   │       │       ├── scanContext_test.cpp
    │   │       │       ├── scanContext_test.hpp
    │   │       │       ├── scanDispatcher_test.hpp
    │   │       │       ├── scannerHelper_test.cpp
    │   │       │       ├── scannerHelper_test.hpp
    │   │       │       ├── scanOrchestrator_test.cpp
    │   │       │       ├── scanOrchestrator_test.hpp
    │   │       │       ├── storeModel_test.cpp
    │   │       │       ├── storeModel_test.hpp
    │   │       │       ├── updateCVECandidates_test.cpp
    │   │       │       ├── updateCVECandidates_test.hpp
    │   │       │       ├── updateCVEDescription_test.cpp
    │   │       │       ├── updateCVEDescription_test.hpp
    │   │       │       ├── updateCVERemediations_test.cpp
    │   │       │       ├── updateCVERemediations_test.hpp
    │   │       │       ├── updateHotfixes_test.cpp
    │   │       │       ├── updateHotfixes_test.hpp
    │   │       │       ├── versionMatcher_test.cpp
    │   │       │       ├── versionMatcher_test.hpp
    │   │       │       ├── vulnerabilityScannerFacade_test.cpp
    │   │       │       └── vulnerabilityScannerFacade_test.hpp
    │   │       └── testtool/
    │   │           ├── CMakeLists.txt
    │   │           ├── databaseFeedManager/
    │   │           │   ├── argsParser.hpp
    │   │           │   ├── CMakeLists.txt
    │   │           │   ├── config.json
    │   │           │   ├── file2.json
    │   │           │   ├── file_offset1.json
    │   │           │   ├── file_offset2.json
    │   │           │   ├── file_oscpe_rules.json
    │   │           │   ├── file_raw1.json
    │   │           │   ├── main.cpp
    │   │           │   └── message.json
    │   │           ├── rocksDBQuery/
    │   │           │   ├── argsParser.hpp
    │   │           │   ├── CMakeLists.txt
    │   │           │   └── main.cpp
    │   │           ├── scanner/
    │   │           │   ├── argsParser.hpp
    │   │           │   ├── CMakeLists.txt
    │   │           │   ├── config.content_generation.json
    │   │           │   ├── config.json
    │   │           │   ├── config.offline_content_generation.json
    │   │           │   ├── file1.json
    │   │           │   ├── file2.json
    │   │           │   ├── file3.json
    │   │           │   ├── file4.json
    │   │           │   ├── main.cpp
    │   │           │   ├── fakeAgentData/
    │   │           │   │   ├── agentHotfixesData.json
    │   │           │   │   ├── agentOsData.json
    │   │           │   │   └── agentPkgsData.json
    │   │           │   ├── fakeGlobalData/
    │   │           │   │   └── globalData.json
    │   │           │   ├── TC-001/
    │   │           │   │   ├── README.md
    │   │           │   │   ├── step_0.json
    │   │           │   │   ├── step_1.json
    │   │           │   │   ├── step_2.json
    │   │           │   │   └── step_3.json
    │   │           │   ├── TC-002/
    │   │           │   │   ├── README.md
    │   │           │   │   ├── step_0.json
    │   │           │   │   └── step_1.json
    │   │           │   ├── TC-003/
    │   │           │   │   ├── README.md
    │   │           │   │   ├── step_0.json
    │   │           │   │   └── step_1.json
    │   │           │   ├── TC-004/
    │   │           │   │   ├── README.md
    │   │           │   │   └── step_0.json
    │   │           │   ├── TC-005/
    │   │           │   │   ├── README.md
    │   │           │   │   ├── step_0.json
    │   │           │   │   └── step_1.json
    │   │           │   ├── TC-006/
    │   │           │   │   ├── README.md
    │   │           │   │   ├── step_0.json
    │   │           │   │   ├── step_1.json
    │   │           │   │   ├── step_2.json
    │   │           │   │   ├── step_3.json
    │   │           │   │   ├── step_4.json
    │   │           │   │   └── step_5.json
    │   │           │   ├── TC-007/
    │   │           │   │   ├── README.md
    │   │           │   │   ├── config.json
    │   │           │   │   ├── step_0.json
    │   │           │   │   ├── step_1.json
    │   │           │   │   ├── step_2.json
    │   │           │   │   ├── step_3.json
    │   │           │   │   ├── step_4.json
    │   │           │   │   └── step_5.json
    │   │           │   └── TC-008/
    │   │           │       ├── README.md
    │   │           │       ├── config.json
    │   │           │       ├── step_0.json
    │   │           │       ├── step_1.json
    │   │           │       └── step_2.json
    │   │           ├── versionMatcher/
    │   │           │   ├── README.md
    │   │           │   ├── DPKG.Dockerfile
    │   │           │   ├── RPM.Dockerfile
    │   │           │   └── version_verifier.sh
    │   │           └── wazuhDBQuery/
    │   │               ├── argsParser.hpp
    │   │               ├── CMakeLists.txt
    │   │               ├── config.json
    │   │               └── main.cpp
    │   └── win32/
    │       ├── CMakeLists.txt
    │       ├── do_upgrade.ps1
    │       ├── doc.html
    │       ├── help.txt
    │       ├── icofile.rc
    │       ├── InstallerScripts.vbs
    │       ├── license.rtf
    │       ├── manage_agents.exe.manifest
    │       ├── manage_agents.rc
    │       ├── netsh.exe.manifest
    │       ├── netsh.rc
    │       ├── os_win.h
    │       ├── ossec.conf
    │       ├── RemoveAllScript.vbs
    │       ├── restart-wazuh.exe.manifest
    │       ├── restart-wazuh.rc
    │       ├── route-null.exe.manifest
    │       ├── route-null.rc
    │       ├── setup-iis.c
    │       ├── setup-shared.c
    │       ├── setup-shared.h
    │       ├── setup-syscheck.c
    │       ├── setup-win.c
    │       ├── unix2dos.pl
    │       ├── upgrade.bat
    │       ├── version.rc
    │       ├── vista_sec.txt
    │       ├── wazuh-agent-eventchannel.exe.manifest
    │       ├── wazuh-agent-eventchannel.rc
    │       ├── wazuh-agent.exe.manifest
    │       ├── wazuh-agent.rc
    │       ├── wazuh-installer-build-msi.bat
    │       ├── wazuh-installer-sign-exes.bat
    │       ├── wazuh-installer.wxs
    │       ├── win32ui.exe.manifest
    │       ├── win_agent.c
    │       ├── win_service.c
    │       ├── win_stubs.c
    │       ├── win_utils.c
    │       ├── qa/
    │       │   ├── ProcmonDLLNotFoundConfiguration.pmc
    │       │   ├── requirements.txt
    │       │   ├── test_bin_details.py
    │       │   ├── test_dll_hijack.py
    │       │   └── test_win_upgrade.py
    │       └── ui/
    │           ├── common.c
    │           ├── os_win32ui.c
    │           ├── os_win32ui.exe.manifest
    │           ├── os_win32ui.h
    │           └── win32ui.rc
    ├── tests/
    │   └── integration/
    │       ├── conftest.py
    │       ├── pytest.ini
    │       ├── test_agentd/
    │       │   ├── conftest.py
    │       │   ├── utils.py
    │       │   ├── test_multi_server/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_agentd_multi_server.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── wazuh_conf.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_reconnection_protocol.yaml
    │       │   ├── test_parametrized_reconnections/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_agentd_parametrized_reconnections.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── wazuh_conf.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_reconnection_protocol.yaml
    │       │   ├── test_reconnection/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_agentd_connection_retries_pre_enrollment.py
    │       │   │   ├── test_agentd_initial_enrollment_retries.py
    │       │   │   ├── test_agentd_reconection_enrollment_no_keys.py
    │       │   │   ├── test_agentd_reconection_enrollment_no_keys_file.py
    │       │   │   ├── test_agentd_reconection_enrollment_with_keys.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── wazuh_conf.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_reconnection_protocol.yaml
    │       │   ├── test_startup_hash_validation/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_startup_hash_gate.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── handshake_json.yaml
    │       │   │       │   ├── merged_mg.yaml
    │       │   │       │   └── wazuh_conf.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_startup_hash_gate.yaml
    │       │   ├── test_state/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_agentd_state.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── wazuh_conf.yaml
    │       │   │       └── test_cases/
    │       │   │           └── wazuh_state_config_tests.yaml
    │       │   └── test_state_config/
    │       │       ├── __init__.py
    │       │       ├── test_agentd_state_config.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── wazuh_conf.yaml
    │       │           └── test_cases/
    │       │               └── wazuh_state_config_tests.yaml
    │       ├── test_analysisd/
    │       │   ├── conftest.py
    │       │   ├── test_all_syscheckd_configurations/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_check_rare_socket_responses.py
    │       │   │   ├── test_check_socket_responses.py
    │       │   │   ├── test_validate_linux_analysisd_alerts.py
    │       │   │   ├── test_validate_rare_analysisd_alerts.py
    │       │   │   ├── test_validate_win32_analysisd_alerts.py
    │       │   │   ├── test_validate_win32_analysisd_registry_alerts.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_syscheck_rare_events.yaml
    │       │   ├── test_error_messages/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_error_messages.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_error_messages.yaml
    │       │   ├── test_event_messages/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_event_messages.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_event_messages.yaml
    │       │   ├── test_integrity_messages/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_integrity_messages.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_integrity_messages.yaml
    │       │   ├── test_limit_eps/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_basic.py
    │       │   │   ├── test_configuration.py
    │       │   │   ├── test_event_processing.py
    │       │   │   ├── test_logging.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── basic_test_module/
    │       │   │       │   │   ├── configuration_disabled.yaml
    │       │   │       │   │   └── configuration_enabled.yaml
    │       │   │       │   ├── configuration_test_module/
    │       │   │       │   │   ├── configuration_accepted_values.yaml
    │       │   │       │   │   ├── configuration_invalid_values.yaml
    │       │   │       │   │   └── configuration_missing_configuration.yaml
    │       │   │       │   ├── event_processing_test_module/
    │       │   │       │   │   ├── configuration_drop_events_queue_full.yaml
    │       │   │       │   │   ├── configuration_limitation.yaml
    │       │   │       │   │   ├── configuration_process_events_multi.yaml
    │       │   │       │   │   ├── configuration_process_events_single.yaml
    │       │   │       │   │   └── configuration_queue_events_after_limit.yaml
    │       │   │       │   └── logging_test_module/
    │       │   │       │       └── configuration_dropping_events.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── basic_test_module/
    │       │   │           │   ├── cases_disabled.yaml
    │       │   │           │   └── cases_enabled.yaml
    │       │   │           ├── configuration_test_module/
    │       │   │           │   ├── cases_accepted_values.yaml
    │       │   │           │   ├── cases_invalid_values.yaml
    │       │   │           │   └── cases_missing_configuration.yaml
    │       │   │           ├── event_processing_test_module/
    │       │   │           │   ├── cases_drop_events_queue_full.yaml
    │       │   │           │   ├── cases_limitation.yaml
    │       │   │           │   ├── cases_process_events_multi.yaml
    │       │   │           │   ├── cases_process_events_single.yaml
    │       │   │           │   └── cases_queue_events_after_limit.yaml
    │       │   │           └── logging_test_module/
    │       │   │               └── cases_dropping_events.yaml
    │       │   ├── test_mitre/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_mitre_check_alert.py
    │       │   │   └── data/
    │       │   │       └── rules_samples/
    │       │   │           ├── test1.xml
    │       │   │           ├── test10.xml
    │       │   │           ├── test11.xml
    │       │   │           ├── test12.xml
    │       │   │           ├── test13.xml
    │       │   │           ├── test14.xml
    │       │   │           ├── test2.xml
    │       │   │           ├── test3.xml
    │       │   │           ├── test4.xml
    │       │   │           ├── test5.xml
    │       │   │           ├── test6.xml
    │       │   │           ├── test7.xml
    │       │   │           ├── test8.xml
    │       │   │           └── test9.xml
    │       │   ├── test_predecoder_stage/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_predecoder_stage.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_syslog_socket_input.yaml
    │       │   ├── test_scan_messages/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_scan_messages.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_scan_messages.yaml
    │       │   ├── test_signature_id/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_invalid_signature_id.py
    │       │   │   ├── test_null_signature_id.py
    │       │   │   ├── test_valid_signature_id.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── configuration_signature_id_values.yaml
    │       │   │       ├── rules_samples/
    │       │   │       │   ├── empty_signature_id_rules.xml
    │       │   │       │   ├── invalid_signature_id_rules.xml
    │       │   │       │   ├── null_signature_id_rules.xml
    │       │   │       │   └── valid_signature_id_rules.xml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_invalid_signature_id.yaml
    │       │   │           ├── cases_null_signature_id.yaml
    │       │   │           └── cases_valid_signature_id.yaml
    │       │   ├── test_syscollector/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_syscollector_events.py
    │       │   │   └── data/
    │       │   │       ├── rules_samples/
    │       │   │       │   └── syscollector_rules.xml
    │       │   │       └── test_cases/
    │       │   │           └── cases_syscollector.yaml
    │       │   └── test_trigger_active_response/
    │       │       ├── __init__.py
    │       │       ├── conftest.py
    │       │       ├── test_trigger_active_response.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── configuration_trigger_active_response.yaml
    │       │           ├── custom_scripts/
    │       │           │   └── custom-ar.sh
    │       │           ├── rules_samples/
    │       │           │   └── local_rules.xml
    │       │           └── test_cases/
    │       │               └── cases_trigger_active_response.yaml
    │       ├── test_api/
    │       │   ├── conftest.py
    │       │   ├── test_config/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_bruteforce_blocking_system/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_bruteforce_blocking_system.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_bruteforce_blocking_system.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_bruteforce_blocking_system.yaml
    │       │   │   ├── test_cors/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_cors.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_cors.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_cors.yaml
    │       │   │   ├── test_DOS_blocking_system/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_DOS_blocking_system.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_DOS_blocking_system.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_DOS_blocking_system.yaml
    │       │   │   ├── test_drop_privileges/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_drop_privileges.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_drop_privileges.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_drop_privileges.yaml
    │       │   │   ├── test_host_port/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_host_port.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_host_port.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_host_port.yaml
    │       │   │   ├── test_https/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_https.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_https.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_https.yaml
    │       │   │   ├── test_indexer/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_indexer.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_indexer.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_indexer.yaml
    │       │   │   ├── test_jwt_token_exp_timeout/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_jwt_token_exp_timeout.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_jwt_token_exp_timeout.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_jwt_token_exp_timeout.yaml
    │       │   │   ├── test_limit_eps/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_limit_eps.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_limit_eps_api_config.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_limit_eps_config.yaml
    │       │   │   ├── test_logs/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_logs_format.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_logs_format.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_logs_format.yaml
    │       │   │   ├── test_max_upload_size/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_max_upload_size.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_max_upload_size.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_max_upload_size.yaml
    │       │   │   ├── test_rbac/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_rbac_mode.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_rbac_mode.yaml
    │       │   │   │       ├── db_schemas/
    │       │   │   │       │   ├── schema_add_user.sql
    │       │   │   │       │   └── schema_delete_user.sql
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_rbac_mode.yaml
    │       │   │   ├── test_request_timeout/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_request_timeout.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_request_timeout.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_request_timeout.yaml
    │       │   │   └── test_upload_configuration/
    │       │   │       ├── __init__.py
    │       │   │       ├── test_upload_configuration.py
    │       │   │       └── data/
    │       │   │           ├── configuration_templates/
    │       │   │           │   └── configuration_upload_configuration.yaml
    │       │   │           └── test_cases/
    │       │   │               └── cases_upload_configuration.yaml
    │       │   ├── test_middlewares/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_response_postprocessing.py
    │       │   │   ├── test_set_secure_headers.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── configuration_set_secure_headers.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_response_postprocessing.yaml
    │       │   │           └── cases_set_secure_headers.yaml
    │       │   ├── test_rbac/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_add_old_resource.py
    │       │   │   ├── test_manage_admin_resource.py
    │       │   │   ├── test_policy_position.py
    │       │   │   ├── test_remove_resource.py
    │       │   │   ├── test_remove_resources_relation.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           ├── cases_add_old_resource.yaml
    │       │   │           ├── cases_manage_admin_resource.yaml
    │       │   │           ├── cases_policy_position.yaml
    │       │   │           ├── cases_remove_resource.yaml
    │       │   │           └── cases_remove_resources_relation.yaml
    │       │   └── test_statistics/
    │       │       ├── __init__.py
    │       │       ├── test_statistics_format.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── configuration_cluster_statistics_format.yaml
    │       │           └── test_cases/
    │       │               ├── agent_statistics_format_test_module/
    │       │               │   └── cases_agent_statistics_format.yaml
    │       │               └── cluster_statistics_format_test_module/
    │       │                   └── cases_cluster_statistics_format.yaml
    │       ├── test_authd/
    │       │   ├── conftest.py
    │       │   ├── test_api_registration/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_api_agent_registration.py
    │       │   │   └── data/
    │       │   │       └── test_cases/
    │       │   │           └── cases_api_agent_registration.yaml
    │       │   ├── test_cluster/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_authd_local.py
    │       │   │   ├── test_authd_worker.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_authd_local.yaml
    │       │   │       │   └── config_authd_worker.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_authd_local.yaml
    │       │   │           └── cases_authd_worker.yaml
    │       │   ├── test_common/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_authd.py
    │       │   │   ├── test_authd_agents_ctx.py
    │       │   │   ├── test_authd_key_hash.py
    │       │   │   ├── test_authd_max_agents.py
    │       │   │   ├── test_authd_valid_name_ip.py
    │       │   │   ├── utils.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_authd_common.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_authd.yaml
    │       │   │           ├── cases_authd_agents_ctx.yaml
    │       │   │           ├── cases_authd_key_hash.yaml
    │       │   │           ├── cases_authd_max_agents.yaml
    │       │   │           └── cases_authd_valid_name_ip.yaml
    │       │   ├── test_force_options/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_authd_force_options.py
    │       │   │   ├── test_authd_force_options_invalid_config.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_authd_force_options.yaml
    │       │   │       │   ├── config_force_insert.yaml
    │       │   │       │   └── config_force_insert_only.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_after_registration_time.yaml
    │       │   │           ├── cases_authd_force_options_invalid_config.yaml
    │       │   │           ├── cases_disconnected_time.yaml
    │       │   │           ├── cases_force_insert.yaml
    │       │   │           ├── cases_force_insert_only.yaml
    │       │   │           ├── cases_force_options.yaml
    │       │   │           └── cases_key_mismatch.yaml
    │       │   ├── test_key_request/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_authd_key_request_exec_path.py
    │       │   │   ├── test_authd_key_request_func.py
    │       │   │   ├── test_authd_key_request_limits.py
    │       │   │   ├── test_authd_key_request_worker.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_authd_key_request_exec_path.yaml
    │       │   │       │   ├── config_authd_key_request_func.yaml
    │       │   │       │   ├── config_authd_key_request_limits.yaml
    │       │   │       │   └── config_authd_key_request_worker.yaml
    │       │   │       ├── scripts/
    │       │   │       │   └── fetch_keys.py
    │       │   │       └── test_cases/
    │       │   │           ├── cases_authd_key_request_exec_path.yaml
    │       │   │           ├── cases_authd_key_request_func.yaml
    │       │   │           ├── cases_authd_key_request_limits.yaml
    │       │   │           └── cases_authd_key_request_worker.yaml
    │       │   ├── test_remote_enrollment/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_remote_enrollment.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_remote_enrollment.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_remote_enrollment.yaml
    │       │   ├── test_ssl/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_authd_ssl_certs.py
    │       │   │   ├── test_authd_ssl_options.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_authd_ssl_certs.yaml
    │       │   │       │   └── config_authd_ssl_options.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_authd_ssl_certs.yaml
    │       │   │           └── cases_authd_ssl_options.yaml
    │       │   ├── test_use_password/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_authd_use_password.py
    │       │   │   ├── test_authd_use_password_invalid.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_authd_use_password.yaml
    │       │   │       │   └── config_authd_use_password_invalid.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_authd_use_password.yaml
    │       │   │           └── cases_authd_use_password_invalid.yaml
    │       │   └── test_use_source_ip/
    │       │       ├── __init__.py
    │       │       ├── conftest.py
    │       │       ├── test_authd_use_source_ip.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── config_authd_use_source_ip.yaml
    │       │           └── test_cases/
    │       │               └── cases_authd_use_source_ip.yaml
    │       ├── test_aws/
    │       │   ├── README.md
    │       │   ├── __init__.py
    │       │   ├── configurator.py
    │       │   ├── conftest.py
    │       │   ├── event_monitor.py
    │       │   ├── test_basic.py
    │       │   ├── test_custom_bucket.py
    │       │   ├── test_discard_regex.py
    │       │   ├── test_log_groups.py
    │       │   ├── test_only_logs_after.py
    │       │   ├── test_parser.py
    │       │   ├── test_path.py
    │       │   ├── test_path_suffix.py
    │       │   ├── test_regions.py
    │       │   ├── test_remove_from_bucket.py
    │       │   ├── utils.py
    │       │   └── data/
    │       │       ├── configuration_template/
    │       │       │   ├── basic_test_module/
    │       │       │   │   ├── bucket_configuration_defaults.yaml
    │       │       │   │   ├── cloudwatch_configuration_defaults.yaml
    │       │       │   │   └── inspector_configuration_defaults.yaml
    │       │       │   ├── custom_bucket_test_module/
    │       │       │   │   └── custom_bucket_configuration.yaml
    │       │       │   ├── discard_regex_test_module/
    │       │       │   │   ├── configuration_bucket_discard_regex.yaml
    │       │       │   │   ├── configuration_cloudwatch_discard_regex_json.yaml
    │       │       │   │   ├── configuration_cloudwatch_discard_regex_simple_text.yaml
    │       │       │   │   └── configuration_inspector_discard_regex.yaml
    │       │       │   ├── log_groups_test_module/
    │       │       │   │   └── configuration_log_groups.yaml
    │       │       │   ├── only_logs_after_test_module/
    │       │       │   │   ├── bucket_configuration_with_only_logs_after.yaml
    │       │       │   │   ├── bucket_configuration_without_only_logs_after.yaml
    │       │       │   │   ├── cloudwatch_configuration_with_only_logs_after.yaml
    │       │       │   │   ├── inspector_configuration_with_only_logs_after.yaml
    │       │       │   │   └── service_configuration_without_only_logs_after.yaml
    │       │       │   ├── parser_test_module/
    │       │       │   │   ├── configuration_bucket_and_service_missing.yaml
    │       │       │   │   ├── configuration_multiple_bucket_and_service_tags.yaml
    │       │       │   │   ├── configuration_type_missing_in_bucket.yaml
    │       │       │   │   ├── configuration_type_missing_in_service.yaml
    │       │       │   │   ├── configuration_values_in_bucket.yaml
    │       │       │   │   └── configuration_values_in_service.yaml
    │       │       │   ├── path_suffix_test_module/
    │       │       │   │   └── configuration_path_suffix.yaml
    │       │       │   ├── path_test_module/
    │       │       │   │   └── configuration_path.yaml
    │       │       │   ├── regions_test_module/
    │       │       │   │   ├── bucket_configuration_regions.yaml
    │       │       │   │   ├── cloudwatch_configuration_regions.yaml
    │       │       │   │   └── inspector_configuration_regions.yaml
    │       │       │   └── remove_from_bucket_test_module/
    │       │       │       ├── configuration_remove_from_bucket.yaml
    │       │       │       └── configuration_remove_log_stream.yaml
    │       │       └── test_cases/
    │       │           ├── basic_test_module/
    │       │           │   ├── cases_bucket_defaults.yaml
    │       │           │   ├── cases_cloudwatch_defaults.yaml
    │       │           │   └── cases_inspector_defaults.yaml
    │       │           ├── custom_bucket_test_module/
    │       │           │   ├── cases_bucket_custom.yaml
    │       │           │   └── cases_bucket_custom_logs.yaml
    │       │           ├── discard_regex_test_module/
    │       │           │   ├── cases_bucket_discard_regex.yaml
    │       │           │   ├── cases_cloudwatch_discard_regex_json.yaml
    │       │           │   ├── cases_cloudwatch_discard_regex_simple_text.yaml
    │       │           │   └── cases_inspector_discard_regex.yaml
    │       │           ├── log_groups_test_module/
    │       │           │   └── cases_log_groups.yaml
    │       │           ├── only_logs_after_test_module/
    │       │           │   ├── cases_bucket_multiple_calls.yaml
    │       │           │   ├── cases_bucket_with_only_logs_after.yaml
    │       │           │   ├── cases_bucket_without_only_logs_after.yaml
    │       │           │   ├── cases_cloudwatch_multiple_calls.yaml
    │       │           │   ├── cases_cloudwatch_with_only_logs_after.yaml
    │       │           │   ├── cases_inspector_multiple_calls.yaml
    │       │           │   ├── cases_inspector_with_only_logs_after.yaml
    │       │           │   └── cases_service_without_only_logs_after.yaml
    │       │           ├── parser_test_module/
    │       │           │   ├── cases_bucket_and_service_missing.yaml
    │       │           │   ├── cases_empty_values_in_bucket.yaml
    │       │           │   ├── cases_empty_values_in_service.yaml
    │       │           │   ├── cases_invalid_values_in_bucket.yaml
    │       │           │   ├── cases_invalid_values_in_service.yaml
    │       │           │   ├── cases_multiple_bucket_and_service_tags.yaml
    │       │           │   ├── cases_type_missing_in_bucket.yaml
    │       │           │   └── cases_type_missing_in_service.yaml
    │       │           ├── path_suffix_test_module/
    │       │           │   └── cases_path_suffix.yaml
    │       │           ├── path_test_module/
    │       │           │   └── cases_path.yaml
    │       │           ├── regions_test_module/
    │       │           │   ├── cases_bucket_regions.yaml
    │       │           │   ├── cases_cloudwatch_regions.yaml
    │       │           │   └── cases_inspector_regions.yaml
    │       │           └── remove_from_bucket_test_module/
    │       │               ├── cases_remove_from_bucket.yaml
    │       │               └── cases_remove_log_streams.yaml
    │       ├── test_enrollment/
    │       │   ├── conftest.py
    │       │   ├── test_agent/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_agentd_enrollment.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_wazuh_enrollment.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_wazuh_enrollment.yaml
    │       │   └── test_options/
    │       │       ├── __init__.py
    │       │       ├── test_agentd_server_address_configuration.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── config_server_address.yaml
    │       │           └── test_cases/
    │       │               └── cases_server_address.yaml
    │       ├── test_execd/
    │       │   ├── conftest.py
    │       │   └── test_run_active_response/
    │       │       ├── __init__.py
    │       │       ├── test_firewall_drop.py
    │       │       ├── test_restart_wazuh.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── config_run_active_response.yaml
    │       │           └── test_cases/
    │       │               ├── cases_execd_firewall_drop.yaml
    │       │               └── cases_execd_restart.yaml
    │       ├── test_fim/
    │       │   ├── conftest.py
    │       │   ├── test_files/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_ambiguous_confs/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_ignore_works_over_restrict.py
    │       │   │   │   ├── test_whodata_ambiguous_thread.py
    │       │   │   │   ├── test_whodata_works_over_realtime.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   ├── configuration_ignore_works_over_restrict.yaml
    │       │   │   │       │   ├── configuration_whodata_ambiguous_thread.yaml
    │       │   │   │       │   └── configuration_whodata_works_over_realtime.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           ├── cases_ignore_works_over_restrict.yaml
    │       │   │   │           ├── cases_whodata_ambiguous_thread.yaml
    │       │   │   │           └── cases_whodata_works_over_realtime.yaml
    │       │   │   ├── test_audit/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── conftest.py
    │       │   │   │   ├── test_remove_audit.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_remove_audit.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_remove_audit.yaml
    │       │   │   ├── test_basic_usage/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── conftest.py
    │       │   │   │   ├── test_create_after_delete_dir.py
    │       │   │   │   ├── test_delete_directory.py
    │       │   │   │   ├── test_delete_hardlink_symlink.py
    │       │   │   │   ├── test_delete_multiple_files.py
    │       │   │   │   ├── test_empty_directories_tag.py
    │       │   │   │   ├── test_fim_disabled.py
    │       │   │   │   ├── test_move.py
    │       │   │   │   ├── test_rename.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   ├── configuration_basic.yaml
    │       │   │   │       │   ├── configuration_empty_directories_tag.yaml
    │       │   │   │       │   └── configuration_fim_disabled.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           ├── cases_create_after_delete.yaml
    │       │   │   │           ├── cases_delete_directory.yaml
    │       │   │   │           ├── cases_delete_hardlink_symlink.yaml
    │       │   │   │           ├── cases_delete_multiple_files.yaml
    │       │   │   │           ├── cases_empty_directories_tag.yaml
    │       │   │   │           ├── cases_fim_disabled.yaml
    │       │   │   │           ├── cases_move.yaml
    │       │   │   │           └── cases_rename.yaml
    │       │   │   ├── test_checkers/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_checkers.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_basic.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_checkers.yaml
    │       │   │   ├── test_file_limit/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_fill_capacity.py
    │       │   │   │   ├── test_full_capacity_create_delete.py
    │       │   │   │   ├── test_limit_disabled.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_basic.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           ├── cases_fill_capacity.yaml
    │       │   │   │           ├── cases_full_capacity_create_delete.yaml
    │       │   │   │           └── cases_limit_disabled.yaml
    │       │   │   ├── test_follow_symbolic_link/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── conftest.py
    │       │   │   │   ├── test_audit_rules_with_symlink.py
    │       │   │   │   ├── test_change_target.py
    │       │   │   │   ├── test_cud.py
    │       │   │   │   ├── test_disabled.py
    │       │   │   │   ├── test_new_target_populated.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   ├── configuration_basic.yaml
    │       │   │   │       │   └── configuration_disabled.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           ├── cases_audit_rules_with_symlink.yaml
    │       │   │   │           ├── cases_change_target.yaml
    │       │   │   │           ├── cases_cud.yaml
    │       │   │   │           ├── cases_disabled.yaml
    │       │   │   │           └── cases_new_target_populated.yaml
    │       │   │   ├── test_ignore/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_ignore_valid.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_ignore_linux.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_ignore_linux.yaml
    │       │   │   ├── test_inotify/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_num_watches.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_num_watches.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_num_watches.yaml
    │       │   │   ├── test_invalid_characters/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_non_utf8_characters.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   ├── configuration_basic.yaml
    │       │   │   │       │   └── configuration_registries.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           ├── cases_nonUTF8.yaml
    │       │   │   │           └── cases_registries.yaml
    │       │   │   ├── test_max_eps/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_max_eps.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_max_eps.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_max_eps.yaml
    │       │   │   ├── test_moving_files/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_moving_files.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_moving_files.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_moving_files.yaml
    │       │   │   ├── test_process_priority/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_process_priority.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── configuration_process_priority.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_process_priority.yaml
    │       │   │   ├── test_report_changes/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_disk_quota_configured.py
    │       │   │   │   ├── test_disk_quota_disabled.py
    │       │   │   │   ├── test_disk_quota_values.py
    │       │   │   │   ├── test_file_size_configured.py
    │       │   │   │   ├── test_file_size_default.py
    │       │   │   │   ├── test_file_size_disabled.py
    │       │   │   │   ├── test_file_size_values.py
    │       │   │   │   ├── test_large_changes.py
    │       │   │   │   ├── test_report_changes_and_diff.py
    │       │   │   │   ├── test_report_deleted_diff.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   ├── configuration_diff_size.yaml
    │       │   │   │       │   ├── configuration_disk_quota_default.yaml
    │       │   │   │       │   ├── configuration_large_changes.yaml
    │       │   │   │       │   ├── configuration_report_changes_and_diff.yaml
    │       │   │   │       │   └── configuration_report_deleted_diff.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           ├── cases_disk_quota_configured.yaml
    │       │   │   │           ├── cases_disk_quota_disabled.yaml
    │       │   │   │           ├── cases_disk_quota_values.yaml
    │       │   │   │           ├── cases_file_size_configured.yaml
    │       │   │   │           ├── cases_file_size_default.yaml
    │       │   │   │           ├── cases_file_size_disabled.yaml
    │       │   │   │           ├── cases_file_size_values.yaml
    │       │   │   │           ├── cases_large_changes.yaml
    │       │   │   │           ├── cases_large_changes_macos.yaml
    │       │   │   │           ├── cases_report_changes_and_diff.yaml
    │       │   │   │           ├── cases_report_changes_and_diff_macos.yaml
    │       │   │   │           └── cases_report_deleted_diff.yaml
    │       │   │   ├── test_restrict/
    │       │   │   │   ├── __init__.py
    │       │   │   │   ├── test_restrict.py
    │       │   │   │   └── data/
    │       │   │   │       ├── configuration_templates/
    │       │   │   │       │   └── config_restrict.yaml
    │       │   │   │       └── test_cases/
    │       │   │   │           └── cases_restrict.yaml
    │       │   │   └── test_windows_system_folder_redirection/
    │       │   │       ├── __init__.py
    │       │   │       ├── test_windows_system_folder_redirection.py
    │       │   │       └── data/
    │       │   │           ├── configuration_templates/
    │       │   │           │   └── conf_win_system_folder_redir.yaml
    │       │   │           └── test_cases/
    │       │   │               └── cases_windows_system_folder_redirection.yaml
    │       │   └── test_registry/
    │       │       ├── __init__.py
    │       │       └── test_registry_restrict/
    │       │           ├── __init__.py
    │       │           ├── test_registry_restrict_key.py
    │       │           ├── test_registry_restrict_value.py
    │       │           └── data/
    │       │               ├── configuration_templates/
    │       │               │   ├── configuration_registry_restrict_key.yaml
    │       │               │   └── configuration_registry_restrict_value.yaml
    │       │               └── test_cases/
    │       │                   ├── cases_registry_restrict_key.yaml
    │       │                   └── cases_registry_restrict_value.yaml
    │       ├── test_github/
    │       │   ├── conftest.py
    │       │   └── test_configuration/
    │       │       ├── __init__.py
    │       │       ├── test_invalid.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── config_invalid_configuration.yaml
    │       │           └── test_cases/
    │       │               └── cases_invalid_configuration.yaml
    │       ├── test_logcollector/
    │       │   ├── conftest.py
    │       │   ├── utils.py
    │       │   ├── test_configuration/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_basic_configuration_alias.py
    │       │   │   ├── test_basic_configuration_command.py
    │       │   │   ├── test_basic_configuration_journald.py
    │       │   │   ├── test_basic_configuration_label.py
    │       │   │   ├── test_basic_configuration_location.py
    │       │   │   ├── test_basic_configuration_log_format.py
    │       │   │   ├── test_basic_configuration_out_format.py
    │       │   │   ├── test_basic_configuration_reconnect_time.py
    │       │   │   ├── test_basic_configuration_target.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── wazuh_basic_configuration.yaml
    │       │   │       │   ├── wazuh_basic_configuration_command.yaml
    │       │   │       │   ├── wazuh_basic_configuration_label.yaml
    │       │   │       │   ├── wazuh_basic_configuration_log_format.yaml
    │       │   │       │   ├── wazuh_basic_configuration_log_format_location.yaml
    │       │   │       │   ├── wazuh_basic_configuration_out_format.yaml
    │       │   │       │   ├── wazuh_basic_configuration_reconnect_time.yaml
    │       │   │       │   ├── wazuh_basic_configuration_target.yaml
    │       │   │       │   ├── wazuh_duplicated_macos_configuration.yaml
    │       │   │       │   └── wazuh_no_defined_location_macos_configuration.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_basic_configuration_alias.yaml
    │       │   │           ├── cases_basic_configuration_command.yaml
    │       │   │           ├── cases_basic_configuration_journald.yaml
    │       │   │           ├── cases_basic_configuration_label.yaml
    │       │   │           ├── cases_basic_configuration_location.yaml
    │       │   │           ├── cases_basic_configuration_location_macos.yaml
    │       │   │           ├── cases_basic_configuration_location_win.yaml
    │       │   │           ├── cases_basic_configuration_log_format.yaml
    │       │   │           ├── cases_basic_configuration_log_format_macos_duplicated.yaml
    │       │   │           ├── cases_basic_configuration_log_format_macos_no_defined.yaml
    │       │   │           ├── cases_basic_configuration_log_format_win.yaml
    │       │   │           ├── cases_basic_configuration_out_format.yaml
    │       │   │           ├── cases_basic_configuration_reconnect_time.yaml
    │       │   │           └── cases_basic_configuration_target.yaml
    │       │   └── test_read/
    │       │       ├── __init__.py
    │       │       ├── test_read_journald_basic.py
    │       │       ├── test_read_journald_ofe.py
    │       │       └── data/
    │       │           └── test_cases/
    │       │               ├── cases_read_journald_basic.yaml
    │       │               └── cases_read_journald_ofe.yaml
    │       ├── test_msgraph/
    │       │   ├── conftest.py
    │       │   ├── test_API/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_API.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_API.yaml
    │       │   │       ├── response_samples/
    │       │   │       │   └── responses.json
    │       │   │       └── test_cases/
    │       │   │           ├── cases_curl_size.yaml
    │       │   │           ├── cases_future_no.yaml
    │       │   │           ├── cases_future_yes.yaml
    │       │   │           ├── cases_invalid_auth.yaml
    │       │   │           ├── cases_invalid_resource.yaml
    │       │   │           ├── cases_valid_auth.yaml
    │       │   │           └── cases_valid_resource.yaml
    │       │   └── test_configuration/
    │       │       ├── __init__.py
    │       │       ├── test_basic.py
    │       │       ├── test_invalid.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   ├── config_basic.yaml
    │       │           │   └── config_invalid_configuration.yaml
    │       │           └── test_cases/
    │       │               ├── cases_disabled.yaml
    │       │               ├── cases_enabled.yaml
    │       │               └── cases_invalid_configuration.yaml
    │       ├── test_office365/
    │       │   ├── conftest.py
    │       │   └── test_configuration/
    │       │       ├── __init__.py
    │       │       ├── test_invalid.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── config_invalid_configuration.yaml
    │       │           └── test_cases/
    │       │               └── cases_invalid_configuration.yaml
    │       ├── test_remoted/
    │       │   ├── conftest.py
    │       │   ├── test_active_response/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_active_response_send.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_ar.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_ar.yaml
    │       │   ├── test_agent_communication/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_agent_pending_status.py
    │       │   │   ├── test_agent_version.py
    │       │   │   ├── test_agents_switching_protocols.py
    │       │   │   ├── test_invalid_protocols_communication.py
    │       │   │   ├── test_multi_agent_protocols_communication.py
    │       │   │   ├── test_multi_agent_status.py
    │       │   │   ├── test_protocols_communication.py
    │       │   │   ├── test_request_agent_info.py
    │       │   │   ├── test_shared_configuration.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_agent_pending_status.yaml
    │       │   │       │   ├── config_agents_switching_protocols.yaml
    │       │   │       │   ├── config_invalid_protocols_communication.yaml
    │       │   │       │   ├── config_multi_agent_protocols_communication.yaml
    │       │   │       │   ├── config_multi_agent_status.yaml
    │       │   │       │   ├── config_protocols_communication.yaml
    │       │   │       │   ├── config_request_agent_info.yaml
    │       │   │       │   └── config_shared_configuration.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_agent_pending_status.yaml
    │       │   │           ├── cases_agent_version.yaml
    │       │   │           ├── cases_agents_switching_protocols.yaml
    │       │   │           ├── cases_invalid_protocols_communication.yaml
    │       │   │           ├── cases_multi_agent_protocols_communication.yaml
    │       │   │           ├── cases_multi_agent_status.yaml
    │       │   │           ├── cases_protocols_communication.yaml
    │       │   │           ├── cases_request_agent_info.yaml
    │       │   │           └── cases_shared_configuration.yaml
    │       │   ├── test_configurations/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_invalid_connection.py
    │       │   │   ├── test_invalid_connection_port.py
    │       │   │   ├── test_invalid_connection_protocol.py
    │       │   │   ├── test_invalid_local_ip.py
    │       │   │   ├── test_queue_size_syslog.py
    │       │   │   ├── test_queue_size_too_big.py
    │       │   │   ├── test_rids_invalid_closing_time.py
    │       │   │   ├── test_rids_valid_closing_time.py
    │       │   │   ├── test_syslog_denied_ips.py
    │       │   │   ├── test_syslog_invalid_allowed_ips.py
    │       │   │   ├── test_syslog_invalid_denied_ips.py
    │       │   │   ├── test_syslog_no_allowed_ips.py
    │       │   │   ├── test_syslog_valid_allowed_denied_ips.py
    │       │   │   ├── test_syslog_valid_allowed_denied_ips_multiple.py
    │       │   │   ├── test_valid_connection.py
    │       │   │   ├── test_valid_local_ip.py
    │       │   │   ├── test_valid_queue_size.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   ├── config_invalid_connection.yaml
    │       │   │       │   ├── config_invalid_local_ip.yaml
    │       │   │       │   ├── config_queue_size.yaml
    │       │   │       │   ├── config_rids_closing_time.yaml
    │       │   │       │   ├── config_syslog_allowed_denied_ips.yaml
    │       │   │       │   ├── config_syslog_allowed_denied_ips_multiple.yaml
    │       │   │       │   ├── config_syslog_invalid_allowed_ips.yaml
    │       │   │       │   ├── config_syslog_invalid_denied_ips.yaml
    │       │   │       │   ├── config_syslog_no_allowed_ips.yaml
    │       │   │       │   └── config_valid_local_ip.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_invalid_connection.yaml
    │       │   │           ├── cases_invalid_connection_port.yaml
    │       │   │           ├── cases_invalid_connection_protocol.yaml
    │       │   │           ├── cases_invalid_local_ip.yaml
    │       │   │           ├── cases_queue_size_syslog.yaml
    │       │   │           ├── cases_queue_size_too_big.yaml
    │       │   │           ├── cases_rids_invalid_closing_time.yaml
    │       │   │           ├── cases_rids_valid_closing_time.yaml
    │       │   │           ├── cases_syslog_allowed_denied_ips.yaml
    │       │   │           ├── cases_syslog_allowed_denied_ips_multiple.yaml
    │       │   │           ├── cases_syslog_denied_ips.yaml
    │       │   │           ├── cases_syslog_invalid_allowed_ips.yaml
    │       │   │           ├── cases_syslog_invalid_denied_ips.yaml
    │       │   │           ├── cases_syslog_no_allowed_ips.yaml
    │       │   │           ├── cases_valid_connection.yaml
    │       │   │           ├── cases_valid_local_ip.yaml
    │       │   │           └── cases_valid_queue_size.yaml
    │       │   ├── test_manager/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_manager_ack.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_manager_ack.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_manager_ack.yaml
    │       │   ├── test_multi_groups/
    │       │   │   ├── __init__.py
    │       │   │   ├── conftest.py
    │       │   │   ├── test_merged_mg_file_content.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_multi_groups.yaml
    │       │   │       └── test_cases/
    │       │   │           └── cases_file_actions.yaml
    │       │   ├── test_rids/
    │       │   │   ├── __init__.py
    │       │   │   ├── test_config.py
    │       │   │   ├── test_rids.py
    │       │   │   └── data/
    │       │   │       ├── configuration_templates/
    │       │   │       │   └── config_rids.yaml
    │       │   │       └── test_cases/
    │       │   │           ├── cases_config.yaml
    │       │   │           └── cases_rids.yaml
    │       │   └── test_socket_communication/
    │       │       ├── __init__.py
    │       │       ├── test_ping_pong_msg.py
    │       │       ├── test_syslog_message.py
    │       │       ├── test_syslog_message_parser.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   ├── config_socket_communication.yaml
    │       │           │   ├── config_syslog.yaml
    │       │           │   └── config_syslog_msg_parser.yaml
    │       │           └── test_cases/
    │       │               ├── cases_ping_pong_msg.yaml
    │       │               ├── cases_syslog_message.yaml
    │       │               └── cases_syslog_msg_parser.yaml
    │       ├── test_sca/
    │       │   ├── conftest.py
    │       │   └── test_basic/
    │       │       ├── __init__.py
    │       │       ├── conftest.py
    │       │       ├── test_scan_results.py
    │       │       ├── test_validate_remediation.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   └── configuration_sca.yaml
    │       │           ├── policies_samples/
    │       │           │   ├── cis_centos8_pcre2.yaml
    │       │           │   ├── cis_centos8_validate_remediation.yaml
    │       │           │   ├── cis_win_pcre2.yaml
    │       │           │   └── cis_win_validate_remediation.yaml
    │       │           └── test_cases/
    │       │               ├── cases_scan_results.yaml
    │       │               ├── cases_scan_results_win.yaml
    │       │               ├── cases_validate_remediation.yaml
    │       │               └── cases_validate_remediation_win.yaml
    │       ├── test_syscollector/
    │       │   ├── conftest.py
    │       │   └── test_configuration/
    │       │       ├── __init__.py
    │       │       ├── test_syscollector_configuration.py
    │       │       └── data/
    │       │           ├── configuration_templates/
    │       │           │   ├── configuration_syscollector.yaml
    │       │           │   ├── configuration_syscollector_collectors_disabled.yaml
    │       │           │   ├── configuration_syscollector_no_tags.yaml
    │       │           │   └── configuration_syscollector_scans_disabled.yaml
    │       │           └── test_cases/
    │       │               ├── case_test_all_scans_disabled.yaml
    │       │               ├── case_test_collectors_disabled.yaml
    │       │               ├── case_test_default_values.yaml
    │       │               ├── case_test_invalid_configurations.yaml
    │       │               ├── case_test_scanning.yaml
    │       │               └── case_test_syscollector_deactivation.yaml
    │       └── test_wazuh_db/
    │           ├── conftest.py
    │           ├── test_backup/
    │           │   ├── __init__.py
    │           │   ├── conftest.py
    │           │   ├── test_db_backup.py
    │           │   ├── test_wdb_backup_configs.py
    │           │   └── data/
    │           │       ├── configuration_templates/
    │           │       │   └── configuration_wazuh_db_backups_conf.yaml
    │           │       └── test_cases/
    │           │           ├── cases_wazuh_db_backup_command.yaml
    │           │           └── cases_wazuh_db_backups_conf.yaml
    │           ├── test_configuration/
    │           │   ├── __init__.py
    │           │   ├── test_wazuhdb_getconfig.py
    │           │   └── data/
    │           │       └── test_cases/
    │           │           └── cases_wazuhdb_getconfig.yaml
    │           ├── test_databases/
    │           │   ├── __init__.py
    │           │   ├── conftest.py
    │           │   ├── test_agent_database_version.py
    │           │   ├── test_wazuh_db.py
    │           │   ├── test_wazuh_db_timeout.py
    │           │   └── data/
    │           │       └── test_cases/
    │           │           ├── cases_agent_messages.yaml
    │           │           ├── cases_global_messages.yaml
    │           │           └── cases_tasks_messages.yaml
    │           └── test_groups/
    │               ├── __init__.py
    │               ├── conftest.py
    │               ├── test_get_groups_integrity.py
    │               ├── test_set_agent_groups.py
    │               ├── test_sync_agent_groups_get.py
    │               └── data/
    │                   └── test_cases/
    │                       ├── cases_get_groups_integrity_messages.yaml
    │                       ├── cases_set_agent_groups.yaml
    │                       └── cases_sync_agent_groups_get.yaml
    ├── tools/
    │   ├── get_git_refs.sh
    │   ├── repository_bumper.sh
    │   ├── agent-upgrade/
    │   │   ├── README.md
    │   │   └── wpkpack.py
    │   ├── debug/
    │   │   ├── README.md
    │   │   ├── csv-stat.py
    │   │   ├── queue-mitm.py
    │   │   ├── sendmsg.py
    │   │   ├── socket-query.py
    │   │   └── wdb-query.py
    │   ├── devContainer/
    │   │   └── reinstall-cmake.sh
    │   ├── migration/
    │   │   └── fim_migrate.py
    │   ├── mitre/
    │   │   ├── const.py
    │   │   └── mitredb.py
    │   └── testing/
    │       ├── coverity/
    │       │   ├── README.md
    │       │   ├── coverity.sh
    │       │   └── Dockerfile
    │       ├── enrollment-simulator/
    │       │   ├── README.md
    │       │   ├── CMakeLists.txt
    │       │   └── src/
    │       │       ├── agent_config.cpp
    │       │       ├── agent_config.h
    │       │       ├── csv_exporter.cpp
    │       │       ├── csv_exporter.h
    │       │       ├── main.cpp
    │       │       ├── network_utils.cpp
    │       │       ├── network_utils.h
    │       │       ├── simulator.cpp
    │       │       ├── simulator.h
    │       │       ├── statistics.cpp
    │       │       ├── statistics.h
    │       │       ├── types.cpp
    │       │       └── types.h
    │       └── unit-tests/
    │           ├── README.md
    │           ├── Dockerfile
    │           └── unit-tests.sh
    ├── wodles/
    │   ├── __init__.py
    │   ├── pytest.ini
    │   ├── utils.py
    │   ├── aws/
    │   │   ├── __init__.py
    │   │   ├── aws_s3.py
    │   │   ├── aws_tools.py
    │   │   ├── wazuh_integration.py
    │   │   ├── buckets_s3/
    │   │   │   ├── __init__.py
    │   │   │   ├── aws_bucket.py
    │   │   │   ├── cloudtrail.py
    │   │   │   ├── config.py
    │   │   │   ├── guardduty.py
    │   │   │   ├── load_balancers.py
    │   │   │   ├── server_access.py
    │   │   │   ├── umbrella.py
    │   │   │   ├── vpcflow.py
    │   │   │   └── waf.py
    │   │   ├── services/
    │   │   │   ├── __init__.py
    │   │   │   ├── aws_service.py
    │   │   │   ├── cloudwatchlogs.py
    │   │   │   └── inspector.py
    │   │   ├── subscribers/
    │   │   │   ├── __init__.py
    │   │   │   ├── s3_log_handler.py
    │   │   │   ├── sqs_message_processor.py
    │   │   │   └── sqs_queue.py
    │   │   └── tests/
    │   │       ├── __init__.py
    │   │       ├── aws_utils.py
    │   │       ├── conftest.py
    │   │       ├── pytest.ini
    │   │       ├── test_aws_bucket.py
    │   │       ├── test_aws_s3.py
    │   │       ├── test_aws_service.py
    │   │       ├── test_cloudtrail.py
    │   │       ├── test_cloudwatchlogs.py
    │   │       ├── test_config.py
    │   │       ├── test_guardduty.py
    │   │       ├── test_inspector.py
    │   │       ├── test_load_balancers.py
    │   │       ├── test_s3_log_handler.py
    │   │       ├── test_server_access.py
    │   │       ├── test_sqs_message_processor.py
    │   │       ├── test_sqs_queue.py
    │   │       ├── test_tools.py
    │   │       ├── test_umbrella.py
    │   │       ├── test_vpcflow.py
    │   │       ├── test_waf.py
    │   │       ├── test_wazuh_integration.py
    │   │       └── data/
    │   │           ├── schema_cloudtrail_test.sql
    │   │           ├── schema_cloudwatchlogs_test.sql
    │   │           ├── schema_config_test.sql
    │   │           ├── schema_custom_test.sql
    │   │           ├── schema_empty_table.sql
    │   │           ├── schema_empty_vpc_table.sql
    │   │           ├── schema_guardduty_test.sql
    │   │           ├── schema_metadata_deprecated_tables_test.sql
    │   │           ├── schema_metadata_test.sql
    │   │           ├── schema_services_test.sql
    │   │           ├── schema_vpcflow_test.sql
    │   │           └── log_files/
    │   │               ├── AWSSecurityLake/
    │   │               │   └── test_file.parquet
    │   │               └── WAF/
    │   │                   ├── aws-waf
    │   │                   ├── aws-waf-invalid-json
    │   │                   └── aws-waf-wrong-structure
    │   ├── azure/
    │   │   ├── azure-logs.py
    │   │   ├── azure_utils.py
    │   │   ├── azure_services/
    │   │   │   ├── __init__.py
    │   │   │   ├── analytics.py
    │   │   │   ├── graph.py
    │   │   │   └── storage.py
    │   │   ├── db/
    │   │   │   ├── __init__.py
    │   │   │   ├── orm.py
    │   │   │   └── utils.py
    │   │   └── tests/
    │   │       ├── __init__.py
    │   │       ├── test_azure_utils.py
    │   │       ├── azure_services/
    │   │       │   ├── __init__.py
    │   │       │   ├── test_analytics.py
    │   │       │   ├── test_graph.py
    │   │       │   └── test_storage.py
    │   │       ├── data/
    │   │       │   ├── graph_events
    │   │       │   ├── graph_events_no_values
    │   │       │   ├── log_analytics_events
    │   │       │   ├── log_analytics_events_empty
    │   │       │   ├── log_analytics_events_no_results
    │   │       │   ├── storage_events_inline
    │   │       │   ├── storage_events_json
    │   │       │   ├── storage_events_plain
    │   │       │   ├── authentication_files/
    │   │       │   │   ├── empty_authentication_file
    │   │       │   │   ├── invalid_authentication_file
    │   │       │   │   ├── invalid_authentication_file_2
    │   │       │   │   ├── invalid_authentication_file_3
    │   │       │   │   ├── valid_authentication_file
    │   │       │   │   ├── valid_authentication_file_alt
    │   │       │   │   ├── valid_authentication_file_extra_line
    │   │       │   │   └── valid_authentication_file_storage
    │   │       │   └── last_date_files/
    │   │       │       ├── last_dates.json
    │   │       │       ├── last_dates_clean.json
    │   │       │       ├── last_dates_empty.json
    │   │       │       ├── last_dates_graph.json
    │   │       │       ├── last_dates_invalid.json
    │   │       │       ├── last_dates_log_analytics.json
    │   │       │       ├── last_dates_old.json
    │   │       │       ├── last_dates_old_invalid_value.json
    │   │       │       ├── last_dates_storage.json
    │   │       │       └── last_dates_with_invalid_min_max.json
    │   │       └── db/
    │   │           ├── __init__.py
    │   │           ├── test_db_utils.py
    │   │           └── test_orm.py
    │   ├── docker-listener/
    │   │   ├── DockerListener.py
    │   │   └── tests/
    │   │       └── test_docker_listener.py
    │   └── gcloud/
    │       ├── exceptions.py
    │       ├── gcloud.py
    │       ├── integration.py
    │       ├── tools.py
    │       ├── buckets/
    │       │   ├── access_logs.py
    │       │   └── bucket.py
    │       ├── pubsub/
    │       │   └── subscriber.py
    │       └── tests/
    │           ├── test_bucket.py
    │           ├── test_gcloud.py
    │           ├── test_integration.py
    │           ├── test_subscriber.py
    │           ├── test_tools.py
    │           └── data/
    │               ├── invalid_credentials_file.json
    │               └── testing_database.sql
    └── .github/
        ├── CODEOWNERS
        ├── pull_request_template.md
        ├── actions/
        │   ├── legacy_unit_tests.sh
        │   ├── 4_operational_prerelease_agent_integration_tests_issue/
        │   │   └── action.yml
        │   ├── 4_operational_prerelease_coverity_issue/
        │   │   └── action.yml
        │   ├── 4_operational_prerelease_unit_tests_issue/
        │   │   └── action.yml
        │   ├── 4_operational_prerelease_wpk_tests_issue/
        │   │   └── action.yml
        │   ├── 5_builderpackage_get-last-stable-version/
        │   │   ├── action.yml
        │   │   └── get_last_stable_version.py
        │   ├── 5_builderpackage_get-upgrade-test-package-url/
        │   │   ├── action.yml
        │   │   └── get_upgrade_test_package_url.py
        │   ├── 5_builderpackage_linux-smoke-uninstall-test/
        │   │   ├── action.yml
        │   │   └── smoke_uninstall_test.sh
        │   ├── 5_builderpackage_linux-smoke-upgrade-test/
        │   │   ├── action.yml
        │   │   └── smoke_upgrade_test.sh
        │   ├── 5_builderpackage_macos-smoke-upgrade-test/
        │   │   ├── action.yml
        │   │   └── smoke_upgrade_test.sh
        │   ├── 5_builderpackage_windows-smoke-upgrade-test/
        │   │   ├── action.yml
        │   │   └── smoke_upgrade_test.py
        │   ├── build_external_deps/
        │   │   └── action.yml
        │   ├── build_target_cpp/
        │   │   └── action.yml
        │   ├── build_test_flags/
        │   │   └── action.yml
        │   ├── check_files/
        │   │   ├── action.yml
        │   │   ├── check_files.py
        │   │   ├── deb_linux_agent_amd64.csv
        │   │   ├── deb_linux_agent_i386.csv
        │   │   ├── macos_agent_arm64.csv
        │   │   ├── macos_agent_x86_64.csv
        │   │   ├── manager_base.csv
        │   │   ├── requirements.txt
        │   │   ├── rpm_linux_agent_amd64.csv
        │   │   ├── rpm_linux_agent_i386.csv
        │   │   └── windows_agent_base.csv
        │   ├── clang_format/
        │   │   └── action.yml
        │   ├── compile/
        │   │   └── action.yml
        │   ├── compile_and_test/
        │   │   └── action.yml
        │   ├── coverage/
        │   │   └── action.yml
        │   ├── coverage_cpp/
        │   │   └── action.yml
        │   ├── coverity/
        │   │   └── upload/
        │   │       └── action.yml
        │   ├── doxygen/
        │   │   └── action.yml
        │   ├── ghcr-pull-and-push/
        │   │   ├── build_and_push_image_to_ghcr.sh
        │   │   ├── pull_image_from_ghcr.sh
        │   │   └── retag_image.sh
        │   ├── indexer_connector_deps/
        │   │   └── action.yml
        │   ├── install_build_deps/
        │   │   └── action.yml
        │   ├── legacy_unit_tests_build/
        │   │   └── action.yml
        │   ├── legacy_unit_tests_run/
        │   │   └── action.yml
        │   ├── reinstall_cmake/
        │   │   └── action.yml
        │   ├── test-install-components/
        │   │   ├── install_component.sh
        │   │   └── uninstall_component.sh
        │   ├── test_cpp/
        │   │   └── action.yml
        │   ├── vulnerability_scanner/
        │   │   ├── compile/
        │   │   │   └── action.yml
        │   │   └── content_generation/
        │   │       └── action.yml
        │   └── vulnerability_scanner_deps/
        │       └── action.yml
        ├── ISSUE_TEMPLATE/
        │   ├── api-framework.md
        │   ├── api-integration-tests.md
        │   ├── default.md
        │   ├── external-integrations.md
        │   ├── integration-component-test-manager.md
        │   ├── python-integration-tests.md
        │   ├── python-unit-tests.md
        │   ├── release-it-tests.md
        │   ├── release-manual-tests.md
        │   ├── rules-decoders_request.md
        │   ├── system-tests.md
        │   ├── ui-regression-test.md
        │   ├── workload-benchmarks-metrics.md
        │   └── wpk-upgrade-tests.md
        ├── scripts/
        │   └── configure-project-fields.sh
        └── workflows/
            ├── 4_builderpackage_filebeat-module.yml
            ├── 4_builderpackage_filebeat-package.yml
            ├── 4_builderpackage_manager-multiples.yml
            ├── 4_builderpackage_manager.yml
            ├── 4_builderprecompiled_docker-images-retag.yml
            ├── 4_builderprecompiled_docker-images-upload-manager.yml
            ├── 4_builderprecompiled_docker-images-upload.yml
            ├── 4_builderprecompiled_vdscanner-testtools.yml
            ├── 4_builderprecompiled_vulnerability-scanner-database.yml
            ├── 4_codeanalysis_coverity-image.yml
            ├── 4_codeanalysis_coverity.yml
            ├── 4_codeanalysis_python_bandit.yml
            ├── 4_codeanalysis_scanbuild.yml
            ├── 4_codelinter_clangformat.yml
            ├── 4_operational_prerelease_issues.yml
            ├── 4_testcomponent_build-macos.yml
            ├── 4_testcomponent_elasticsearch-template.yml
            ├── 4_testcomponent_indexer-connector.yml
            ├── 4_testcomponent_inventory-harvester.yml
            ├── 4_testcomponent_keystore.yml
            ├── 4_testcomponent_syscheck-rtr.yml
            ├── 4_testcomponent_syscollector-rtr.yml
            ├── 4_testcomponent_sysinfo-linux.yml
            ├── 4_testcomponent_sysinfo-macos.yml
            ├── 4_testcomponent_sysinfo-windows.yml
            ├── 4_testcomponent_vulnerability-scanner.yml
            ├── 4_testcomponent_windows-dll-hijack.yml
            ├── 4_testcomponent_windows-files.yml
            ├── 4_testcomponent_windows-installer-upgrade.yml
            ├── 4_testintegration_agentd-tier-0-1-lin.yml
            ├── 4_testintegration_agentd-tier-0-1-win.yml
            ├── 4_testintegration_analysisd-tier-0-1.yml
            ├── 4_testintegration_analysisd-tier-2.yml
            ├── 4_testintegration_api-tier-0-1.yml
            ├── 4_testintegration_api-tier-2.yml
            ├── 4_testintegration_authd-tier-0-1.yml
            ├── 4_testintegration_aws-tier-0-1.yml
            ├── 4_testintegration_enrollment-tier-0-1-lin.yml
            ├── 4_testintegration_enrollment-tier-0-1-win.yml
            ├── 4_testintegration_execd-tier-0-1-lin.yml
            ├── 4_testintegration_execd-tier-0-1-win.yml
            ├── 4_testintegration_fim-tier-0-1-lin.yml
            ├── 4_testintegration_fim-tier-0-1-macos.yml
            ├── 4_testintegration_fim-tier-0-1-win.yml
            ├── 4_testintegration_fim-tier-2-lin.yml
            ├── 4_testintegration_fim-tier-2-win.yml
            ├── 4_testintegration_github-tier-0-1-lin.yml
            ├── 4_testintegration_github-tier-0-1-win.yml
            ├── 4_testintegration_integratord-tier-0-1.yml
            ├── 4_testintegration_inventory-harvester.yml
            ├── 4_testintegration_logcollector-tier-0-1-lin.yml
            ├── 4_testintegration_logcollector-tier-0-1-macos.yml
            ├── 4_testintegration_logcollector-tier-0-1-win.yml
            ├── 4_testintegration_logtest-tier-0-1.yml
            ├── 4_testintegration_msgraph-tier-0-1-lin.yml
            ├── 4_testintegration_office365-tier-0-1-lin.yml
            ├── 4_testintegration_office365-tier-0-1-win.yml
            ├── 4_testintegration_rbac-tier-0-1.yml
            ├── 4_testintegration_remoted-tier-0-1.yml
            ├── 4_testintegration_remoted-tier-2.yml
            ├── 4_testintegration_ruleset.yml
            ├── 4_testintegration_sca-tier-0-1-lin.yml
            ├── 4_testintegration_sca-tier-0-1-win.yml
            ├── 4_testintegration_syscollector-tier-0-1-lin.yml
            ├── 4_testintegration_syscollector-tier-0-1-win.yml
            ├── 4_testintegration_wazuh_db-tier-0-1.yml
            ├── 4_testunit_api.yml
            ├── 4_testunit_external-integrations.yml
            ├── 4_testunit_framework.yml
            ├── 4_testunit_image.yml
            ├── 4_testunit_inventory-harvester.yml
            ├── 4_testunit_linux-win.yml
            ├── 4_testunit_macos.yml
            ├── 4_testunit_python-coverage.yml
            ├── 4_testunit_wodles.yml
            ├── 5_builderpackage_agent-linux-arm64.yml
            ├── 5_builderpackage_agent-linux.yml
            ├── 5_builderpackage_agent-macos.yml
            ├── 5_builderpackage_agent-windows.yml
            ├── 5_builderpackage_binutils.yml
            ├── 5_builderpackage_embedded-python.yml
            ├── 5_builderpackage_engine-standalone.yml
            ├── 5_builderpackage_engine-standalone_onpush.yml
            ├── 5_builderpackage_gcc.yml
            ├── 5_builderpackage_manager-multiples.yml
            ├── 5_builderpackage_manager.yml
            ├── 5_builderprecompiled_docker-images-upload-manager.yml
            ├── 5_builderprecompiled_docker-images-upload.yml
            ├── 5_buildpackage_internal_tools.yml
            ├── 5_bumper_repository.yml
            ├── 5_codeanalysis_api-rbac-db-version.yml
            ├── 5_codeanalysis_coverity.yml
            ├── 5_codeanalysis_python-vulns.yml
            ├── 5_codeanalysis_python_bandit_pr.yml
            ├── 5_codeanalysis_scanbuild.yml
            ├── 5_codelinter_clangformat.yml
            ├── 5_testcomponent_agent_info-rtr.yml
            ├── 5_testcomponent_agent_metadata-rtr.yml
            ├── 5_testcomponent_build-macos.yml
            ├── 5_testcomponent_contentmanager.yml
            ├── 5_testcomponent_router.yml
            ├── 5_testcomponent_sca-rtr.yml
            ├── 5_testcomponent_shared_modules_file_helper-rtr.yml
            ├── 5_testcomponent_sync_protocol-rtr.yml
            ├── 5_testcomponent_syscheck-rtr.yml
            ├── 5_testcomponent_syscollector-rtr.yml
            ├── 5_testcomponent_vulnerability-scanner.yml
            ├── 5_testcomponent_windows-dll-hijack.yml
            ├── 5_testcomponent_windows-files.yml
            ├── 5_testcomponent_windows-installer-upgrade.yml
            ├── 5_testintegration_agent-start.yml
            ├── 5_testintegration_agentd-tier-0-1-lin.yml
            ├── 5_testintegration_agentd-tier-0-1-win.yml
            ├── 5_testintegration_api-tier-0-1.yml
            ├── 5_testintegration_api-tier-2.yml
            ├── 5_testintegration_engine.yml
            ├── 5_testintegration_enrollment-tier-0-1-lin.yml
            ├── 5_testintegration_enrollment-tier-0-1-win.yml
            ├── 5_testintegration_execd-tier-0-1-lin.yml
            ├── 5_testintegration_execd-tier-0-1-win.yml
            ├── 5_testintegration_fim-tier-0-1-lin.yml
            ├── 5_testintegration_fim-tier-0-1-macos.yml
            ├── 5_testintegration_fim-tier-0-1-win.yml
            ├── 5_testintegration_fim-tier-2-lin.yml
            ├── 5_testintegration_fim-tier-2-win.yml
            ├── 5_testintegration_github-tier-0-1-lin.yml
            ├── 5_testintegration_github-tier-0-1-win.yml
            ├── 5_testintegration_inventory-sync.yml
            ├── 5_testintegration_logcollector-tier-0-1-lin.yml
            ├── 5_testintegration_logcollector-tier-0-1-macos.yml
            ├── 5_testintegration_logcollector-tier-0-1-win.yml
            ├── 5_testintegration_msgraph-tier-0-1-lin.yml
            ├── 5_testintegration_office365-tier-0-1-lin.yml
            ├── 5_testintegration_office365-tier-0-1-win.yml
            ├── 5_testintegration_rbac-tier-0-1.yml
            ├── 5_testintegration_sca-tier-0-1-lin.yml
            ├── 5_testintegration_sca-tier-0-1-win.yml
            ├── 5_testintegration_syscollector-tier-0-1-lin.yml
            ├── 5_testintegration_syscollector-tier-0-1-win.yml
            ├── 5_testintegration_vulnerability-scanner.yml
            ├── 5_testunit_api.yml
            ├── 5_testunit_contentmanager.yml
            ├── 5_testunit_engine.yml
            ├── 5_testunit_framework.yml
            ├── 5_testunit_indexerconnector.yml
            ├── 5_testunit_inventorysync.yml
            ├── 5_testunit_linux-win.yml
            ├── 5_testunit_macos.yml
            ├── 5_testunit_python-coverage.yml
            ├── 5_testunit_router.yml
            ├── 5_testunit_shared_modules_utils.yml
            ├── 5_testunit_vulnerability-scanner.yml
            ├── 5_testunit_wodles.yml
            ├── 6_builderpackage_server.yml
            ├── 6_builderprecompiled_server-images.yml
            ├── .python-version
            └── .python-version-it


(Files content cropped to 300k characters, download full ingest to see more)
================================================
FILE: README.md
================================================
# Wazuh

[![Slack](https://img.shields.io/badge/slack-join-blue.svg)](https://wazuh.com/community/join-us-on-slack/)
[![Email](https://img.shields.io/badge/email-join-blue.svg)](https://groups.google.com/forum/#!forum/wazuh)
[![Documentation](https://img.shields.io/badge/docs-view-green.svg)](https://documentation.wazuh.com)
[![Documentation](https://img.shields.io/badge/web-view-green.svg)](https://wazuh.com)
[![Coverity](https://scan.coverity.com/projects/10992/badge.svg)](https://scan.coverity.com/projects/wazuh-wazuh)
[![Twitter](https://img.shields.io/twitter/follow/wazuh?style=social)](https://twitter.com/wazuh)
[![YouTube](https://img.shields.io/youtube/views/peTSzcAueEc?style=social)](https://www.youtube.com/watch?v=peTSzcAueEc)


Wazuh is a free and open source platform used for threat prevention, detection, and response. It is capable of protecting workloads across on-premises, virtualized, containerized, and cloud-based environments.

Wazuh solution consists of an endpoint security agent, deployed to the monitored systems, and a management server, which collects and analyzes data gathered by the agents. Besides, Wazuh has been fully integrated with the Elastic Stack, providing a search engine and data visualization tool that allows users to navigate through their security alerts.

## Wazuh capabilities

A brief presentation of some of the more common use cases of the Wazuh solution.

**Intrusion detection**

Wazuh agents scan the monitored systems looking for malware, rootkits and suspicious anomalies. They can detect hidden files, cloaked processes or unregistered network listeners, as well as inconsistencies in system call responses.

In addition to agent capabilities, the server component uses a signature-based approach to intrusion detection, using its regular expression engine to analyze collected log data and look for indicators of compromise.

**Log data analysis**

Wazuh agents read operating system and application logs, and securely forward them to a central manager for rule-based analysis and storage. When no agent is deployed, the server can also receive data via syslog from network devices or applications.

The Wazuh rules help make you aware of application or system errors, misconfigurations, attempted and/or successful malicious activities, policy violations and a variety of other security and operational issues.

**File integrity monitoring**

Wazuh monitors the file system, identifying changes in content, permissions, ownership, and attributes of files that you need to keep an eye on. In addition, it natively identifies users and applications used to create or modify files.

File integrity monitoring capabilities can be used in combination with threat intelligence to identify threats or compromised hosts. In addition, several regulatory compliance standards, such as PCI DSS, require it.

**Vulnerability detection**

Wazuh agents pull software inventory data and send this information to the server, where it is correlated with continuously updated CVE (Common Vulnerabilities and Exposure) databases, in order to identify well-known vulnerable software.

Automated vulnerability assessment helps you find the weak spots in your critical assets and take corrective action before attackers exploit them to sabotage your business or steal confidential data.

**Configuration assessment**

Wazuh monitors system and application configuration settings to ensure they are compliant with your security policies, standards and/or hardening guides. Agents perform periodic scans to detect applications that are known to be vulnerable, unpatched, or insecurely configured.

Additionally, configuration checks can be customized, tailoring them to properly align with your organization. Alerts include recommendations for better configuration, references and mapping with regulatory compliance.

**Incident response**

Wazuh agents provide out-of-the-box active responses to perform various countermeasures to address active threats, such as blocking access to a system from the threat source when certain criteria are met.

In addition, Wazuh can be used to remotely run commands or system queries on agents, identifying indicators of compromise (IOCs) and helping perform other live forensics or incident response tasks.

**Regulatory compliance**

Wazuh provides some of the necessary security controls to become compliant with industry standards and regulations. These features, combined with its scalability and multi-platform support help organizations meet technical compliance requirements.

Wazuh is widely used by payment processing companies and financial institutions to meet PCI DSS (Payment Card Industry Data Security Standard) requirements. Its web user interface provides reports and dashboards that can help with this and other regulations (e.g. GPG13 or GDPR).

**Cloud security**

Wazuh helps monitoring cloud infrastructure at an API level, using integration modules that are able to pull security data from well known cloud providers, such as Amazon AWS, Azure or Google Cloud. In addition, Wazuh provides rules to assess the configuration of your cloud environment, easily spotting weaknesses.

In addition, Wazuh light-weight and multi-platform agents are commonly used to monitor cloud environments at the instance level.

**Containers security**

Wazuh provides security visibility into your Docker hosts and containers, monitoring their behavior and detecting threats, vulnerabilities and anomalies. The Wazuh agent has native integration with the Docker engine allowing users to monitor images, volumes, network settings, and running containers.

Wazuh continuously collects and analyzes detailed runtime information. For example, alerting for containers running in privileged mode, vulnerable applications, a shell running in a container, changes to persistent volumes or images, and other possible threats.

## WUI

The Wazuh WUI provides a powerful user interface for data visualization and analysis. This interface can also be used to manage Wazuh configuration and to monitor its status.

**Modules overview**

![Modules overview](https://github.com/wazuh/wazuh-dashboard-plugins/raw/main/screenshots/app.png)

**Security events**

![Overview](https://github.com/wazuh/wazuh-dashboard-plugins/blob/main/screenshots/app2.png)

**Integrity monitoring**

![Overview](https://github.com/wazuh/wazuh-dashboard-plugins/blob/main/screenshots/app3.png)

**Vulnerability detection**

![Overview](https://github.com/wazuh/wazuh-dashboard-plugins/blob/main/screenshots/app4.png)

**Regulatory compliance**

![Overview](https://github.com/wazuh/wazuh-dashboard-plugins/blob/main/screenshots/app5.png)

**Agents overview**

![Overview](https://github.com/wazuh/wazuh-dashboard-plugins/blob/main/screenshots/app6.png)

**Agent summary**

![Overview](https://github.com/wazuh/wazuh-dashboard-plugins/blob/main/screenshots/app7.png)

## Orchestration

Here you can find all the automation tools maintained by the Wazuh team.

* [Wazuh AWS CloudFormation](https://github.com/wazuh/wazuh-cloudformation)

* [Docker containers](https://github.com/wazuh/wazuh-docker)

* [Wazuh Ansible](https://github.com/wazuh/wazuh-ansible)

* [Wazuh Chef](https://github.com/wazuh/wazuh-chef)

* [Wazuh Puppet](https://github.com/wazuh/wazuh-puppet)

* [Wazuh Kubernetes](https://github.com/wazuh/wazuh-kubernetes)

* [Wazuh Bosh](https://github.com/wazuh/wazuh-bosh)

* [Wazuh Salt](https://github.com/wazuh/wazuh-salt)

## Branches

* `main` branch contains the latest code, be aware of possible bugs on this branch.

## Software and libraries used

|Software|Version|Author|License|
|---|---|---|---|
|[bpftool](https://github.com/libbpf/bpftool)|7.5.0|libbpf|GNU Public License version 2|
|[bzip2](https://github.com/libarchive/bzip2)|1.0.8|Julian Seward|BSD License|
|[cJSON](https://github.com/DaveGamble/cJSON)|1.7.18|Dave Gamble|MIT License|
|[cpp-httplib](https://github.com/yhirose/cpp-httplib)|0.25.0|yhirose|MIT License|
|[cPython](https://github.com/python/cpython)|3.12.12|Guido van Rossum|Python Software Foundation License version 2|
|[cURL](https://github.com/curl/curl)|8.12.1|Daniel Stenberg|MIT License|
|[dbus](https://gitlab.freedesktop.org/dbus/dbus)|1.14.10|freedesktop.org|GNU Public License version 2|
|[Flatbuffers](https://github.com/google/flatbuffers/)|23.5.26|Google Inc.|Apache 2.0 License|
|[Google Benchmark](https://github.com/google/benchmark)|1.6.1|Google Inc.|Apache 2.0 License||
|[GoogleTest](https://github.com/google/googletest)|1.11.0|Google Inc.|3-Clause "New" BSD License|
|[jemalloc](https://github.com/jemalloc/jemalloc)|5.2.1|Jason Evans|2-Clause "Simplified" BSD License|
|[libarchive](https://github.com/libarchive/libarchive)|3.8.1|Tim Kientzle|3-Clause "New" BSD License|
|[libbpf](https://github.com/libbpf/libbpf)|1.5.0|libbpf|GNU Lesser General Public License version 2.1|
|[libdb](https://github.com/yasuhirokimura/db18)|18.1.40|Oracle Corporation|Affero GPL v3|
|[libffi](https://github.com/libffi/libffi)|3.2.1|Anthony Green|MIT License|
|[libpcre2](https://github.com/PCRE2Project/pcre2)|10.42.0|Philip Hazel|BSD License|
|[libplist](https://github.com/libimobiledevice/libplist)|2.2.0|Aaron Burghardt et al.|GNU Lesser General Public License version 2.1|
|[libYAML](https://github.com/yaml/libyaml)|0.1.7|Kirill Simonov|MIT License|
|[liblzma](https://github.com/tukaani-project/xz)|5.4.2|Lasse Collin, Jia Tan et al.|GNU Public License version 3|
|[Linux Audit userspace](https://github.com/linux-audit/audit-userspace)|2.8.4|Rik Faith|GNU Lesser General Public License|
|[Lua](https://github.com/lua/lua)|5.4.8|PUC-Rio|MIT License|
|[msgpack](https://github.com/msgpack/msgpack-c)|3.1.1|Sadayuki Furuhashi|Boost Software License version 1.0|
|[nlohmann](https://github.com/nlohmann/json)|3.11.2|Niels Lohmann|MIT License|
|[OpenSSL](https://github.com/openssl/openssl)|3.5.1|OpenSSL Software Foundation|Apache 2.0 License|
|[pacman](https://gitlab.archlinux.org/pacman/pacman)|5.2.2|Judd Vinet|GNU Public License version 2|
|[popt](https://github.com/rpm-software-management/popt)|1.16|Jeff Johnson & Erik Troan|MIT License|
|[procps](https://gitlab.com/procps-ng/procps)|2.8.3|Brian Edmonds et al.|GNU Lesser General Public License|
|[RocksDB](https://github.com/facebook/rocksdb/)|8.3.2|Facebook Inc.|Apache 2.0 License|
|[rpm](https://github.com/rpm-software-management/rpm)|4.20.1|Marc Ewing & Erik Troan|GNU Public License version 2|
|[simdjson](https://github.com/simdjson/simdjson)|3.13.0|Daniel Lemire|Apache License 2.0|
|[sqlite](https://github.com/sqlite/sqlite)|3.50.4|D. Richard Hipp|Public Domain (no restrictions)|
|[zlib](https://github.com/madler/zlib)|1.3.1|Jean-loup Gailly & Mark Adler|zlib/libpng License|

* [PyPi packages](framework/requirements.txt)

## Documentation

* [Full documentation](http://documentation.wazuh.com)
* [Wazuh installation guide](https://documentation.wazuh.com/current/installation-guide/index.html)

## Get involved

Become part of the [Wazuh's community](https://wazuh.com/community/) to learn from other users, participate in discussions, talk to our developers and contribute to the project.

If you want to contribute to our project please don’t hesitate to make pull-requests, submit issues or send commits, we will review all your questions.

You can also join our [Slack community channel](https://wazuh.com/community/join-us-on-slack/) and [mailing list](https://groups.google.com/d/forum/wazuh) by sending an email to [wazuh+subscribe@googlegroups.com](mailto:wazuh+subscribe@googlegroups.com), to ask questions and participate in discussions.

Stay up to date on news, releases, engineering articles and more.

* [Wazuh website](http://wazuh.com)
* [Linkedin](https://www.linkedin.com/company/wazuh)
* [YouTube](https://www.youtube.com/c/wazuhsecurity)
* [Twitter](https://twitter.com/wazuh)
* [Wazuh blog](https://wazuh.com/blog/)
* [Slack announcements channel](https://wazuh.com/community/join-us-on-slack/)

## Authors

Wazuh Copyright (C) 2015-2023 Wazuh Inc. (License GPLv2)

Based on the OSSEC project started by Daniel Cid.



================================================
FILE: BUGS
================================================
WAZUH
Copyright (C) 2015, Wazuh Inc.

Based on OSSEC
Copyright (C) 2014 Trend Micro Inc.


** Reporting bugs **

Bugs should be sent to the Wazuh mailling list
(https://groups.google.com/forum/#!forum/wazuh). Please, make sure to include
the following information:

-Output of "WAZUH_HOME/bin/wazuh-control info"
-Content of WAZUH_HOME/etc/<wazuh configuration file>
-Content of WAZUH_HOME/logs/<wazuh log file>
-Operating system name/version (uname -a if Unix)
-Any other relevant information.


If you prefer to contact us privately or want to report a
security issue, send an e-mail to Wazuh (support@wazuh.com).



================================================
FILE: CONFIG
================================================
WAZUH
Copyright (C) 2015, Wazuh Inc.

Based on OSSEC
Copyright (C) 2014 Trend Micro Inc.


= Information about Wazuh =

Visit https://www.wazuh.com


= Recommended Installation =

See INSTALL


== Configuring Wazuh ==

Just follow the steps from the install.sh script.
More information at
https://documentation.wazuh.com



================================================
FILE: CONTRIBUTORS
================================================
OSSEC
Copyright (C) 2014 Trend Micro Inc.

Many thanks to everyone who contributed and helped with
the ossec project. Below is the list of all the people
who helped us since our first release (0.1).
(if you feel you should be here, but it is not, let us know).

-Development
  - Daniel B. Cid <dcid@ossec.net>
  - Jeremy Rossi <jeremy@jeremyrossi.com>
  - Michael Starks
  - Dan Parriott <ddpbsd@gmail.com>
  - Meir Michanie <meirgotroot@gmail.com>
  - Slava Semushin <php-coder@altlinux.org>
  - Ahmet Ozturk <oahmet@metu.edu.tr>
  - Scott R. Shinn
  - George Kargiotakis
  - Jason Stelzer
  - Xavier Mertens
  - Stjepan Gros
  - Brad Lhotsky
  - cmlara
  - Christian Gottsche <cgzones@googlemail.com>
  - Dominic
  - JB Cheng <jjoobbcc@gmail.com>
  - Cristobel <rosa@alienvault>
  - jp.zurbrugg
  - Bil Hays <bil_hays@unc.edu>
  - Andrew Widdersheim <awiddersheim@hotmail.com>
  - Wouter Clarie <wclarie@gmail.com>
  - Mario Weigel
  - Christian Beer <christian.beer@posteo.de>
  - Gael Muller <gael.muller@sekoia.fr>
  - Ky-Anh Huynh <z1y@theslinux.org>
  - Dan Garthwaite <dan@garthwaite.org>
  - Lance A. Brown <lance@bearcircle.net>
  - danpop60 <dan.pop@eservglobal.com>
  - Martin DiViaio <martindiv@yahoo.com>
  - Michael Boyd <denied39@gmail.com>
  - ibatten <igb+github@batten.eu.org>
  - rhelfter <rhelfter@yahoo.com>
  - Peter Drake <peter.drake@acquia.com>
  - Mikey Austin <mikey@ayuda.com.au>
  - Harshil Mathur <harshilmathur@gmail.com>
  - Ryan Schulze <ryan@dopefish.de>
  - navtej <n.s.buttar+github@gmail.com>
  - Hakisho Nukama <nukama@gmail.com>
  - Danny Fullerton <northox@mantor.org>
  - Justin Gerace <jgrace103@gmail.com>
  - jknockaert <jasper@knockaert.nl>
  - Jason Stelzer <jason.stelzer@gmail.com>
  - Antonio Querubin <tony@lavanauts.org>
  - Santiago Bassett <santiago.bassett@gmail.com>
  - Pedro Sanchez <snaowxt@gmail.com>

-Testing/Patches Rules and other contributions.
  - Cédric Bleimling <cedri@dryades.org
  - Dean Takemori <dtakemori@thdfsg.com>
  - Sebastien Tricaud <toady@gscore.org>
  - Jeff Schroeder <jeffschroeder@computer.org>
  - Giannis Vrentzos <gvre@gvre.gr>
  - Peter Ahlert <peter@ifup.de>
  - Rafael Capovilla <under@underlinux.com.br>
  - Andre Alexandre Gaio <aagaio@linwork.com.br>
  - Liliane A. Cid <liliane.cid@gmail.com>
  - Marcus Maciel <marcus@underlinux.com.br>
  - Stephen Kreusch <stephen.kreusch@gmail.com>
  - Kayvan A. Sylvan <kayvan@sylvan.com>
  - Dianzhi Wang <wangdz@leadsec.com.cn>
  - Meir Michanie <meirgotroot@gmail.com>
  - Stephen Bunn <sbunn@roguesoftware.net>
  - Jonathan Scheidell <jscheidell@secnap.net>
  - |SaMaN| <saman@ttnet.net.tr>
  - ChuckD <mdmonk@gmail.com>
  - David J. Bianco <david at vorant.com>
  - Ivan Lotina <lotke@lotke.com>
  - Robert Millan [ackstorm] <rmillan@ackstorm.es>
  - Martin West <martin@objectgizmos.com>
  - Rafael Capovilla <under@underlinux.com.br>
  - Florian Crouzqat
  - Danny Fullerton
  - Jeremy Hanmer
  - Pepe Sanz
  - Kat Fitzgerald
  - Regis Houssin
  - carlopmart
  - Ash Kumar
  - Alexandro Silva
  - Mike Downey <michael.downey01@gmail.com>
  - Hai Nguyen <hainguyen@uns.vn>
  - Jeffrey Jackson <jeffreyclarkejackson@gmail.com>
  - Ben Chavet <ben.chavet@lullabot.com>
  - Bill Parker <wp02855@gmail.com>
  - Schnaffon <schnaffon@hotmail.fr>
  - Ralf Spenneberg <ralf@os-t.de>
  - Darren Worrall <darren@iweb.co.uk>
  - aalberdi <aalberdi@indra.es>


-Translations

  -Dutch:
  - Martijn de Boer <martijn@oceanius.com>

  -Serbian:
  - Maja Michanie <majam@riunx.com>

  -Portuguese:
  - Daniel Barcellos <danielpoa.rs@gmail.com>
  - Allan Soares <allan.soares@gmail.com>
  - Willian Itiho Amano <itihoitiho@gmail.com>
  - Liliane Cid <liliane.cid@gmail.com>

  -German:
  - Peter Ahlert <peter@ifup.de>

  -Turkish
  - Ahmet Ozturk <oahmet@metu.edu.tr>

  -Polish
  - Dziankowski Krzysztof <odpadki@poczta.onet.pl>

  -Italian
  - Alberto Furia <straluna@email.it>

  -French
  - Yves Bigliazzi <yves.bigliazzi@gmail.com>

  -Japanese
  - Kuzuno Hiroki <kuzuno@gmail.com>

  -Russian
  - Yuri Slobodyanyuk <yurisk@inbox.ru>

  -Spanish
  - Meir Michanie <meirgotroot@gmail.com>

  -Chinese
  - Brian Wang <junchangwang@gmail.com>



================================================
FILE: INSTALL
================================================
WAZUH
Copyright (C) 2015, Wazuh Inc.

Based on OSSEC
Copyright (C) 2014 Trend Micro Inc.


= Information about OSSEC =

Visit https://www.wazuh.com


= Recommended Installation =

OSSEC installation is very simple. It can be done in the
fast way (using the script install.sh with the default values)
or in the customized way (by hand or by changing the default values
in the install.sh script). I REALLY recommend EVERYONE to use the
FAST WAY! Only developers or experienced people should use the
other methods.

Fast way steps:

1- Run the script ./install.sh. It will guide you through the
   installation process.

2- The script will create everything in /var/ossec and try to
   create the initialization script in your system (/etc/rc.local
   or /etc/rc.d/init.d/ossec). If the init script is not created,
   make sure to follow the instructions from the install.sh to make
   OSSEC HIDS start during the boot. To start it by hand, just run
   /var/ossec/bin/wazuh-control start

3- If you are running it on multiple clients, make sure to install
   the server first. Use the manage_agents tool
   to create the right encryption keys.

4- Enjoy.


= Installation and Running (99.99% should read ABOVE) =


By Hand Installation steps:

1- Create the necessary directories (by default /var/ossec).
2- Move the necessary files to the ossec directory.
3- Compile everything.
4- Move the binaries to the default directory.
5- Create the necessary users.
6- Set the right permissions to the files.


These 5 steps are done in the Makefile (see make server).

The Makefile read the options from the LOCATION file. Change
whatever you need from there.

To compile everything by yourself the following dependencies need to be installed:

- CentOS 6/7
   $> yum update
   $> yum install make gcc gcc-c++ policycoreutils-python automake autoconf libtool centos-release-scl devtoolset-7
   $> scl enable devtoolset-7 bash

- CentOS 8
   $> yum install make gcc gcc-c++ python3 python3-policycoreutils automake autoconf libtool
   $> rpm -i http://mirror.centos.org/centos/8/PowerTools/x86_64/os/Packages/libstdc++-static-8.3.1-5.1.el8.x86_64.rpm

- Debian/Ubuntu
   $> apt-get install python gcc g++ make libc6-dev curl policycoreutils automake autoconf libtool

The following step is common to all OSes:
- CMake 3.18 installation
   $> curl -OL http://packages.wazuh.com/utils/cmake/cmake-3.18.3.tar.gz && tar -zxf cmake-3.18.3.tar.gz
   $> cd cmake-3.18.3 && ./bootstrap --no-system-curl
   $> make -j$(nproc) && make install
   $> cd .. && rm -rf cmake-*

Note: `gcc/g++ 5.5` and `CMake 3.12.4` are the minimun required versions to be installed.

Under wazuh/src folder:
1- make deps
2- make TARGET=<agent|server> (Optional: DEBUG=1 TEST=1)

*Before running make server, make sure to have the necessary users created.*
*The Makefile will not do that.*

#EOF



================================================
FILE: install.sh
================================================
#!/bin/sh
# Copyright (C) 2015, Wazuh Inc.
# Installation script for Wazuh
# Author: Daniel B. Cid <daniel.cid@gmail.com>

### Looking up for the execution directory
cd `dirname $0`


### Looking for echo -n
ECHO="echo -n"
hs=`echo -n "a"`
if [ ! "X$hs" = "Xa" ]; then
    if [ -x /usr/ucb/echo ]; then
        ECHO="/usr/ucb/echo -n"
    elif [ -x /bin/echo ]; then
        ECHO="/bin/echo -n"
    else
        ECHO=echo
    fi
fi

# Initializing vars
SET_DEBUG=""

# Checking for command line arguments
for i in $*; do
    if [ "X$i" = "Xdebug" ]; then
        SET_DEBUG="debug"
    elif [ "X$i" = "Xbinary-install" ]; then
        USER_BINARYINSTALL="yes"
    elif [ "X$i" = "Xhelp" ]; then
        echo "$0 debug"
        echo "$0 binary-install"
        exit 1;
    fi
done

##########
# install()
##########
Install()
{
    echo ""
    echo "4- ${installing}"

    echo ""
    echo "DIR=\"${INSTALLDIR}\""

    # Changing Config.OS with the new C flags
    echo "CEXTRA=${CEXTRA}" >> ./src/Config.OS

    MAKEBIN=make
    ## Find make/gmake
    if [ "X$NUNAME" = "XOpenBSD" ]; then
          MAKEBIN=gmake
    elif [ "X$NUNAME" = "XFreeBSD" ]; then
          MAKEBIN=gmake
    elif [ "X$NUNAME" = "XNetBSD" ]; then
          MAKEBIN=gmake
    elif [ "X$NUNAME" = "XDragonflyBSD" ]; then
          MAKEBIN=gmake
    elif [ "X$NUNAME" = "XBitrig" ]; then
          MAKEBIN=gmake
    fi
    if [ $(grep "Alpine Linux" /etc/os-release > /dev/null  && echo 1) ]; then
        ALPINE_DEPS="EXTERNAL_SRC_ONLY=1"
    fi

    # On CentOS <= 5 we need to disable syscollector compilation
    OS_VERSION_FOR_SYSC="${DIST_NAME}"
    if ([ "X${OS_VERSION_FOR_SYSC}" = "Xrhel" ] || [ "X${OS_VERSION_FOR_SYSC}" = "Xcentos" ]) && [ ${DIST_VER} -le 5 ]; then
        AUDIT_FLAG="USE_AUDIT=no"
        MSGPACK_FLAG="USE_MSGPACK_OPT=no"
        if [ ${DIST_VER} -lt 5 ]; then
            SYSC_FLAG="DISABLE_SYSC=yes"
        fi
    fi

    # Makefile
    echo " - ${runningmake}"
    echo ""

    cd ./src

    # Binary install will use the previous generated code.
    if [ "X${USER_BINARYINSTALL}" = "X" ]; then
        # Download external libraries if missing
        [ -z "$(find external -mindepth 1 -maxdepth 1 -type d 2>/dev/null)" ] && ${MAKEBIN} deps ${ALPINE_DEPS} TARGET=${INSTYPE}

        if [ "X${OPTIMIZE_CPYTHON}" = "Xy" ]; then
            CPYTHON_FLAGS="OPTIMIZE_CPYTHON=yes"
        fi

        # Add DATABASE=pgsql or DATABASE=mysql to add support for database
        # alert entry
        ${MAKEBIN} TARGET=${INSTYPE} INSTALLDIR=${INSTALLDIR} ${SYSC_FLAG} ${MSGPACK_FLAG} ${AUDIT_FLAG} ${CPYTHON_FLAGS} -j${THREADS} build

        if [ $? != 0 ]; then
            cd ../
            catError "0x5-build"
        fi
    fi

    # If update, stop Wazuh
    if [ "X${update_only}" = "Xyes" ]; then
        echo "Stopping Wazuh..."
        UpdateStopOSSEC
    fi

    # Install
    InstallWazuh

    cd ../

    # Calling the init script to start Wazuh during boot
    runInit $INSTYPE ${update_only}
    runinit_value=$?

    # If update, start Wazuh
    if [ "X${update_only}" = "Xyes" ]; then
        WazuhUpgrade $INSTYPE
        # Update versions previous to Wazuh 1.2
        UpdateOldVersions
        echo "Starting Wazuh..."
        UpdateStartOSSEC
    fi

    if [ $runinit_value = 1 ]; then
        notmodified="yes"
    elif [ "X$START_WAZUH" = "Xyes" ]; then
        echo "Starting Wazuh..."
        UpdateStartOSSEC
    fi

}

##########
# UseSyscheck()
##########
UseSyscheck()
{
    # Integrity check config
    echo ""
    $ECHO "  3.2- ${runsyscheck} ($yes/$no) [$yes]: "
    if [ "X${USER_ENABLE_SYSCHECK}" = "X" ]; then
        read AS
    else
        AS=${USER_ENABLE_SYSCHECK}
    fi
    echo ""
    case $AS in
        $nomatch)
            echo "   - ${nosyscheck}."
            ;;
        *)
            SYSCHECK="yes"
            echo "   - ${yessyscheck}."
            ;;
    esac
}


##########
# UseRootcheck()
##########
UseRootcheck()
{
    # Rootkit detection configuration
    echo ""
    $ECHO "  3.3- ${runrootcheck} ($yes/$no) [$yes]: "

    if [ "X${USER_ENABLE_ROOTCHECK}" = "X" ]; then
        read ES
    else
        ES=${USER_ENABLE_ROOTCHECK}
    fi

    echo ""
    case $ES in
        $nomatch)
            echo "   - ${norootcheck}."
            ;;
        *)
            ROOTCHECK="yes"
            echo "   - ${yesrootcheck}."
            ;;
    esac
}

UseSyscollector()
{
    # Syscollector config predefined (is overwritten by the preload-vars file)
    if [ "X${USER_ENABLE_SYSCOLLECTOR}" = "Xn" ]; then
        SYSCOLLECTOR="no"
     else
         SYSCOLLECTOR="yes"
     fi
}

UseSecurityConfigurationAssessment()
{
    # Configuration assessment config predefined (is overwritten by the preload-vars file)
    if [ "X${USER_ENABLE_SCA}" = "Xn" ]; then
        SECURITY_CONFIGURATION_ASSESSMENT="no"
     else
        SECURITY_CONFIGURATION_ASSESSMENT="yes"
     fi
}

UseSSLCert()
{
    if [ "X${USER_CREATE_SSL_CERT}" = "Xn" ]; then
        SSL_CERT="no"
    else
        SSL_CERT="yes"
    fi
}

UseUpdateCheck()
{
    # Update_check config predefined (is overwritten by the preload-vars file)
    if [ "X${USER_ENABLE_UPDATE_CHECK}" = "Xn" ]; then
        UPDATE_CHECK="no"
     else
        UPDATE_CHECK="yes"
     fi
}

##########
# EnableAuthd()
##########
EnableAuthd()
{
    # Authd config
    NB=$1
    echo ""
    $ECHO "  $NB - ${runauthd} ($yes/$no) [$yes]: "
    if [ "X${USER_ENABLE_AUTHD}" = "X" ]; then
        read AS
    else
        AS=${USER_ENABLE_AUTHD}
    fi
    echo ""
    case $AS in
        $nomatch)
            AUTHD="no"
            echo "   - ${norunauthd}."
            ;;
        *)
            AUTHD="yes"
            echo "   - ${yesrunauthd}."
            ;;
    esac
}

##########
# ConfigureBoot()
##########
ConfigureBoot()
{
    NB=$1
    if [ "X$INSTYPE" != "Xagent" ]; then

        echo ""
        $ECHO "  $NB- ${startwazuh} ($yes/$no) [$yes]: "

        if [ "X${USER_AUTO_START}" = "X" ]; then
            read ANSWER
        else
            ANSWER=${USER_AUTO_START}
        fi

        echo ""
        case $ANSWER in
            $nomatch)
                echo "   - ${nowazuhstart}"
                ;;
            *)
                START_WAZUH="yes"
                echo "   - ${yeswazuhstart}"
                ;;
        esac
    fi
}

##########
# SetupLogs()
##########
SetupLogs()
{
    NB=$1
    echo ""
    echo "  $NB- ${readlogs}"
    echo ""

    WriteLogs "echo"

    echo ""
    catMsg "0x106-logs"

    if [ "X$USER_NO_STOP" = "X" ]; then
        read ANY
    fi
}


##########
# ConfigureClient()
##########
ConfigureClient()
{
    echo ""
    echo "3- ${configuring} $NAME."
    echo ""

    if [ "X${USER_AGENT_MANAGER_IP}" = "X" -a "X${USER_AGENT_MANAGER_NAME}" = "X" ]; then
        # Looping and asking for manager ip or hostname
        while [ 1 ]; do
            $ECHO "  3.1- ${serveraddr}: "
                read ADDRANSWER
            # Is it an IP?
            echo $ADDRANSWER | grep -E "^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$" > /dev/null 2>&1
            if [ $? = 0 ]; then
                    echo ""
                SERVER_IP=$ADDRANSWER
                    echo "   - ${addingip} $IP"
                break;
            # Must be a name
            elif [ $? != 0 ]; then
                    echo ""
                HNAME=$ADDRANSWER
                    echo "   - ${addingname} $HNAME"
                break;
            fi
        done
    else
        SERVER_IP=${USER_AGENT_MANAGER_IP}
        HNAME=${USER_AGENT_MANAGER_NAME}
    fi

    # Syscheck?
    UseSyscheck

    # Rootcheck?
    UseRootcheck

    UseSyscollector

    UseSecurityConfigurationAssessment

    echo ""
    $ECHO "  3.5 - ${enable_ar} ($yes/$no) [$yes]: "

    if [ "X${USER_ENABLE_ACTIVE_RESPONSE}" = "X" ]; then
        read ANY
    else
        ANY=${USER_ENABLE_ACTIVE_RESPONSE}
    fi

    case $ANY in
        $nomatch)
            echo ""
            echo "   - ${noactive}."
            ;;
        *)
            ACTIVERESPONSE="yes"
            echo ""
            echo "   - ${yesactive}."
            ;;
    esac

    # Set up CA store
    catMsg "0x109-castore"
    AddCAStore

    # Set up the log files
    SetupLogs "3.7"

    # Write configuration
    WriteAgent
}

##########
# ConfigureServer()
##########
ConfigureServer()
{
    echo ""
    echo "3- ${configuring} $NAME."

    # Active response
    catMsg "0x107-ar"

    echo ""
    echo "   - ${defaultwhitelist}"

    for ip in ${NAMESERVERS} ${NAMESERVERS2};
    do
    if [ ! "X${ip}" = "X" -a ! "${ip}" = "0.0.0.0" ]; then
        echo "      - ${ip}"
    fi
    done

    AddWhite

    if [ "X$INSTYPE" = "Xmanager" ]; then
      # Configuring remote syslog
      echo ""
      $ECHO "  3.6- ${syslog} ($yes/$no) [$yes]: "

      if [ "X${USER_ENABLE_SYSLOG}" = "X" ]; then
        read ANSWER
      else
        ANSWER=${USER_ENABLE_SYSLOG}
      fi

      echo ""
      case $ANSWER in
        $nomatch)
            echo "   --- ${nosyslog}."
            ;;
        *)
            echo "   - ${yessyslog}."
            RLOG="yes"
            ;;
      esac

      # Configuring remote connections
      SLOG="yes"
    fi

    UseSSLCert

    # Setting up the auth daemon & logs
    if [ "X$INSTYPE" = "Xmanager" ]; then
        EnableAuthd "3.7"
        ConfigureBoot "3.8"
        SetupLogs "3.9"
        UseUpdateCheck
        WriteManager
    else
        ConfigureBoot "3.6"
        SetupLogs "3.7"
        WriteLocal
    fi
}

##########
# setInstallDir()
##########
setInstallDir()
{
    if [ "X${USER_DIR}" = "X" ]; then
        # If we don't have a value in USER_DIR, it means that the user
        # should specify the installation directory.
        while [ 1 ]; do
            echo ""
            $ECHO "2- ${wheretoinstall} [$INSTALLDIR]: "
            read ANSWER
            if [ ! "X$ANSWER" = "X" ]; then
                echo $ANSWER |grep -E "^/[a-zA-Z0-9./_-]{3,128}$">/dev/null 2>&1
                if [ $? = 0 ]; then
                    INSTALLDIR=$ANSWER;
                    break;
                fi
            else
                break;
            fi
        done
    else
        # This else statement handles the case in which it was determined that the installation
        # is an upgrade. So, the USER_DIR variable was previously set with the value of PREINSTALLEDDIR.
        # Another possibility is that USER_DIR could have been set before running the script in
        # order to run an unattended installation.
        INSTALLDIR=${USER_DIR}
    fi
}

##########
# setEnv()
##########
setEnv()
{
    echo ""
    echo "    - ${installat} ${INSTALLDIR} ."

    if [ "X$INSTYPE" = "Xagent" ]; then
        CEXTRA="$CEXTRA -DCLIENT"
    elif [ "X$INSTYPE" = "Xlocal" ]; then
        CEXTRA="$CEXTRA -DLOCAL"
    fi
}

##########
# askForDelete()
##########
askForDelete()
{
    if [ -d "$INSTALLDIR" ]; then
        if [ "X${USER_DELETE_DIR}" = "X" ]; then
            echo ""
            $ECHO "    - ${deletedir} ($yes/$no) [$no]: "
            read ANSWER
        else
            ANSWER=${USER_DELETE_DIR}
        fi

        case $ANSWER in
            $yesmatch)
                echo "      Stopping Wazuh..."
                UpdateStopOSSEC
                rm -rf $INSTALLDIR
                if [ ! $? = 0 ]; then
                    echo "Error deleting ${INSTALLDIR}"
                    exit 2;
                fi
                ;;
        esac
    fi
}

##########
# AddWhite()
##########
AddWhite()
{
    while [ 1 ]
    do
        echo ""
        $ECHO "   - ${addwhite} ($yes/$no)? [$no]: "

        # If white list is set, we don't need to ask it here.
        if [ "X${USER_WHITE_LIST}" = "X" ]; then
            read ANSWER
        else
            ANSWER=${USER_WHITE_LIST}
        fi

        if [ "X${ANSWER}" = "X" ] ; then
            ANSWER=$no
        fi

        case $ANSWER in
            $no)
                break;
                ;;
            *)
                SET_WHITE_LIST="true"
                $ECHO "   - ${ipswhite}"
                if [ "X${USER_WHITE_LIST}" = "X" ]; then
                    read IPS
                else
                    IPS=${USER_WHITE_LIST}
                fi

                break;
                ;;
        esac
    done
}

##########
# AddCAStore()
##########
AddCAStore()
{
    while [ 1 ]
    do
        echo ""
        $ECHO "   - ${addcastore} ($yes/$no)? [$no]: "

        # If white list is set, we don't need to ask it here.
        if [ "X${USER_CA_STORE}" = "X" ]; then
            read ANSWER
        else
            ANSWER=${USER_CA_STORE}
        fi

        if [ "X${ANSWER}" = "X" ] ; then
            ANSWER=$no
        fi

        case $ANSWER in
            $no)
                break;
                ;;
            *)
                SET_CA_STORE="true"
                $ECHO "   - ${castore}"
                if [ "X${USER_CA_STORE}" = "X" ]; then
                    read CA_STORE
                else
                    CA_STORE=${USER_CA_STORE}
                fi

                break;
                ;;
        esac
    done

    # Check the certificate

    if [ -n "$CA_STORE" ]
    then
        if [ -f $CA_STORE ]
        then
            if hash openssl 2>&1 > /dev/null && [ $(date -d "$(openssl x509 -enddate -noout -in $CA_STORE | cut -d = -f 2)" +%s) -lt $(date +%s) ]
            then
                echo ""
                echo "     Warning: the certificate at \"$CA_STORE\" is expired."
            fi
        elif [ ! -d $CA_STORE ]
        then
            echo ""
            echo "     Warning: No such file or directory \"$CA_STORE\"."
        fi
    fi
}


##########
# AddPFTable()
##########
AddPFTable()
{
    #default pf rules
    TABLE="wazuh_fwtable"

    # Add table to the first line
    echo ""
    echo "   - ${pfmessage}:"
    echo "     ${moreinfo}"
    echo "     https://documentation.wazuh.com"

    echo ""
    echo ""
    echo "      table <${TABLE}> persist #$TABLE "
    echo "      block in quick from <${TABLE}> to any"
    echo "      block out quick from any to <${TABLE}>"
    echo ""
    echo ""

}

##########
# main()
##########
main()
{
    LG="en"
    LANGUAGE="en"
    . ./src/init/dist-detect.sh
    . ./src/init/shared.sh
    . ./src/init/functions.sh

    # Reading pre-defined file
    if [ ! `isFile ${PREDEF_FILE}` = "${FALSE}" ]; then
        . ${PREDEF_FILE}
    fi

    # If user language is not set

    if [ "X${USER_LANGUAGE}" = "X" ]; then

        # Choosing the language.
        while [ 1 ]; do
        echo ""
        for i in `ls ${TEMPLATE}`; do
            # ignore CVS (should not be there anyways and config)
            if [ "$i" = "CVS" -o "$i" = "config" ]; then continue; fi
            cat "${TEMPLATE}/$i/language.txt"
            if [ ! "$i" = "en" ]; then
                LG="${LG}/$i"
            fi
        done
        $ECHO "  (${LG}) [en]: "
        read USER_LG;

        if [ "X${USER_LG}" = "X" ]; then
            USER_LG="en"
        fi

        if [ -d "${TEMPLATE}/${USER_LG}" ]; then
            break;
        fi
        done;

        LANGUAGE=${USER_LG}

    else

        # If provided language is not valid, default to english
        if [ -d "${TEMPLATE}/${USER_LANGUAGE}" ]; then
            LANGUAGE=${USER_LANGUAGE}
        else
            LANGUAGE="en"
        fi

    fi # for USER_LANGUAGE

    . ./src/init/language.sh
    . ./src/init/init.sh
    . ./src/init/wazuh/wazuh.sh
    . ${TEMPLATE}/${LANGUAGE}/messages.txt
    . ./src/init/inst-functions.sh
    . ./src/init/template-select.sh

    # Must be executed as ./install.sh
    if [ `isFile ${VERSION_FILE}` = "${FALSE}" ]; then
        catError "0x1-location";
    fi

    # Must be root
    if [ ! "X$ME" = "Xroot" ]; then
        catError "0x2-beroot";
    fi

    if [ "X$USER_NO_STOP" = "X" ]; then
        clear 2> /dev/null
    fi

    # Initial message
    echo " $NAME $VERSION (Rev. $REVISION) ${installscript} - https://www.wazuh.com"
    catMsg "0x101-initial"
    echo ""
    echo "  - $system: $UNAME (${DIST_NAME} ${DIST_VER}.${DIST_SUBVER})"
    echo "  - $user: $ME"
    echo "  - $host: $HOST"
    echo ""
    echo ""
    echo "  -- $hitanyorabort --"

    if [ "X$USER_NO_STOP" = "X" ]; then
        read ANY
    fi

    . ./src/init/update.sh

    # Setting up the installation type
    hybrid="hybrid"
    HYBID=""
    hybridm=`echo ${hybrid} | cut -b 1`
    serverm=`echo ${server} | cut -b 1`
    localm=`echo ${local} | cut -b 1`
    agentm=`echo ${agent} | cut -b 1`
    helpm=`echo ${help} | cut -b 1`

    # If user install type is not set, ask for it.
    if [ "X${USER_INSTALL_TYPE}" = "X" ]; then

        # Loop for the installation options
        while [ 1 ]
        do
            echo ""
            $ECHO "1- ${whattoinstall} "

            read ANSWER
            case $ANSWER in

                ${helpm}|${help})
                    catMsg "0x102-installhelp"
                ;;

                ${server}|${serverm}|"manager"|"m")
                    echo ""
                    echo "  - ${serverchose}."
                    INSTYPE="manager"
                    break;
                ;;

                ${agent}|${agentm}|"a")
                    echo ""
                    echo "  - ${clientchose}."
                    INSTYPE="agent"
                    break;
                ;;

                ${hybrid}|${hybridm})
                    echo ""
                    echo "  - ${serverchose} (hybrid)."
                    INSTYPE="manager"
                    HYBID="go"
                    break;
                ;;
                ${local}|${localm})
                    echo ""
                    echo "  - ${localchose}."
                    INSTYPE="local"
                    break;
                ;;
            esac
        done

    else
        INSTYPE=${USER_INSTALL_TYPE}
    fi

    # Is this an update? (only for the selected installation type)
    if [ "X${USER_CLEANINSTALL}" = "X" ]; then
        if [ "X$INSTYPE" = "Xagent" ]; then
            pidir_service_name="wazuh-agent"
        else
            pidir_service_name="wazuh-manager"
        fi

        if getPreinstalledDirByType; then
            if isWazuhInstalled "$PREINSTALLEDDIR"; then
                PRE_TYPE=$(getPreinstalledType)
                if [ "X$INSTYPE" = "Xagent" ] && [ "X$PRE_TYPE" != "Xagent" ]; then
                    PREINSTALLEDDIR=""
                elif [ "X$INSTYPE" != "Xagent" ] && [ "X$PRE_TYPE" = "Xagent" ]; then
                    PREINSTALLEDDIR=""
                fi
            else
                PREINSTALLEDDIR=""
            fi
        else
            PREINSTALLEDDIR=""
        fi

        if [ "X$PREINSTALLEDDIR" != "X" ]; then
            echo ""
            ct="1"
            while [ $ct = "1" ]; do
                ct="0"
                $ECHO " - ${wanttoupdate} ($yes/$no): "
                if [ "X${USER_UPDATE}" = "X" ]; then
                    read ANY
                else
                    ANY=$yes
                fi

                case $ANY in
                    $yes)
                        update_only="yes"
                        break;
                        ;;
                    $no)
                        echo ""
                        echo "${mustuninstall}"
                        exit 0;
                        ;;
                      *)
                        ct="1"
                        ;;
                esac
            done


            # Do some of the update steps.
            if [ "X${update_only}" = "Xyes" ]; then
                . ./src/init/update.sh

                if [ "`doUpdatecleanup`" = "${FALSE}" ]; then
                    # Disabling update
                    echo ""
                    echo "${unabletoupdate}"
                    sleep 5;
                    update_only=""
                else
                    # Get update
                    USER_DIR="$PREINSTALLEDDIR"
                    USER_INSTALL_TYPE=`getPreinstalledType`
                    USER_OLD_VERSION=`getPreinstalledVersion`
                    USER_OLD_NAME=`getPreinstalledName`

                    if [ "X${USER_INSTALL_TYPE}" = "X" ]; then
                        USER_INSTALL_TYPE="${INSTYPE}"
                    fi

                    # Validate upgrade constraints for Wazuh 5.0.0
                    if [ -n "$USER_OLD_VERSION" ]; then
                        OLD_MAJOR=$(echo "$USER_OLD_VERSION" | sed 's/^v//' | cut -d. -f1)
                        OLD_MINOR=$(echo "$USER_OLD_VERSION" | sed 's/^v//' | cut -d. -f2)

                        UPGRADE_BLOCKED="no"
                        ERROR_MESSAGE=""

                        if [ "$USER_INSTALL_TYPE" = "agent" ]; then
                            # Agent: Block upgrades from < 4.14.0
                            if [ -n "$OLD_MAJOR" ] && [ -n "$OLD_MINOR" ]; then
                                if [ "$OLD_MAJOR" -lt 4 ] || { [ "$OLD_MAJOR" -eq 4 ] && [ "$OLD_MINOR" -lt 14 ]; }; then
                                    UPGRADE_BLOCKED="yes"
                                    ERROR_MESSAGE="Current version: $USER_OLD_VERSION
Target version:  5.0.0

Upgrade to Wazuh 5.0.0 is only supported from version 4.14.0 or later."
                                fi
                            fi
                        else
                            # Manager: Block all upgrades from 4.x
                            if [ -n "$OLD_MAJOR" ] && [ "$OLD_MAJOR" -lt 5 ]; then
                                UPGRADE_BLOCKED="yes"
                                ERROR_MESSAGE="Current version: $USER_OLD_VERSION
Target version:  5.0.0

Upgrade to Wazuh 5.0.0 is not supported from version 4.x.
A clean installation is required for managers."
                            fi
                        fi

                        if [ "$UPGRADE_BLOCKED" = "yes" ]; then
                            echo ""
                            echo "═════════════════════════════════════════════════════════════════"
                            echo "  UPGRADE BLOCKED: Incompatible version detected"
                            echo "═════════════════════════════════════════════════════════════════"
                            echo ""
                            echo "$ERROR_MESSAGE"
                            echo ""
                            echo "Required action:"
                            if [ "$USER_INSTALL_TYPE" = "agent" ]; then
                                echo "  1. Upgrade to version 4.14.0 or later first"
                                echo "  2. Then upgrade to 5.0.0"
                            else
                                echo "  1. Backup your configuration"
                                echo "  2. Perform a clean installation of 5.0.0"
                                echo "  3. Restore your configuration"
                            fi
                            echo ""
                            echo "For more information, visit:"
                            echo "  https://documentation.wazuh.com/current/upgrade-guide/"
                            echo "═════════════════════════════════════════════════════════════════"
                            echo ""
                            exit 1
                        fi
                    fi

                ct="1"

                # We dont need to update the rules on agent installs
                if [ "X${USER_INSTALL_TYPE}" = "Xagent" ]; then
                    ct="0"
                fi

                fi
            fi
        fi
    fi

    # Adjust default install dir by installation type when not overridden
    if [ -z "${USER_DIR}" ]; then
        if [ "X$INSTYPE" = "Xagent" ]; then
            INSTALLDIR="/var/ossec"
        else
            INSTALLDIR="/var/wazuh-manager"
        fi
    fi

    # Setting up the installation directory
    setInstallDir

    # Setting up the environment
    setEnv

    # Ask to remove the current installation if exists
    askForDelete

    # Configuring the system (based on the installation type)
    if [ "X${update_only}" = "X" ]; then
        if [ "X$INSTYPE" = "Xmanager" ]; then
            ConfigureServer
        elif [ "X$INSTYPE" = "Xagent" ]; then
            ConfigureClient
        elif [ "X$INSTYPE" = "Xlocal" ]; then
            ConfigureServer
        else
            catError "0x4-installtype"
        fi
    fi

    # Installing (calls the respective script
    # -- InstallAgent.sh or InstallServer.sh
    Install

    # User messages
    control_script="wazuh-control"
    if [ "X$INSTYPE" = "Xmanager" ]; then
        control_script="wazuh-manager-control"
    fi
    echo ""
    echo " - ${configurationdone}."
    echo ""
    echo " - ${tostart}:"
    echo "      $INSTALLDIR/bin/${control_script} start"
    echo ""
    echo " - ${tostop}:"
    echo "      $INSTALLDIR/bin/${control_script} stop"
    echo ""
    echo " - ${configat} $INSTALLDIR/etc/${WAZUH_CONF}"
    echo ""


    catMsg "0x103-thanksforusing"


    if [ "X${update_only}" = "Xyes" ]; then
        # Message for the update
        if [ "X`sh ./src/init/fw-check.sh`" = "XPF" ]; then
            if [ "X$USER_NO_STOP" = "X" ]; then
                read ANY
            fi
            AddPFTable
        fi
        echo ""

        # If version < wazuh 1.2
        if [ "X$USER_OLD_NAME" != "XWazuh" ]; then
            echo " ====================================================================================="
            echo "  ${update_rev_newconf1}"
            echo "  ${update_rev_newconf2}"
            echo " ====================================================================================="
            echo " "
        fi
        echo " - ${updatecompleted}"
        echo ""
        exit 0;
    fi


    if [ "X$USER_NO_STOP" = "X" ]; then
        read ANY
    fi


    # PF firewall message
    if [ "X`sh ./src/init/fw-check.sh`" = "XPF" ]; then
        AddPFTable
    fi


    if [ "X$INSTYPE" = "Xmanager" ]; then
        echo ""
        echo " - ${addserveragent}"
        echo ""
        echo "   ${moreinfo}"
        echo "   https://documentation.wazuh.com/"
        echo ""

    elif [ "X$INSTYPE" = "Xagent" ]; then
        echo ""
        echo " - ${moreinfo}"
        echo "   https://documentation.wazuh.com/"
        echo ""
    fi

    if [ "X$notmodified" = "Xyes" ]; then
        catMsg "0x105-noboot"
        echo "      $INSTALLDIR/bin/${control_script} start"
        echo ""
    fi
}

_f_cfg="./install.cfg.sh"

if [ -f $_f_cfg ]; then
  . $_f_cfg
fi

### Calling main function where everything happens
main


if [ "x$HYBID" = "xgo" ]; then
    echo "   --------------------------------------------"
    echo "   Finishing Hybrid setup (agent configuration)"
    echo "   --------------------------------------------"
    echo 'USER_LANGUAGE="en"' > ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_NO_STOP="y"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_INSTALL_TYPE="agent"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo "USER_DIR=\"$INSTALLDIR/ossec-agent\"" >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_ENABLE_ROOTCHECK="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_ENABLE_SYSCHECK="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_ENABLE_SYSCOLLECTOR="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_ENABLE_SCA="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_CREATE_SSL_CERT="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_ENABLE_ACTIVE_RESPONSE="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_UPDATE="n"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf
    echo 'USER_CLEANINSTALL="y"' >> ./etc/preloaded-vars.conf
    echo "" >> ./etc/preloaded-vars.conf

   cd src && ${MAKEBIN} clean && cd ..
   ./install.sh
   rm etc/preloaded-vars.conf
fi

exit 0

#### exit ? ###



================================================
FILE: LICENSE
================================================

 Portions Copyright (C) 2015, Wazuh Inc.
 Based on work Copyright (C) 2003 - 2013 Trend Micro, Inc.

 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License (version 2) as
 published by the FSF - Free Software Foundation.

 In addition, certain source files in this program permit linking with the
 OpenSSL library (http://www.openssl.org), which otherwise wouldn't be allowed
 under the GPL.  For purposes of identifying OpenSSL, most source files giving
 this permission limit it to versions of OpenSSL having a license identical to
 that listed in this file (see section "OpenSSL LICENSE" below). It is not
 necessary for the copyright years to match between this file and the OpenSSL
 version in question.  However, note that because this file is an extension of
 the license statements of these source files, this file may not be changed
 except with permission from all copyright holders of source files in this
 program which reference this file.

 Note that this license applies to the source code, as well as
 decoders, rules and any other data file included with Wazuh (unless
 otherwise specified).

 For the purpose of this license, we consider an application to constitute a
 "derivative work" or a work based on this program if it does any of the
 following (list not exclusive):

  * Integrates source code/data files from Wazuh.
  * Includes Wazuh copyrighted material.
  * Includes/integrates Wazuh into a proprietary executable installer.
  * Links to a library or executes a program that does any of the above.

 This list is not exclusive, but just a clarification of our interpretation
 of derived works. These restrictions only apply if you actually redistribute
 Wazuh (or parts of it).

 We don't consider these to be added restrictions on top of the GPL,
 but just a clarification of how we interpret "derived works" as it
 applies to Wazuh. This is similar to the way Linus Torvalds has
 announced his interpretation of how "derived works" applies to Linux kernel
 modules. Our interpretation refers only to Wazuh - we don't speak
 for any other GPL products.

  * As a special exception, the copyright holders give
  * permission to link the code of portions of this program with the
  * OpenSSL library under certain conditions as described in each
  * individual source file, and distribute linked combinations
  * including the two.
  * You must obey the GNU General Public License in all respects
  * for all of the code used other than OpenSSL.  If you modify
  * file(s) with this exception, you may extend this exception to your
  * version of the file(s), but you are not obligated to do so.  If you
  * do not wish to do so, delete this exception statement from your
  * version.  If you delete this exception statement from all source
  * files in the program, then also delete it here.

 Wazuh HIDS is distributed in the hope that it will be useful, but WITHOUT
 ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE.
 See the GNU General Public License Version 2 below for more details.

-----------------------------------------------------------------------------

		    GNU GENERAL PUBLIC LICENSE
		       Version 2, June 1991

 Copyright (C) 1989, 1991 Free Software Foundation, Inc.,
 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

			    Preamble

  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
License is intended to guarantee your freedom to share and change free
software--to make sure the software is free for all its users.  This
General Public License applies to most of the Free Software
Foundation's software and to any other program whose authors commit to
using it.  (Some other Free Software Foundation software is covered by
the GNU Lesser General Public License instead.)  You can apply it to
your programs, too.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
this service if you wish), that you receive source code or can get it
if you want it, that you can change the software or use pieces of it
in new free programs; and that you know you can do these things.

  To protect your rights, we need to make restrictions that forbid
anyone to deny you these rights or to ask you to surrender the rights.
These restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must give the recipients all the rights that
you have.  You must make sure that they, too, receive or can get the
source code.  And you must show them these terms so they know their
rights.

  We protect your rights with two steps: (1) copyright the software, and
(2) offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

  Also, for each author's protection and ours, we want to make certain
that everyone understands that there is no warranty for this free
software.  If the software is modified by someone else and passed on, we
want its recipients to know that what they have is not the original, so
that any problems introduced by others will not reflect on the original
authors' reputations.

  Finally, any free program is threatened constantly by software
patents.  We wish to avoid the danger that redistributors of a free
program will individually obtain patent licenses, in effect making the
program proprietary.  To prevent this, we have made it clear that any
patent must be licensed for everyone's free use or not licensed at all.

  The precise terms and conditions for copying, distribution and
modification follow.

		    GNU GENERAL PUBLIC LICENSE
   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION

  0. This License applies to any program or other work which contains
a notice placed by the copyright holder saying it may be distributed
under the terms of this General Public License.  The "Program", below,
refers to any such program or work, and a "work based on the Program"
means either the Program or any derivative work under copyright law:
that is to say, a work containing the Program or a portion of it,
either verbatim or with modifications and/or translated into another
language.  (Hereinafter, translation is included without limitation in
the term "modification".)  Each licensee is addressed as "you".

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

  1. You may copy and distribute verbatim copies of the Program's
source code as you receive it, in any medium, provided that you
conspicuously and appropriately publish on each copy an appropriate
copyright notice and disclaimer of warranty; keep intact all the
notices that refer to this License and to the absence of any warranty;
and give any other recipients of the Program a copy of this License
along with the Program.

You may charge a fee for the physical act of transferring a copy, and
you may at your option offer warranty protection in exchange for a fee.

  2. You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:

    a) You must cause the modified files to carry prominent notices
    stating that you changed the files and the date of any change.

    b) You must cause any work that you distribute or publish, that in
    whole or in part contains or is derived from the Program or any
    part thereof, to be licensed as a whole at no charge to all third
    parties under the terms of this License.

    c) If the modified program normally reads commands interactively
    when run, you must cause it, when started running for such
    interactive use in the most ordinary way, to print or display an
    announcement including an appropriate copyright notice and a
    notice that there is no warranty (or else, saying that you provide
    a warranty) and that users may redistribute the program under
    these conditions, and telling the user how to view a copy of this
    License.  (Exception: if the Program itself is interactive but
    does not normally print such an announcement, your work based on
    the Program is not required to print an announcement.)

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

  3. You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:

    a) Accompany it with the complete corresponding machine-readable
    source code, which must be distributed under the terms of Sections
    1 and 2 above on a medium customarily used for software interchange; or,

    b) Accompany it with a written offer, valid for at least three
    years, to give any third party, for a charge no more than your
    cost of physically performing source distribution, a complete
    machine-readable copy of the corresponding source code, to be
    distributed under the terms of Sections 1 and 2 above on a medium
    customarily used for software interchange; or,

    c) Accompany it with the information you received as to the offer
    to distribute corresponding source code.  (This alternative is
    allowed only for noncommercial distribution and only if you
    received the program in object code or executable form with such
    an offer, in accord with Subsection b above.)

The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

  4. You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

  5. You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

  6. Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

  7. If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

  8. If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

  9. The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and "any
later version", you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

  10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.

			    NO WARRANTY

  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.

  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.

		     END OF TERMS AND CONDITIONS


-------------------------------------------------------------------------------

OpenSSL License
---------------

  LICENSE ISSUES
  ==============

  The OpenSSL toolkit stays under a dual license, i.e. both the conditions of
  the OpenSSL License and the original SSLeay license apply to the toolkit.
  See below for the actual license texts. Actually both licenses are BSD-style
  Open Source licenses. In case of any license issues related to OpenSSL
  please contact openssl-core@openssl.org.

  OpenSSL License
  ---------------

/* ====================================================================
 * Copyright (c) 1998-2001 The OpenSSL Project.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in
 *    the documentation and/or other materials provided with the
 *    distribution.
 *
 * 3. All advertising materials mentioning features or use of this
 *    software must display the following acknowledgment:
 *    "This product includes software developed by the OpenSSL Project
 *    for use in the OpenSSL Toolkit. (http://www.openssl.org/)"
 *
 * 4. The names "OpenSSL Toolkit" and "OpenSSL Project" must not be used to
 *    endorse or promote products derived from this software without
 *    prior written permission. For written permission, please contact
 *    openssl-core@openssl.org.
 *
 * 5. Products derived from this software may not be called "OpenSSL"
 *    nor may "OpenSSL" appear in their names without prior written
 *    permission of the OpenSSL Project.
 *
 * 6. Redistributions of any form whatsoever must retain the following
 *    acknowledgment:
 *    "This product includes software developed by the OpenSSL Project
 *    for use in the OpenSSL Toolkit (http://www.openssl.org/)"
 *
 * THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS'' AND ANY
 * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OpenSSL PROJECT OR
 * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 * ====================================================================
 *
 * This product includes cryptographic software written by Eric Young
 * (eay@cryptsoft.com).  This product includes software written by Tim
 * Hudson (tjh@cryptsoft.com).
 *
 */

 Original SSLeay License
 -----------------------

/* Copyright (C) 1995-1998 Eric Young (eay@cryptsoft.com)
 * All rights reserved.
 *
 * This package is an SSL implementation written
 * by Eric Young (eay@cryptsoft.com).
 * The implementation was written so as to conform with Netscapes SSL.
 *
 * This library is free for commercial and non-commercial use as long as
 * the following conditions are aheared to.  The following conditions
 * apply to all code found in this distribution, be it the RC4, RSA,
 * lhash, DES, etc., code; not just the SSL code.  The SSL documentation
 * included with this distribution is covered by the same copyright terms
 * except that the holder is Tim Hudson (tjh@cryptsoft.com).
 *
 * Copyright remains Eric Young's, and as such any Copyright notices in
 * the code are not to be removed.
 * If this package is used in a product, Eric Young should be given attribution
 * as the author of the parts of the library used.
 * This can be in the form of a textual message at program startup or
 * in documentation (online or textual) provided with the package.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *    "This product includes cryptographic software written by
 *     Eric Young (eay@cryptsoft.com)"
 *    The word 'cryptographic' can be left out if the routines from the library
 *    being used are not cryptographic related :-).
 * 4. If you include any Windows specific code (or a derivative thereof) from
 *    the apps directory (application code) you must include an acknowledgement:
 *    "This product includes software written by Tim Hudson (tjh@cryptsoft.com)"
 *
 * THIS SOFTWARE IS PROVIDED BY ERIC YOUNG ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * The licence and distribution terms for any publically available version or
 * derivative of this code cannot be changed.  i.e. this code cannot simply be
 * copied and put under another distribution licence
 * [including the GNU Public Licence.]
 */



================================================
FILE: SECURITY.md
================================================
# Wazuh Open Source Project Security Policy

Version: 2023-06-12

## Introduction
This document outlines the Security Policy for Wazuh's open source projects. It emphasizes our commitment to maintain a secure environment for our users and contributors, and reflects our belief in the power of collaboration to identify and resolve security vulnerabilities.

## Scope
This policy applies to all open source projects developed, maintained, or hosted by Wazuh.

## Reporting Security Vulnerabilities
If you believe you've discovered a potential security vulnerability in one of our open source projects, we strongly encourage you to report it to us responsibly.

Please submit your findings as security advisories under the "Security" tab in the relevant GitHub repository. Alternatively, you may send the details of your findings to [security@wazuh.com](mailto:security@wazuh.com).

## Vulnerability Disclosure Policy
Upon receiving a report of a potential vulnerability, our team will initiate an investigation. If the reported issue is confirmed as a vulnerability, we will take the following steps:

1. Acknowledgment: We will acknowledge the receipt of your vulnerability report and begin our investigation.
2. Validation: We will validate the issue and work on reproducing it in our environment.
3. Remediation: We will work on a fix and thoroughly test it
4. Release & Disclosure: After 90 days from the discovery of the vulnerability, or as soon as a fix is ready and thoroughly tested (whichever comes first), we will release a security update for the affected project. We will also publicly disclose the vulnerability by publishing a CVE (Common Vulnerabilities and Exposures) and acknowledging the discovering party.
5. Exceptions: In order to preserve the security of the Wazuh community at large, we might extend the disclosure period to allow users to patch their deployments.

This 90-day period allows for end-users to update their systems and minimizes the risk of widespread exploitation of the vulnerability.

## Automatic Scanning
We leverage GitHub Actions to perform automated scans of our supply chain. These scans assist us in identifying vulnerabilities and outdated dependencies in a proactive and timely manner.

## Credit
We believe in giving credit where credit is due. If you report a security vulnerability to us, and we determine that it is a valid vulnerability, we will publicly credit you for the discovery when we disclose the vulnerability. If you wish to remain anonymous, please indicate so in your initial report.

We do appreciate and encourage feedback from our community, but currently we do not have a bounty program. We might start bounty programs in the future.

## Compliance with this Policy
We consider the discovery and reporting of security vulnerabilities an important public service. We encourage responsible reporting of any vulnerabilities that may be found in our site or applications.

Furthermore, we will not take legal action against or suspend or terminate access to the site or services of those who discover and report security vulnerabilities in accordance with this policy because of the fact.

We ask that all users and contributors respect this policy and the security of our community's users by disclosing vulnerabilities to us in accordance with this policy.

## Changes to this Security Policy
This policy may be revised from time to time. Each version of the policy will be identified at the top of the page by its effective date.

If you have any questions about this Security Policy, please contact us at [security@wazuh.com](mailto:security@wazuh.com)


================================================
FILE: upgrade.sh
================================================
#!/bin/bash
# Copyright (C) 2015, Wazuh Inc.

# validate OS, linux or macos
if [ "X$(uname)" = "XLinux" ] ; then
    # Get Wazuh installation path
    SCRIPT=$(readlink -f "$0")
    WAZUH_HOME=$(dirname $(dirname $(dirname "$SCRIPT")))
    cd "${WAZUH_HOME}"
    (sleep 5 && chmod +x ./var/upgrade/*.sh && ./var/upgrade/pkg_installer.sh && find ./var/upgrade/* -not -name upgrade_result -delete) >/dev/null 2>&1 &
else
    (sleep 5 && chmod +x ./var/upgrade/*.sh && ./var/upgrade/pkg_installer.sh && find ./var/upgrade/ -mindepth 1 -not -name upgrade_result -delete) >/dev/null 2>&1 &
fi



================================================
FILE: VERSION.json
================================================
{
    "version": "5.0.0",
    "stage": "alpha0"
}


================================================
FILE: .clang-format
================================================
AlignAfterOpenBracket: Align
AlignConsecutiveMacros: 'true'
AlignConsecutiveAssignments: 'false'
AlignConsecutiveDeclarations: 'false'
AlignEscapedNewlines: Right
AlignOperands: 'true'
AlignTrailingComments: 'true'
AllowAllArgumentsOnNextLine: 'true'
AllowAllConstructorInitializersOnNextLine: 'true'
AllowAllParametersOfDeclarationOnNextLine: 'true'
AllowShortBlocksOnASingleLine: 'false'
AllowShortCaseLabelsOnASingleLine: 'true'
AllowShortFunctionsOnASingleLine: Empty
AllowShortIfStatementsOnASingleLine: Never
AllowShortLambdasOnASingleLine: Inline
AllowShortLoopsOnASingleLine: 'true'
AlwaysBreakBeforeMultilineStrings: 'false'
AlwaysBreakTemplateDeclarations: 'Yes'
BinPackArguments: 'false'
BinPackParameters: 'false'
BreakBeforeBraces: Allman
BreakConstructorInitializers: BeforeComma
BreakInheritanceList: BeforeComma
FixNamespaceComments: 'true'
IncludeBlocks: Preserve
IndentCaseLabels: 'true'
SortIncludes: 'true'
SpaceAfterCStyleCast: 'false'
SpaceAfterLogicalNot: 'false'
SpaceAfterTemplateKeyword: 'false'
SpaceBeforeAssignmentOperators: 'true'
Cpp11BracedListStyle: 'true'
SpaceBeforeParens: ControlStatements
SpaceBeforeCpp11BracedList: 'true'
SpaceBeforeCtorInitializerColon: 'true'
SpaceBeforeInheritanceColon: 'true'
SpaceInEmptyParentheses: 'false'
Standard: Auto
SpacesInAngles: 'false'
IndentWidth: '4'
TabWidth: '4'
AccessModifierOffset: '-4'
UseTab: Never
PointerAlignment: Left
NamespaceIndentation: All
ColumnLimit: 120




================================================
FILE: .clang-tidy
================================================
Checks: 'clang-diagnostic-*,
        clang-analyzer-*,
        -*,
        mpi-*,
        bugprone-*,
        -bugprone-signal-handler,
        -bugprone-narrowing-conversions,
        -bugprone-suspicious-realloc-usage,
        -bugprone-redundant-branch-condition,
        -bugprone-exception-escape,
        -bugprone-unchecked-optional-access,
        -bugprone-shared-ptr-array-mismatch,
        -bugprone-implicit-widening-of-multiplication-result,
        -bugprone-signed-char-misuse,
        -bugprone-assignment-in-if-condition,
        -bugprone-bool-pointer-implicit-conversion,
        -bugprone-unhandled-exception-at-new,
        -bugprone-infinite-loop,
        -bugprone-easily-swappable-parameters,
        -bugprone-reserved-identifier,
        -bugprone-stringview-nullptr,
        cert-err52-cpp,
        cert-err60-cpp,
        cert-err34-c,
        cert-str34-c,
        cert-dcl21-cpp,
        cert-msc50-cpp,
        cert-msc51-cpp,
        cert-dcl58-cpp,
        cert-flp30-c,
        cppcoreguidelines-pro-type-member-init,
        cppcoreguidelines-slicing,
        cppcoreguidelines-interfaces-global-init,
        cppcoreguidelines-pro-type-static-cast-downcast,
        cppcoreguidelines-narrowing-conversions,
        google-default-arguments,
        google-runtime-operator,
        google-explicit-constructor,
        hicpp-multiway-paths-covered,
        hicpp-exception-baseclass,
        misc-unconventional-assign-operator,
        misc-misplaced-const,
        misc-new-delete-overloads,
        misc-non-copyable-objects,
        misc-no-recursion,
        misc-throw-by-value-catch-by-reference,
        misc-uniqueptr-reset-release,
        modernize-*,
        -modernize-use-nodiscard,
        -modernize-use-trailing-return-type,
        -modernize-avoid-c-arrays,
        -modernize-use-equals-delete,
        -modernize-use-using,
        -modernize-use-default-member-init,
        -modernize-macro-to-enum,
        openmp-use-default-none,
        performance-*,
        -performance-no-int-to-ptr,
        portability-simd-intrinsics,
        readability-misleading-indentation,
        readability-non-const-parameter,
        readability-redundant-string-cstr,
        readability-use-anyofallof,
        readability-avoid-const-params-in-decls,
        readability-simplify-subscript-expr,
        readability-redundant-smartptr-get,
        readability-make-member-function-const,
        readability-delete-null-pointer,
        readability-uniqueptr-delete-release,
        readability-static-definition-in-anonymous-namespace,
        readability-redundant-declaration,
        readability-redundant-string-init,
        readability-redundant-control-flow,
        readability-misplaced-array-index,
        readability-inconsistent-declaration-parameter-name,
        readability-container-size-empty,
        readability-redundant-function-ptr-dereference,
        readability-const-return-type,
        readability-identifier-naming'
WarningsAsErrors: "*"
CheckOptions:
  - { key: readability-identifier-naming.ClassCase, value: CamelCase }
  - { key: readability-identifier-naming.ClassMemberPrefix, value: "m_" }
  - { key: readability-identifier-naming.ClassMemberCase, value: camelBack }
  - { key: readability-identifier-naming.FunctionCase, value: camelBack }
  - { key: readability-identifier-naming.MethodCase, value: camelBack }
  - { key: readability-identifier-naming.ParameterCase, value: camelBack }
  - { key: readability-identifier-naming.EnumCase, value: CamelCase }
  - { key: readability-identifier-naming.StructCase, value: CamelCase }
  - { key: readability-identifier-naming.TemplateParameterCase, value: CamelCase }
  - { key: readability-identifier-naming.TypeAliasCase, value: CamelCase }
  - { key: readability-identifier-naming.TypedefCase, value: CamelCase }
  - { key: readability-identifier-naming.GlobalVariableCase, value: UPPER_CASE }
  - key: performance-unnecessary-copy-initialization.ExcludedContainerTypes
    value: ''
  - key: modernize-replace-auto-ptr.IncludeStyle
    value: llvm
  - key: performance-move-const-arg.CheckTriviallyCopyableMove
    value: 'true'
  - key: modernize-use-auto.MinTypeNameLength
    value: '5'
  - key: bugprone-unused-return-value.CheckedFunctions
    value: '::std::async;
            ::std::launder;
            ::std::remove;
            ::std::remove_if;
            ::std::unique;
            ::std::unique_ptr::release;
            ::std::basic_string::empty;
            ::std::vector::empty;
            ::std::back_inserter;
            ::std::distance;
            ::std::find;
            ::std::find_if;
            ::std::inserter;
            ::std::lower_bound;
            ::std::make_pair;
            ::std::map::count;
            ::std::map::find;
            ::std::map::lower_bound;
            ::std::multimap::equal_range;
            ::std::multimap::upper_bound;
            ::std::set::count;
            ::std::set::find;
            ::std::setfill;
            ::std::setprecision;
            ::std::setw;
            ::std::upper_bound;
            ::std::vector::at;
            ::bsearch;
            ::ferror;
            ::feof;
            ::isalnum;
            ::isalpha;
            ::isblank;
            ::iscntrl;
            ::isdigit;
            ::isgraph;
            ::islower;
            ::isprint;
            ::ispunct;
            ::isspace;
            ::isupper;
            ::iswalnum;
            ::iswprint;
            ::iswspace;
            ::isxdigit;
            ::memchr;
            ::memcmp;
            ::strcmp;
            ::strcoll;
            ::strncmp;
            ::strpbrk;
            ::strrchr;
            ::strspn;
            ::strstr;
            ::wcscmp;
            ::access;
            ::bind;
            ::connect;
            ::difftime;
            ::dlsym;
            ::fnmatch;
            ::getaddrinfo;
            ::getopt;
            ::htonl;
            ::htons;
            ::iconv_open;
            ::inet_addr;
            ::isascii;
            ::isatty;
            ::mmap;
            ::newlocale;
            ::openat;
            ::pathconf;
            ::pthread_equal;
            ::pthread_getspecific;
            ::pthread_mutex_trylock;
            ::readdir;
            ::readlink;
            ::recvmsg;
            ::regexec;
            ::scandir;
            ::semget;
            ::setjmp;
            ::shm_open;
            ::shmget;
            ::sigismember;
            ::strcasecmp;
            ::strsignal;
            ::ttyname'
  - key: cert-dcl16-c.NewSuffixes
    value: 'L;
            LL;
            LU;
            LLU'
  - key: readability-inconsistent-declaration-parameter-name.Strict
    value: 'false'
  - key: bugprone-assert-side-effect.IgnoredFunctions
    value: __builtin_expect
  - key: modernize-use-override.AllowOverrideAndFinal
    value: 'false'
  - key: cppcoreguidelines-narrowing-conversions.IgnoreConversionFromTypes
    value: ''
  - key: modernize-pass-by-value.ValuesOnly
    value: 'false'
  - key: modernize-loop-convert.IncludeStyle
    value: llvm
  - key: cert-str34-c.DiagnoseSignedUnsignedCharComparisons
    value: 'false'
  - key: misc-uniqueptr-reset-release.IncludeStyle
    value: llvm
  - key: cert-err33-c.CheckedFunctions
    value: '::aligned_alloc;
            ::asctime_s;
            ::at_quick_exit;
            ::atexit;
            ::bsearch;
            ::bsearch_s;
            ::btowc;
            ::c16rtomb;
            ::c32rtomb;
            ::calloc;
            ::clock;
            ::cnd_broadcast;
            ::cnd_init;
            ::cnd_signal;
            ::cnd_timedwait;
            ::cnd_wait;
            ::ctime_s;
            ::fclose;
            ::fflush;
            ::fgetc;
            ::fgetpos;
            ::fgets;
            ::fgetwc;
            ::fopen;
            ::fopen_s;
            ::fprintf;
            ::fprintf_s;
            ::fputc;
            ::fputs;
            ::fputwc;
            ::fputws;
            ::fread;
            ::freopen;
            ::freopen_s;
            ::fscanf;
            ::fscanf_s;
            ::fseek;
            ::fsetpos;
            ::ftell;
            ::fwprintf;
            ::fwprintf_s;
            ::fwrite;
            ::fwscanf;
            ::fwscanf_s;
            ::getc;
            ::getchar;
            ::getenv;
            ::getenv_s;
            ::gets_s;
            ::getwc;
            ::getwchar;
            ::gmtime;
            ::gmtime_s;
            ::localtime;
            ::localtime_s;
            ::malloc;
            ::mbrtoc16;
            ::mbrtoc32;
            ::mbsrtowcs;
            ::mbsrtowcs_s;
            ::mbstowcs;
            ::mbstowcs_s;
            ::memchr;
            ::mktime;
            ::mtx_init;
            ::mtx_lock;
            ::mtx_timedlock;
            ::mtx_trylock;
            ::mtx_unlock;
            ::printf_s;
            ::putc;
            ::putwc;
            ::raise;
            ::realloc;
            ::remove;
            ::rename;
            ::scanf;
            ::scanf_s;
            ::setlocale;
            ::setvbuf;
            ::signal;
            ::snprintf;
            ::snprintf_s;
            ::sprintf;
            ::sprintf_s;
            ::sscanf;
            ::sscanf_s;
            ::strchr;
            ::strerror_s;
            ::strftime;
            ::strpbrk;
            ::strrchr;
            ::strstr;
            ::strtod;
            ::strtof;
            ::strtoimax;
            ::strtok;
            ::strtok_s;
            ::strtol;
            ::strtold;
            ::strtoll;
            ::strtoul;
            ::strtoull;
            ::strtoumax;
            ::strxfrm;
            ::swprintf;
            ::swprintf_s;
            ::swscanf;
            ::swscanf_s;
            ::thrd_create;
            ::thrd_detach;
            ::thrd_join;
            ::thrd_sleep;
            ::time;
            ::timespec_get;
            ::tmpfile;
            ::tmpfile_s;
            ::tmpnam;
            ::tmpnam_s;
            ::tss_create;
            ::tss_get;
            ::tss_set;
            ::ungetc;
            ::ungetwc;
            ::vfprintf;
            ::vfprintf_s;
            ::vfscanf;
            ::vfscanf_s;
            ::vfwprintf;
            ::vfwprintf_s;
            ::vfwscanf;
            ::vfwscanf_s;
            ::vprintf_s;
            ::vscanf;
            ::vscanf_s;
            ::vsnprintf;
            ::vsnprintf_s;
            ::vsprintf;
            ::vsprintf_s;
            ::vsscanf;
            ::vsscanf_s;
            ::vswprintf;
            ::vswprintf_s;
            ::vswscanf;
            ::vswscanf_s;
            ::vwprintf_s;
            ::vwscanf;
            ::vwscanf_s;
            ::wcrtomb;
            ::wcschr;
            ::wcsftime;
            ::wcspbrk;
            ::wcsrchr;
            ::wcsrtombs;
            ::wcsrtombs_s;
            ::wcsstr;
            ::wcstod;
            ::wcstof;
            ::wcstoimax;
            ::wcstok;
            ::wcstok_s;
            ::wcstol;
            ::wcstold;
            ::wcstoll;
            ::wcstombs;
            ::wcstombs_s;
            ::wcstoul;
            ::wcstoull;
            ::wcstoumax;
            ::wcsxfrm;
            ::wctob;
            ::wctrans;
            ::wctype;
            ::wmemchr;
            ::wprintf_s;
            ::wscanf;
            ::wscanf_s;'
  - key: bugprone-suspicious-string-compare.WarnOnLogicalNotComparison
    value: 'false'
  - key: readability-redundant-smartptr-get.IgnoreMacros
    value: 'true'
  - key: bugprone-suspicious-string-compare.WarnOnImplicitComparison
    value: 'true'
  - key: modernize-use-emplace.TupleTypes
    value: '::std::pair;
            ::std::tuple'
  - key: modernize-use-emplace.TupleMakeFunctions
    value: '::std::make_pair;
            ::std::make_tuple'
  - key: cppcoreguidelines-narrowing-conversions.WarnOnFloatingPointNarrowingConversion
    value: 'true'
  - key: bugprone-argument-comment.StrictMode
    value: '0'
  - key: modernize-loop-convert.MakeReverseRangeHeader
    value: ''
  - key: modernize-replace-random-shuffle.IncludeStyle
    value: llvm
  - key: modernize-use-bool-literals.IgnoreMacros
    value: 'true'
  - key: bugprone-unhandled-self-assignment.WarnOnlyIfThisHasSuspiciousField
    value: 'true'
  - key: bugprone-argument-comment.CommentNullPtrs
    value: '0'
  - key: google-readability-namespace-comments.ShortNamespaceLines
    value: '10'
  - key: bugprone-suspicious-string-compare.StringCompareLikeFunctions
    value: ''
  - key: modernize-avoid-bind.PermissiveParameterList
    value: 'false'
  - key: modernize-use-override.FinalSpelling
    value: final
  - key: cppcoreguidelines-narrowing-conversions.WarnOnIntegerNarrowingConversion
    value: 'true'
  - key: modernize-loop-convert.UseCxx20ReverseRanges
    value: 'true'
  - key: modernize-use-noexcept.ReplacementString
    value: ''
  - key: performance-type-promotion-in-math-fn.IncludeStyle
    value: llvm
  - key: modernize-loop-convert.NamingStyle
    value: CamelCase
  - key: bugprone-suspicious-include.ImplementationFileExtensions
    value: 'cc;
            cpp;
            cxx'
  - key: cppcoreguidelines-pro-type-member-init.UseAssignment
    value: 'false'
  - key: modernize-loop-convert.MakeReverseRangeFunction
    value: ''
  - key: bugprone-suspicious-include.HeaderFileExtensions
    value: ';
            hh;
            hpp;
            hxx'
  - key: performance-no-automatic-move.AllowedTypes
    value: ''
  - key: performance-for-range-copy.WarnOnAllAutoCopies
    value: 'false'
  - key: bugprone-argument-comment.CommentIntegerLiterals
    value: '0'
  - key: bugprone-suspicious-missing-comma.SizeThreshold
    value: '5'
  - key: readability-inconsistent-declaration-parameter-name.IgnoreMacros
    value: 'true'
  - key: hicpp-multiway-paths-covered.WarnOnMissingElse
    value: 'false'
  - key: modernize-pass-by-value.IncludeStyle
    value: llvm
  - key: bugprone-sizeof-expression.WarnOnSizeOfThis
    value: 'true'
  - key: bugprone-string-constructor.WarnOnLargeLength
    value: 'true'
  - key: bugprone-too-small-loop-variable.MagnitudeBitsUpperLimit
    value: '16'
  - key: bugprone-argument-comment.CommentFloatLiterals
    value: '0'
  - key: bugprone-argument-comment.CommentCharacterLiterals
    value: '0'
  - key: modernize-use-nullptr.NullMacros
    value: 'NULL'
  - key: modernize-make-shared.IgnoreMacros
    value: 'true'
  - key: bugprone-dynamic-static-initializers.HeaderFileExtensions
    value: ';
            h;
            hh;
            hpp;
            hxx'
  - key: bugprone-suspicious-enum-usage.StrictMode
    value: 'false'
  - key: performance-unnecessary-copy-initialization.AllowedTypes
    value: ''
  - key: bugprone-suspicious-missing-comma.MaxConcatenatedTokens
    value: '5'
  - key: modernize-use-transparent-functors.SafeMode
    value: 'false'
  - key: cppcoreguidelines-narrowing-conversions.PedanticMode
    value: 'false'
  - key: modernize-make-shared.IgnoreDefaultInitialization
    value: 'true'
  - key: bugprone-not-null-terminated-result.WantToUseSafeFunctions
    value: 'true'
  - key: modernize-make-shared.IncludeStyle
    value: llvm
  - key: bugprone-string-constructor.LargeLengthThreshold
    value: '8388608'
  - key: misc-throw-by-value-catch-by-reference.CheckThrowTemporaries
    value: 'true'
  - key: cert-oop54-cpp.WarnOnlyIfThisHasSuspiciousField
    value: 'false'
  - key: modernize-use-override.IgnoreDestructors
    value: 'false'
  - key: performance-inefficient-vector-operation.EnableProto
    value: 'false'
  - key: modernize-make-shared.MakeSmartPtrFunction
    value: 'std::make_shared'
  - key: modernize-loop-convert.MaxCopySize
    value: '16'
  - key: bugprone-argument-comment.CommentStringLiterals
    value: '0'
  - key: portability-simd-intrinsics.Suggest
    value: 'false'
  - key: modernize-make-unique.IgnoreMacros
    value: 'true'
  - key: modernize-make-shared.MakeSmartPtrFunctionHeader
    value: '<memory>'
  - key: performance-for-range-copy.AllowedTypes
    value: ''
  - key: bugprone-sizeof-expression.WarnOnSizeOfConstant
    value: 'true'
  - key: readability-redundant-string-init.StringNames
    value: '::std::basic_string_view;
            ::std::basic_string'
  - key: modernize-make-unique.IgnoreDefaultInitialization
    value: 'true'
  - key: modernize-use-emplace.ContainersWithPushBack
    value: '::std::vector;
            ::std::list;
            ::std::deque'
  - key: modernize-make-unique.IncludeStyle
    value: llvm
  - key: bugprone-argument-comment.CommentBoolLiterals
    value: '0'
  - key: bugprone-argument-comment.CommentUserDefinedLiterals
    value: '0'
  - key: modernize-use-override.OverrideSpelling
    value: override
  - key: readability-redundant-declaration.IgnoreMacros
    value: 'true'
  - key: performance-inefficient-string-concatenation.StrictMode
    value: 'false'
  - key: google-readability-braces-around-statements.ShortStatementLines
    value: '1'
  - key: modernize-make-unique.MakeSmartPtrFunction
    value: 'std::make_unique'
  - key: cppcoreguidelines-pro-type-member-init.IgnoreArrays
    value: 'false'
  - key: modernize-use-emplace.IgnoreImplicitConstructors
    value: 'false'
  - key: modernize-make-unique.MakeSmartPtrFunctionHeader
    value: '<memory>'
  - key: cppcoreguidelines-narrowing-conversions.WarnWithinTemplateInstantiation
    value: 'false'
  - key: cppcoreguidelines-narrowing-conversions.WarnOnEquivalentBitWidth
    value: 'true'
  - key: bugprone-misplaced-widening-cast.CheckImplicitCasts
    value: 'false'
  - key: bugprone-suspicious-missing-comma.RatioThreshold
    value: '0.200000'
  - key: modernize-loop-convert.MinConfidence
    value: reasonable
  - key: performance-unnecessary-value-param.AllowedTypes
    value: ''
  - key: readability-uniqueptr-delete-release.PreferResetCall
    value: 'false'
  - key: misc-throw-by-value-catch-by-reference.MaxSize
    value: '1'
  - key: modernize-use-noexcept.UseNoexceptFalse
    value: 'true'
  - key: google-readability-namespace-comments.SpacesBeforeComments
    value: '2'
  - key: cppcoreguidelines-non-private-member-variables-in-classes.IgnoreClassesWithAllMemberVariablesBeingPublic
    value: 'true'
  - key: bugprone-argument-comment.IgnoreSingleArgument
    value: '0'
  - key: bugprone-sizeof-expression.WarnOnSizeOfIntegerExpression
    value: 'false'
  - key: performance-faster-string-find.StringLikeClasses
    value: '::std::basic_string;
            ::std::basic_string_view'
  - key: bugprone-assert-side-effect.CheckFunctionCalls
    value: 'false'
  - key: cppcoreguidelines-narrowing-conversions.WarnOnIntegerToFloatingPointNarrowingConversion
    value: 'true'
  - key: bugprone-string-constructor.StringNames
    value: '::std::basic_string;
            ::std::basic_string_view'
  - key: bugprone-assert-side-effect.AssertMacros
    value: assert,NSAssert,NSCAssert
  - key: llvm-qualified-auto.AddConstToQualified
    value: 'false'
  - key: cert-str34-c.CharTypdefsToIgnore
    value: ''
  - key: google-readability-function-size.StatementThreshold
    value: '800'
  - key: llvm-else-after-return.WarnOnConditionVariables
    value: 'false'
  - key: cert-msc51-cpp.DisallowedSeedTypes
    value: 'time_t,
            std::time_t'
  - key: bugprone-sizeof-expression.WarnOnSizeOfCompareToConstant
    value: 'true'
  - key: modernize-raw-string-literal.DelimiterStem
    value: lit
  - key: modernize-use-equals-default.IgnoreMacros
    value: 'true'
  - key: misc-throw-by-value-catch-by-reference.WarnOnLargeObjects
    value: 'false'
  - key: modernize-raw-string-literal.ReplaceShorterLiterals
    value: 'false'
  - key: modernize-use-emplace.SmartPointers
    value: '::std::shared_ptr;
            ::std::unique_ptr;
            ::std::auto_ptr;
            ::std::weak_ptr'
  - key: performance-inefficient-vector-operation.VectorLikeClasses
    value: '::std::vector'
  - key: modernize-use-auto.RemoveStars
    value: 'false'
  - key: bugprone-dangling-handle.HandleClasses
    value: 'std::basic_string_view;
            std::experimental::basic_string_view'
  - key: portability-simd-intrinsics.Std
    value: ''
  - key: performance-unnecessary-value-param.IncludeStyle
    value: llvm
  - key: modernize-replace-disallow-copy-and-assign-macro.MacroName
    value: DISALLOW_COPY_AND_ASSIGN
  - key: llvm-else-after-return.WarnOnUnfixable
    value: 'false'
  - key: readability-simplify-subscript-expr.Types
    value: '::std::basic_string;
            ::std::basic_string_view;
            ::std::vector;::std::array'
  - key: performance-unnecessary-value-param.AllowedTypes
    value: std::shared_ptr
FormatStyle: 'file'



================================================
FILE: api/Makefile
================================================
# Makefile for Wazuh API
# Copyright (C) 2015, Wazuh Inc.
# May 3, 2017
#
# Syntax: make [ all | backup | install | restore | service ]

WAZUH_GROUP       = wazuh
INSTALLDIR       ?= /var/wazuh-manager

MV_FILE        = mv -f
RM_FILE        = rm -f
INSTALL_DIR    = install -o root -g ${WAZUH_GROUP} -m 0750 -d
INSTALL_RW_DIR = install -o root -g ${WAZUH_GROUP} -m 0770 -d
INSTALL_EXEC   = install -o root -g ${WAZUH_GROUP} -m 0750
INSTALL_FILE   = install -o root -g ${WAZUH_GROUP} -m 0640
INSTALL_CONFIG_FILE   = install -o root -g ${WAZUH_GROUP} -m 0660
PYTHON_BIN     = $(INSTALLDIR)/framework/python/bin/python3


.PHONY: all backup install restore

all: backup install restore

backup:
	# Backup previous configuration
	. ../api/service/inst-api-functions.sh; backup_old_api ${REVISION}

install:
    # Copy files and create folders
	$(INSTALL_DIR) $(INSTALLDIR)/api
	$(INSTALL_RW_DIR) $(INSTALLDIR)/api/configuration
	$(INSTALL_RW_DIR) $(INSTALLDIR)/api/configuration/ssl
	$(INSTALL_RW_DIR) $(INSTALLDIR)/api/configuration/security

	$(INSTALL_CONFIG_FILE) api/configuration/api.yaml ${INSTALLDIR}/api/configuration

	$(INSTALL_DIR) $(INSTALLDIR)/api/scripts
	$(INSTALL_FILE) scripts/wazuh_manager_apid.py ${INSTALLDIR}/api/scripts

    # Install scripts/%.py on $(INSTALLDIR)/bin/%
	$(foreach script,$(wildcard scripts/*.py),$(INSTALL_EXEC) wrappers/generic_wrapper.sh $(patsubst scripts/%.py,$(INSTALLDIR)/bin/%,$(script));)
	
	$(MV_FILE) $(INSTALLDIR)/bin/wazuh_manager_apid $(INSTALLDIR)/bin/wazuh-manager-apid

restore:
    # Restore old API config
	. ../api/service/inst-api-functions.sh; restore_old_api ${REVISION}



================================================
FILE: api/setup.py
================================================
#!/usr/bin/env python

# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

from setuptools import setup, find_namespace_packages

# To install the library, run the following
#
# python setup.py install
#
# prerequisite: setuptools
# http://pypi.python.org/pypi/setuptools

setup(
    name='api',
    version='5.0.0',
    description="Wazuh API",
    author_email="hello@wazuh.com",
    author="Wazuh",
    url="https://github.com/wazuh",
    keywords=["Wazuh API"],
    install_requires=[],
    packages=find_namespace_packages(exclude=["*.test", "*.test.*", "test.*", "test"]),
    package_data={'': ['spec/spec.yaml']},
    include_package_data=True,
    zip_safe=False,
    license='GPLv2',
    long_description="""\
    The Wazuh API is an open source RESTful API that allows for interaction with the Wazuh manager from a web browser, command line tool like cURL or any script or program that can make web requests. The Wazuh app relies on this heavily and Wazuh’s goal is to accommodate complete remote management of the Wazuh infrastructure via the Wazuh app. Use the API to easily perform everyday actions like adding an agent, restarting the manager(s) or agent(s) or looking up syscheck details.
    """
)



================================================
FILE: api/api/__init__.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2



================================================
FILE: api/api/alogging.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import collections
import logging
import json
import re
from pythonjsonlogger import jsonlogger

from api.configuration import api_conf
from api.api_exception import APIError

# Compile regex when the module is imported so it's not necessary to compile it everytime log.info is called
request_pattern = re.compile(r'\[.+]|\s+\*\s+')

logger = logging.getLogger('wazuh-api')

# Variable used to specify an unknown user
UNKNOWN_USER_STRING = "unknown_user"


class APILoggerSize:
    size_regex = re.compile(r"(\d+)([KM])")
    unit_conversion = {
        'K': 1024,
        'M': 1024 ** 2
    }

    def __init__(self, size_string: str):
        size_string = size_string.upper()
        try:
            size, unit = self.size_regex.match(size_string).groups()
        except AttributeError:
            raise APIError(2011, details="Size value does not match the expected format: <number><unit> (Available"
                                         " units: K (kilobytes), M (megabytes). For instance: 45M") from None

        self.size = int(size) * self.unit_conversion[unit]
        if self.size < self.unit_conversion['M']:
            raise APIError(2011, details=f"Minimum value for size is 1M. Current: {size_string}")


class WazuhJsonFormatter(jsonlogger.JsonFormatter):
    """
    Define the custom JSON log formatter used by wlogging.
    """

    def add_fields(self, log_record: collections.OrderedDict, record: logging.LogRecord, message_dict: dict):
        """Implement custom logic for adding fields in a log entry.

        Parameters
        ----------
        log_record : collections.OrderedDict
            Dictionary with custom fields used to generate a log entry.
        record : logging.LogRecord
            Contains all the information to the event being logged.
        message_dict : dict
            Dictionary with a request or exception information.
        """
        # Request handling
        if record.message is None:
            record.message = {
                'type': 'request',
                'payload': message_dict
            }
        else:
            # Traceback handling
            traceback = message_dict.get('exc_info')
            if traceback is not None:
                record.message = {
                    'type': 'error',
                    'payload': f'{record.message}. {traceback}'
                }
            else:
                # Plain text messages
                record.message = {
                    'type': 'informative',
                    'payload': record.message
                }
        log_record['timestamp'] = self.formatTime(record, self.datefmt)
        log_record['levelname'] = record.levelname
        log_record['data'] = record.message


def set_logging(log_filepath, log_level='INFO', foreground_mode=False) -> dict:
    """Set up logging for API.
    
    This function creates a logging configuration dictionary, configure the wazuh-api logger
    and returns the logging configuration dictionary that will be used in uvicorn logging
    configuration.
    
    Parameters
    ----------
    log_path : str
        Log file path.
    log_level :  str
        Logger Log level.
    foreground_mode : bool
        Log output to console streams when true
        else Log output to file.

    Raise
    -----
    ApiError

    Returns
    -------
    log_config_dict : dict
        Logging configuration dictionary.
    """
    handlers = {
        'plainfile': None, 
        'jsonfile': None,
    }
    if foreground_mode:
        handlers.update({'console': {}})

    if 'json' in api_conf['logs']['format']:
        handlers["jsonfile"] = {
            'filename': f"{log_filepath}.json",
            'formatter': 'json',
            'filters': ['json-filter'],
        }
    if 'plain' in api_conf['logs']['format']:
        handlers["plainfile"] = {
            'filename': f"{log_filepath}.log",
            'formatter': 'log',
            'filters': ['plain-filter'],
        }

    hdls = [k for k, v in handlers.items() if isinstance(v, dict)]
    if not hdls:
        raise APIError(2011)

    log_config_dict = {
        "version": 1,
        "disable_existing_loggers": False,
        "formatters": {
            "default": {
                "()": "uvicorn.logging.DefaultFormatter",
                "fmt": "%(levelprefix)s %(message)s",
                "use_colors": None,
            },
            "access": {
                "()": "uvicorn.logging.AccessFormatter",
                "fmt": '%(levelprefix)s %(client_addr)s - "%(request_line)s" %(status_code)s',
            },
            "log": {
                "()": "uvicorn.logging.DefaultFormatter",
                "fmt": "%(asctime)s %(levelname)s: %(message)s",
                "datefmt": "%Y/%m/%d %H:%M:%S",
                "use_colors": None,
            },
            "json" : {
                '()': 'api.alogging.WazuhJsonFormatter',
                'style': '%',
                'datefmt': "%Y/%m/%d %H:%M:%S"
            }
        },
        "filters": {
            'plain-filter': {'()': 'wazuh.core.wlogging.CustomFilter',
                             'log_type': 'log' },
            'json-filter': {'()': 'wazuh.core.wlogging.CustomFilter',
                             'log_type': 'json' }
        },
        "handlers": {
            "default": {
                "formatter": "default",
                "class": "logging.StreamHandler",
                "stream": "ext://sys.stderr",
            },
            "access": {
                "formatter": "access",
                "class": "logging.StreamHandler",
                "stream": "ext://sys.stdout"
            },
            "console": {
                'formatter': 'log',
                'class': 'logging.StreamHandler',
                'stream': 'ext://sys.stdout',
                'filters': ['plain-filter']
            },
        },
        "loggers": {
            "wazuh-api": {"handlers": hdls, "level": log_level, "propagate": False},
            "start-stop-api": {"handlers": hdls, "level": 'INFO', "propagate": False}
        }
    }

    # configure file handlers
    for handler, d in handlers.items():
        if d and 'filename' in d:
            if api_conf['logs']['max_size']['enabled']:
                max_size = APILoggerSize(api_conf['logs']['max_size']['size']).size
                d.update({
                    'class':'wazuh.core.wlogging.SizeBasedFileRotatingHandler',
                    'maxBytes': max_size,
                    'backupCount': 1
                })
            else:
                d.update({
                    'class': 'wazuh.core.wlogging.TimeBasedFileRotatingHandler',
                    'when': 'midnight'
                })
            log_config_dict['handlers'][handler] = d

    # Configure the uvicorn loggers. They will be created by the uvicorn server.
    log_config_dict['loggers']['uvicorn'] = {"handlers": hdls, "level": 'WARNING', "propagate": False}
    log_config_dict['loggers']['uvicorn.error'] = {"handlers": hdls, "level": 'WARNING', "propagate": False}
    log_config_dict['loggers']['uvicorn.access'] = {'level': 'WARNING'}

    return log_config_dict


def custom_logging(user, remote, method, path, query,
                    body, elapsed_time, status, hash_auth_context='',
                    headers: dict = None):
    """Provide the log entry structure depending on the logging format.

    Parameters
    ----------
    user : str
        User who perform the request.
    remote : str
        IP address of the request.
    method : str
        HTTP method used in the request.
    path : str
        Endpoint used in the request.
    query : dict
        Dictionary with the request parameters.
    body : dict
        Dictionary with the request body.
    elapsed_time : float
        Required time to compute the request.
    status : int
        Status code of the request.
    hash_auth_context : str, optional
        Hash representing the authorization context. Default: ''
    headers: dict
        Optional dictionary of request headers.
    """
    json_info = {
        'user': user,
        'ip': remote,
        'http_method': method,
        'uri': f'{method} {path}',
        'parameters': query,
        'body': body,
        'time': f'{elapsed_time:.3f}s',
        'status_code': status
    }

    if not hash_auth_context:
        log_info = f'{user} {remote} "{method} {path}" '
    else:
        log_info = f'{user} ({hash_auth_context}) {remote} "{method} {path}" '
        json_info['hash_auth_context'] = hash_auth_context

    if path == '/events' and logger.level >= 20:
        # If log level is info simplify the messages for the /events requests.
        if isinstance(body, dict):
            events = body.get('events', [])
            body = {'events': len(events)}
            json_info['body'] = body

    log_info += f'with parameters {json.dumps(query)} and body '\
                f'{json.dumps(body)} done in {elapsed_time:.3f}s: {status}'

    logger.info(log_info, extra={'log_type': 'log'})
    logger.info(json_info, extra={'log_type': 'json'})
    logger.debug2(f'Receiving headers {headers}')



================================================
FILE: api/api/api_exception.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

from connexion.exceptions import ProblemException
from api.constants import RELATIVE_CONFIG_FILE_PATH, RELATIVE_SECURITY_PATH
from wazuh.core.exception import DOCU_VERSION, WazuhTooManyRequests


class APIException(Exception):
    """
    Wazuh API exception class.
    """

    def __init__(self, code: int, details: str = None):
        """APIException class constructor.

        Parameters
        ----------
        code : int
            Error code.
        details : str
            Extra details to add to the default exception message to include useful context information.
        """
        self.code = code
        self.details = details
        # show relative paths in exceptions
        self.exceptions = {
            2000: 'Some parameters are not expected in the configuration file '
                  f"(WAZUH_PATH/{RELATIVE_CONFIG_FILE_PATH}). Please check the documentation for further details: "
                  f"https://documentation.wazuh.com/{DOCU_VERSION}/user-manual/api/configuration.html"
                  '#api-configuration-options',
            2001: 'Error creating or reading secrets file. Please, ensure '
                  'there is enough disk space and permission to write in '
                  f'WAZUH_PATH/{RELATIVE_SECURITY_PATH}',
            2002: 'Error migrating configuration from old API version. '
                  'Default configuration will be applied',
            2003: 'Error loading SSL/TLS certificates',
            2004: 'Configuration file could not be loaded',
            2005: 'Body request is not a valid JSON',
            2006: 'Error parsing body request to UTF-8',
            2007: 'Body is empty',
            2009: 'Semicolon (;) is a reserved character and must '
                  'be percent-encoded (%3B) to use it.',
            2010: 'Error while attempting to bind on address: address already in use',
            2011: 'Error setting up API logger',
            2012: 'Error while attempting to check RBAC database integrity'
        }

    def __str__(self) -> str:
        """Magic method str().

        Returns
        -------
        str
            String representation of the APIException object.
        """
        details = '.' if self.details is None else f': {self.details}.'
        return f"{self.code} - {self.exceptions[self.code]}{details}"


class APIError(APIException):
    pass


class BlockedIPException(ProblemException):
    """Bocked IP Exception Class."""
    def __init__(self, *, status=500, title=None, detail=None):
        ext = {"code": 6000}
        super().__init__(status=status, title=title, detail=detail, ext=ext)


class MaxRequestsException(ProblemException):
    """Bocked IP Exception Class."""
    def __init__(self, code):
        exc = WazuhTooManyRequests(code=code)
        ext = {"code": exc.code}
        ext.update({"remediation": exc.remediation} if hasattr(exc, 'remediation') else {})
        super().__init__(status=429, title=exc.title, detail=exc.message, type=exc.type, ext=ext)


class ExpectFailedException(ProblemException):
    """Exception for failed expectation (status code 417)."""

    def __init__(self, *, status=417, title=None, detail=None):
        ext = {"code": 417}
        super().__init__(status=status, title=title, detail=detail, ext=ext)



================================================
FILE: api/api/authentication.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import asyncio
from functools import cache
import hashlib
import json
import jwt
import logging
import os
from concurrent.futures import ThreadPoolExecutor
from typing import Union

from cryptography.hazmat.primitives import serialization
from cryptography.hazmat.primitives.asymmetric import ec
from connexion.exceptions import Unauthorized

import api.configuration as conf
import wazuh.core.utils as core_utils
import wazuh.rbac.utils as rbac_utils
from api.constants import SECURITY_CONFIG_PATH
from api.constants import SECURITY_PATH
from api.util import raise_if_exc
from wazuh import WazuhInternalError
from wazuh.core.cluster.dapi.dapi import DistributedAPI
from wazuh.core.cluster.utils import read_config
from wazuh.core.common import wazuh_uid, wazuh_gid
from wazuh.rbac.orm import AuthenticationManager, TokenManager, UserRolesManager
from wazuh.rbac.preprocessor import optimize_resources

INVALID_TOKEN = "Invalid token"
EXPIRED_TOKEN = "Token expired"
pool = ThreadPoolExecutor(max_workers=1)


def check_user_master(user: str, password: str) -> dict:
    """Validate a username-password pair.

    This function must be executed in the master node.

    Parameters
    ----------
    user : str
        Unique username.
    password : str
        User password.

    Returns
    -------
    dict
        Dictionary with the result of the query.
    """
    with AuthenticationManager() as auth_:
        if auth_.check_user(user, password):
            return {'result': True}

    return {'result': False}


def check_user(user: str, password: str, required_scopes=None) -> Union[dict, None]:
    """Validate a username-password pair.

    Convenience method to use in OpenAPI specification.

    Parameters
    ----------
    user : str
        Unique username.
    password : str
        User password.

    Returns
    -------
    dict or None
        Dictionary with the username and its status or None.
    """
    dapi = DistributedAPI(f=check_user_master,
                          f_kwargs={'user': user, 'password': password},
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=False,
                          logger=logging.getLogger('wazuh-api')
                          )
    data = raise_if_exc(pool.submit(asyncio.run, dapi.distribute_function()).result())

    if data['result']:
        return {'sub': user, 'active': True }


# Set JWT settings
JWT_ISSUER = 'wazuh'
JWT_ALGORITHM = 'ES512'
_private_key_path = os.path.join(SECURITY_PATH, 'private_key.pem')
_public_key_path = os.path.join(SECURITY_PATH, 'public_key.pem')

@cache
def generate_keypair():
    """Generate key files to keep safe or load existing public and private keys.

    Raises
    ------
    WazuhInternalError(6003)
        If there was an error trying to load the JWT secret.
    """
    try:
        if not os.path.exists(_private_key_path) or not os.path.exists(_public_key_path):
            private_key, public_key = change_keypair()
            try:
                os.chown(_private_key_path, wazuh_uid(), wazuh_gid())
                os.chown(_public_key_path, wazuh_uid(), wazuh_gid())
            except PermissionError:
                pass
            os.chmod(_private_key_path, 0o640)
            os.chmod(_public_key_path, 0o640)
        else:
            with open(_private_key_path, mode='r') as key_file:
                private_key = key_file.read()
            with open(_public_key_path, mode='r') as key_file:
                public_key = key_file.read()
    except IOError:
        raise WazuhInternalError(6003)

    return private_key, public_key


def change_keypair():
    """Generate key files to keep safe."""
    key_obj = ec.generate_private_key(ec.SECP521R1())
    private_key = key_obj.private_bytes(
        encoding=serialization.Encoding.PEM,
        format=serialization.PrivateFormat.PKCS8,
        encryption_algorithm=serialization.NoEncryption()
    ).decode('utf-8')
    public_key = key_obj.public_key().public_bytes(
        encoding=serialization.Encoding.PEM,
        format=serialization.PublicFormat.SubjectPublicKeyInfo
    ).decode('utf-8')
    with open(_private_key_path, mode='w') as key_file:
        key_file.write(private_key)
    with open(_public_key_path, mode='w') as key_file:
        key_file.write(public_key)

    return private_key, public_key


def get_security_conf() -> dict:
    """Read the security configuration file.

    Returns
    -------
    dict
        Dictionary with the content of the security.yaml file.
    """
    conf.security_conf.update(conf.read_yaml_config(config_file=SECURITY_CONFIG_PATH,
                                                    default_conf=conf.default_security_configuration))
    return conf.security_conf


def generate_token(user_id: str = None, data: dict = None, auth_context: dict = None) -> str:
    """Generate an encoded JWT token. This method should be called once a user is properly logged on.

    Parameters
    ----------
    user_id : str
        Unique username.
    data : dict
        Roles permissions for the user.
    auth_context : dict
        Authorization context used in the run as login request.

    Returns
    -------
    str
        Encoded JWT token.
    """
    dapi = DistributedAPI(f=get_security_conf,
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=False,
                          logger=logging.getLogger('wazuh-api')
                          )
    result = raise_if_exc(pool.submit(asyncio.run, dapi.distribute_function()).result()).dikt
    timestamp = int(core_utils.get_utc_now().timestamp())

    payload = {
                  "iss": JWT_ISSUER,
                  "aud": "Wazuh API REST",
                  "nbf": timestamp,
                  "exp": timestamp + result['auth_token_exp_timeout'],
                  "sub": str(user_id),
                  "run_as": auth_context is not None,
                  "rbac_roles": data['roles'],
                  "rbac_mode": result['rbac_mode']
              } | ({"hash_auth_context": hashlib.blake2b(json.dumps(auth_context).encode(),
                                                         digest_size=16).hexdigest()}
                   if auth_context is not None else {})

    return jwt.encode(payload, generate_keypair()[0], algorithm=JWT_ALGORITHM)


@rbac_utils.token_cache()
def check_token(username: str, roles: tuple, token_nbf_time: int, run_as: bool) -> dict:
    """Check the validity of a token with the current time and the generation time of the token.

    Parameters
    ----------
    username : str
        Unique username.
    roles : tuple
        Tuple of roles related with the current token.
    token_nbf_time : int
        Issued at time of the current token.
    run_as : bool
        Indicate if the token has been granted through authorization context endpoint.

    Returns
    -------
    dict
        Dictionary with the result.
    """
    # Check that the user exists
    with AuthenticationManager() as am:
        user = am.get_user(username=username)
        if not user:
            return {'valid': False}
        user_id = user['id']

        with UserRolesManager() as urm:
            user_roles = [role.id for role in urm.get_all_roles_from_user(user_id=user_id)]
            if not am.user_allow_run_as(user['username']) and set(user_roles) != set(roles):
                return {'valid': False}
            with TokenManager() as tm:
                for role in user_roles:
                    if not tm.is_token_valid(role_id=role, user_id=user_id, token_nbf_time=int(token_nbf_time),
                                             run_as=run_as):
                        return {'valid': False}

    policies = optimize_resources(roles)

    return {'valid': True, 'policies': policies}


def decode_token(token: str) -> dict:
    """Decode a JWT formatted token and add processed policies.
    Raise an Unauthorized exception in case validation fails.

    Parameters
    ----------
    token : str
        JWT formatted token.

    Raises
    ------
    Unauthorized
        If the token validation fails.

    Returns
    -------
    dict
        Dictionary with the token payload.
    """
    try:
        # Decode JWT token with local secret
        payload = jwt.decode(token, generate_keypair()[1], algorithms=[JWT_ALGORITHM], audience='Wazuh API REST')

        # Check token and add processed policies in the Master node
        dapi = DistributedAPI(f=check_token,
                              f_kwargs={'username': payload['sub'],
                                        'roles': tuple(payload['rbac_roles']), 'token_nbf_time': payload['nbf'],
                                        'run_as': payload['run_as'], 'origin_node_type': read_config()['node_type']},
                              request_type='local_master',
                              is_async=False,
                              wait_for_complete=False,
                              logger=logging.getLogger('wazuh-api')
                              )
        data = raise_if_exc(pool.submit(asyncio.run, dapi.distribute_function()).result()).to_dict()

        if not data['result']['valid']:
            raise Unauthorized(INVALID_TOKEN)
        payload['rbac_policies'] = data['result']['policies']
        payload['rbac_policies']['rbac_mode'] = payload.pop('rbac_mode')

        # Detect local changes
        dapi = DistributedAPI(f=get_security_conf,
                              request_type='local_master',
                              is_async=False,
                              wait_for_complete=False,
                              logger=logging.getLogger('wazuh-api')
                              )
        result = raise_if_exc(pool.submit(asyncio.run, dapi.distribute_function()).result())

        current_rbac_mode = result['rbac_mode']
        current_expiration_time = result['auth_token_exp_timeout']
        if payload['rbac_policies']['rbac_mode'] != current_rbac_mode \
                or (payload['exp'] - payload['nbf']) != current_expiration_time:
            raise Unauthorized(EXPIRED_TOKEN)

        return payload
    except jwt.exceptions.PyJWTError as exc:
        raise Unauthorized(INVALID_TOKEN) from exc



================================================
FILE: api/api/configuration.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import copy
import datetime
import logging
import os
import signal
from typing import Dict, Tuple, Any, List

import yaml
from cryptography import x509
from cryptography.hazmat.backends import default_backend as crypto_default_backend
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives import serialization
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.x509.oid import NameOID
from jsonschema import validate, ValidationError

import wazuh.core.utils as core_utils
from api.api_exception import APIError
from api.constants import CONFIG_FILE_PATH, SECURITY_CONFIG_PATH, API_SSL_PATH
from api.validator import api_config_schema, security_config_schema

CACHE_DEPRECATED_MESSAGE = 'The `cache` API configuration option was deprecated in {release} and will be removed ' \
                           'in the next minor release.'

# Fields that must preserve case sensitivity when converting to lowercase
PRESERVE_CASE_SENSITIVITY_FIELDS = {'https.key', 'https.cert', 'https.ca'}

default_security_configuration = {
    "auth_token_exp_timeout": 900,
    "rbac_mode": "white"
}

default_api_configuration = {
    "host": ["0.0.0.0", "::"],
    "port": 55000,
    "drop_privileges": True,
    "max_upload_size": 10485760,
    "authentication_pool_size": 2,
    "intervals": {
        "request_timeout": 10
    },
    "https": {
        "enabled": True,
        "key": "manager.key",
        "cert": "manager.crt",
        "use_ca": False,
        "ca": "ca.crt",
        "ssl_protocol": "auto",
        "ssl_ciphers": ""
    },
    "logs": {
        "level": "info",
        "format": "plain",
        "max_size": {
            "enabled": False,
            "size": "1M"
        }
    },
    "cors": {
        "enabled": False,
        "source_route": "*",
        "expose_headers": "*",
        "allow_headers": "*",
        "allow_credentials": False,
    },
    "access": {
        "max_login_attempts": 50,
        "block_time": 300,
        "max_request_per_minute": 300
    },
    "upload_configuration": {
        "remote_commands": {
            "localfile": {
                "allow": True,
                "exceptions": []
            },
            "wodle_command": {
                "allow": True,
                "exceptions": []
            }
        },
        "limits": {
            "eps": {
                "allow": True
            }
        },
        "agents": {
            "allow_higher_versions": {
                "allow": True
            }
        },
        "indexer": {
            "allow": True
        }
    }
}


def dict_to_lowercase(mydict: Dict, skip_keys: set = None, prefix: str = ""):
    """Turn all string values of a dictionary to lowercase. Also support nested dictionaries.

    Parameters
    ----------
    mydict : dict
        Dictionary with the values we want to convert.
    skip_keys : set, optional
        Set of keys to skip during the conversion.
    prefix : str, optional
        Prefix to add to the keys when checking skip_keys.
    """
    skip_keys = skip_keys or set()

    for k, val in filter(lambda x: isinstance(x[1], str) or isinstance(x[1], dict), mydict.items()):
        full_key = f"{prefix}.{k}" if prefix else k

        if isinstance(val, dict):
            dict_to_lowercase(mydict[k], skip_keys=skip_keys, prefix=full_key)
        else:
            if full_key not in skip_keys:
                mydict[k] = val.lower()


def append_wazuh_prefixes(dictionary: Dict, path_fields: Dict[Any, List[Tuple[str, str]]]) -> None:
    """Append Wazuh prefix to all path fields in a dictionary.
    Parameters
    ----------
    dictionary : dict
        Dictionary with the API configuration.
    path_fields : dict
        Key: Prefix to append (path)
        Values: Sections of the configuration to append the prefix to.
    """
    for prefix, configurations in path_fields.items():
        for config in configurations:
            try:
                section, subsection = config
                dictionary[section][subsection] = os.path.join(prefix, dictionary[section][subsection])
            except KeyError:
                pass


def fill_dict(default: Dict, config: Dict, json_schema: Dict) -> Dict:
    """Validate and fill a dictionary's missing values using default ones.

    Parameters
    ----------
    default : dict
        Dictionary with default values.
    config : dict
        Dictionary to be filled.
    json_schema : dict
        Jsonschema with allowed properties.

    Returns
    -------
    dict
        Filled dictionary.
    """
    def _update_default_config(default_config: Dict, user_config: Dict) -> Dict:
        """Update default configuration with the values of the user one.

        Parameters
        ----------
        default_config : dict
            Default API configuration.
        user_config : dict
            User API configuration.

        Returns
        -------
        dict
            Merged API configuration.
        """
        for key, value in user_config.items():
            if isinstance(value, dict):
                default_config[key] = _update_default_config(default_config.get(key, {}), value)
            else:
                default_config[key] = value
        return default_config

    try:
        validate(instance=config, schema=json_schema)
    except ValidationError as validation_exc:
        raise APIError(2000, details=validation_exc.message) from None

    return _update_default_config(default, config)


def generate_private_key(private_key_path: str, public_exponent: int = 65537,
                         key_size: int = 2048) -> rsa.RSAPrivateKey:
    """Generate a private key in 'CONFIG_PATH/ssl/manager.key'.

    Parameters
    ----------
    private_key_path : str
        Path where the private key will be generated.
    public_exponent : int, optional
        Key public exponent. Default `65537`
    key_size : int, optional
        Key size. Default `2048`

    Returns
    -------
    rsa.RSAPrivateKey
        Private key.
    """
    key = rsa.generate_private_key(
        public_exponent,
        key_size,
        crypto_default_backend()
    )
    with open(private_key_path, 'wb') as f:
        f.write(key.private_bytes(
            encoding=serialization.Encoding.PEM,
            format=serialization.PrivateFormat.PKCS8,
            encryption_algorithm=serialization.NoEncryption()
        ))
    os.chmod(private_key_path, 0o400)

    return key


def generate_self_signed_certificate(private_key: rsa.RSAPrivateKey, certificate_path: str):
    """Generate a self-signed certificate using a generated private key. The certificate will be created in
    'CONFIG_PATH/ssl/manager.crt'.

    Parameters
    ----------
    private_key : RSAPrivateKey
        Private key.
    certificate_path : str
        Path where the self-signed certificate will be generated.
    """
    # Generate private key
    # Various details about who we are. For a self-signed certificate, the subject and issuer are always the same
    subject = issuer = x509.Name([
        x509.NameAttribute(NameOID.COUNTRY_NAME, u"US"),
        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, u"California"),
        x509.NameAttribute(NameOID.LOCALITY_NAME, u"San Francisco"),
        x509.NameAttribute(NameOID.ORGANIZATION_NAME, u"Wazuh"),
        x509.NameAttribute(NameOID.COMMON_NAME, u"wazuh.com"),
    ])
    cert = x509.CertificateBuilder().subject_name(
        subject
    ).issuer_name(
        issuer
    ).public_key(
        private_key.public_key()
    ).serial_number(
        x509.random_serial_number()
    ).not_valid_before(
        datetime.datetime.now(datetime.timezone.utc)
    ).not_valid_after(
        # Our certificate will be valid for one year
        core_utils.get_utc_now() + datetime.timedelta(days=365)
    ).add_extension(
        x509.SubjectAlternativeName([x509.DNSName(u"localhost")]),
        critical=False,
        # Sign our certificate with our private key
    ).sign(private_key, hashes.SHA256(), crypto_default_backend())
    # Write our certificate out to disk.
    with open(certificate_path, 'wb') as f:
        f.write(cert.public_bytes(serialization.Encoding.PEM))
    os.chmod(certificate_path, 0o400)


def read_yaml_config(config_file: str = CONFIG_FILE_PATH, default_conf: dict = None) -> Dict:
    """Read user API configuration and merge it with the default one.

    Parameters
    ----------
    config_file : str
        Configuration file path.
    default_conf : dict
        Default configuration to be merged with the user's one.

    Returns
    -------
    dict
        API configuration.
    """

    def replace_bools(conf: dict):
        """Replace 'yes' and 'no' strings in configuration for actual booleans.

        Parameters
        ----------
        conf : dict
            Current API configuration.
        """
        for k in conf.keys():
            if isinstance(conf[k], dict):
                replace_bools(conf[k])
            else:
                if isinstance(conf[k], str):
                    if conf[k].lower() == 'yes':
                        conf[k] = True
                    elif conf[k].lower() == 'no':
                        conf[k] = False

    if default_conf is None:
        default_conf = default_api_configuration

    if config_file and os.path.exists(config_file):
        try:
            with open(config_file) as f:
                configuration = yaml.safe_load(f)
            # Replace strings for booleans
            configuration and replace_bools(configuration)
        except IOError as e:
            raise APIError(2004, details=e.strerror) from None
    else:
        configuration = None

    if configuration is None:
        configuration = copy.deepcopy(default_conf)
    else:
        # Convert string values to lowercase except for specific fields
        dict_to_lowercase(configuration, skip_keys=PRESERVE_CASE_SENSITIVITY_FIELDS)

        # Check if cache is enabled
        if configuration.get('cache', {}).get('enabled', {}):
            logger = logging.getLogger('wazuh-api')
            logger.warning(CACHE_DEPRECATED_MESSAGE.format(release="4.8.0"))

        schema = security_config_schema if config_file == SECURITY_CONFIG_PATH else api_config_schema
        configuration = fill_dict(default_conf, configuration, schema)

    # Append Wazuh prefixes to all relative paths in configuration
    append_wazuh_prefixes(configuration, {API_SSL_PATH: [('https', 'key'), ('https', 'cert'), ('https', 'ca')]})

    return configuration


def init_auth_worker():
    """Set authentication pool worker to ignore SIGINT signals to avoid 
    throwing exceptions when shutting down the API in foreground mode."""
    signal.signal(signal.SIGINT, signal.SIG_IGN)


# Check if the default configuration is valid according to its jsonschema, so we are forced to update the schema if any
# change is performed to the configuration.
try:
    validate(instance=default_security_configuration, schema=security_config_schema)
    validate(instance=default_api_configuration, schema=api_config_schema)
except ValidationError as e:
    raise APIError(2000, details=e.message) from None

# Configuration - global object
api_conf = read_yaml_config()
security_conf = read_yaml_config(config_file=SECURITY_CONFIG_PATH, default_conf=default_security_configuration)



================================================
FILE: api/api/constants.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import os

from wazuh.core import common

API_PATH = os.path.join(common.WAZUH_PATH, 'api')
CONFIG_PATH = os.path.join(API_PATH, 'configuration')
CONFIG_FILE_PATH = os.path.join(CONFIG_PATH, 'api.yaml')
RELATIVE_CONFIG_FILE_PATH = os.path.relpath(CONFIG_FILE_PATH, common.WAZUH_PATH)
SECURITY_PATH = os.path.join(CONFIG_PATH, 'security')
SECURITY_CONFIG_PATH = os.path.join(SECURITY_PATH, 'security.yaml')
RELATIVE_SECURITY_PATH = os.path.relpath(SECURITY_PATH, common.WAZUH_PATH)
API_LOG_PATH = os.path.join(common.WAZUH_PATH, 'logs', 'api')
API_SSL_PATH = os.path.join(CONFIG_PATH, 'ssl')
INSTALLATION_UID_PATH = os.path.join(SECURITY_PATH, 'installation_uid')
INSTALLATION_UID_KEY = 'installation_uid'
UPDATE_INFORMATION_KEY = 'update_information'



================================================
FILE: api/api/encoder.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import json

import six
from connexion.jsonifier import JSONEncoder

from api.models.base_model_ import Model
from wazuh.core.results import AbstractWazuhResult


class WazuhAPIJSONEncoder(JSONEncoder):
    """"
    Define the custom Wazuh API JSON encoder class.
    """
    include_nulls = False

    def default(self, o: object) -> dict:
        """Override the default method of the JSONEncoder class.

        Parameters
        ----------
        o : object
            Object to be encoded as JSON.

        Returns
        -------
        dict
            Dictionary representing the object.
        """
        if isinstance(o, Model):
            result = {}
            for attr, _ in six.iteritems(o.swagger_types):
                value = getattr(o, attr)
                if value is None and not self.include_nulls:
                    continue
                attr = o.attribute_map[attr]
                result[attr] = value
            return result
        elif isinstance(o, AbstractWazuhResult):
            return o.render()
        return JSONEncoder.default(self, o)


def dumps(obj: object) -> str:
    """Get a JSON encoded str from an object.

    Parameters
    ----------
    obj: object
        Object to be encoded in a JSON string.

    Raises
    ------
    TypeError

    Returns
    -------
    str
    """
    return json.dumps(obj, cls=WazuhAPIJSONEncoder)


def prettify(obj: object) -> str:
    """Get a prettified JSON encoded str from an object.

    Parameters
    ----------
    obj: object
        Object to be encoded in a JSON string.

    Raises
    ------
    TypeError

    Returns
    -------
    str
    """
    return json.dumps(obj, cls=WazuhAPIJSONEncoder, indent=3)



================================================
FILE: api/api/error_handler.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

from connexion.lifecycle import ConnexionRequest, ConnexionResponse
from connexion import exceptions

import jwt
from content_size_limit_asgi.errors import ContentSizeExceeded

from api import configuration
from api.middlewares import ip_block, ip_stats, LOGIN_ENDPOINT, RUN_AS_LOGIN_ENDPOINT
from api.api_exception import BlockedIPException, MaxRequestsException, ExpectFailedException
from api.controllers.util import json_response, ERROR_CONTENT_TYPE
from wazuh.core.utils import get_utc_now


def prevent_bruteforce_attack(request: ConnexionRequest, attempts: int = 5):
    """Check that the IPs that are requesting an API token do not do so repeatedly.

    Parameters
    ----------
    request : ConnexionRequest
        HTTP request.
    attempts : int
        Number of attempts until an IP is blocked.
    """

    if request.scope['path'] in {LOGIN_ENDPOINT, RUN_AS_LOGIN_ENDPOINT} and \
            request.method in {'GET', 'POST'}:
        if request.client.host not in ip_stats:
            ip_stats[request.client.host] = dict()
            ip_stats[request.client.host]['attempts'] = 1
            ip_stats[request.client.host]['timestamp'] = get_utc_now().timestamp()
        else:
            ip_stats[request.client.host]['attempts'] += 1

        if ip_stats[request.client.host]['attempts'] >= attempts:
            ip_block.add(request.client.host)


def _cleanup_detail_field(detail: str) -> str:
    """Replace double endlines with '. ' and simple endlines with ''.

    Parameters
    ----------
    detail : str
        String to be modified.

    Returns
    -------
    str
        New value for the detail field.
    """
    return ' '.join(str(detail).replace("\n\n", ". ").replace("\n", "").split())


async def expect_failed_error_handler(request: ConnexionRequest, exc: ExpectFailedException) -> ConnexionResponse:
    """Handler for the 'Expect' HTTP header.
    
    Parameters
    ----------
    request : ConnexionRequest
        Incoming request.

    Returns
    -------
    Response
        HTTP Response returned to the client.
    """
    problem = {
        "title": "Expectation failed",
    }
    if exc.detail:
        problem['detail'] = exc.detail

    return json_response(data=problem, pretty=request.query_params.get('pretty', 'false') == 'true',
                         status_code=exc.status, content_type=ERROR_CONTENT_TYPE)


async def unauthorized_error_handler(request: ConnexionRequest,
                                     exc: exceptions.Unauthorized) -> ConnexionResponse:
    """Unauthorized Exception Error handler.
    
    Parameters
    ----------
    request : ConnexionRequest
        Incomming request.
    exc : Unauthorized
        Raised exception.
 
    Returns
    -------
    Response
        HTTP Response returned to the client.
    """
    problem = {
        "title": "Unauthorized",
    }
    if request.scope['path'] in {LOGIN_ENDPOINT, RUN_AS_LOGIN_ENDPOINT} and \
        request.method in {'GET', 'POST'}:
        problem["detail"] = "Invalid credentials"

        prevent_bruteforce_attack(
            request=request,
            attempts=configuration.api_conf['access']['max_login_attempts']
        )
    else:
        problem.update({'detail': exc.detail} \
                            if 'token_info' not in request.context \
                            else {})
    return json_response(data=problem, pretty=request.query_params.get('pretty', 'false') == 'true',
                         status_code=exc.status_code, content_type=ERROR_CONTENT_TYPE)


async def http_error_handler(request: ConnexionRequest,
                             exc: exceptions.HTTPException) -> ConnexionResponse:
    """HTTPError Exception Error handler.
    
    Parameters
    ----------
    request : ConnexionRequest
        Incomming request.
    exc : HTTPException
        Raised exception.

    Returns
    -------
    Response
        HTTP Response returned to the client.
    """

    problem = {
        'title': exc.detail,
        "detail": f"{exc.status_code}: {exc.detail}",
    }
    return json_response(data=problem, pretty=request.query_params.get('pretty', 'false') == 'true',
                         status_code=exc.status_code, content_type=ERROR_CONTENT_TYPE)


async def problem_error_handler(request: ConnexionRequest, exc: exceptions.ProblemException) -> ConnexionResponse:
    """ProblemException Error handler.
    
    Parameters
    ----------
    request : ConnexionRequest
        Incomming request.
    exc : ProblemException
        Raised exception.

    Returns
    -------
    Response
        HTTP Response returned to the client.
    """
    problem = {
        "title": exc.title if exc.title else 'Bad Request',
        "detail": exc.detail if isinstance(exc.detail, dict) else _cleanup_detail_field(exc.detail)
    }
    problem.update({"type": exc.type} if (exc.type and exc.type != 'about:blank') else {})
    problem.update(exc.ext if exc.ext else {})
    if isinstance(problem['detail'], dict):
        for field in ['status', 'type']:
            if field in problem['detail']:
                problem['detail'].pop(field)
    if 'code' in problem:
        problem['error'] = problem.pop('code')
    if not problem['detail']:
        del problem['detail']

    return json_response(data=problem, pretty=request.query_params.get('pretty', 'false') == 'true',
                         status_code=exc.__dict__['status'], content_type=ERROR_CONTENT_TYPE)


async def content_size_handler(request: ConnexionRequest, exc: ContentSizeExceeded) -> ConnexionResponse:
    """Content size error handler.
    
    Parameters
    ----------
    request : ConnexionRequest
        Incomming request.
    exc : ContentSizeExceeded
        Raised exception.

    Returns
    -------
    Response
        Returns status code 413 if the maximum upload file size is exceeded.
    """
    problem = {
        "title": "Content size exceeded.",
        "detail": str(exc)
    }
    return json_response(data=problem, pretty=request.query_params.get('pretty', 'false') == 'true',
                         status_code=413, content_type=ERROR_CONTENT_TYPE)



================================================
FILE: api/api/middlewares.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import binascii
import json
import hashlib
import time
import logging
import base64
import jwt

from starlette.requests import Request
from starlette.responses import Response
from starlette.middleware.base import BaseHTTPMiddleware, RequestResponseEndpoint

from connexion.exceptions import OAuthProblem
from connexion.lifecycle import ConnexionRequest
from connexion.security import AbstractSecurityHandler

from secure import Secure, ContentSecurityPolicy, XFrameOptions, Server

from wazuh.core.utils import get_utc_now

from api import configuration
from api.alogging import custom_logging
from api.authentication import generate_keypair, JWT_ALGORITHM
from api.api_exception import BlockedIPException, MaxRequestsException, ExpectFailedException
from api.configuration import default_api_configuration

# Default of the max event requests allowed per minute
MAX_REQUESTS_EVENTS_DEFAULT = 30

# Variable used to specify an unknown user
UNKNOWN_USER_STRING = "unknown_user"

# Run_as login endpoint path
RUN_AS_LOGIN_ENDPOINT = "/security/user/authenticate/run_as"
LOGIN_ENDPOINT = '/security/user/authenticate'

# Authentication context hash key
HASH_AUTH_CONTEXT_KEY = 'hash_auth_context'

# API secure headers
server = Server().set("Wazuh")
csp = ContentSecurityPolicy().set('none')
xfo = XFrameOptions().deny()
secure_headers = Secure(server=server, csp=csp, xfo=xfo)

logger = logging.getLogger('wazuh-api')
start_stop_logger = logging.getLogger('start-stop-api')

ip_stats = dict()
ip_block = set()
general_request_counter = 0
general_current_time = None
events_request_counter = 0
events_current_time = None


async def access_log(request: ConnexionRequest, response: Response, prev_time: time):
    """Generate Log message from the request."""

    time_diff = time.time() - prev_time

    context = request.context if hasattr(request, 'context') else {}
    headers = request.headers if hasattr(request, 'headers') else {}
    path = request.scope.get('path', '') if hasattr(request, 'scope') else ''
    host = request.client.host if hasattr(request, 'client') else ''
    method = request.method if hasattr(request, 'method') else ''
    query = dict(request.query_params) if hasattr(request, 'query_params') else {}
    # If the request content is valid, the _json attribute is set when the
    # first time the json function is awaited. This check avoids raising an
    # exception when the request json content is invalid.
    body = await request.json() if hasattr(request, '_json') else {}
    hash_auth_context = context.get('token_info', {}).get(HASH_AUTH_CONTEXT_KEY, '')

    if 'password' in query:
        query['password'] = '****'
    if 'password' in body:
        body['password'] = '****'
    if 'key' in body and '/agents' in path:
        body['key'] = '****'

    # Get the username from the request. If it is not found in the context, try
    # to get it from the headers using basic or bearer authentication methods.
    if not (user := context.get('user', None)):
        try:
            auth_type, user_passw = AbstractSecurityHandler.get_auth_header_value(request)
            if auth_type == 'basic':
                user, _ = base64.b64decode(user_passw).decode("latin1").split(":", 1)
            elif auth_type == 'bearer':
                s = jwt.decode(user_passw, generate_keypair()[1],
                            algorithms=[JWT_ALGORITHM],
                            audience='Wazuh API REST',
                            options={'verify_exp': False})
                user = s['sub']
                if HASH_AUTH_CONTEXT_KEY in s:
                    hash_auth_context = s[HASH_AUTH_CONTEXT_KEY]
        except (KeyError, IndexError, binascii.Error, jwt.exceptions.PyJWTError, OAuthProblem):
            user = UNKNOWN_USER_STRING

    # Create hash if run_as login
    if not hash_auth_context and path == RUN_AS_LOGIN_ENDPOINT:
        hash_auth_context = hashlib.blake2b(json.dumps(body).encode(),
                                            digest_size=16).hexdigest()

    custom_logging(user, host, method, path, query, body, time_diff, response.status_code,
                   hash_auth_context=hash_auth_context, headers=headers)
    if response.status_code == 403 and \
        path in {LOGIN_ENDPOINT, RUN_AS_LOGIN_ENDPOINT} and \
            method in {'GET', 'POST'}:
        logger.warning(f'IP blocked due to exceeded number of logins attempts: {host}')


def check_blocked_ip(request: Request):
    """Blocks/unblocks the IPs that are requesting an API token.

    Parameters
    ----------
    request : Request
        HTTP request.
    block_time : int
        Block time used to decide if the IP is going to be unlocked.

    """
    global ip_block, ip_stats
    access_conf = configuration.api_conf['access']
    block_time = access_conf['block_time']
    try:
        if get_utc_now().timestamp() - block_time >= ip_stats[request.client.host]['timestamp']:
            del ip_stats[request.client.host]
            ip_block.remove(request.client.host)
    except (KeyError, ValueError):
        pass
    if request.client.host in ip_block:
        raise BlockedIPException(
            status=403,
            title="Permission Denied",
            detail="Limit of login attempts reached. The current IP has been blocked due "
                    "to a high number of login attempts")


def check_rate_limit(
    request_counter_key: str,
    current_time_key: str,
    max_requests: int,
    error_code: int
) -> int:
    """Check that the maximum number of requests per minute
    passed in `max_requests` is not exceeded.

    Parameters
    ----------
    request_counter_key : str
        Key of the request counter variable to get from globals() dict.
    current_time_key : str
        Key of the current time variable to get from globals() dict.
    max_requests : int
        Maximum number of requests per minute permitted.
    error_code : int
        error code to return if the counter is greater than max_requests.

    Return
    ------
        0 if the counter is greater than max_requests
        else error_code.
    """
    if not globals()[current_time_key]:
        globals()[current_time_key] = get_utc_now().timestamp()

    if get_utc_now().timestamp() - 60 <= globals()[current_time_key]:
        globals()[request_counter_key] += 1
    else:
        globals()[request_counter_key] = 0
        globals()[current_time_key] = get_utc_now().timestamp()

    if globals()[request_counter_key] > max_requests:
        return error_code

    return 0


class CheckRateLimitsMiddleware(BaseHTTPMiddleware):
    """Rate Limits Middleware."""

    async def dispatch(self, request: Request, call_next: RequestResponseEndpoint) -> Response:
        """"Check request limits per minute."""
        max_request_per_minute = configuration.api_conf['access']['max_request_per_minute']
        error_code = check_rate_limit(
            'general_request_counter',
            'general_current_time',
            max_request_per_minute,
            6001)

        if request.url.path == '/events':
            error_code = check_rate_limit(
                'events_request_counter',
                'events_current_time',
                MAX_REQUESTS_EVENTS_DEFAULT,
                6005)

        if error_code:
            raise MaxRequestsException(code=error_code)
        else:
            return await call_next(request)


class CheckBlockedIP(BaseHTTPMiddleware):
    """Rate Limits Middleware."""

    async def dispatch(self, request: Request, call_next: RequestResponseEndpoint) -> Response:
        """"Update and check if the client IP is locked."""
        if request.url.path in {LOGIN_ENDPOINT, RUN_AS_LOGIN_ENDPOINT} \
           and request.method in {'GET', 'POST'}:
            check_blocked_ip(request)
        return await call_next(request)


class WazuhAccessLoggerMiddleware(BaseHTTPMiddleware):
    """Middleware to log custom Access messages."""

    async def dispatch(self, request: Request, call_next: RequestResponseEndpoint) -> Response:
        """Log Wazuh access information.

        Parameters
        ----------
        request : Request
            HTTP Request received.
        call_next :  RequestResponseEndpoint
            Endpoint callable to be executed.

        Returns
        -------
        Response
            Returned response.
        """
        prev_time = time.time()

        body = await request.body()
        if body:
            try:
                # Load the request body to the _json field before calling the controller so it's cached before the stream 
                # is consumed. If there's a json error we skip it so it's handled later.
                # Related to https://github.com/wazuh/wazuh/issues/24060.
                _ = await request.json()
            except json.decoder.JSONDecodeError:
                pass

        response = await call_next(request)
        await access_log(ConnexionRequest.from_starlette_request(request), response, prev_time)
        return response


class SecureHeadersMiddleware(BaseHTTPMiddleware):
    """Secure headers Middleware."""

    async def dispatch(self, request: Request, call_next: RequestResponseEndpoint) -> Response:
        """Check and modifies the response headers with secure package.

        Parameters
        ----------
        request : Request
            HTTP Request received.
        call_next :  RequestResponseEndpoint
            Endpoint callable to be executed.

        Returns
        -------
        Response
            Returned response.
        """
        resp = await call_next(request)
        secure_headers.framework.starlette(resp)
        return resp

class CheckExpectHeaderMiddleware(BaseHTTPMiddleware):
    """Middleware to check for the 'Expect' header in incoming requests."""

    async def dispatch(self, request: ConnexionRequest, call_next: RequestResponseEndpoint) -> Response:
        """Check for specific request headers and generate error 417 if conditions are not met.
                
        Parameters
        ----------
            request : Request
            HTTP Request received.
        call_next :  RequestResponseEndpoint
            Endpoint callable to be executed.
        
        Returns
        -------
            Returned response.
        """
        
        if 'Expect' not in request.headers:
            response = await call_next(request)
            return response
        else:
            expect_value = request.headers["Expect"].lower()
            
            if expect_value != '100-continue':
                raise ExpectFailedException(status=417, title="Expectation failed", detail="Unknown Expect")
            
            if 'Content-Length' in request.headers:
                content_length = int(request.headers["Content-Length"])
                max_upload_size = default_api_configuration["max_upload_size"]
                if content_length > max_upload_size:
                    raise ExpectFailedException(status=417, title="Expectation failed",
                                                detail=f"Maximum content size limit ({max_upload_size}) exceeded "
                                                       f"({content_length} bytes read)")
                
        response = await call_next(request)
        return response
    


================================================
FILE: api/api/pytest.ini
================================================
[pytest]
asyncio_mode=auto



================================================
FILE: api/api/signals.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2
import asyncio
import contextlib
import logging
import os
from functools import wraps
from typing import Callable

from connexion import ConnexionMiddleware
from wazuh.core.common import get_installation_uid
from wazuh.core.cluster.utils import running_in_master_node
from wazuh.core.configuration import update_check_is_enabled
from wazuh.core.manager import query_update_check_service

from asyncinotify import Inotify, Mask

from api import configuration
from api.constants import (
    INSTALLATION_UID_KEY,
    INSTALLATION_UID_PATH,
    UPDATE_INFORMATION_KEY,
    SECURITY_PATH
)
from api.authentication import generate_keypair, _private_key_path, _public_key_path

ONE_DAY_SLEEP = 60*60*24

logger = logging.getLogger('wazuh-api')

cti_context = {}


def cancel_signal_handler(func: Callable) -> Callable:
    """Decorator to handle asyncio.CancelledError for signals coroutines.

    Parameters
    ----------
    func : Callable
        Coroutine to handle.

    Returns
    -------
    Callable
        Wrapped coroutine with exception handled.
    """

    @wraps(func)
    async def wrapper(*args, **kwargs):
        try:
            await func(*args, **kwargs)
        except asyncio.CancelledError:
            pass
    return wrapper


@cancel_signal_handler
async def load_installation_uid() -> None:
    """Load the installation UID into the global cti context."""

    global cti_context
    if os.path.exists(INSTALLATION_UID_PATH):
        logger.info("Getting installation UID...")
    else:
        logger.info("Populating installation UID...")
    
    cti_context[INSTALLATION_UID_KEY] = get_installation_uid()


@cancel_signal_handler
async def get_update_information() -> None:
    """Get updates information from Update Check Service and inject into the global cti context."""

    global cti_context
    while True:
        logger.info('Getting updates information...')
        cti_context[UPDATE_INFORMATION_KEY] = await query_update_check_service(cti_context[INSTALLATION_UID_KEY])
        await asyncio.sleep(ONE_DAY_SLEEP)


@cancel_signal_handler
async def clean_auth_keys_cache():
    """Watch for changes in authentication key files and clear the cache of generated keys."""

    FILES = {_private_key_path, _public_key_path}

    with Inotify() as inotify:
        inotify.add_watch(SECURITY_PATH, Mask.MODIFY | Mask.CREATE )
        async for event in inotify:
            if event.path and event.path.as_posix() in FILES:
                generate_keypair.cache_clear()


@contextlib.asynccontextmanager
async def lifespan_handler(_: ConnexionMiddleware):
    """Logs the API startup/shutdown messages and register background tasks."""

    tasks: list[asyncio.Task] = []

    if running_in_master_node():
        tasks.append(asyncio.create_task(load_installation_uid()))
        if update_check_is_enabled():
            tasks.append(asyncio.create_task(get_update_information()))

    tasks.append(asyncio.create_task(clean_auth_keys_cache()))

    # Log the initial server startup message.
    logger.info(f'Listening on {configuration.api_conf["host"]}:{configuration.api_conf["port"]}.')

    yield

    for task in tasks:
        task.cancel()
        await task

    logger.info('Shutdown wazuh-manager-apid server.')



================================================
FILE: api/api/uri_parser.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

from connexion.uri_parsing import OpenAPIURIParser

LOWER_FIELDS = ('component', 'configuration', 'hash', 'requirement', 'status', 'type',
                'section', 'tag', 'level', 'resource')

class APIUriParser(OpenAPIURIParser):
    """Sanitize parameters class."""

    def resolve_params(self, params, _in):
        """Sanitizes the lower_fields parameters converting keys and values to lowercase."""

        # Transform to lowercase the values for query parameter's spec.yaml enums
        params.update(
            {k.lower(): [list_item.lower() for list_item in v] if isinstance(v, list) else v.lower()
                for k, v in params.items() if k in LOWER_FIELDS}
        )

        return super().resolve_params(params, _in)



================================================
FILE: api/api/util.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import logging
import datetime
import os
import typing
from functools import wraps
from typing import Union

import six
from connexion import ProblemException

from wazuh.core import common, exception

logger = logging.getLogger('wazuh-api')


def serialize(item: object) -> object:
    """Serialize item when it is a datetime object.

    Parameters
    ----------
    item : object
        Object to serialize.

    Returns
    -------
    object
        Serialized item.
    """
    try:
        if isinstance(item, datetime.datetime):
            return item.replace(tzinfo=datetime.timezone.utc).isoformat(sep='T', timespec='seconds')
        else:
            return item
    except Exception:
        return item


def _deserialize(data: Union[dict, list, str], klass: type) -> object:
    """Deserialize dict, list, str into an object.

    Parameters
    ----------
    data : dict or list or str
        dict, list or str to deserialize.
    klass : type
        Class literal, or string of class name.

    Returns
    -------
    object
        Deserialized object.
    """
    if data is None:
        return None

    if klass in six.integer_types or klass in (float, str, bool):
        return _deserialize_primitive(data, klass)
    elif klass == object or klass == dict:
        return _deserialize_object(data)
    elif klass == datetime.date:
        return deserialize_date(data)
    elif klass == datetime.datetime:
        return deserialize_datetime(data)
    elif hasattr(klass, '__origin__'):
        if klass.__origin__ == list:
            return _deserialize_list(data, klass.__args__[0])
        if klass.__origin__ == dict:
            return _deserialize_dict(data, klass.__args__[1])
    else:
        return deserialize_model(data, klass)


def _deserialize_primitive(data: Union[dict, list, str], klass: type) -> Union[int, float, str, bool]:
    """Deserialize to primitive type.

    Parameters
    ----------
    data : dict or list or str
        dict, list or str to deserialize.
    klass : type
        Class literal, or string of class name.

    Returns
    -------
    int or float or str or bool
        Deserialized data.
    """
    try:
        value = klass(data)
    except UnicodeEncodeError:
        value = six.u(data)
    except TypeError:
        value = data
    return value


def _deserialize_object(value: object) -> object:
    """Return a original value.

    Parameters
    ----------
    value : object
        Object to be deserialized.

    Returns
    -------
    object
        Original object.
    """
    return value


def deserialize_date(string: str) -> Union[datetime.date, str]:
    """Deserialize string to date.

    Parameters
    ----------
    string : object
        String to be deserialized to date.

    Returns
    -------
    datetime.date or str
        Deserialized date or string in case of ImportError.
    """
    try:
        from dateutil.parser import parse
        return parse(string).date()
    except ImportError:
        return string


def deserialize_datetime(string: str) -> Union[datetime.datetime, str]:
    """Deserialize string to datetime.

    The string should be in iso8601 datetime format.

    Parameters
    ----------
    string : object
        String to be deserialized to date.

    Returns
    -------
    datetime.datetime or str
        Deserialized datetime or string in case of ImportError.
    """
    try:
        from dateutil.parser import parse
        return parse(string)
    except ImportError:
        return string


def deserialize_model(data: Union[list, dict], klass: type):
    """Deserialize list or dict to Model.

    Parameters
    ----------
    data : list or dict
        dict, list or str to deserialize.
    klass : type
        Class literal, or string of class name.

    Returns
    -------
    Model or list or dict
        Deserialized data to Model or data without changes.
    """
    instance = klass()

    if not instance.swagger_types:
        return data

    for attr, attr_type in six.iteritems(instance.swagger_types):
        if data is not None \
                and instance.attribute_map[attr] in data \
                and isinstance(data, (list, dict)):
            value = data[instance.attribute_map[attr]]
            setattr(instance, attr, _deserialize(value, attr_type))

    return instance


def _deserialize_list(data: list, boxed_type: type) -> list:
    """Deserialize a list and its elements.

    Parameters
    ----------
    data : list
        list to deserialize.
    boxed_type : type
        Class literal.

    Returns
    -------
    list
        Deserialized list.
    """
    return [_deserialize(sub_data, boxed_type)
            for sub_data in data]


def _deserialize_dict(data: dict, boxed_type: type) -> dict:
    """Deserialize a dict and its elements.

    Parameters
    ----------
    data : dict
        dict to deserialize.
    boxed_type : type
        Class literal.

    Returns
    -------
    dict
        Deserialized dict.
    """
    return {k: _deserialize(v, boxed_type)
            for k, v in six.iteritems(data)}


def remove_nones_to_dict(dct: dict) -> dict:
    """Remove None values from a dict recursively.

    Parameters
    ----------
    dct : dict
        Dictionary with the None values to be removed.

    Returns
    -------
    dict
        Dictionary with the None values removed.
    """
    return {k: v if not isinstance(v, dict) else remove_nones_to_dict(v)
            for k, v in dct.items() if v is not None}


def parse_api_param(param: str, param_type: str) -> Union[typing.Dict, None]:
    """Parse a str parameter from the API query and returns a dictionary the framework can process.

    Parameters
    ----------
    param : str
        String parameter coming from the API.
    param_type : str
        Type of parameter: search or sort.

    Returns
    -------
    dict
        Dictionary that the framework can process.
    """
    if param is not None:
        my_func = f'_parse_{param_type}_param'
        parser = globals().get(my_func, lambda x: x)
        return parser(param)
    else:
        return param


def _parse_search_param(search: str) -> typing.Dict:
    """Parse search str param coming from the API query into a dictionary the framework can process.

    Parameters
    ----------
    search : str
        Search parameter coming from the API query.

    Returns
    -------
    dict
        Dictionary that the framework can process.
    """
    negation = search[0] == '-'
    return {'negation': negation, 'value': search[1:] if negation else search}


def _parse_sort_param(sort: str) -> typing.Dict:
    """Parse sort str param coming from the API query into a dictionary the framework can process.

    Parameters
    ----------
    sort : str
        Sort parameter coming from the API query.

    Returns
    -------
    dict
        Dictionary that the framework can process.
    """
    sort_fields = sort[(1 if sort[0] == '-' or sort[0] == '+' else 0):]
    return {'fields': sort_fields.split(','), 'order': 'desc' if sort[0] == '-' else 'asc'}


def _parse_q_param(query: str) -> str:
    """Search and parse q parameter inside the query string.

    Parameters
    ----------
    query : str
        String query which can contain q parameter.

    Returns
    -------
    str
        Parsed query.
    """
    q = next((q for q in query.split('&') if q.startswith('q=')), None)

    if q:
        return q[2:]


def to_relative_path(full_path: str) -> str:
    """Return a relative path from Wazuh base directory.

    Parameters
    ----------
    full_path : str
        Full path.

    Returns
    -------
    str
        Relative path from Wazuh base directory.
    """
    return os.path.relpath(full_path, common.WAZUH_PATH)


def _create_problem(exc: Exception, code: int = None):
    """Transform an exception into a ProblemException according to `exc`.

    Parameters
    ----------
    exc : Exception
        If `exc` is an instance of `WazuhException` it will be casted into a ProblemException,
        otherwise it will be raised.
    code : int
        HTTP status code for this response.

    Raises
    ------
    Exception
        ProblemException or `exc` exception type.
    """
    ext = None
    if isinstance(exc, exception.WazuhException):
        ext = remove_nones_to_dict({'remediation': exc.remediation,
                                    'code': exc.code,
                                    'dapi_errors': exc.dapi_errors if exc.dapi_errors != {} else None
                                    })

    if isinstance(exc, exception.WazuhInternalError):
        raise ProblemException(status=500 if not code else code,
                               type=exc.type, title=exc.title, detail=exc.message, ext=ext)
    elif isinstance(exc, exception.WazuhPermissionError):
        raise ProblemException(status=403, type=exc.type, title=exc.title, detail=exc.message, ext=ext)
    elif isinstance(exc, exception.WazuhResourceNotFound):
        raise ProblemException(status=404, type=exc.type, title=exc.title, detail=exc.message, ext=ext)
    elif isinstance(exc, exception.WazuhTooManyRequests):
        raise ProblemException(status=429, type=exc.type, title=exc.title, detail=exc.message, ext=ext)
    elif isinstance(exc, exception.WazuhNotAcceptable):
        raise ProblemException(status=406, type=exc.type, title=exc.title, detail=exc.message, ext=ext)
    elif isinstance(exc, exception.WazuhError):
        raise ProblemException(status=400 if not code else code,
                               type=exc.type, title=exc.title, detail=exc.message, ext=ext)

    raise exc


def raise_if_exc(obj: object) -> Union[object, None]:
    """Check if obj is an Exception and raises it. Otherwise it is returned.

    Parameters
    ----------
    obj : object
        Object to be checked

    Returns
    -------
    object
        An object only if obj is not an Exception instance.
    """
    if isinstance(obj, Exception):
        _create_problem(obj)
    else:
        return obj


def get_invalid_keys(original_dict: dict, des_dict: dict) -> set:
    """Return a set with the keys from `original_dict` that are not present in `des_dict`.

    Parameters
    ----------
    original_dict : dict
        Original dictionary.
    des_dict : dict
        Deserialized dictionary with the model keys.

    Returns
    -------
    set
        Set with the invalid keys.
    """
    invalid_keys = set()

    for key in original_dict:
        if isinstance(original_dict[key], dict):
            try:
                invalid_keys.update(get_invalid_keys(original_dict[key], des_dict[key]))
            except KeyError:
                invalid_keys.add(key)
        else:
            if key not in set(des_dict):
                invalid_keys.add(key)

    return invalid_keys


def deprecate_endpoint(link: str = ''):
    """Decorator to add deprecation headers to API response.

    Parameters
    ----------
    link : str
        Documentation related to this deprecation.
    """

    def add_deprecation_headers(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            api_response = await func(*args, **kwargs)

            api_response.headers['Deprecated'] = 'true'
            if link:
                api_response.headers['Link'] = f'<{link}>; rel="Deprecated"'

            return api_response

        return wrapper

    return add_deprecation_headers



================================================
FILE: api/api/validator.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import os
import re
from types import MappingProxyType
from typing import Dict, List

from defusedxml import ElementTree as ET
from jsonschema import Draft4Validator

from wazuh.core import common
from wazuh.core.exception import WazuhError

_alphanumeric_param = re.compile(r'^[\w,\-.+\s:]+$')
_symbols_alphanumeric_param = re.compile(r'^[\w,*<>!\-.+\s:/()\[\]\'\"|=~#]+$')
_base64 = re.compile(r'^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$')
_group_names = re.compile(r'^(?!^(\.{1,2}|all)$)[A-Za-z0-9.\-_]+$')
_group_names_or_all = re.compile(r'^(?!^\.{1,2}$)[A-Za-z0-9.\-_]+$')
_hashes = re.compile(r'^(?:[\da-fA-F]{32})?$|(?:[\da-fA-F]{40})?$|(?:[\da-fA-F]{56})?$|(?:[\da-fA-F]{64})?$|(?:['
                     r'\da-fA-F]{96})?$|(?:[\da-fA-F]{128})?$')
_iso8601_date = re.compile(r'^([0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])$')
_iso8601_date_time = re.compile(
    r'^([0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])[tT](2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(\.['
    r'0-9]+)?([zZ]|[+-](?:2[0-3]|[01][0-9]):[0-5][0-9])$')
_names = re.compile(r'^[\w\-.%]+$', re.ASCII)
_numbers = re.compile(r'^\d+$')
_numbers_or_all = re.compile(r'^(\d+|all)$')
_wazuh_key = re.compile(r'[a-zA-Z0-9]+$')
_wazuh_version = re.compile(r'^(?:wazuh |)v?\d+\.\d+\.\d+$', re.IGNORECASE)
_paths = re.compile(r'^[\w\-.\\/:]+$')
_query_param = re.compile(r"^[\w.\-]+(?:=|!=|<|>|~)[\w.\- ]+(?:[;,][\w.\-]+(?:=|!=|<|>|~)[\w.\- ]+)*$")
_ranges = re.compile(r'[\d]+$|^[\d]{1,2}-[\d]{1,2}$')
_search_param = re.compile(r'^[^;|&^*>]+$')
_sort_param = re.compile(r'^[\w_\-,\s+.]+$')
_timeframe_type = re.compile(r'^(\d+[dhms]?)$')
_wpk_path = re.compile(r'^[\w\-.\\/:\s]*[^\/]\.wpk$')
_active_response_command = re.compile(f"^!?{_paths.pattern.lstrip('^')}")

security_config_schema = {
    "type": "object",
    "additionalProperties": False,
    "properties": {
        "auth_token_exp_timeout": {"type": "integer"},
        "rbac_mode": {"type": "string", "enum": ["white", "black"]}
    }
}

api_config_schema = {
    "type": "object",
    "additionalProperties": False,
    "properties": {
        "host": {"type": "array", "items": {"type": "string"}},
        "port": {"type": "number"},
        "use_only_authd": {"type": "boolean"},  # Deprecated. To be removed on later versions
        "drop_privileges": {"type": "boolean"},
        "max_upload_size": {"type": "integer", "minimum": 0},
        "authentication_pool_size": {"type": "integer", "minimum": 1, "maximum": 50},
        "intervals": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "request_timeout": {"type": "number", "minimum": 0}
            },
        },
        "https": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "enabled": {"type": "boolean"},
                "key": {"type": "string",
                        "pattern": r"^[\w\-.]+$"},
                "cert": {"type": "string",
                         "pattern": r"^[\w\-.]+$"},
                "use_ca": {"type": "boolean"},
                "ca": {"type": "string",
                       "pattern": r"^[\w\-.]+$"},
                "ssl_protocol": {"type": "string", "enum": ["tls", "tlsv1", "tlsv1.1", "tlsv1.2", "TLS",
                                                            "TLSv1", "TLSv1.1", "TLSv1.2", "auto", "AUTO"]},
                "ssl_ciphers": {"type": "string"}
            },
        },
        "logs": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "level": {"type": "string"},
                "path": {"type": "string"},  # Deprecated. To be removed on later versions
                "format": {"type": "string", "enum": ["plain", "json", "plain,json", "json,plain"]},
                "max_size": {
                    "type": "object",
                    "additionalProperties": False,
                    "properties": {
                        "enabled": {"type": "boolean"},
                        "size": {"type": "string"}
                    }
                }
            },
        },
        "cors": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "enabled": {"type": "boolean"},
                "source_route": {"type": "string"},
                "expose_headers": {
                    "oneOf": [
                        {"type": "string"},
                        {"type": "array", "items": {"type": "string"}}
                    ]
                },
                "allow_headers": {
                    "oneOf": [
                        {"type": "string"},
                        {"type": "array", "items": {"type": "string"}}
                    ]
                },
                "allow_credentials": {"type": "boolean"},
            },
        },
        "cache": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "enabled": {"type": "boolean"},
                "time": {"type": "number"},
            },
        },
        "access": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "max_login_attempts": {"type": "integer"},
                "block_time": {"type": "integer"},
                "max_request_per_minute": {"type": "integer"},
            },
        },
        "upload_configuration": {
            "type": "object",
            "additionalProperties": False,
            "properties": {
                "remote_commands": {
                    "type": "object",
                    "additionalProperties": False,
                    "properties": {
                        "localfile": {
                            "type": "object",
                            "additionalProperties": False,
                            "properties": {
                                "allow": {"type": "boolean"},
                                "exceptions": {"type": "array", "items": {"type": "string"}},
                            },
                        },
                        "wodle_command": {
                            "type": "object",
                            "additionalProperties": False,
                            "properties": {
                                "allow": {"type": "boolean"},
                                "exceptions": {"type": "array", "items": {"type": "string"}},
                            },
                        },
                    },
                },
                "limits": {
                    "type": "object",
                    "additionalProperties": False,
                    "properties": {
                        "eps": {
                            "type": "object",
                            "additionalProperties": False,
                            "properties": {
                                "allow": {
                                    "type": "boolean"
                                }
                            }
                        }
                    }
                },
                "agents": {
                    "type": "object",
                    "additionalProperties": False,
                    "properties": {
                        "allow_higher_versions": {
                            "type": "object",
                            "additionalProperties": False,
                            "properties": {
                                "allow": {
                                    "type": "boolean"
                                }
                            },
                        }
                    }
                },
                "indexer": {
                    "type": "object",
                    "additionalProperties": False,
                    "properties": {
                        "allow": {
                            "type": "boolean"
                        }
                    }
                }
            }
        }
    }
}

WAZUH_COMPONENT_CONFIGURATION_MAPPING = MappingProxyType(
    {
        'agent': {"client", "buffer", "labels", "internal", "anti_tampering"},
        'analysis': {"global", "active_response", "alerts", "command", "internal"},
        'auth': {"auth"},
        'com': {"active-response", "logging", "internal", "cluster"},
        'logcollector': {"localfile", "socket", "internal"},
        'mail': {"global", "alerts", "internal"},
        'monitor': {"global", "internal", "reports"},
        'request': {"global", "remote", "internal"},
        'syscheck': {"syscheck", "rootcheck", "internal"},
        'wazuh-manager-db': {"wdb", "internal"},
        'wmodules': {"wmodules"}
    }
)


def check_exp(exp: str, regex: re.Pattern) -> bool:
    """Function to check if an expression matches a regex.

    Parameters
    ----------
    exp : str
        Expression to check.
    regex : re.Pattern
        Regular Expression used to do the matching.

    Returns
    -------
    bool
        True if expression is matched. False otherwise.
    """
    if not isinstance(exp, str):
        return True
    return regex.match(exp) is not None


def check_xml(xml_string: str) -> bool:
    """Function to check if an XML string is correct.

    Parameters
    ----------
    xml_string : str
        XML string to check.

    Returns
    -------
    bool
        True if the XML is OK. False otherwise.
    """
    try:
        ET.fromstring(xml_string)
    except ET.ParseError:
        return False
    except Exception:
        return False

    return True


def allowed_fields(filters: Dict) -> List:
    """Return a list with allowed fields.

    Parameters
    ----------
    filters : dict
        Dictionary with valid fields.

    Returns
    -------
    list
        List with allowed filters.
    """
    return [field for field in filters]


def is_safe_path(path: str, basedir: str = common.WAZUH_PATH, relative: bool = True) -> bool:
    """Check if a path is correct.

    Parameters
    ----------
    path : str
        Path to be checked.
    basedir : str
        Wazuh installation directory.
    relative : bool
        True if path is relative. False otherwise (absolute).

    Returns
    -------
    bool
        True if path is correct. False otherwise.
    """
    # Protect path
    forbidden_paths = ["../", "..\\", "/..", "\\.."]
    if any([forbidden_path in path for forbidden_path in forbidden_paths]):
        return False

    # Resolve symbolic links if present
    full_path = os.path.realpath(os.path.join(basedir, path.lstrip("/")) if relative else path)
    full_basedir = os.path.abspath(basedir)

    return os.path.commonpath([full_path, full_basedir]) == full_basedir


def check_component_configuration_pair(component: str, configuration: str) -> WazuhError:
    """

    Parameters
    ----------
    component : str
        Wazuh component name.
    configuration : str
        Component configuration.

    Returns
    -------
    WazuhError
        It can either return a `WazuhError` or `None`, depending on the given component and configuration. The exception
        is returned and not raised because we use the object to create a problem on API level.
    """
    if configuration not in WAZUH_COMPONENT_CONFIGURATION_MAPPING[component]:
        return WazuhError(1128, extra_message=f"Valid configuration values for '{component}': "
                                              f"{WAZUH_COMPONENT_CONFIGURATION_MAPPING[component]}")


@Draft4Validator.FORMAT_CHECKER.checks("alphanumeric")
def format_alphanumeric(value):
    return check_exp(value, _alphanumeric_param)


@Draft4Validator.FORMAT_CHECKER.checks("alphanumeric_symbols")
def format_alphanumeric_symbols(value):
    return check_exp(value, _symbols_alphanumeric_param)


@Draft4Validator.FORMAT_CHECKER.checks("base64")
def format_base64(value):
    return check_exp(value, _base64)


@Draft4Validator.FORMAT_CHECKER.checks("hash")
def format_hash(value):
    return check_exp(value, _hashes)


@Draft4Validator.FORMAT_CHECKER.checks("names")
def format_names(value):
    return check_exp(value, _names)


@Draft4Validator.FORMAT_CHECKER.checks("numbers")
def format_numbers(value):
    return check_exp(value, _numbers)


@Draft4Validator.FORMAT_CHECKER.checks("numbers_or_all")
def format_numbers_or_all(value):
    return check_exp(value, _numbers_or_all)


@Draft4Validator.FORMAT_CHECKER.checks("path")
def format_path(value):
    if not is_safe_path(value):
        return False
    return check_exp(value, _paths)


@Draft4Validator.FORMAT_CHECKER.checks("wpk_path")
def format_wpk_path(value):
    if not is_safe_path(value, relative=False):
        return False
    return check_exp(value, _wpk_path)


@Draft4Validator.FORMAT_CHECKER.checks("active_response_command")
def format_active_response_command(command):
    if not is_safe_path(command):
        return False
    return check_exp(command, _active_response_command)


@Draft4Validator.FORMAT_CHECKER.checks("query")
def format_query(value):
    return check_exp(value, _query_param)


@Draft4Validator.FORMAT_CHECKER.checks("range")
def format_range(value):
    return check_exp(value, _ranges)


@Draft4Validator.FORMAT_CHECKER.checks("search")
def format_search(value):
    return check_exp(value, _search_param)


@Draft4Validator.FORMAT_CHECKER.checks("sort")
def format_sort(value):
    return check_exp(value, _sort_param)


@Draft4Validator.FORMAT_CHECKER.checks("timeframe")
def format_timeframe(value):
    return check_exp(value, _timeframe_type)


@Draft4Validator.FORMAT_CHECKER.checks("wazuh_key")
def format_wazuh_key(value):
    return check_exp(value, _wazuh_key)


@Draft4Validator.FORMAT_CHECKER.checks("wazuh_version")
def format_wazuh_version(value):
    return check_exp(value, _wazuh_version)


@Draft4Validator.FORMAT_CHECKER.checks("date")
def format_date(value):
    return check_exp(value, _iso8601_date)


@Draft4Validator.FORMAT_CHECKER.checks("date-time")
def format_datetime(value):
    return check_exp(value, _iso8601_date_time)


@Draft4Validator.FORMAT_CHECKER.checks("hash_or_empty")
def format_hash_or_empty(value):
    return True if value == "" else format_hash(value)


@Draft4Validator.FORMAT_CHECKER.checks("names_or_empty")
def format_names_or_empty(value):
    return True if value == "" else format_names(value)


@Draft4Validator.FORMAT_CHECKER.checks("numbers_or_empty")
def format_numbers_or_empty(value):
    return True if value == "" else format_numbers(value)


@Draft4Validator.FORMAT_CHECKER.checks("date-time_or_empty")
def format_datetime_or_empty(value):
    return True if value == "" else format_datetime(value)


@Draft4Validator.FORMAT_CHECKER.checks("group_names")
def format_group_names(value):
    return check_exp(value, _group_names)


@Draft4Validator.FORMAT_CHECKER.checks("group_names_or_all")
def format_group_names_or_all(value):
    return check_exp(value, _group_names_or_all)



================================================
FILE: api/api/configuration/api.yaml
================================================
# USE THIS FILE AS A TEMPLATE. UNCOMMENT LINES TO APPLY CUSTOM CONFIGURATION

# host: ['0.0.0.0', '::']
# port: 55000

# Advanced configuration

# https:
#  enabled: yes
#  key: "manager.key"
#  cert: "manager.crt"
#  use_ca: False
#  ca: "ca.crt"
#  ssl_protocol: "auto"
#  ssl_ciphers: ""

# Modify API's intervals (time in seconds)
# intervals:
#   request_timeout: 10

# Logging configuration
# Values for API log level: disabled, info, warning, error, debug, debug2 (each level includes the previous level).
# Values for API log max_size: <value><unit>. Valid units: K (kilobytes), M (megabytes)
# Enabling the API log max_size will disable the time based rotation (on midnight)
# logs:
#  level: "info"
#  format: "plain"
#  max_size:
#    enabled: False
#    size: "1M"

# Cross-origin resource sharing: https://www.starlette.io/middleware/#corsmiddleware
# cors:
#  enabled: no
#  source_route: "*"
#  expose_headers: "*"
#  allow_headers: "*"
#  allow_credentials: no

# Access parameters
# access:
#  max_login_attempts: 50
#  block_time: 300
#  max_request_per_minute: 300

# Drop privileges (Run as wazuh-manager user)
# drop_privileges: yes

# Maximum body size that the API can accept, in bytes (0 -> limitless)
# max_upload_size: 10485760

# Number of processes dedicated to processing authentication requests.
# authentication_pool_size: 2

# Uploadable Wazuh configuration sections
# upload_configuration:
#   remote_commands:
#     localfile:
#       allow: yes
#       exceptions: []
#     wodle_command:
#       allow: yes
#       exceptions: []
#   limits:
#     eps:
#       allow: yes
#   agents:
#     allow_higher_versions:
#       allow: yes
#   indexer:
#     allow: yes



================================================
FILE: api/api/controllers/__init__.py
================================================
[Empty file]


================================================
FILE: api/api/controllers/active_response_controller.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import logging

from connexion import request
from connexion.lifecycle import ConnexionResponse

from api.controllers.util import json_response, JSON_CONTENT_TYPE
from api.models.active_response_model import ActiveResponseModel
from api.models.base_model_ import Body
from api.util import remove_nones_to_dict, raise_if_exc
from wazuh.core.cluster.dapi.dapi import DistributedAPI
import wazuh.active_response as active_response

logger = logging.getLogger('wazuh-api')


async def run_command(agents_list: str = '*', pretty: bool = False,
                      wait_for_complete: bool = False) -> ConnexionResponse:
    """Runs an Active Response command on a specified list of agents.

    Parameters
    ----------
    agents_list : str
        List of agents IDs. Default: '*'
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
    """
    # Get body parameters
    Body.validate_content_type(request, expected_content_type=JSON_CONTENT_TYPE)
    f_kwargs = await ActiveResponseModel.get_kwargs(request, additional_kwargs={'agent_list': agents_list})

    dapi = DistributedAPI(f=active_response.run_command,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          broadcasting=agents_list == '*',
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)



================================================
FILE: api/api/controllers/agent_controller.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import logging
import mimetypes
from typing import Union

from connexion import request
from connexion.lifecycle import ConnexionResponse

from api.controllers.util import JSON_CONTENT_TYPE, json_response
from api.models.agent_added_model import AgentAddedModel
from api.models.agent_group_added_model import GroupAddedModel
from api.models.agent_inserted_model import AgentInsertedModel
from api.models.base_model_ import Body
from api.util import deprecate_endpoint, parse_api_param, raise_if_exc, remove_nones_to_dict
from api.validator import check_component_configuration_pair
from wazuh import agent, stats
from wazuh.core.cluster.control import get_system_nodes
from wazuh.core.cluster.dapi.dapi import DistributedAPI
from wazuh.core.common import DATABASE_LIMIT
from wazuh.core.results import AffectedItemsWazuhResult

logger = logging.getLogger('wazuh-api')


async def delete_agents(pretty: bool = False, wait_for_complete: bool = False, agents_list: str = None,
                        purge: bool = False, status: str = None, q: str = None, older_than: str = None,
                        manager: str = None, version: str = None, group: str = None, node_name: str = None,
                        name: str = None, ip: str = None) -> ConnexionResponse:
    """Delete all agents or a list of them based on optional criteria.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agents_list : str
        List of agents IDs. If the 'all' keyword is indicated, all the agents are deleted.
    purge : bool
        Delete an agent from the key store.
    status : str
        Filter by agent status. Use commas to filter by multiple statuses.
    q : str
        Query to filter agents by.
    older_than : str
        Filter out disconnected agents for longer than specified. Time in seconds, ‘[n_days]d’,
        ‘[n_hours]h’, ‘[n_minutes]m’ or ‘[n_seconds]s’. For never_connected agents, use the register date.
    manager : str
        Filter by the name of the manager to which agents are connected.
    version : str
        Filter by agents version.
    group : str
        Filter by group of agents.
    node_name : str
        Filter by node name.
    name : str
        Filter by agent name.
    ip : str
        Filter by agent IP.

    Returns
    -------
    ConnexionResponse
        Agents which have been deleted.
    """
    if 'all' in agents_list:
        agents_list = None
    f_kwargs = {'agent_list': agents_list,
                'purge': purge,
                'filters': {
                    'status': status,
                    'older_than': older_than,
                    'manager': manager,
                    'version': version,
                    'group': group,
                    'node_name': node_name,
                    'name': name,
                    'ip': ip,
                    'registerIP': request.query_params.get('registerIP', None)
                },
                'q': q
                }

    # Add nested fields to kwargs filters
    nested = ['os.version', 'os.name', 'os.platform']
    for field in nested:
        f_kwargs['filters'][field] = request.query_params.get(field, None)

    dapi = DistributedAPI(f=agent.delete_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agents(pretty: bool = False, wait_for_complete: bool = False, agents_list: str = None,
                     offset: int = 0, limit: int = DATABASE_LIMIT, select: str = None, sort: str = None,
                     search: str = None, status: str = None, q: str = None, older_than: str = None, manager: str = None,
                     version: str = None, group: str = None, node_name: str = None, name: str = None, ip: str = None,
                     group_config_status: str = None, distinct: bool = False) -> ConnexionResponse:
    """Get information about all agents or a list of them.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agents_list : list
        List of agents IDs.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return. Default: DATABASE_LIMIT
    select : str
        Select which fields to return (separated by comma).
    sort : str
        Sort the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Look for elements with the specified string.
    status : str
        Filter by agent status. Use commas to enter multiple statuses.
    q : str
        Query to filter results by. For example "q&#x3D;&amp;quot;status&#x3D;active&amp;quot;".
    older_than : str
        Filter out disconnected agents for longer than specified. Time in seconds, ‘[n_days]d’,
        ‘[n_hours]h’, ‘[n_minutes]m’ or ‘[n_seconds]s’. For never_connected agents, use the register date.
    manager : str
        Filter by manager hostname to which agents are connected.
    version : str
        Filter by agents version.
    group : str
        Filter by agent group.
    node_name : str
        Filter by node name.
    name : str
        Filter by agent name.
    ip : str
        Filter by agent IP.
    group_config_status : str
        Filter by agent groups configuration sync status.
    distinct : bool
        Look for distinct values.

    Returns
    -------
    ConnexionResponse
        Response with all selected agents' information.
    """
    f_kwargs = {'agent_list': agents_list,
                'offset': offset,
                'limit': limit,
                'sort': parse_api_param(sort, 'sort'),
                'search': parse_api_param(search, 'search'),
                'select': select,
                'filters': {
                    'status': status,
                    'older_than': older_than,
                    'manager': manager,
                    'version': version,
                    'group': group,
                    'node_name': node_name,
                    'name': name,
                    'ip': ip,
                    'registerIP': request.query_params.get('registerIP', None),
                    'group_config_status': group_config_status
                },
                'q': q,
                'distinct': distinct
                }
    # Add nested fields to kwargs filters
    nested = ['os.version', 'os.name', 'os.platform']
    for field in nested:
        f_kwargs['filters'][field] = request.query_params.get(field, None)

    dapi = DistributedAPI(f=agent.get_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def add_agent(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Add a new Wazuh agent.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    # Get body parameters
    Body.validate_content_type(request, expected_content_type=JSON_CONTENT_TYPE)
    f_kwargs = await AgentAddedModel.get_kwargs(request)

    dapi = DistributedAPI(f=agent.add_agent,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )

    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def reconnect_agents(pretty: bool = False, wait_for_complete: bool = False,
                           agents_list: Union[list, str] = '*') -> ConnexionResponse:
    """Force reconnect all agents or a list of them.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format. Default `False`
    wait_for_complete : bool
        Disable timeout response. Default `False`
    agents_list : list or str
        List of agent IDs. Default `*`

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': agents_list}

    dapi = DistributedAPI(f=agent.reconnect_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          broadcasting=agents_list == '*',
                          logger=logger
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def restart_agents(pretty: bool = False, wait_for_complete: bool = False,
                         agents_list: str = '*') -> ConnexionResponse:
    """Restart all agents or a list of them.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agents_list : str
        List of agents IDs. Default: `*`

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': agents_list}

    dapi = DistributedAPI(f=agent.restart_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          broadcasting=agents_list == '*',
                          logger=logger
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def restart_agents_by_node(node_id: str, pretty: bool = False,
                                 wait_for_complete: bool = False) -> ConnexionResponse:
    """Restart all agents belonging to a node.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool, optional
        Show results in human-readable format. Default `False`
    wait_for_complete : bool, optional
        Disable timeout response. Default `False`

    Returns
    -------
    ConnexionResponse
        API response.
    """
    nodes = raise_if_exc(await get_system_nodes())

    f_kwargs = {'node_id': node_id, 'agent_list': '*'}

    dapi = DistributedAPI(f=agent.restart_agents_by_node,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_config(pretty: bool = False, wait_for_complete: bool = False, agent_id: str = None,
                           component: str = None, **kwargs: dict) -> ConnexionResponse:
    """Get agent active configuration.

    Returns the active configuration the agent is currently using. This can be different from the configuration present
    in the configuration file, if it has been modified and the agent has not been restarted yet.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID.
    component : str
        Selected agent's component which configuration is got.

    Returns
    -------
    ConnexionResponse
        API response with the agent configuration.
    """
    f_kwargs = {'agent_list': [agent_id],
                'component': component,
                'config': kwargs.get('configuration', None)
                }

    raise_if_exc(check_component_configuration_pair(f_kwargs['component'], f_kwargs['config']))

    dapi = DistributedAPI(f=agent.get_agent_config,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def delete_single_agent_multiple_groups(agent_id: str, groups_list: str = None, pretty: bool = False,
                                              wait_for_complete: bool = False) -> ConnexionResponse:
    """Remove the agent from all groups or a list of them.

    The agent will automatically revert to the "default" group if it is removed from all its assigned groups.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID.
    groups_list : str
        Array of groups IDs to remove the agent from.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': [agent_id],
                'group_list': groups_list}

    dapi = DistributedAPI(f=agent.remove_agent_from_groups,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )

    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


@deprecate_endpoint()
async def get_sync_agent(agent_id: str, pretty: bool = False, wait_for_complete=False) -> ConnexionResponse:
    """Get agent configuration sync status.

    Return whether the agent group configuration has been synchronized with the agent or not.

    Parameters
    ----------
    agent_id : str
        Agent ID.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    web.Reponse
        API response with the agent configuration sync status.
    """
    f_kwargs = {'agent_list': [agent_id]}

    dapi = DistributedAPI(f=agent.get_agents_sync_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def delete_single_agent_single_group(agent_id: str, group_id: str, pretty: bool = False,
                                           wait_for_complete: bool = False) -> ConnexionResponse:
    """Remove agent from a single group.

    Removes an agent from a group. If the agent has multigroups, it will preserve all previous groups except the last
    one.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID.
    group_id : str
        ID of the group to remove the agent from.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': [agent_id],
                'group_list': [group_id]}

    dapi = DistributedAPI(f=agent.remove_agent_from_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def put_agent_single_group(agent_id: str, group_id: str, force_single_group: bool = False,
                                 pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Assign an agent to the specified group.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID.
    group_id : str
        ID of the group to remove the agent from.
    force_single_group : bool
        Forces the agent to belong to only the specified group.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': [agent_id],
                'group_list': [group_id],
                'replace': force_single_group}

    dapi = DistributedAPI(f=agent.assign_agents_to_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_key(agent_id: str, pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get agent key.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID.

    Returns
    -------
    ConnexionResponse
        API response with the specified agent's key.
    """
    f_kwargs = {'agent_list': [agent_id]}

    dapi = DistributedAPI(f=agent.get_agents_keys,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def restart_agent(agent_id: str, pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Restart an agent.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': [agent_id]}

    dapi = DistributedAPI(f=agent.restart_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def put_upgrade_agents(agents_list: str = None, pretty: bool = False, wait_for_complete: bool = False,
                             wpk_repo: str = None, upgrade_version: str = None, use_http: bool = False,
                             force: bool = False, package_type: str = None, q: str = None, manager: str = None,
                             version: str = None, group: str = None, node_name: str = None, name: str = None,
                             ip: str = None) -> ConnexionResponse:
    """Upgrade agents using a WPK file from an online repository.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agents_list : str
        List of agent IDs.
    wpk_repo : str
        WPK repository.
    upgrade_version : str
        Wazuh version to upgrade to.
    use_http : bool
        Use protocol http. If it's false use https. By default the value is set to false.
    force : bool
        Force upgrade.
    package_type : str
        Default package type (rpm, deb).
    q : str
        Query to filter agents by.
    manager : str
        Filter by manager hostname to which agents are connected.
    version : str
        Filter by agents version.
    group : str
        Filter by group of agents.
    node_name : str
        Filter by node name.
    name : str
        Filter by agent name.
    ip : str
        Filter by agent IP.

    Returns
    -------
    ConnexionResponse
        Upgrade message after trying to upgrade the agents.
    """
    # If we use the 'all' keyword and the request is distributed_master, agents_list must be '*'
    if 'all' in agents_list:
        agents_list = '*'

    f_kwargs = {'agent_list': agents_list,
                'wpk_repo': wpk_repo,
                'version': upgrade_version,
                'use_http': use_http,
                'force': force,
                'package_type': package_type,
                'filters': {
                    'manager': manager,
                    'version': version,
                    'group': group,
                    'node_name': node_name,
                    'name': name,
                    'ip': ip,
                    'registerIP': request.query_params.get('registerIP', None)
                },
                'q': q
                }

    # Add nested fields to kwargs filters
    nested = ['os.version', 'os.name', 'os.platform']
    for field in nested:
        f_kwargs['filters'][field] = request.query_params.get(field, None)

    dapi = DistributedAPI(f=agent.upgrade_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          broadcasting=agents_list == '*'
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def put_upgrade_custom_agents(agents_list: str = None, pretty: bool = False,
                                    wait_for_complete: bool = False, file_path: str = None, installer: str = None,
                                    q: str = None, manager: str = None, version: str = None, group: str = None,
                                    node_name: str = None, name: str = None, ip: str = None) -> ConnexionResponse:
    """Upgrade agents using a local WPK file.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agents_list : str
        List of agent IDs.
    file_path : str
        Path to the WPK file. The file must be on a folder on the Wazuh's installation directory (by default, <code>/var/wazuh-manager</code>).
    installer : str
        Installation file.
    q : str
        Query to filter agents by.
    manager : str
        Filter by manager hostname to which agents are connected.
    version : str
        Filter by agents version.
    group : str
        Filter by group of agents.
    node_name : str
        Filter by node name.
    name : str
        Filter by agent name.
    ip : str
        Filter by agent IP.

    Returns
    -------
    ConnexionResponse
        Upgrade message after trying to upgrade the agents.
    """
    # If we use the 'all' keyword and the request is distributed_master, agents_list must be '*'
    if 'all' in agents_list:
        agents_list = '*'

    f_kwargs = {'agent_list': agents_list,
                'file_path': file_path,
                'installer': installer,
                'filters': {
                    'manager': manager,
                    'version': version,
                    'group': group,
                    'node_name': node_name,
                    'name': name,
                    'ip': ip,
                    'registerIP': request.query_params.get('registerIP', None)
                },
                'q': q
                }

    # Add nested fields to kwargs filters
    nested = ['os.version', 'os.name', 'os.platform']
    for field in nested:
        f_kwargs['filters'][field] = request.query_params.get(field, None)

    dapi = DistributedAPI(f=agent.upgrade_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          broadcasting=agents_list == '*'
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_upgrade(agents_list: str = None, pretty: bool = False, wait_for_complete: bool = False,
                            q: str = None, manager: str = None, version: str = None, group: str = None,
                            node_name: str = None, name: str = None, ip: str = None) -> ConnexionResponse:
    """Get upgrade results from agents.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agents_list : str
        List of agent IDs.
    q : str
        Query to filter agents by.
    manager : str
        Filter by manager hostname to which agents are connected.
    version : str
        Filter by agents version.
    group : str
        Filter by group of agents.
    node_name : str
        Filter by node name.
    name : str
        Filter by agent name.
    ip : str
        Filter by agent IP.

    Returns
    -------
    ConnexionResponse
        Upgrade message after having upgraded the agents.
    """
    f_kwargs = {'agent_list': agents_list,
                'filters': {
                    'manager': manager,
                    'version': version,
                    'group': group,
                    'node_name': node_name,
                    'name': name,
                    'ip': ip,
                    'registerIP': request.query_params.get('registerIP', None)
                },
                'q': q
                }

    # Add nested fields to kwargs filters
    nested = ['os.version', 'os.name', 'os.platform']
    for field in nested:
        f_kwargs['filters'][field] = request.query_params.get(field, None)

    dapi = DistributedAPI(f=agent.get_upgrade_result,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_daemon_stats(agent_id: str, pretty: bool = False, wait_for_complete: bool = False,
                           daemons_list: list = None) -> ConnexionResponse:
    """Get Wazuh statistical information from the specified daemons of a specified agent.

    Parameters
    ----------
    agent_id : str
        ID of the agent from which the statistics are obtained.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    daemons_list : list
        List of the daemons to get statistical information from.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    daemons_list = daemons_list or []
    f_kwargs = {'agent_list': [agent_id],
                'daemons_list': daemons_list}

    dapi = DistributedAPI(f=stats.get_daemons_stats_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'])
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_component_stats(pretty: bool = False, wait_for_complete: bool = False, agent_id: str = None,
                              component: str = None) -> ConnexionResponse:
    """Get a specified agent's component stats.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    agent_id : str
        Agent ID for which the specified component's stats are got.
    component : str
        Selected agent's component which stats are got.

    Returns
    -------
    ConnexionResponse
        API response with the module stats.
    """
    f_kwargs = {'agent_list': [agent_id],
                'component': component}

    dapi = DistributedAPI(f=stats.get_agents_component_stats_json,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def post_new_agent(agent_name: str, pretty: bool = False,
                         wait_for_complete: bool = False) -> ConnexionResponse:
    """Add agent (quick method).

    Parameters
    ----------
    agent_name : str
        Name used to register the agent.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = await AgentAddedModel.get_kwargs({'name': agent_name})

    dapi = DistributedAPI(f=agent.add_agent,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def delete_multiple_agent_single_group(group_id: str, agents_list: str = None, pretty: bool = False,
                                             wait_for_complete: bool = False) -> ConnexionResponse:
    """Remove agents assignment from a specified group.

    Parameters
    ----------
    group_id : str
        Group ID.
    agents_list : str
        Array of agent's IDs.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    if 'all' in agents_list:
        agents_list = None
    f_kwargs = {'agent_list': agents_list,
                'group_list': [group_id]}

    dapi = DistributedAPI(f=agent.remove_agents_from_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def put_multiple_agent_single_group(group_id: str, agents_list: str = None, pretty: bool = False,
                                          wait_for_complete: bool = False,
                                          force_single_group: bool = False) -> ConnexionResponse:
    """Add multiple agents to a group.

    Parameters
    ----------
    group_id : str
        Group ID.
    agents_list : str
        List of agents IDs.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    force_single_group : bool
        Forces the agent to belong to only the specified group.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': agents_list,
                'group_list': [group_id],
                'replace': force_single_group}

    dapi = DistributedAPI(f=agent.assign_agents_to_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def delete_groups(groups_list: str = None, pretty: bool = False,
                        wait_for_complete: bool = False) -> ConnexionResponse:
    """Delete all groups or a list of them.

    Parameters
    ----------
    groups_list : str
        Array of group's IDs.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    if 'all' in groups_list:
        groups_list = None
    f_kwargs = {'group_list': groups_list}

    dapi = DistributedAPI(f=agent.delete_groups,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_list_group(pretty: bool = False, wait_for_complete: bool = False,
                        groups_list: str = None, offset: int = 0, limit: int = None,
                        sort: str = None, search: str = None, q: str = None, select: str = None,
                        distinct: bool = False) -> ConnexionResponse:
    """Get groups.

    Returns a list containing basic information about each agent group such as number of agents belonging to the group
    and the checksums of the configuration and shared files.

    Parameters
    ----------
    groups_list : str
        Array of group's IDs.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return.
    sort : str
        Sorts the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Look for elements with the specified string.
    q : str
        Query to filter results by.
    select : str
        Select which fields to return (separated by comma).
    distinct : bool
        Look for distinct values.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    hash_ = request.query_params.get('hash', 'md5')  # Select algorithm to generate the returned checksums.
    f_kwargs = {'offset': offset,
                'limit': limit,
                'group_list': groups_list,
                'sort_by': parse_api_param(sort, 'sort')['fields'] if sort is not None else ['name'],
                'sort_ascending': True if sort is None or parse_api_param(sort, 'sort')['order'] == 'asc' else False,
                'search_text': parse_api_param(search, 'search')['value'] if search is not None else None,
                'complementary_search': parse_api_param(search, 'search')['negation'] if search is not None else None,
                'hash_algorithm': hash_,
                'q': q,
                'select': select,
                'distinct': distinct}

    dapi = DistributedAPI(f=agent.get_agent_groups,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agents_in_group(group_id: str, pretty: bool = False, wait_for_complete: bool = False,
                              offset: int = 0, limit: int = DATABASE_LIMIT, select: str = None, sort: str = None,
                              search: str = None, status: str = None, q: str = None,
                              distinct: bool = False) -> ConnexionResponse:
    """Get the list of agents that belongs to the specified group.

    Parameters
    ----------
    group_id : str
        Group ID.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return. Default: DATABASE_LIMIT
    select : str
        Select which fields to return (separated by comma).
    sort : str
        Sorts the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Look for elements with the specified string.
    status : str
        Filters by agent status. Use commas to enter multiple statuses.
    q : str
        Query to filter results by. For example q&#x3D;&amp;quot;status&#x3D;active&amp;quot;
    distinct : bool
        Look for distinct values.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'group_list': [group_id],
                'offset': offset,
                'limit': limit,
                'sort': parse_api_param(sort, 'sort'),
                'search': parse_api_param(search, 'search'),
                'select': select,
                'filters': {
                    'status': status,
                },
                'q': q,
                'distinct': distinct}

    dapi = DistributedAPI(f=agent.get_agents_in_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )

    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def post_group(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Create a new group.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    # Get body parameters
    Body.validate_content_type(request, expected_content_type=JSON_CONTENT_TYPE)
    f_kwargs = await GroupAddedModel.get_kwargs(request)

    dapi = DistributedAPI(f=agent.create_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_group_config(group_id: str, pretty: bool = False, wait_for_complete: bool = False,
                           offset: int = 0, limit: int = DATABASE_LIMIT) -> ConnexionResponse:
    """Get group configuration defined in the `agent.conf` file.

    Parameters
    ----------
    group_id : str
        Group ID.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return. Default: DATABASE_LIMIT

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'group_list': [group_id],
                'offset': offset,
                'limit': limit}

    dapi = DistributedAPI(f=agent.get_agent_conf,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def put_group_config(body: bytes, group_id: str, pretty: bool = False,
                           wait_for_complete: bool = False) -> ConnexionResponse:
    """Update group configuration.

    Update a specified group's configuration. This API call expects a full valid XML file with the shared configuration
    tags/syntax.

    Parameters
    ----------
    body : bytes
        Bytes object with the new group configuration.
        The body is obtained from the XML file and decoded in this function.
    group_id : str
        Group ID.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    # Parse body to utf-8
    Body.validate_content_type(request, expected_content_type='application/xml')
    parsed_body = Body.decode_body(body, unicode_error=1911, attribute_error=1912)

    f_kwargs = {'group_list': [group_id],
                'file_data': parsed_body}

    dapi = DistributedAPI(f=agent.upload_group_file,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_group_files(group_id: str, pretty: bool = False, wait_for_complete: bool = False,
                          offset: int = 0, limit: int = None, sort: str = None, search: str = None,
                          q: str = None, select: str = None, distinct: bool = False) -> ConnexionResponse:
    """Get the files placed under the group directory.

    Parameters
    ----------
    group_id : str
        Group ID.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return.
    sort : str
        Sorts the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Look for elements with the specified string.
    q : str
        Query to filter results by.
    select : str
        Select which fields to return (separated by comma).
    distinct : bool
        Look for distinct values.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    hash_ = request.query_params.get('hash', 'md5')  # Select algorithm to generate the returned checksums.
    f_kwargs = {'group_list': [group_id],
                'offset': offset,
                'limit': limit,
                'sort_by': parse_api_param(sort, 'sort')['fields'] if sort is not None else ["filename"],
                'sort_ascending': True if sort is None or parse_api_param(sort, 'sort')['order'] == 'asc' else False,
                'search_text': parse_api_param(search, 'search')['value'] if search is not None else None,
                'complementary_search': parse_api_param(search, 'search')['negation'] if search is not None else None,
                'hash_algorithm': hash_,
                'q': q,
                'select': select,
                'distinct': distinct}

    dapi = DistributedAPI(f=agent.get_group_files,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_group_file(group_id: str, file_name: str, raw: bool = False, pretty: bool = False,
                              wait_for_complete: bool = False) -> ConnexionResponse:
    """Get the files placed under the group directory.

    Parameters
    ----------
    group_id : str
        Group ID.
    file_name : str
        Name of the file to be obtained.
    raw : bool
        Respond in raw format.
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    web.Response
        API response.
    """
    f_kwargs = {'group_list': [group_id],
                'filename': file_name,
                'type_conf': request.query_params.get('type', None),
                'raw': raw}

    dapi = DistributedAPI(f=agent.get_file_conf,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    if raw:
        mimetype, _ = mimetypes.guess_type(file_name)
        if mimetype is None:
            mimetype = 'text/plain'
        if file_name == 'agent.conf':
            mimetype = 'application/xml'

        return ConnexionResponse(body=data['data'], content_type=mimetype+'; charset=utf-8')

    return json_response(data, pretty=pretty)


async def restart_agents_by_group(group_id: str, pretty: bool = False,
                                  wait_for_complete: bool = False) -> ConnexionResponse:
    """Restart all agents from a group.

    Parameters
    ----------
    group_id : str
        Group name.
    pretty : bool, optional
        Show results in human-readable format. Default `False`
    wait_for_complete : bool, optional
        Disable timeout response. Default `False`

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'group_list': [group_id], 'select': ['id'], 'limit': None}
    dapi = DistributedAPI(f=agent.get_agents_in_group,
                          f_kwargs=f_kwargs,
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    agents = raise_if_exc(await dapi.distribute_function())

    agent_list = [a['id'] for a in agents.affected_items]
    if not agent_list:
        data = AffectedItemsWazuhResult(none_msg='Restart command was not sent to any agent')
        return json_response(data, pretty=pretty)

    f_kwargs = {'agent_list': agent_list}
    dapi = DistributedAPI(f=agent.restart_agents_by_group,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )

    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def insert_agent(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Insert a new agent.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    # Get body parameters
    Body.validate_content_type(request, expected_content_type=JSON_CONTENT_TYPE)
    f_kwargs = await AgentInsertedModel.get_kwargs(request)

    dapi = DistributedAPI(f=agent.add_agent,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_no_group(pretty: bool = False, wait_for_complete: bool = False, offset: int = 0,
                             limit: int = DATABASE_LIMIT, select=None, sort=None, search=None, q=None) -> ConnexionResponse:
    """Get agents without group.

    Parameters
    ----------
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return. Default: DATABASE_LIMIT
    select : str
        Select which fields to return (separated by comma).
    sort : str
        Sort the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Look for elements with the specified string.
    q : str
        Query to filter results by. For example "q&#x3D;&amp;quot;status&#x3D;active&amp;quot;".

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'offset': offset,
                'limit': limit,
                'select': select,
                'sort': parse_api_param(sort, 'sort'),
                'search': parse_api_param(search, 'search'),
                'q': 'group=null' + (';' + q if q else '')}

    dapi = DistributedAPI(f=agent.get_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_outdated(pretty: bool = False, wait_for_complete: bool = False, offset: int = 0,
                             limit: int = DATABASE_LIMIT, sort: str = None, search: str = None,
                             select: str = None, q: str = None) -> ConnexionResponse:
    """Get outdated agents.

    Parameters
    ----------
    pretty: bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return. Default: DATABASE_LIMIT
    sort : str
        Sort the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Look for elements with the specified string.
    select : str
        Select which fields to return (separated by comma).
    q : str
        Query to filter results by. For example "q&#x3D;&amp;quot;status&#x3D;active&amp;quot;".

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'offset': offset,
                'limit': limit,
                'sort': parse_api_param(sort, 'sort'),
                'search': parse_api_param(search, 'search'),
                'select': select,
                'q': q}

    dapi = DistributedAPI(f=agent.get_outdated_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_fields(pretty: bool = False, wait_for_complete: bool = False, fields: str = None,
                           offset: int = 0, limit: int = DATABASE_LIMIT, sort: str = None, search: str = None,
                           q: str = None) -> ConnexionResponse:
    """Get distinct fields in agents.

    Returns all the different combinations that agents have for the selected fields. It also indicates the total number
    of agents that have each combination.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    fields : str
        List of fields affecting the operation.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return.
    sort : str
        Sorts the collection by a field or fields (separated by comma). Use +/- at the beginning to list in
        ascending or descending order.
    search : str
        Looks for elements with the specified string.
    q : str
        Query to filter results by. For example q&#x3D;&amp;quot;status&#x3D;active&amp;quot;

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'offset': offset,
                'limit': limit,
                'sort': parse_api_param(sort, 'sort'),
                'search': parse_api_param(search, 'search'),
                'fields': fields,
                'q': q}

    dapi = DistributedAPI(f=agent.get_distinct_agents,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agents_summary(agents_list: str = None, pretty: bool = False,
                                   wait_for_complete: bool = False) -> ConnexionResponse:
    """Get agents summary.

    Parameters
    ----------
    agent_list : str
        Agents list.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'agent_list': agents_list}

    dapi = DistributedAPI(f=agent.get_agents_summary,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_summary_status(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get agents status summary.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format
    wait_for_complete : bool
        Disable timeout response

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {}

    dapi = DistributedAPI(f=agent.get_agents_summary_status,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_summary_os(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get agents OS summary.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format
    wait_for_complete : bool
        Disable timeout response

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {}

    dapi = DistributedAPI(f=agent.get_agents_summary_os,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_agent_uninstall_permission(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Check user's permission to uninstall agents

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {}

    dapi = DistributedAPI(f=agent.check_uninstall_permission,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)



================================================
FILE: api/api/controllers/cluster_controller.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import datetime
import logging

from connexion import request
from connexion.lifecycle import ConnexionResponse

import wazuh.cluster as cluster
import wazuh.core.common as common
import wazuh.manager as manager
import wazuh.stats as stats
from api.constants import INSTALLATION_UID_KEY, UPDATE_INFORMATION_KEY
from api.controllers.util import json_response, XML_CONTENT_TYPE
from api.models.base_model_ import Body
from api.signals import cti_context
from api.util import remove_nones_to_dict, parse_api_param, raise_if_exc, deserialize_date, deprecate_endpoint
from api.validator import check_component_configuration_pair
from wazuh.core.cluster.control import get_system_nodes
from wazuh.core.configuration import update_check_is_enabled
from wazuh.core.cluster.dapi.dapi import DistributedAPI
from wazuh.core.manager import query_update_check_service
from wazuh.core.results import AffectedItemsWazuhResult

logger = logging.getLogger('wazuh-api')


async def get_cluster_node(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get basic information about the local node.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=cluster.get_node_wrapper,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_any',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_cluster_nodes(pretty: bool = False, wait_for_complete: bool = False, offset: int = 0,
                            limit: int = None, sort: str = None, search: str = None, select: str = None,
                            nodes_list: str = None, q: str = None, distinct: bool = False) -> ConnexionResponse:
    """Get information about all nodes in the cluster or a list of them.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return.
    select : list
        Select which fields to return (separated by comma).
    sort : str
        Sort the collection by a field or fields (separated by comma). Use +/- at the beginning
        to list in ascending or descending order.
    search : str
        Look for elements with the specified string.
    nodes_list : str
        List of node IDs.
    q : str
        Query to filter results by.
    distinct : bool
        Look for distinct values.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    # Get type parameter from query
    type_ = request.query_params.get('type', 'all')

    f_kwargs = {'filter_node': nodes_list,
                'offset': offset,
                'limit': limit,
                'sort': parse_api_param(sort, 'sort'),
                'search': parse_api_param(search, 'search'),
                'select': select,
                'filter_type': type_,
                'q': q,
                'distinct': distinct}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=cluster.get_nodes_info,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          local_client_arg='lc',
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_healthcheck(pretty: bool = False, wait_for_complete: bool = False,
                          nodes_list: str = None) -> ConnexionResponse:
    """Get cluster healthcheck.

    Returns cluster healthcheck information for all nodes or a list of them. Such information includes last keep alive,
    last synchronization time and number of agents reporting on each node.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    nodes_list : str
        List of node IDs.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'filter_node': nodes_list}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=cluster.get_health_nodes,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=True,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          local_client_arg='lc',
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_status(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get cluster status.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {}
    dapi = DistributedAPI(f=cluster.get_status_json,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_config(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get the current node cluster configuration.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=cluster.read_config_wrapper,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_any',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_status_node(node_id: str, pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a specified node's Wazuh daemons status.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.get_status,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_info_node(node_id: str, pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a specified node's information.

    Returns basic information about a specified node such as version, compilation date, installation path.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.get_basic_info,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_configuration_node(node_id: str, pretty: bool = False, wait_for_complete: bool = False,
                                 section: str = None, field: str = None,
                                 raw: bool = False) -> ConnexionResponse:
    """Get a specified node's configuration (wazuh-manager.conf).

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format. It only works when `raw` is False (JSON format). Default `False`
    wait_for_complete : bool
        Disable response timeout or not. Default `False`
    section : str
        Indicates the wazuh configuration section.
    field : str
        Indicates a section child.
    raw : bool, optional
        Whether to return the file content in raw or JSON format. Default `False`

    Returns
    -------
    ConnexionResponse
        Depending on the `raw` parameter, it will return a ConnexionResponse object:
            raw=True            -> ConnexionResponse (application/xml)
            raw=False (default) -> ConnexionResponse (application/json)
        If any exception was raised, it will return a ConnexionResponse with details.
    """
    f_kwargs = {'node_id': node_id,
                'section': section,
                'field': field,
                'raw': raw}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.read_ossec_conf,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    if isinstance(data, AffectedItemsWazuhResult):
        response = json_response(data, pretty=pretty)
    else:
        response = ConnexionResponse(body=data["message"],
                                     content_type=XML_CONTENT_TYPE)
    return response


async def get_daemon_stats_node(node_id: str, pretty: bool = False, wait_for_complete: bool = False,
                                daemons_list: list = None):
    """Get Wazuh statistical information from the specified daemons of a specified cluster node.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    daemons_list : list
        List of the daemons to get statistical information from.
    """
    daemons_list = daemons_list or []
    f_kwargs = {'node_id': node_id,
                'daemons_list': daemons_list}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=stats.get_daemons_stats,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes)
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_stats_node(node_id: str, pretty: bool = False, wait_for_complete: bool = False,
                         date: str = None) -> ConnexionResponse:
    """Get a specified node's stats.

    Returns Wazuh statistical information in node {node_id} for the current or specified date.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    date : str
        Selects the date for getting the statistical information. Format YYYY-MM-DD.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    if not date:
        date = datetime.datetime.today()
    else:
        date = deserialize_date(date)

    f_kwargs = {'node_id': node_id,
                'date': date}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=stats.totals,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())
    return json_response(data, pretty=pretty)


async def get_stats_hourly_node(node_id: str, pretty: bool = False,
                                wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a specified node's stats by hour.

    Returns Wazuh statistical information in node {node_id} per hour. Each number in the averages field represents the
    average of alerts per hour.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=stats.hourly,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_stats_weekly_node(node_id: str, pretty: bool = False,
                                wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a specified node's stats by week.

    Returns Wazuh statistical information in node {node_id} per week. Each number in the averages field represents the
    average of alerts per hour for that specific day.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=stats.weekly,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


@deprecate_endpoint()
async def get_stats_analysisd_node(node_id: str, pretty: bool = False,
                                   wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a specified node's analysisd statistics.

    Notes
    -----
    To be deprecated in v5.0.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool, optional
        Whether to disable response timeout or not. Default `False`

    Returns
    -------
    ConnexionResponse
    """
    f_kwargs = {'node_id': node_id,
                'filename': common.ANALYSISD_STATS}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=stats.deprecated_get_daemons_stats,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


@deprecate_endpoint()
async def get_stats_remoted_node(node_id: str, pretty: bool = False,
                                 wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a specified node's remoted statistics.

    Notes
    -----
    To be deprecated in v5.0.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool, optional
        Whether to disable response timeout or not. Default `False`

    Returns
    -------
    ConnexionResponse
    """
    f_kwargs = {'node_id': node_id,
                'filename': common.REMOTED_STATS}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=stats.deprecated_get_daemons_stats,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_log_node(node_id: str, pretty: bool = False, wait_for_complete: bool = False, offset: int = 0,
                       limit: int = None, sort: str = None, search: str = None, tag: str = None, level: str = None,
                       q: str = None, select: str = None, distinct: bool = False) -> ConnexionResponse:
    """Get a specified node's wazuh logs.

    Returns the last 2000 wazuh log entries in node {node_id}.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    offset : int
        First element to return in the collection.
    limit : int
        Maximum number of elements to return.
    sort : str
        Sort the collection by a field or fields (separated by comma). Use +/- at the beginning
        to list in ascending or descending order.
    search : str
        Look for elements with the specified string.
    tag : str
        Filters by category/tag of log.
    level : str
        Filters by log level.
    q : str
        Query to filter results by.
    select : str
        Select which fields to return (separated by comma).
    distinct : bool
        Look for distinct values.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id,
                'offset': offset,
                'limit': limit,
                'sort_by': parse_api_param(sort, 'sort')['fields'] if sort is not None else ['timestamp'],
                'sort_ascending': False if sort is None or parse_api_param(sort, 'sort')['order'] == 'desc' else True,
                'search_text': parse_api_param(search, 'search')['value'] if search is not None else None,
                'complementary_search': parse_api_param(search, 'search')['negation'] if search is not None else None,
                'tag': tag,
                'level': level,
                'q': q,
                'select': select,
                'distinct': distinct}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.ossec_log,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_log_summary_node(node_id: str, pretty: bool = False,
                               wait_for_complete: bool = False) -> ConnexionResponse:
    """Get a summary of a specified node's wazuh logs.

    Parameters
    ----------
    node_id : str
        Cluster node name.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.ossec_log_summary,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_api_config(pretty: bool = False, wait_for_complete: bool = False,
                         nodes_list: str = '*') -> ConnexionResponse:
    """Get active API configuration in manager or local_node.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    nodes_list : str
        List of node IDs.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_list': nodes_list}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.get_api_config,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          broadcasting=nodes_list == '*',
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def put_restart(pretty: bool = False, nodes_list: str = '*') -> ConnexionResponse:
    """Restarts all nodes in the cluster or a list of them.

    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    nodes_list : str
        List of node IDs.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_list': nodes_list}

    nodes = raise_if_exc(await get_system_nodes())
    # Remove the master from the list to restart all workers without issuing the command locally yet.
    # The master node is always the first item in the list.
    master_node = nodes.pop(0)

    if nodes_list == [master_node]:
        dapi = DistributedAPI(
            f=manager.restart,
            request_type='local_master',
            logger=logger,
            rbac_permissions=request.context['token_info']['rbac_policies'],
        )
        result = raise_if_exc(await dapi.distribute_function())
        
        return json_response(result, pretty=pretty, status_code=202)

    dapi = DistributedAPI(f=manager.restart,
                        f_kwargs=remove_nones_to_dict(f_kwargs),
                        request_type='distributed_master',
                        is_async=False,
                        logger=logger,
                        broadcasting=nodes_list == '*',
                        rbac_permissions=request.context['token_info']['rbac_policies'],
                        wait_for_complete=True,
                        nodes=nodes
                        )
    result = raise_if_exc(await dapi.distribute_function())

    if nodes_list == '*' or master_node in nodes_list:
        dapi_master = DistributedAPI(
            f=manager.restart,
            request_type='local_master',
            logger=logger,
            rbac_permissions=request.context['token_info']['rbac_policies'],
        )
        master_result = raise_if_exc(await dapi_master.distribute_function())
        if master_result.total_affected_items > 0:
            result.affected_items.insert(0, master_node)
            result.total_affected_items += 1

    return json_response(result, pretty=pretty, status_code=202)


async def get_conf_validation(pretty: bool = False, wait_for_complete: bool = False,
                              nodes_list: str = '*') -> ConnexionResponse:
    """Check whether the Wazuh configuration in a list of cluster nodes is correct or not.


    Parameters
    ----------
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.
    nodes_list : str
        List of node IDs.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_list': nodes_list}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.validation,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          broadcasting=nodes_list == '*',
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_node_config(node_id: str, component: str, wait_for_complete: bool = False, pretty: bool = False,
                          **kwargs: dict) -> ConnexionResponse:
    """Get active configuration in node node_id [on demand]

    Parameters
    ----------
    node_id : str
        Node ID.
    component : str
        Filters by specified component.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.


    Returns
    -------
    ConnexionResponse
        API response.
    """
    f_kwargs = {'node_id': node_id,
                'section': kwargs.get('configuration', None)
                }

    nodes = raise_if_exc(await get_system_nodes())

    dapi = DistributedAPI(f=manager.read_ossec_conf,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def update_configuration(node_id: str, body: bytes, pretty: bool = False,
                               wait_for_complete: bool = False) -> ConnexionResponse:
    """Update Wazuh configuration (wazuh-manager.conf) in node node_id.

    Parameters
    ----------
    node_id : str
        Node ID.
    body : bytes
        New content for the Wazuh configuration (wazuh-manager.conf).
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    # Parse body to utf-8
    Body.validate_content_type(request, expected_content_type='application/octet-stream')
    parsed_body = Body.decode_body(body, unicode_error=1911, attribute_error=1912)

    f_kwargs = {'node_id': node_id,
                'new_conf': parsed_body}

    nodes = raise_if_exc(await get_system_nodes())
    dapi = DistributedAPI(f=manager.update_ossec_conf,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='distributed_master',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies'],
                          nodes=nodes
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def check_available_version(pretty: bool = False, force_query: bool = False) -> ConnexionResponse:
    """Get available update information.

    Parameters
    ----------
    pretty : bool, optional
        Show results in human-readable format, by default False.
    force_query : bool, optional
        Make the query to the CTI service on demand, by default False.

    Returns
    -------
    web.Response
        API response.
    """
    installation_uid = cti_context[INSTALLATION_UID_KEY]

    if force_query and update_check_is_enabled():
        logger.debug('Forcing query to the update check service...')
        dapi = DistributedAPI(f=query_update_check_service,
                              f_kwargs={
                                  INSTALLATION_UID_KEY: installation_uid
                              },
                              request_type='local_master',
                              is_async=True,
                              logger=logger
                              )
        update_information = raise_if_exc(await dapi.distribute_function())
        cti_context[UPDATE_INFORMATION_KEY] = update_information.dikt

    dapi = DistributedAPI(f=manager.get_update_information,
                          f_kwargs={
                              INSTALLATION_UID_KEY: installation_uid,
                              UPDATE_INFORMATION_KEY: cti_context.get(UPDATE_INFORMATION_KEY, {})
                          },
                          request_type='local_master',
                          is_async=False,
                          logger=logger
                          )
    data = raise_if_exc(await dapi.distribute_function())
    return json_response(data, pretty=pretty)



================================================
FILE: api/api/controllers/default_controller.py
================================================
# # Copyright (C) 2015, Wazuh Inc.
# # Created by Wazuh, Inc. <info@wazuh.com>.
# # This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import logging
import socket
from datetime import datetime

from connexion.lifecycle import ConnexionResponse

from api.controllers.util import json_response
from api.models.basic_info_model import BasicInfo
from wazuh.core.common import DATE_FORMAT
from wazuh.core.results import WazuhResult
from wazuh.core.security import load_spec
from wazuh.core.utils import get_utc_now

logger = logging.getLogger('wazuh-api')


async def default_info(pretty: bool = False) -> ConnexionResponse:
    """Return basic information about the Wazuh API.

    Parameters
    ----------
    pretty: bool
        Show results in human-readable format.

    Returns
    -------
    ConnexionResponse
        API response.
    """
    info_data = load_spec()
    data = {
        'title': info_data['info']['title'],
        'api_version': info_data['info']['version'],
        'revision': info_data['info']['x-revision'],
        'license_name': info_data['info']['license']['name'],
        'license_url': info_data['info']['license']['url'],
        'hostname': socket.gethostname(),
        'timestamp': get_utc_now().strftime(DATE_FORMAT)
    }
    data = WazuhResult({'data': BasicInfo.from_dict(data)})

    return json_response(data, pretty=pretty)



================================================
FILE: api/api/controllers/event_controller.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import logging

from connexion import request
from connexion.lifecycle import ConnexionResponse
from wazuh.core.cluster.dapi.dapi import DistributedAPI
from wazuh.event import send_event_to_analysisd

from api.controllers.util import json_response, JSON_CONTENT_TYPE
from api.models.base_model_ import Body
from api.models.event_ingest_model import EventIngestModel
from api.util import raise_if_exc, remove_nones_to_dict

logger = logging.getLogger('wazuh-api')


async def forward_event(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Forward events to analysisd.

    Parameters
    ----------
    request : web.Request
        API Request.
    pretty : bool, optional
        Show results in human-readable format, by default False.
    wait_for_complete : bool, optional
        Disable timeout response, by default False.

    Returns
    -------
    ConnexionResponse
        API Response.
    """
    Body.validate_content_type(request, expected_content_type=JSON_CONTENT_TYPE)
    f_kwargs = await EventIngestModel.get_kwargs(request)

    dapi = DistributedAPI(f=send_event_to_analysisd,
                          f_kwargs=remove_nones_to_dict(f_kwargs),
                          request_type='local_any',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )

    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)



================================================
FILE: api/api/controllers/mitre_controller.py
================================================
# Copyright (C) 2015, Wazuh Inc.
# Created by Wazuh, Inc. <info@wazuh.com>.
# This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2

import logging

from connexion import request
from connexion.lifecycle import ConnexionResponse

from api.controllers.util import json_response
from api.util import raise_if_exc, parse_api_param, remove_nones_to_dict
from wazuh import mitre
from wazuh.core.cluster.dapi.dapi import DistributedAPI

logger = logging.getLogger('wazuh-api')


async def get_metadata(pretty: bool = False, wait_for_complete: bool = False) -> ConnexionResponse:
    """Return the metadata of the MITRE's database.

    Parameters
    ----------
    pretty : bool, optional
        Show results in human-readable format.
    wait_for_complete : bool, optional
        Disable timeout response.

    Returns
    -------
    ConnexionResponse
        API response.
    """

    dapi = DistributedAPI(f=mitre.mitre_metadata,
                          f_kwargs={},
                          request_type='local_any',
                          is_async=False,
                          wait_for_complete=wait_for_complete,
                          logger=logger,
                          rbac_permissions=request.context['token_info']['rbac_policies']
                          )
    data = raise_if_exc(await dapi.distribute_function())

    return json_response(data, pretty=pretty)


async def get_references(reference_ids: list = None, pretty: bool = False, wait_for_complete: bool = False,
                         offset: int = None, limit: int = None, sort: str = None, search: str = None,
                         select: list = None, q: str = None) -> ConnexionResponse:
    """Get information of specified MITRE's references.

    Parameters
    ----------
    reference_ids : list
        List of reference ids to be obtained.
    pretty : bool
        Show results in human-readable format.
    wait_for_complete : bool
        Disab