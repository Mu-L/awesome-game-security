Project Path: arc_gmh5225_Dse-Patcher-2_875zo2_d

Source Tree:

```txt
arc_gmh5225_Dse-Patcher-2_875zo2_d
├── README.md
└── dse_meme
    ├── dse_meme
    │   ├── dse_meme.inf
    │   ├── dse_meme.vcxproj
    │   ├── dse_meme.vcxproj.filters
    │   ├── dse_meme.vcxproj.user
    │   ├── entry.cpp
    │   ├── structs
    │   │   └── windows.h
    │   └── utils
    │       ├── crt.h
    │       └── utils.h
    └── dse_meme.sln

```

`README.md`:

```md
# Dse-Patcher
Patches DSE by swapping both data ptrs located in SeValidateImageHeader &amp;&amp; SeValidateImageData

```

`dse_meme/dse_meme.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.8.34511.84
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "dse_meme", "dse_meme\dse_meme.vcxproj", "{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|ARM64 = Debug|ARM64
		Debug|x64 = Debug|x64
		Release|ARM64 = Release|ARM64
		Release|x64 = Release|x64
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Debug|ARM64.ActiveCfg = Debug|ARM64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Debug|ARM64.Build.0 = Debug|ARM64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Debug|ARM64.Deploy.0 = Debug|ARM64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Debug|x64.ActiveCfg = Debug|x64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Debug|x64.Build.0 = Debug|x64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Debug|x64.Deploy.0 = Debug|x64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Release|ARM64.ActiveCfg = Release|ARM64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Release|ARM64.Build.0 = Release|ARM64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Release|ARM64.Deploy.0 = Release|ARM64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Release|x64.ActiveCfg = Release|x64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Release|x64.Build.0 = Release|x64
		{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}.Release|x64.Deploy.0 = Release|x64
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {D32EC0DF-E0EB-4990-87BC-77AF65FB1311}
	EndGlobalSection
EndGlobal

```

`dse_meme/dse_meme/dse_meme.inf`:

```inf
;
; dse_meme.inf
;

[Version]
Signature="$WINDOWS NT$"
Class=System ; TODO: specify appropriate Class
ClassGuid={4d36e97d-e325-11ce-bfc1-08002be10318} ; TODO: specify appropriate ClassGuid
Provider=%ManufacturerName%
CatalogFile=dse_meme.cat
DriverVer= ; TODO: set DriverVer in stampinf property pages
PnpLockdown=1

[DestinationDirs]
DefaultDestDir = 12
dse_meme_Device_CoInstaller_CopyFiles = 11

[SourceDisksNames]
1 = %DiskName%,,,""

[SourceDisksFiles]
dse_meme.sys  = 1,,
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll=1 ; make sure the number matches with SourceDisksNames

;*****************************************
; Install Section
;*****************************************

[Manufacturer]
%ManufacturerName%=Standard,NT$ARCH$

[Standard.NT$ARCH$]
%dse_meme.DeviceDesc%=dse_meme_Device, Root\dse_meme ; TODO: edit hw-id

[dse_meme_Device.NT]
CopyFiles=Drivers_Dir

[Drivers_Dir]
dse_meme.sys

;-------------- Service installation
[dse_meme_Device.NT.Services]
AddService = dse_meme,%SPSVCINST_ASSOCSERVICE%, dse_meme_Service_Inst

; -------------- dse_meme driver install sections
[dse_meme_Service_Inst]
DisplayName    = %dse_meme.SVCDESC%
ServiceType    = 1               ; SERVICE_KERNEL_DRIVER
StartType      = 3               ; SERVICE_DEMAND_START
ErrorControl   = 1               ; SERVICE_ERROR_NORMAL
ServiceBinary  = %12%\dse_meme.sys

;
;--- dse_meme_Device Coinstaller installation ------
;

[dse_meme_Device.NT.CoInstallers]
AddReg=dse_meme_Device_CoInstaller_AddReg
CopyFiles=dse_meme_Device_CoInstaller_CopyFiles

[dse_meme_Device_CoInstaller_AddReg]
HKR,,CoInstallers32,0x00010000, "WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll,WdfCoInstaller"

[dse_meme_Device_CoInstaller_CopyFiles]
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll

[dse_meme_Device.NT.Wdf]
KmdfService =  dse_meme, dse_meme_wdfsect
[dse_meme_wdfsect]
KmdfLibraryVersion = $KMDFVERSION$

[Strings]
SPSVCINST_ASSOCSERVICE= 0x00000002
ManufacturerName="<Your manufacturer name>" ;TODO: Replace with your manufacturer name
DiskName = "dse_meme Installation Disk"
dse_meme.DeviceDesc = "dse_meme Device"
dse_meme.SVCDESC = "dse_meme Service"

```

`dse_meme/dse_meme/dse_meme.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{69AE4AE2-06F4-4C3F-94D1-E3001D5E44BB}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">x64</Platform>
    <RootNamespace>dse_meme</RootNamespace>
    <WindowsTargetPlatformVersion>$(LatestTargetPlatformVersion)</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
    <ClCompile>
      <LanguageStandard>stdcpp17</LanguageStandard>
    </ClCompile>
    <ClCompile>
      <LanguageStandard_C>stdc11</LanguageStandard_C>
      <TreatWarningAsError>false</TreatWarningAsError>
    </ClCompile>
    <Link>
      <EntryPointSymbol>DriverEntry</EntryPointSymbol>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemGroup>
    <Inf Include="dse_meme.inf" />
  </ItemGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="entry.cpp" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="structs\windows.h" />
    <ClInclude Include="utils\crt.h" />
    <ClInclude Include="utils\utils.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`dse_meme/dse_meme/dse_meme.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <Inf Include="dse_meme.inf">
      <Filter>Driver Files</Filter>
    </Inf>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="entry.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="utils\utils.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="structs\windows.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="utils\crt.h">
      <Filter>Header Files</Filter>
    </ClInclude>
  </ItemGroup>
</Project>
```

`dse_meme/dse_meme/dse_meme.vcxproj.user`:

```user
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <ShowAllFiles>true</ShowAllFiles>
  </PropertyGroup>
</Project>
```

`dse_meme/dse_meme/entry.cpp`:

```cpp
#include <ntdef.h>
#include <stdint.h>
#include <ntifs.h>
#include <ntddk.h>
#include <ntimage.h>
#include <windef.h>
#include <intrin.h>
#include <ntstrsafe.h>

#include "structs/windows.h"

#include "utils/crt.h"
#include "utils/utils.h"

NTSTATUS DriverEntry( ) {
	
	auto ntoskrnl = get_kernel_module( "ntoskrnl.exe" );
	if ( !ntoskrnl )
		return STATUS_FAILED_DRIVER_ENTRY;
	auto se_validate_image_header = find_pattern( ntoskrnl, "\x48\x39\x35\xCC\xCC\xCC\xCC\x48\x8B\xF9", "xxx????xxx" );
	if ( !se_validate_image_header )
		return STATUS_FAILED_DRIVER_ENTRY;
	
	auto se_validate_image_data = find_pattern( ntoskrnl, "\x48\x8B\x05\xCC\xCC\xCC\xCC\x4C\x8B\xD1\x48\x85\xC0", "xxx????xxxxxx" ); 
	if ( !se_validate_image_data )
		return STATUS_FAILED_DRIVER_ENTRY;

	auto rva = se_validate_image_header + *( int32_t* )( se_validate_image_header + 3 ) + 7;
	auto rva2 = se_validate_image_data +  *( int32_t* )( se_validate_image_header + 3 ) + 7;
	if ( !rva && !rva2 ) {
		DbgPrintEx( 0, 0, "Fuck\n" );
		return STATUS_FAILED_DRIVER_ENTRY;
	}

	DbgPrintEx( 0, 0, "se_validate_image_header %llX\n", rva ); 
	DbgPrintEx( 0, 0, "se_validate_image_data %llX\n", rva2 );

	auto rop = find_pattern( ntoskrnl, "\xB8\x01\x00\x00\x00\xC3", "xxxxxx" ); 
	if ( !rop ) {
		DbgPrintEx( 0, 0, "Fuck\n" );
		return STATUS_FAILED_DRIVER_ENTRY;
	}

	//Swap
	*( uintptr_t* )rva = rop;
	*( uintptr_t* )rva2 = rop;

	DbgPrintEx( 0, 0, "Swapped to %llX\n", rop ); 

	return STATUS_SUCCESS;
}
```

`dse_meme/dse_meme/structs/windows.h`:

```h
constexpr auto SystemExtendedHandleInformation = 64;

typedef unsigned int uint32_t;

typedef struct _RTL_PROCESS_MODULE_INFORMATION {
    HANDLE Section;
    PVOID MappedBase;
    PVOID ImageBase;
    ULONG ImageSize;
    ULONG Flags;
    USHORT LoadOrderIndex;
    USHORT InitOrderIndex;
    USHORT LoadCount;
    USHORT OffsetToFileName;
    UCHAR  FullPathName[ 256 ];
} RTL_PROCESS_MODULE_INFORMATION, * PRTL_PROCESS_MODULE_INFORMATION;

typedef struct _POOL_TRACKER_BIG_PAGES {
    volatile unsigned long long va;                                                  //0x0
    ULONG key;                                                              //0x8
    ULONG pattern : 8;                                                        //0xc
    ULONG pool_type : 12;                                                      //0xc
    ULONG slush_size : 12;                                                     //0xc
    ULONGLONG number_of_bytes;                                                //0x10
}POOL_TRACKER_BIG_PAGES, * PPOOL_TRACKER_BIG_PAGES;

typedef struct _RTL_PROCESS_MODULES {
    ULONG NumberOfModules;
    RTL_PROCESS_MODULE_INFORMATION Modules[ 1 ];
} RTL_PROCESS_MODULES, * PRTL_PROCESS_MODULES;

typedef struct _LDR_DATA_TABLE_ENTRY {
    LIST_ENTRY InLoadOrderLinks;
    LIST_ENTRY InMemoryOrderLinks;
    LIST_ENTRY InInitializationOrderLinks;
    PVOID DllBase;
    PVOID EntryPoint;
    ULONG SizeOfImage;
    UNICODE_STRING FullDllName;
    UNICODE_STRING BaseDllName;
    ULONG Flags;
    WORD LoadCount;
    WORD TlsIndex;
    union {
        LIST_ENTRY HashLinks;
        struct {
            PVOID SectionPointer;
            ULONG CheckSum;
        };
    };
    union {
        ULONG TimeDateStamp;
        PVOID LoadedImports;
    };
    VOID* EntryPointActivationContext;
    PVOID PatchInformation;
    LIST_ENTRY ForwarderLinks;
    LIST_ENTRY ServiceTagLinks;
    LIST_ENTRY StaticLinks;
} LDR_DATA_TABLE_ENTRY, * PLDR_DATA_TABLE_ENTRY;

typedef struct _RTL_CRITICAL_SECTION {
    VOID* DebugInfo;
    LONG LockCount;
    LONG RecursionCount;
    PVOID OwningThread;
    PVOID LockSemaphore;
    ULONG SpinCount;
} RTL_CRITICAL_SECTION, * PRTL_CRITICAL_SECTION;

typedef struct _PEB_LDR_DATA {
    ULONG Length;
    UCHAR Initialized;
    PVOID SsHandle;
    LIST_ENTRY InLoadOrderModuleList;
    LIST_ENTRY InMemoryOrderModuleList;
    LIST_ENTRY InInitializationOrderModuleList;
    PVOID EntryInProgress;
} PEB_LDR_DATA, * PPEB_LDR_DATA;

typedef struct _PEB {
    UCHAR InheritedAddressSpace;
    UCHAR ReadImageFileExecOptions;
    UCHAR BeingDebugged;
    UCHAR BitField;
    ULONG ImageUsesLargePages : 1;
    ULONG IsProtectedProcess : 1;
    ULONG IsLegacyProcess : 1;
    ULONG IsImageDynamicallyRelocated : 1;
    ULONG SpareBits : 4;
    PVOID Mutant;
    PVOID ImageBaseAddress;
    PPEB_LDR_DATA Ldr;
    VOID* ProcessParameters;
    PVOID SubSystemData;
    PVOID ProcessHeap;
    PRTL_CRITICAL_SECTION FastPebLock;
    PVOID AtlThunkSListPtr;
    PVOID IFEOKey;
    ULONG CrossProcessFlags;
    ULONG ProcessInJob : 1;
    ULONG ProcessInitializing : 1;
    ULONG ReservedBits0 : 30;
    union {
        PVOID KernelCallbackTable;
        PVOID UserSharedInfoPtr;
    };
    ULONG SystemReserved[ 1 ];
    ULONG SpareUlong;
    VOID* FreeList;
    ULONG TlsExpansionCounter;
    PVOID TlsBitmap;
    ULONG TlsBitmapBits[ 2 ];
    PVOID ReadOnlySharedMemoryBase;
    PVOID HotpatchInformation;
    VOID** ReadOnlyStaticServerData;
    PVOID AnsiCodePageData;
    PVOID OemCodePageData;
    PVOID UnicodeCaseTableData;
    ULONG NumberOfProcessors;
    ULONG NtGlobalFlag;
    LARGE_INTEGER CriticalSectionTimeout;
    ULONG HeapSegmentReserve;
    ULONG HeapSegmentCommit;
    ULONG HeapDeCommitTotalFreeThreshold;
    ULONG HeapDeCommitFreeBlockThreshold;
    ULONG NumberOfHeaps;
    ULONG MaximumNumberOfHeaps;
    VOID** ProcessHeaps;
    PVOID GdiSharedHandleTable;
    PVOID ProcessStarterHelper;
    ULONG GdiDCAttributeList;
    PRTL_CRITICAL_SECTION LoaderLock;
    ULONG OSMajorVersion;
    ULONG OSMinorVersion;
    WORD OSBuildNumber;
    WORD OSCSDVersion;
    ULONG OSPlatformId;
    ULONG ImageSubsystem;
    ULONG ImageSubsystemMajorVersion;
    ULONG ImageSubsystemMinorVersion;
    ULONG ImageProcessAffinityMask;
    ULONG GdiHandleBuffer[ 34 ];
    PVOID PostProcessInitRoutine;
    PVOID TlsExpansionBitmap;
    ULONG TlsExpansionBitmapBits[ 32 ];
    ULONG SessionId;
    ULARGE_INTEGER AppCompatFlags;
    ULARGE_INTEGER AppCompatFlagsUser;
    PVOID pShimData;
    PVOID AppCompatInfo;
    UNICODE_STRING CSDVersion;
    VOID* ActivationContextData;
    VOID* ProcessAssemblyStorageMap;
    VOID* SystemDefaultActivationContextData;
    VOID* SystemAssemblyStorageMap;
    ULONG MinimumStackCommit;
    VOID* FlsCallback;
    LIST_ENTRY FlsListHead;
    PVOID FlsBitmap;
    ULONG FlsBitmapBits[ 4 ];
    ULONG FlsHighIndex;
    PVOID WerRegistrationData;
    PVOID WerShipAssertPtr;
} PEB, * PPEB;

typedef enum _SYSTEM_INFORMATION_CLASS {
    SystemBasicInformation,
    SystemProcessorInformation,
    SystemPerformanceInformation,
    SystemTimeOfDayInformation,
    SystemPathInformation,
    SystemProcessInformation,
    SystemCallCountInformation,
    SystemDeviceInformation,
    SystemProcessorPerformanceInformation,
    SystemFlagsInformation,
    SystemCallTimeInformation,
    SystemModuleInformation,
    SystemLocksInformation,
    SystemStackTraceInformation,
    SystemPagedPoolInformation,
    SystemNonPagedPoolInformation,
    SystemHandleInformation,
    SystemObjectInformation,
    SystemPageFileInformation,
    SystemVdmInstemulInformation,
    SystemVdmBopInformation,
    SystemFileCacheInformation,
    SystemPoolTagInformation,
    SystemInterruptInformation,
    SystemDpcBehaviorInformation,
    SystemFullMemoryInformation,
    SystemLoadGdiDriverInformation,
    SystemUnloadGdiDriverInformation,
    SystemTimeAdjustmentInformation,
    SystemSummaryMemoryInformation,
    SystemNextEventIdInformation,
    SystemEventIdsInformation,
    SystemCrashDumpInformation,
    SystemExceptionInformation,
    SystemCrashDumpStateInformation,
    SystemKernelDebuggerInformation,
    SystemContextSwitchInformation,
    SystemRegistryQuotaInformation,
    SystemExtendServiceTableInformation,
    SystemPrioritySeperation,
    SystemPlugPlayBusInformation,
    SystemDockInformation,
    SystemProcessorSpeedInformation,
    SystemCurrentTimeZoneInformation,
    SystemLookasideInformation,
    system_bigpool_information = 0x42,
} SYSTEM_INFORMATION_CLASS, * PSYSTEM_INFORMATION_CLASS;



extern "C"
{
    NTKERNELAPI NTSTATUS NTAPI ZwQuerySystemInformation(
        _In_ SYSTEM_INFORMATION_CLASS SystemInformationClass,
        _Inout_ PVOID SystemInformation,
        _In_ ULONG SystemInformationLength,
        _Out_opt_ PULONG ReturnLength
    );

  

}


```

`dse_meme/dse_meme/utils/crt.h`:

```h
namespace crt {
	template <typename t>
	__forceinline int strlen( t str ) {
		if ( !str ) {
			return 0;
		}

		t buffer = str;

		while ( *buffer ) {
			*buffer++;
		}

		return ( int )( buffer - str );
	}

	bool strcmp( const char* src, const char* dst ) {
		if ( !src || !dst ) {
			return true;
		}

		const auto src_sz = crt::strlen( src );
		const auto dst_sz = crt::strlen( dst );

		if ( src_sz != dst_sz ) {
			return true;
		}

		for ( int i = 0; i < src_sz; i++ ) {
			if ( src[ i ] != dst[ i ] ) {
				return true;
			}
		}

		return false;
	}
}
```

`dse_meme/dse_meme/utils/utils.h`:

```h
#define in_range(x,a,b)    (x >= a && x <= b) 
#define get_bits( x )    (in_range((x&(~0x20)),'A','F') ? ((x&(~0x20)) - 'A' + 0xA) : (in_range(x,'0','9') ? x - '0' : 0))
#define get_byte( x )    (get_bits(x[0]) << 4 | get_bits(x[1]))
#define to_lower_i(Char) ((Char >= 'A' && Char <= 'Z') ? (Char + 32) : Char)
#define to_lower_c(Char) ((Char >= (char*)'A' && Char <= (char*)'Z') ? (Char + 32) : Char)

auto get_system_information( SYSTEM_INFORMATION_CLASS InformationClass ) -> void* {
    unsigned long size = 32;
    char buffer[ 32 ];

    ZwQuerySystemInformation( InformationClass, buffer, size, &size );

    void* info = ExAllocatePoolZero( NonPagedPool, size, 'UD' );

    if ( !info )
        return nullptr;

    if ( !NT_SUCCESS( ZwQuerySystemInformation( InformationClass, info, size, &size ) ) ) {
        ExFreePool( info );
        return nullptr;
    }

    return info;
}

auto get_kernel_module( const char* name ) -> uintptr_t {
    const auto to_lower = [ ]( char* string ) -> const char* {
        for ( char* pointer = string; *pointer != '\0'; ++pointer ) {
            *pointer = ( char )( short )tolower( *pointer );
        }

        return string;
        };

    const PRTL_PROCESS_MODULES info = ( PRTL_PROCESS_MODULES )get_system_information( SystemModuleInformation );

    if ( !info )
        return NULL;

    for ( size_t i = 0; i < info->NumberOfModules; ++i ) {
        const auto& mod = info->Modules[ i ];

        if ( crt::strcmp( to_lower_c( ( char* )mod.FullPathName + mod.OffsetToFileName ), name ) == 0 ) {
            const void* address = mod.ImageBase;
            ExFreePool( info );
            return ( uintptr_t )address;
        }
    }

    ExFreePool( info );
    return NULL;
}

uintptr_t find_pattern( uintptr_t base, size_t range, const char* pattern, const char* mask ) {
   
    const auto check_mask = [ ]( const char* base, const char* pattern, const char* mask ) -> bool {
        for ( ; *mask; ++base, ++pattern, ++mask ) {
            if ( *mask == 'x' && *base != *pattern ) {
                return false;
            }
        }

        return true;
        };

    range = range - crt::strlen( mask );

    for ( size_t i = 0; i < range; ++i ) {
        if ( check_mask( ( const char* )base + i, pattern, mask ) ) {
            return base + i;
        }
    }

    return NULL;
}

uintptr_t find_pattern( uintptr_t base, const char* pattern, const char* mask ) {
    const PIMAGE_NT_HEADERS headers = ( PIMAGE_NT_HEADERS )( base + ( ( PIMAGE_DOS_HEADER )base )->e_lfanew );

    const PIMAGE_SECTION_HEADER sections = IMAGE_FIRST_SECTION( headers );

    for ( size_t i = 0; i < headers->FileHeader.NumberOfSections; i++ ) {
        const PIMAGE_SECTION_HEADER section = &sections[ i ];

        if ( section->Characteristics & IMAGE_SCN_MEM_EXECUTE ) {
            const auto match = find_pattern( base + section->VirtualAddress, section->Misc.VirtualSize, pattern, mask );

            if ( match ) {
                return match;
            }
        }
    }

    return 0;
}

uintptr_t find_pattern( uintptr_t module_base, const char* pattern ) {
    auto pattern_ = pattern;
    uintptr_t first_match = 0;

    if ( !module_base ) {
        return 0;
    }

    const auto nt = reinterpret_cast< IMAGE_NT_HEADERS* >( module_base + reinterpret_cast< IMAGE_DOS_HEADER* >( module_base )->e_lfanew );

    for ( uintptr_t current = module_base; current < module_base + nt->OptionalHeader.SizeOfImage; current++ ) {
        if ( !*pattern_ ) {
            return first_match;
        }

        if ( *( BYTE* )pattern_ == '\?' || *( BYTE* )current == get_byte( pattern_ ) ) {
            if ( !first_match )
                first_match = current;

            if ( !pattern_[ 2 ] )
                return first_match;

            if ( *( WORD* )pattern_ == '\?\?' || *( BYTE* )pattern_ != '\?' )
                pattern_ += 3;

            else
                pattern_ += 2;
        }
        else {
            pattern_ = pattern;
            first_match = 0;
        }
    }

    return 0;
}
```