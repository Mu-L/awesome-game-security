Project Path: arc_gmh5225_StackSpoofer_Macro_3v8mlzq1

Source Tree:

```txt
arc_gmh5225_StackSpoofer_Macro_3v8mlzq1
â”œâ”€â”€ Bypass.h
â”œâ”€â”€ Obfuscator.h
â”œâ”€â”€ README.md
â”œâ”€â”€ StackSpoofer.h
â”œâ”€â”€ StackSpoofer_Macro.cpp
â”œâ”€â”€ StackSpoofer_Macro.sln
â”œâ”€â”€ StackSpoofer_Macro.vcxproj
â”œâ”€â”€ StackSpoofer_Macro.vcxproj.filters
â”œâ”€â”€ StackSpoofer_Macro.vcxproj.user
â”œâ”€â”€ spoof
â”‚   â”œâ”€â”€ dllmain.cpp
â”‚   â”œâ”€â”€ framework.h
â”‚   â”œâ”€â”€ pch.cpp
â”‚   â”œâ”€â”€ pch.h
â”‚   â”œâ”€â”€ spoof.sln
â”‚   â”œâ”€â”€ spoof.vcxproj
â”‚   â”œâ”€â”€ spoof.vcxproj.filters
â”‚   â””â”€â”€ spoof.vcxproj.user
â”œâ”€â”€ spoof.dll
â””â”€â”€ spoof.png

```

`Bypass.h`:

```h
#pragma once

#include <iostream>
#include <windows.h>

using namespace std;

int LocateSection(PBYTE pDll, char* sectionName, PBYTE& pSection) {
    PIMAGE_DOS_HEADER pDos = (PIMAGE_DOS_HEADER)pDll;
    PIMAGE_NT_HEADERS pNt = (PIMAGE_NT_HEADERS)(pDll + pDos->e_lfanew);
    WORD numberOfSections = pNt->FileHeader.NumberOfSections;
    PIMAGE_SECTION_HEADER pSectionTable = (PIMAGE_SECTION_HEADER)((DWORD_PTR) & (pNt->OptionalHeader) + pNt->FileHeader.SizeOfOptionalHeader);
    for (int i = 0; i < numberOfSections; i++) {
        if (!strcmp((char*)pSectionTable[i].Name, sectionName)) {
            pSection = pDll + pSectionTable[i].VirtualAddress;
            return pSectionTable[i].SizeOfRawData;
        }
    }
    return 0;
}

PBYTE FindExpFuncAddr(PBYTE pDll, char* funcName) {
    PIMAGE_DOS_HEADER pDos = (PIMAGE_DOS_HEADER)pDll;
    PIMAGE_NT_HEADERS pNt = (PIMAGE_NT_HEADERS)(pDll + pDos->e_lfanew);
    PIMAGE_EXPORT_DIRECTORY pExportDir = (PIMAGE_EXPORT_DIRECTORY)(pDll + pNt->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);
    DWORD numberOfNames = pExportDir->NumberOfNames;
    PDWORD pAddressOfFunctions = (PDWORD)(pDll + pExportDir->AddressOfFunctions);
    PDWORD pAddressOfNames = (PDWORD)(pDll + pExportDir->AddressOfNames);
    PWORD pAddressOfNameOrdinals = (PWORD)(pDll + pExportDir->AddressOfNameOrdinals);
    for (int i = 0; i < numberOfNames; i++) {
        PBYTE pFuncName = pDll + pAddressOfNames[i];
        if (!strcmp((char*)pFuncName, funcName)) {
            return pDll + pAddressOfFunctions[pAddressOfNameOrdinals[i]];
        }
    }
    return NULL;
}
```

`Obfuscator.h`:

```h
#pragma once

// å¼‚æˆ–å¯†é’¥
constexpr char key1 = '\x01';
constexpr char key2 = '\x02';

constexpr void XorData(char* src, char* dest, int len) {
    for (int i = 0; i < len; i++) {
        dest[i] = src[i] ^ key1 ^ key2;
    }
}

template <int len>
class Obfuscator {
public:
    char obfString[len];

    // ç¼–è¯‘æ—¶åŠ å¯†å­˜å‚¨å¯†æ–‡
    constexpr Obfuscator(char* str) : obfString{} {
        XorData(str, obfString, len);
    }

    // è¿è¡Œæ—¶è§£å¯†è‡³æ ˆä¸­
    char* Decrypt() {
        XorData(obfString, obfString, len);
        return obfString;
    }
};

#define OBF(str) []{ constexpr Obfuscator<sizeof(str)> obf(str); return obf; }().Decrypt()
```

`README.md`:

```md
# StackSpoofer_Macro

### è¯·ç»™æˆ‘ Star ğŸŒŸï¼Œéå¸¸æ„Ÿè°¢ï¼è¿™å¯¹æˆ‘å¾ˆé‡è¦ï¼

### Please give me Star ğŸŒŸ, thank you very much! It is very important to me!

### 1. ä»‹ç»

ç»è¿‡æ”¹é€ çš„æ ˆæ¬ºéª—æŠ€æœ¯ï¼Œæ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½å¼ºå¤§ã€‚

https://github.com/HackerCalico/StackSpoofer_Macro

![spoof.jpg](https://raw.githubusercontent.com/HackerCalico/StackSpoofer_Macro/refs/heads/main/spoof.png)

### 2. æ•ˆæœ & ä¼˜åŠ¿

(1) é€šè¿‡ SPOOF(å‡½æ•°å, å‚æ•°ä¸ªæ•°, å‚æ•°...) å®å¯ä»¥ç®€å•å¯¹ä»»æ„å‡½æ•°è¿›è¡Œæ ˆæ¬ºéª—è°ƒç”¨ã€‚

(2) ä»çº¿ç¨‹çš„æ ˆç©ºé—´ä¸­å¯»æ‰¾ RtlUserThreadStart å’Œ BaseThreadInitThunk çš„æ ˆå¸§ï¼Œé¿å…äº†ä¸åŒ Windows ç‰ˆæœ¬çš„å‡½æ•°æœ‰å·®å¼‚çš„é—®é¢˜ã€‚

(3) é€šè¿‡è‡ªå®šä¹‰ DLL å®ç° Gadgetï¼Œé¿å…äº† Gadget å½¢å¼å›ºå®šå’Œè¿”å›ä½ç½®ä¸å­˜åœ¨ call çš„ç‰¹å¾ã€‚

(4) é€šè¿‡ OBF("xxx") å®å¯ä»¥ç®€å•å¯¹ä»»æ„å­—ç¬¦ä¸²è¿›è¡Œç¼–è¯‘æ—¶åŠ å¯†ï¼Œè¿è¡Œæ—¶è§£å¯†ã€‚

### 3. æ³¨æ„äº‹é¡¹

(1) SPOOF å®çš„å‚æ•°ä¸­ä¸èƒ½å­˜åœ¨å‡½æ•°è°ƒç”¨ï¼Œä¾‹å¦‚ SPOOF(func1, func2())ã€‚

(2) å¦‚æœ Gadget æ ˆå¸§å¤§å° < å‚æ•°æ€»å¤§å°åˆ™ç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œä¸ä¼šè¿›å…¥æ ˆæ¬ºéª—åˆ†æ”¯ã€‚

(3) Visual Studio Installer ---> å•ä¸ªç»„ä»¶ ---> LLVM (clang-cl) å’Œ Clang ---> å®‰è£…

(4) è®¡ç®—æ ˆå¸§å¤§å°çš„ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œåœ¨è®¡ç®— RtlUserThreadStart å’Œ BaseThreadInitThunk ä»¥å¤–çš„å‡½æ•°çš„æ ˆå¸§å¤§å°æ—¶ä¸ä¿è¯å‡†ç¡®ï¼Œæ¯”å¦‚è‡ªå®šä¹‰çš„ Gadget å‡½æ•°å­˜åœ¨ç‰¹æ®Šçš„æ ˆæ“ä½œæ—¶ï¼Œè¯·åœ¨ Process Hacker ä¸­æ£€éªŒæ¬ºéª—æƒ…å†µã€‚
```

`StackSpoofer.h`:

```h
#pragma once

#define UWOP_PUSH_NONVOL 0
#define UWOP_ALLOC_LARGE 1
#define UWOP_ALLOC_SMALL 2
#define UWOP_SET_FPREG 3
#define UWOP_SAVE_NONVOL 4
#define UWOP_SAVE_NONVOL_FAR 5
#define UWOP_SAVE_XMM128 8
#define UWOP_SAVE_XMM128_FAR 9
#define UWOP_PUSH_MACHFRAME 10

typedef struct _UNICODE_STRING {
    USHORT Length;
    USHORT MaximumLength;
    PWSTR  Buffer;
} UNICODE_STRING, * PUNICODE_STRING;

typedef union _UNWIND_CODE {
    struct {
        unsigned char CodeOffset;
        unsigned char UnwindOp : 4;
        unsigned char OpInfo : 4;
    };
    USHORT FrameOffset;
} UNWIND_CODE, * PUNWIND_CODE;

typedef struct _UNWIND_INFO {
    unsigned char Version : 3;
    unsigned char Flags : 5;
    unsigned char SizeOfProlog;
    unsigned char CountOfCodes;
    unsigned char FrameRegister : 4;
    unsigned char FrameOffset : 4;
    UNWIND_CODE UnwindCode[1];
} UNWIND_INFO, * PUNWIND_INFO;

PBYTE pInitStack = NULL;
int initStackSize = 0;
PBYTE pGadget = NULL;
int gadgetStackSize = 0;

int GetStackSize(PBYTE pDll, PBYTE pFunc) {
    // å®šä½ .pdata
    PBYTE pPDATA = NULL;
    int pdataSize = LocateSection(pDll, OBF(".pdata"), pPDATA);
    if (pPDATA == NULL) {
        return 0;
    }

    // æŸ¥æ‰¾å‡½æ•° RUNTIME_FUNCTION
    PRUNTIME_FUNCTION pRuntimeFunction = (PRUNTIME_FUNCTION)pPDATA;
    while (pRuntimeFunction->BeginAddress && (PBYTE)pRuntimeFunction + sizeof(RUNTIME_FUNCTION) <= pPDATA + pdataSize) {
        if (pDll + pRuntimeFunction->BeginAddress <= pFunc && pDll + pRuntimeFunction->EndAddress >= pFunc) {
            break;
        }
        pRuntimeFunction++;
    }
    if (!pRuntimeFunction->BeginAddress || (PBYTE)pRuntimeFunction + sizeof(RUNTIME_FUNCTION) > pPDATA + pdataSize) {
        return 0;
    }

    // è®¡ç®—æ ˆå¸§å¤§å°
    // è¯¥ç®—æ³•åœ¨è®¡ç®— RtlUserThreadStart BaseThreadInitThunk ä»¥å¤–çš„å‡½æ•°çš„æ ˆå¸§å¤§å°æ—¶ä¸ä¿è¯å‡†ç¡®, æ¯”å¦‚è‡ªå®šä¹‰çš„ Gadget å‡½æ•°å­˜åœ¨ç‰¹æ®Šçš„æ ˆæ“ä½œæ—¶
    // è¯·åœ¨ Process Hacker ä¸­æ£€éªŒæ¬ºéª—æƒ…å†µ
    int stackSize = 0;
    int UWOP_SET_FPREG_HIT = 0;
    PUNWIND_INFO pUnwindInfo = (PUNWIND_INFO)(pDll + pRuntimeFunction->UnwindData);
    for (int i = 0; i < pUnwindInfo->CountOfCodes; i++) {
        ULONG unwindOp = pUnwindInfo->UnwindCode[i].UnwindOp;
        ULONG opInfo = pUnwindInfo->UnwindCode[i].OpInfo;
        if (unwindOp == UWOP_PUSH_NONVOL) {
            if (opInfo == 4 && !UWOP_SET_FPREG_HIT) {
                return 0;
            }
            stackSize += 8;
        }
        else if (unwindOp == UWOP_ALLOC_LARGE) {
            i++;
            ULONG frameOffset = pUnwindInfo->UnwindCode[i].FrameOffset;
            if (!opInfo) {
                frameOffset *= 8;
            }
            else {
                i++;
                frameOffset += (pUnwindInfo->UnwindCode[i].FrameOffset << 16);
            }
            stackSize += frameOffset;
        }
        else if (unwindOp == UWOP_ALLOC_SMALL) {
            stackSize += (opInfo + 1) * 8;
        }
        else if (unwindOp == UWOP_SET_FPREG) {
            if ((pUnwindInfo->Flags & UNW_FLAG_EHANDLER) && (pUnwindInfo->Flags & UNW_FLAG_CHAININFO)) {
                return 0;
            }
            UWOP_SET_FPREG_HIT = 1;
            ULONG frameOffset = -0x10 * (pUnwindInfo->FrameOffset);
            stackSize += frameOffset;
        }
        else if (unwindOp == UWOP_SAVE_NONVOL) {
            if (opInfo == 4 || opInfo == 5) {
                return 0;
            }
            i++;
        }
        else if (unwindOp == UWOP_SAVE_NONVOL_FAR) {
            if (opInfo == 4 || opInfo == 5) {
                return 0;
            }
            i += 2;
        }
        else if (unwindOp == UWOP_SAVE_XMM128) {
            i++;
        }
        else if (unwindOp == UWOP_SAVE_XMM128_FAR) {
            i += 2;
        }
        else if (unwindOp == UWOP_PUSH_MACHFRAME) {
            if (!opInfo) {
                stackSize += 0x40;
            }
            else {
                stackSize += 0x48;
            }
        }
        else {
            return 0;
        }
    }
    if (pUnwindInfo->Flags & UNW_FLAG_CHAININFO) {
        return 0;
    }
    return stackSize + sizeof(DWORD_PTR);
}

void FindGadget(PBYTE pSpoof) {
    PBYTE pTEXT = NULL;
    char* gadgetSig = OBF("\x48\x8B\x1B\xFF\xE3"); // Gadget å®šä½ç ä¸­ä¸èƒ½å‡ºç° 0x00
    int gadgetSigLen = strlen(gadgetSig);
    int textSize = LocateSection(pSpoof, OBF(".text"), pTEXT);
    if (pTEXT != NULL) {
        for (int i = 0; i < textSize - gadgetSigLen; i++) {
            int isFind = 1;
            for (int j = 0; j < gadgetSigLen; j++) {
                if (*(pTEXT + i + j) != (BYTE) * (gadgetSig + j)) {
                    isFind = 0;
                    break;
                }
            }
            if (isFind) {
                int curGadgetStackSize = GetStackSize(pSpoof, pTEXT + i);
                if (curGadgetStackSize > gadgetStackSize) {
                    pGadget = pTEXT + i;
                    gadgetStackSize = curGadgetStackSize;
                }
            }
        }
    }
}

int GetSpoofStack(int minGadgetStackSize) {
    if (pGadget != NULL) {
        if (gadgetStackSize < minGadgetStackSize) {
            return 0;
        }
        return 1;
    }
    // è·å– RtlUserThreadStart BaseThreadInitThunk åœ°å€
    DWORD_PTR _PEB = __readgsqword(0x60);
    DWORD_PTR _PEB_LDR_DATA = *(PDWORD_PTR)(_PEB + 0x18);
    PLIST_ENTRY pInInitializationOrderModuleList = (PLIST_ENTRY) * (PDWORD_PTR)(_PEB_LDR_DATA + 0x30);
    PLIST_ENTRY pNode = pInInitializationOrderModuleList;
    PBYTE pNtdll = NULL;
    PBYTE pKernel32 = NULL;
    PBYTE pSpoof = NULL;
    do {
        char dllName[20];
        PUNICODE_STRING string = (PUNICODE_STRING)((PBYTE)pNode + 0x38);
        int dllNameLen = string->Length / sizeof(wchar_t) - 4;
        if (dllNameLen < sizeof(dllName)) {
            for (int i = 0; i < dllNameLen; i++) {
                dllName[i] = string->Buffer[i];
            }
            dllName[dllNameLen] = '\0';
            DWORD_PTR dllBase = *(PDWORD_PTR)((PBYTE)pNode + 0x10);
            if (!strcmp(dllName, OBF("ntdll")) || !strcmp(dllName, OBF("NTDLL"))) {
                pNtdll = (PBYTE)dllBase;
            }
            else if (!strcmp(dllName, OBF("KERNEL32")) || !strcmp(dllName, OBF("kernel32"))) {
                pKernel32 = (PBYTE)dllBase;
            }
            else if (!strcmp(dllName, OBF("spoof"))) {
                pSpoof = (PBYTE)dllBase;
            }
        }
        pNode = pNode->Flink;
    } while (pNode->Flink != pInInitializationOrderModuleList);
    if (pNtdll == NULL || pKernel32 == NULL || pSpoof == NULL) {
        return 0;
    }
    PBYTE pRtlUserThreadStart = FindExpFuncAddr(pNtdll, OBF("RtlUserThreadStart"));
    PBYTE pBaseThreadInitThunk = FindExpFuncAddr(pKernel32, OBF("BaseThreadInitThunk"));
    if (pRtlUserThreadStart == NULL || pBaseThreadInitThunk == NULL) {
        return 0;
    }

    // è®¡ç®— RtlUserThreadStart BaseThreadInitThunk æ ˆå¸§å¤§å°
    int rutsStackSize = GetStackSize(pNtdll, pRtlUserThreadStart);
    int btitStackSize = GetStackSize(pKernel32, pBaseThreadInitThunk);
    if (!rutsStackSize || !btitStackSize) {
        return 0;
    }
    initStackSize = rutsStackSize + btitStackSize;

    // æŸ¥æ‰¾ RtlUserThreadStart BaseThreadInitThunk æ ˆå¸§
    DWORD_PTR _TEB = __readgsqword(0x30);
    DWORD_PTR stackBase = *(PDWORD_PTR)(_TEB + 8);
    DWORD_PTR stacklimit = *(PDWORD_PTR)(_TEB + 16);
    DWORD_PTR stack = stackBase - sizeof(DWORD_PTR);
    while (stacklimit < stack - rutsStackSize - btitStackSize) {
        if (*(PDWORD_PTR)stack == 0x00) {
            DWORD_PTR addr = *(PDWORD_PTR)(stack - rutsStackSize);
            if (addr > (DWORD_PTR)pRtlUserThreadStart && addr < (DWORD_PTR)pRtlUserThreadStart + 0xFF) {
                addr = *(PDWORD_PTR)(stack - rutsStackSize - btitStackSize);
                if (addr > (DWORD_PTR)pBaseThreadInitThunk && addr < (DWORD_PTR)pBaseThreadInitThunk + 0xFF) {
                    pInitStack = (PBYTE)stack - rutsStackSize - btitStackSize;
                }
            }
        }
        stack -= sizeof(DWORD_PTR);
    }
    if (pInitStack == NULL) {
        return 0;
    }

    // åœ¨ spoof.dll æŸ¥æ‰¾ Gadget
    FindGadget(pSpoof);
    if (pGadget == NULL || gadgetStackSize < minGadgetStackSize) {
        return 0;
    }
    return 1;
}

template<typename T>
__attribute__((naked)) T RetValue() {
    __asm {
        ret
    }
}

__attribute__((naked)) void FixRSP(...) {
    __asm {
        add rsp, initStackSize
        add rsp, gadgetStackSize
        add rsp, 0x98
        ret
    }
}

PVOID pFixRSP = FixRSP;

__attribute__((naked)) void JmpToFunc(...) {
    __asm {
        lea rbx, [pFixRSP]
        mov rax, pGadget
        mov qword ptr[rsp], rax
        sub rsp, 0x08
        ret
    }
}

void SetSpoofStack(PBYTE& pSpoofStack) {
    pSpoofStack -= (initStackSize + sizeof(DWORD_PTR) * 20);
    memcpy(pSpoofStack, pInitStack, initStackSize);
    *(PDWORD_PTR)(pSpoofStack + initStackSize) = 0x00;
    pSpoofStack -= gadgetStackSize;
}

__attribute__((naked)) void GetRetAddr() {
    __asm {
        mov rax, qword ptr[rsp]
        push rax
        ret
    }
}

// è®¡ç®—å‚æ•°æ€»å¤§å°, ä¸èƒ½è¶…è¿‡ 15 ä¸ª
#define SIZEOF0() 0
#define SIZEOF1(a) sizeof(a)
#define SIZEOF2(a, ...) sizeof(a) + SIZEOF1(__VA_ARGS__)
#define SIZEOF3(a, ...) sizeof(a) + SIZEOF2(__VA_ARGS__)
#define SIZEOF4(a, ...) sizeof(a) + SIZEOF3(__VA_ARGS__)
#define SIZEOF5(a, ...) sizeof(a) + SIZEOF4(__VA_ARGS__)
#define SIZEOF6(a, ...) sizeof(a) + SIZEOF5(__VA_ARGS__)
#define SIZEOF7(a, ...) sizeof(a) + SIZEOF6(__VA_ARGS__)
#define SIZEOF8(a, ...) sizeof(a) + SIZEOF7(__VA_ARGS__)
#define SIZEOF9(a, ...) sizeof(a) + SIZEOF8(__VA_ARGS__)
#define SIZEOF10(a, ...) sizeof(a) + SIZEOF9(__VA_ARGS__)
#define SIZEOF11(a, ...) sizeof(a) + SIZEOF10(__VA_ARGS__)
#define SIZEOF12(a, ...) sizeof(a) + SIZEOF11(__VA_ARGS__)
#define SIZEOF13(a, ...) sizeof(a) + SIZEOF12(__VA_ARGS__)
#define SIZEOF14(a, ...) sizeof(a) + SIZEOF13(__VA_ARGS__)
#define SIZEOF15(a, ...) sizeof(a) + SIZEOF14(__VA_ARGS__)

// å‚æ•°ä¸­ä¸èƒ½å­˜åœ¨å‡½æ•°è°ƒç”¨, å¦‚æœ Gadget æ ˆå¸§å¤§å° < å‚æ•°æ€»å¤§å°åˆ™ç›´æ¥è°ƒç”¨å‡½æ•°
#define SPOOF(pFunc, parasNum, ...) ({ \
    int minGadgetStackSize = SIZEOF##parasNum(__VA_ARGS__); \
    int result = GetSpoofStack(minGadgetStackSize); \
    using retType = decltype(((decltype(pFunc)*)pFunc)(__VA_ARGS__)); \
    if (result) { \
        int getRetAddr = 1; \
        while (1) { \
            if (!getRetAddr) { \
                PBYTE pSpoofStack; \
                __asm { \
                    mov pSpoofStack, rsp \
                } \
                SetSpoofStack(pSpoofStack); \
                __asm { \
                    mov rsp, pSpoofStack \
                } \
                __asm { \
                    lea rax, [pFunc] \
                } \
                __asm { \
                    mov qword ptr[rsp - 0x08], rax \
                } \
                __asm { \
                    pop rax \
                } \
                JmpToFunc(__VA_ARGS__); \
            } \
            __asm { \
                call GetRetAddr \
            } \
            if (!getRetAddr) { \
                break; \
            } \
            getRetAddr = 0; \
        } \
    } \
    if (!result) { \
        ((decltype(pFunc)*)pFunc)(__VA_ARGS__); \
    } \
    RetValue<retType>(); \
})
```

`StackSpoofer_Macro.cpp`:

```cpp
#include "Bypass.h"
#include "Obfuscator.h"
#include "StackSpoofer.h"

/*
* âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸
* 1.Release
* 2.å¸¸è§„: å¹³å°å·¥å…·é›†(LLVM (clang-cl))
* 3.C/C++
* ä¼˜åŒ–: ä¼˜åŒ–(å·²ç¦ç”¨)
* ä»£ç ç”Ÿæˆ: è¿è¡Œåº“(å¤šçº¿ç¨‹)
* 4.é“¾æ¥å™¨
* æ¸…å•æ–‡ä»¶: ç”Ÿæˆæ¸…å•(å¦)
* è°ƒè¯•: ç”Ÿæˆè°ƒè¯•ä¿¡æ¯(å¦)
*/

int Test(int a, int b, int c, int d, int e, int f, int g, int h, int i, int j) {
	return a + b + c + d + e + f + g + h + i + j;
}

int main() {
	// spoof.dll æ˜¯ä¸€ä¸ªæ ˆæ¬ºéª—è¾…åŠ© DLL, å…¶ä¸­å«æœ‰ä¸€ä¸ª Gadget å‡½æ•°, è¯¥å‡½æ•°çš„æ ˆå¸§å¤§åˆ°å¯ä»¥å­˜å‚¨ä»»æ„å‡½æ•°çš„å‚æ•°
	// å¦‚æœä½ ä¸å–œæ¬¢è¿™ä¸ªè®¾è®¡, ä½ å®Œå…¨å¯ä»¥ä»å…¶ä»–åœ°æ–¹å¯»æ‰¾ Gadget, æ¯”å¦‚å¯ä»¥æŠŠ Gadget å®šä¹‰åœ¨ Loader ä¸­
	LoadLibraryA(OBF("spoof"));
	char* content = OBF("content");
	SPOOF(MessageBoxA, 4, 0, content, content, MB_ICONINFORMATION);
	cout << SPOOF(Test, 10, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10) << endl;
}
```

`StackSpoofer_Macro.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.11.35312.102
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "StackSpoofer_Macro", "StackSpoofer_Macro.vcxproj", "{21484BC6-ECF2-49FD-81EF-181C5A478BAE}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Debug|x64.ActiveCfg = Debug|x64
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Debug|x64.Build.0 = Debug|x64
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Debug|x86.ActiveCfg = Debug|Win32
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Debug|x86.Build.0 = Debug|Win32
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Release|x64.ActiveCfg = Release|x64
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Release|x64.Build.0 = Release|x64
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Release|x86.ActiveCfg = Release|Win32
		{21484BC6-ECF2-49FD-81EF-181C5A478BAE}.Release|x86.Build.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {68D38251-89A0-44DC-8625-0F5D6EB3EF2A}
	EndGlobalSection
EndGlobal

```

`StackSpoofer_Macro.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>17.0</VCProjectVersion>
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{21484bc6-ecf2-49fd-81ef-181c5a478bae}</ProjectGuid>
    <RootNamespace>StackSpoofMacro</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>ClangCL</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>ClangCL</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <GenerateManifest>false</GenerateManifest>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <RuntimeLibrary>MultiThreadedDebug</RuntimeLibrary>
      <Optimization>Disabled</Optimization>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <RuntimeLibrary>MultiThreaded</RuntimeLibrary>
      <Optimization>Disabled</Optimization>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>false</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClCompile Include="StackSpoofer_Macro.cpp" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="Bypass.h" />
    <ClInclude Include="Obfuscator.h" />
    <ClInclude Include="StackSpoofer.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`StackSpoofer_Macro.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="æºæ–‡ä»¶">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;c++;cppm;ixx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="å¤´æ–‡ä»¶">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hh;hpp;hxx;h++;hm;inl;inc;ipp;xsd</Extensions>
    </Filter>
    <Filter Include="èµ„æºæ–‡ä»¶">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="StackSpoofer_Macro.cpp">
      <Filter>æºæ–‡ä»¶</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="Bypass.h">
      <Filter>å¤´æ–‡ä»¶</Filter>
    </ClInclude>
    <ClInclude Include="Obfuscator.h">
      <Filter>å¤´æ–‡ä»¶</Filter>
    </ClInclude>
    <ClInclude Include="StackSpoofer.h">
      <Filter>å¤´æ–‡ä»¶</Filter>
    </ClInclude>
  </ItemGroup>
</Project>
```

`StackSpoofer_Macro.vcxproj.user`:

```user
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup />
</Project>
```

`spoof/dllmain.cpp`:

```cpp
#include "pch.h"

__declspec(dllexport) PVOID Log(int run) {
    if (run) {
        volatile char buf[] = "12345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678";
        __asm {
            call rax
            mov rbx, qword ptr[rbx]
            jmp rbx
        }
    }
    return (PVOID)run;
}

BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
    switch (ul_reason_for_call)
    {
    case DLL_PROCESS_ATTACH:
    case DLL_THREAD_ATTACH:
    case DLL_THREAD_DETACH:
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}
```

`spoof/framework.h`:

```h
#pragma once

#define WIN32_LEAN_AND_MEAN             // ä» Windows å¤´æ–‡ä»¶ä¸­æ’é™¤æå°‘ä½¿ç”¨çš„å†…å®¹
// Windows å¤´æ–‡ä»¶
#include <windows.h>

```

`spoof/pch.cpp`:

```cpp
// pch.cpp: ä¸é¢„ç¼–è¯‘æ ‡å¤´å¯¹åº”çš„æºæ–‡ä»¶

#include "pch.h"

// å½“ä½¿ç”¨é¢„ç¼–è¯‘çš„å¤´æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ­¤æºæ–‡ä»¶ï¼Œç¼–è¯‘æ‰èƒ½æˆåŠŸã€‚

```

`spoof/pch.h`:

```h
// pch.h: è¿™æ˜¯é¢„ç¼–è¯‘æ ‡å¤´æ–‡ä»¶ã€‚
// ä¸‹æ–¹åˆ—å‡ºçš„æ–‡ä»¶ä»…ç¼–è¯‘ä¸€æ¬¡ï¼Œæé«˜äº†å°†æ¥ç”Ÿæˆçš„ç”Ÿæˆæ€§èƒ½ã€‚
// è¿™è¿˜å°†å½±å“ IntelliSense æ€§èƒ½ï¼ŒåŒ…æ‹¬ä»£ç å®Œæˆå’Œè®¸å¤šä»£ç æµè§ˆåŠŸèƒ½ã€‚
// ä½†æ˜¯ï¼Œå¦‚æœæ­¤å¤„åˆ—å‡ºçš„æ–‡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ¨ç”Ÿæˆä¹‹é—´æœ‰æ›´æ–°ï¼Œå®ƒä»¬å…¨éƒ¨éƒ½å°†è¢«é‡æ–°ç¼–è¯‘ã€‚
// è¯·å‹¿åœ¨æ­¤å¤„æ·»åŠ è¦é¢‘ç¹æ›´æ–°çš„æ–‡ä»¶ï¼Œè¿™å°†ä½¿å¾—æ€§èƒ½ä¼˜åŠ¿æ— æ•ˆã€‚

#ifndef PCH_H
#define PCH_H

// æ·»åŠ è¦åœ¨æ­¤å¤„é¢„ç¼–è¯‘çš„æ ‡å¤´
#include "framework.h"

#endif //PCH_H

```

`spoof/spoof.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.11.35312.102
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "spoof", "spoof.vcxproj", "{794534F6-648C-4FB1-9591-004FD279284F}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{794534F6-648C-4FB1-9591-004FD279284F}.Debug|x64.ActiveCfg = Debug|x64
		{794534F6-648C-4FB1-9591-004FD279284F}.Debug|x64.Build.0 = Debug|x64
		{794534F6-648C-4FB1-9591-004FD279284F}.Debug|x86.ActiveCfg = Debug|Win32
		{794534F6-648C-4FB1-9591-004FD279284F}.Debug|x86.Build.0 = Debug|Win32
		{794534F6-648C-4FB1-9591-004FD279284F}.Release|x64.ActiveCfg = Release|x64
		{794534F6-648C-4FB1-9591-004FD279284F}.Release|x64.Build.0 = Release|x64
		{794534F6-648C-4FB1-9591-004FD279284F}.Release|x86.ActiveCfg = Release|Win32
		{794534F6-648C-4FB1-9591-004FD279284F}.Release|x86.Build.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {6CA7F4AA-6FEE-45C4-8EF1-C820A34561CC}
	EndGlobalSection
EndGlobal

```

`spoof/spoof.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>17.0</VCProjectVersion>
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{794534f6-648c-4fb1-9591-004fd279284f}</ProjectGuid>
    <RootNamespace>spoof</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>ClangCL</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>ClangCL</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <GenerateManifest>false</GenerateManifest>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;_DEBUG;SPOOF_EXPORTS;_WINDOWS;_USRDLL;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <PrecompiledHeader>Use</PrecompiledHeader>
      <PrecompiledHeaderFile>pch.h</PrecompiledHeaderFile>
    </ClCompile>
    <Link>
      <SubSystem>Windows</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <EnableUAC>false</EnableUAC>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;SPOOF_EXPORTS;_WINDOWS;_USRDLL;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <PrecompiledHeader>Use</PrecompiledHeader>
      <PrecompiledHeaderFile>pch.h</PrecompiledHeaderFile>
    </ClCompile>
    <Link>
      <SubSystem>Windows</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <EnableUAC>false</EnableUAC>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;SPOOF_EXPORTS;_WINDOWS;_USRDLL;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <PrecompiledHeader>Use</PrecompiledHeader>
      <PrecompiledHeaderFile>pch.h</PrecompiledHeaderFile>
      <RuntimeLibrary>MultiThreadedDebug</RuntimeLibrary>
    </ClCompile>
    <Link>
      <SubSystem>Windows</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <EnableUAC>false</EnableUAC>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;SPOOF_EXPORTS;_WINDOWS;_USRDLL;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <PrecompiledHeader>Use</PrecompiledHeader>
      <PrecompiledHeaderFile>pch.h</PrecompiledHeaderFile>
      <RuntimeLibrary>MultiThreaded</RuntimeLibrary>
      <Optimization>MaxSpeed</Optimization>
    </ClCompile>
    <Link>
      <SubSystem>Windows</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>false</GenerateDebugInformation>
      <EnableUAC>false</EnableUAC>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClInclude Include="framework.h" />
    <ClInclude Include="pch.h" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="dllmain.cpp" />
    <ClCompile Include="pch.cpp">
      <PrecompiledHeader Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">Create</PrecompiledHeader>
      <PrecompiledHeader Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">Create</PrecompiledHeader>
      <PrecompiledHeader Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">Create</PrecompiledHeader>
      <PrecompiledHeader Condition="'$(Configuration)|$(Platform)'=='Release|x64'">Create</PrecompiledHeader>
    </ClCompile>
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`spoof/spoof.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="æºæ–‡ä»¶">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;c++;cppm;ixx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="å¤´æ–‡ä»¶">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hh;hpp;hxx;h++;hm;inl;inc;ipp;xsd</Extensions>
    </Filter>
    <Filter Include="èµ„æºæ–‡ä»¶">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="framework.h">
      <Filter>å¤´æ–‡ä»¶</Filter>
    </ClInclude>
    <ClInclude Include="pch.h">
      <Filter>å¤´æ–‡ä»¶</Filter>
    </ClInclude>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="dllmain.cpp">
      <Filter>æºæ–‡ä»¶</Filter>
    </ClCompile>
    <ClCompile Include="pch.cpp">
      <Filter>æºæ–‡ä»¶</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`spoof/spoof.vcxproj.user`:

```user
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup />
</Project>
```