Project Path: arc_gmh5225_hh-lol-prophet_o44hpt49

Source Tree:

```txt
arc_gmh5225_hh-lol-prophet_o44hpt49
â”œâ”€â”€ LICENSE
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ api.go
â”œâ”€â”€ app.go
â”œâ”€â”€ bin
â”‚   â””â”€â”€ .gitignore
â”œâ”€â”€ bootstrap
â”‚   â””â”€â”€ init.go
â”œâ”€â”€ cmd
â”‚   â”œâ”€â”€ hh-lol-prophet
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ lcu-agent
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ conf
â”‚   â”œâ”€â”€ appConf.go
â”‚   â””â”€â”€ client.go
â”œâ”€â”€ global
â”‚   â””â”€â”€ global.go
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ options.go
â”œâ”€â”€ pkg
â”‚   â”œâ”€â”€ bdk
â”‚   â”‚   â”œâ”€â”€ array.go
â”‚   â”‚   â”œâ”€â”€ context.go
â”‚   â”‚   â”œâ”€â”€ fn.go
â”‚   â”‚   â”œâ”€â”€ string.go
â”‚   â”‚   â”œâ”€â”€ time.go
â”‚   â”‚   â””â”€â”€ version.go
â”‚   â”œâ”€â”€ dto
â”‚   â”‚   â””â”€â”€ retcode
â”‚   â”‚       â””â”€â”€ retcode.go
â”‚   â”œâ”€â”€ fastcurd
â”‚   â”‚   â”œâ”€â”€ db.go
â”‚   â”‚   â”œâ”€â”€ filter.go
â”‚   â”‚   â”œâ”€â”€ fn.go
â”‚   â”‚   â”œâ”€â”€ request.go
â”‚   â”‚   â””â”€â”€ response.go
â”‚   â”œâ”€â”€ gin
â”‚   â”‚   â”œâ”€â”€ app.go
â”‚   â”‚   â””â”€â”€ log.go
â”‚   â”œâ”€â”€ logger
â”‚   â”‚   â””â”€â”€ level.go
â”‚   â””â”€â”€ windows
â”‚       â”œâ”€â”€ admin
â”‚       â”‚   â””â”€â”€ admin.go
â”‚       â”œâ”€â”€ process
â”‚       â”‚   â””â”€â”€ process.go
â”‚       â””â”€â”€ user32.go
â”œâ”€â”€ prophet.go
â”œâ”€â”€ routes.go
â”œâ”€â”€ services
â”‚   â”œâ”€â”€ buffApi
â”‚   â”‚   â””â”€â”€ update.go
â”‚   â”œâ”€â”€ db
â”‚   â”‚   â””â”€â”€ models
â”‚   â”‚       â””â”€â”€ Config.go
â”‚   â”œâ”€â”€ lcu
â”‚   â”‚   â”œâ”€â”€ api.go
â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â”œâ”€â”€ common.go
â”‚   â”‚   â”œâ”€â”€ gameScore.go
â”‚   â”‚   â””â”€â”€ models
â”‚   â”‚       â”œâ”€â”€ champion
â”‚   â”‚       â”‚   â””â”€â”€ champion.go
â”‚   â”‚       â””â”€â”€ lol.go
â”‚   â”œâ”€â”€ logger
â”‚   â”‚   â””â”€â”€ log.go
â”‚   â””â”€â”€ ws
â”‚       â”œâ”€â”€ client.go
â”‚       â””â”€â”€ hub.go
â”œâ”€â”€ version.go
â””â”€â”€ è®¡åˆ†æ–¹å¼.md

```

`LICENSE`:

```
MIT License

Copyright (c) 2018 Andy Pan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

```

`Makefile`:

```
.PHONY: build mode upx doc
GIT_COMMIT=`git rev-list -1 HEAD`
BUILD_TIME=`date '+%Y-%m-%d_%H:%M:%S'`
BUILD_USER=`whoami`
export GOPROXY=https://goproxy.cn,direct
build: cmd/hh-lol-prophet/main.go
	@CGO_ENABLED=1 GOOS=windows GOARCH=amd64 go build -tags=jsoniter -ldflags "-s -w \
-X github.com/real-web-world/hh-lol-prophet.Commit=$(GIT_COMMIT) \
-X github.com/real-web-world/hh-lol-prophet.BuildTime=$(BUILD_TIME) \
-X github.com/real-web-world/hh-lol-prophet.BuildUser=$(BUILD_USER) \
" -o bin/hh-lol-prophet.exe cmd/hh-lol-prophet/main.go
doc: cmd/hh-lol-prophet/main.go
	swag init -g .\cmd\hh-lol-prophet\main.go
clean: bin/
	@rm -rf bin/hh-lol-prophet.exe
upx : cmd/hh-lol-prophet/main.go
	make build
	upx -9 ./bin/hh-lol-prophet.exe

```

`README.md`:

```md
# lol å¯¹å±€å…ˆçŸ¥

qq ç¾¤: 102158075

ç½‘ç«™: [https://lol.buffge.com](https://lol.buffge.com)

[ä¸‹è½½åœ°å€](https://lol.buffge.com)

### ç¨‹åºé€»è¾‘
   - ç›‘æ§lol client
     - å­˜åœ¨   -> å¼€å§‹ç›‘å¬æ¸¸æˆäº‹ä»¶
     - ä¸å­˜åœ¨ -> å…³é—­æ¸¸æˆäº‹ä»¶ç›‘è§†å™¨ 
### æ¸¸æˆäº‹ä»¶ç›‘å¬å™¨
   - ç›‘å¬loläº‹ä»¶
   - å¦‚æœè¿›å…¥è‹±é›„é€‰æ‹©é˜¶æ®µ åˆ™è¿›å…¥åˆ†æç¨‹åº

### åˆ†æç¨‹åº:
- è·å–é˜Ÿä¼æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
  - æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·æœ€è¿‘20å±€æˆ˜ç»©å¹¶è®¡ç®—å¾—åˆ†
- æ ¹æ®æ‰€æœ‰ç”¨æˆ·çš„åˆ†æ•°åˆ¤æ–­å°ä»£ä¸Šç­‰é©¬ä¸­ç­‰é©¬ä¸‹ç­‰é©¬
- å‘é€åˆ°é€‰äººç•Œé¢

## ç‰¹æ€§
- è‡ªåŠ¨æ›´æ–°
- è‡ªåŠ¨æ¥å—å¯¹å±€
- è‡ªåŠ¨ban pick
- æŸ¥è¯¢ç”¨æˆ·é©¬åŒ¹ä¿¡æ¯

## [è®¡åˆ†è§„åˆ™](./è®¡åˆ†æ–¹å¼.md)

## å¼€å‘è®¡åˆ’
- ä¼˜åŒ–ç®—æ³•
  - æ ¹æ®å¯¹ä½æ•°æ®å·® è®¡åˆ†
  - å¯¹ç‰¹å®šä½ç½® è®¡ç®—ç‰¹å®šæŒ‡æ ‡ å¦‚ å¯¹æ‰“é‡è®¡ç®—å‚å›¢ç‡ å¦‚ä½äº50% æ‰£åˆ†
  - æœåŠ¡ç«¯
    -ä¸ŠæŠ¥è®¡ç®—æ•°æ® æ¯ä¸€å±€ æ¯ä¸ªäººkda å®é™…å¾—åˆ†
  - gui
    - æœ‰guiåè€ƒè™‘åŠ ä¸Šæœ‰è¶£çš„åŠŸèƒ½
    
- ä¼˜åŒ–lol.buffge.comç½‘ç«™
- é…ç½®:
   - é‡åˆ°ç‰¹å®šç”¨æˆ· å‘é€ç‰¹å®šæ¶ˆæ¯ æ¯”å¦‚ "é‡éœ¸ä¸ç§’é€€,åäº”ä¸¤è¡Œç´¯" "è¥¿å†…!" "å°å¿ƒå®¶çŒªé‡çŒª"

## ğŸ”‹ JetBrains å¼€æºè¯ä¹¦æ”¯æŒ

`hh-lol-prophet` é¡¹ç›®ä¸€ç›´ä»¥æ¥éƒ½æ˜¯åœ¨ JetBrains å…¬å¸æ——ä¸‹çš„ GoLand é›†æˆå¼€å‘ç¯å¢ƒä¸­è¿›è¡Œå¼€å‘ï¼ŒåŸºäº **free JetBrains Open Source license(s)** æ­£ç‰ˆå…è´¹æˆæƒï¼Œåœ¨æ­¤è¡¨è¾¾æˆ‘çš„è°¢æ„ã€‚

<a href="https://www.jetbrains.com/?from=hh-lol-prophet" target="_blank"><img src="https://raw.githubusercontent.com/panjf2000/illustrations/master/jetbrains/jetbrains-variant-4.png" width="250" align="middle"/></a>  

    

```

`api.go`:

```go
package hh_lol_prophet

import (
	"encoding/json"
	"strings"

	"github.com/gin-gonic/gin"

	"github.com/real-web-world/hh-lol-prophet/conf"
	"github.com/real-web-world/hh-lol-prophet/global"
	ginApp "github.com/real-web-world/hh-lol-prophet/pkg/gin"
	"github.com/real-web-world/hh-lol-prophet/services/db/models"
	"github.com/real-web-world/hh-lol-prophet/services/lcu"
)

type (
	Api struct {
		p *Prophet
	}
	summonerNameReq struct {
		SummonerName string `json:"summonerName"`
	}
)

func (api Api) ProphetActiveMid(c *gin.Context) {
	app := ginApp.GetApp(c)
	if !api.p.lcuActive {
		app.ErrorMsg("è¯·æ£€æŸ¥lolå®¢æˆ·ç«¯æ˜¯å¦å·²å¯åŠ¨")
		return
	}
	c.Next()
}
func (api Api) QueryHorseBySummonerName(c *gin.Context) {
	app := ginApp.GetApp(c)
	d := &summonerNameReq{}
	if err := c.ShouldBind(d); err != nil {
		app.ValidError(err)
		return
	}
	summonerName := strings.TrimSpace(d.SummonerName)
	var summonerID int64 = 0
	if summonerName == "" {
		if api.p.currSummoner == nil {
			app.ErrorMsg("ç³»ç»Ÿé”™è¯¯")
			return
		}
		summonerID = api.p.currSummoner.SummonerId
	} else {
		info, err := lcu.QuerySummonerByName(summonerName)
		if err != nil || info.SummonerId <= 0 {
			app.ErrorMsg("æœªæŸ¥è¯¢åˆ°å¬å”¤å¸ˆ")
			return
		}
		summonerID = info.SummonerId
	}
	scoreInfo, err := GetUserScore(summonerID)
	if err != nil {
		app.CommonError(err)
		return
	}
	scoreCfg := global.GetScoreConf()
	clientCfg := global.GetClientConf()
	var horse string
	for i, v := range scoreCfg.Horse {
		if scoreInfo.Score >= v.Score {
			horse = clientCfg.HorseNameConf[i]
			break
		}
	}
	app.Data(gin.H{
		"score":   scoreInfo.Score,
		"currKDA": scoreInfo.CurrKDA,
		"horse":   horse,
	})
}

func (api Api) CopyHorseMsgToClipBoard(c *gin.Context) {
	app := ginApp.GetApp(c)
	app.Success()
}
func (api Api) GetAllConf(c *gin.Context) {
	app := ginApp.GetApp(c)
	app.Data(global.GetClientConf())
}
func (api Api) UpdateClientConf(c *gin.Context) {
	app := ginApp.GetApp(c)
	d := &conf.UpdateClientConfReq{}
	if err := c.ShouldBind(d); err != nil {
		app.ValidError(err)
		return
	}
	cfg := global.SetClientConf(*d)
	bts, _ := json.Marshal(cfg)
	m := models.Config{}
	err := m.Update(models.LocalClientConfKey, string(bts))
	if err != nil {
		app.CommonError(err)
		return
	}
	app.Success()
}
func (api Api) DevHand(c *gin.Context) {
	app := ginApp.GetApp(c)
	app.Data(gin.H{
		"buffge": 23456,
	})
}
func (api Api) GetAppInfo(c *gin.Context) {
	app := ginApp.GetApp(c)
	app.Data(global.AppBuildInfo)
}
func (api Api) GetLcuAuthInfo(c *gin.Context) {
	app := ginApp.GetApp(c)
	port, token, err := lcu.GetLolClientApiInfo()
	if err != nil {
		app.CommonError(err)
		return
	}
	app.Data(gin.H{
		"token": token,
		"port":  port,
	})
}

```

`app.go`:

```go
package hh_lol_prophet

import (
	"fmt"
	"log"
	"sync"
	"time"

	"github.com/avast/retry-go"
	"github.com/getsentry/sentry-go"
	"github.com/pkg/errors"
	"go.uber.org/zap"
	"golang.org/x/sync/errgroup"

	"github.com/real-web-world/hh-lol-prophet/global"
	"github.com/real-web-world/hh-lol-prophet/services/lcu"
	"github.com/real-web-world/hh-lol-prophet/services/lcu/models"

	"github.com/real-web-world/hh-lol-prophet/pkg/bdk"
	"github.com/real-web-world/hh-lol-prophet/services/logger"
)

const (
	defaultScore       = 100 // é»˜è®¤åˆ†æ•°
	minGameDurationSec = 15 * 60
)

var (
	SendConversationMsg   = lcu.SendConversationMsg
	ListConversationMsg   = lcu.ListConversationMsg
	GetCurrConversationID = lcu.GetCurrConversationID
	QuerySummoner         = lcu.QuerySummoner
	QueryGameSummary      = lcu.QueryGameSummary
	ListGamesBySummonerID = lcu.ListGamesBySummonerID
)

func getTeamUsers() (string, []int64, error) {
	conversationID, err := GetCurrConversationID()
	if err != nil {
		return "", nil, err
	}
	msgList, err := ListConversationMsg(conversationID)
	if err != nil {
		return "", nil, err
	}
	summonerIDList := getSummonerIDListFromConversationMsgList(msgList)
	return conversationID, summonerIDList, nil
}
func getSummonerIDListFromConversationMsgList(msgList []lcu.ConversationMsg) []int64 {
	summonerIDList := make([]int64, 0, 5)
	for _, msg := range msgList {
		if msg.Type == lcu.ConversationMsgTypeSystem && msg.Body == lcu.JoinedRoomMsg {
			summonerIDList = append(summonerIDList, msg.FromSummonerId)
		}
	}
	return summonerIDList
}

func GetUserScore(summonerID int64) (*lcu.UserScore, error) {
	userScoreInfo := &lcu.UserScore{
		SummonerID: summonerID,
		Score:      defaultScore,
	}
	// è·å–ç”¨æˆ·ä¿¡æ¯
	summoner, err := QuerySummoner(summonerID)
	if err != nil {
		return nil, err
	}
	userScoreInfo.SummonerName = summoner.DisplayName
	// è·å–æˆ˜ç»©åˆ—è¡¨
	gameList, err := listGameHistory(summonerID)
	if err != nil {
		logger.Error("è·å–ç”¨æˆ·æˆ˜ç»©å¤±è´¥", zap.Error(err), zap.Int64("id", summonerID))
		return userScoreInfo, nil
	}
	// è·å–æ¯ä¸€å±€æˆ˜ç»©
	g := errgroup.Group{}
	gameSummaryList := make([]lcu.GameSummary, 0, len(gameList))
	mu := sync.Mutex{}
	currKDAList := make([][3]int, len(gameList))
	for i, info := range gameList {
		info := info
		currKDAList[len(gameList)-i-1] = [3]int{
			info.Participants[0].Stats.Kills,
			info.Participants[0].Stats.Deaths,
			info.Participants[0].Stats.Assists,
		}
		g.Go(func() error {
			var gameSummary *lcu.GameSummary
			err = retry.Do(func() error {
				var tmpErr error
				gameSummary, tmpErr = QueryGameSummary(info.GameId)
				return tmpErr
			}, retry.Delay(time.Millisecond*10), retry.Attempts(5))
			if err != nil {
				sentry.WithScope(func(scope *sentry.Scope) {
					scope.SetLevel(sentry.LevelError)
					scope.SetExtra("info", info)
					scope.SetExtra("gameID", info.GameId)
					scope.SetExtra("error", err.Error())
					scope.SetExtra("errorVerbose", errors.Errorf("%+v", err))
					sentry.CaptureMessage("è·å–æ¸¸æˆå¯¹å±€è¯¦ç»†ä¿¡æ¯å¤±è´¥")
				})
				logger.Debug("è·å–æ¸¸æˆå¯¹å±€è¯¦ç»†ä¿¡æ¯å¤±è´¥", zap.Error(err), zap.Int64("id", info.GameId))
				return nil
			}
			mu.Lock()
			gameSummaryList = append(gameSummaryList, *gameSummary)
			mu.Unlock()
			return nil
		})
	}
	userScoreInfo.CurrKDA = currKDAList
	err = g.Wait()
	if err != nil {
		logger.Error("è·å–ç”¨æˆ·è¯¦ç»†æˆ˜ç»©å¤±è´¥", zap.Error(err), zap.Int64("id", summonerID))
		return userScoreInfo, nil
	}
	// åˆ†ææ¯ä¸€å±€æˆ˜ç»©è®¡ç®—å¾—åˆ†
	var totalScore float64 = 0
	totalGameCount := 0
	type gameScoreWithWeight struct {
		score       float64
		isCurrTimes bool
	}
	// gameWeightScoreList := make([]gameScoreWithWeight, 0, len(gameSummaryList))
	nowTime := time.Now()
	currTimeScoreList := make([]float64, 0, 10)
	otherGameScoreList := make([]float64, 0, 10)
	for _, gameSummary := range gameSummaryList {
		gameScore, err := calcUserGameScore(summonerID, gameSummary)
		if err != nil {
			logger.Debug("æ¸¸æˆæˆ˜ç»©è®¡ç®—ç”¨æˆ·å¾—åˆ†å¤±è´¥", zap.Error(err), zap.Int64("summonerID", summonerID),
				zap.Int64("gameID", gameSummary.GameId))
			return userScoreInfo, nil
		}
		weightScoreItem := gameScoreWithWeight{
			score:       gameScore.Value(),
			isCurrTimes: nowTime.Before(gameSummary.GameCreationDate.Add(time.Hour * 5)),
		}
		if weightScoreItem.isCurrTimes {
			currTimeScoreList = append(currTimeScoreList, gameScore.Value())
		} else {
			otherGameScoreList = append(otherGameScoreList, gameScore.Value())
		}
		totalGameCount++
		totalScore += gameScore.Value()
		// log.Printf("game: %d,å¾—åˆ†: %.2f\n", gameSummary.GameId, gameScore)
	}
	totalGameScore := 0.0
	totalTimeScore := 0.0
	avgTimeScore := 0.0
	totalOtherGameScore := 0.0
	avgOtherGameScore := 0.0
	for _, score := range currTimeScoreList {
		totalTimeScore += score
		totalGameScore += score
	}
	for _, score := range otherGameScoreList {
		totalOtherGameScore += score
		totalGameScore += score
	}
	if totalTimeScore > 0 {
		avgTimeScore = totalTimeScore / float64(len(currTimeScoreList))
	}
	if totalOtherGameScore > 0 {
		avgOtherGameScore = totalOtherGameScore / float64(len(otherGameScoreList))
	}
	totalGameAvgScore := 0.0
	if totalGameCount > 0 {
		totalGameAvgScore = totalGameScore / float64(totalGameCount)
	}
	weightTotalScore := 0.0
	// curr time
	{
		if len(currTimeScoreList) == 0 {
			weightTotalScore += .8 * totalGameAvgScore
		} else {
			weightTotalScore += .8 * avgTimeScore
		}
	}
	// other games
	{
		if len(otherGameScoreList) == 0 {
			weightTotalScore += .2 * totalGameAvgScore
		} else {
			weightTotalScore += .2 * avgOtherGameScore
		}
	}
	// è®¡ç®—å¹³å‡å€¼è¿”å›
	// userScoreInfo.Score = totalScore / float64(totalGameCount)
	if len(gameSummaryList) == 0 {
		weightTotalScore = defaultScore
	}
	userScoreInfo.Score = weightTotalScore
	return userScoreInfo, nil
}

func listGameHistory(summonerID int64) ([]lcu.GameInfo, error) {
	fmtList := make([]lcu.GameInfo, 0, 20)
	resp, err := ListGamesBySummonerID(summonerID, 0, 20)
	if err != nil {
		logger.Error("æŸ¥è¯¢ç”¨æˆ·æˆ˜ç»©å¤±è´¥", zap.Error(err), zap.Int64("summonerID", summonerID))
		return nil, err
	}
	for _, gameItem := range resp.Games.Games {
		if gameItem.QueueId != models.NormalQueueID &&
			gameItem.QueueId != models.RankSoleQueueID &&
			gameItem.QueueId != models.ARAMQueueID &&
			gameItem.QueueId != models.RankFlexQueueID {
			continue
		}
		if gameItem.GameDuration < minGameDurationSec {
			continue
		}
		fmtList = append(fmtList, gameItem)
	}
	return fmtList, nil
}

func calcUserGameScore(summonerID int64, gameSummary lcu.GameSummary) (*lcu.ScoreWithReason, error) {
	calcScoreConf := global.GetScoreConf()
	gameScore := lcu.NewScoreWithReason(defaultScore)
	var userParticipantId int
	for _, identity := range gameSummary.ParticipantIdentities {
		if identity.Player.SummonerId == summonerID {
			userParticipantId = identity.ParticipantId
		}
	}
	if userParticipantId == 0 {
		return nil, errors.New("è·å–ç”¨æˆ·ä½ç½®å¤±è´¥")
	}
	var userTeamID *models.TeamID
	memberParticipantIDList := make([]int, 0, 4)
	idMapParticipant := make(map[int]lcu.Participant, len(gameSummary.Participants))
	for _, item := range gameSummary.Participants {
		if item.ParticipantId == userParticipantId {
			userTeamID = &item.TeamId
		}
		idMapParticipant[item.ParticipantId] = item
	}
	if userTeamID == nil {
		return nil, errors.New("è·å–ç”¨æˆ·é˜Ÿä¼idå¤±è´¥")
	}
	for _, item := range gameSummary.Participants {
		if item.TeamId == *userTeamID {
			memberParticipantIDList = append(memberParticipantIDList, item.ParticipantId)
		}
	}
	totalKill := 0   // æ€»äººå¤´
	totalDeath := 0  // æ€»æ­»äº¡
	totalAssist := 0 // æ€»åŠ©æ”»
	totalHurt := 0   // æ€»ä¼¤å®³
	totalMoney := 0  // æ€»é‡‘é’±
	for _, participant := range gameSummary.Participants {
		if participant.TeamId != *userTeamID {
			continue
		}
		totalKill += participant.Stats.Kills
		totalDeath += participant.Stats.Deaths
		totalAssist += participant.Stats.Assists
		totalHurt += participant.Stats.TotalDamageDealtToChampions
		totalMoney += participant.Stats.GoldEarned
	}
	userParticipant := idMapParticipant[userParticipantId]
	isSupportRole := userParticipant.Timeline.Lane == models.LaneBottom &&
		userParticipant.Timeline.Role == models.ChampionRoleSupport
	// ä¸€è¡€å‡»æ€
	if userParticipant.Stats.FirstBloodKill {
		gameScore.Add(calcScoreConf.FirstBlood[0], lcu.ScoreOptionFirstBloodKill)
		// ä¸€è¡€åŠ©æ”»
	} else if userParticipant.Stats.FirstBloodAssist {
		gameScore.Add(calcScoreConf.FirstBlood[1], lcu.ScoreOptionFirstBloodAssist)
	}
	// äº”æ€
	if userParticipant.Stats.PentaKills > 0 {
		gameScore.Add(calcScoreConf.PentaKills[0], lcu.ScoreOptionPentaKills)
		// å››æ€
	} else if userParticipant.Stats.QuadraKills > 0 {
		gameScore.Add(calcScoreConf.QuadraKills[0], lcu.ScoreOptionQuadraKills)
		// ä¸‰æ€
	} else if userParticipant.Stats.TripleKills > 0 {
		gameScore.Add(calcScoreConf.TripleKills[0], lcu.ScoreOptionTripleKills)
	}
	// å‚å›¢ç‡
	if totalKill > 0 {
		joinTeamRateRank := 1
		userJoinTeamKillRate := float64(userParticipant.Stats.Assists+userParticipant.Stats.Kills) / float64(
			totalKill)
		memberJoinTeamKillRates := listMemberJoinTeamKillRates(&gameSummary, totalKill, memberParticipantIDList)
		for _, rate := range memberJoinTeamKillRates {
			if rate > userJoinTeamKillRate {
				joinTeamRateRank++
			}
		}
		if joinTeamRateRank == 1 {
			gameScore.Add(calcScoreConf.JoinTeamRateRank[0], lcu.ScoreOptionJoinTeamRateRank)
		} else if joinTeamRateRank == 2 {
			gameScore.Add(calcScoreConf.JoinTeamRateRank[1], lcu.ScoreOptionJoinTeamRateRank)
		} else if joinTeamRateRank == 4 {
			gameScore.Add(-calcScoreConf.JoinTeamRateRank[2], lcu.ScoreOptionJoinTeamRateRank)
		} else if joinTeamRateRank == 5 {
			gameScore.Add(-calcScoreConf.JoinTeamRateRank[3], lcu.ScoreOptionJoinTeamRateRank)
		}
	}
	// è·å–é‡‘é’±
	if totalMoney > 0 {
		moneyRank := 1
		userMoney := userParticipant.Stats.GoldEarned
		memberMoneyList := listMemberMoney(&gameSummary, memberParticipantIDList)
		for _, v := range memberMoneyList {
			if v > userMoney {
				moneyRank++
			}
		}
		if moneyRank == 1 {
			gameScore.Add(calcScoreConf.GoldEarnedRank[0], lcu.ScoreOptionGoldEarnedRank)
		} else if moneyRank == 2 {
			gameScore.Add(calcScoreConf.GoldEarnedRank[1], lcu.ScoreOptionGoldEarnedRank)
		} else if moneyRank == 4 && !isSupportRole {
			gameScore.Add(-calcScoreConf.GoldEarnedRank[2], lcu.ScoreOptionGoldEarnedRank)
		} else if moneyRank == 5 && !isSupportRole {
			gameScore.Add(-calcScoreConf.GoldEarnedRank[3], lcu.ScoreOptionGoldEarnedRank)
		}
	}
	// ä¼¤å®³å æ¯”
	if totalHurt > 0 {
		hurtRank := 1
		userHurt := userParticipant.Stats.TotalDamageDealtToChampions
		memberHurtList := listMemberHurt(&gameSummary, memberParticipantIDList)
		for _, v := range memberHurtList {
			if v > userHurt {
				hurtRank++
			}
		}
		if hurtRank == 1 {
			gameScore.Add(calcScoreConf.HurtRank[0], lcu.ScoreOptionHurtRank)
		} else if hurtRank == 2 {
			gameScore.Add(calcScoreConf.HurtRank[1], lcu.ScoreOptionHurtRank)
		}
	}
	// é‡‘é’±è½¬æ¢ä¼¤å®³æ¯”
	if totalMoney > 0 && totalHurt > 0 {
		money2hurtRateRank := 1
		userMoney2hurtRate := float64(userParticipant.Stats.TotalDamageDealtToChampions) / float64(userParticipant.Stats.
			GoldEarned)
		memberMoney2hurtRateList := listMemberMoney2hurtRate(&gameSummary, memberParticipantIDList)
		for _, v := range memberMoney2hurtRateList {
			if v > userMoney2hurtRate {
				money2hurtRateRank++
			}
		}
		if money2hurtRateRank == 1 {
			gameScore.Add(calcScoreConf.Money2hurtRateRank[0], lcu.ScoreOptionMoney2hurtRateRank)
		} else if money2hurtRateRank == 2 {
			gameScore.Add(calcScoreConf.Money2hurtRateRank[1], lcu.ScoreOptionMoney2hurtRateRank)
		}
	}
	// è§†é‡å¾—åˆ†
	{
		visionScoreRank := 1
		userVisionScore := userParticipant.Stats.VisionScore
		memberVisionScoreList := listMemberVisionScore(&gameSummary, memberParticipantIDList)
		for _, v := range memberVisionScoreList {
			if v > userVisionScore {
				visionScoreRank++
			}
		}
		if visionScoreRank == 1 {
			gameScore.Add(calcScoreConf.VisionScoreRank[0], lcu.ScoreOptionVisionScoreRank)
		} else if visionScoreRank == 2 {
			gameScore.Add(calcScoreConf.VisionScoreRank[1], lcu.ScoreOptionVisionScoreRank)
		}
	}
	// è¡¥å…µ æ¯åˆ†é’Ÿ8ä¸ªåˆ€ä»¥ä¸ŠåŠ 5åˆ† ,9+10, 10+20
	{
		totalMinionsKilled := userParticipant.Stats.TotalMinionsKilled
		gameDurationMinute := gameSummary.GameDuration / 60
		minuteMinionsKilled := totalMinionsKilled / gameDurationMinute
		for _, minionsKilledLimit := range calcScoreConf.MinionsKilled {
			if minuteMinionsKilled >= int(minionsKilledLimit[0]) {
				gameScore.Add(minionsKilledLimit[1], lcu.ScoreOptionMinionsKilled)
				break
			}
		}
	}
	// äººå¤´å æ¯”
	if totalKill > 0 {
		// äººå¤´å æ¯”>50%
		userKillRate := float64(userParticipant.Stats.Kills) / float64(totalKill)
	userKillRateLoop:
		for _, killRateConfItem := range calcScoreConf.KillRate {
			if userKillRate > killRateConfItem.Limit {
				for _, limitConf := range killRateConfItem.ScoreConf {
					if userParticipant.Stats.Kills > int(limitConf[0]) {
						gameScore.Add(limitConf[1], lcu.ScoreOptionKillRate)
						break userKillRateLoop
					}
				}
			}
		}
	}
	// ä¼¤å®³å æ¯”
	if totalHurt > 0 {
		// ä¼¤å®³å æ¯”>50%
		userHurtRate := float64(userParticipant.Stats.TotalDamageDealtToChampions) / float64(totalHurt)
	userHurtRateLoop:
		for _, killRateConfItem := range calcScoreConf.HurtRate {
			if userHurtRate > killRateConfItem.Limit {
				for _, limitConf := range killRateConfItem.ScoreConf {
					if userParticipant.Stats.Kills > int(limitConf[0]) {
						gameScore.Add(limitConf[1], lcu.ScoreOptionHurtRate)
						break userHurtRateLoop
					}
				}
			}
		}
	}
	// åŠ©æ”»å æ¯”
	if totalAssist > 0 {
		// åŠ©æ”»å æ¯”>50%
		userAssistRate := float64(userParticipant.Stats.Assists) / float64(totalAssist)
	userAssistRateLoop:
		for _, killRateConfItem := range calcScoreConf.AssistRate {
			if userAssistRate > killRateConfItem.Limit {
				for _, limitConf := range killRateConfItem.ScoreConf {
					if userParticipant.Stats.Kills > int(limitConf[0]) {
						gameScore.Add(limitConf[1], lcu.ScoreOptionAssistRate)
						break userAssistRateLoop
					}
				}
			}
		}
	}
	userJoinTeamKillRate := 1.0
	if totalKill > 0 {
		userJoinTeamKillRate = float64(userParticipant.Stats.Assists+userParticipant.Stats.Kills) / float64(
			totalKill)
	}
	userDeathTimes := userParticipant.Stats.Deaths
	if userParticipant.Stats.Deaths == 0 {
		userDeathTimes = 1
	}
	adjustVal := (float64(userParticipant.Stats.Kills+userParticipant.Stats.Assists)/float64(userDeathTimes) -
		calcScoreConf.AdjustKDA[0] +
		float64(userParticipant.Stats.Kills-userParticipant.Stats.Deaths)/calcScoreConf.AdjustKDA[1]) * userJoinTeamKillRate
	// log.Printf("game: %d,kda: %d/%d/%d\n", gameSummary.GameId, userParticipant.Stats.Kills,
	// 	userParticipant.Stats.Deaths, userParticipant.Stats.Assists)
	gameScore.Add(adjustVal, lcu.ScoreOptionKDAAdjust)
	kdaInfoStr := fmt.Sprintf("%d/%d/%d", userParticipant.Stats.Kills, userParticipant.Stats.Deaths,
		userParticipant.Stats.Assists)
	if global.IsDevMode() {
		log.Printf("å¯¹å±€%då¾—åˆ†:%.2f, kda:%s,åŸå› :%s", gameSummary.GameId, gameScore.Value(), kdaInfoStr, gameScore.Reasons2String())
	}
	return gameScore, nil
}

func listMemberVisionScore(gameSummary *lcu.GameSummary, memberParticipantIDList []int) []int {
	res := make([]int, 0, 4)
	for _, participant := range gameSummary.Participants {
		if !bdk.InArrayInt(participant.ParticipantId, memberParticipantIDList) {
			continue
		}
		res = append(res, participant.Stats.VisionScore)
	}
	return res
}

func listMemberMoney2hurtRate(gameSummary *lcu.GameSummary, memberParticipantIDList []int) []float64 {
	res := make([]float64, 0, 4)
	for _, participant := range gameSummary.Participants {
		if !bdk.InArrayInt(participant.ParticipantId, memberParticipantIDList) {
			continue
		}
		res = append(res, float64(participant.Stats.TotalDamageDealtToChampions)/float64(participant.Stats.
			GoldEarned))
	}
	return res
}

func listMemberMoney(gameSummary *lcu.GameSummary, memberParticipantIDList []int) []int {
	res := make([]int, 0, 4)
	for _, participant := range gameSummary.Participants {
		if !bdk.InArrayInt(participant.ParticipantId, memberParticipantIDList) {
			continue
		}
		res = append(res, participant.Stats.GoldEarned)
	}
	return res
}

func listMemberJoinTeamKillRates(gameSummary *lcu.GameSummary, totalKill int, memberParticipantIDList []int) []float64 {
	res := make([]float64, 0, 4)
	for _, participant := range gameSummary.Participants {
		if !bdk.InArrayInt(participant.ParticipantId, memberParticipantIDList) {
			continue
		}
		res = append(res, float64(participant.Stats.Assists+participant.Stats.Kills)/float64(
			totalKill))
	}
	return res
}

func listMemberHurt(gameSummary *lcu.GameSummary, memberParticipantIDList []int) []int {
	res := make([]int, 0, 4)
	for _, participant := range gameSummary.Participants {
		if !bdk.InArrayInt(participant.ParticipantId, memberParticipantIDList) {
			continue
		}
		res = append(res, participant.Stats.TotalDamageDealtToChampions)
	}
	return res
}
func getAllUsersFromSession(selfID int64, session *lcu.GameFlowSession) (selfTeamUsers []int64,
	enemyTeamUsers []int64) {
	selfTeamUsers = make([]int64, 0, 5)
	enemyTeamUsers = make([]int64, 0, 5)
	selfTeamID := models.TeamIDNone
	for _, teamUser := range session.GameData.TeamOne {
		summonerID := int64(teamUser.SummonerId)
		if selfID == summonerID {
			selfTeamID = models.TeamIDBlue
			break
		}
	}
	if selfTeamID == models.TeamIDNone {
		for _, teamUser := range session.GameData.TeamTwo {
			summonerID := int64(teamUser.SummonerId)
			if selfID == summonerID {
				selfTeamID = models.TeamIDRed
				break
			}
		}
	}
	if selfTeamID == models.TeamIDNone {
		return
	}
	for _, user := range session.GameData.TeamOne {
		userID := int64(user.SummonerId)
		if userID <= 0 {
			return
		}
		if models.TeamIDBlue == selfTeamID {
			selfTeamUsers = append(selfTeamUsers, userID)
		} else {
			enemyTeamUsers = append(enemyTeamUsers, userID)
		}
	}
	for _, user := range session.GameData.TeamTwo {
		userID := int64(user.SummonerId)
		if userID <= 0 {
			return
		}
		if models.TeamIDRed == selfTeamID {
			selfTeamUsers = append(selfTeamUsers, userID)
		} else {
			enemyTeamUsers = append(enemyTeamUsers, userID)
		}
	}
	return
}

```

`bin/.gitignore`:

```
*
!.gitignore
```

`bootstrap/init.go`:

```go
package bootstrap

import (
	"encoding/json"
	"io"
	"net/http"
	"os"
	"strings"
	"time"

	"github.com/getsentry/sentry-go"
	"github.com/jinzhu/configor"
	"github.com/jinzhu/now"
	"github.com/joho/godotenv"
	"github.com/pkg/errors"
	"go.uber.org/zap"
	"go.uber.org/zap/zapcore"
	"golang.org/x/sys/windows"
	"gopkg.in/natefinch/lumberjack.v2"
	"gorm.io/driver/sqlite"
	"gorm.io/gorm"
	gormLogger "gorm.io/gorm/logger"

	"github.com/real-web-world/hh-lol-prophet/services/db/models"

	"github.com/real-web-world/hh-lol-prophet/pkg/windows/admin"
	"github.com/real-web-world/hh-lol-prophet/services/ws"

	hh_lol_prophet "github.com/real-web-world/hh-lol-prophet"
	"github.com/real-web-world/hh-lol-prophet/services/buffApi"

	"github.com/real-web-world/hh-lol-prophet/conf"
	"github.com/real-web-world/hh-lol-prophet/global"
	"github.com/real-web-world/hh-lol-prophet/pkg/bdk"
	"github.com/real-web-world/hh-lol-prophet/pkg/logger"
)

const (
	defaultTZ = "Asia/Shanghai"
)

func initConf() {
	_ = godotenv.Load(".env")
	if bdk.IsFile(".env.local") {
		_ = godotenv.Overload(".env.local")
	}
	// confPath := "./config/config.json"
	// err := configor.Load(global.Conf, confPath)
	*global.Conf = global.DefaultAppConf
	err := configor.Load(global.Conf)
	if err != nil {
		panic(err)
	}
	err = initClientConf()
	if err != nil {
		panic(err)
	}
}

func initClientConf() (err error) {
	dbPath := conf.SqliteDBPath
	var db *gorm.DB
	var dbLogger = gormLogger.Discard
	if global.IsDevMode() {
		dbLogger = gormLogger.Default
	}
	gormCfg := &gorm.Config{
		Logger: dbLogger,
	}
	if !bdk.IsFile(dbPath) {
		db, err = gorm.Open(sqlite.Open(dbPath), gormCfg)
		bts, _ := json.Marshal(global.DefaultClientConf)
		err = db.Exec(models.InitLocalClientSql, models.LocalClientConfKey, string(bts)).Error
		if err != nil {
			return
		}
		*global.ClientConf = global.DefaultClientConf
	} else {
		db, err = gorm.Open(sqlite.Open(dbPath), gormCfg)
		confItem := &models.Config{}
		err = db.Table("config").Where("k = ?", models.LocalClientConfKey).First(confItem).Error
		if err != nil {
			return
		}
		localClientConf := &conf.Client{}
		err = json.Unmarshal([]byte(confItem.Val), localClientConf)
		if err != nil || conf.ValidClientConf(localClientConf) != nil {
			return errors.New("æœ¬åœ°é…ç½®é”™è¯¯")
		}
		global.ClientConf = localClientConf
	}
	global.SqliteDB = db
	return nil
}

func initLog(cfg *conf.LogConf) {
	writeSyncer := zapcore.AddSync(&lumberjack.Logger{
		Filename:   cfg.Filepath,
		MaxSize:    cfg.MaxSize,
		MaxBackups: cfg.MaxBackups,
		MaxAge:     cfg.MaxAge,
		Compress:   cfg.Compress,
		LocalTime:  true,
	})
	if global.IsDevMode() {
		writeSyncer = zapcore.AddSync(os.Stdout)
	}
	config := zap.NewProductionEncoderConfig()
	config.EncodeTime = zapcore.ISO8601TimeEncoder
	config.EncodeDuration = zapcore.StringDurationEncoder
	level, err := logger.Str2ZapLevel(cfg.Level)
	if err != nil {
		panic("zap level is Incorrect")
	}
	core := zapcore.NewCore(
		zapcore.NewJSONEncoder(config),
		writeSyncer,
		zap.NewAtomicLevelAt(level),
	)
	global.Logger = zap.New(core, zap.AddCaller(), zap.AddCallerSkip(1)).Sugar()
}
func InitApp() error {
	admin.MustRunWithAdmin()
	initConsole()
	initConf()
	initLog(&global.Conf.Log)
	initLib()
	initApi()
	initGlobal()
	return nil
}

func initConsole() {
	stdIn := windows.Handle(os.Stdin.Fd())
	var consoleMode uint32
	_ = windows.GetConsoleMode(stdIn, &consoleMode)
	consoleMode = consoleMode&^windows.ENABLE_QUICK_EDIT_MODE | windows.ENABLE_EXTENDED_FLAGS
	_ = windows.SetConsoleMode(stdIn, consoleMode)
}

func initGlobal() {
	go initAutoReloadCalcConf()
}

func initAutoReloadCalcConf() {
	ticker := time.NewTicker(time.Minute)
	for {
		latestScoreConf, err := buffApi.GetCurrConf()
		if err == nil && latestScoreConf != nil && latestScoreConf.Enabled {
			global.SetScoreConf(*latestScoreConf)
		}
		<-ticker.C
	}
}

func initApi() {
	buffApi.Init(global.Conf.BuffApi.Url, global.Conf.BuffApi.Timeout)
}
func initLib() {
	_ = os.Setenv("TZ", defaultTZ)
	now.WeekStartDay = time.Monday
	go func() {
		initUserInfo()
		if global.Conf.Sentry.Enabled {
			_ = initSentry(global.Conf.Sentry.Dsn)
		}
	}()
	ws.Init()
}

func initUserInfo() {
	resp, err := http.Get("https://api.ip.sb/ip")
	if err != nil {
		return
	}
	defer resp.Body.Close()
	bts, _ := io.ReadAll(resp.Body)
	global.SetUserInfo(global.UserInfo{
		IP: strings.Trim(string(bts), "\n"),
		// Mac:   windows.GetMac(),
		// CpuID: windows.GetCpuID(),
	})
}
func initSentry(dsn string) error {
	isDebugMode := global.IsDevMode()
	sampleRate := 1.0
	if !isDebugMode {
		sampleRate = 1.0
	}
	err := sentry.Init(sentry.ClientOptions{
		Dsn:         dsn,
		Debug:       isDebugMode,
		SampleRate:  sampleRate,
		Release:     hh_lol_prophet.Commit,
		Environment: global.GetEnv(),
	})
	if err == nil {
		global.Cleanups["sentryFlush"] = func() error {
			sentry.Flush(2 * time.Second)
			return nil
		}
		userInfo := global.GetUserInfo()
		sentry.ConfigureScope(func(scope *sentry.Scope) {
			scope.SetContext("buffgeDefault", map[string]interface{}{
				"ip":      userInfo.IP,
				"version": global.AppBuildInfo.Version,
				// "mac":   userInfo.Mac,
				// "cpuID": userInfo.CpuID,
			})
			scope.SetUser(sentry.User{
				// ID:        userInfo.Mac,
				IPAddress: userInfo.IP,
			})
			// scope.SetExtra("cpuID", userInfo.CpuID)
		})
	}
	return err
}

```

`cmd/hh-lol-prophet/main.go`:

```go
package main

import (
	"encoding/json"
	"flag"
	"fmt"
	"io"
	"log"
	"net/http"
	"os"
	"os/exec"
	"path/filepath"
	"time"

	"github.com/pkg/errors"

	app "github.com/real-web-world/hh-lol-prophet"
	"github.com/real-web-world/hh-lol-prophet/bootstrap"
	"github.com/real-web-world/hh-lol-prophet/global"
	"github.com/real-web-world/hh-lol-prophet/pkg/bdk"
)

const (
	procName    = "hh-lol-prophet.exe"
	procNewName = "hh-lol-prophet_new.exe"
	updateApi   = "https://lol.buffge.com/latestApp.json"
)

type (
	AppUpdateInfo struct {
		Version     string `json:"version"`
		DownloadUrl string `json:"downloadUrl"`
	}
)

var (
	showVersion   = flag.Bool("v", false, "å±•ç¤ºç‰ˆæœ¬ä¿¡æ¯")
	isUpdate      = flag.Bool("u", false, "æ˜¯å¦æ˜¯æ›´æ–°")
	delUpgradeBin = flag.Bool("delUpgradeBin", false, "æ˜¯å¦åˆ é™¤å‡çº§ç¨‹åº")
)

func flagInit() {
	flag.Parse()
	if *showVersion {
		log.Printf("å½“å‰ç‰ˆæœ¬:%s,commitID:%s,æ„å»ºæ—¶é—´:%v\n", app.APPVersion,
			app.Commit, app.BuildTime)
		os.Exit(0)
		return
	}
	if *isUpdate {
		err := selfUpdate()
		if err != nil {
			log.Println("selfUpdate failed,", err)
		}
		return
	} else {
		_ = mustRunWithMain()
	}
	if *delUpgradeBin {
		go func() {
			_ = removeUpgradeBinFile()
		}()
	}
}

func mustRunWithMain() error {
	binPath, err := os.Executable()
	if err != nil {
		return err
	}
	binFileName := filepath.Base(binPath)
	if binFileName == procNewName {
		os.Exit(-1)
	}
	return nil
}
func main() {
	flagInit()
	if err := checkUpdate(); err != nil {
		log.Println("æ£€æŸ¥æ›´æ–°å¤±è´¥,", err)
	}
	err := bootstrap.InitApp()
	defer global.Cleanup()
	if err != nil {
		panic(fmt.Sprintf("åˆå§‹åŒ–åº”ç”¨å¤±è´¥:%v\n", err))
	}
	prophet := app.NewProphet()
	if err = prophet.Run(); err != nil {
		log.Fatal(err)
	}
}
func removeUpgradeBinFile() error {
	binNewPath, err := os.Executable()
	if err != nil {
		return err
	}
	if filepath.Base(binNewPath) != procName {
		return errors.New("å½“å‰ä¸æ˜¯ä¸»è¿›ç¨‹ ç¦æ­¢æ‰§è¡Œ")
	}
	dirPath, err := filepath.Abs(filepath.Dir(binNewPath))
	if err != nil {
		return err
	}
	binNewFullPath := filepath.Join(dirPath, procNewName)
	return os.Remove(binNewFullPath)
}
func checkUpdate() error {
	var binNewFullPath string
	// get api
	resp, err := http.Get(updateApi)
	if err != nil {
		return err
	}
	defer resp.Body.Close()
	bts, _ := io.ReadAll(resp.Body)
	updateInfo := &AppUpdateInfo{}
	if json.Unmarshal(bts, updateInfo) != nil {
		return nil
	}
	if updateInfo.Version == "" || updateInfo.DownloadUrl == "" {
		return nil
	}
	if bdk.CompareVersion(updateInfo.Version, app.APPVersion) <= 0 {
		// log.Println("å·²æ˜¯æœ€æ–°æ— éœ€ä¸‹è½½")
		return nil
	}
	log.Println("æ£€æµ‹åˆ°æ›´æ–°,ä¸¤ç§’åå°†æ›´æ–°æˆ–æŒ‰å›è½¦ç«‹å³æ›´æ–°")
	updateTimeoutC := time.After(time.Second * 2)
	done := make(chan struct{})
	go func() {
		str := ""
		_, _ = fmt.Scanln(&str)
		done <- struct{}{}
	}()
	// download new.exe
	{
		resp, err = http.Get(updateInfo.DownloadUrl)
		if err != nil {
			log.Println("ä¸‹è½½æœ€æ–°äºŒè¿›åˆ¶å¤±è´¥")
			return err
		}
		defer resp.Body.Close()
		binNewPath, err := os.Executable()
		if err != nil {
			return err
		}
		dirPath, err := filepath.Abs(filepath.Dir(binNewPath))
		if err != nil {
			return err
		}
		binNewFullPath = filepath.Join(dirPath, procNewName)
		binNewFile, err := os.OpenFile(binNewFullPath, os.O_WRONLY|os.O_TRUNC|os.O_CREATE, 0664)
		if err != nil {
			return err
		}
		_, err = io.Copy(binNewFile, resp.Body)
		if err != nil {
			_ = binNewFile.Close()
			return errors.New("ä¸‹è½½æ›´æ–°æ–‡ä»¶å¤±è´¥")
		}
		_ = binNewFile.Close()
	}
	select {
	case <-done:
	case <-updateTimeoutC:
	}
	// è¾“å‡ºä¿¡æ¯ å³å°†æ›´æ–°
	// å¯åŠ¨ttt_new.exe
	{
		cmd := exec.Command("cmd.exe", "/C", "start", binNewFullPath, "-u", "true")
		if err := cmd.Run(); err != nil {
			log.Println("å¯åŠ¨æ›´æ–°è¿›ç¨‹å¤±è´¥:", err)
			return err
		}
		os.Exit(0)
	}
	return nil
}
func selfUpdate() error {
	binNewPath, err := os.Executable()
	if err != nil {
		return err
	}
	dirPath, err := filepath.Abs(filepath.Dir(binNewPath))
	if err != nil {
		return err
	}
	binNewFileName := filepath.Base(binNewPath)
	if binNewFileName != procNewName {
		return nil
	}
	binFullPath := filepath.Join(dirPath, procName)
	binNewFile, err := os.Open(binNewPath)
	if err != nil {
		defer binNewFile.Close()
	}
	if !bdk.IsFile(binFullPath) {
		return errors.New("äºŒè¿›åˆ¶æ–‡ä»¶ä¸å­˜åœ¨")
	}
	binFile, err := os.OpenFile(binFullPath, os.O_WRONLY|os.O_TRUNC, 0664)
	if err != nil {
		log.Println("äºŒè¿›åˆ¶æ–‡ä»¶è¢«å ç”¨æˆ–ä¸å­˜åœ¨")
		return err
	}
	_, err = io.Copy(binFile, binNewFile)
	if err != nil {
		log.Println("å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ æ›´æ–°å¤±è´¥")
		return err
	}
	_ = binFile.Close()
	cmd := exec.Command("cmd.exe", "/C", "start", binFullPath, "-delUpgradeBin", "true")
	if err = cmd.Run(); err != nil {
		log.Println("Error:", err)
		return err
	}
	os.Exit(0)
	return nil
}

```

`cmd/lcu-agent/main.go`:

```go
package main

import (
	"crypto/tls"
	"flag"
	"fmt"
	"io"
	"log"
	"net/http"
	"time"

	"github.com/real-web-world/hh-lol-prophet/services/lcu"
)

var (
	cli = http.Client{
		Transport: &http.Transport{
			ForceAttemptHTTP2: true,
			TLSClientConfig: &tls.Config{
				InsecureSkipVerify: true,
			},
		},
	}
)

const (
	apiUrlFmt = "https://riot:%s@127.0.0.1:%d"
)

var (
	portFlag = flag.Int("port", 8098, "lcu ä»£ç†ç«¯å£")
)

func main() {
	flag.Parse()
	port := *portFlag
	lcuPort, lcuToken, err := lcu.GetLolClientApiInfo()
	if err != nil {
		log.Fatal(err)
	}
	proxyURL := fmt.Sprintf(apiUrlFmt, lcuToken, lcuPort)
	go func() {
		ticker := time.NewTicker(time.Second * 3)
		for {
			<-ticker.C
			lcuPort, lcuToken, err := lcu.GetLolClientApiInfo()
			if err != nil {
				continue
			}
			updateProxyURL := fmt.Sprintf(apiUrlFmt, lcuToken, lcuPort)
			if updateProxyURL == proxyURL {
				continue
			}
			proxyURL = updateProxyURL
			log.Println("update lcu:", proxyURL)
		}
	}()
	log.Printf("listen on :%d, lcu api:%s\n", port, proxyURL)
	err = http.ListenAndServe(fmt.Sprintf(":%d", port), http.HandlerFunc(func(w http.ResponseWriter,
		r *http.Request) {
		req, _ := http.NewRequest(r.Method, proxyURL+r.URL.Path+"?"+r.URL.RawQuery, nil)
		req.Body = r.Body
		req.Header = r.Header
		resp, err := cli.Do(req)
		if err != nil {
			_, _ = fmt.Fprintf(w, "err : %v", err)
			return
		}
		w.Header().Set("Content-Length", resp.Header.Get("Content-Length"))
		w.Header().Set("Content-Type", resp.Header.Get("Content-Type"))
		_, _ = io.Copy(w, resp.Body)
		defer func() {
			_ = resp.Body.Close()
		}()
	}))
	if err != nil {
		log.Fatal(err)
	}
}

```

`conf/appConf.go`:

```go
package conf

import (
	"github.com/real-web-world/hh-lol-prophet/pkg/logger"
)

const (
	ModeDebug Mode = "debug"
	ModeProd  Mode = "prod"
)

type (
	Mode    = string
	AppConf struct {
		Mode      Mode          `json:"mode" default:"prod" env:"mode"`
		Sentry    SentryConf    `json:"sentry"`
		PProf     PProfConf     `json:"pprof"`
		Log       LogConf       `json:"log" required:"true"`
		BuffApi   BuffApi       `json:"buffApi" required:"true"`
		CalcScore CalcScoreConf `json:"calcScore" required:"true"`
	}
	SentryConf struct {
		Enabled bool   `json:"enabled" default:"false" env:"enableSentry"`
		Dsn     string `json:"dsn"`
	}
	PProfConf struct {
		Enable bool `default:"false" env:"enablePProf" json:"enable"`
	}
	LogConf struct {
		Level      logger.LogLevelStr `json:"level" default:"info" env:"logLevel"`
		Filepath   string             `required:"true" json:"filepath" env:"logFilepath"`
		MaxSize    int                `default:"1024" env:"logMaxSize"`
		MaxBackups int                `default:"7" env:"logMaxBackups"`
		MaxAge     int                `default:"7" env:"logMaxAge"`
		Compress   bool               `default:"true" env:"logCompress"`
	}
	BuffApi struct {
		Url     string `json:"url"`
		Timeout int    `json:"timeout"`
	}
	RateItemConf struct {
		Limit     float64      `json:"limit" required:"true"`     // >30%
		ScoreConf [][2]float64 `json:"scoreConf" required:"true"` // [ [æœ€ä½äººå¤´é™åˆ¶,åŠ åˆ†æ•°] ]
	}
	HorseScoreConf struct {
		Score float64 `json:"score,omitempty" required:"true"`
		Name  string  `json:"name" required:"true"`
	}
	CalcScoreConf struct {
		Enabled            bool              `json:"enabled" default:"false"`
		FirstBlood         [2]float64        `json:"firstBlood" required:"true"`         // [å‡»æ€+,åŠ©æ”»+]
		PentaKills         [1]float64        `json:"pentaKills" required:"true"`         // äº”æ€
		QuadraKills        [1]float64        `json:"quadraKills" required:"true"`        // å››æ€
		TripleKills        [1]float64        `json:"tripleKills" required:"true"`        // ä¸‰æ€
		JoinTeamRateRank   [4]float64        `json:"joinTeamRate" required:"true"`       // å‚å›¢ç‡æ’å
		GoldEarnedRank     [4]float64        `json:"goldEarned" required:"true"`         // æ‰“é’±æ’å
		HurtRank           [2]float64        `json:"hurtRank" required:"true"`           // ä¼¤å®³æ’å
		Money2hurtRateRank [2]float64        `json:"money2HurtRateRank" required:"true"` // é‡‘é’±è½¬æ¢ä¼¤å®³æ¯”æ’å
		VisionScoreRank    [2]float64        `json:"visionScoreRank" required:"true"`    // è§†é‡å¾—åˆ†æ’å
		MinionsKilled      [][2]float64      `json:"minionsKilled" required:"true"`      // è¡¥å…µ [ [è¡¥å…µæ•°,åŠ åˆ†æ•°] ]
		KillRate           []RateItemConf    `json:"killRate" required:"true"`           // äººå¤´å æ¯”
		HurtRate           []RateItemConf    `json:"hurtRate" required:"true"`           // ä¼¤å®³å æ¯”
		AssistRate         []RateItemConf    `json:"assistRate" required:"true"`         // åŠ©æ”»å æ¯”
		AdjustKDA          [2]float64        `json:"adjustKDA" required:"true"`          // kda
		Horse              [6]HorseScoreConf `json:"horse" required:"true"`
		MergeMsg           bool              `json:"mergeMsg"` // æ˜¯å¦åˆå¹¶æ¶ˆæ¯ä¸ºä¸€æ¡
	}
)

```

`conf/client.go`:

```go
package conf

import "github.com/pkg/errors"

const (
	SqliteDBPath = "prophet.db"
)

var (
	errBadConf = errors.New("é”™è¯¯çš„é…ç½®")
)

type (
	Client struct {
		AutoAcceptGame                 bool      `json:"autoAcceptGame"`                 // è‡ªåŠ¨æ¥å—
		AutoPickChampID                int       `json:"autoPickChampID"`                // è‡ªåŠ¨ç§’é€‰
		AutoBanChampID                 int       `json:"autoBanChampID"`                 // è‡ªåŠ¨banäºº
		AutoSendTeamHorse              bool      `json:"autoSendTeamHorse"`              // æ˜¯å¦è‡ªåŠ¨å‘é€æ¶ˆæ¯åˆ°é€‰äººç•Œé¢
		ShouldSendSelfHorse            bool      `json:"shouldSendSelfHorse"`            // æ˜¯å¦å‘é€è‡ªå·±é©¬åŒ¹ä¿¡æ¯
		HorseNameConf                  [6]string `json:"horseNameConf"`                  // é©¬åŒ¹åç§°é…ç½®
		ChooseSendHorseMsg             [6]bool   `json:"chooseSendHorseMsg"`             // é€‰æ‹©å‘é€å“ªäº›é©¬åŒ¹ä¿¡æ¯
		ChooseChampSendMsgDelaySec     int       `json:"chooseChampSendMsgDelaySec"`     // é€‰äººé˜¶æ®µå»¶è¿Ÿå‡ ç§’å‘é€
		ShouldInGameSaveMsgToClipBoard bool      `json:"shouldInGameSaveMsgToClipBoard"` // è¿›å…¥å¯¹å±€åä¿å­˜æ•Œæ–¹é©¬åŒ¹æ¶ˆæ¯åˆ°å‰ªåˆ‡æ¿ä¸­
		ShouldAutoOpenBrowser          *bool     `json:"shouldAutoOpenBrowser"`          // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
	}
	UpdateClientConfReq struct {
		AutoAcceptGame                 *bool      `json:"autoAcceptGame"`
		AutoPickChampID                *int       `json:"autoPickChampID"`
		AutoBanChampID                 *int       `json:"autoBanChampID"`
		AutoSendTeamHorse              *bool      `json:"autoSendTeamHorse"`
		ShouldSendSelfHorse            *bool      `json:"shouldSendSelfHorse"`
		HorseNameConf                  *[6]string `json:"horseNameConf"`
		ChooseSendHorseMsg             *[6]bool   `json:"chooseSendHorseMsg"`
		ChooseChampSendMsgDelaySec     *int       `json:"chooseChampSendMsgDelaySec"`
		ShouldInGameSaveMsgToClipBoard *bool      `json:"shouldInGameSaveMsgToClipBoard"`
		ShouldAutoOpenBrowser          *bool      `json:"shouldAutoOpenBrowser"`
	}
)

func ValidClientConf(cfg *Client) error {
	for _, s := range cfg.HorseNameConf {
		if s == "" {
			return errBadConf
		}
	}
	return nil
}

```

`global/global.go`:

```go
package global

import (
	"log"
	"sync"

	"go.uber.org/zap"
	"gorm.io/gorm"

	"github.com/real-web-world/hh-lol-prophet/conf"
	"github.com/real-web-world/hh-lol-prophet/pkg/logger"
)

type (
	AppInfo struct {
		Version   string
		Commit    string
		BuildUser string
		BuildTime string
	}
	UserInfo struct {
		IP string `json:"ip"`
	}
)

const (
	LogWriterCleanupKey   = "logWriter"
	sentryDsn             = "https://1c762696e30c4febbb6f8cbcf8835603@o1144230.ingest.sentry.io/6207862"
	buffApiUrl            = "https://lol.buffge.com"
	defaultLogPath        = "./logs/hh-lol-prophet.log"
	WebsiteTitle          = "lol.buffge.com"
	AdaptChatWebsiteTitle = "lol.buffgeç‚¹åº·å§†"
	AppName               = "lolå¯¹å±€å…ˆçŸ¥"
)

var (
	defaultShouldAutoOpenBrowserCfg = true
	DefaultClientConf               = conf.Client{
		AutoAcceptGame:                 false,
		AutoPickChampID:                0,
		AutoBanChampID:                 0,
		AutoSendTeamHorse:              true,
		ShouldSendSelfHorse:            true,
		HorseNameConf:                  [6]string{"é€šå¤©ä»£", "å°ä»£", "ä¸Šç­‰é©¬", "ä¸­ç­‰é©¬", "ä¸‹ç­‰é©¬", "ç‰›é©¬"},
		ChooseSendHorseMsg:             [6]bool{true, true, true, true, true, true},
		ChooseChampSendMsgDelaySec:     3,
		ShouldInGameSaveMsgToClipBoard: true,
		ShouldAutoOpenBrowser:          &defaultShouldAutoOpenBrowserCfg,
	}
	DefaultAppConf = conf.AppConf{
		Mode: conf.ModeProd,
		Sentry: conf.SentryConf{
			Enabled: true,
			Dsn:     sentryDsn,
		},
		PProf: conf.PProfConf{
			Enable: true,
		},
		Log: conf.LogConf{
			Level:    logger.LevelInfoStr,
			Filepath: defaultLogPath,
		},
		BuffApi: conf.BuffApi{
			Url:     buffApiUrl,
			Timeout: 3,
		},
		CalcScore: conf.CalcScoreConf{
			Enabled:            true,
			FirstBlood:         [2]float64{10, 5},
			PentaKills:         [1]float64{20},
			QuadraKills:        [1]float64{10},
			TripleKills:        [1]float64{5},
			JoinTeamRateRank:   [4]float64{10, 5, 5, 10},
			GoldEarnedRank:     [4]float64{10, 5, 5, 10},
			HurtRank:           [2]float64{10, 5},
			Money2hurtRateRank: [2]float64{10, 5},
			VisionScoreRank:    [2]float64{10, 5},
			MinionsKilled: [][2]float64{
				{10, 20},
				{9, 10},
				{8, 5},
			},
			KillRate: []conf.RateItemConf{
				{Limit: 50, ScoreConf: [][2]float64{
					{15, 40},
					{10, 20},
					{5, 10},
				}},
				{Limit: 40, ScoreConf: [][2]float64{
					{15, 20},
					{10, 10},
					{5, 5},
				}},
			},
			HurtRate: []conf.RateItemConf{
				{Limit: 40, ScoreConf: [][2]float64{
					{15, 40},
					{10, 20},
					{5, 10},
				}},
				{Limit: 30, ScoreConf: [][2]float64{
					{15, 20},
					{10, 10},
					{5, 5},
				}},
			},
			AssistRate: []conf.RateItemConf{
				{Limit: 50, ScoreConf: [][2]float64{
					{20, 30},
					{18, 25},
					{15, 20},
					{10, 10},
					{5, 5},
				}},
				{Limit: 40, ScoreConf: [][2]float64{
					{20, 15},
					{15, 10},
					{10, 5},
					{5, 3},
				}},
			},
			AdjustKDA: [2]float64{2, 5},
			Horse: [6]conf.HorseScoreConf{
				{Score: 180, Name: "é€šå¤©ä»£"},
				{Score: 150, Name: "å°ä»£"},
				{Score: 125, Name: "ä¸Šç­‰é©¬"},
				{Score: 105, Name: "ä¸­ç­‰é©¬"},
				{Score: 95, Name: "ä¸‹ç­‰é©¬"},
				{Score: 0.0001, Name: "ç‰›é©¬"},
			},
			MergeMsg: false,
		},
	}
	userInfo     = UserInfo{}
	confMu       = sync.Mutex{}
	Conf         = new(conf.AppConf)
	ClientConf   = new(conf.Client)
	Logger       *zap.SugaredLogger
	Cleanups     = make(map[string]func() error)
	AppBuildInfo = AppInfo{}
)

// DB
var (
	SqliteDB *gorm.DB
)

func SetUserInfo(info UserInfo) {
	userInfo = info
}
func GetUserInfo() UserInfo {
	return userInfo
}
func Cleanup() {
	for name, cleanup := range Cleanups {
		if err := cleanup(); err != nil {
			log.Printf("%s cleanup err:%v\n", name, err)
		}
	}
	if fn, ok := Cleanups[LogWriterCleanupKey]; ok {
		_ = fn()
	}
}
func IsDevMode() bool {
	return GetEnv() == conf.ModeDebug
}
func GetEnv() conf.Mode {
	return Conf.Mode
}
func GetScoreConf() conf.CalcScoreConf {
	confMu.Lock()
	defer confMu.Unlock()
	return Conf.CalcScore
}
func SetScoreConf(scoreConf conf.CalcScoreConf) {
	confMu.Lock()
	Conf.CalcScore = scoreConf
	confMu.Unlock()
	return
}
func GetClientConf() conf.Client {
	confMu.Lock()
	defer confMu.Unlock()
	data := *ClientConf
	return data
}
func SetClientConf(cfg conf.UpdateClientConfReq) *conf.Client {
	confMu.Lock()
	defer confMu.Unlock()
	if cfg.AutoAcceptGame != nil {
		ClientConf.AutoAcceptGame = *cfg.AutoAcceptGame
	}
	if cfg.AutoPickChampID != nil {
		ClientConf.AutoPickChampID = *cfg.AutoPickChampID
	}
	if cfg.AutoBanChampID != nil {
		ClientConf.AutoBanChampID = *cfg.AutoBanChampID
	}
	if cfg.AutoSendTeamHorse != nil {
		ClientConf.AutoSendTeamHorse = *cfg.AutoSendTeamHorse
	}
	if cfg.ShouldSendSelfHorse != nil {
		ClientConf.ShouldSendSelfHorse = *cfg.ShouldSendSelfHorse
	}
	if cfg.HorseNameConf != nil {
		ClientConf.HorseNameConf = *cfg.HorseNameConf
	}
	if cfg.ChooseSendHorseMsg != nil {
		ClientConf.ChooseSendHorseMsg = *cfg.ChooseSendHorseMsg
	}
	if cfg.ChooseChampSendMsgDelaySec != nil {
		ClientConf.ChooseChampSendMsgDelaySec = *cfg.ChooseChampSendMsgDelaySec
	}
	if cfg.ShouldInGameSaveMsgToClipBoard != nil {
		ClientConf.ShouldInGameSaveMsgToClipBoard = *cfg.ShouldInGameSaveMsgToClipBoard
	}
	if cfg.ShouldAutoOpenBrowser != nil {
		ClientConf.ShouldAutoOpenBrowser = cfg.ShouldAutoOpenBrowser
	}
	return ClientConf
}
func SetAppInfo(info AppInfo) {
	AppBuildInfo = info
}

```

`go.mod`:

```mod
module github.com/real-web-world/hh-lol-prophet

go 1.17

require (
	github.com/atotto/clipboard v0.1.4
	github.com/avast/retry-go v3.0.0+incompatible
	github.com/getsentry/sentry-go v0.12.0
	github.com/gin-contrib/cors v1.3.1
	github.com/gin-contrib/pprof v1.3.0
	github.com/gin-gonic/gin v1.7.7
	github.com/go-playground/validator/v10 v10.10.0
	github.com/gorilla/websocket v1.5.0
	github.com/jinzhu/configor v1.2.1
	github.com/jinzhu/now v1.1.4
	github.com/joho/godotenv v1.4.0
	github.com/pkg/errors v0.9.1
	go.uber.org/zap v1.21.0
	golang.org/x/sync v0.0.0-20210220032951-036812b2e83c
	golang.org/x/sys v0.0.0-20220209214540-3681064d5158
	golang.org/x/time v0.0.0-20220210224613-90d013bbcef8
	gopkg.in/natefinch/lumberjack.v2 v2.0.0
	gorm.io/driver/sqlite v1.3.1
	gorm.io/gorm v1.23.1
)

require (
	github.com/BurntSushi/toml v1.0.0 // indirect
	github.com/gin-contrib/sse v0.1.0 // indirect
	github.com/go-playground/locales v0.14.0 // indirect
	github.com/go-playground/universal-translator v0.18.0 // indirect
	github.com/golang/protobuf v1.5.2 // indirect
	github.com/jinzhu/inflection v1.0.0 // indirect
	github.com/json-iterator/go v1.1.12 // indirect
	github.com/leodido/go-urn v1.2.1 // indirect
	github.com/mattn/go-isatty v0.0.14 // indirect
	github.com/mattn/go-sqlite3 v1.14.9 // indirect
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/modern-go/reflect2 v1.0.2 // indirect
	github.com/ugorji/go/codec v1.2.6 // indirect
	go.uber.org/atomic v1.9.0 // indirect
	go.uber.org/multierr v1.7.0 // indirect
	golang.org/x/crypto v0.0.0-20220214200702-86341886e292 // indirect
	golang.org/x/text v0.3.7 // indirect
	google.golang.org/protobuf v1.27.1 // indirect
	gopkg.in/yaml.v2 v2.4.0 // indirect
)

```

`go.sum`:

```sum
github.com/AndreasBriese/bbloom v0.0.0-20190306092124-e2d15f34fcf9/go.mod h1:bOvUY6CB00SOBii9/FifXqc0awNKxLFCL/+pkDPuyl8=
github.com/BurntSushi/toml v0.3.1/go.mod h1:xHWCNGjB5oqiDr8zfno3MHue2Ht5sIBksp03qcyfWMU=
github.com/BurntSushi/toml v1.0.0 h1:dtDWrepsVPfW9H/4y7dDgFc2MBUSeJhlaDtK13CxFlU=
github.com/BurntSushi/toml v1.0.0/go.mod h1:CxXYINrC8qIiEnFrOxCa7Jy5BFHlXnUU2pbicEuybxQ=
github.com/CloudyKit/fastprinter v0.0.0-20200109182630-33d98a066a53/go.mod h1:+3IMCy2vIlbG1XG/0ggNQv0SvxCAIpPM5b1nCz56Xno=
github.com/CloudyKit/jet/v3 v3.0.0/go.mod h1:HKQPgSJmdK8hdoAbKUUWajkHyHo4RaU5rMdUywE7VMo=
github.com/Joker/hpp v1.0.0/go.mod h1:8x5n+M1Hp5hC0g8okX3sR3vFQwynaX/UgSOM9MeBKzY=
github.com/Shopify/goreferrer v0.0.0-20181106222321-ec9c9a553398/go.mod h1:a1uqRtAwp2Xwc6WNPJEufxJ7fx3npB4UV/JOLmbu5I0=
github.com/ajg/form v1.5.1/go.mod h1:uL1WgH+h2mgNtvBq0339dVnzXdBETtL2LeUXaIv25UY=
github.com/armon/consul-api v0.0.0-20180202201655-eb2c6b5be1b6/go.mod h1:grANhF5doyWs3UAsr3K4I6qtAmlQcZDesFNEHPZAzj8=
github.com/atotto/clipboard v0.1.4 h1:EH0zSVneZPSuFR11BlR9YppQTVDbh5+16AmcJi4g1z4=
github.com/atotto/clipboard v0.1.4/go.mod h1:ZY9tmq7sm5xIbd9bOK4onWV4S6X0u6GY7Vn0Yu86PYI=
github.com/avast/retry-go v3.0.0+incompatible h1:4SOWQ7Qs+oroOTQOYnAHqelpCO0biHSxpiH9JdtuBj0=
github.com/avast/retry-go v3.0.0+incompatible/go.mod h1:XtSnn+n/sHqQIpZ10K1qAevBhOOCWBLXXy3hyiqqBrY=
github.com/aymerick/raymond v2.0.3-0.20180322193309-b565731e1464+incompatible/go.mod h1:osfaiScAUVup+UC9Nfq76eWqDhXlp+4UYaA8uhTBO6g=
github.com/benbjohnson/clock v1.1.0 h1:Q92kusRqC1XV2MjkWETPvjJVqKetz1OzxZB7mHJLju8=
github.com/benbjohnson/clock v1.1.0/go.mod h1:J11/hYXuz8f4ySSvYwY0FKfm+ezbsZBKZxNJlLklBHA=
github.com/codegangsta/inject v0.0.0-20150114235600-33e0aa1cb7c0/go.mod h1:4Zcjuz89kmFXt9morQgcfYZAYZ5n8WHjt81YYWIwtTM=
github.com/coreos/etcd v3.3.10+incompatible/go.mod h1:uF7uidLiAD3TWHmW31ZFd/JWoc32PjwdhPthX9715RE=
github.com/coreos/go-etcd v2.0.0+incompatible/go.mod h1:Jez6KQU2B/sWsbdaef3ED8NzMklzPG4d5KIOhIy30Tk=
github.com/coreos/go-semver v0.2.0/go.mod h1:nnelYz7RCh+5ahJtPPxZlU+153eP4D4r3EedlOD2RNk=
github.com/cpuguy83/go-md2man v1.0.10/go.mod h1:SmD6nW6nTyfqj6ABTjUi3V3JVMnlJmwcJI5acqYI6dE=
github.com/creack/pty v1.1.9/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
github.com/davecgh/go-spew v1.1.1 h1:vj9j/u1bqnvCEfJOwUhtlOARqs3+rkHYY13jYWTU97c=
github.com/davecgh/go-spew v1.1.1/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
github.com/dgraph-io/badger v1.6.0/go.mod h1:zwt7syl517jmP8s94KqSxTlM6IMsdhYy6psNgSztDR4=
github.com/dgryski/go-farm v0.0.0-20190423205320-6a90982ecee2/go.mod h1:SqUrOPUnsFjfmXRMNPybcSiG0BgUW2AuFH8PAnS2iTw=
github.com/dustin/go-humanize v1.0.0/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=
github.com/eknkc/amber v0.0.0-20171010120322-cdade1c07385/go.mod h1:0vRUJqYpeSZifjYj7uP3BG/gKcuzL9xWVV/Y+cK33KM=
github.com/etcd-io/bbolt v1.3.3/go.mod h1:ZF2nL25h33cCyBtcyWeZ2/I3HQOfTP+0PIEvHjkjCrw=
github.com/fasthttp-contrib/websocket v0.0.0-20160511215533-1f3b11f56072/go.mod h1:duJ4Jxv5lDcvg4QuQr0oowTf7dz4/CR8NtyCooz9HL8=
github.com/fatih/structs v1.1.0/go.mod h1:9NiDSp5zOcgEDl+j00MP/WkGVPOlPRLejGD8Ga6PJ7M=
github.com/fsnotify/fsnotify v1.4.7/go.mod h1:jwhsz4b93w/PPRr/qN1Yymfu8t87LnFCMoQvtojpjFo=
github.com/gavv/httpexpect v2.0.0+incompatible/go.mod h1:x+9tiU1YnrOvnB725RkpoLv1M62hOWzwo5OXotisrKc=
github.com/getsentry/sentry-go v0.12.0 h1:era7g0re5iY13bHSdN/xMkyV+5zZppjRVQhZrXCaEIk=
github.com/getsentry/sentry-go v0.12.0/go.mod h1:NSap0JBYWzHND8oMbyi0+XZhUalc1TBdRL1M71JZW2c=
github.com/gin-contrib/cors v1.3.1 h1:doAsuITavI4IOcd0Y19U4B+O0dNWihRyX//nn4sEmgA=
github.com/gin-contrib/cors v1.3.1/go.mod h1:jjEJ4268OPZUcU7k9Pm653S7lXUGcqMADzFA61xsmDk=
github.com/gin-contrib/pprof v1.3.0 h1:G9eK6HnbkSqDZBYbzG4wrjCsA4e+cvYAHUZw6W+W9K0=
github.com/gin-contrib/pprof v1.3.0/go.mod h1:waMjT1H9b179t3CxuG1cV3DHpga6ybizwfBaM5OXaB0=
github.com/gin-contrib/sse v0.0.0-20190301062529-5545eab6dad3/go.mod h1:VJ0WA2NBN22VlZ2dKZQPAPnyWw5XTlK1KymzLKsr59s=
github.com/gin-contrib/sse v0.1.0 h1:Y/yl/+YNO8GZSjAhjMsSuLt29uWRFHdHYUb5lYOV9qE=
github.com/gin-contrib/sse v0.1.0/go.mod h1:RHrZQHXnP2xjPF+u1gW/2HnVO7nvIa9PG3Gm+fLHvGI=
github.com/gin-gonic/gin v1.4.0/go.mod h1:OW2EZn3DO8Ln9oIKOvM++LBO+5UPHJJDH72/q/3rZdM=
github.com/gin-gonic/gin v1.5.0/go.mod h1:Nd6IXA8m5kNZdNEHMBd93KT+mdY3+bewLgRvmCsR2Do=
github.com/gin-gonic/gin v1.6.2/go.mod h1:75u5sXoLsGZoRN5Sgbi1eraJ4GU3++wFwWzhwvtwp4M=
github.com/gin-gonic/gin v1.7.7 h1:3DoBmSbJbZAWqXJC3SLjAPfutPJJRN1U5pALB7EeTTs=
github.com/gin-gonic/gin v1.7.7/go.mod h1:axIBovoeJpVj8S3BwE0uPMTeReE4+AfFtqpqaZ1qq1U=
github.com/go-check/check v0.0.0-20180628173108-788fd7840127/go.mod h1:9ES+weclKsC9YodN5RgxqK/VD9HM9JsCSh7rNhMZE98=
github.com/go-errors/errors v1.0.1 h1:LUHzmkK3GUKUrL/1gfBUxAHzcev3apQlezX/+O7ma6w=
github.com/go-errors/errors v1.0.1/go.mod h1:f4zRHt4oKfwPJE5k8C9vpYG+aDHdBFUsgrm6/TyX73Q=
github.com/go-martini/martini v0.0.0-20170121215854-22fa46961aab/go.mod h1:/P9AEU963A2AYjv4d1V5eVL1CQbEJq6aCNHDDjibzu8=
github.com/go-playground/assert/v2 v2.0.1 h1:MsBgLAaY856+nPRTKrp3/OZK38U/wa0CcBYNjji3q3A=
github.com/go-playground/assert/v2 v2.0.1/go.mod h1:VDjEfimB/XKnb+ZQfWdccd7VUvScMdVu0Titje2rxJ4=
github.com/go-playground/locales v0.12.1/go.mod h1:IUMDtCfWo/w/mtMfIE/IG2K+Ey3ygWanZIBtBW0W2TM=
github.com/go-playground/locales v0.13.0/go.mod h1:taPMhCMXrRLJO55olJkUXHZBHCxTMfnGwq/HNwmWNS8=
github.com/go-playground/locales v0.14.0 h1:u50s323jtVGugKlcYeyzC0etD1HifMjqmJqb8WugfUU=
github.com/go-playground/locales v0.14.0/go.mod h1:sawfccIbzZTqEDETgFXqTho0QybSa7l++s0DH+LDiLs=
github.com/go-playground/universal-translator v0.16.0/go.mod h1:1AnU7NaIRDWWzGEKwgtJRd2xk99HeFyHw3yid4rvQIY=
github.com/go-playground/universal-translator v0.17.0/go.mod h1:UkSxE5sNxxRwHyU+Scu5vgOQjsIJAF8j9muTVoKLVtA=
github.com/go-playground/universal-translator v0.18.0 h1:82dyy6p4OuJq4/CByFNOn/jYrnRPArHwAcmLoJZxyho=
github.com/go-playground/universal-translator v0.18.0/go.mod h1:UvRDBj+xPUEGrFYl+lu/H90nyDXpg0fqeB/AQUGNTVA=
github.com/go-playground/validator/v10 v10.2.0/go.mod h1:uOYAAleCW8F/7oMFd6aG0GOhaH6EGOAJShg8Id5JGkI=
github.com/go-playground/validator/v10 v10.4.1/go.mod h1:nlOn6nFhuKACm19sB/8EGNn9GlaMV7XkbRSipzJ0Ii4=
github.com/go-playground/validator/v10 v10.10.0 h1:I7mrTYv78z8k8VXa/qJlOlEXn/nBh+BF8dHX5nt/dr0=
github.com/go-playground/validator/v10 v10.10.0/go.mod h1:74x4gJWsvQexRdW8Pn3dXSGrTK4nAUsbPlLADvpJkos=
github.com/gobwas/httphead v0.0.0-20180130184737-2c6c146eadee/go.mod h1:L0fX3K22YWvt/FAX9NnzrNzcI4wNYi9Yku4O0LKYflo=
github.com/gobwas/pool v0.2.0/go.mod h1:q8bcK0KcYlCgd9e7WYLm9LpyS+YeLd8JVDW6WezmKEw=
github.com/gobwas/ws v1.0.2/go.mod h1:szmBTxLgaFppYjEmNtny/v3w89xOydFnnZMcgRRu/EM=
github.com/golang-jwt/jwt v3.2.2+incompatible/go.mod h1:8pz2t5EyA70fFQQSrl6XZXzqecmYZeUEB8OUGHkxJ+I=
github.com/golang/protobuf v1.2.0/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.1/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.2/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.3/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=
github.com/golang/protobuf v1.5.0/go.mod h1:FsONVRAS9T7sI+LIUmWTfcYkHO4aIWwzhcaSAoJOfIk=
github.com/golang/protobuf v1.5.2 h1:ROPKBNFfQgOUMifHyP+KYbvpjbdoFNs+aK7DXlji0Tw=
github.com/golang/protobuf v1.5.2/go.mod h1:XVQd3VNwM+JqD3oG2Ue2ip4fOMUkwXdXDdiuN0vRsmY=
github.com/gomodule/redigo v1.7.1-0.20190724094224-574c33c3df38/go.mod h1:B4C85qUVwatsJoIUNIfCRsp7qO0iAmpGFZ4EELWSbC4=
github.com/google/go-cmp v0.5.5 h1:Khx7svrCpmxxtHBq5j2mp/xVjsi8hQMfNLvJFAlrGgU=
github.com/google/go-cmp v0.5.5/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
github.com/google/go-querystring v1.0.0/go.mod h1:odCYkC5MyYFN7vkCjXpyrEuKhc/BUO6wN/zVPAxq5ck=
github.com/google/gofuzz v1.0.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
github.com/gopherjs/gopherjs v0.0.0-20181017120253-0766667cb4d1/go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY=
github.com/gorilla/websocket v1.4.1/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/gorilla/websocket v1.5.0 h1:PPwGk2jz7EePpoHN/+ClbZu8SPxiqlu12wZP/3sWmnc=
github.com/gorilla/websocket v1.5.0/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/hashicorp/go-version v1.2.0/go.mod h1:fltr4n8CU8Ke44wwGCBoEymUuxUHl09ZGVZPK5anwXA=
github.com/hashicorp/hcl v1.0.0/go.mod h1:E5yfLk+7swimpb2L/Alb/PJmXilQ/rhwaUYs4T20WEQ=
github.com/hpcloud/tail v1.0.0/go.mod h1:ab1qPbhIpdTxEkNHXyeSf5vhxWSCs/tWer42PpOxQnU=
github.com/imkira/go-interpol v1.1.0/go.mod h1:z0h2/2T3XF8kyEPpRgJ3kmNv+C43p+I/CoI+jC3w2iA=
github.com/inconshreveable/mousetrap v1.0.0/go.mod h1:PxqpIevigyE2G7u3NXJIT2ANytuPF1OarO4DADm73n8=
github.com/iris-contrib/blackfriday v2.0.0+incompatible/go.mod h1:UzZ2bDEoaSGPbkg6SAB4att1aAwTmVIx/5gCVqeyUdI=
github.com/iris-contrib/go.uuid v2.0.0+incompatible/go.mod h1:iz2lgM/1UnEf1kP0L/+fafWORmlnuysV2EMP8MW+qe0=
github.com/iris-contrib/jade v1.1.3/go.mod h1:H/geBymxJhShH5kecoiOCSssPX7QWYH7UaeZTSWddIk=
github.com/iris-contrib/pongo2 v0.0.1/go.mod h1:Ssh+00+3GAZqSQb30AvBRNxBx7rf0GqwkjqxNd0u65g=
github.com/iris-contrib/schema v0.0.1/go.mod h1:urYA3uvUNG1TIIjOSCzHr9/LmbQo8LrOcOqfqxa4hXw=
github.com/jinzhu/configor v1.2.1 h1:OKk9dsR8i6HPOCZR8BcMtcEImAFjIhbJFZNyn5GCZko=
github.com/jinzhu/configor v1.2.1/go.mod h1:nX89/MOmDba7ZX7GCyU/VIaQ2Ar2aizBl2d3JLF/rDc=
github.com/jinzhu/inflection v1.0.0 h1:K317FqzuhWc8YvSVlFMCCUb36O/S9MCKRDI7QkRKD/E=
github.com/jinzhu/inflection v1.0.0/go.mod h1:h+uFLlag+Qp1Va5pdKtLDYj+kHp5pxUVkryuEj+Srlc=
github.com/jinzhu/now v1.1.4 h1:tHnRBy1i5F2Dh8BAFxqFzxKqqvezXrL2OW1TnX+Mlas=
github.com/jinzhu/now v1.1.4/go.mod h1:d3SSVoowX0Lcu0IBviAWJpolVfI5UJVZZ7cO71lE/z8=
github.com/joho/godotenv v1.4.0 h1:3l4+N6zfMWnkbPEXKng2o2/MR5mSwTrBih4ZEkkz1lg=
github.com/joho/godotenv v1.4.0/go.mod h1:f4LDr5Voq0i2e/R5DDNOoa2zzDfwtkZa6DnEwAbqwq4=
github.com/json-iterator/go v1.1.6/go.mod h1:+SdeFBvtyEkXs7REEP0seUULqWtbJapLOCVDaaPEHmU=
github.com/json-iterator/go v1.1.7/go.mod h1:KdQUCv79m/52Kvf8AW2vK1V8akMuk1QjK/uOdHXbAo4=
github.com/json-iterator/go v1.1.9/go.mod h1:KdQUCv79m/52Kvf8AW2vK1V8akMuk1QjK/uOdHXbAo4=
github.com/json-iterator/go v1.1.12 h1:PV8peI4a0ysnczrg+LtxykD8LfKY9ML6u2jnxaEnrnM=
github.com/json-iterator/go v1.1.12/go.mod h1:e30LSqwooZae/UwlEbR2852Gd8hjQvJoHmT4TnhNGBo=
github.com/jtolds/gls v4.20.0+incompatible/go.mod h1:QJZ7F/aHp+rZTRtaJ1ow/lLfFfVYBRgL+9YlvaHOwJU=
github.com/k0kubun/colorstring v0.0.0-20150214042306-9440f1994b88/go.mod h1:3w7q1U84EfirKl04SVQ/s7nPm1ZPhiXd34z40TNz36k=
github.com/kataras/golog v0.0.10/go.mod h1:yJ8YKCmyL+nWjERB90Qwn+bdyBZsaQwU3bTVFgkFIp8=
github.com/kataras/iris/v12 v12.1.8/go.mod h1:LMYy4VlP67TQ3Zgriz8RE2h2kMZV2SgMYbq3UhfoFmE=
github.com/kataras/neffos v0.0.14/go.mod h1:8lqADm8PnbeFfL7CLXh1WHw53dG27MC3pgi2R1rmoTE=
github.com/kataras/pio v0.0.2/go.mod h1:hAoW0t9UmXi4R5Oyq5Z4irTbaTsOemSrDGUtaTl7Dro=
github.com/kataras/sitemap v0.0.5/go.mod h1:KY2eugMKiPwsJgx7+U103YZehfvNGOXURubcGyk0Bz8=
github.com/klauspost/compress v1.8.2/go.mod h1:RyIbtBH6LamlWaDj8nUwkbUhJ87Yi3uG0guNDohfE1A=
github.com/klauspost/compress v1.9.7/go.mod h1:RyIbtBH6LamlWaDj8nUwkbUhJ87Yi3uG0guNDohfE1A=
github.com/klauspost/cpuid v1.2.1/go.mod h1:Pj4uuM528wm8OyEC2QMXAi2YiTZ96dNQPGgoMS4s3ek=
github.com/kr/pretty v0.1.0/go.mod h1:dAy3ld7l9f0ibDNOQOHHMYYIIbhfbHSm3C4ZsoJORNo=
github.com/kr/pretty v0.2.1/go.mod h1:ipq/a2n7PKx3OHsz4KJII5eveXtPO4qwEXGdVfWzfnI=
github.com/kr/pretty v0.3.0 h1:WgNl7dwNpEZ6jJ9k1snq4pZsg7DOEN8hP9Xw0Tsjwk0=
github.com/kr/pretty v0.3.0/go.mod h1:640gp4NfQd8pI5XOwp5fnNeVWj67G7CFk/SaSQn7NBk=
github.com/kr/pty v1.1.1/go.mod h1:pFQYn66WHrOpPYNljwOMqo10TkYh1fy3cYio2l3bCsQ=
github.com/kr/text v0.1.0/go.mod h1:4Jbv+DJW3UT/LiOwJeYQe1efqtUx/iVham/4vfdArNI=
github.com/kr/text v0.2.0 h1:5Nx0Ya0ZqY2ygV366QzturHI13Jq95ApcVaJBhpS+AY=
github.com/kr/text v0.2.0/go.mod h1:eLer722TekiGuMkidMxC/pM04lWEeraHUUmBw8l2grE=
github.com/labstack/echo/v4 v4.5.0/go.mod h1:czIriw4a0C1dFun+ObrXp7ok03xON0N1awStJ6ArI7Y=
github.com/labstack/gommon v0.3.0/go.mod h1:MULnywXg0yavhxWKc+lOruYdAhDwPK9wf0OL7NoOu+k=
github.com/leodido/go-urn v1.1.0/go.mod h1:+cyI34gQWZcE1eQU7NVgKkkzdXDQHr1dBMtdAPozLkw=
github.com/leodido/go-urn v1.2.0/go.mod h1:+8+nEpDfqqsY+g338gtMEUOtuK+4dEMhiQEgxpxOKII=
github.com/leodido/go-urn v1.2.1 h1:BqpAaACuzVSgi/VLzGZIobT2z4v53pjosyNd9Yv6n/w=
github.com/leodido/go-urn v1.2.1/go.mod h1:zt4jvISO2HfUBqxjfIshjdMTYS56ZS/qv49ictyFfxY=
github.com/magiconair/properties v1.8.0/go.mod h1:PppfXfuXeibc/6YijjN8zIbojt8czPbwD3XqdrwzmxQ=
github.com/mattn/go-colorable v0.1.2/go.mod h1:U0ppj6V5qS13XJ6of8GYAs25YV2eR4EVcfRqFIhoBtE=
github.com/mattn/go-colorable v0.1.8/go.mod h1:u6P/XSegPjTcexA+o6vUJrdnUu04hMope9wVRipJSqc=
github.com/mattn/go-colorable v0.1.11/go.mod h1:u5H1YNBxpqRaxsYJYSkiCWKzEfiAb1Gb520KVy5xxl4=
github.com/mattn/go-isatty v0.0.7/go.mod h1:Iq45c/XA43vh69/j3iqttzPXn0bhXyGjM0Hdxcsrc5s=
github.com/mattn/go-isatty v0.0.8/go.mod h1:Iq45c/XA43vh69/j3iqttzPXn0bhXyGjM0Hdxcsrc5s=
github.com/mattn/go-isatty v0.0.9/go.mod h1:YNRxwqDuOph6SZLI9vUUz6OYw3QyUt7WiY2yME+cCiQ=
github.com/mattn/go-isatty v0.0.12/go.mod h1:cbi8OIDigv2wuxKPP5vlRcQ1OAZbq2CE4Kysco4FUpU=
github.com/mattn/go-isatty v0.0.14 h1:yVuAays6BHfxijgZPzw+3Zlu5yQgKGP2/hcQbHb7S9Y=
github.com/mattn/go-isatty v0.0.14/go.mod h1:7GGIvUiUoEMVVmxf/4nioHXj79iQHKdU27kJ6hsGG94=
github.com/mattn/go-sqlite3 v1.14.9 h1:10HX2Td0ocZpYEjhilsuo6WWtUqttj2Kb0KtD86/KYA=
github.com/mattn/go-sqlite3 v1.14.9/go.mod h1:NyWgC/yNuGj7Q9rpYnZvas74GogHl5/Z4A/KQRfk6bU=
github.com/mattn/goveralls v0.0.2/go.mod h1:8d1ZMHsd7fW6IRPKQh46F2WRpyib5/X4FOpevwGNQEw=
github.com/mediocregopher/radix/v3 v3.4.2/go.mod h1:8FL3F6UQRXHXIBSPUs5h0RybMF8i4n7wVopoX3x7Bv8=
github.com/microcosm-cc/bluemonday v1.0.2/go.mod h1:iVP4YcDBq+n/5fb23BhYFvIMq/leAFZyRl6bYmGDlGc=
github.com/mitchellh/go-homedir v1.1.0/go.mod h1:SfyaCUpYCn1Vlf4IUYiD9fPX4A5wJrkLzIz1N1q0pr0=
github.com/mitchellh/mapstructure v1.1.2/go.mod h1:FVVH3fgwuzCH5S8UJGiWEs2h04kUh9fWfEaFds41c1Y=
github.com/modern-go/concurrent v0.0.0-20180228061459-e0a39a4cb421/go.mod h1:6dJC0mAP4ikYIbvyc7fijjWJddQyLn8Ig3JB5CqoB9Q=
github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd h1:TRLaZ9cD/w8PVh93nsPXa1VrQ6jlwL5oN8l14QlcNfg=
github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd/go.mod h1:6dJC0mAP4ikYIbvyc7fijjWJddQyLn8Ig3JB5CqoB9Q=
github.com/modern-go/reflect2 v0.0.0-20180701023420-4b7aa43c6742/go.mod h1:bx2lNnkwVCuqBIxFjflWJWanXIb3RllmbCylyMrvgv0=
github.com/modern-go/reflect2 v1.0.1/go.mod h1:bx2lNnkwVCuqBIxFjflWJWanXIb3RllmbCylyMrvgv0=
github.com/modern-go/reflect2 v1.0.2 h1:xBagoLtFs94CBntxluKeaWgTMpvLxC4ur3nMaC9Gz0M=
github.com/modern-go/reflect2 v1.0.2/go.mod h1:yWuevngMOJpCy52FWWMvUC8ws7m/LJsjYzDa0/r8luk=
github.com/moul/http2curl v1.0.0/go.mod h1:8UbvGypXm98wA/IqH45anm5Y2Z6ep6O31QGOAZ3H0fQ=
github.com/nats-io/jwt v0.3.0/go.mod h1:fRYCDE99xlTsqUzISS1Bi75UBJ6ljOJQOAAu5VglpSg=
github.com/nats-io/nats.go v1.9.1/go.mod h1:ZjDU1L/7fJ09jvUSRVBR2e7+RnLiiIQyqyzEE/Zbp4w=
github.com/nats-io/nkeys v0.1.0/go.mod h1:xpnFELMwJABBLVhffcfd1MZx6VsNRFpEugbxziKVo7w=
github.com/nats-io/nuid v1.0.1/go.mod h1:19wcPz3Ph3q0Jbyiqsd0kePYG7A95tJPxeL+1OSON2c=
github.com/onsi/ginkgo v1.6.0/go.mod h1:lLunBs/Ym6LB5Z9jYTR76FiuTmxDTDusOGeTQH+WWjE=
github.com/onsi/ginkgo v1.10.3/go.mod h1:lLunBs/Ym6LB5Z9jYTR76FiuTmxDTDusOGeTQH+WWjE=
github.com/onsi/gomega v1.7.1/go.mod h1:XdKZgCCFLUoM/7CFJVPcG8C1xQ1AJ0vpAezJrB7JYyY=
github.com/pelletier/go-toml v1.2.0/go.mod h1:5z9KED0ma1S8pY6P1sdut58dfprrGBbd/94hg7ilaic=
github.com/pingcap/errors v0.11.4 h1:lFuQV/oaUMGcD2tqt+01ROSmJs75VG1ToEOkZIZ4nE4=
github.com/pingcap/errors v0.11.4/go.mod h1:Oi8TUi2kEtXXLMJk9l1cGmz20kV3TaQ0usTwv5KuLY8=
github.com/pkg/diff v0.0.0-20210226163009-20ebb0f2a09e/go.mod h1:pJLUxLENpZxwdsKMEsNbx1VGcRFpLqf3715MtcvvzbA=
github.com/pkg/errors v0.8.1/go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=
github.com/pkg/errors v0.9.1 h1:FEBLx1zS214owpjy7qsBeixbURkuhQAwrK5UwLGTwt4=
github.com/pkg/errors v0.9.1/go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=
github.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM=
github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/rogpeppe/go-internal v1.6.1/go.mod h1:xXDCJY+GAPziupqXw64V24skbSoqbTEfhy4qGm1nDQc=
github.com/rogpeppe/go-internal v1.8.0 h1:FCbCCtXNOY3UtUuHUYaghJg4y7Fd14rXifAYUAtL9R8=
github.com/rogpeppe/go-internal v1.8.0/go.mod h1:WmiCO8CzOY8rg0OYDC4/i/2WRWAB6poM+XZ2dLUbcbE=
github.com/russross/blackfriday v1.5.2/go.mod h1:JO/DiYxRf+HjHt06OyowR9PTA263kcR/rfWxYHBV53g=
github.com/ryanuber/columnize v2.1.0+incompatible/go.mod h1:sm1tb6uqfes/u+d4ooFouqFdy9/2g9QGwK3SQygK0Ts=
github.com/schollz/closestmatch v2.1.0+incompatible/go.mod h1:RtP1ddjLong6gTkbtmuhtR2uUrrJOpYzYRvbcPAid+g=
github.com/sergi/go-diff v1.0.0/go.mod h1:0CfEIISq7TuYL3j771MWULgwwjU+GofnZX9QAmXWZgo=
github.com/shurcooL/sanitized_anchor_name v1.0.0/go.mod h1:1NzhyTcUVG4SuEtjjoZeVRXNmyL/1OwPU0+IJeTBvfc=
github.com/smartystreets/assertions v0.0.0-20180927180507-b2de0cb4f26d/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc=
github.com/smartystreets/goconvey v1.6.4/go.mod h1:syvi0/a8iFYH4r/RixwvyeAJjdLS9QV7WQ/tjFTllLA=
github.com/spf13/afero v1.1.2/go.mod h1:j4pytiNVoe2o6bmDsKpLACNPDBIoEAkihy7loJ1B0CQ=
github.com/spf13/cast v1.3.0/go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=
github.com/spf13/cobra v0.0.5/go.mod h1:3K3wKZymM7VvHMDS9+Akkh4K60UwM26emMESw8tLCHU=
github.com/spf13/jwalterweatherman v1.0.0/go.mod h1:cQK4TGJAtQXfYWX+Ddv3mKDzgVb68N+wFjFa4jdeBTo=
github.com/spf13/pflag v1.0.3/go.mod h1:DYY7MBk1bdzusC3SYhjObp+wFpr4gzcvqqNjLnInEg4=
github.com/spf13/viper v1.3.2/go.mod h1:ZiWeW+zYFKm7srdB9IoDzzZXaJaI5eL9QjNiN/DMA2s=
github.com/stretchr/objx v0.1.0/go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=
github.com/stretchr/testify v1.2.2/go.mod h1:a8OnRcib4nhh0OaRAV+Yts87kKdq0PP7pXfy6kDkUVs=
github.com/stretchr/testify v1.3.0/go.mod h1:M5WIy9Dh21IEIfnGCwXGc5bZfKNJtfHm1UVUgZn+9EI=
github.com/stretchr/testify v1.4.0/go.mod h1:j7eGeouHqKxXV5pUuKE4zz7dFj8WfuZ+81PSLYec5m4=
github.com/stretchr/testify v1.6.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.0 h1:nwc3DEeHmmLAfoZucVR881uASk0Mfjw8xYJ99tb5CcY=
github.com/stretchr/testify v1.7.0/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/ugorji/go v1.1.4/go.mod h1:uQMGLiO92mf5W77hV/PUCpI3pbzQx3CRekS0kk+RGrc=
github.com/ugorji/go v1.1.7/go.mod h1:kZn38zHttfInRq0xu/PH0az30d+z6vm202qpg1oXVMw=
github.com/ugorji/go v1.2.6 h1:tGiWC9HENWE2tqYycIqFTNorMmFRVhNwCpDOpWqnk8E=
github.com/ugorji/go v1.2.6/go.mod h1:anCg0y61KIhDlPZmnH+so+RQbysYVyDko0IMgJv0Nn0=
github.com/ugorji/go/codec v0.0.0-20181204163529-d75b2dcb6bc8/go.mod h1:VFNgLljTbGfSG7qAOspJ7OScBnGdDN/yBr0sguwnwf0=
github.com/ugorji/go/codec v1.1.7/go.mod h1:Ax+UKWsSmolVDwsd+7N3ZtXu+yMGCf907BLYF3GoBXY=
github.com/ugorji/go/codec v1.2.6 h1:7kbGefxLoDBuYXOms4yD7223OpNMMPNPZxXk5TvFcyQ=
github.com/ugorji/go/codec v1.2.6/go.mod h1:V6TCNZ4PHqoHGFZuSG1W8nrCzzdgA2DozYxWFFpvxTw=
github.com/urfave/negroni v1.0.0/go.mod h1:Meg73S6kFm/4PpbYdq35yYWoCZ9mS/YSx+lKnmiohz4=
github.com/valyala/bytebufferpool v1.0.0/go.mod h1:6bBcMArwyJ5K/AmCkWv1jt77kVWyCJ6HpOuEn7z0Csc=
github.com/valyala/fasthttp v1.6.0/go.mod h1:FstJa9V+Pj9vQ7OJie2qMHdwemEDaDiSdBnvPM1Su9w=
github.com/valyala/fasttemplate v1.0.1/go.mod h1:UQGH1tvbgY+Nz5t2n7tXsz52dQxojPUpymEIMZ47gx8=
github.com/valyala/fasttemplate v1.2.1/go.mod h1:KHLXt3tVN2HBp8eijSv/kGJopbvo7S+qRAEEKiv+SiQ=
github.com/valyala/tcplisten v0.0.0-20161114210144-ceec8f93295a/go.mod h1:v3UYOV9WzVtRmSR+PDvWpU/qWl4Wa5LApYYX4ZtKbio=
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f/go.mod h1:N2zxlSyiKSe5eX1tZViRH5QA0qijqEDrYZiPEAiq3wU=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415/go.mod h1:GwrjFmJcFw6At/Gs6z4yjiIwzuJ1/+UwLxMQDVQXShQ=
github.com/xeipuuv/gojsonschema v1.2.0/go.mod h1:anYRn/JVcOK2ZgGU+IjEV4nwlhoK5sQluxsYJ78Id3Y=
github.com/xordataexchange/crypt v0.0.3-0.20170626215501-b2862e3d0a77/go.mod h1:aYKd//L2LvnjZzWKhF00oedf4jCCReLcmhLdhm1A27Q=
github.com/yalp/jsonpath v0.0.0-20180802001716-5cc68e5049a0/go.mod h1:/LWChgwKmvncFJFHJ7Gvn9wZArjbV5/FppcK2fKk/tI=
github.com/yudai/gojsondiff v1.0.0/go.mod h1:AY32+k2cwILAkW1fbgxQ5mUmMiZFgLIV+FBNExI05xg=
github.com/yudai/golcs v0.0.0-20170316035057-ecda9a501e82/go.mod h1:lgjkn3NuSvDfVJdfcVVdX+jpBxNmX4rDAzaS45IcYoM=
github.com/yudai/pp v2.0.1+incompatible/go.mod h1:PuxR/8QJ7cyCkFp/aUDS+JY727OFEZkTdatxwunjIkc=
github.com/yuin/goldmark v1.3.5/go.mod h1:mwnBkeHKe2W/ZEtQ+71ViKU8L12m81fl3OWwC1Zlc8k=
go.uber.org/atomic v1.7.0/go.mod h1:fEN4uk6kAWBTFdckzkM89CLk9XfWZrxpCo0nPH17wJc=
go.uber.org/atomic v1.9.0 h1:ECmE8Bn/WFTYwEW/bpKD3M8VtR/zQVbavAoalC1PYyE=
go.uber.org/atomic v1.9.0/go.mod h1:fEN4uk6kAWBTFdckzkM89CLk9XfWZrxpCo0nPH17wJc=
go.uber.org/goleak v1.1.11 h1:wy28qYRKZgnJTxGxvye5/wgWr1EKjmUDGYox5mGlRlI=
go.uber.org/goleak v1.1.11/go.mod h1:cwTWslyiVhfpKIDGSZEM2HlOvcqm+tG4zioyIeLoqMQ=
go.uber.org/multierr v1.6.0/go.mod h1:cdWPpRnG4AhwMwsgIHip0KRBQjJy5kYEpYjJxpXp9iU=
go.uber.org/multierr v1.7.0 h1:zaiO/rmgFjbmCXdSYJWQcdvOCsthmdaHfr3Gm2Kx4Ec=
go.uber.org/multierr v1.7.0/go.mod h1:7EAYxJLBy9rStEaz58O2t4Uvip6FSURkq8/ppBp95ak=
go.uber.org/zap v1.21.0 h1:WefMeulhovoZ2sYXz7st6K0sLj7bBhpiFaud4r4zST8=
go.uber.org/zap v1.21.0/go.mod h1:wjWOCqI0f2ZZrJF/UufIOkiC8ii6tm1iqIsLo76RfJw=
golang.org/x/crypto v0.0.0-20181203042331-505ab145d0a9/go.mod h1:6SG95UA2DQfeDnfUPMdvaQW0Q7yPrPDi9nlGo2tz2b4=
golang.org/x/crypto v0.0.0-20190308221718-c2843e01d9a2/go.mod h1:djNgcEr1/C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=
golang.org/x/crypto v0.0.0-20190701094942-4def268fd1a4/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.0.0-20191011191535-87dc89f01550/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.0.0-20191227163750-53104e6ec876/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20210322153248-0c34fe9e7dc2/go.mod h1:T9bdIzuCu7OtxOm1hfPfRQxPLYneinmdGuTeoZ9dtd4=
golang.org/x/crypto v0.0.0-20210711020723-a769d52b0f97/go.mod h1:GvvjBRRGRdwPK5ydBHafDWAxML/pGHZbMvKqRZ5+Abc=
golang.org/x/crypto v0.0.0-20210921155107-089bfa567519/go.mod h1:GvvjBRRGRdwPK5ydBHafDWAxML/pGHZbMvKqRZ5+Abc=
golang.org/x/crypto v0.0.0-20220214200702-86341886e292 h1:f+lwQ+GtmgoY+A2YaQxlSOnDjXcQ7ZRLWOHbC6HtRqE=
golang.org/x/crypto v0.0.0-20220214200702-86341886e292/go.mod h1:IxCIyHEi3zRg3s0A5j5BB6A9Jmi73HwBIUl50j+osU4=
golang.org/x/lint v0.0.0-20190930215403-16217165b5de/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/mod v0.4.2/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=
golang.org/x/net v0.0.0-20180906233101-161cd47e91fd/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181220203305-927f97764cc3/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20190311183353-d8887717615a/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.0.0-20190327091125-710a502c58a2/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.0.0-20190503192946-f4e77d36d62c/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.0.0-20190620200207-3b0461eec859/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20190827160401-ba9fcec4b297/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20191209160850-c0dbc17a3553/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20210226172049-e18ecbb05110/go.mod h1:m0MpNAwzfU5UDzcl9v0D8zg8gWTRqZa9RBIspLL5mdg=
golang.org/x/net v0.0.0-20210405180319-a5a99cb37ef4/go.mod h1:p54w0d4576C0XHj96bSt6lcn1PtDYWL6XObtHCRCNQM=
golang.org/x/net v0.0.0-20211008194852-3b03d305991f/go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=
golang.org/x/net v0.0.0-20211112202133-69e39bad7dc2/go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=
golang.org/x/sync v0.0.0-20180314180146-1d60e4601c6f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20190423024810-112230192c58/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20190911185100-cd5d95a43a6e/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20210220032951-036812b2e83c h1:5KslGYwFpkhGh+Q16bwMP3cOontH8FOep7tGV86Y7SQ=
golang.org/x/sync v0.0.0-20210220032951-036812b2e83c/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sys v0.0.0-20180909124046-d0be0721c37e/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20181205085412-a5c9d58dba9a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20190222072716-a9d3bda3a223/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190626221950-04f50cda93cb/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190813064441-fde4db37ae7a/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200116001909-b77594299b42/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200223170610-d5e6a3e2c0ae/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20201119102817-f84b799fce68/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210330210617-4fbd30eecc44/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210403161142-5e06dd20ab57/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210423082822-04245dca01da/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210510120138-977fb7262007/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20210615035016-665e8c7367d1/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20210630005230-0f9fa26af87c/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20210806184541-e5e7981a1069/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20210927094055-39ccf1dd6fa6/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211007075335-d3039528d8ac/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220209214540-3681064d5158 h1:rm+CHSpPEEW2IsXUib1ThaHIjuBVZjxNgSKmBLFfD4c=
golang.org/x/sys v0.0.0-20220209214540-3681064d5158/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=
golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=
golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=
golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
golang.org/x/text v0.3.6/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
golang.org/x/text v0.3.7 h1:olpwvP2KacW1ZWvsR7uQhoyTYvKAupfQrRGBFM352Gk=
golang.org/x/text v0.3.7/go.mod h1:u+2+/6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=
golang.org/x/time v0.0.0-20201208040808-7e3f01d25324/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.0.0-20220210224613-90d013bbcef8 h1:vVKdlvoWBphwdxWKrFZEuM0kGgGLxUOYcY4U/2Vjg44=
golang.org/x/time v0.0.0-20220210224613-90d013bbcef8/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
golang.org/x/tools v0.0.0-20181221001348-537d06c36207/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
golang.org/x/tools v0.0.0-20190311212946-11955173bddd/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
golang.org/x/tools v0.0.0-20190327201419-c70d86f8b7cf/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
golang.org/x/tools v0.0.0-20190328211700-ab21143f2384/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
golang.org/x/tools v0.0.0-20191119224855-298f0cb1881e/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=
golang.org/x/tools v0.1.5/go.mod h1:o0xws9oXOQQZyjljx8fwUC0k7L1pTE6eaCbjGeHmOkk=
golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20191011141410-1b5146add898/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1 h1:go1bK/D/BFZV2I8cIQd1NKEZ+0owSTG1fDTci4IqFcE=
golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
google.golang.org/protobuf v1.26.0-rc.1/go.mod h1:jlhhOSvTdKEhbULTjvd4ARK9grFBp09yW+WbY/TyQbw=
google.golang.org/protobuf v1.26.0/go.mod h1:9q0QmTI4eRPtz6boOQmLYwt+qCgq0jsYwAQnmE0givc=
google.golang.org/protobuf v1.27.1 h1:SnqbnDw1V7RiZcXPx5MEeqPv2s79L9i7BJUlG/+RurQ=
google.golang.org/protobuf v1.27.1/go.mod h1:9q0QmTI4eRPtz6boOQmLYwt+qCgq0jsYwAQnmE0givc=
gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20180628173108-788fd7840127/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c h1:Hei/4ADfdWqJk1ZMxUNpqntNwaWcugrBjAiHlqqRiVk=
gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c/go.mod h1:JHkPIbrfpd72SG/EVd6muEfDQjcINNoR0C8j2r3qZ4Q=
gopkg.in/errgo.v2 v2.1.0/go.mod h1:hNsd1EY+bozCKY1Ytp96fpM3vjJbqLJn88ws8XvfDNI=
gopkg.in/fsnotify.v1 v1.4.7/go.mod h1:Tz8NjZHkW78fSQdbUxIjBTcgA1z1m8ZHf0WmKUhAMys=
gopkg.in/go-playground/assert.v1 v1.2.1/go.mod h1:9RXL0bg/zibRAgZUYszZSwO/z8Y/a8bDuhia5mkpMnE=
gopkg.in/go-playground/validator.v8 v8.18.2/go.mod h1:RX2a/7Ha8BgOhfk7j780h4/u/RRjR0eouCJSH80/M2Y=
gopkg.in/go-playground/validator.v9 v9.29.1/go.mod h1:+c9/zcJMFNgbLvly1L1V+PpxWdVbfP1avr/N00E2vyQ=
gopkg.in/ini.v1 v1.51.1/go.mod h1:pNLf8WUiyNEtQjuu5G5vTm06TEv9tsIgeAvK8hOrP4k=
gopkg.in/mgo.v2 v2.0.0-20180705113604-9856a29383ce/go.mod h1:yeKp02qBN3iKW1OzL3MGk2IdtZzaj7SFntXj72NppTA=
gopkg.in/natefinch/lumberjack.v2 v2.0.0 h1:1Lc07Kr7qY4U2YPouBjpCLxpiyxIVoxqXgkXLknAOE8=
gopkg.in/natefinch/lumberjack.v2 v2.0.0/go.mod h1:l0ndWWf7gzL7RNwBG7wST/UCcT4T24xpD6X8LsfU/+k=
gopkg.in/tomb.v1 v1.0.0-20141024135613-dd632973f1e7/go.mod h1:dt/ZhP58zS4L8KSrWDmTeBkI65Dw0HsyUHuEVlX15mw=
gopkg.in/yaml.v2 v2.2.2/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI=
gopkg.in/yaml.v2 v2.2.4/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI=
gopkg.in/yaml.v2 v2.2.8/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI=
gopkg.in/yaml.v2 v2.4.0 h1:D8xgwECY7CYvx+Y2n4sBz93Jn9JRvxdiyyo8CTfuKaY=
gopkg.in/yaml.v2 v2.4.0/go.mod h1:RDklbk79AGWmwhnvt/jBztapEOGDOx6ZbXqjP6csGnQ=
gopkg.in/yaml.v3 v3.0.0-20191120175047-4206685974f2/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b h1:h8qDotaEPuJATrMmW04NCwg7v22aHH28wwpauUhK9Oo=
gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gorm.io/driver/sqlite v1.3.1 h1:bwfE+zTEWklBYoEodIOIBwuWHpnx52Z9zJFW5F33WLk=
gorm.io/driver/sqlite v1.3.1/go.mod h1:wJx0hJspfycZ6myN38x1O/AqLtNS6c5o9TndewFbELg=
gorm.io/gorm v1.23.1 h1:aj5IlhDzEPsoIyOPtTRVI+SyaN1u6k613sbt4pwbxG0=
gorm.io/gorm v1.23.1/go.mod h1:l2lP/RyAtc1ynaTjFksBde/O8v9oOGIApu2/xRitmZk=

```

`options.go`:

```go
package hh_lol_prophet

type ApplyOption func(o *options)

func WithEnablePprof(enablePprof bool) ApplyOption {
	return func(o *options) {
		o.enablePprof = enablePprof
	}
}
func WithHttpAddr(httpAddr string) ApplyOption {
	return func(o *options) {
		o.httpAddr = httpAddr
	}
}
func WithDebug() ApplyOption {
	return func(o *options) {
		o.debug = true
	}
}
func WithProd() ApplyOption {
	return func(o *options) {
		o.debug = false
	}
}

```

`pkg/bdk/array.go`:

```go
package bdk

func ArrChunkStr(arr []string, size int) [][]string {
	chunks := make([][]string, 0)
	chunk := make([]string, 0, size)
	for i := 0; i < len(arr); i++ {
		chunk = append(chunk, arr[i])
		if len(chunk) >= size {
			chunks = append(chunks, chunk)
			chunk = make([]string, 0, size)
		}
	}
	return chunks
}
func ArrChunkI64(arr []int64, size int) [][]int64 {
	chunks := make([][]int64, 0)
	chunk := make([]int64, 0, size)
	for i := 0; i < len(arr); i++ {
		chunk = append(chunk, arr[i])
		if len(chunk) >= size {
			chunks = append(chunks, chunk)
			chunk = make([]int64, 0, size)
		}
	}
	return chunks
}

```

`pkg/bdk/context.go`:

```go
package bdk

import "context"

func IsCtxDone(c context.Context) bool {
	select {
	case <-c.Done():
		return true
	default:
		return false
	}
}

```

`pkg/bdk/fn.go`:

```go
package bdk

import (
	"math/rand"
	"os"
	"time"
)

func IsFile(filename string) bool {
	fd, err := os.Stat(filename)
	if err != nil {
		return false
	}
	return !fd.IsDir()
}
func RandomAlphaNum(lengthParam ...int) []byte {
	length := 16
	if len(lengthParam) > 0 {
		length = lengthParam[0]
	}
	bytes := []byte("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")
	var result []byte
	r := rand.New(rand.NewSource(time.Now().UnixNano()))
	for i := 0; i < length; i++ {
		result = append(result, bytes[r.Intn(len(bytes))])
	}
	return result
}
func InArrayInt(a int, arr []int) bool {
	for _, v := range arr {
		if v == a {
			return true
		}
	}
	return false
}

```

`pkg/bdk/string.go`:

```go
package bdk

import "unsafe"

func Str2Bytes(str string) []byte {
	strData := (*[2]uintptr)(unsafe.Pointer(&str))
	byteSlice := [3]uintptr{strData[0], strData[1], strData[1]}
	return *(*[]byte)(unsafe.Pointer(&byteSlice))
}
func Bytes2Str(bs []byte) string {
	return *(*string)(unsafe.Pointer(&bs))
}

```

`pkg/bdk/time.go`:

```go
package bdk

import (
	"bytes"
	"fmt"
	"time"
)

type (
	DayTime  time.Time // 2020-01-02
	DateTime time.Time // 2020-01-02 15:04:05
)

const (
	DayTimeFmt  = "2006-01-02"
	DateTimeFmt = "2006-01-02 15:04:05"
)

func (t *DayTime) MarshalJSON() ([]byte, error) {
	return []byte(fmt.Sprintf("\"%s\"", time.Time(*t).Format(DayTimeFmt))), nil
}
func (t *DayTime) String() string {
	return time.Time(*t).Format(DayTimeFmt)
}
func (t *DayTime) UnmarshalJSON(b []byte) error {
	b = bytes.Trim(b, "\"")
	ext, err := time.ParseInLocation(DayTimeFmt, string(b), time.Local)
	if err != nil {
		return err
	}
	*t = DayTime(ext)
	return nil
}
func (t *DateTime) MarshalJSON() ([]byte, error) {
	return []byte(fmt.Sprintf("\"%s\"", time.Time(*t).Format(DateTimeFmt))), nil
}
func (t *DateTime) UnmarshalJSON(b []byte) error {
	b = bytes.Trim(b, "\"")
	ext, err := time.ParseInLocation(DateTimeFmt, string(b), time.Local)
	if err != nil {
		return err
	}
	*t = DateTime(ext)
	return nil
}
func (t *DateTime) String() string {
	return time.Time(*t).Format(DateTimeFmt)
}

```

`pkg/bdk/version.go`:

```go
package bdk

import (
	"strconv"
	"strings"
)

func CompareVersion(v1, v2 string) int {
	v1Val := getVersionVal(v1)
	v2Val := getVersionVal(v2)
	if v1Val > v2Val {
		return 1
	} else if v1Val == v2Val {
		return 0
	}
	return -1
}
func getVersionVal(ver string) int {
	strArr := strings.Split(ver, ".")
	if len(strArr) != 3 {
		return 0
	}
	val := 0
	v1, _ := strconv.Atoi(strArr[0])
	v2, _ := strconv.Atoi(strArr[1])
	v3, _ := strconv.Atoi(strArr[2])
	val += v1 * 1_0000_0000
	val += v2 * 1_0000
	val += v3 * 1
	return val
}

```

`pkg/dto/retcode/retcode.go`:

```go
package retcode

const (
	Ok = iota
	DefaultError
	NoAuth
	BadReq
	ValidError
	NoLogin
	ServerError
	RateLimitError
)

```

`pkg/fastcurd/db.go`:

```go
package fastcurd

const (
	PrimaryField    = "id"
	CreateTimeField = "ctime"
	UpdateTimeField = "utime"
	DeleteTimeField = "dtime"
)

```

`pkg/fastcurd/filter.go`:

```go
package fastcurd

import (
	"fmt"
	"strings"
	"time"

	"gorm.io/gorm"
)

type (
	Filter     = map[string]FilterItem
	FilterCond string
	FilterItem struct {
		Condition FilterCond
		Val       interface{}
	}
)

const (
	// ç­›é€‰æ¡ä»¶
	CondUndefined FilterCond = "undefined"
	// æ•°å€¼
	CondEq           FilterCond = "eq"
	CondLt           FilterCond = "lt"
	CondElt          FilterCond = "elt"
	CondGt           FilterCond = "gt"
	CondEgt          FilterCond = "egt"
	CondNeq          FilterCond = "neq"
	CondBetweenValue FilterCond = "betweenValue"
	// å­—ç¬¦ä¸²
	CondEqString  FilterCond = "eqString"
	CondLike      FilterCond = "like"
	CondNotLike   FilterCond = "notLike"
	CondNeqString FilterCond = "neqString"
	// æ—¶é—´
	CondBefore      FilterCond = "before"
	CondAfter       FilterCond = "after"
	CondBetweenTime FilterCond = "betweenTime"
	// æ•°ç»„
	CondIn    FilterCond = "in"
	CondNotIn FilterCond = "notIn"
	// å†…éƒ¨ä½¿ç”¨
	CondRaw FilterCond = "raw"

	// order
	OrderAsc  = "asc"
	OrderDesc = "desc"
)

var (
	// CondMapDbCond æ¡ä»¶æ˜ å°„ æ•°æ®åº“æ¡ä»¶
	CondMapDbCond = map[FilterCond]string{
		CondEq:           "=",
		CondLt:           "<",
		CondElt:          "<=",
		CondGt:           ">",
		CondEgt:          ">=",
		CondNeq:          "<>",
		CondBetweenValue: "BETWEEN",
		CondEqString:     "=",
		CondLike:         "LIKE",
		CondNotLike:      "NOT LIKE",
		CondNeqString:    "<>",
		CondBefore:       "<",
		CondAfter:        ">",
		CondBetweenTime:  "BETWEEN",
		CondIn:           "IN",
		CondNotIn:        "NOT IN",
	}
)

func FmtCondVal(cond FilterCond, val interface{}) interface{} {
	switch cond {
	case CondLike, CondNotLike:
		if val, ok := val.(string); !ok {
			panic("ç­›é€‰æ¡ä»¶ä¸º" + cond + "æ—¶,valå¿…é¡»ä¸ºå­—ç¬¦ä¸²")
		} else {
			return "%" + val + "%"
		}
	case CondBetweenValue, CondBetweenTime:
		switch val.(type) {
		case []int:
			return []int{val.([]int)[0], val.([]int)[1]}
		case []string:
			return []string{val.([]string)[0], val.([]string)[1]}
		case []time.Time:
			location := time.FixedZone("UTC", 8*3600)
			return []string{val.([]time.Time)[0].In(location).Format("2006-01-02 15:04:05"),
				val.([]time.Time)[1].In(location).Format("2006-01-02 15:04:05")}
		case []interface{}:
			return val
		default:
			panic("ç­›é€‰æ¡ä»¶ä¸º" + cond + "æ—¶,valå¿…é¡»ä¸ºæ•°ç»„")
		}
	default:
		return val
	}
}
func FmtValPlaceholder(cond FilterCond) interface{} {
	switch cond {
	case CondIn, CondNotIn:
		return "(?)"
	case CondBetweenTime, CondBetweenValue:
		return "? and ?"
	default:
		return "?"
	}
}
func BuildFilterCond(filterMap map[string]string, db *gorm.DB, filter Filter) *gorm.DB {
	for filterKey, filterItem := range filter {
		if dbField, ok := filterMap[filterKey]; (ok || filterItem.Condition ==
			CondRaw) && filterItem.Condition != CondUndefined && filterItem.Val != nil {
			switch filterItem.Condition {
			case CondLike, CondNotLike:
				dbFieldList := strings.Split(dbField, "|")
				sql := ""
				actValArr := make([]interface{}, 0, 1)
				for _, field := range dbFieldList {
					if !IsValidQueryField(field) {
						continue
					}
					actCondition := CondMapDbCond[filterItem.Condition]
					actVal := FmtCondVal(filterItem.Condition, filterItem.Val)
					valPlaceholder := FmtValPlaceholder(filterItem.Condition)
					if arrVal, ok := actVal.([]string); ok {
						sql += fmt.Sprintf("%s %s %s", field, actCondition, valPlaceholder)
						actValArr = append(actValArr, arrVal[0], arrVal[1])
					} else {
						sql += fmt.Sprintf("%s %s %s", field, actCondition, valPlaceholder)
						actValArr = append(actValArr, actVal)
					}
					sql += " or "
				}
				sql = sql[:len(sql)-4]
				db = db.Where(sql, actValArr...)
			case CondRaw:
				rawSQLData := filterItem.Val.([]interface{})
				db = db.Where(rawSQLData[0].(string), rawSQLData[1].([]interface{})...)
			default:
				if !IsValidQueryField(dbField) {
					continue
				}
				actCondition := CondMapDbCond[filterItem.Condition]
				actVal := FmtCondVal(filterItem.Condition, filterItem.Val)
				valPlaceholder := FmtValPlaceholder(filterItem.Condition)
				if arrVal, ok := actVal.([]string); ok {
					db = db.Where(fmt.Sprintf("%s %s %s", dbField, actCondition, valPlaceholder),
						arrVal[0], arrVal[1])
				} else if arrVal, ok := actVal.([]interface{}); ok && len(arrVal) == 2 {
					db = db.Where(fmt.Sprintf("%s %s %s", dbField, actCondition, valPlaceholder),
						arrVal[0], arrVal[1])
				} else {
					db = db.Where(fmt.Sprintf("%s %s %s", dbField, actCondition, valPlaceholder), actVal)
				}
			}
		}
	}
	return db
}
func BuildOrderCond(orderKeyMap map[string]string, q *gorm.DB, order map[string]string) *gorm.DB {
	for orderKey, orderVal := range order {
		if actKey, ok := orderKeyMap[orderKey]; ok {
			if orderVal == OrderDesc {
				q = q.Order(actKey + " desc")
			} else {
				q = q.Order(actKey + " asc")
			}
		}
	}
	return q
}

```

`pkg/fastcurd/fn.go`:

```go
package fastcurd

// åˆ¤æ–­æŸ¥è¯¢å­—æ®µæ˜¯å¦ä¸ºåˆè§„çš„å­—ç¬¦ä¸² é˜²æ³¨å…¥
func IsValidQueryField(field string) bool {
	for _, c := range field {
		if (c < 'a' || c > 'z') && c != '_' {
			return false
		}
	}
	return true
}

```

`pkg/fastcurd/request.go`:

```go
package fastcurd

const (
	SceneDefault = "default"
	NotLimit     = 0
)

type (
	NullableDetailData struct {
		ID    *int                   `json:"id" binding:"omitempty"`
		Scene string                 `json:"scene" binding:"omitempty"`
		Extra map[string]interface{} `json:"extra" binding:"omitempty"`
	}
	IDData struct {
		ID int `json:"id" binding:"required"`
	}
	DetailData struct {
		ID    int                    `json:"id" binding:"required"`
		Scene string                 `json:"scene" binding:""`
		Extra map[string]interface{} `json:"extra" binding:""`
	}
	DelData struct {
		IDs []int `json:"ids" binding:"required,min=1"`
	}
	ListData struct {
		Page   int                    `json:"page" binding:"omitempty,required,min=0"`
		Limit  int                    `json:"limit" binding:"omitempty,required,min=0,max=50"`
		Filter Filter                 `json:"filter" binding:""`
		Order  map[string]string      `json:"order" binding:""`
		Extra  map[string]interface{} `json:"extra" binding:""`
	}
	FullLimitListData struct {
		ListData
		Limit int `json:"limit" binding:"omitempty,required,min=0"`
	}
	SearchData struct {
		Search string `json:"search" binding:"required"`
		ListData
	}
)

func (p *ListData) GetScene() string {
	var scene interface{}
	var ok bool
	if scene, ok = p.Extra["scene"]; !ok {
		scene = SceneDefault
	}
	return scene.(string)
}
func (d *DetailData) GetScene() string {
	scene := d.Scene
	if scene == "" {
		scene = SceneDefault
	}
	return scene
}
func (d *NullableDetailData) GetScene() string {
	scene := d.Scene
	if scene == "" {
		scene = SceneDefault
	}
	return scene
}

```

`pkg/fastcurd/response.go`:

```go
package fastcurd

type RespJsonExtra struct {
	ReqID    string      `json:"requestID,omitempty"`
	SQLs     interface{} `json:"sqls,omitempty"`
	ProcTime string      `json:"procTime" example:"0.2s"`
	TempData interface{} `json:"tempData,omitempty"`
}

// é€šç”¨è¿”å›json
// æ‰€æœ‰çš„æ¥å£å‡è¿”å›æ­¤å¯¹è±¡
type RetJSON struct {
	Code  int            `json:"code" example:"0"`
	Data  interface{}    `json:"data,omitempty"`
	Msg   string         `json:"msg,omitempty" example:"æç¤ºä¿¡æ¯"`
	Count *int           `json:"count,omitempty"`
	Page  int            `json:"page,omitempty"`
	Limit int            `json:"limit,omitempty"`
	Extra *RespJsonExtra `json:"extra,omitempty"`
}

```

`pkg/gin/app.go`:

```go
package ginApp

import (
	"fmt"
	"log"
	"net/http"
	"runtime/debug"
	"sync"
	"time"

	"github.com/getsentry/sentry-go"
	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
	"github.com/go-playground/validator/v10"
	"github.com/pkg/errors"

	"github.com/real-web-world/hh-lol-prophet/global"
	"github.com/real-web-world/hh-lol-prophet/pkg/dto/retcode"
	"github.com/real-web-world/hh-lol-prophet/pkg/fastcurd"
)

const (
	// head field
	HeadLocale      = "locale"
	HeadToken       = "token"
	HeadUserAgent   = "User-Agent"
	HeadContentType = "Content-Type"
	// ctx key
	KeyUID            = "uid"
	KeyTeam           = "team"
	KeyTrans          = "trans"
	KeyApp            = "app"
	KeyAuthUser       = "authUser"
	KeyInitOnce       = "initOnce"
	KeyProcBeginTime  = "procBeginTime"
	KeyNotSaveResp    = "notSaveResp"
	KeyNotTrace       = "notTrace"
	KeyResp           = "resp"
	KeyReqID          = "reqID"
	KeyApiCacheKey    = "apiCacheKey"
	KeyApiCacheExpire = "apiCacheExpire"
	KeyRoles          = "roles"
	KeyStatusCode     = "statusCode"
	KeyProcTime       = "procTime"
)

var (
	respBadReq       = &fastcurd.RetJSON{Code: retcode.BadReq, Msg: "bad request"}
	respNoChange     = &fastcurd.RetJSON{Code: retcode.DefaultError, Msg: "no change"}
	respNoAuth       = &fastcurd.RetJSON{Code: retcode.NoAuth, Msg: "no auth"}
	respNoLogin      = &fastcurd.RetJSON{Code: retcode.NoLogin, Msg: "please login"}
	respReqFrequency = &fastcurd.RetJSON{Code: retcode.RateLimitError, Msg: "high rate req~"}
)

type (
	App struct {
		C  *gin.Context
		mu sync.Mutex
	}
	ServerInfo struct {
		Timestamp int64 `json:"timestamp"`
	}
)

func GetApp(c *gin.Context) *App {
	initOnce, ok := c.Get(KeyInitOnce)
	if !ok {
		panic("ctx must set initOnce")
	}
	initOnce.(*sync.Once).Do(func() {
		c.Set(KeyApp, newApp(c))
	})
	app, _ := c.Get(KeyApp)
	return app.(*App)
}
func newApp(c *gin.Context) *App {
	return &App{
		C: c,
	}
}

// finally resp fn
func (app *App) Response(code int, json *fastcurd.RetJSON) {
	app.SetCtxRespVal(json)
	procBeginTime := app.GetProcBeginTime()
	reqID := app.GetReqID()
	var procTime string
	if procBeginTime != nil {
		procTime = time.Since(*procBeginTime).String()
	}
	json.Extra = &fastcurd.RespJsonExtra{
		ProcTime: procTime,
		ReqID:    reqID,
	}
	app.SetStatusCode(code)
	app.SetProcTime(procTime)
	app.C.JSON(code, json)
	app.C.Abort()
}

// resp helper
func (app *App) Ok(msg string, data ...interface{}) {
	var actData interface{} = nil
	if len(data) == 1 {
		actData = data[0]
	}
	app.JSON(&fastcurd.RetJSON{Code: retcode.Ok, Msg: msg, Data: actData})
}
func (app *App) Data(data interface{}) {
	app.RetData(data)
}
func (app *App) ServerError(err error) {
	json := &fastcurd.RetJSON{Code: retcode.ServerError, Msg: err.Error()}
	app.Response(http.StatusInternalServerError, json)
}
func (app *App) ServerBad() {
	json := &fastcurd.RetJSON{Code: retcode.ServerError, Msg: "æœåŠ¡å™¨å¼€å°å·®äº†~"}
	app.Response(http.StatusInternalServerError, json)
}
func (app *App) RetData(data interface{}, msgParam ...string) {
	msg := ""
	if len(msgParam) == 1 {
		msg = msgParam[0]
	}
	app.Ok(msg, data)
}
func (app *App) JSON(json *fastcurd.RetJSON) {
	app.Response(http.StatusOK, json)
}
func (app *App) XML(xml interface{}) {
	procBeginTime := app.GetProcBeginTime()
	var procTime string
	if procBeginTime != nil {
		procTime = time.Since(*procBeginTime).String()
	}
	code := http.StatusOK
	app.SetStatusCode(code)
	app.SetProcTime(procTime)
	app.C.XML(code, xml)
	app.C.Abort()
}
func (app *App) SendList(list interface{}, count int) {
	app.Response(http.StatusOK, &fastcurd.RetJSON{
		Code:  retcode.Ok,
		Data:  list,
		Count: &count,
	})
}
func (app *App) BadReq() {
	app.Response(http.StatusBadRequest, respBadReq)
}
func (app *App) String(html string) {
	app.C.String(http.StatusOK, html)
}
func (app *App) ValidError(err error) {
	json := &fastcurd.RetJSON{}
	switch actErr := err.(type) {
	case validator.ValidationErrors:
		json.Code = retcode.ValidError
		json.Msg = actErr[0].Error()
	default:
		if err.Error() == "EOF" {
			json.Code = retcode.ValidError
			json.Msg = "request param is required"
		} else {
			json.Code = retcode.DefaultError
			json.Msg = actErr.Error()
		}
	}
	app.Response(http.StatusBadRequest, json)
}
func (app *App) NoChange() {
	app.JSON(respNoChange)
}
func (app *App) NoAuth() {
	app.Response(http.StatusUnauthorized, respNoAuth)
}
func (app *App) NoLogin() {
	app.Response(http.StatusUnauthorized, respNoLogin)
}
func (app *App) ErrorMsg(msg string) {
	json := &fastcurd.RetJSON{Code: retcode.DefaultError, Msg: msg}
	app.Response(http.StatusOK, json)
}
func (app *App) CommonError(err error) {
	app.ErrorMsg(err.Error())
}
func (app *App) RateLimitError() {
	app.Response(http.StatusBadRequest, respReqFrequency)
}
func (app *App) Success() {
	json := &fastcurd.RetJSON{Code: retcode.Ok}
	app.Response(http.StatusOK, json)
}
func (app *App) SendAffectRows(affectRows int) {
	app.Data(gin.H{
		"affectRows": affectRows,
	})
}

func (app *App) GetFullReqURL() string {
	schema := "http://"
	req := app.C.Request
	if req.TLS != nil {
		schema = "https://"
	}
	return schema + req.Host + req.RequestURI
}

// head field helper
func (app *App) GetLocale() string {
	return app.C.Request.Header.Get(HeadLocale)
}
func (app *App) GetUserAgent() string {
	return app.GetUA()
}
func (app *App) GetToken() string {
	return app.C.Request.Header.Get(HeadToken)
}
func (app *App) GetUA() string {
	return app.C.GetHeader(HeadUserAgent)
}
func (app *App) GetContentType() string {
	return app.C.GetHeader(HeadContentType)
}
func (app *App) GetNotSaveResp() *bool {
	b, ok := app.C.Get(KeyNotSaveResp)
	if !ok {
		return nil
	}
	if t, ok := b.(bool); ok {
		return &t
	}
	return nil
}
func (app *App) SetNotSaveResp() {
	app.C.Set(KeyNotSaveResp, true)
}
func (app *App) GetNotTrace() *bool {
	b, ok := app.C.Get(KeyNotTrace)
	if !ok {
		return nil
	}
	if t, ok := b.(bool); ok {
		return &t
	}
	return nil
}
func (app *App) SetNotTrace() {
	app.C.Set(KeyNotTrace, true)
}
func (app *App) IsShouldSaveResp() bool {
	t := app.GetNotSaveResp()
	return t == nil || *t
}

func (app *App) GetCtxRespVal() *fastcurd.RetJSON {
	if json, ok := app.C.Get(KeyResp); ok {
		return json.(*fastcurd.RetJSON)
	}
	return nil
}
func (app *App) SetCtxRespVal(json *fastcurd.RetJSON) {
	app.C.Set(KeyResp, json)
}
func (app *App) GetProcBeginTime() *time.Time {
	if procBeginTime, ok := app.C.Get(KeyProcBeginTime); ok {
		return procBeginTime.(*time.Time)
	}
	return nil
}
func (app *App) SetProcBeginTime(beginTime *time.Time) {
	app.C.Set(KeyProcBeginTime, beginTime)
}
func (app *App) GetReqID() string {
	if reqID, ok := app.C.Get(KeyReqID); ok {
		return reqID.(string)
	}
	return ""
}
func (app *App) SetReqID(reqID string) {
	app.C.Set(KeyReqID, reqID)
}
func (app *App) GetStatusCode() int {
	if code, ok := app.C.Get(KeyStatusCode); ok {
		return code.(int)
	}
	return 0
}
func (app *App) SetStatusCode(code int) {
	app.C.Set(KeyStatusCode, code)
}
func (app *App) GetProcTime() string {
	if procTime, ok := app.C.Get(KeyProcTime); ok {
		return procTime.(string)
	}
	return ""
}
func (app *App) SetProcTime(procTime string) {
	app.C.Set(KeyProcTime, procTime)
}
func (app *App) GetApiCacheKey() *string {
	if key, ok := app.C.Get(KeyApiCacheKey); ok {
		fmtKey := key.(string)
		return &fmtKey
	}
	return nil
}
func (app *App) SetApiCacheKey(key string) {
	app.C.Set(KeyApiCacheKey, key)
}
func (app *App) GetApiCacheExpire() *time.Duration {
	if ex, ok := app.C.Get(KeyApiCacheExpire); ok {
		return ex.(*time.Duration)
	}
	return nil
}
func (app *App) SetApiCacheExpire(d *time.Duration) {
	app.C.Set(KeyApiCacheExpire, d)
}

// middleware
func PrepareProc(c *gin.Context) {
	now := time.Now()
	c.Set(KeyInitOnce, &sync.Once{})
	c.Set(KeyProcBeginTime, &now)
	c.Next()
}
func ErrHandler(c *gin.Context) {
	defer func() {
		if err := recover(); err != nil {
			var actErr error
			if global.IsDevMode() {
				log.Println("å‘ç”Ÿå¼‚å¸¸: ", err)
				debug.PrintStack()
			} else {
				sentry.CaptureException(errors.New(fmt.Sprintf("%v", err)))
			}
			app := GetApp(c)
			switch err := err.(type) {
			case error:
				actErr = err
			case string:
				errMsg := err
				actErr = errors.New(errMsg)
			default:
				actErr = errors.New("server exception")
			}
			app.ServerError(actErr)
			return
		}
	}()
	c.Next()
}
func Cors() gin.HandlerFunc {
	return cors.New(cors.Config{
		AllowOriginFunc: func(origin string) bool {
			return true
		},
		AllowMethods: []string{
			http.MethodGet,
			http.MethodHead,
			http.MethodPost,
			http.MethodPut,
			http.MethodPatch,
			http.MethodDelete,
			http.MethodConnect,
			http.MethodOptions,
			http.MethodTrace,
		},
		AllowHeaders:     []string{"content-type", "x-requested-with", "token", "locale"},
		ExposeHeaders:    []string{"Content-Length"},
		AllowCredentials: true,
		MaxAge:           12 * time.Hour,
	})
}

```

`pkg/gin/log.go`:

```go
package ginApp

import (
	"fmt"
	"net/http"

	"github.com/gin-gonic/gin"
	"github.com/real-web-world/hh-lol-prophet/global"
)

func LogFormatter(p gin.LogFormatterParams) string {
	if !global.IsDevMode() {
		return ""
	}
	isOptMethod := p.Request.Method == http.MethodOptions
	isSkipLog := p.StatusCode == http.StatusNotFound || isOptMethod
	if isSkipLog {
		return ""
	}
	reqTime := p.TimeStamp.Format("2006-01-02 15:04:05")
	path := p.Request.URL.Path
	method := p.Request.Method
	code := p.StatusCode
	clientIp := p.ClientIP
	errMsg := p.ErrorMessage
	processTime := p.Latency
	return fmt.Sprintf("API: %s %d %s %s %s %v %s\n", reqTime, code, clientIp, path, method, processTime,
		errMsg)
}

```

`pkg/logger/level.go`:

```go
package logger

import "go.uber.org/zap/zapcore"

type LogLevelStr = string

const (
	LevelDebugStr LogLevelStr = "debug"
	LevelFatalStr LogLevelStr = "fatal"
	LevelErrorStr LogLevelStr = "error"
	LevelWarnStr  LogLevelStr = "warn"
	LevelInfoStr  LogLevelStr = "info"
)

func Str2ZapLevel(level LogLevelStr) (zapcore.Level, error) {
	return zapcore.ParseLevel(string(level))
}

```

`pkg/windows/admin/admin.go`:

```go
package admin

import (
	"fmt"
	"os"
	"strings"
	"syscall"

	"golang.org/x/sys/windows"
)

func MustRunWithAdmin() {
	if !IsAdmin() {
		RunMeElevated()
	}
}
func RunMeElevated() {
	verb := "runas"
	exe, _ := os.Executable()
	cwd, _ := os.Getwd()
	args := strings.Join(os.Args[1:], " ")
	verbPtr, _ := syscall.UTF16PtrFromString(verb)
	exePtr, _ := syscall.UTF16PtrFromString(exe)
	cwdPtr, _ := syscall.UTF16PtrFromString(cwd)
	argPtr, _ := syscall.UTF16PtrFromString(args)
	var showCmd int32 = 1 // SW_NORMAL
	err := windows.ShellExecute(0, verbPtr, exePtr, argPtr, cwdPtr, showCmd)
	if err != nil {
		fmt.Println(err)
	}
	os.Exit(-2)
}

func IsAdmin() bool {
	_, err := os.Open("\\\\.\\PHYSICALDRIVE0")
	return err == nil
}

```

`pkg/windows/process/process.go`:

```go
//go:build windows
// +build windows

package process

import (
	"errors"
	"fmt"
	"reflect"
	"syscall"
	"unsafe"

	"github.com/real-web-world/hh-lol-prophet/services/logger"
	"golang.org/x/sys/windows"
)

// Windows API functions
var (
	modKernel32                  = syscall.NewLazyDLL("kernel32.dll")
	procCloseHandle              = modKernel32.NewProc("CloseHandle")
	procCreateToolhelp32Snapshot = modKernel32.NewProc("CreateToolhelp32Snapshot")
	procProcess32First           = modKernel32.NewProc("Process32FirstW")
	procProcess32Next            = modKernel32.NewProc("Process32NextW")
	queryFullProcessImageName    = modKernel32.NewProc("QueryFullProcessImageNameW")
	errNotFoundProcess           = errors.New("æœªæ‰¾åˆ°è¿›ç¨‹")
)

// Some constants from the Windows API
const (
	ERROR_NO_MORE_FILES = 0x12
	MAX_PATH            = 260
)

// PROCESSENTRY32 is the Windows API structure that contains a process's
// information.
type PROCESSENTRY32 struct {
	Size              uint32
	CntUsage          uint32
	ProcessID         uint32
	DefaultHeapID     uintptr
	ModuleID          uint32
	CntThreads        uint32
	ParentProcessID   uint32
	PriorityClassBase int32
	Flags             uint32
	ExeFile           [MAX_PATH]uint16
}

// Process is an implementation of Process for Windows.
type Process struct {
	pid  int
	ppid int
	exe  string
}

func (p *Process) Pid() int {
	return p.pid
}

func (p *Process) PPid() int {
	return p.ppid
}

func (p *Process) Executable() string {
	return p.exe
}

func newWindowsProcess(e *PROCESSENTRY32) *Process {
	// Find when the string ends for decoding
	end := 0
	for {
		if e.ExeFile[end] == 0 {
			break
		}
		end++
	}

	return &Process{
		pid:  int(e.ProcessID),
		ppid: int(e.ParentProcessID),
		exe:  syscall.UTF16ToString(e.ExeFile[:end]),
	}
}

func findProcess(pid int) (*Process, error) {
	ps, err := Processes()
	if err != nil {
		return nil, err
	}

	for _, p := range ps {
		if p.Pid() == pid {
			return p, nil
		}
	}

	return nil, nil
}

func Processes() ([]*Process, error) {
	handle, _, _ := procCreateToolhelp32Snapshot.Call(
		0x00000002,
		0)
	if handle < 0 {
		return nil, syscall.GetLastError()
	}
	defer procCloseHandle.Call(handle)

	var entry PROCESSENTRY32
	entry.Size = uint32(unsafe.Sizeof(entry))
	ret, _, _ := procProcess32First.Call(handle, uintptr(unsafe.Pointer(&entry)))
	if ret == 0 {
		return nil, fmt.Errorf("Error retrieving process info.")
	}

	results := make([]*Process, 0, 50)
	for {
		results = append(results, newWindowsProcess(&entry))

		ret, _, _ := procProcess32Next.Call(handle, uintptr(unsafe.Pointer(&entry)))
		if ret == 0 {
			break
		}
	}

	return results, nil
}

func GetProcessFullPath(targetName string) (string, error) {
	var pid int
	processList, err := Processes()
	if err != nil {
		return "", err
	}
	for _, processInfo := range processList {
		if processInfo.Executable() == targetName {
			pid = processInfo.Pid()
			break
		}
	}
	if pid == 0 {
		return "", errNotFoundProcess
	}
	hProcess, err := syscall.OpenProcess(syscall.PROCESS_QUERY_INFORMATION, false, uint32(pid))
	if err != nil {
		logger.Debug("æ— æ³•è·å–åˆ°è¿›ç¨‹handle: ", err)
		return "", errNotFoundProcess
	}
	buf := [MAX_PATH]uint16{}
	size := MAX_PATH
	ret, _, lastErr := queryFullProcessImageName.Call(uintptr(hProcess), 0,
		uintptr(unsafe.Pointer(&buf)), uintptr(unsafe.Pointer(&size)))
	if ret != 1 {
		errMsg := "none"
		if lastErr != nil {
			errMsg = lastErr.Error()
		}
		return "", errors.New("è·å–è¿›ç¨‹å…¨è·¯å¾„å¤±è´¥:" + errMsg)
	}
	return syscall.UTF16ToString(buf[:]), nil
}
func GetProcessCommand(targetName string) (string, error) {
	var pid int
	processList, err := Processes()
	if err != nil {
		return "", err
	}
	for _, processInfo := range processList {
		if processInfo.Executable() == targetName {
			pid = processInfo.Pid()
			break
		}
	}
	if pid == 0 {
		return "", errNotFoundProcess
	}
	return GetCmdline(uint32(pid))
}
func GetCmdline(pid uint32) (string, error) {
	h, err := windows.OpenProcess(windows.PROCESS_QUERY_INFORMATION|windows.PROCESS_VM_READ, false, pid)
	if err != nil {
		if e, ok := err.(windows.Errno); ok && e == windows.ERROR_ACCESS_DENIED {
			return "", nil // æ²¡æƒé™,å¿½ç•¥è¿™ä¸ªè¿›ç¨‹
		}
		return "", err
	}
	defer func() {
		_ = windows.CloseHandle(h)
	}()
	var pbi struct {
		ExitStatus                   uint32
		PebBaseAddress               uintptr
		AffinityMask                 uintptr
		BasePriority                 int32
		UniqueProcessID              uintptr
		InheritedFromUniqueProcessID uintptr
	}
	pbiLen := uint32(unsafe.Sizeof(pbi))
	err = windows.NtQueryInformationProcess(h, windows.ProcessBasicInformation, unsafe.Pointer(&pbi), pbiLen, &pbiLen)
	if err != nil {
		return "", err
	}
	var addr uint64
	d := *(*[]byte)(unsafe.Pointer(&reflect.SliceHeader{
		Data: uintptr(unsafe.Pointer(&addr)),
		Len:  8, Cap: 8}))
	err = windows.ReadProcessMemory(h, pbi.PebBaseAddress+32,
		&d[0], uintptr(len(d)), nil)
	if err != nil {
		return "", err
	}
	var commandLine windows.NTUnicodeString
	Len := unsafe.Sizeof(commandLine)
	d = *(*[]byte)(unsafe.Pointer(&reflect.SliceHeader{
		Data: uintptr(unsafe.Pointer(&commandLine)),
		Len:  int(Len), Cap: int(Len)}))
	err = windows.ReadProcessMemory(h, uintptr(addr+112),
		&d[0], Len, nil)
	if err != nil {
		return "", err
	}
	cmdData := make([]uint16, commandLine.Length/2)
	d = *(*[]byte)(unsafe.Pointer(&cmdData))
	err = windows.ReadProcessMemory(h, uintptr(unsafe.Pointer(commandLine.Buffer)),
		&d[0], uintptr(commandLine.Length), nil)
	if err != nil {
		return "", err
	}
	return windows.UTF16ToString(cmdData), nil
}

```

`pkg/windows/user32.go`:

```go
package windows

import (
	syscall "golang.org/x/sys/windows"
)

var (
	user32 = syscall.NewLazySystemDLL("user32.dll")

	SetWindowPos     = user32.NewProc("SetWindowPos")
	GetSystemMetrics = user32.NewProc("GetSystemMetrics")
)

```

`prophet.go`:

```go
package hh_lol_prophet

import (
	"context"
	"crypto/tls"
	"encoding/base64"
	"encoding/json"
	"fmt"
	"log"
	"net/http"
	"net/url"
	"os"
	"os/exec"
	"os/signal"
	"strings"
	"sync"
	"time"

	"github.com/atotto/clipboard"
	"github.com/avast/retry-go"
	"github.com/getsentry/sentry-go"
	sentryGin "github.com/getsentry/sentry-go/gin"
	"github.com/gin-contrib/pprof"
	"github.com/gin-gonic/gin"
	"github.com/gorilla/websocket"
	"github.com/pkg/errors"
	"go.uber.org/zap"
	"golang.org/x/sync/errgroup"

	"github.com/real-web-world/hh-lol-prophet/global"
	ginApp "github.com/real-web-world/hh-lol-prophet/pkg/gin"
	"github.com/real-web-world/hh-lol-prophet/services/lcu"
	"github.com/real-web-world/hh-lol-prophet/services/lcu/models"
	"github.com/real-web-world/hh-lol-prophet/services/logger"
)

type (
	lcuWsEvt  string
	GameState string
	Prophet   struct {
		ctx          context.Context
		opts         *options
		httpSrv      *http.Server
		lcuPort      int
		lcuToken     string
		lcuActive    bool
		currSummoner *lcu.CurrSummoner
		cancel       func()
		api          *Api
		mu           *sync.Mutex
		GameState    GameState
	}
	wsMsg struct {
		Data      interface{} `json:"data"`
		EventType string      `json:"event_type"`
		Uri       string      `json:"uri"`
	}
	options struct {
		debug       bool
		enablePprof bool
		httpAddr    string
	}
)

const (
	onJsonApiEventPrefixLen              = len(`[8,"OnJsonApiEvent",`)
	gameFlowChangedEvt          lcuWsEvt = "/lol-gameflow/v1/gameflow-phase"
	champSelectUpdateSessionEvt lcuWsEvt = "/lol-champ-select/v1/session"
)

// gameState
const (
	GameStateNone        GameState = "none"
	GameStateChampSelect GameState = "champSelect"
	GameStateReadyCheck  GameState = "ReadyCheck"
	GameStateInGame      GameState = "inGame"
	GameStateOther       GameState = "other"
)
const (
	acpGBK = 936
)

var (
	defaultOpts = &options{
		debug:       false,
		enablePprof: true,
		httpAddr:    ":4396",
	}
	errWebviewQuit = errors.New("webview quit")
)

func NewProphet(opts ...ApplyOption) *Prophet {
	ctx, cancel := context.WithCancel(context.Background())
	p := &Prophet{
		ctx:       ctx,
		cancel:    cancel,
		mu:        &sync.Mutex{},
		opts:      defaultOpts,
		GameState: GameStateNone,
	}
	if global.IsDevMode() {
		opts = append(opts, WithDebug())
	} else {
		opts = append(opts, WithProd())
	}
	p.api = &Api{p: p}
	for _, fn := range opts {
		fn(p.opts)
	}
	return p
}
func (p *Prophet) Run() error {
	go p.MonitorStart()
	go p.captureStartMessage()
	p.initGin()
	go p.initWebview()
	log.Printf("%så·²å¯åŠ¨ v%s -- %s", global.AppName, APPVersion, global.WebsiteTitle)
	return p.notifyQuit()
}
func (p *Prophet) isLcuActive() bool {
	return p.lcuActive
}
func (p *Prophet) Stop() error {
	if p.cancel != nil {
		p.cancel()
	}
	// stop all task
	return nil
}
func (p *Prophet) MonitorStart() {
	for {
		if !p.isLcuActive() {
			port, token, err := lcu.GetLolClientApiInfo()
			if err != nil {
				if !errors.Is(lcu.ErrLolProcessNotFound, err) {
					logger.Error("è·å–lcu info å¤±è´¥", zap.Error(err))
				}
				time.Sleep(time.Second)
				continue
			}
			p.initLcuClient(port, token)
			err = p.initGameFlowMonitor(port, token)
			if err != nil {
				logger.Debug("æ¸¸æˆæµç¨‹ç›‘è§†å™¨ err:", zap.Error(err))
			}
			p.lcuActive = false
			p.currSummoner = nil
		}
		time.Sleep(time.Second)
	}
}

func (p *Prophet) notifyQuit() error {
	interrupt := make(chan os.Signal, 1)
	signal.Notify(interrupt, os.Interrupt)
	g, c := errgroup.WithContext(p.ctx)
	// http
	g.Go(func() error {
		err := p.httpSrv.ListenAndServe()
		if err != nil || !errors.Is(err, http.ErrServerClosed) {
			return err
		}
		return nil
	})
	// http-shutdown
	g.Go(func() error {
		<-c.Done()
		ctx, cancel := context.WithTimeout(context.Background(), 1*time.Second)
		defer cancel()
		return p.httpSrv.Shutdown(ctx)
	})
	// wait quit
	g.Go(func() error {
		for {
			select {
			case <-p.ctx.Done():
				return p.ctx.Err()
			case <-interrupt:
				_ = p.Stop()
			}
		}
	})
	err := g.Wait()
	if err != nil && !errors.Is(err, context.Canceled) {
		return err
	}
	return nil
}
func (p *Prophet) initLcuClient(port int, token string) {
	lcu.InitCli(port, token)
}
func (p *Prophet) initGameFlowMonitor(port int, authPwd string) error {
	dialer := websocket.DefaultDialer
	dialer.TLSClientConfig = &tls.Config{
		InsecureSkipVerify: true,
	}
	rawUrl := fmt.Sprintf("wss://127.0.0.1:%d/", port)
	header := http.Header{}
	authSecret := base64.StdEncoding.EncodeToString([]byte(fmt.Sprintf("riot:%s", authPwd)))
	header.Set("Authorization", "Basic "+authSecret)
	u, _ := url.Parse(rawUrl)
	logger.Debug(fmt.Sprintf("connect to lcu %s", u.String()))
	c, _, err := dialer.Dial(u.String(), header)
	if err != nil {
		return err
	}
	defer c.Close()
	err = retry.Do(func() error {
		currSummoner, err := lcu.GetCurrSummoner()
		if err == nil {
			p.currSummoner = currSummoner
		}
		return err
	}, retry.Attempts(5), retry.Delay(time.Second))
	if err != nil {
		return errors.New("è·å–å½“å‰å¬å”¤å¸ˆä¿¡æ¯å¤±è´¥:" + err.Error())
	}
	p.lcuActive = true
	// if global.IsDevMode() {
	// 	p.ChampionSelectStart()
	// }

	_ = c.WriteMessage(websocket.TextMessage, []byte("[5, \"OnJsonApiEvent\"]"))
	for {
		msgType, message, err := c.ReadMessage()
		if err != nil {
			// log.Println("read:", err)
			logger.Debug("loläº‹ä»¶ç›‘æ§è¯»å–æ¶ˆæ¯å¤±è´¥", zap.Error(err))
			return err
		}
		msg := &wsMsg{}
		if msgType != websocket.TextMessage || len(message) < onJsonApiEventPrefixLen+1 {
			continue
		}
		_ = json.Unmarshal(message[onJsonApiEventPrefixLen:len(message)-1], msg)
		// log.Println("ws evt: ", msg.Uri)
		switch msg.Uri {
		case string(gameFlowChangedEvt):
			gameFlow, ok := msg.Data.(string)
			if !ok {
				continue
			}
			p.onGameFlowUpdate(gameFlow)
		case string(champSelectUpdateSessionEvt):
			bts, err := json.Marshal(msg.Data)
			if err != nil {
				continue
			}
			sessionInfo := &lcu.ChampSelectSessionInfo{}
			err = json.Unmarshal(bts, sessionInfo)
			if err != nil {
				log.Println("è§£æç»“æ„ä½“å¤±è´¥", err)
				continue
			}
			go func() {
				_ = p.onChampSelectSessionUpdate(sessionInfo)
			}()
		default:

		}

		// log.Printf("recv: %s", message)
	}
}
func (p *Prophet) onGameFlowUpdate(gameFlow string) {
	// clientCfg := global.GetClientConf()
	logger.Debug("åˆ‡æ¢çŠ¶æ€:" + gameFlow)
	switch gameFlow {
	case string(models.GameFlowChampionSelect):
		log.Println("è¿›å…¥è‹±é›„é€‰æ‹©é˜¶æ®µ,æ­£åœ¨è®¡ç®—ç”¨æˆ·åˆ†æ•°")
		sentry.CaptureMessage("è¿›å…¥è‹±é›„é€‰æ‹©é˜¶æ®µ,æ­£åœ¨è®¡ç®—ç”¨æˆ·åˆ†æ•°")
		p.updateGameState(GameStateChampSelect)
		go p.ChampionSelectStart()
	case string(models.GameFlowNone):
		p.updateGameState(GameStateNone)
	case string(models.GameFlowInProgress):
		p.updateGameState(GameStateInGame)
		go p.CalcEnemyTeamScore()
	case string(models.GameFlowReadyCheck):
		p.updateGameState(GameStateReadyCheck)
		clientCfg := global.GetClientConf()
		if clientCfg.AutoAcceptGame {
			go p.AcceptGame()
		}
	default:
		p.updateGameState(GameStateOther)
	}

}
func (p *Prophet) updateGameState(state GameState) {
	p.mu.Lock()
	p.GameState = state
	p.mu.Unlock()
}
func (p *Prophet) getGameState() GameState {
	p.mu.Lock()
	defer p.mu.Unlock()
	return p.GameState
}
func (p *Prophet) captureStartMessage() {
	for i := 0; i < 5; i++ {
		if global.GetUserInfo().IP != "" {
			break
		}
		time.Sleep(time.Second * 2)
	}
	sentry.CaptureMessage(global.AppName + "å·²å¯åŠ¨")
}
func (p *Prophet) initGin() {
	if p.opts.debug {
		gin.SetMode(gin.DebugMode)
	} else {
		gin.SetMode(gin.ReleaseMode)
	}
	engine := gin.New()
	engine.Use(gin.Recovery())
	engine.Use(gin.LoggerWithFormatter(ginApp.LogFormatter))
	if p.opts.enablePprof {
		pprof.RouteRegister(engine.Group(""))
	}
	engine.Use(ginApp.PrepareProc)
	engine.Use(sentryGin.New(sentryGin.Options{
		Repanic: true,
		Timeout: 3 * time.Second,
	}))
	engine.Use(ginApp.Cors())
	engine.Use(ginApp.ErrHandler)
	RegisterRoutes(engine, p.api)

	srv := &http.Server{
		Addr:    p.opts.httpAddr,
		Handler: engine,
	}
	p.httpSrv = srv
}
func (p *Prophet) initWebview() {
	clientCfg := global.GetClientConf()
	defaultUrl := "https://lol.buffge.com/dev/client?version=" + APPVersion
	websiteUrl := defaultUrl
	if clientCfg.ShouldAutoOpenBrowser != nil && !*clientCfg.ShouldAutoOpenBrowser {
		log.Println("è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨é€‰é¡¹å·²å…³é—­,æ‰‹åŠ¨æ‰“å¼€è¯·è®¿é—® " + websiteUrl)
		return
	}
	// windowWeight := 1000
	// windowHeight := 650

	cmd := exec.Command("cmd", "/c", "start", websiteUrl)
	_ = cmd.Run()
	log.Println("ç•Œé¢å·²åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€,è‹¥æœªæ‰“å¼€è¯·æ‰‹åŠ¨è®¿é—® " + websiteUrl)
	return
}
func (p Prophet) ChampionSelectStart() {
	clientCfg := global.GetClientConf()
	sendConversationMsgDelayCtx, cancel := context.WithTimeout(context.Background(),
		time.Second*time.Duration(clientCfg.ChooseChampSendMsgDelaySec))
	defer cancel()
	var conversationID string
	var summonerIDList []int64
	for i := 0; i < 3; i++ {
		time.Sleep(time.Second)
		// è·å–é˜Ÿä¼æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
		conversationID, summonerIDList, _ = getTeamUsers()
		if len(summonerIDList) != 5 {
			continue
		}
	}
	// if !false && global.IsDevMode() {
	// 	summonerIDList = []int64{2964390005, 4103784618, 4132401993, 4118593599, 4019221688}
	// 	// summonerIDList = []int64{4006944917}
	// }
	logger.Debug("é˜Ÿä¼äººå‘˜åˆ—è¡¨:", zap.Any("summonerIDList", summonerIDList))
	// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯å¹¶è®¡ç®—å¾—åˆ†
	g := errgroup.Group{}
	summonerIDMapScore := map[int64]lcu.UserScore{}
	mu := sync.Mutex{}
	for _, summonerID := range summonerIDList {
		summonerID := summonerID
		g.Go(func() error {
			actScore, err := GetUserScore(summonerID)
			if err != nil {
				logger.Error("è®¡ç®—ç”¨æˆ·å¾—åˆ†å¤±è´¥", zap.Error(err), zap.Int64("summonerID", summonerID))
				return nil
			}
			mu.Lock()
			summonerIDMapScore[summonerID] = *actScore
			mu.Unlock()
			return nil
		})
	}
	_ = g.Wait()
	// æ ¹æ®æ‰€æœ‰ç”¨æˆ·çš„åˆ†æ•°åˆ¤æ–­å°ä»£ä¸Šç­‰é©¬ä¸­ç­‰é©¬ä¸‹ç­‰é©¬
	for _, score := range summonerIDMapScore {
		log.Printf("ç”¨æˆ·:%s,å¾—åˆ†:%.2f\n", score.SummonerName, score.Score)
	}

	scoreCfg := global.GetScoreConf()
	allMsg := ""
	mergedMsg := ""
	// å‘é€åˆ°é€‰äººç•Œé¢
	for _, scoreInfo := range summonerIDMapScore {
		var horse string
		horseIdx := 0
		for i, v := range scoreCfg.Horse {
			if scoreInfo.Score >= v.Score {
				horse = clientCfg.HorseNameConf[i]
				horseIdx = i
				break
			}
		}
		currKDASb := strings.Builder{}
		for i := 0; i < 5 && i < len(scoreInfo.CurrKDA); i++ {
			currKDASb.WriteString(fmt.Sprintf("%d/%d/%d  ", scoreInfo.CurrKDA[i][0], scoreInfo.CurrKDA[i][1],
				scoreInfo.CurrKDA[i][2]))
		}
		currKDAMsg := currKDASb.String()
		if len(currKDAMsg) > 0 {
			currKDAMsg = currKDAMsg[:len(currKDAMsg)-1]
		}
		msg := fmt.Sprintf("%s(%d): %s %s  -- %s", horse, int(scoreInfo.Score), scoreInfo.SummonerName,
			currKDAMsg, global.AdaptChatWebsiteTitle)
		<-sendConversationMsgDelayCtx.Done()
		if clientCfg.AutoSendTeamHorse {
			mergedMsg += msg + "\n"
		}
		if !clientCfg.AutoSendTeamHorse {
			if !scoreCfg.MergeMsg && !clientCfg.ShouldSendSelfHorse && p.currSummoner != nil &&
				scoreInfo.SummonerID == p.currSummoner.SummonerId {
				continue
			}
			allMsg += msg + "\n"
			mergedMsg += msg + "\n"
			continue
		}
		if !clientCfg.ShouldSendSelfHorse && p.currSummoner != nil &&
			scoreInfo.SummonerID == p.currSummoner.SummonerId {
			continue
		}
		if !clientCfg.ChooseSendHorseMsg[horseIdx] {
			continue
		}
		if scoreCfg.MergeMsg {
			continue
		}
		_ = SendConversationMsg(msg, conversationID)
		time.Sleep(time.Millisecond * 1500)
	}
	if !clientCfg.AutoSendTeamHorse {
		log.Println("å·²å°†é˜Ÿä¼é©¬åŒ¹ä¿¡æ¯å¤åˆ¶åˆ°å‰ªåˆ‡æ¿")
		_ = clipboard.WriteAll(allMsg)
		return
	}
	if scoreCfg.MergeMsg {
		_ = SendConversationMsg(mergedMsg, conversationID)
	}
}
func (p Prophet) AcceptGame() {
	_ = lcu.AcceptGame()
}
func (p Prophet) CalcEnemyTeamScore() {
	// è·å–å½“å‰æ¸¸æˆè¿›ç¨‹
	session, err := lcu.QueryGameFlowSession()
	if err != nil {
		return
	}
	if session.Phase != models.GameFlowInProgress {
		return
	}
	if p.currSummoner == nil {
		return
	}
	selfID := p.currSummoner.SummonerId
	selfTeamUsers, enemyTeamUsers := getAllUsersFromSession(selfID, session)
	_ = selfTeamUsers
	summonerIDList := enemyTeamUsers
	// if !false && global.IsDevMode() {
	// 	summonerIDList = []int64{2964390005, 4103784618, 4132401993, 4118593599, 4019221688}
	// 	// summonerIDList = []int64{4006944917}
	// }
	logger.Debug("æ•Œæ–¹é˜Ÿä¼äººå‘˜åˆ—è¡¨:", zap.Any("summonerIDList", summonerIDList))
	if len(summonerIDList) == 0 {
		return
	}
	// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯å¹¶è®¡ç®—å¾—åˆ†
	g := errgroup.Group{}
	summonerIDMapScore := map[int64]lcu.UserScore{}
	mu := sync.Mutex{}
	for _, summonerID := range summonerIDList {
		summonerID := summonerID
		g.Go(func() error {
			actScore, err := GetUserScore(summonerID)
			if err != nil {
				logger.Error("è®¡ç®—ç”¨æˆ·å¾—åˆ†å¤±è´¥", zap.Error(err), zap.Int64("summonerID", summonerID))
				return nil
			}
			mu.Lock()
			summonerIDMapScore[summonerID] = *actScore
			mu.Unlock()
			return nil
		})
	}
	_ = g.Wait()
	// æ ¹æ®æ‰€æœ‰ç”¨æˆ·çš„åˆ†æ•°åˆ¤æ–­å°ä»£ä¸Šç­‰é©¬ä¸­ç­‰é©¬ä¸‹ç­‰é©¬
	for _, score := range summonerIDMapScore {
		currKDASb := strings.Builder{}
		for i := 0; i < 5 && i < len(score.CurrKDA); i++ {
			currKDASb.WriteString(fmt.Sprintf("%d/%d/%d  ", score.CurrKDA[i][0], score.CurrKDA[i][1],
				score.CurrKDA[i][2]))
		}
		currKDAMsg := currKDASb.String()
		log.Printf("æ•Œæ–¹ç”¨æˆ·:%s,å¾—åˆ†:%.2f,kda:%s\n", score.SummonerName, score.Score, currKDAMsg)
	}
	clientCfg := global.GetClientConf()
	scoreCfg := global.GetScoreConf()
	allMsg := ""
	// å‘é€åˆ°é€‰äººç•Œé¢
	for _, scoreInfo := range summonerIDMapScore {
		time.Sleep(time.Second / 2)
		var horse string
		// horseIdx := 0
		for i, v := range scoreCfg.Horse {
			if scoreInfo.Score >= v.Score {
				horse = clientCfg.HorseNameConf[i]
				// horseIdx = i
				break
			}
		}
		currKDASb := strings.Builder{}
		for i := 0; i < 5 && i < len(scoreInfo.CurrKDA); i++ {
			currKDASb.WriteString(fmt.Sprintf("%d/%d/%d  ", scoreInfo.CurrKDA[i][0], scoreInfo.CurrKDA[i][1],
				scoreInfo.CurrKDA[i][2]))
		}
		currKDAMsg := currKDASb.String()
		if len(currKDAMsg) > 0 {
			currKDAMsg = currKDAMsg[:len(currKDAMsg)-1]
		}
		msg := fmt.Sprintf("%s(%d): %s %s  -- %s", horse, int(scoreInfo.Score), scoreInfo.SummonerName,
			currKDAMsg, global.AdaptChatWebsiteTitle)
		allMsg += msg + "\n"
	}
	_ = clipboard.WriteAll(allMsg)
}

func (p Prophet) onChampSelectSessionUpdate(sessionInfo *lcu.ChampSelectSessionInfo) error {
	isSelfPick := false
	isSelfBan := false
	userActionID := 0
	if len(sessionInfo.Actions) == 0 {
		return nil
	}
loop:
	for _, actions := range sessionInfo.Actions {
		for _, action := range actions {
			if action.ActorCellId == sessionInfo.LocalPlayerCellId && action.IsInProgress {
				userActionID = action.Id
				if action.Type == lcu.ChampSelectPatchTypePick {
					isSelfPick = true
					break loop
				} else if action.Type == lcu.ChampSelectPatchTypeBan {
					isSelfBan = true
					break loop
				}
			}
		}
	}
	clientCfg := global.GetClientConf()
	if clientCfg.AutoPickChampID > 0 && isSelfPick {
		_ = lcu.PickChampion(clientCfg.AutoPickChampID, userActionID)
	}
	if clientCfg.AutoBanChampID > 0 && isSelfBan {
		_ = lcu.BanChampion(clientCfg.AutoBanChampID, userActionID)
	}
	return nil
}

```

`routes.go`:

```go
package hh_lol_prophet

import (
	"github.com/gin-gonic/gin"

	"github.com/real-web-world/hh-lol-prophet/services/ws"
)

func RegisterRoutes(r *gin.Engine, api *Api) {
	r.Any("test", api.DevHand)
	r.GET("ws", func(c *gin.Context) {
		ws.ServeWs(ws.ServerHub, c.Writer, c.Request)
	})
	initV1Module(r, api)
}

func initV1Module(r *gin.Engine, api *Api) {
	v1 := r.Group("v1")
	// æŸ¥è¯¢ç”¨æˆ·é©¬åŒ¹ä¿¡æ¯
	v1.POST("horse/queryBySummonerName", api.ProphetActiveMid, api.QueryHorseBySummonerName)
	// è·å–æ‰€æœ‰é…ç½®
	v1.POST("config/getAll", api.GetAllConf)
	// æ›´æ–°é…ç½®
	v1.POST("config/update", api.UpdateClientConf)
	// è·å–lcuè®¤è¯ä¿¡æ¯
	v1.POST("lcu/getAuthInfo", api.GetLcuAuthInfo)
	// è·å–appä¿¡æ¯
	v1.POST("app/getInfo", api.GetAppInfo)
	// å¤åˆ¶é©¬åŒ¹ä¿¡æ¯åˆ°å‰ªåˆ‡æ¿
	v1.POST("horse/copyHorseMsgToClipBoard", api.CopyHorseMsgToClipBoard)
}

```

`services/buffApi/update.go`:

```go
package buffApi

import (
	"encoding/json"
	"io"
	"net/http"
	"time"

	"github.com/real-web-world/hh-lol-prophet/conf"
)

var (
	client  *http.Client
	baseUrl string
)

func Init(url string, timeoutSec int) {
	client = &http.Client{
		Timeout: time.Duration(timeoutSec) * time.Second,
	}
	baseUrl = url
}
func GetCurrConf() (*conf.CalcScoreConf, error) {
	resp, err := client.Get(baseUrl + "/api/currConf.json")
	if err != nil {
		return nil, err
	}
	defer resp.Body.Close()
	bts, _ := io.ReadAll(resp.Body)
	scoreConf := &conf.CalcScoreConf{}
	err = json.Unmarshal(bts, scoreConf)
	if err != nil {
		return nil, err
	}
	return scoreConf, nil
}

```

`services/db/models/Config.go`:

```go
package models

import (
	"context"

	"github.com/real-web-world/hh-lol-prophet/global"
	"gorm.io/gorm"
)

type (
	Config struct {
		ID  int64           `json:"id" gorm:"primaryKey"`
		Key string          `json:"key" gorm:"column:k"`
		Val string          `json:"val" gorm:"column:v"`
		Ctx context.Context `json:"-" gorm:"-"`
	}
)

const (
	LocalClientConfKey = "localClient"
	InitLocalClientSql = `
create table config
(
    id integer     not null
        constraint config_pk
            primary key autoincrement,
    k  varchar(32) not null,
    v  TEXT        not null
);
create unique index config_k_uindex
    on config (k);
INSERT INTO config (k, v)
VALUES (?, ?);
`
)

func (m Config) TableName() string {
	return "config"
}
func (m Config) GetGormQuery() *gorm.DB {
	db := global.SqliteDB
	if m.Ctx != nil {
		db = db.WithContext(m.Ctx)
	}
	return db.Model(m)
}
func (m Config) Update(k, v string) error {
	return m.GetGormQuery().Where("k = ?", k).Update("v", v).Error
}

```

`services/lcu/api.go`:

```go
package lcu

import (
	"context"
	"encoding/json"
	"fmt"
	"strconv"
	"strings"
	"time"

	"github.com/pkg/errors"
	"go.uber.org/zap"
	"golang.org/x/time/rate"

	"github.com/real-web-world/hh-lol-prophet/services/lcu/models"

	"github.com/real-web-world/hh-lol-prophet/services/logger"
)

type (
	// æ¯å•ä½çš„æ•°æ®
	PerMinDeltas struct {
		Ten    float64 `json:"0-10"`
		Twenty float64 `json:"10-20"`
		Thirty float64 `json:"20-30"`
		Forty  float64 `json:"30-40"`
		Fifty  float64 `json:"40-50"`
		Sixty  float64 `json:"50-60"`
	}
)
type (
	ChampSelectPatchType string // è‹±é›„é€‰æ‹©ä¼šè¯æ›´æ–°ç±»å‹
	ConversationMsgType  string // ä¼šè¯ç»„æ¶ˆæ¯ç±»å‹
)

type (
	CommonResp struct {
		ErrorCode  string `json:"errorCode"`
		HttpStatus int    `json:"httpStatus"`
		Message    string `json:"message"`
	}
	CurrSummoner struct {
		AccountId                   int64  `json:"accountId"`
		DisplayName                 string `json:"displayName"`
		InternalName                string `json:"internalName"`
		NameChangeFlag              bool   `json:"nameChangeFlag"`
		PercentCompleteForNextLevel int    `json:"percentCompleteForNextLevel"`
		ProfileIconId               int    `json:"profileIconId"`
		Puuid                       string `json:"puuid"`
		RerollPoints                struct {
			CurrentPoints    int `json:"currentPoints"`
			MaxRolls         int `json:"maxRolls"`
			NumberOfRolls    int `json:"numberOfRolls"`
			PointsCostToRoll int `json:"pointsCostToRoll"`
			PointsToReroll   int `json:"pointsToReroll"`
		} `json:"rerollPoints"`
		SummonerId       int64 `json:"summonerId"`
		SummonerLevel    int   `json:"summonerLevel"`
		Unnamed          bool  `json:"unnamed"`
		XpSinceLastLevel int   `json:"xpSinceLastLevel"`
		XpUntilNextLevel int   `json:"xpUntilNextLevel"`
	}
	GameListResp struct {
		CommonResp
		AccountID int64    `json:"accountId"`
		Games     GameList `json:"games"`
	}
	GameList struct {
		GameBeginDate  string     `json:"gameBeginDate"`
		GameCount      int        `json:"gameCount"`
		GameEndDate    string     `json:"gameEndDate"`
		GameIndexBegin int        `json:"gameIndexBegin"`
		GameIndexEnd   int        `json:"gameIndexEnd"`
		Games          []GameInfo `json:"games"`
	}
	GameInfo struct {
		GameCreation          int64           `json:"gameCreation"` // åˆ›å»ºæ—¶é—´æˆ³ ms
		GameCreationDate      time.Time       `json:"gameCreationDate"`
		GameDuration          int             `json:"gameDuration"` // æ¸¸æˆæŒç»­æ—¶é•¿ ç§’
		GameId                int64           `json:"gameId"`
		GameMode              models.GameMode `json:"gameMode"`
		GameType              models.GameType `json:"gameType"`
		GameVersion           string          `json:"gameVersion"`
		MapId                 int             `json:"mapId"` // åœ°å›¾id
		ParticipantIdentities []struct {      // å‚ä¸è€…
			ParticipantId int      `json:"participantId"` // å‚ä¸è€…id
			Player        struct { // ç©å®¶ä¿¡æ¯
				AccountId         int64  `json:"accountId"`         // è´¦å·id
				CurrentAccountId  int64  `json:"currentAccountId"`  // å½“å‰è´¦å·id
				CurrentPlatformId string `json:"currentPlatformId"` // å½“å‰å¹³å°id
				MatchHistoryUri   string `json:"matchHistoryUri"`   // åŒ¹é…åŠ£åŠ¿url
				PlatformId        string `json:"platformId"`        // å¹³å°id
				ProfileIcon       int    `json:"profileIcon"`       // å¤´åƒicon
				SummonerId        int64  `json:"summonerId"`        // å¬å”¤å¸ˆid
				SummonerName      string `json:"summonerName"`      // å¬å”¤å¸ˆåç§°
			} `json:"player"`
		} `json:"participantIdentities"`
		Participants []struct { // å‚ä¸è€…è¯¦ç»†ä¿¡æ¯
			ChampionId                models.Champion `json:"championId"` // è‹±é›„id
			HighestAchievedSeasonTier string          `json:"highestAchievedSeasonTier"`
			ParticipantId             int             `json:"participantId"`
			Spell1Id                  models.Spell    `json:"spell1Id"` // å¬å”¤å¸ˆæŠ€èƒ½1
			Spell2Id                  models.Spell    `json:"spell2Id"` // å¬å”¤å¸ˆæŠ€èƒ½2
			Stats                     struct {
				Assists                         int  `json:"assists"`                   // åŠ©æ”»æ•°
				CausedEarlySurrender            bool `json:"causedEarlySurrender"`      // æ˜¯å¦ç”³è¯·äº†æå‰æŠ•é™
				ChampLevel                      int  `json:"champLevel"`                // å¬å”¤å¸ˆç­‰çº§
				CombatPlayerScore               int  `json:"combatPlayerScore"`         //
				DamageDealtToObjectives         int  `json:"damageDealtToObjectives"`   // å¯¹æˆ˜ç•¥ç‚¹çš„æ€»ä¼¤å®³
				DamageDealtToTurrets            int  `json:"damageDealtToTurrets"`      // å¯¹é˜²å¾¡å¡”çš„æ€»ä¼¤å®³
				DamageSelfMitigated             int  `json:"damageSelfMitigated"`       // è‡ªæˆ‘ç¼“å’Œçš„ç”Ÿå‘½å€¼
				Deaths                          int  `json:"deaths"`                    // æ­»äº¡æ¬¡æ•°
				DoubleKills                     int  `json:"doubleKills"`               // åŒæ€æ¬¡æ•°
				EarlySurrenderAccomplice        bool `json:"earlySurrenderAccomplice"`  // æ˜¯å¦åŒæ„äº†æå‰æŠ•é™
				FirstBloodAssist                bool `json:"firstBloodAssist"`          // æ˜¯å¦åŠ©æ”»äº†ä¸€è¡€
				FirstBloodKill                  bool `json:"firstBloodKill"`            // æ˜¯å¦è·å¾—äº†ä¸€è¡€
				FirstInhibitorAssist            bool `json:"firstInhibitorAssist"`      // æ˜¯å¦åŠ©æ”»äº†æ‘§æ¯ç¬¬ä¸€ä¸ªæ°´æ™¶
				FirstInhibitorKill              bool `json:"firstInhibitorKill"`        // æ˜¯å¦æ‘§æ¯äº†æ‘§æ¯ç¬¬ä¸€ä¸ªæ°´æ™¶
				FirstTowerAssist                bool `json:"firstTowerAssist"`          // æ˜¯å¦åŠ©æ”»äº†æ‘§æ¯ä¸€å¡”
				FirstTowerKill                  bool `json:"firstTowerKill"`            // æ˜¯å¦æ‘§æ¯äº†ä¸€å¡”
				GameEndedInEarlySurrender       bool `json:"gameEndedInEarlySurrender"` // æ¸¸æˆæ˜¯å¦ç”±æå‰æŠ•é™ç»“æŸçš„
				GameEndedInSurrender            bool `json:"gameEndedInSurrender"`      // æ¸¸æˆæ˜¯ç”±æŠ•é™ç»“æŸçš„
				GoldEarned                      int  `json:"goldEarned"`                // é‡‘å¸è·å–
				GoldSpent                       int  `json:"goldSpent"`                 // é‡‘å¸ä½¿ç”¨
				InhibitorKills                  int  `json:"inhibitorKills"`            // æ‘§æ¯æ°´æ™¶æ•°
				Item0                           int  `json:"item0"`                     // ç‰©å“1
				Item1                           int  `json:"item1"`
				Item2                           int  `json:"item2"`
				Item3                           int  `json:"item3"`
				Item4                           int  `json:"item4"`
				Item5                           int  `json:"item5"`
				Item6                           int  `json:"item6"`
				KillingSprees                   int  `json:"killingSprees"`                   // å¤šæ€
				Kills                           int  `json:"kills"`                           // å‡»æ€
				LargestCriticalStrike           int  `json:"largestCriticalStrike"`           // æœ€å¤§æš´å‡»ä¼¤å®³
				LargestKillingSpree             int  `json:"largestKillingSpree"`             // æœ€é«˜è¿æ€
				LargestMultiKill                int  `json:"largestMultiKill"`                // å¤šæ€æ¬¡æ•°
				LongestTimeSpentLiving          int  `json:"longestTimeSpentLiving"`          // æœ€é•¿å­˜æ´»æ—¶é—´
				MagicDamageDealt                int  `json:"magicDamageDealt"`                // é€ æˆçš„é­”æ³•ä¼¤å®³
				MagicDamageDealtToChampions     int  `json:"magicDamageDealtToChampions"`     // å¯¹è‹±é›„é€ æˆçš„é­”æ³•ä¼¤å®³
				MagicalDamageTaken              int  `json:"magicalDamageTaken"`              // æ‰¿å—çš„é­”æ³•ä¼¤å®³
				NeutralMinionsKilled            int  `json:"neutralMinionsKilled"`            // å‡»æ€é‡æ€ª
				NeutralMinionsKilledEnemyJungle int  `json:"neutralMinionsKilledEnemyJungle"` // å‡»æ€æ•Œæ–¹é‡æ€ª
				NeutralMinionsKilledTeamJungle  int  `json:"neutralMinionsKilledTeamJungle"`  // å‡»æ€é˜Ÿä¼é‡æ€ª
				ObjectivePlayerScore            int  `json:"objectivePlayerScore"`            //
				ParticipantId                   int  `json:"participantId"`
				PentaKills                      int  `json:"pentaKills"`
				Perk0                           int  `json:"perk0"`
				Perk0Var1                       int  `json:"perk0Var1"`
				Perk0Var2                       int  `json:"perk0Var2"`
				Perk0Var3                       int  `json:"perk0Var3"`
				Perk1                           int  `json:"perk1"`
				Perk1Var1                       int  `json:"perk1Var1"`
				Perk1Var2                       int  `json:"perk1Var2"`
				Perk1Var3                       int  `json:"perk1Var3"`
				Perk2                           int  `json:"perk2"`
				Perk2Var1                       int  `json:"perk2Var1"`
				Perk2Var2                       int  `json:"perk2Var2"`
				Perk2Var3                       int  `json:"perk2Var3"`
				Perk3                           int  `json:"perk3"`
				Perk3Var1                       int  `json:"perk3Var1"`
				Perk3Var2                       int  `json:"perk3Var2"`
				Perk3Var3                       int  `json:"perk3Var3"`
				Perk4                           int  `json:"perk4"`
				Perk4Var1                       int  `json:"perk4Var1"`
				Perk4Var2                       int  `json:"perk4Var2"`
				Perk4Var3                       int  `json:"perk4Var3"`
				Perk5                           int  `json:"perk5"`
				Perk5Var1                       int  `json:"perk5Var1"`
				Perk5Var2                       int  `json:"perk5Var2"`
				Perk5Var3                       int  `json:"perk5Var3"`
				PerkPrimaryStyle                int  `json:"perkPrimaryStyle"`
				PerkSubStyle                    int  `json:"perkSubStyle"`
				PhysicalDamageDealt             int  `json:"physicalDamageDealt"`            // é€ æˆçš„ç‰©ç†ä¼¤å®³
				PhysicalDamageDealtToChampions  int  `json:"physicalDamageDealtToChampions"` // å¯¹è‹±é›„é€ æˆçš„ç‰©ç†ä¼¤å®³
				PhysicalDamageTaken             int  `json:"physicalDamageTaken"`            // å—åˆ°çš„ç‰©ç†ä¼¤å®³
				PlayerScore0                    int  `json:"playerScore0"`
				PlayerScore1                    int  `json:"playerScore1"`
				PlayerScore2                    int  `json:"playerScore2"`
				PlayerScore3                    int  `json:"playerScore3"`
				PlayerScore4                    int  `json:"playerScore4"`
				PlayerScore5                    int  `json:"playerScore5"`
				PlayerScore6                    int  `json:"playerScore6"`
				PlayerScore7                    int  `json:"playerScore7"`
				PlayerScore8                    int  `json:"playerScore8"`
				PlayerScore9                    int  `json:"playerScore9"`
				QuadraKills                     int  `json:"quadraKills"`            // å››æ€æ¬¡æ•°
				SightWardsBoughtInGame          int  `json:"sightWardsBoughtInGame"` //
				TeamEarlySurrendered            bool `json:"teamEarlySurrendered"`   // é˜Ÿä¼æ˜¯å¦æå‰æŠ•é™
				TimeCCingOthers                 int  `json:"timeCCingOthers"`
				TotalDamageDealt                int  `json:"totalDamageDealt"`            // é€ æˆçš„ä¼¤å®³æ€»å’Œ
				TotalDamageDealtToChampions     int  `json:"totalDamageDealtToChampions"` // å¯¹è‹±é›„é€ æˆçš„ä¼¤å®³æ€»å’Œ
				TotalDamageTaken                int  `json:"totalDamageTaken"`            // å¯¹é˜²å¾¡å¡”é€ æˆçš„ä¼¤å®³æ€»å’Œ
				TotalHeal                       int  `json:"totalHeal"`                   // æ²»ç–—ä¼¤å®³
				TotalMinionsKilled              int  `json:"totalMinionsKilled"`          // å‡»æ€å°å…µæ•°
				TotalPlayerScore                int  `json:"totalPlayerScore"`
				TotalScoreRank                  int  `json:"totalScoreRank"`
				TotalTimeCrowdControlDealt      int  `json:"totalTimeCrowdControlDealt"` // æ€»æ§åˆ¶æ—¶é•¿
				TotalUnitsHealed                int  `json:"totalUnitsHealed"`           //
				TripleKills                     int  `json:"tripleKills"`                // ä¸‰æ€æ¬¡æ•°
				TrueDamageDealt                 int  `json:"trueDamageDealt"`            //  æ€»çœŸå®ä¼¤å®³
				TrueDamageDealtToChampions      int  `json:"trueDamageDealtToChampions"` // å¯¹è‹±é›„çš„æ€»çœŸå®ä¼¤å®³
				TrueDamageTaken                 int  `json:"trueDamageTaken"`            // å¯¹é˜²å¾¡å¡”çš„çœŸå®ä¼¤å®³
				TurretKills                     int  `json:"turretKills"`                // å‡»æ€é˜²å¾¡å¡”
				UnrealKills                     int  `json:"unrealKills"`                // æ‘§æ¯æ°´æ™¶
				VisionScore                     int  `json:"visionScore"`                // è§†é‡å¾—åˆ†
				VisionWardsBoughtInGame         int  `json:"visionWardsBoughtInGame"`    // è´­ä¹°æ§åˆ¶å®ˆå«
				WardsKilled                     int  `json:"wardsKilled"`                // å‡»æ€å®ˆå«
				WardsPlaced                     int  `json:"wardsPlaced"`                // æ”¾ç½®å®ˆå«
				Win                             bool `json:"win"`                        // æ˜¯å¦è·èƒœ
			} `json:"stats"`
			TeamId   int `json:"teamId"`
			Timeline struct {
				CreepsPerMinDeltas          PerMinDeltas `json:"creepsPerMinDeltas"` // æ¯å•ä½(åˆ†é’Ÿ)ç§»åŠ¨ç æ•°(ä¼°è®¡æ˜¯åƒç )
				CsDiffPerMinDeltas          PerMinDeltas `json:"csDiffPerMinDeltas"`
				DamageTakenDiffPerMinDeltas PerMinDeltas `json:"damageTakenDiffPerMinDeltas"` // æ¯å•ä½å—åˆ°ä¼¤å®³å·®è·
				DamageTakenPerMinDeltas     PerMinDeltas `json:"damageTakenPerMinDeltas"`     // æ¯å•ä½å—åˆ°ä¼¤å®³
				GoldPerMinDeltas            PerMinDeltas `json:"goldPerMinDeltas"`            // æ¯å•ä½è·å¾—é‡‘å¸
				Lane                        string       `json:"lane"`                        // å“ªä¸€è·¯
				ParticipantId               int          `json:"participantId"`               // å‚ä¸è€…id
				Role                        string       `json:"role"`                        // è§’è‰²
				XpDiffPerMinDeltas          PerMinDeltas `json:"xpDiffPerMinDeltas"`          // æ¯å•ä½ç»éªŒå·®è·
				XpPerMinDeltas              PerMinDeltas `json:"xpPerMinDeltas"`              // æ¯å•ä½ç»éªŒæ•°
			} `json:"timeline"`
		} `json:"participants"`
		PlatformId string             `json:"platformId"` // å¹³å°id
		QueueId    models.GameQueueID `json:"queueId"`    // é˜Ÿåˆ—id
		SeasonId   int                `json:"seasonId"`
		Teams      []interface{}      `json:"teams"`
	}
	// èŠå¤©ç»„
	Conversation struct {
		GameName           string            `json:"gameName"`
		GameTag            string            `json:"gameTag"`
		Id                 string            `json:"id"`
		InviterId          string            `json:"inviterId"`
		IsMuted            bool              `json:"isMuted"`
		LastMessage        interface{}       `json:"lastMessage"`
		Name               string            `json:"name"`
		Password           string            `json:"password"`
		Pid                string            `json:"pid"`
		TargetRegion       string            `json:"targetRegion"`
		Type               models.GameStatus `json:"type"`
		UnreadMessageCount int               `json:"unreadMessageCount"`
	}
	ConversationMsg struct {
		Body           string              `json:"body"`
		FromId         string              `json:"fromId"`
		FromPid        string              `json:"fromPid"`
		FromSummonerId int64               `json:"fromSummonerId"`
		Id             string              `json:"id"`
		IsHistorical   bool                `json:"isHistorical"`
		Timestamp      time.Time           `json:"timestamp"`
		Type           ConversationMsgType `json:"type"`
	}
	Summoner struct {
		CommonResp
		AccountId                   int64  `json:"accountId"`
		DisplayName                 string `json:"displayName"`
		InternalName                string `json:"internalName"`
		NameChangeFlag              bool   `json:"nameChangeFlag"`
		PercentCompleteForNextLevel int    `json:"percentCompleteForNextLevel"`
		Privacy                     string `json:"privacy"`
		ProfileIconId               int    `json:"profileIconId"`
		Puuid                       string `json:"puuid"`
		RerollPoints                struct {
			CurrentPoints    int `json:"currentPoints"`
			MaxRolls         int `json:"maxRolls"`
			NumberOfRolls    int `json:"numberOfRolls"`
			PointsCostToRoll int `json:"pointsCostToRoll"`
			PointsToReroll   int `json:"pointsToReroll"`
		} `json:"rerollPoints"`
		SummonerId       int64 `json:"summonerId"`
		SummonerLevel    int   `json:"summonerLevel"`
		Unnamed          bool  `json:"unnamed"`
		XpSinceLastLevel int   `json:"xpSinceLastLevel"`
		XpUntilNextLevel int   `json:"xpUntilNextLevel"`
	}
	Participant struct {
		ChampionId                int    `json:"championId"`
		HighestAchievedSeasonTier string `json:"highestAchievedSeasonTier"`
		ParticipantId             int    `json:"participantId"`
		Spell1Id                  int    `json:"spell1Id"`
		Spell2Id                  int    `json:"spell2Id"`
		Stats                     struct {
			Assists                         int  `json:"assists"`
			CausedEarlySurrender            bool `json:"causedEarlySurrender"`
			ChampLevel                      int  `json:"champLevel"`
			CombatPlayerScore               int  `json:"combatPlayerScore"`
			DamageDealtToObjectives         int  `json:"damageDealtToObjectives"`
			DamageDealtToTurrets            int  `json:"damageDealtToTurrets"`
			DamageSelfMitigated             int  `json:"damageSelfMitigated"`
			Deaths                          int  `json:"deaths"`
			DoubleKills                     int  `json:"doubleKills"`
			EarlySurrenderAccomplice        bool `json:"earlySurrenderAccomplice"`
			FirstBloodAssist                bool `json:"firstBloodAssist"`
			FirstBloodKill                  bool `json:"firstBloodKill"`
			FirstInhibitorAssist            bool `json:"firstInhibitorAssist"`
			FirstInhibitorKill              bool `json:"firstInhibitorKill"`
			FirstTowerAssist                bool `json:"firstTowerAssist"`
			FirstTowerKill                  bool `json:"firstTowerKill"`
			GameEndedInEarlySurrender       bool `json:"gameEndedInEarlySurrender"`
			GameEndedInSurrender            bool `json:"gameEndedInSurrender"`
			GoldEarned                      int  `json:"goldEarned"`
			GoldSpent                       int  `json:"goldSpent"`
			InhibitorKills                  int  `json:"inhibitorKills"`
			Item0                           int  `json:"item0"`
			Item1                           int  `json:"item1"`
			Item2                           int  `json:"item2"`
			Item3                           int  `json:"item3"`
			Item4                           int  `json:"item4"`
			Item5                           int  `json:"item5"`
			Item6                           int  `json:"item6"`
			KillingSprees                   int  `json:"killingSprees"`
			Kills                           int  `json:"kills"`
			LargestCriticalStrike           int  `json:"largestCriticalStrike"`
			LargestKillingSpree             int  `json:"largestKillingSpree"`
			LargestMultiKill                int  `json:"largestMultiKill"`
			LongestTimeSpentLiving          int  `json:"longestTimeSpentLiving"`
			MagicDamageDealt                int  `json:"magicDamageDealt"`
			MagicDamageDealtToChampions     int  `json:"magicDamageDealtToChampions"`
			MagicalDamageTaken              int  `json:"magicalDamageTaken"`
			NeutralMinionsKilled            int  `json:"neutralMinionsKilled"`
			NeutralMinionsKilledEnemyJungle int  `json:"neutralMinionsKilledEnemyJungle"`
			NeutralMinionsKilledTeamJungle  int  `json:"neutralMinionsKilledTeamJungle"`
			ObjectivePlayerScore            int  `json:"objectivePlayerScore"`
			ParticipantId                   int  `json:"participantId"`
			PentaKills                      int  `json:"pentaKills"`
			Perk0                           int  `json:"perk0"`
			Perk0Var1                       int  `json:"perk0Var1"`
			Perk0Var2                       int  `json:"perk0Var2"`
			Perk0Var3                       int  `json:"perk0Var3"`
			Perk1                           int  `json:"perk1"`
			Perk1Var1                       int  `json:"perk1Var1"`
			Perk1Var2                       int  `json:"perk1Var2"`
			Perk1Var3                       int  `json:"perk1Var3"`
			Perk2                           int  `json:"perk2"`
			Perk2Var1                       int  `json:"perk2Var1"`
			Perk2Var2                       int  `json:"perk2Var2"`
			Perk2Var3                       int  `json:"perk2Var3"`
			Perk3                           int  `json:"perk3"`
			Perk3Var1                       int  `json:"perk3Var1"`
			Perk3Var2                       int  `json:"perk3Var2"`
			Perk3Var3                       int  `json:"perk3Var3"`
			Perk4                           int  `json:"perk4"`
			Perk4Var1                       int  `json:"perk4Var1"`
			Perk4Var2                       int  `json:"perk4Var2"`
			Perk4Var3                       int  `json:"perk4Var3"`
			Perk5                           int  `json:"perk5"`
			Perk5Var1                       int  `json:"perk5Var1"`
			Perk5Var2                       int  `json:"perk5Var2"`
			Perk5Var3                       int  `json:"perk5Var3"`
			PerkPrimaryStyle                int  `json:"perkPrimaryStyle"`
			PerkSubStyle                    int  `json:"perkSubStyle"`
			PhysicalDamageDealt             int  `json:"physicalDamageDealt"`
			PhysicalDamageDealtToChampions  int  `json:"physicalDamageDealtToChampions"`
			PhysicalDamageTaken             int  `json:"physicalDamageTaken"`
			PlayerScore0                    int  `json:"playerScore0"`
			PlayerScore1                    int  `json:"playerScore1"`
			PlayerScore2                    int  `json:"playerScore2"`
			PlayerScore3                    int  `json:"playerScore3"`
			PlayerScore4                    int  `json:"playerScore4"`
			PlayerScore5                    int  `json:"playerScore5"`
			PlayerScore6                    int  `json:"playerScore6"`
			PlayerScore7                    int  `json:"playerScore7"`
			PlayerScore8                    int  `json:"playerScore8"`
			PlayerScore9                    int  `json:"playerScore9"`
			QuadraKills                     int  `json:"quadraKills"`
			SightWardsBoughtInGame          int  `json:"sightWardsBoughtInGame"`
			TeamEarlySurrendered            bool `json:"teamEarlySurrendered"`
			TimeCCingOthers                 int  `json:"timeCCingOthers"`
			TotalDamageDealt                int  `json:"totalDamageDealt"`
			TotalDamageDealtToChampions     int  `json:"totalDamageDealtToChampions"`
			TotalDamageTaken                int  `json:"totalDamageTaken"`
			TotalHeal                       int  `json:"totalHeal"`
			TotalMinionsKilled              int  `json:"totalMinionsKilled"`
			TotalPlayerScore                int  `json:"totalPlayerScore"`
			TotalScoreRank                  int  `json:"totalScoreRank"`
			TotalTimeCrowdControlDealt      int  `json:"totalTimeCrowdControlDealt"`
			TotalUnitsHealed                int  `json:"totalUnitsHealed"`
			TripleKills                     int  `json:"tripleKills"`
			TrueDamageDealt                 int  `json:"trueDamageDealt"`
			TrueDamageDealtToChampions      int  `json:"trueDamageDealtToChampions"`
			TrueDamageTaken                 int  `json:"trueDamageTaken"`
			TurretKills                     int  `json:"turretKills"`
			UnrealKills                     int  `json:"unrealKills"`
			VisionScore                     int  `json:"visionScore"`
			VisionWardsBoughtInGame         int  `json:"visionWardsBoughtInGame"`
			WardsKilled                     int  `json:"wardsKilled"`
			WardsPlaced                     int  `json:"wardsPlaced"`
			Win                             bool `json:"win"`
		} `json:"stats"`
		TeamId   models.TeamID `json:"teamId"`
		Timeline struct {
			CreepsPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"creepsPerMinDeltas"`
			CsDiffPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"csDiffPerMinDeltas"`
			DamageTakenDiffPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"damageTakenDiffPerMinDeltas"`
			DamageTakenPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"damageTakenPerMinDeltas"`
			GoldPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"goldPerMinDeltas"`
			Lane               models.Lane         `json:"lane"`
			ParticipantId      int                 `json:"participantId"`
			Role               models.ChampionRole `json:"role"`
			XpDiffPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"xpDiffPerMinDeltas"`
			XpPerMinDeltas struct {
				Field1 float64 `json:"0-10"`
				Field2 float64 `json:"10-20"`
			} `json:"xpPerMinDeltas"`
		} `json:"timeline"`
	}
	GameSummary struct {
		CommonResp
		GameCreation          int64           `json:"gameCreation"`
		GameCreationDate      time.Time       `json:"gameCreationDate"`
		GameDuration          int             `json:"gameDuration"`
		GameId                int64           `json:"gameId"`
		GameMode              models.GameMode `json:"gameMode"`
		GameType              models.GameType `json:"gameType"`
		GameVersion           string          `json:"gameVersion"`
		MapId                 models.MapID    `json:"mapId"`
		ParticipantIdentities []struct {
			ParticipantId int `json:"participantId"`
			Player        struct {
				AccountId         int64  `json:"accountId"`
				CurrentAccountId  int64  `json:"currentAccountId"`
				CurrentPlatformId string `json:"currentPlatformId"`
				MatchHistoryUri   string `json:"matchHistoryUri"`
				PlatformId        string `json:"platformId"`
				ProfileIcon       int    `json:"profileIcon"`
				SummonerId        int64  `json:"summonerId"`
				SummonerName      string `json:"summonerName"`
			} `json:"player"`
		} `json:"participantIdentities"`
		Participants []Participant `json:"participants"`
		PlatformId   string        `json:"platformId"`
		QueueId      int           `json:"queueId"`
		SeasonId     int           `json:"seasonId"`
		Teams        []struct {
			Bans []struct {
				ChampionId int `json:"championId"`
				PickTurn   int `json:"pickTurn"`
			} `json:"bans"`
			BaronKills           int    `json:"baronKills"`
			DominionVictoryScore int    `json:"dominionVictoryScore"`
			DragonKills          int    `json:"dragonKills"`
			FirstBaron           bool   `json:"firstBaron"`
			FirstBlood           bool   `json:"firstBlood"`
			FirstDargon          bool   `json:"firstDargon"`
			FirstInhibitor       bool   `json:"firstInhibitor"`
			FirstTower           bool   `json:"firstTower"`
			InhibitorKills       int    `json:"inhibitorKills"`
			RiftHeraldKills      int    `json:"riftHeraldKills"`
			TeamId               int    `json:"teamId"`
			TowerKills           int    `json:"towerKills"`
			VilemawKills         int    `json:"vilemawKills"`
			Win                  string `json:"win"`
		} `json:"teams"`
	}
	ChampSelectSessionInfo struct {
		CommonResp
		Actions [][]struct {
			ActorCellId  int                  `json:"actorCellId"`
			ChampionId   int                  `json:"championId"`
			Completed    bool                 `json:"completed"`
			Id           int                  `json:"id"`
			IsAllyAction bool                 `json:"isAllyAction"`
			IsInProgress bool                 `json:"isInProgress"`
			PickTurn     int                  `json:"pickTurn"`
			Type         ChampSelectPatchType `json:"type"`
		} `json:"actions"`
		// AllowBattleBoost    bool `json:"allowBattleBoost"`
		// AllowDuplicatePicks bool `json:"allowDuplicatePicks"`
		// AllowLockedEvents   bool `json:"allowLockedEvents"`
		// AllowRerolling      bool `json:"allowRerolling"`
		// AllowSkinSelection  bool `json:"allowSkinSelection"`
		// Bans                struct {
		// 	MyTeamBans    []interface{} `json:"myTeamBans"`
		// 	NumBans       int           `json:"numBans"`
		// 	TheirTeamBans []interface{} `json:"theirTeamBans"`
		// } `json:"bans"`
		// BenchChampionIds   []interface{} `json:"benchChampionIds"`
		// BenchEnabled       bool          `json:"benchEnabled"`
		// BoostableSkinCount int           `json:"boostableSkinCount"`
		// ChatDetails        struct {
		// 	ChatRoomName     string `json:"chatRoomName"`
		// 	ChatRoomPassword string `json:"chatRoomPassword"`
		// } `json:"chatDetails"`
		// Counter              int `json:"counter"`
		// EntitledFeatureState struct {
		// 	AdditionalRerolls int           `json:"additionalRerolls"`
		// 	UnlockedSkinIds   []interface{} `json:"unlockedSkinIds"`
		// } `json:"entitledFeatureState"`
		// GameId               int  `json:"gameId"`
		// HasSimultaneousBans  bool `json:"hasSimultaneousBans"`
		// HasSimultaneousPicks bool `json:"hasSimultaneousPicks"`
		// IsCustomGame         bool `json:"isCustomGame"`
		// IsSpectating         bool `json:"isSpectating"`
		LocalPlayerCellId int `json:"localPlayerCellId"`
		// LockedEventIndex     int  `json:"lockedEventIndex"`
		// MyTeam               []struct {
		// 	AssignedPosition    string `json:"assignedPosition"`
		// 	CellId              int    `json:"cellId"`
		// 	ChampionId          int    `json:"championId"`
		// 	ChampionPickIntent  int    `json:"championPickIntent"`
		// 	EntitledFeatureType string `json:"entitledFeatureType"`
		// 	SelectedSkinId      int    `json:"selectedSkinId"`
		// 	Spell1Id            int    `json:"spell1Id"`
		// 	Spell2Id            int    `json:"spell2Id"`
		// 	SummonerId          int64  `json:"summonerId"`
		// 	Team                int    `json:"team"`
		// 	WardSkinId          int    `json:"wardSkinId"`
		// } `json:"myTeam"`
		// RecoveryCounter    int  `json:"recoveryCounter"`
		// RerollsRemaining   int  `json:"rerollsRemaining"`
		// SkipChampionSelect bool `json:"skipChampionSelect"`
		// TheirTeam          []struct {
		// 	AssignedPosition    string `json:"assignedPosition"`
		// 	CellId              int    `json:"cellId"`
		// 	ChampionId          int    `json:"championId"`
		// 	ChampionPickIntent  int    `json:"championPickIntent"`
		// 	EntitledFeatureType string `json:"entitledFeatureType"`
		// 	SelectedSkinId      int    `json:"selectedSkinId"`
		// 	Spell1Id            int    `json:"spell1Id"`
		// 	Spell2Id            int    `json:"spell2Id"`
		// 	SummonerId          int    `json:"summonerId"`
		// 	Team                int    `json:"team"`
		// 	WardSkinId          int    `json:"wardSkinId"`
		// } `json:"theirTeam"`
		// Timer struct {
		// 	AdjustedTimeLeftInPhase int    `json:"adjustedTimeLeftInPhase"`
		// 	InternalNowInEpochMs    int64  `json:"internalNowInEpochMs"`
		// 	IsInfinite              bool   `json:"isInfinite"`
		// 	Phase                   string `json:"phase"`
		// 	TotalTimeInPhase        int    `json:"totalTimeInPhase"`
		// } `json:"timer"`
		// Trades []interface{} `json:"trades"`
	}
	GameFolwSessionTeamUser struct {
		AccountId         float64 `json:"accountId,omitempty"`
		AdjustmentFlags   float64 `json:"adjustmentFlags,omitempty"`
		BotDifficulty     string  `json:"botDifficulty"`
		ClientInSynch     bool    `json:"clientInSynch,omitempty"`
		GameCustomization struct {
			Regalia        string `json:"Regalia,omitempty"`
			Perks          string `json:"perks,omitempty"`
			SummonerEmotes string `json:"summonerEmotes,omitempty"`
		} `json:"gameCustomization"`
		Index                   float64          `json:"index,omitempty"`
		LastSelectedSkinIndex   float64          `json:"lastSelectedSkinIndex"`
		Locale                  interface{}      `json:"locale"`
		Minor                   bool             `json:"minor,omitempty"`
		OriginalAccountNumber   float64          `json:"originalAccountNumber,omitempty"`
		OriginalPlatformId      string           `json:"originalPlatformId,omitempty"`
		PartnerId               string           `json:"partnerId,omitempty"`
		PickMode                float64          `json:"pickMode"`
		PickTurn                float64          `json:"pickTurn"`
		ProfileIconId           float64          `json:"profileIconId,omitempty"`
		Puuid                   string           `json:"puuid,omitempty"`
		QueueRating             float64          `json:"queueRating,omitempty"`
		RankedTeamGuest         bool             `json:"rankedTeamGuest,omitempty"`
		SelectedPosition        interface{}      `json:"selectedPosition"`
		SelectedRole            interface{}      `json:"selectedRole"`
		SummonerId              float64          `json:"summonerId,omitempty"`
		SummonerInternalName    string           `json:"summonerInternalName"`
		SummonerName            string           `json:"summonerName"`
		TeamOwner               bool             `json:"teamOwner,omitempty"`
		TeamParticipantId       interface{}      `json:"teamParticipantId"`
		TeamRating              float64          `json:"teamRating,omitempty"`
		TimeAddedToQueue        interface{}      `json:"timeAddedToQueue"`
		TimeChampionSelectStart float64          `json:"timeChampionSelectStart,omitempty"`
		TimeGameCreated         float64          `json:"timeGameCreated,omitempty"`
		TimeMatchmakingStart    float64          `json:"timeMatchmakingStart,omitempty"`
		VoterRating             float64          `json:"voterRating,omitempty"`
		BotSkillLevel           float64          `json:"botSkillLevel,omitempty"`
		ChampionId              interface{}      `json:"championId"`
		Role                    interface{}      `json:"role"`
		Spell1Id                interface{}      `json:"spell1Id"`
		Spell2Id                interface{}      `json:"spell2Id"`
		TeamId                  models.TeamIDStr `json:"teamId,omitempty"`
	}
	GameFlowSession struct {
		CommonResp
		// GameClient struct {
		// 	ObserverServerIp   string `json:"observerServerIp"`
		// 	ObserverServerPort int    `json:"observerServerPort"`
		// 	Running            bool   `json:"running"`
		// 	ServerIp           string `json:"serverIp"`
		// 	ServerPort         int    `json:"serverPort"`
		// 	Visible            bool   `json:"visible"`
		// } `json:"gameClient"`
		GameData struct {
			// GameId                   int64  `json:"gameId"`
			// GameName                 string `json:"gameName"`
			// IsCustomGame             bool   `json:"isCustomGame"`
			// Password                 string `json:"password"`
			// PlayerChampionSelections []struct {
			// 	ChampionId           float64 `json:"championId"`
			// 	SelectedSkinIndex    float64 `json:"selectedSkinIndex"`
			// 	Spell1Id             float64 `json:"spell1Id"`
			// 	Spell2Id             float64 `json:"spell2Id"`
			// 	SummonerInternalName string  `json:"summonerInternalName"`
			// } `json:"playerChampionSelections"`
			// Queue struct {
			// 	AllowablePremadeSizes   []interface{} `json:"allowablePremadeSizes"`
			// 	AreFreeChampionsAllowed bool          `json:"areFreeChampionsAllowed"`
			// 	AssetMutator            string        `json:"assetMutator"`
			// 	Category                string        `json:"category"`
			// 	ChampionsRequiredToPlay int           `json:"championsRequiredToPlay"`
			// 	Description             string        `json:"description"`
			// 	DetailedDescription     string        `json:"detailedDescription"`
			// 	GameMode                string        `json:"gameMode"`
			// 	GameTypeConfig          struct {
			// 		AdvancedLearningQuests bool   `json:"advancedLearningQuests"`
			// 		AllowTrades            bool   `json:"allowTrades"`
			// 		BanMode                string `json:"banMode"`
			// 		BanTimerDuration       int    `json:"banTimerDuration"`
			// 		BattleBoost            bool   `json:"battleBoost"`
			// 		CrossTeamChampionPool  bool   `json:"crossTeamChampionPool"`
			// 		DeathMatch             bool   `json:"deathMatch"`
			// 		DoNotRemove            bool   `json:"doNotRemove"`
			// 		DuplicatePick          bool   `json:"duplicatePick"`
			// 		ExclusivePick          bool   `json:"exclusivePick"`
			// 		Id                     int    `json:"id"`
			// 		LearningQuests         bool   `json:"learningQuests"`
			// 		MainPickTimerDuration  int    `json:"mainPickTimerDuration"`
			// 		MaxAllowableBans       int    `json:"maxAllowableBans"`
			// 		Name                   string `json:"name"`
			// 		OnboardCoopBeginner    bool   `json:"onboardCoopBeginner"`
			// 		PickMode               string `json:"pickMode"`
			// 		PostPickTimerDuration  int    `json:"postPickTimerDuration"`
			// 		Reroll                 bool   `json:"reroll"`
			// 		TeamChampionPool       bool   `json:"teamChampionPool"`
			// 	} `json:"gameTypeConfig"`
			// 	Id                                  int    `json:"id"`
			// 	IsRanked                            bool   `json:"isRanked"`
			// 	IsTeamBuilderManaged                bool   `json:"isTeamBuilderManaged"`
			// 	IsTeamOnly                          bool   `json:"isTeamOnly"`
			// 	LastToggledOffTime                  int    `json:"lastToggledOffTime"`
			// 	LastToggledOnTime                   int    `json:"lastToggledOnTime"`
			// 	MapId                               int    `json:"mapId"`
			// 	MaxLevel                            int    `json:"maxLevel"`
			// 	MaxSummonerLevelForFirstWinOfTheDay int    `json:"maxSummonerLevelForFirstWinOfTheDay"`
			// 	MaximumParticipantListSize          int    `json:"maximumParticipantListSize"`
			// 	MinLevel                            int    `json:"minLevel"`
			// 	MinimumParticipantListSize          int    `json:"minimumParticipantListSize"`
			// 	Name                                string `json:"name"`
			// 	NumPlayersPerTeam                   int    `json:"numPlayersPerTeam"`
			// 	QueueAvailability                   string `json:"queueAvailability"`
			// 	QueueRewards                        struct {
			// 		IsChampionPointsEnabled bool          `json:"isChampionPointsEnabled"`
			// 		IsIpEnabled             bool          `json:"isIpEnabled"`
			// 		IsXpEnabled             bool          `json:"isXpEnabled"`
			// 		PartySizeIpRewards      []interface{} `json:"partySizeIpRewards"`
			// 	} `json:"queueRewards"`
			// 	RemovalFromGameAllowed      bool   `json:"removalFromGameAllowed"`
			// 	RemovalFromGameDelayMinutes int    `json:"removalFromGameDelayMinutes"`
			// 	ShortName                   string `json:"shortName"`
			// 	ShowPositionSelector        bool   `json:"showPositionSelector"`
			// 	SpectatorEnabled            bool   `json:"spectatorEnabled"`
			// 	Type                        string `json:"type"`
			// } `json:"queue"`
			SpectatorsAllowed bool                      `json:"spectatorsAllowed"`
			TeamOne           []GameFolwSessionTeamUser `json:"teamOne"`
			TeamTwo           []GameFolwSessionTeamUser `json:"teamTwo"`
		} `json:"gameData"`
		GameDodge struct {
			DodgeIds []interface{} `json:"dodgeIds"`
			Phase    string        `json:"phase"`
			State    string        `json:"state"`
		} `json:"gameDodge"`
		Map struct {
			Assets struct {
				ChampSelectBackgroundSound  string `json:"champ-select-background-sound"`
				ChampSelectFlyoutBackground string `json:"champ-select-flyout-background"`
				ChampSelectPlanningIntro    string `json:"champ-select-planning-intro"`
				GameSelectIconActive        string `json:"game-select-icon-active"`
				GameSelectIconActiveVideo   string `json:"game-select-icon-active-video"`
				GameSelectIconDefault       string `json:"game-select-icon-default"`
				GameSelectIconDisabled      string `json:"game-select-icon-disabled"`
				GameSelectIconHover         string `json:"game-select-icon-hover"`
				GameSelectIconIntroVideo    string `json:"game-select-icon-intro-video"`
				GameflowBackground          string `json:"gameflow-background"`
				GameselectButtonHoverSound  string `json:"gameselect-button-hover-sound"`
				IconDefeat                  string `json:"icon-defeat"`
				IconDefeatVideo             string `json:"icon-defeat-video"`
				IconEmpty                   string `json:"icon-empty"`
				IconHover                   string `json:"icon-hover"`
				IconLeaver                  string `json:"icon-leaver"`
				IconVictory                 string `json:"icon-victory"`
				IconVictoryVideo            string `json:"icon-victory-video"`
				MapNorth                    string `json:"map-north"`
				MapSouth                    string `json:"map-south"`
				MusicInqueueLoopSound       string `json:"music-inqueue-loop-sound"`
				PartiesBackground           string `json:"parties-background"`
				PostgameAmbienceLoopSound   string `json:"postgame-ambience-loop-sound"`
				ReadyCheckBackground        string `json:"ready-check-background"`
				ReadyCheckBackgroundSound   string `json:"ready-check-background-sound"`
				SfxAmbiencePregameLoopSound string `json:"sfx-ambience-pregame-loop-sound"`
				SocialIconLeaver            string `json:"social-icon-leaver"`
				SocialIconVictory           string `json:"social-icon-victory"`
			} `json:"assets"`
			CategorizedContentBundles struct {
			} `json:"categorizedContentBundles"`
			Description                         string `json:"description"`
			GameMode                            string `json:"gameMode"`
			GameModeName                        string `json:"gameModeName"`
			GameModeShortName                   string `json:"gameModeShortName"`
			GameMutator                         string `json:"gameMutator"`
			Id                                  int    `json:"id"`
			IsRGM                               bool   `json:"isRGM"`
			MapStringId                         string `json:"mapStringId"`
			Name                                string `json:"name"`
			PerPositionDisallowedSummonerSpells struct {
			} `json:"perPositionDisallowedSummonerSpells"`
			PerPositionRequiredSummonerSpells struct {
			} `json:"perPositionRequiredSummonerSpells"`
			PlatformId   string `json:"platformId"`
			PlatformName string `json:"platformName"`
			Properties   struct {
				SuppressRunesMasteriesPerks bool `json:"suppressRunesMasteriesPerks"`
			} `json:"properties"`
		} `json:"map"`
		Phase models.GameFlow `json:"phase"`
	}
)

const (
	JoinedRoomMsg                                  = "joined_room"
	ConversationMsgTypeSystem ConversationMsgType  = "system"
	ChampSelectPatchTypePick  ChampSelectPatchType = "pick"
	ChampSelectPatchTypeBan   ChampSelectPatchType = "ban"
)

var (
	queryGameSummaryLimiter = rate.NewLimiter(rate.Every(time.Second/50), 50)
)

// è·å–å½“å‰å¬å”¤å¸ˆ
func GetCurrSummoner() (*CurrSummoner, error) {
	bts, err := cli.httpGet("/lol-summoner/v1/current-summoner")
	if err != nil {
		return nil, err
	}
	data := &CurrSummoner{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("è·å–å½“å‰å¬å”¤å¸ˆå¤±è´¥", zap.Error(err))
		return nil, err
	}
	if data.SummonerId == 0 {
		return nil, errors.New("è·å–å½“å‰å¬å”¤å¸ˆå¤±è´¥")
	}
	return data, nil
}

// è·å–æ¯”èµ›è®°å½•
func ListGamesBySummonerID(summonerID int64, begin, limit int) (*GameListResp, error) {
	bts, err := cli.httpGet(fmt.Sprintf("/lol-match-history/v3/matchlist/account/%d?begIndex=%d&endIndex=%d",
		summonerID, begin, begin+limit))
	if err != nil {
		return nil, err
	}
	data := &GameListResp{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("è·å–æ¯”èµ›è®°å½•", zap.Error(err))
		return nil, err
	}
	return data, nil
}

// è·å–ä¼šè¯ç»„æ¶ˆæ¯è®°å½•
func ListConversationMsg(conversationID string) ([]ConversationMsg, error) {
	bts, err := cli.httpGet(fmt.Sprintf("/lol-chat/v1/conversations/%s/messages", conversationID))
	if err != nil {
		return nil, err
	}
	list := make([]ConversationMsg, 0, 10)
	err = json.Unmarshal(bts, &list)
	if err != nil {
		logger.Info("è·å–ä¼šè¯ç»„æ¶ˆæ¯è®°å½•å¤±è´¥", zap.Error(err))
		return nil, err
	}
	return list, nil
}

// è·å–å½“å‰å¯¹å±€èŠå¤©ç»„
func GetCurrConversationID() (string, error) {
	bts, err := cli.httpGet("/lol-chat/v1/conversations")
	if err != nil {
		return "", err
	}
	list := make([]Conversation, 0, 1)
	err = json.Unmarshal(bts, &list)
	if err != nil {
		logger.Info("è·å–å½“å‰å¯¹å±€èŠå¤©ç»„å¤±è´¥", zap.Error(err))
		return "", err
	}
	for _, conversation := range list {
		if conversation.Type == models.GameStatusChampionSelect {
			return conversation.Id, nil
		}
	}
	return "", errors.New("å½“å‰ä¸åœ¨è‹±é›„é€‰æ‹©é˜¶æ®µ")
}

// å‘é€æ¶ˆæ¯åˆ°èŠå¤©ç»„
func SendConversationMsg(msg string, conversationID string) error {
	data := struct {
		Body string `json:"body"`
		Type string `json:"type"`
	}{
		Body: msg,
		Type: "chat",
	}
	_, err := cli.httpPost(fmt.Sprintf("/lol-chat/v1/conversations/%s/messages", conversationID), data)
	return err
}

// ç”³è¯·åŠ å¥½å‹
func ApplyFriend(summonerID int64) error {
	data := struct {
		ID string `json:"id"`
	}{
		ID: strconv.FormatInt(summonerID, 10),
	}
	_, err := cli.httpPost("/lol-chat/v1/friend-requests", data)
	return err
}

// å–æ¶ˆåŠ å¥½å‹
func CancelApplyFriend(summonerID int64) error {
	_, err := cli.httpDel(fmt.Sprintf("/lol-chat/v1/friend-requests/%d", summonerID))
	return err
}

// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
func ListSummoner(summonerIDList []int64) ([]Summoner, error) {
	idStrList := make([]string, 0, len(summonerIDList))
	for _, id := range summonerIDList {
		idStrList = append(idStrList, strconv.FormatInt(id, 10))
	}
	bts, err := cli.httpGet(fmt.Sprintf("/lol-summoner/v2/summoners?ids=[%s]",
		strings.Join(idStrList, ",")))
	if len(bts) > 0 && bts[0] == '[' {
		list := make([]Summoner, 0, len(summonerIDList))
		err = json.Unmarshal(bts, &list)
		if err != nil {
			logger.Info("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥", zap.Error(err))
			return nil, err
		}
		return list, err
	}
	data := &CommonResp{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥", zap.Error(err))
		return nil, err
	}
	return nil, errors.New(data.Message)
}

// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
func QuerySummoner(summonerID int64) (*Summoner, error) {
	list, err := ListSummoner([]int64{summonerID})
	if err != nil {
		return nil, err
	}
	if len(list) == 0 {
		return nil, errors.New("è·å–å¬å”¤å¸ˆä¿¡æ¯å¤±è´¥ list == 0")
	}
	return &list[0], nil
}

// æŸ¥è¯¢å¯¹å±€è¯¦æƒ…
func QueryGameSummary(gameID int64) (*GameSummary, error) {
	_ = queryGameSummaryLimiter.Wait(context.Background())
	bts, err := cli.httpGet(fmt.Sprintf("/lol-match-history/v1/games/%d", gameID))
	if err != nil {
		return nil, err
	}
	data := &GameSummary{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("æŸ¥è¯¢å¯¹å±€è¯¦æƒ…å¤±è´¥", zap.Error(err))
		return nil, err
	}
	if data.CommonResp.ErrorCode != "" {
		return nil, errors.New(fmt.Sprintf("æŸ¥è¯¢å¯¹å±€è¯¦æƒ…å¤±è´¥ :%s ,gameID: %d", data.CommonResp.Message, gameID))
	}
	return data, nil
}

// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
func QuerySummonerByName(name string) (*Summoner, error) {
	bts, err := cli.httpGet(fmt.Sprintf("/lol-summoner/v1/summoners?name=%s", name))
	if err != nil {
		return nil, err
	}
	data := &Summoner{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("æœç´¢ç”¨æˆ·å¤±è´¥", zap.Error(err))
		return nil, err
	}
	if data.CommonResp.ErrorCode != "" {
		return nil, errors.New(fmt.Sprintf("æœç´¢ç”¨æˆ·å¤±è´¥ :%s", data.CommonResp.Message))
	}
	return data, nil
}

// æ¥å—å¯¹å±€
func AcceptGame() error {
	_, err := cli.httpPost("/lol-matchmaking/v1/ready-check/accept", nil)
	return err
}

// è·å–é€‰äººä¼šè¯
func GetChampSelectSession() (*ChampSelectSessionInfo, error) {
	bts, err := cli.httpGet("/lol-champ-select/v1/session")
	if err != nil {
		return nil, err
	}
	data := &ChampSelectSessionInfo{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("æŸ¥è¯¢é€‰äººä¼šè¯è¯¦æƒ…å¤±è´¥", zap.Error(err))
		return nil, err
	}
	if data.CommonResp.ErrorCode != "" {
		return nil, errors.New(fmt.Sprintf("æŸ¥è¯¢é€‰äººä¼šè¯è¯¦æƒ…å¤±è´¥ :%s", data.CommonResp.Message))
	}
	return data, nil
}

func ChampSelectPatchAction(championID, actionID int, patchType ChampSelectPatchType,
	completed bool) error {
	body := struct {
		Completed  bool                 `json:"completed"`
		Type       ChampSelectPatchType `json:"type"`
		ChampionID int                  `json:"championId"`
	}{
		Completed:  completed,
		Type:       patchType,
		ChampionID: championID,
	}
	bts, err := cli.httpPatch(fmt.Sprintf("/lol-champ-select/v1/session/actions/%d", actionID), body)
	if err != nil {
		return err
	}
	data := &CommonResp{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("ChampSelectPatchActionè¯¦æƒ…å¤±è´¥", zap.Error(err))
		return err
	}
	if data.ErrorCode != "" {
		return errors.New(fmt.Sprintf("ChampSelectPatchActionå¤±è´¥ :%s", data.Message))
	}
	return nil
}

// é€‰æ‹©è‹±é›„
func PickChampion(championID, actionID int) error {
	return ChampSelectPatchAction(championID, actionID, ChampSelectPatchTypePick, true)
}

// banè‹±é›„
func BanChampion(championID, actionID int) error {
	return ChampSelectPatchAction(championID, actionID, ChampSelectPatchTypeBan, true)
}

// æŸ¥è¯¢æ¸¸æˆä¼šè¯
func QueryGameFlowSession() (*GameFlowSession, error) {
	bts, err := cli.httpGet("/lol-gameflow/v1/session")
	if err != nil {
		return nil, err
	}
	data := &GameFlowSession{}
	err = json.Unmarshal(bts, data)
	if err != nil {
		logger.Info("æŸ¥è¯¢æ¸¸æˆä¼šè¯å¤±è´¥", zap.Error(err))
		return nil, err
	}
	if data.CommonResp.ErrorCode != "" {
		return nil, errors.New(fmt.Sprintf("æŸ¥è¯¢æ¸¸æˆä¼šè¯å¤±è´¥ :%s", data.CommonResp.Message))
	}
	return data, nil
}

```

`services/lcu/client.go`:

```go
package lcu

import (
	"bytes"
	"crypto/tls"
	"encoding/json"
	"errors"
	"fmt"
	"io"
	"net/http"
)

const (
	lolProcessName = "LeagueClientUxRender.exe"
)

var (
	httpCli = &http.Client{
		Transport: &http.Transport{
			ForceAttemptHTTP2: true,
			TLSClientConfig: &tls.Config{
				InsecureSkipVerify: true,
			},
		},
	}
	errLolClientNotFound = errors.New("æœªæ‰¾åˆ°lolè¿›ç¨‹")
	cli                  *client
)

type (
	client struct {
		port    int
		authPwd string
		baseUrl string
	}
)

func InitCli(port int, token string) {
	cli = NewClient(port, token)
}
func (cli client) fmtClientApiUrl() string {
	return fmt.Sprintf("https://riot:%s@127.0.0.1:%d", cli.authPwd, cli.port)
}
func NewClient(port int, token string) *client {
	cli := &client{
		port:    port,
		authPwd: token,
	}
	cli.baseUrl = cli.fmtClientApiUrl()
	return cli
}
func (cli client) httpGet(url string) ([]byte, error) {
	return cli.req(http.MethodGet, url, nil)
}
func (cli client) httpPost(url string, body interface{}) ([]byte, error) {
	return cli.req(http.MethodPost, url, body)
}
func (cli client) httpPatch(url string, body interface{}) ([]byte, error) {
	return cli.req(http.MethodPatch, url, body)
}
func (cli client) httpDel(url string) ([]byte, error) {
	return cli.req(http.MethodDelete, url, nil)
}
func (cli client) req(method string, url string, data interface{}) ([]byte, error) {
	var body io.Reader
	if data != nil {
		bts, err := json.Marshal(data)
		if err != nil {
			return nil, err
		}
		body = bytes.NewReader(bts)
	}
	req, _ := http.NewRequest(method, cli.baseUrl+url, body)
	if req.Body != nil {
		req.Header.Add("ContentType", "application/json")
	}
	resp, err := httpCli.Do(req)
	if err != nil {
		return nil, err
	}
	defer resp.Body.Close()
	return io.ReadAll(resp.Body)
}

```

`services/lcu/common.go`:

```go
package lcu

import (
	"regexp"
	"strconv"

	"github.com/pkg/errors"
	"github.com/real-web-world/hh-lol-prophet/pkg/windows/process"
)

const (
	lolUxProcessName = "LeagueClientUx.exe"
)

var (
	lolCommandlineReg     = regexp.MustCompile(`--remoting-auth-token=(.+?)" "--app-port=(\d+)"`)
	ErrLolProcessNotFound = errors.New("æœªæ‰¾åˆ°lolè¿›ç¨‹")
)

func GetLolClientApiInfo() (int, string, error) {
	return GetLolClientApiInfoV3()
}
func GetLolClientApiInfoV3() (port int, token string, err error) {
	cmdline, err := process.GetProcessCommand(lolUxProcessName)
	if err != nil {
		err = ErrLolProcessNotFound
		return
	}
	btsChunk := lolCommandlineReg.FindSubmatch([]byte(cmdline))
	if len(btsChunk) < 3 {
		return port, token, ErrLolProcessNotFound
	}
	token = string(btsChunk[1])
	port, err = strconv.Atoi(string(btsChunk[2]))
	return
}

```

`services/lcu/gameScore.go`:

```go
package lcu

import (
	"fmt"
	"strings"
)

type (
	UserScore struct {
		SummonerID   int64    `json:"summonerID"`
		SummonerName string   `json:"summonerName"`
		Score        float64  `json:"score"`
		CurrKDA      [][3]int `json:"currKDA"`
	}
	IncScoreReason struct {
		reason ScoreOption
		incVal float64
	}
	ScoreWithReason struct {
		score   float64
		reasons []IncScoreReason
	}
	ScoreOption string // å¾—åˆ†é€‰é¡¹
)

const (
	ScoreOptionFirstBloodKill     ScoreOption = "ä¸€è¡€å‡»æ€"
	ScoreOptionFirstBloodAssist   ScoreOption = "ä¸€è¡€åŠ©æ”»"
	ScoreOptionPentaKills         ScoreOption = "äº”æ€"
	ScoreOptionQuadraKills        ScoreOption = "å››æ€"
	ScoreOptionTripleKills        ScoreOption = "ä¸‰æ€"
	ScoreOptionJoinTeamRateRank   ScoreOption = "å‚å›¢ç‡æ’å"
	ScoreOptionGoldEarnedRank     ScoreOption = "æ‰“é’±æ’å"
	ScoreOptionHurtRank           ScoreOption = "ä¼¤å®³æ’å"
	ScoreOptionMoney2hurtRateRank ScoreOption = "é‡‘é’±è½¬æ¢ä¼¤å®³æ¯”æ’å"
	ScoreOptionVisionScoreRank    ScoreOption = "è§†é‡å¾—åˆ†æ’å"
	ScoreOptionMinionsKilled      ScoreOption = "è¡¥å…µ"
	ScoreOptionKillRate           ScoreOption = "å‡»æ€å æ¯”"
	ScoreOptionHurtRate           ScoreOption = "ä¼¤å®³å æ¯”"
	ScoreOptionAssistRate         ScoreOption = "åŠ©æ”»å æ¯”"
	ScoreOptionKDAAdjust          ScoreOption = "kdaå¾®è°ƒ"
)

func NewScoreWithReason(score float64) *ScoreWithReason {
	return &ScoreWithReason{
		score:   score,
		reasons: make([]IncScoreReason, 0, 5),
	}
}
func (s *ScoreWithReason) Add(incVal float64, reason ScoreOption) {
	s.score += incVal
	s.reasons = append(s.reasons, IncScoreReason{
		reason: reason,
		incVal: incVal,
	})
}
func (s *ScoreWithReason) Value() float64 {
	return s.score
}
func (s *ScoreWithReason) Reasons2String() string {
	sb := strings.Builder{}
	for _, reason := range s.reasons {
		sb.WriteString(fmt.Sprintf("%s%.2f,", reason.reason, reason.incVal))
	}
	return sb.String()
}

```

`services/lcu/models/champion/champion.go`:

```go
package champion

import "github.com/real-web-world/hh-lol-prophet/services/lcu/models"

const (
	Annie models.Champion = iota + 1 // å®‰å¦®
)

```

`services/lcu/models/lol.go`:

```go
package models

type (
	GameMode      string // æ¸¸æˆæ¨¡å¼
	GameQueueID   int    // æ¸¸æˆé˜Ÿåˆ—æ¨¡å¼id
	GameQueueType string // æ¸¸æˆé˜Ÿåˆ—æ¨¡å¼
	GameStatus    string // æ¸¸æˆçŠ¶æ€
	RankTier      string // æ’ä½ç­‰çº§
	GameType      string // æ¸¸æˆç±»å‹
	Spell         int    // å¬å”¤å¸ˆæŠ€èƒ½
	Champion      int    // è‹±é›„
	Lane          string // ä½ç½®
	ChampionRole  string // è‹±é›„è§’è‰²
	GameFlow      string // æ¸¸æˆçŠ¶æ€
	MapID         int    // åœ°å›¾id
	TeamID        int    // é˜Ÿä¼id
	TeamIDStr     string // é˜Ÿä¼id
)

const (
	GameModeNone GameMode = ""
	// æ¸¸æˆæ¨¡å¼
	GameModeClassic GameMode = "CLASSIC"      // ç»å…¸æ¨¡å¼
	GameModeARAM    GameMode = "ARAM"         // å¤§ä¹±æ–—
	GameModeTFT     GameMode = "TFT"          // äº‘é¡¶ä¹‹å¼ˆ
	GameModeURF     GameMode = "URF"          // æ— é™ç«åŠ›
	GameModeCustom  GameMode = "PRACTICETOOL" // è‡ªå®šä¹‰
	// é˜Ÿåˆ—æ¨¡å¼
	GameQueueTypeNormal   GameQueueType = "NORMAL"            // åŒ¹é…
	GameQueueTypeRankSolo GameQueueType = "RANKED_SOLO_5x5"   // å•åŒæ’
	GameQueueTypeRankFlex GameQueueType = "RANKED_FLEX_SR"    // ç»„æ’
	GameQueueTypeARAM     GameQueueType = "ARAM_UNRANKED_5x5" // å¤§ä¹±æ–—5v5
	GameQueueTypeURF      GameQueueType = "URF"               // æ— é™ç«åŠ›
	GameQueueTypeBOT      GameQueueType = "BOT"               // äººæœº
	GameQueueTypeCustom   GameQueueType = "PRACTICETOOL"      // è‡ªå®šä¹‰
	// æ¸¸æˆçŠ¶æ€
	GameStatusInQueue        GameStatus = "inQueue"                   // é˜Ÿåˆ—ä¸­
	GameStatusInGame         GameStatus = "inGame"                    // æ¸¸æˆä¸­
	GameStatusChampionSelect GameStatus = "championSelect"            // è‹±é›„é€‰æ‹©ä¸­
	GameStatusOutOfGame      GameStatus = "outOfGame"                 // é€€å‡ºæ¸¸æˆä¸­
	GameStatusHostNormal     GameStatus = "hosting_NORMAL"            // åŒ¹é…ç»„é˜Ÿä¸­-é˜Ÿé•¿
	GameStatusHostRankSolo   GameStatus = "hosting_RANKED_SOLO_5x5"   // å•æ’ç»„é˜Ÿä¸­-é˜Ÿé•¿
	GameStatusHostRankFlex   GameStatus = "hosting_RANKED_FLEX_SR"    // ç»„æ’ç»„é˜Ÿä¸­-é˜Ÿé•¿
	GameStatusHostARAM       GameStatus = "hosting_ARAM_UNRANKED_5x5" // å¤§ä¹±æ–—5v5ç»„é˜Ÿä¸­-é˜Ÿé•¿
	GameStatusHostURF        GameStatus = "hosting_URF"               // æ— é™ç«åŠ›ç»„é˜Ÿä¸­-é˜Ÿé•¿
	GameStatusHostBOT        GameStatus = "hosting_BOT"               // äººæœºç»„é˜Ÿä¸­-é˜Ÿé•¿
	GameFlowChampionSelect   GameFlow   = "ChampSelect"               // è‹±é›„é€‰æ‹©ä¸­
	GameFlowReadyCheck       GameFlow   = "ReadyCheck"                // ç­‰å¾…æ¥å—å¯¹å±€
	GameFlowInProgress       GameFlow   = "InProgress"                // è¿›è¡Œä¸­
	GameFlowNone             GameFlow   = "None"                      // æ— 
	// æ’ä½ç­‰çº§
	RankTierIron        RankTier = "IRON"        // é»‘é“
	RankTierBronze      RankTier = "BRONZE"      // é’é“œ
	RankTierSilver      RankTier = "SILVER"      // ç™½é“¶
	RankTierGold        RankTier = "GOLD"        // é»„é‡‘
	RankTierPlatinum    RankTier = "PLATINUM"    // ç™½é‡‘
	RankTierDiamond     RankTier = "DIAMOND"     // é’»çŸ³
	RankTierMaster      RankTier = "MASTER"      // å¤§å¸ˆ
	RankTierGrandMaster RankTier = "GRANDMASTER" // å®—å¸ˆ
	RankTierChallenger  RankTier = "CHALLENGER"  // ç‹è€…
	//  æ¸¸æˆç±»å‹
	GameTypeMatch GameType = "MATCHED_GAME" // åŒ¹é…
)
const (
	// æ¸¸æˆé˜Ÿåˆ—id
	NormalQueueID    GameQueueID = 430 // åŒ¹é…
	RankSoleQueueID  GameQueueID = 420 // å•æ’
	RankFlexQueueID  GameQueueID = 440 // ç»„æ’
	ARAMQueueID      GameQueueID = 450 // å¤§ä¹±æ–—
	URFQueueID       GameQueueID = 900 // æ— é™ç«åŠ›
	BOTSimpleQueueID GameQueueID = 830 // äººæœºå…¥é—¨
	BOTNoviceQueueID GameQueueID = 840 // äººæœºæ–°æ‰‹
	BOTNormalQueueID GameQueueID = 850 // äººæœºä¸€èˆ¬

	// åœ°å›¾id
	MapIDClassic MapID = 11 // ç»å…¸æ¨¡å¼å¬å”¤å¸ˆå³¡è°·
	MapIDARAM    MapID = 12 // æåœ°å¤§ä¹±æ–—
	// é˜Ÿä¼id
	TeamIDNone    TeamID    = 0     // æœªçŸ¥
	TeamIDBlue    TeamID    = 100   // è“è‰²æ–¹
	TeamIDRed     TeamID    = 200   // çº¢è‰²æ–¹
	TeamIDStrNone TeamIDStr = ""    // æœªçŸ¥
	TeamIDStrBlue TeamIDStr = "100" // è“è‰²æ–¹
	TeamIDStrRed  TeamIDStr = "200" // çº¢è‰²æ–¹
	// å¤§åŒºid
	PlatformIDDX1 = "HN1" // è‰¾æ¬§å°¼äºš
	PlatformIDDX2 = "HN2" // ç¥–å®‰
)

// å¬å”¤å¸ˆæŠ€èƒ½
const (
	SpellPingZhang Spell = 21 // å±éšœ
	SpellShanXian  Spell = 4  // é—ªç°
)

// ä½ç½®
const (
	LaneTop    Lane = "JUNGLE" // ä¸Šè·¯
	LaneJungle Lane = "JUNGLE" // æ‰“é‡
	LaneMiddle Lane = "MIDDLE" // ä¸­è·¯
	LaneBottom Lane = "BOTTOM" // ä¸‹è·¯
)

// è‹±é›„è§’è‰²
const (
	ChampionRoleSolo    ChampionRole = "SOLE"        // å•äººè·¯
	ChampionRoleSupport ChampionRole = "DUO_SUPPORT" // è¾…åŠ©
	ChampionRoleADC     ChampionRole = "DUO_CARRY"   // adc
	ChampionRoleNone    ChampionRole = "NONE"        // æ—  ä¸€èˆ¬æ˜¯æ‰“é‡
)

```

`services/logger/log.go`:

```go
package logger

import (
	"fmt"

	"github.com/getsentry/sentry-go"
	"go.uber.org/zap"
	"go.uber.org/zap/zapcore"

	"github.com/real-web-world/hh-lol-prophet/global"
)

func Debug(msg string, keysAndValues ...interface{}) {
	global.Logger.Debugw(msg, keysAndValues...)
}
func Info(msg string, keysAndValues ...interface{}) {
	global.Logger.Infow(msg, keysAndValues...)
}
func Warn(msg string, keysAndValues ...interface{}) {
	go sentry.WithScope(func(scope *sentry.Scope) {
		scope.SetLevel(sentry.LevelWarning)
		scope.SetExtra("kv", keysAndValues)
		sentry.CaptureMessage(msg)
	})
	global.Logger.Warnw(msg, keysAndValues...)
}
func Error(msg string, keysAndValues ...interface{}) {
	var errMsg string
	var errVerbose string
	for _, v := range keysAndValues {
		if field, ok := v.(zap.Field); ok && field.Type == zapcore.ErrorType {
			errMsg = field.Interface.(error).Error()
			errVerbose = fmt.Sprintf("%+v", field.Interface.(error))
		}
	}
	go sentry.WithScope(func(scope *sentry.Scope) {
		scope.SetLevel(sentry.LevelError)
		scope.SetExtra("kv", keysAndValues)
		if errMsg != "" {
			scope.SetExtra("error", errMsg)
			scope.SetExtra("errorVerbose", errVerbose)
		}
		sentry.CaptureMessage(msg)
	})
	global.Logger.Errorw(msg, keysAndValues...)
}

```

`services/ws/client.go`:

```go
package ws

import (
	"fmt"
	"log"
	"net/http"
	"time"

	"github.com/gorilla/websocket"
)

const (
	writeWait      = 10 * time.Second
	pongWait       = 60 * time.Second
	pingPeriod     = (pongWait * 9) / 10
	maxMessageSize = 512
)

var (
	newline = []byte{'\n'}
	space   = []byte{' '}
)

var upgrader = websocket.Upgrader{
	ReadBufferSize:  1024,
	WriteBufferSize: 1024,
}

type Client struct {
	hub  *Hub
	conn *websocket.Conn
	send chan []byte
}

func (c *Client) readPump() {
	defer func() {
		c.hub.unregister <- c
		c.conn.Close()
	}()
	c.conn.SetReadLimit(maxMessageSize)
	_ = c.conn.SetReadDeadline(time.Now().Add(pongWait))
	c.conn.SetPongHandler(func(string) error { _ = c.conn.SetReadDeadline(time.Now().Add(pongWait)); return nil })
	for {
		_, msg, err := c.conn.ReadMessage()
		if err != nil {
			if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway, websocket.CloseAbnormalClosure) {
				log.Printf("ws read error: %v", err)
			}
			break
		}
		_ = msg
		// message = bytes.TrimSpace(bytes.Replace(message, newline, space, -1))
		// c.hub.broadcast <- message
	}
}

func (c *Client) writePump() {
	ticker := time.NewTicker(pingPeriod)
	defer func() {
		ticker.Stop()
		_ = c.conn.Close()
	}()
	for {
		select {
		case msg, ok := <-c.send:
			_ = c.conn.SetWriteDeadline(time.Now().Add(writeWait))
			if !ok {
				_ = c.conn.WriteMessage(websocket.CloseMessage, []byte{})
				return
			}
			fmt.Printf("æ­£åœ¨å‘é€wsæ¶ˆæ¯: %s\n", msg)
			w, err := c.conn.NextWriter(websocket.TextMessage)
			if err != nil {
				return
			}
			_, _ = w.Write(msg)
			if err := w.Close(); err != nil {
				return
			}
		case <-ticker.C:
			_ = c.conn.SetWriteDeadline(time.Now().Add(writeWait))
			if err := c.conn.WriteMessage(websocket.PingMessage, nil); err != nil {
				return
			}
		}
	}
}

func ServeWs(hub *Hub, w http.ResponseWriter, r *http.Request) {
	conn, err := upgrader.Upgrade(w, r, nil)
	if err != nil {
		log.Println(err)
		return
	}
	client := &Client{hub: hub, conn: conn, send: make(chan []byte, 256)}
	client.hub.register <- client

	go client.writePump()
	go client.readPump()
}

```

`services/ws/hub.go`:

```go
package ws

import "encoding/json"

type (
	MsgType string
	Hub     struct {
		clients    map[*Client]bool
		broadcast  chan []byte
		register   chan *Client
		unregister chan *Client
	}
	Msg struct {
		Type MsgType     `json:"type"`
		Data interface{} `json:"data"`
	}
)

var ServerHub = NewHub()

func Init() {
	go ServerHub.Run()
}
func NewHub() *Hub {
	return &Hub{
		broadcast:  make(chan []byte),
		register:   make(chan *Client),
		unregister: make(chan *Client),
		clients:    make(map[*Client]bool),
	}
}

func (h *Hub) Run() {
	for {
		select {
		case client := <-h.register:
			h.clients[client] = true
		case client := <-h.unregister:
			if _, ok := h.clients[client]; ok {
				delete(h.clients, client)
				close(client.send)
			}
		case message := <-h.broadcast:
			for client := range h.clients {
				select {
				case client.send <- message:
				default:
					close(client.send)
					delete(h.clients, client)
				}
			}
		}
	}
}

func BroadcastMsg(msg Msg) {
	bts, _ := json.Marshal(msg)
	ServerHub.broadcast <- bts
}

```

`version.go`:

```go
package hh_lol_prophet

import "github.com/real-web-world/hh-lol-prophet/global"

var (
	APPVersion = "0.2.3"
	Commit     = "dev"
	BuildTime  = ""
	BuildUser  = ""
)

func init() {
	global.SetAppInfo(global.AppInfo{
		Version:   APPVersion,
		Commit:    Commit,
		BuildUser: BuildUser,
		BuildTime: BuildTime,
	})
}

```

`è®¡åˆ†æ–¹å¼.md`:

```md
# è®¡åˆ†æ–¹å¼

 
**æ¯ä¸ªäººé»˜è®¤100åˆ†**


|  å¾—åˆ†   | ä»£å·  |
|:---:|:---:|
|  180  | é€šå¤©ä»£ |
|  150  | å°ä»£  |
|  125  | ä¸Šç­‰é©¬ |
|  105  | ä¸­ç­‰é©¬ |
|  95   | ä¸‹ç­‰é©¬ |
|  <95  | ç‰›é©¬  |

## æˆ˜ç»©æƒé‡
> æœ€è¿‘20å±€ åŒ¹é… å•æ’ ç»„æ’ å¤§ä¹±æ–—çš„æˆ˜ç»© 

- æœ€è¿‘5å°æ—¶æˆ˜ç»©æƒé‡ **80%**
- å…¶ä»–æƒé‡ **20%**


 ## è®¡åˆ†æœºåˆ¶
- ä¸€è¡€
  - å‡»æ€ + 10
  - åŠ©æ”» + 5
- å¤šæ€
  - 5æ€ + 20
  - 4æ€ + 10
  - 3æ€ + 5
- å‚å›¢ç‡
  - ç¬¬ä¸€å + 10
  - ç¬¬äºŒå + 5
  - ç¬¬å››å - 5
  - ç¬¬äº”å - 10
- é‡‘é’±æ¯”(è·å–é‡‘å¸çš„æ’å)
  - ç¬¬ä¸€å + 10
  - ç¬¬äºŒå + 5
  - ç¬¬å››åå¹¶ä¸”ä¸æ˜¯è¾…åŠ© - 5
  - ç¬¬äº”åå¹¶ä¸”ä¸æ˜¯è¾…åŠ© - 10
- ä¼¤å®³æ¯”(å¯¹è‹±é›„é€ æˆçš„ä¼¤å®³æ’å)
  - ç¬¬ä¸€å + 10
  - ç¬¬äºŒå + 5
- é‡‘é’±è½¬åŒ–æ¯”æ’å(é‡‘å¸è½¬æ¢ä¼¤å®³)
  - ç¬¬ä¸€å + 10
  - ç¬¬äºŒå + 5
- è§†é‡å¾—åˆ†æ’å
  - ç¬¬ä¸€å + 10
  - ç¬¬äºŒå + 5     
- æ¯åˆ†é’Ÿè¡¥å…µæ•°
  - 8 + 5
  - 9 + 10
  - 9 + 20
- kda
  - å‡»æ€å æ¯”ç›¸å…³
    - å‡»æ€å æ¯” > 50%
      - å‡»æ€ > 5 + 10
      - å‡»æ€ > 10 + 20
      - å‡»æ€ > 15 + 40
    - å‡»æ€å æ¯” > 40%
      - å‡»æ€ > 5 + 5
      - å‡»æ€ > 10 + 10
      - å‡»æ€ > 15 + 20
  - ä¼¤å®³å æ¯”ç›¸å…³
    - ä¼¤å®³å æ¯” > 40%
      - å‡»æ€ > 5 + 10
      - å‡»æ€ > 10 + 20
      - å‡»æ€ > 15 + 40
    - ä¼¤å®³å æ¯” > 30%
      - å‡»æ€ > 5 + 5
      - å‡»æ€ > 10 + 10
      - å‡»æ€ > 15 + 20
  - åŠ©æ”»å æ¯”ç›¸å…³
    - åŠ©æ”»å æ¯” > 50%
      - åŠ©æ”» > 5 + 5
      - åŠ©æ”» > 10 + 10
      - åŠ©æ”» > 15 + 20
      - åŠ©æ”» > 18 + 25
      - åŠ©æ”» > 20 + 30
    - åŠ©æ”»å æ¯” > 40%
      - åŠ©æ”» > 5 + 3
      - åŠ©æ”» > 10 + 5
      - åŠ©æ”» > 15 + 15
      - åŠ©æ”» > 20 + 20
- å¾®è°ƒ
  - æ€»åˆ† + (k+a)/d -2 + (k-d)/5 * å‚å›¢ç‡




```