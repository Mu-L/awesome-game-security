Project Path: arc_0xrawsec_whids_dv02cnbj

Source Tree:

```txt
arc_0xrawsec_whids_dv02cnbj
├── CHANGELOG.md
├── LICENSE
├── README.md
├── agent
│   ├── actions.go
│   ├── agent.go
│   ├── agent_test.go
│   ├── commands.go
│   ├── commands_test.go
│   ├── config
│   │   ├── canary.go
│   │   ├── canary_test.go
│   │   ├── canary_windows.go
│   │   ├── config.go
│   │   ├── config_test.go
│   │   ├── etw.go
│   │   ├── etw_test.go
│   │   ├── etw_windows.go
│   │   └── reports.go
│   ├── cron.go
│   ├── defaults.go
│   ├── etw.go
│   ├── eventids.go
│   ├── filters.go
│   ├── guids.go
│   ├── hookdefs.go
│   ├── hooks.go
│   ├── hookutils.go
│   ├── iocs.go
│   ├── paths.go
│   ├── ptrack.go
│   ├── report.go
│   ├── stats.go
│   ├── sysinfo
│   │   ├── sysinfo.go
│   │   ├── sysinfo_test.go
│   │   └── windows_sysinfo.go
│   └── test
│       ├── events.json
│       └── new-events.json
├── api
│   ├── client
│   │   ├── api_client.go
│   │   ├── config
│   │   │   ├── client.go
│   │   │   └── forwarder.go
│   │   ├── forwarder.go
│   │   ├── upload.go
│   │   └── utlis.go
│   ├── command.go
│   ├── default.go
│   ├── endpoint.go
│   ├── headers.go
│   ├── openapi
│   │   └── openapi.go
│   ├── query_params.go
│   ├── reports.go
│   ├── routes.go
│   ├── rules.go
│   └── server
│       ├── adminapi_test.go
│       ├── api_client_test.go
│       ├── command.go
│       ├── config_test.go
│       ├── forwarder_test.go
│       ├── log_streamer.go
│       ├── manager.go
│       ├── manager_admin_api.go
│       ├── manager_endpoint_api.go
│       ├── manager_test_func.go
│       ├── openapi_def.go
│       ├── openapi_test.go
│       ├── users.go
│       └── utils.go
├── doc
│   ├── admin.openapi.json
│   ├── apis.md
│   ├── configuration.md
│   ├── edr-commands.md
│   ├── etw-providers.md
│   ├── events-table.md
│   └── img
│       ├── big-picture.png
│       ├── logo.png
│       └── workflow.png
├── event
│   ├── event.go
│   └── event_test.go
├── go.mod
├── go.sum
├── ioc
│   ├── ioc.go
│   └── ioc_test.go
├── logger
│   ├── events.go
│   ├── index.go
│   ├── logfile.go
│   ├── loggers.go
│   ├── loggers_test.go
│   └── search.go
├── los
│   ├── os.go
│   ├── os_darwin.go
│   ├── os_linux.go
│   └── os_windows.go
├── make.sh
├── sysmon
│   ├── config.go
│   ├── default.go
│   ├── filters.go
│   ├── scripts
│   │   ├── codegen.sh
│   │   └── genstruct.py
│   ├── sysmon.go
│   ├── sysmon_test.go
│   ├── sysmon_windows.go
│   └── sysmon_windows_test.go
├── tools
│   └── tools.go
├── utilities
│   ├── manager
│   │   ├── makefile
│   │   └── whids-man.go
│   ├── sysmon
│   │   ├── makefile
│   │   ├── v10
│   │   │   ├── sysmon-v10.4x-all.xml
│   │   │   ├── sysmon-v10.4x-optimal.xml
│   │   │   ├── sysmon-v10.4x-vbox-optimal.xml
│   │   │   ├── sysmon-v10.x-all.xml
│   │   │   ├── sysmon-v10.x-optimal.xml
│   │   │   └── sysmon-v10.x-vbox-optimal.xml
│   │   ├── v11
│   │   │   ├── schema.xml
│   │   │   ├── sysmon-v11.1x-all.xml
│   │   │   ├── sysmon-v11.1x-optimal.xml
│   │   │   ├── sysmon-v11.1x-vbox-optimal.xml
│   │   │   └── version.txt
│   │   ├── v12
│   │   │   ├── sysmon-v12.x-all.xml
│   │   │   ├── sysmon-v12.x-optimal.xml
│   │   │   ├── sysmon-v12.x-vbox-optimal.xml
│   │   │   └── version.txt
│   │   └── v13
│   │       ├── v13.0x
│   │       │   ├── sysmon-v13.0x-all.xml
│   │       │   ├── sysmon-v13.0x-optimal.xml
│   │       │   └── sysmon-v13.0x-vbox-optimal.xml
│   │       ├── v13.1x
│   │       │   ├── schema.xml
│   │       │   ├── sysmon-v13.1x-all.xml
│   │       │   ├── sysmon-v13.1x-optimal.xml
│   │       │   └── sysmon-v13.1x-vbox-optimal.xml
│   │       ├── v13.2x
│   │       │   ├── schema.xml
│   │       │   ├── sysmon-v13.2x-all.xml
│   │       │   ├── sysmon-v13.2x-optimal.xml
│   │       │   └── sysmon-v13.2x-vbox-optimal.xml
│   │       └── version.txt
│   └── whids
│       ├── main.go
│       ├── makefile
│       ├── manage.bat
│       ├── service.go
│       └── whitelistexts.go
└── utils
    ├── audit.go
    ├── command
    │   ├── command.go
    │   └── command_test.go
    ├── crypto.go
    ├── crypto_test.go
    ├── encoding.go
    ├── encoding_test.go
    ├── files.go
    ├── files_test.go
    ├── net.go
    ├── net_test.go
    ├── powershell
    │   └── powershell.go
    ├── rand.go
    ├── rand_test.go
    ├── sizes.go
    ├── utils.go
    ├── utils_test.go
    ├── windows.go
    └── windows_test.go

```

`CHANGELOG.md`:

```md
# Archive of the old changelog

## v1.6
- **WHIDS** is installed as a true **Windows service**
- Reworked the installation script to allow several options
- Created an **optimized Sysmon configuration** to run with WHIDS
- **Process Integrity** check not done before boot is finished
- Removed DNS logging features by default (since Sysmon v10 has DNSQuery events)
- Log message if process termination is not enabled
- **Sysmon service** depends on WHIDS (solution found not to miss events at boot)
- Updated to the latest version of **Gene (v1.6)**
- New **registry** dump mode to dump suspicious registries
- Some random code refactoring
- Sysmon events enrichment:
    - *Ancestors* in **CreateProcess**
    - Name of the **windows services** is resolved and put in *Services* field for **any event**
    - *CommandLine* in **NetworkConnect**
    - *User* and *IntegrityLevel* propagated to all applicable events (all except DriverLoad)
    - **CreateRemoteThread** and **ProcessAccess** enrichment with:
        * *SourceIntegrityLevel*
        * *TargetIntegrityLevel*
        * *SourceUser*
        * *TargetUser*
        * *TargetParentProcessGuid*
        * *SourceServices*
        * *TargetServices*
    - ...

## v1.5
  * Bunch of code rewritten to make things more consistent:
    * WHIDS is no longer command line based, most of the options are configured via a configuration file
    * Some command line switches names have changed
  * WHIDS manager can now be used as a **true management server**:
    * Update clients' rules
    * Update clients' containers
    * Receive dumps (files, memory) from the clients

## v1.4
  * Dump hooks
    * dump file: dump as many relevant files as possible when an alert above threshold is raised
      * dump anything which is a file and that appears in Sysmon fields, depending on the event
      * can dump ADS
      * can dump scripts
      * can dump executables
    * dump memory: creates a **MS full minidump** of a process that triggers an alert above threshold
  * Process integrity hook
    * Two fields are added to the Sysmon **CreateProcess** events **ProcessIntegrity** and **ParentProcessIntegrity**. If value is **-1** it means process integrity could not be 
    computed. Otherwise it is a float value in **[0;100]** measuring the degree of similarity between the image loaded in memory and the image on the disk. The **higher** the value is, the more likely the process image **has been modified**.
  * Builtin alert forwarder
    * New command line utility **whids-man** aiming at collecting the logs and being deployed on a remote machine (**windows, linux, macos ...**)
      * HTTP / HTTPS are supported (HTTPS is preferred)
      * Builtin cert and key generation (convenient for testing but better with OpenSSL for prod)
      * Client authentication via API key to forward the logs
      * Server authentication can be enforced on client side via authentication key
      * Alerts are dumped in a GZIP file automatically rotated when **100MB** size is reached
    * New command line switch **-forward** to configure forwarding on Host side
      * if manager is offline, we store the alerts in a local queue and upload them when the manager comes up again
      * builtin queue file rotation
      * builtin queued files cleaning if disk space is too high
  * Install script has been updated
    * Protects the installation directory to be accessible / modifiable only by users member of Administrators group or SYSTEM user
    * The scheduled tasks now starts **whids-launcher.bat** located in installation directory, instead of starting WHIDS directly. This way it is easier to modify the command line arguments.
  * Project tree has a bit changed, **main** code has been moved to **tools** directory
      
## v1.3
  * **Event Hook** introduction
    * Can modify the events before going through detection engine
    * Created hooks to overcome domain name resolution issue
    * Implemented hooks to enrich Sysmon events 1, 6 and 7 with the size of the PE image
    * Implemented several other hooks
  * Can run in **service mode**:
    * restart in case of failure
    * log alerts to compressed file and rotate file automatically
    * log messages to a file
  * Installation script
    * creates a scheduled start running at boot to start Whids
    * agenerate an uninstall script dropped in the install folder
  * Number of new command lines arguments
    * **-hooks**: control event hook activation
    * **-protect**: dummy protection against crypto-locker (can be seen as a nice POC of event hooks)
    * **-all**: option to enable logging of **all** the events coming from the monitored channels
    should not be used in production, it is more for debugging purposes
    * ...
  * Some minor code refactoring

## v1.2
  * Log to Windows Application channel
  * Updated with latest version of gene so it benefits of its new features
    * "Match extracts" feature to match parts of event fields against containers (blacklist/whitelist)
  * New channel Alias to Microsoft-Windows-DNS-Client/Operational
  * Command line switch to enable DNS client logs (Microsoft-Windows-DNS-Client/Operational log channel)
```

`LICENSE`:

```
                    GNU AFFERO GENERAL PUBLIC LICENSE
                       Version 3, 19 November 2007

 Copyright (C) 2007 Free Software Foundation, Inc. <https://fsf.org/>
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

                            Preamble

  The GNU Affero General Public License is a free, copyleft license for
software and other kinds of works, specifically designed to ensure
cooperation with the community in the case of network server software.

  The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
our General Public Licenses are intended to guarantee your freedom to
share and change all versions of a program--to make sure it remains free
software for all its users.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.

  Developers that use our General Public Licenses protect your rights
with two steps: (1) assert copyright on the software, and (2) offer
you this License which gives you legal permission to copy, distribute
and/or modify the software.

  A secondary benefit of defending all users' freedom is that
improvements made in alternate versions of the program, if they
receive widespread use, become available for other developers to
incorporate.  Many developers of free software are heartened and
encouraged by the resulting cooperation.  However, in the case of
software used on network servers, this result may fail to come about.
The GNU General Public License permits making a modified version and
letting the public access it on a server without ever releasing its
source code to the public.

  The GNU Affero General Public License is designed specifically to
ensure that, in such cases, the modified source code becomes available
to the community.  It requires the operator of a network server to
provide the source code of the modified version running there to the
users of that server.  Therefore, public use of a modified version, on
a publicly accessible server, gives the public access to the source
code of the modified version.

  An older license, called the Affero General Public License and
published by Affero, was designed to accomplish similar goals.  This is
a different license, not a version of the Affero GPL, but Affero has
released a new version of the Affero GPL which permits relicensing under
this license.

  The precise terms and conditions for copying, distribution and
modification follow.

                       TERMS AND CONDITIONS

  0. Definitions.

  "This License" refers to version 3 of the GNU Affero General Public License.

  "Copyright" also means copyright-like laws that apply to other kinds of
works, such as semiconductor masks.

  "The Program" refers to any copyrightable work licensed under this
License.  Each licensee is addressed as "you".  "Licensees" and
"recipients" may be individuals or organizations.

  To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of an
exact copy.  The resulting work is called a "modified version" of the
earlier work or a work "based on" the earlier work.

  A "covered work" means either the unmodified Program or a work based
on the Program.

  To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.

  To "convey" a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user through
a computer network, with no transfer of a copy, is not conveying.

  An interactive user interface displays "Appropriate Legal Notices"
to the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.

  1. Source Code.

  The "source code" for a work means the preferred form of the work
for making modifications to it.  "Object code" means any non-source
form of a work.

  A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.

  The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
"Major Component", in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.

  The "Corresponding Source" for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.

  The Corresponding Source need not include anything that users
can regenerate automatically from other parts of the Corresponding
Source.

  The Corresponding Source for a work in source code form is that
same work.

  2. Basic Permissions.

  All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.

  You may make, run and propagate covered works that you do not
convey, without conditions so long as your license otherwise remains
in force.  You may convey covered works to others for the sole purpose
of having them make modifications exclusively for you, or provide you
with facilities for running those works, provided that you comply with
the terms of this License in conveying all material for which you do
not control copyright.  Those thus making or running the covered works
for you must do so exclusively on your behalf, under your direction
and control, on terms that prohibit them from making any copies of
your copyrighted material outside their relationship with you.

  Conveying under any other circumstances is permitted solely under
the conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.

  3. Protecting Users' Legal Rights From Anti-Circumvention Law.

  No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.

  When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such circumvention
is effected by exercising rights under this License with respect to
the covered work, and you disclaim any intention to limit operation or
modification of the work as a means of enforcing, against the work's
users, your or third parties' legal rights to forbid circumvention of
technological measures.

  4. Conveying Verbatim Copies.

  You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.

  You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.

  5. Conveying Modified Source Versions.

  You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these conditions:

    a) The work must carry prominent notices stating that you modified
    it, and giving a relevant date.

    b) The work must carry prominent notices stating that it is
    released under this License and any conditions added under section
    7.  This requirement modifies the requirement in section 4 to
    "keep intact all notices".

    c) You must license the entire work, as a whole, under this
    License to anyone who comes into possession of a copy.  This
    License will therefore apply, along with any applicable section 7
    additional terms, to the whole of the work, and all its parts,
    regardless of how they are packaged.  This License gives no
    permission to license the work in any other way, but it does not
    invalidate such permission if you have separately received it.

    d) If the work has interactive user interfaces, each must display
    Appropriate Legal Notices; however, if the Program has interactive
    interfaces that do not display Appropriate Legal Notices, your
    work need not make them do so.

  A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.

  6. Conveying Non-Source Forms.

  You may convey a covered work in object code form under the terms
of sections 4 and 5, provided that you also convey the
machine-readable Corresponding Source under the terms of this License,
in one of these ways:

    a) Convey the object code in, or embodied in, a physical product
    (including a physical distribution medium), accompanied by the
    Corresponding Source fixed on a durable physical medium
    customarily used for software interchange.

    b) Convey the object code in, or embodied in, a physical product
    (including a physical distribution medium), accompanied by a
    written offer, valid for at least three years and valid for as
    long as you offer spare parts or customer support for that product
    model, to give anyone who possesses the object code either (1) a
    copy of the Corresponding Source for all the software in the
    product that is covered by this License, on a durable physical
    medium customarily used for software interchange, for a price no
    more than your reasonable cost of physically performing this
    conveying of source, or (2) access to copy the
    Corresponding Source from a network server at no charge.

    c) Convey individual copies of the object code with a copy of the
    written offer to provide the Corresponding Source.  This
    alternative is allowed only occasionally and noncommercially, and
    only if you received the object code with such an offer, in accord
    with subsection 6b.

    d) Convey the object code by offering access from a designated
    place (gratis or for a charge), and offer equivalent access to the
    Corresponding Source in the same way through the same place at no
    further charge.  You need not require recipients to copy the
    Corresponding Source along with the object code.  If the place to
    copy the object code is a network server, the Corresponding Source
    may be on a different server (operated by you or a third party)
    that supports equivalent copying facilities, provided you maintain
    clear directions next to the object code saying where to find the
    Corresponding Source.  Regardless of what server hosts the
    Corresponding Source, you remain obligated to ensure that it is
    available for as long as needed to satisfy these requirements.

    e) Convey the object code using peer-to-peer transmission, provided
    you inform other peers where the object code and Corresponding
    Source of the work are being offered to the general public at no
    charge under subsection 6d.

  A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.

  A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal, family,
or household purposes, or (2) anything designed or sold for incorporation
into a dwelling.  In determining whether a product is a consumer product,
doubtful cases shall be resolved in favor of coverage.  For a particular
product received by a particular user, "normally used" refers to a
typical or common use of that class of product, regardless of the status
of the particular user or of the way in which the particular user
actually uses, or expects or is expected to use, the product.  A product
is a consumer product regardless of whether the product has substantial
commercial, industrial or non-consumer uses, unless such uses represent
the only significant mode of use of the product.

  "Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to install
and execute modified versions of a covered work in that User Product from
a modified version of its Corresponding Source.  The information must
suffice to ensure that the continued functioning of the modified object
code is in no case prevented or interfered with solely because
modification has been made.

  If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).

  The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or updates
for a work that has been modified or installed by the recipient, or for
the User Product in which it has been modified or installed.  Access to a
network may be denied when the modification itself materially and
adversely affects the operation of the network or violates the rules and
protocols for communication across the network.

  Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.

  7. Additional Terms.

  "Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.

  When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.

  Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders of
that material) supplement the terms of this License with terms:

    a) Disclaiming warranty or limiting liability differently from the
    terms of sections 15 and 16 of this License; or

    b) Requiring preservation of specified reasonable legal notices or
    author attributions in that material or in the Appropriate Legal
    Notices displayed by works containing it; or

    c) Prohibiting misrepresentation of the origin of that material, or
    requiring that modified versions of such material be marked in
    reasonable ways as different from the original version; or

    d) Limiting the use for publicity purposes of names of licensors or
    authors of the material; or

    e) Declining to grant rights under trademark law for use of some
    trade names, trademarks, or service marks; or

    f) Requiring indemnification of licensors and authors of that
    material by anyone who conveys the material (or modified versions of
    it) with contractual assumptions of liability to the recipient, for
    any liability that these contractual assumptions directly impose on
    those licensors and authors.

  All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.

  If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.

  Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions;
the above requirements apply either way.

  8. Termination.

  You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).

  However, if you cease all violation of this License, then your
license from a particular copyright holder is reinstated (a)
provisionally, unless and until the copyright holder explicitly and
finally terminates your license, and (b) permanently, if the copyright
holder fails to notify you of the violation by some reasonable means
prior to 60 days after the cessation.

  Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

  Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.

  9. Acceptance Not Required for Having Copies.

  You are not required to accept this License in order to receive or
run a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.

  10. Automatic Licensing of Downstream Recipients.

  Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.

  An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.

  You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.

  11. Patents.

  A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's "contributor version".

  A contributor's "essential patent claims" are all patent claims
owned or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, "control" includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.

  Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.

  In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.

  If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.

  If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.

  A patent license is "discriminatory" if it does not include within
the scope of its coverage, prohibits the exercise of, or is
conditioned on the non-exercise of one or more of the rights that are
specifically granted under this License.  You may not convey a covered
work if you are a party to an arrangement with a third party that is
in the business of distributing software, under which you make payment
to the third party based on the extent of your activity of conveying
the work, and under which the third party grants, to any of the
parties who would receive the covered work from you, a discriminatory
patent license (a) in connection with copies of the covered work
conveyed by you (or copies made from those copies), or (b) primarily
for and in connection with specific products or compilations that
contain the covered work, unless you entered into that arrangement,
or that patent license was granted, prior to 28 March 2007.

  Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.

  12. No Surrender of Others' Freedom.

  If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey a
covered work so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you may
not convey it at all.  For example, if you agree to terms that obligate you
to collect a royalty for further conveying from those to whom you convey
the Program, the only way you could satisfy both those terms and this
License would be to refrain entirely from conveying the Program.

  13. Remote Network Interaction; Use with the GNU General Public License.

  Notwithstanding any other provision of this License, if you modify the
Program, your modified version must prominently offer all users
interacting with it remotely through a computer network (if your version
supports such interaction) an opportunity to receive the Corresponding
Source of your version by providing access to the Corresponding Source
from a network server at no charge, through some standard or customary
means of facilitating copying of software.  This Corresponding Source
shall include the Corresponding Source for any work covered by version 3
of the GNU General Public License that is incorporated pursuant to the
following paragraph.

  Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the work with which it is combined will remain governed by version
3 of the GNU General Public License.

  14. Revised Versions of this License.

  The Free Software Foundation may publish revised and/or new versions of
the GNU Affero General Public License from time to time.  Such new versions
will be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

  Each version is given a distinguishing version number.  If the
Program specifies that a certain numbered version of the GNU Affero General
Public License "or any later version" applies to it, you have the
option of following the terms and conditions either of that numbered
version or of any later version published by the Free Software
Foundation.  If the Program does not specify a version number of the
GNU Affero General Public License, you may choose any version ever published
by the Free Software Foundation.

  If the Program specifies that a proxy can decide which future
versions of the GNU Affero General Public License can be used, that proxy's
public statement of acceptance of a version permanently authorizes you
to choose that version for the Program.

  Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.

  15. Disclaimer of Warranty.

  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
ALL NECESSARY SERVICING, REPAIR OR CORRECTION.

  16. Limitation of Liability.

  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGES.

  17. Interpretation of Sections 15 and 16.

  If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.

                     END OF TERMS AND CONDITIONS

            How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) <year>  <name of author>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

Also add information on how to contact you by electronic and paper mail.

  If your software can interact with users remotely through a computer
network, you should also make sure that it provides a way for users to
get its source.  For example, if your program is a web application, its
interface could display a "Source" link that leads users to an archive
of the code.  There are many ways you could offer source, and different
solutions will be better for different programs; see section 13 for the
specific requirements.

  You should also get your employer (if you work as a programmer) or school,
if any, to sign a "copyright disclaimer" for the program, if necessary.
For more information on this, and how to apply and follow the GNU AGPL, see
<https://www.gnu.org/licenses/>.

```

`README.md`:

```md
**IMPORTANT:** this README and other documentation is not updated to reflect the changes made to latest beta releases (as a lot of changes happened). All this will be updated in time when a stable version will be released (see [Roadmap until next release](#roadmap-until-next-release)). Feel free to run beta releases on your own and ask questions if you need help.

<p align="center">
  <img src="./doc/img/logo.png" alt="logo" width="40%">
</p>

[![Slack](https://img.shields.io/badge/slack-whids-brightgreen.svg?logo=slack)](https://whids.slack.com/)
[![Coverage](.github/coverage/badge.svg)](https://raw.githubusercontent.com/0xrawsec/whids/master/.github/coverage/coverage.txt)
[![Latest Commit](https://badgen.net/github/last-commit/0xrawsec/whids)](https://github.com/0xrawsec/whids/commits/master)
[![Latest Release](https://badgen.net/github/release/0xrawsec/whids)](https://github.com/0xrawsec/whids/releases)
[![Downloads](https://img.shields.io/github/downloads/0xrawsec/whids/total.svg)]()
[![License](https://badgen.net/github/license/0xrawsec/whids)](https://raw.githubusercontent.com/0xrawsec/whids/master/LICENSE)
[<img src="https://validator.swagger.io/validator?url=https://raw.githubusercontent.com/0xrawsec/whids/master/doc/admin.openapi.json" style="height:20px">](https://validator.swagger.io/?url=https://raw.githubusercontent.com/0xrawsec/whids/master/doc/admin.openapi.json)

## What

**EDR** with artifact collection driven by detection. The detection engine is built on top of a previous project [Gene](https://github.com/0xrawsec/gene) specially designed to match Windows events against user defined rules.

 ### What do you mean by "artifact collection driven by detection" ?

 It means that an alert can directly trigger some artifact collection (file, registry, 
 process memory). This way you are sure you collected the artifacts as soon as you could 
 (near real time).

All this work has been done on my free time in the hope it would help other people, I hope you will enjoy it. Unless I get some funding to further develop this project, I will continue developing it on a best effort basis. I will make all I can to fix issues in time and provide updates. Feel free to open issues to improve that project and keep it alive.

## Why

* Provide an **Open Source EDR** to the community
* Make transparency on the detection rules to make analysts understand why a rule triggered
* Offer powerful detection primitives though a flexible rule engine
* Optimize Incident Response processes by drastically reducing the time between detection and artifact collection

## How

<p align="center">
  <img src="./doc/img/big-picture.png" alt="big-picture">
</p>

**NB:** the EDR agent can be ran standalone (without being connected to an **EDR manager**)

## What you have to know

* It works only on Windows using ETW logs
* Relies on [Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon) for all the heavy lifting (kernel component)
* Very powerful and customizable detection engine (powered by [gene](https://github.com/0xrawsec/gene))
* Built by an Incident Responder for all Incident Responders with the aim of making their job less painful  
* Low footprint -> no process injection
* Can co-exist with **any antivirus** product (advised to run it along with **MS Defender**)
* Designed for high throughput. It can easily enrich and analyze up to 15M events a day per endpoint without performance impact. Good luck to achieve that with a SIEM.
* Easily integrable with other tools (Splunk, ELK, MISP ...)
* Integrated with [ATT&CK framework](https://attack.mitre.org/)
* There is a powerful [administrative API](https://validator.swagger.io/?url=https://raw.githubusercontent.com/0xrawsec/whids/master/doc/admin.openapi.json) to ease management of large deployments (no GUI yet)

# Installation

## Requirements

1. [Install Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon)
2. **Configure Sysmon**
    * You can find optimized Sysmon configurations [here](https://github.com/0xrawsec/whids/tree/master/tools/sysmon)
    * Logging any **ProcessCreate** and **ProcessTerminate** is mandatory
3. Take note of the path to your Sysmon binary because you will need it later on

**NB:** event filtering can be done at 100% with Gene rules so do not bother creating a complicated Sysmon configuration.

## Pre-Installation Recommendations

In order to get the most of WHIDS you might want to improve your logging policy.

- [Enable Powershell Module Logging](https://www.fireeye.com/blog/threat-research/2016/02/greater_visibilityt.html)
- Audit Service Creation: gpedit.msc -> `Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\System Audit Policies\System\Audit Security System Extension` -> Enable
- Enable File System Audit. Sysmon only provides FileCreate events when new files are created, so if you want/need to log other kind of accesses (Read, Write, ...) you need to enable FS Auditing.
    1. gpedit.msc -> `Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\System Audit Policies\Object Access\Audit File System` -> Enable
    2. Right Click Any Folder -> Properties -> Security -> Advanced -> Auditing -> Add
        1. `Select a principal` (put here the name of the user/group you want the audit for). Put group **Everyone** if you want to log access from any user.
        2. `Apply this to` is used to select the scope of this audit policy starting from the folder you have selected
        3. `Basic permissions` select the kinds of accesses you want the logs to be generated for
        4. Validate
    3. File System auditing logs will appear in the `Security` log channel
- If you want an **antivirus** to run on your endpoints, keep **Microsoft Defender**, first because it is a good AV but also because it logs alerts in a [dedicated log channel](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus#windows-defender-av-ids) `Microsoft-Windows-Windows Defender/Operational` monitored by the EDR.

## EDR Endpoint agent (Whids.exe)

This section covers the installation of the agent on the endpoint.

1. Download and extract the latest WHIDS release https://github.com/0xrawsec/whids/releases
2. Run `manage.bat` as **administrator**
3. Launch installation by selecting the appropriate option
4. Verify that files have been created at the **installation directory**
5. Edit configuration file by selecting the appropriate option in `manage.bat` or using your preferred text editor
6. Skip this if running with a connection to a manager, because rules will be updated automatically. If there is nothing in the **rules directory** the tool will be useless, so make sure there are some **gene** rules in there. Some rules are packaged with WHIDS and you will be prompted to choose if you want to install those or not. If you want the last up to date rules, you can get those [here](https://raw.githubusercontent.com/0xrawsec/gene-rules/master/compiled.gen) (take the **compiled** ones)
7. Start the **services** from appropriate option in `manage.bat` or just reboot (**preferred option** otherwise some enrichment fields will be incomplete leading to false alerts)
8. If you configured a **manager** do not forget to run it in order to receive alerts and dumps

**NB:** At installation time the **Sysmon service** will be made *dependent* of **WHIDS service** so that we are sure the EDR runs before **Sysmon** starts generating some events.

## EDR Manager

The EDR manager can be installed on several platforms, pre-built binaries are provided for Windows, Linux and Darwin.

1. Create TLS certificate if needed for HTTPS connections
2. Create a configuration file (there is a command line argument to generate a basic config) 
3. Run the binary

# Configuration Examples

Please visit [doc/configuration.md](doc/configuration.md)

# Further Documentation

* [Endpoint Manager REST API documentation](https://validator.swagger.io/?url=https://raw.githubusercontent.com/0xrawsec/whids/master/doc/admin.openapi.json)
* [How to write rules](https://rawsec.lu/doc/gene/1.6/)
* [Getting EDR detection rules](https://github.com/0xrawsec/gene-rules)
* [Overview of events enrichment](https://github.com/0xrawsec/whids/blob/master/doc/events-table.md)

# Known Issues

* Does not work properly when ran from a network share **mapped as a network drive** (this case prevent whids to identify itself and thus generate some noise). Example: if `\\vbox\test` is mounted as `Z:` drive, running `Z:\whids.exe` **won't work** while running `\\vbox\test\whids.exe` actually would.

# Roadmap until next release

  - [ ] find a new name to the project because we all agree it sucks
  - [X] better sysmon integration (config, deployment, update)
  - [X] endpoint configuration from manager
  - [X] tooling management (update, install), like OSQuery
  - [ ] code refactoring and optimization
  - [X] implement a performance monitor
  - [X] get rid of any on-disk configuration
  - [X] implement IOC management capabilities
  - [X] ETW support
  - [X] automatic documentation (OpenAPI) and testing of manager's API
  - [X] provide endpoint system information in manager
  - [X] implement actionable rules
  - [X] provide canary file management
  - [X] builtin commands to be executed by endpoints
  - [X] provide Incident Response reports about endpoints
  - [X] overall manager API improvement
  - [X] provide event streams so that a client can receive events in realtime
  - [X] standardize HTTP headers
  - [X] provide a python library to interact with EDR manager (https://github.com/0xrawsec/pywhids)


# Changelog

## v1.7
- New Administrative HTTP API with following features:
    - Manage endpoints (list, create, delete)
    - Get basic statistics about the manager
    - Execute commands on endpoints and get results
        * Can drop files prior to execution, to execute binaries/scripts not present on endpoint. Dropped files are deleted after command was ran.
        * Can retrieve files (post command execution), to retrieve results of the command
    - Collect files from endpoints for forensic purposes
    - Contain / Uncontain endpoints by restricting any network traffic except communication to the manager.
    - Query endpoints logs
    - Query endpoints alerts
    - Pivot on a timestamp and retrieve logs/alerts around that time pivot
    - Access endpoint report
        * Scoring (**relative to each environment**) allowing to sort endpoints and spot the ones behaving differently from the others.
        * Alerts / TTPs observed on a given time frame
    - Manage rules (list, create, update, save, delete)
- Integration with Sysmon v12 and v13
    - Integrate ClipboardData events
        * Put the content of the clipboard data inside the event to allow creating rule on the content of the clipboard
    - Integrate ProcessTampering events
        * Enrich event with a diffing score between .text section on disk and in memory
- Implemented certificate pinning on client to enhance security of the communication channel between endpoints and management server
- Log filtering capabilities, allowing one to collect contextual events. Log filtering is achieved by creating Gene filtering rules (c.f. [Gene Documentation](https://github.com/0xrawsec/gene)).
- Configuration files in TOML format for better readability
- Better protection of the installation directory

# Related Work

- Sysmon Based EDR written in PowerShell: https://github.com/ion-storm/sysmon-edr
- Comodo Open Source EDR with user and kernel components: https://github.com/ComodoSecurity/openedr
- Sysmon X: https://github.com/marcosd4h/sysmonx

# Sponsors

[![Tines](https://github.com/0xrawsec/sponsors/blob/master/logos/tines-sponsorship-badge-purple.png)](https://www.tines.com/?utm_source=oss&utm_medium=sponsorship&utm_campaign=whids)

Github:https://github.com/tines  Website:https://www.tines.com/ Twitter:[@tines_io](https://twitter.com/tines_io)

```

`agent/actions.go`:

```go
package agent

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"io"
	"os"
	"path/filepath"
	"regexp"
	"strings"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/crypto/file"
	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-utils/sync/semaphore"
	"github.com/0xrawsec/golang-win32/win32/dbghelp"
	"github.com/0xrawsec/golang-win32/win32/kernel32"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/utils"
)

const (
	// Actions
	ActionKill      = "kill"
	ActionBlacklist = "blacklist"
	ActionMemdump   = "memdump"
	ActionFiledump  = "filedump"
	ActionRegdump   = "regdump"
	ActionReport    = "report"
	ActionBrief     = "brief"

	reportFilename   = "report.json"
	eventFilename    = "event.json"
	registryFilename = "registry.json"
)

var (
	AvailableActions = []string{
		ActionKill,
		ActionBlacklist,
		ActionMemdump,
		ActionFiledump,
		ActionRegdump,
		ActionReport,
		ActionBrief,
	}

	filedumpXPaths = []*engine.XPath{
		pathSysmonImage,
		pathSysmonParentImage,
		pathSysmonSourceImage,
		pathSysmonImageLoaded,
		pathSysmonTargetFilename,
	}

	sysmonArcFileRe = regexp.MustCompile("(((SHA1|MD5|SHA256|IMPHASH)=)|,)")
)

type ActionHandler struct {
	ctx                    context.Context
	edr                    *Agent
	queue                  *datastructs.Fifo
	compressionQueue       *datastructs.Fifo
	compressionLoopRunning bool
	semJobs                semaphore.Semaphore
}

func NewActionHandler(h *Agent) *ActionHandler {
	return &ActionHandler{
		ctx:              h.ctx,
		edr:              h,
		queue:            &datastructs.Fifo{},
		compressionQueue: &datastructs.Fifo{},
		semJobs:          semaphore.New(2)}
}

func (m *ActionHandler) dumpname(src string) string {
	base := strings.Replace(filepath.Base(src), ":", "_ADS_", -1)
	return fmt.Sprintf("%d_%s.bin", time.Now().UnixNano(), base)
}

func (m *ActionHandler) prepare(e *event.EdrEvent, filename string) string {
	id := e.Hash()
	guid := sourceGUIDFromEvent(e)
	dumpDir := filepath.Join(m.edr.config.Dump.Dir, guid, id)
	utils.HidsMkdirAll(dumpDir)
	return filepath.Join(dumpDir, filename)
}

func (m *ActionHandler) shouldDump(e *event.EdrEvent) bool {
	guid := sourceGUIDFromEvent(e)
	return m.edr.tracker.CheckDumpCountOrInc(guid, m.edr.config.Dump.MaxDumps, m.edr.config.Dump.DumpUntracked)
}

func (m *ActionHandler) writeReader(dst string, reader io.Reader) error {
	// compression is managed by compression routine
	return utils.HidsWriteReader(dst, reader, false)
}

func (m *ActionHandler) dumpAsJson(path string, i interface{}) (err error) {
	var b []byte

	if b, err = json.Marshal(i); err != nil {
		return
	} else {
		if err = m.writeReader(path, bytes.NewBuffer(b)); err != nil {
			return
		}
	}
	return
}

func (m *ActionHandler) dumpBinFile(e *event.EdrEvent, src string) error {
	return m.dumpFile(src, m.prepare(e, m.dumpname(src)))
}

func (m *ActionHandler) dumpFile(src, dst string) (err error) {
	var sha256 string

	if !fsutil.IsFile(src) || utils.IsPipePath(src) {
		return
	}

	if err = utils.HidsMkdirAll(filepath.Dir(dst)); err != nil {
		return err
	}

	if sha256, err = file.Sha256(src); err != nil {
		return err
	}

	// dump sha256 of file anyway
	utils.HidsWriteData(fmt.Sprintf("%s.sha256", dst), []byte(sha256))
	// we dump file
	if !m.edr.filedumped.Contains(sha256) {
		var f *os.File
		m.edr.logger.Debugf("Dumping file: %s->%s", src, dst)
		if f, err = os.Open(src); err != nil {
			return
		}
		if err = m.writeReader(dst, f); err != nil {
			return
		}
		// we mark file dumped
		m.edr.filedumped.Add(sha256)
		// queueing compression
		m.queueCompression(dst)
	}
	return
}

func listFilesFromCommandLine(cmdLine string, cwd string) []string {
	files := make([]string, 0)

	if argv, err := utils.ArgvFromCommandLine(cmdLine); err == nil {
		if len(argv) > 1 {
			for _, arg := range argv[1:] {
				if fsutil.IsFile(arg) && !utils.IsPipePath(arg) {
					files = append(files, arg)
				}
				if cwd != "" {
					// relative to CWD
					relarg := filepath.Join(cwd, arg)
					if fsutil.IsFile(arg) && !utils.IsPipePath(arg) {
						files = append(files, relarg)
					}
				}
			}
		}
	}

	return files
}

func (m *ActionHandler) filedumpSet(e *event.EdrEvent) *datastructs.Set {
	s := datastructs.NewSet()

	if pt := m.edr.tracker.SourceTrackFromEvent(e); !pt.IsZero() {
		s.Add(pt.Image)
		s.Add(pt.ParentImage)
		// parse command line
		for _, f := range listFilesFromCommandLine(pt.CommandLine, pt.CurrentDirectory) {
			s.Add(f)
		}
		// parse parent command line
		for _, f := range listFilesFromCommandLine(pt.ParentCommandLine, pt.ParentCurrentDirectory) {
			s.Add(f)
		}
	}

	if e.Channel() == sysmonChannel {
		switch e.EventID() {
		case SysmonRegSetValue:
			if det, ok := e.GetString(pathSysmonDetails); ok {
				for _, f := range listFilesFromCommandLine(det, "") {
					s.Add(f)
				}
			}
		case SysmonWMIConsumer:
			if dest, ok := e.GetString(pathSysmonDestination); ok {
				for _, f := range listFilesFromCommandLine(dest, "") {
					s.Add(f)
				}
			}
		case SysmonFileDelete:
			archived, ok := e.GetBool(pathSysmonArchived)
			if ok && archived {
				if hashes, ok := e.GetString(pathSysmonHashes); ok {
					if target, ok := e.GetString(pathSysmonTargetFilename); ok {
						fname := fmt.Sprintf("%s%s", sysmonArcFileRe.ReplaceAllString(hashes, ""), filepath.Ext(target))
						path := filepath.Join(m.edr.config.Sysmon.ArchiveDirectory, fname)
						s.Add(path)
					}
				}
			}
		}
	}

	for _, p := range filedumpXPaths {
		if filename, ok := e.GetString(p); ok {
			s.Add(filename)
		}
	}

	return s
}

func (m *ActionHandler) filedump(e *event.EdrEvent) {
	hash := e.Hash()
	for _, i := range m.filedumpSet(e).Slice() {
		filename := i.(string)
		if err := m.dumpBinFile(e, filename); err != nil {
			m.edr.logger.Errorf(`Failed to dump file="%s" event=%s`, filename, hash)
		}
	}
}

func (m *ActionHandler) memdump(e *event.EdrEvent) (err error) {
	hash := e.Hash()
	if pt := m.edr.tracker.SourceTrackFromEvent(e); !pt.IsZero() {
		guid := sourceGUIDFromEvent(e)
		pid := int(pt.PID)
		if kernel32.IsPIDRunning(pid) && pid != os.Getpid() && !m.edr.memdumped.Contains(guid) && !m.edr.dumping.Contains(guid) {
			// To avoid dumping the same process twice, possible if two alerts
			// comes from the same GUID in a short period of time
			m.edr.dumping.Add(guid)
			defer m.edr.dumping.Del(guid)

			dumpFilename := fmt.Sprintf("%s_%d_%d.dmp", filepath.Base(pt.Image), pid, time.Now().UnixNano())
			dumpPath := m.prepare(e, dumpFilename)
			if err = dbghelp.FullMemoryMiniDump(pid, dumpPath); err != nil {
				return fmt.Errorf("failed to dump process event=%s pid=%d image=%s: %s", hash, pid, pt.Image, err)
			} else {
				// dump was successfull
				m.edr.memdumped.Add(guid)
				m.queueCompression(dumpPath)
			}
		} else {
			return fmt.Errorf("cannot dump process event=%s pid=%d, process is already terminated", hash, pid)
		}
	} else {
		return fmt.Errorf("cannot dump untracked process event=%s", hash)
	}
	return
}

type RegDump struct {
	Path  string `json:"path"`
	Data  any    `json:"data"`
	Error string `json:"error"`
}

func regDump(path string) (r *RegDump, err error) {
	r = &RegDump{}
	r.Path = path
	if r.Data, err = utils.RegValue(path); err != nil {
		r.Error = err.Error()
		return
	}
	return
}

func (m *ActionHandler) regdump(e *event.EdrEvent) {
	var err error
	var r *RegDump

	if e.Channel() == sysmonChannel {
		switch e.EventID() {
		case SysmonRegSetValue:
			if targetObject, ok := e.GetString(pathSysmonTargetObject); ok {
				if details, ok := e.GetString(pathSysmonDetails); ok {
					// We dump only if Details is "Binary Data" since the other kinds can be seen in the raw event
					if details == "Binary Data" {
						dumpPath := m.prepare(e, registryFilename)
						// retrieving registry
						if r, err = regDump(targetObject); err != nil {
							m.edr.logger.Errorf("failed to retrieve registry value: registry=%s error=%s", targetObject, err)
						}

						// we continue dumping, if any error is encountered, it will be stored in RegDump struct
						if err = m.dumpAsJson(dumpPath, r); err != nil {
							m.edr.logger.Errorf("failed to dump registry: registry=%s error=%s", targetObject, err)
						}

						m.queueCompression(dumpPath)
					}
				}
			}

		}
	}
}

func (m *ActionHandler) suspend_process(e *event.EdrEvent) {
	if pt := m.edr.tracker.SourceTrackFromEvent(e); !pt.IsZero() {
		// additional check not to suspend agent
		if pt.PID != int64(os.Getpid()) {
			// before we kill we suspend the process
			kernel32.SuspendProcess(int(pt.PID))
		}
	}
}

func (m *ActionHandler) kill_process(e *event.EdrEvent) error {
	if pt := m.edr.tracker.SourceTrackFromEvent(e); !pt.IsZero() {
		// additional check not to suspend agent
		if pt.PID != int64(os.Getpid()) {
			if err := pt.TerminateProcess(); err != nil {
				return fmt.Errorf("failed to kill process for event=%s image=%s pid=%d guid=%s", e.Hash(), pt.Image, pt.PID, pt.ProcessGUID)

			}
		}
	}
	return nil
}

func (m *ActionHandler) Queue(e *event.EdrEvent) {
	if !m.edr.IsHIDSEvent(e) && m.edr.config.Endpoint {
		if det := e.GetDetection(); det != nil {
			if det.Actions.Len() > 0 {
				m.queue.Push(e)
			}
		}
	}
}

func (m *ActionHandler) HandleActions(e *event.EdrEvent) {

	det := e.GetDetection()

	if m.shouldDump(e) && !m.edr.IsHIDSEvent(e) && det != nil {
		hash := e.Hash()

		// Test variables
		report := det.Actions.Contains(ActionReport)
		brief := det.Actions.Contains(ActionBrief)
		kill := det.Actions.Contains(ActionKill)

		// handling blacklisting action
		if det.Actions.Contains(ActionBlacklist) {
			if pt := m.edr.tracker.SourceTrackFromEvent(e); !pt.IsZero() {
				// additional check not to blacklist agent
				if int(pt.PID) != os.Getpid() {
					m.edr.tracker.Blacklist(pt.CommandLine)
				}
			}
		}

		if kill {
			// we suspend process before to kill it so that we can
			// memdump it
			m.suspend_process(e)
		}

		// handling report memdumping
		if det.Actions.Contains(ActionMemdump) {
			if err := m.memdump(e); err != nil {
				m.edr.logger.Error(err)
			}
		}

		// we kill the process after we dumped memory
		if kill {
			if err := m.kill_process(e); err != nil {
				m.edr.logger.Error(err)
			}
		}

		// handling report dumping
		if (report || brief) && m.edr.config.Report.EnableReporting {
			reportPath := m.prepare(e, reportFilename)
			if err := m.dumpAsJson(reportPath, m.edr.Report(brief)); err != nil {
				m.edr.logger.Errorf("Failed to dump report for event %s: %s", hash, err)
			} else {
				m.queueCompression(reportPath)
			}
		}

		// handling filedumping
		if det.Actions.Contains(ActionFiledump) {
			m.filedump(e)
		}

		// handling regdumping
		if det.Actions.Contains(ActionRegdump) {
			m.regdump(e)
		}

		// dumping the event
		eventDumpPath := m.prepare(e, eventFilename)
		if err := m.dumpAsJson(eventDumpPath, e); err != nil {
			m.edr.logger.Errorf("Failed to dump event %s: %s", hash, err)
		} else {
			m.queueCompression(eventDumpPath)
		}

	}
}

func (m *ActionHandler) queueCompression(path string) {
	if m.edr.config.Dump.Compression && m.compressionLoopRunning {
		m.compressionQueue.Push(path)
	}
}

func (m *ActionHandler) compressionLoop() {
	if !m.edr.config.Dump.Compression {
		return
	}

	m.compressionLoopRunning = true
	for m.ctx.Err() == nil {
		for m.compressionQueue.Len() > 0 {
			if elt := m.compressionQueue.Pop(); elt != nil {
				path := elt.Value.(string)
				if err := utils.GzipFileBestSpeed(path); err != nil {
					m.edr.logger.Errorf(`Failed to compress %s: %s`, path, err)
				}
			}
		}
		time.Sleep(time.Second)
	}
}

func (m *ActionHandler) handleActionsLoop() {
	for m.ctx.Err() == nil {
		for m.queue.Len() > 0 {
			if elt := m.queue.Pop(); elt != nil {
				evt := elt.Value.(*event.EdrEvent)
				m.semJobs.Acquire()
				go func() {
					defer m.semJobs.Release()
					m.HandleActions(evt)
				}()
			}
		}
		time.Sleep(time.Millisecond * 50)
	}
}

```

`agent/agent.go`:

```go
package agent

import (
	"bytes"
	"compress/gzip"
	"context"
	"fmt"
	"os"
	"os/exec"
	"path/filepath"
	"regexp"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/crony"
	"github.com/0xrawsec/golang-etw/etw"
	"github.com/0xrawsec/golang-win32/win32"
	"github.com/0xrawsec/golang-win32/win32/kernel32"
	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/sod"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/agent/sysinfo"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/api/server"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils"
)

const (

	/** Private const **/

	// Container extension
	containerExt = ".cont.gz"
)

var (
	/** Public vars **/

	ContainRuleName = "EDR containment"
	MaxEPS          = float64(300)
	MaxEPSDuration  = 30 * time.Second

	/** Private vars **/

	// extensions of files to upload to manager
	uploadExts = datastructs.NewInitSyncedSet(".gz", ".sha256")

	archivedRe = regexp.MustCompile(`(CLIP-)??[0-9A-F]{32,}(\..*)?`)

	toolsDir = utils.BinRelativePath("Tools")

	u32PID = uint32(os.Getpid())
)

// Agent structure
type Agent struct {
	sync.RWMutex // Mutex to lock the IDS when updating rules
	ctx          context.Context
	cancel       context.CancelFunc

	// task scheduler
	scheduler *crony.Crony

	eventProvider   *etw.Consumer
	stats           *EventStats
	preHooks        *HookManager
	postHooks       *HookManager
	forwarder       *client.Forwarder
	channels        *datastructs.SyncedSet // Windows log channels to listen to
	channelsSignals chan bool
	config          *config.Agent
	waitGroup       sync.WaitGroup

	flagProcTermEn bool
	bootCompleted  bool
	// Sysmon GUID of HIDS process
	guid          string
	tracker       *ActivityTracker
	actionHandler *ActionHandler
	memdumped     *datastructs.SyncedSet
	dumping       *datastructs.SyncedSet
	filedumped    *datastructs.SyncedSet

	systemInfo *sysinfo.SystemInfo

	// local structure database
	db *sod.DB

	//logger
	logger *golog.Logger

	Engine   *engine.Engine
	DryRun   bool
	PrintAll bool
}

func newActionnableEngine(c *config.Agent) (e *engine.Engine) {
	e = engine.NewEngine()
	e.ShowActions = true
	if c.Actions.Low != nil {
		e.SetDefaultActions(config.ActionLowLow, config.ActionLowHigh, c.Actions.Low)
	}
	if c.Actions.Medium != nil {
		e.SetDefaultActions(config.ActionMediumLow, config.ActionMediumHigh, c.Actions.Medium)
	}
	if c.Actions.High != nil {
		e.SetDefaultActions(config.ActionHighLow, config.ActionHighHigh, c.Actions.High)
	}
	if c.Actions.Critical != nil {
		e.SetDefaultActions(config.ActionCriticalLow, config.ActionCriticalHigh, c.Actions.Critical)
	}
	return
}

// NewAgent creates a new Agent object from configuration
func NewAgent(c *config.Agent) (a *Agent, err error) {

	a = &Agent{}
	a.Initialize()

	err = a.Prepare(c)

	return
}

func (a *Agent) Initialize() {
	// context inititialization
	ctx, cancel := context.WithCancel(context.Background())

	a.ctx = ctx
	a.cancel = cancel
	a.scheduler = crony.NewWithContext(ctx)
	a.eventProvider = etw.NewRealTimeConsumer(ctx)
	a.stats = NewEventStats(MaxEPS, MaxEPSDuration)
	a.preHooks = NewHookMan()
	a.postHooks = NewHookMan()
	a.channels = datastructs.NewSyncedSet()
	a.channelsSignals = make(chan bool)
	a.waitGroup = sync.WaitGroup{}
	a.tracker = NewActivityTracker()
	a.memdumped = datastructs.NewSyncedSet()
	a.dumping = datastructs.NewSyncedSet()
	a.filedumped = datastructs.NewSyncedSet()
	// has to be empty to post structure the first time
	a.systemInfo = &sysinfo.SystemInfo{}
	a.logger = golog.FromStdout()
}

func (a *Agent) Prepare(c *config.Agent) (err error) {
	// assigning configuration to agent
	a.config = c

	// opening database
	a.db = sod.Open(c.DatabasePath)

	// initializing action manager
	a.actionHandler = NewActionHandler(a)

	// Creates missing directories
	if err = c.Prepare(); err != nil {
		return
	}

	// Create logfile asap if needed
	if c.Logfile != "" {
		if a.logger, err = golog.FromPath(c.Logfile, 0600); err != nil {
			return
		}
	}

	// initialize database
	if err = a.initDB(); err != nil {
		return
	}

	// Verify configuration
	if err = c.Verify(); err != nil {
		return
	}

	// loading forwarder config
	if a.forwarder, err = client.NewForwarder(a.ctx, &a.config.FwdConfig, a.logger); err != nil {
		return
	}

	// cleaning up previous runs
	a.cleanup()

	// initialization
	a.initEnvVariables()
	a.initEventProvider()
	a.initHooks(c.EnableHooks)
	// schedule tasks
	a.scheduleTasks()
	// fixing local audit policies if necessary
	a.configureAuditPolicies()

	// update and load engine
	if err = a.update(true); err != nil {
		return
	}

	return
}

/** Private Methods **/

func (a *Agent) initEnvVariables() {
	os.Setenv(los.PathEnvVar, los.BuildPathEnv(los.GetPathEnv(), toolsDir))
}

func (a *Agent) initDB() (err error) {

	if err = a.db.Create(&tools.Tool{}, sod.DefaultSchema); err != nil {
		return
	}

	return
}

func (a *Agent) initEventProvider() {

	// parses the providers and init filters
	for _, sprov := range a.config.EtwConfig.UnifiedProviders() {
		if prov, err := etw.ParseProvider(sprov); err != nil {
			a.logger.Errorf("Error while parsing provider %s: %s", sprov, err)
		} else {
			a.eventProvider.Filter.Update(&prov)
		}
	}

	// open traces
	a.eventProvider.FromTraceNames(a.config.EtwConfig.UnifiedTraces()...)

	// if we have file trace enabled
	if a.config.EtwConfig.FileTraceEnabled() {
		a.eventProvider.EventRecordCallback = a.eventRecordCallback
		a.eventProvider.PreparedCallback = a.preparedCallback
	}

}

func (a *Agent) initHooks(advanced bool) {
	// We enable those hooks anyway since it is needed to skip
	// events generated by WHIDS process. These ar very light hooks
	a.preHooks.Hook(hookSelfGUID, fltProcessCreate)
	a.preHooks.Hook(hookProcTerm, fltProcTermination)
	a.preHooks.Hook(hookStats, fltStats)
	a.preHooks.Hook(hookTrack, fltTrack)

	if advanced {
		// Process terminator hook, terminating blacklisted (by action) processes
		a.preHooks.Hook(hookTerminator, fltProcessCreate)
		a.preHooks.Hook(hookImageLoad, fltImageLoad)
		a.preHooks.Hook(hookSetImageSize, fltImageSize)
		a.preHooks.Hook(hookProcessIntegrityProcTamp, fltImageTampering)
		a.preHooks.Hook(hookEnrichServices, fltAnySysmon)
		a.preHooks.Hook(hookClipboardEvents, fltClipboard)
		a.preHooks.Hook(hookFileSystemAudit, fltFSObjectAccess)
		// Must be run the last as it depends on other filters
		a.preHooks.Hook(hookEnrichAnySysmon, fltAnySysmon)
		a.preHooks.Hook(hookKernelFiles, fltKernelFile)

		// This hook must run before action handling as we want
		// the gene score to be set before an eventual reporting
		a.postHooks.Hook(hookUpdateGeneScore, fltAnyEvent)
	}
}

func (a *Agent) configureAuditPolicies() {
	c := a.config.AuditConfig

	if c.Enable {
		for _, ap := range c.AuditPolicies {
			if err := utils.EnableAuditPolicy(ap); err != nil {
				a.logger.Errorf("Failed to enable audit policy %s: %s", ap, err)
			} else {
				a.logger.Infof("Enabled Audit Policy: %s", ap)
			}
		}
	}

	// run this function async as it might take a little bit of time
	go func() {
		dirs := utils.StdDirs(utils.ExpandEnvs(c.AuditDirs...)...)
		if len(dirs) > 0 {
			a.logger.Infof("Setting ACLs for directories: %s", strings.Join(dirs, ", "))
			if err := utils.SetEDRAuditACL(dirs...); err != nil {
				a.logger.Errorf("Error while setting configured File System Audit ACLs: %s", err)
			}
			a.logger.Infof("Finished setting up ACLs for directories: %s", strings.Join(dirs, ", "))
		}
	}()
}

func (a *Agent) update(force bool) (last error) {
	var reloadRules, reloadContainers bool

	// check that we are connected to any manager
	if a.config.IsForwardingEnabled() {
		reloadRules = a.needsRulesUpdate()
		reloadContainers = a.needsIoCsUpdate()
	}

	// check if we need rule update
	if reloadRules {
		a.logger.Info("Updating WHIDS rules")
		if err := a.fetchRulesFromManager(); err != nil {
			a.logger.Errorf("Failed to fetch rules from manager: %s", err)
			reloadRules = false
		}
	}

	if reloadContainers {
		a.logger.Info("Updating WHIDS containers")
		if err := a.fetchIoCsFromManager(); err != nil {
			a.logger.Errorf("Failed to fetch containers from manager: %s", err)
			reloadContainers = false
		}
	}

	a.logger.Debugf("reloading rules:%t containers:%t forced:%t", reloadRules, reloadContainers, force)
	if reloadRules || reloadContainers || force {
		// We need to create a new engine if we received a rule/containers update
		newEngine := newActionnableEngine(a.config)

		// containers must be loaded before the rules anyway
		a.logger.Infof("Loading HIDS containers (used in rules) from: %s", a.config.RulesConfig.ContainersDB)
		if err := a.loadContainers(newEngine); err != nil {
			err = fmt.Errorf("failed at loading containers: %s", err)
			last = err
		}

		// Loading IOC container rules
		for _, rule := range IoCRules {
			if err := newEngine.LoadRule(&rule); err != nil {
				a.logger.Errorf("Failed to load IoC rule: %s", err)
				last = err
			}
		}

		// Loading canary rules
		if a.config.CanariesConfig.Enable {
			a.logger.Infof("Loading canary rules")
			// Sysmon rule
			sr := a.config.CanariesConfig.GenRuleSysmon()
			if err := newEngine.LoadRule(&sr); err != nil {
				a.logger.Errorf("Failed to load canary rule: %s", err)
				last = err
			}

			// File System Audit Rule
			fsr := a.config.CanariesConfig.GenRuleFSAudit()
			if err := newEngine.LoadRule(&fsr); err != nil {
				a.logger.Errorf("Failed to load canary rule: %s", err)
				last = err
			}

			// File System Audit Rule
			kfr := a.config.CanariesConfig.GenRuleKernelFile()
			if err := newEngine.LoadRule(&kfr); err != nil {
				a.logger.Errorf("Failed to load canary rule: %s", err)
				last = err
			}
		}

		// Loading rules
		a.logger.Infof("Loading HIDS rules from: %s", a.config.RulesConfig.RulesDB)
		if err := newEngine.LoadDirectory(a.config.RulesConfig.RulesDB); err != nil {
			last = fmt.Errorf("failed to load rules: %s", err)
		}
		a.logger.Infof("Number of rules loaded in engine: %d", newEngine.Count())

		// updating engine if no error
		if last == nil {
			// we update engine only if there was no error
			// no need to lock HIDS as newEngine is ready to use at this point
			a.Engine = newEngine
		} else {
			a.logger.Error("EDR engine not updated:", last)
		}
	} else {
		a.logger.Debug("Neither rules nor containers need to be updated")
	}

	return
}

// rules needs to be updated with the new ones available in manager
func (a *Agent) needsRulesUpdate() bool {
	var err error
	var oldSha256, sha256 string
	_, rulesSha256Path := a.config.RulesConfig.RulesPaths()

	// Don't need update if not connected to a manager
	if !a.config.IsForwardingEnabled() {
		return false
	}

	if sha256, err = a.forwarder.Client.GetRulesSha256(); err != nil {
		a.logger.Errorf("Failed to fetch rules sha256: %s", err)
		return false
	}

	oldSha256, _ = utils.ReadFileAsString(rulesSha256Path)

	// log message only if we need to update
	if oldSha256 != sha256 {
		a.logger.Infof("Rules: remote=%s local=%s", sha256, oldSha256)
	}

	return oldSha256 != sha256
}

// returns true if a container needs to be updated
func (a *Agent) needsIoCsUpdate() bool {
	var localSha256, remoteSha256 string

	// Don't need update if not connected to a manager
	if !a.config.IsForwardingEnabled() {
		return false
	}

	container := server.IoCContainerName
	_, locContSha256Path := a.containerPaths(container)

	// means that remoteCont is also a local container
	remoteSha256, _ = a.forwarder.Client.GetIoCsSha256()
	localSha256, _ = utils.ReadFileAsString(locContSha256Path)

	// log message only if we need to update
	if localSha256 != remoteSha256 {
		a.logger.Infof("container %s: remote=%s local=%s", container, remoteSha256, localSha256)
	}

	return localSha256 != remoteSha256
}

func (a *Agent) fetchRulesFromManager() (err error) {
	var rules, sha256 string

	rulePath, sha256Path := a.config.RulesConfig.RulesPaths()

	// if we are not connected to a manager we return
	if a.config.FwdConfig.Local {
		return
	}

	a.logger.Infof("Fetching new rules available in manager")
	if sha256, err = a.forwarder.Client.GetRulesSha256(); err != nil {
		return err
	}

	if rules, err = a.forwarder.Client.GetRules(); err != nil {
		return err
	}

	if sha256 != data.Sha256([]byte(rules)) {
		return fmt.Errorf("failed to verify rules integrity")
	}

	os.WriteFile(sha256Path, []byte(sha256), 0600)
	return os.WriteFile(rulePath, []byte(rules), 0600)
}

// containerPaths returns the path to the container and the path to its sha256 file
func (a *Agent) containerPaths(container string) (path, sha256Path string) {
	path = filepath.Join(a.config.RulesConfig.ContainersDB, fmt.Sprintf("%s%s", container, containerExt))
	sha256Path = fmt.Sprintf("%s.sha256", path)
	return
}

func (a *Agent) fetchIoCsFromManager() (err error) {
	var iocs []string
	cl := a.forwarder.Client

	// if we are not connected to a manager we return
	if a.config.FwdConfig.Local {
		return
	}

	if iocs, err = cl.GetIoCs(); err != nil {
		return
	}

	// we compare the integrity of the container received
	compSha256 := utils.Sha256StringSlice(iocs)

	if sha256, err := cl.GetIoCsSha256(); err != nil {
		return fmt.Errorf("failed to get IoCs sha256: %s", err)
	} else if compSha256 != sha256 {
		return fmt.Errorf("failed to verify container \"%s\" integrity", server.IoCContainerName)
	}

	// we dump the container
	contPath, contSha256Path := a.containerPaths(server.IoCContainerName)
	fd, err := utils.HidsCreateFile(contPath)
	if err != nil {
		return err
	}
	// closing underlying file
	defer fd.Close()

	w := gzip.NewWriter(fd)
	// closing gzip writer
	defer w.Close()
	for _, ioc := range iocs {
		if _, err = w.Write([]byte(fmt.Sprintln(ioc))); err != nil {
			return
		}
	}

	if err = w.Close(); err != nil {
		return
	}

	if err = fd.Close(); err != nil {
		return
	}

	// Dump current container sha256 to a file
	return os.WriteFile(contSha256Path, []byte(compSha256), 0600)
}

// loads containers found in container database directory
func (a *Agent) loadContainers(engine *engine.Engine) (lastErr error) {
	for wi := range fswalker.Walk(a.config.RulesConfig.ContainersDB) {
		for _, fi := range wi.Files {
			path := filepath.Join(wi.Dirpath, fi.Name())
			// we take only files with good extension
			if strings.HasSuffix(fi.Name(), containerExt) {
				cont := strings.SplitN(fi.Name(), ".", 2)[0]
				fd, err := os.Open(path)
				if err != nil {
					lastErr = err
					continue
				}
				r, err := gzip.NewReader(fd)
				if err != nil {
					lastErr = err
					// we close file descriptor
					fd.Close()
					continue
				}
				a.logger.Infof("Loading container %s from path %s", cont, path)
				if err = engine.LoadContainer(cont, r); err != nil {
					lastErr = fmt.Errorf("failed to load container %s: %s", cont, err)
					a.logger.Error(lastErr)
				}
				r.Close()
				fd.Close()
			}
		}
	}
	return
}

func (a *Agent) updateSystemInfo() (err error) {
	var hnew, hold string

	new := sysinfo.NewSystemInfo()
	if hnew, err = utils.Sha256Interface(new); err != nil {
		// we return cause we don't want to overwrite with
		// a faulty structure
		return
	}

	// if it returns an error we don't really care because
	// it will be replaced by new
	hold, _ = utils.Sha256Interface(a.systemInfo)

	if hnew != hold {
		a.systemInfo = new
		return a.forwarder.Client.PostSystemInfo(a.systemInfo)
	}

	return
}

/*
Warning: we cannot use binary hash information to decide wether we
need to update because Sysmon.exe (32 bit version) contains both the
32 and 64 bit version of the tool. When Sysmon gets installed only one
of the two versions is installed.
*/
func (a *Agent) updateSysmonBin() (err error) {
	var version string
	var si *sysmon.Info

	if si, err = sysmon.NewSysmonInfo(); err != nil {
		return
	}

	sysmonPath := filepath.Join(toolsDir, tools.WithExecExt(tools.ToolSysmon))

	if !fsutil.IsFile(sysmonPath) {
		// no Sysmon tool so nothing to do
		return
	}

	if version, _, _, err = sysmon.Versions(sysmonPath); err != nil {
		return fmt.Errorf("failed to retrieve tool's version: %w", err)
	}

	if si.Version == version {
		// Sysmon in tools' directory is same version as
		// the one installed -> nothing to do
		return
	}

	// we install or update Sysmon
	a.logger.Infof("Install/updating sysmon old=%s new=%s", si.Version, version)
	if err = sysmon.InstallOrUpdate(sysmonPath); err != nil {
		return fmt.Errorf("failed to install/update sysmon: %w", err)
	}

	// updating system information before config update as config update
	// may return on error
	if err = a.updateSystemInfo(); err != nil {
		return fmt.Errorf("failed to update system info: %w", err)
	}

	a.logger.Info("Updating sysmon config")
	// we update configuration
	if err = a.updateSysmonConfig(); err != nil {
		return fmt.Errorf("failed to update sysmon config: %w", err)
	}

	return
}

func (a *Agent) updateSysmonConfig() (err error) {
	var remoteSha256 string
	var xml []byte
	var cfg *sysmon.Config

	c := a.forwarder.Client
	systemInfo := sysinfo.NewSystemInfo()
	schemaVersion := systemInfo.Sysmon.Config.Version.Schema
	sha256 := systemInfo.Sysmon.Config.Hash

	remoteSha256, err = c.GetSysmonConfigSha256(schemaVersion)

	switch err {
	case nil:
		// if we go here it means there is a configuration available in manager
		// Nothing to do
		if remoteSha256 == sha256 {
			return
		}

		// getting sysmon configuration from manager
		if cfg, err = c.GetSysmonConfig(schemaVersion); err != nil {
			return
		}

	case client.ErrNoSysmonConfig:
		// no configuration available on the manager

		a.logger.Info("No Sysmon config found on manager, trying to use default config")

		if cfg, err = sysmon.AgnosticConfig(schemaVersion); err != nil {
			return
		}

	default:
		return
	}

	if sha256 == cfg.XmlSha256 {
		// we can skip sysmon configuration update as the current configuration
		// is the same as the one we want to apply
		return
	}

	a.logger.Infof("Deploying new sysmon configuration old=%s new=%s", sha256, cfg.XmlSha256)
	if xml, err = cfg.XML(); err != nil {
		return
	}

	if err = sysmon.Configure(bytes.NewBuffer(xml)); err != nil {
		return fmt.Errorf("failed to configure sysmon: %w", err)
	}

	if err = a.updateSystemInfo(); err != nil {
		err = fmt.Errorf("failed to update system info: %w", err)
	}

	return
}

func (a *Agent) updateAgentConfig() (err error) {
	var newConf *config.Agent
	var localSha256, remoteSha256 string

	c := a.forwarder.Client

	if localSha256, err = a.config.Sha256(); err != nil {
		return fmt.Errorf("failed to compute local config sha256: %w", err)
	}

	remoteSha256, err = c.GetAgentConfigSha256()

	switch err {
	case nil:
		if localSha256 == remoteSha256 {
			// nothing to do
			return
		}

	case client.ErrNoAgentConfig:
		return c.PostAgentConfig(a.config)

	default:
		return
	}

	// we need to get configuration from manager
	if newConf, err = c.GetAgentConfig(); err != nil {
		return fmt.Errorf("failed to get agent config: %w", err)
	}

	a.logger.Infof("received endpoint configuration update old=%s new=%s, saving it at %s", localSha256, remoteSha256, a.config.Path())
	// overwrite current configuration
	newConf.Save(a.config.Path())

	a.logger.Infof("stopping agent after update")
	a.Stop()
	a.Wait()

	a.Initialize()
	if err = a.Prepare(newConf); err != nil {
		err = fmt.Errorf("failed to prepare agent with new configuration: %w", err)
		return
	}
	a.logger.Infof("restarting agent after update")
	a.Run()

	return
}

func (a *Agent) cleanup() {
	// Cleaning up empty dump directories if needed
	fis, _ := os.ReadDir(a.config.Dump.Dir)
	for _, fi := range fis {
		if fi.IsDir() {
			fp := filepath.Join(a.config.Dump.Dir, fi.Name())
			if utils.CountFiles(fp) == 0 {
				os.RemoveAll(fp)
			}
		}
	}
}

/** Public Methods **/

// IsHIDSEvent returns true if the event is generated by IDS activity
func (a *Agent) IsHIDSEvent(e *event.EdrEvent) bool {
	if pguid, ok := e.GetString(pathSysmonParentProcessGUID); ok {
		if pguid == a.guid {
			return true
		}
	}

	if guid, ok := e.GetString(pathSysmonProcessGUID); ok {
		if guid == a.guid {
			return true
		}
		// search for parent in processTracker
		if pt := a.tracker.GetByGuid(guid); !pt.IsZero() {
			if pt.ParentProcessGUID == a.guid {
				return true
			}
		}
	}
	if sguid, ok := e.GetString(pathSysmonSourceProcessGUID); ok {
		if sguid == a.guid {
			return true
		}
		// search for parent in processTracker
		if pt := a.tracker.GetByGuid(sguid); !pt.IsZero() {
			if pt.ParentProcessGUID == a.guid {
				return true
			}
		}
	}
	return false
}

// Report generate a forensic ready report (meant to be dumped)
// this method is blocking as it runs commands and wait after those
func (a *Agent) Report(light bool) (r Report) {
	r.StartTime = time.Now()

	// generate a report for running processes or those terminated still having one child or more
	// do this step first not to polute report with commands to run
	r.Processes = a.tracker.PS()

	// Modules ever loaded
	r.Modules = a.tracker.Modules()

	// Drivers loaded
	r.Drivers = a.tracker.Drivers

	// if this is a light report, we don't run the commands
	if !light {
		// run all the commands configured to include in the report
		r.Commands = a.config.Report.PrepareCommands()
		for i := range r.Commands {
			r.Commands[i].Run()
		}
	}

	r.StopTime = time.Now()
	return
}

func (a *Agent) eventScanRoutine() {
	var kernelTracked bool
	var rtlost uint

	// Trying to raise thread priority
	if err := kernel32.SetCurrentThreadPriority(win32.THREAD_PRIORITY_ABOVE_NORMAL); err != nil {
		a.logger.Errorf("Failed to raise IDS thread priority: %s", err)
	}

	for e := range a.eventProvider.Events {
		event := event.NewEdrEvent(e)

		if uint64(a.stats.counter.event)%1000 == 0 && a.eventProvider.LostEvents > 0 {
			a.logger.Warnf("Received %d RTLostEvent events, if the agent went off for a while this is normal. If you see this message at every boot or more often it is a symptom of a bad ETW configuration (more events are received than the agent can process).", a.eventProvider.LostEvents)
			if rtlost > 5 {
				a.logger.Criticalf("Several events lost, something is wrong with ETW configuration")
			}
			// we reset the counter of lost events not to trigger this all the time
			a.eventProvider.LostEvents = 0
			rtlost++
		}

		if yes, eps := a.stats.HasPerfIssue(); yes {
			a.logger.Warnf("Average event rate above limit of %.2f e/s in the last %s: %.2f e/s", a.stats.Threshold(), a.stats.Duration(), eps)

			if a.stats.HasCriticalPerfIssue() {
				a.logger.Critical("Event throughput too high for too long, consider filtering out events")
			} else if crit := a.stats.CriticalEPS(); eps > crit {
				a.logger.Criticalf("Event throughput above %.0fx the limit, if repeated consider filtering out events", eps/a.stats.Threshold())
			}
		}

		// tracking kernel
		if !kernelTracked {
			if kernelTracked = a.tracker.TrackKernel(event); kernelTracked {
				a.logger.Infof("Found kernel GUID=%s PID=%d", a.tracker.kernel.ProcessGUID, a.tracker.kernel.PID)
			}
		}

		// Warning message in certain circumstances
		if a.config.EnableHooks && !a.flagProcTermEn && a.stats.Events() > 0 && int64(a.stats.Events())%1000 == 0 {
			a.logger.Warn("Sysmon process termination events seem to be missing. WHIDS won't work as expected.")
		}

		a.RLock()

		// Runs pre detection hooks
		// putting this before next condition makes the processTracker registering
		// HIDS events and allows detecting ProcessAccess events from HIDS childs
		a.preHooks.RunHooksOn(a, event)

		// We skip if it is one of IDS event
		// we keep process termination event because it is used to control if process termination is enabled
		if a.IsHIDSEvent(event) && !isSysmonProcessTerminate(event) {
			if a.PrintAll {
				fmt.Println(utils.JsonStringOrPanic(event))
			}
			goto CONTINUE
		}

		// if event is skipped we don't log it even with PrintAll
		if event.IsSkipped() {
			a.stats.Update(event)
			goto CONTINUE
		}

		// if the event has matched at least one signature or is filtered
		if n, crit, filtered := a.Engine.MatchOrFilter(event); len(n) > 0 || filtered {
			switch {
			case crit >= a.config.CritTresh:
				if !a.PrintAll && !a.config.LogAll {
					if err := a.forwarder.PipeEvent(event); err != nil {
						a.logger.Errorf("failed to pipe event: %s", err)
					}
				}
				// Pipe the event to be sent to the forwarder
				// Run hooks post detection
				a.postHooks.RunHooksOn(a, event)
				a.stats.Update(event)
			case filtered && a.config.EnableFiltering && !a.PrintAll && !a.config.LogAll:
				//event.Del(&engine.GeneInfoPath)
				// we pipe filtered event
				if err := a.forwarder.PipeEvent(event); err != nil {
					a.logger.Errorf("failed to pipe event: %s", err)
				}
			}
		}

		// we queue event in action handler
		a.actionHandler.Queue(event)

		// Print everything
		if a.PrintAll {
			fmt.Println(utils.JsonStringOrPanic(event))
		}

		// We log all events
		if a.config.LogAll {
			if err := a.forwarder.PipeEvent(event); err != nil {
				a.logger.Errorf("failed to pipe event: %s", err)
			}
		}

		a.stats.Update(event)

	CONTINUE:
		a.RUnlock()
	}

	a.logger.Infof("HIDS main loop terminated")
}

// Run starts the WHIDS engine and waits channel listening is stopped
func (a *Agent) Run() (err error) {

	// start task scheduler
	a.scheduler.Start()

	for _, t := range a.scheduler.Tasks() {
		a.logger.Infof("Scheduler running: %s (async=%t) (scheduled=%t)", t.Name, t.IsAsync(), t.IsScheduled())
	}

	// Dry run don't do anything
	if a.DryRun {
		for _, trace := range a.config.EtwConfig.UnifiedTraces() {
			a.logger.Infof("Dry run: would open trace %s", trace)
		}
		return
	}

	// Starting event provider
	if err = a.eventProvider.Start(); err != nil {
		return
	}

	// start stats monitoring
	a.stats.Start()

	a.waitGroup.Add(1)
	go func() {
		defer a.waitGroup.Done()
		a.eventScanRoutine()
	}()

	// Run bogus command so that at least one Process Terminate
	// is generated (used to check if process termination events are enabled)
	exec.Command(os.Args[0], "-h").Start()
	return
}

// LogStats logs whids statistics
func (a *Agent) LogStats() {
	a.logger.Infof("Time Running: %s", a.stats.SinceStart())
	a.logger.Infof("Count Event Scanned: %.0f", a.stats.Events())
	a.logger.Infof("Average Event Rate: %.2f EPS", a.stats.EPS())
	a.logger.Infof("Alerts Reported: %.0f", a.stats.Detections())
	a.logger.Infof("Count Rules Used (loaded + generated): %d", a.Engine.Count())
}

// Stop stops the IDS
func (a *Agent) Stop() {
	a.logger.Infof("Stopping HIDS")
	// cancelling parent context
	a.cancel()
	// gently close forwarder needs to be done before
	// stop listening othewise we corrupt local logfiles
	// because of race condition
	a.logger.Infof("Closing forwarder")
	a.forwarder.Close()

	// closing event provider
	a.logger.Infof("Closing event provider")
	if err := a.eventProvider.Stop(); err != nil {
		a.logger.Errorf("Error while closing event provider: %s", err)
	}

	// cleaning canary files
	if a.config.CanariesConfig.Enable {
		a.logger.Infof("Cleaning canaries")
		a.config.CanariesConfig.Clean()
	}

	// updating autologger configuration
	a.logger.Infof("Updating autologger configuration")
	if err := config.Autologger.Delete(); err != nil {
		a.logger.Errorf("Failed to delete autologger: %s", err)
	}

	if err := a.config.EtwConfig.ConfigureAutologger(); err != nil {
		a.logger.Errorf("Failed to update autologger configuration: %s", err)
	}

	a.logger.Infof("HIDS stopped")
}

// Wait waits the IDS to finish
func (a *Agent) Wait() {
	a.waitGroup.Wait()
}

// WaitWithTimeout waits the IDS to finish
func (a *Agent) WaitWithTimeout(timeout time.Duration) {
	var slept time.Duration

	step := time.Millisecond * 25
	stop := make(chan bool)

	go func() {
		a.Wait()
		stop <- true
	}()

	for {
		select {
		case <-stop:
			return
		default:
			if slept >= timeout {
				return
			}
			time.Sleep(step)
			slept += step
		}
	}
}

```

`agent/agent_test.go`:

```go
package agent

import (
	"bytes"
	"context"
	"encoding/xml"
	"errors"
	"fmt"
	"math/rand"
	"os"
	"path/filepath"
	"regexp"
	"strconv"
	"strings"
	"testing"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-etw/etw"
	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/api"
	cconfig "github.com/0xrawsec/whids/api/client/config"
	"github.com/0xrawsec/whids/api/server"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/ioc"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils"
	"github.com/0xrawsec/whids/utils/command"
)

var (
	sysmonInstalled bool

	sysmonTestConfig = `<Sysmon schemaversion="%s">
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>
    <ProcessCreate onmatch="exclude"></ProcessCreate>
    <FileCreateTime onmatch="exclude"></FileCreateTime>
    <NetworkConnect onmatch="exclude"></NetworkConnect>
    <ProcessTerminate onmatch="exclude"></ProcessTerminate>
    <DriverLoad onmatch="exclude"></DriverLoad>
    <CreateRemoteThread onmatch="exclude"></CreateRemoteThread>
    <RawAccessRead onmatch="exclude"></RawAccessRead>
    <FileCreate onmatch="exclude"></FileCreate>
    <FileCreateStreamHash onmatch="exclude"></FileCreateStreamHash>
    <PipeEvent onmatch="exclude"></PipeEvent>
    <WmiEvent onmatch="exclude"></WmiEvent>
    <FileDelete onmatch="exclude"></FileDelete>
    <ClipboardChange onmatch="exclude"></ClipboardChange>
    <ProcessTampering onmatch="exclude"></ProcessTampering>
    <FileDeleteDetected onmatch="exclude"></FileDeleteDetected>
    <RuleGroup groupRelation="or">
      <ImageLoad onmatch="exclude">
      </ImageLoad>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <ProcessAccess onmatch="exclude">
        <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
		<SourceImage condition="contains all">C:\ProgramData\Microsoft\Windows Defender\Platform\;\MsMpEng.exe</SourceImage>
        <GrantedAccess condition="is">0x100000</GrantedAccess>
      </ProcessAccess>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <RegistryEvent onmatch="exclude">
        <EventType condition="is not">SetValue</EventType>
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
      </RegistryEvent>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <DnsQuery onmatch="exclude">
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
      </DnsQuery>
    </RuleGroup>
  </EventFiltering>
</Sysmon>`

	testAdminUser = &server.AdminAPIUser{
		Identifier: "test",
		Key:        utils.NewKeyOrPanic(api.DefaultKeySize),
	}

	mroot = filepath.Join(os.TempDir(), utils.UUIDOrPanic().String(), "data")
	mconf = server.ManagerConfig{
		AdminAPI: server.AdminAPIConfig{
			Host: "localhost",
			Port: randport(),
		},
		EndpointAPI: server.EndpointAPIConfig{
			Host: "localhost",
			Port: randport(),
		},
		Logging: server.ManagerLogConfig{
			Root:        filepath.Join(mroot, "logs"),
			LogBasename: "alerts",
		},
		Database: filepath.Join(mroot, "database"),
		DumpDir:  filepath.Join(mroot, "uploads"),
		TLS: server.TLSConfig{
			Cert: filepath.Join(mroot, "cert.pem"),
			Key:  filepath.Join(mroot, "key.pem"),
		},
	}

	// tools deployment
	osqueryBin         []byte
	osqueryTestBinPath = filepath.Join("data", fmt.Sprintf("%s.%s%s", los.OS, tools.ToolOSQueryi, los.ExecExt))

	wmicPidRe     = regexp.MustCompile(`ProcessId\s=\s\d+`)
	powershellCmd = "wget https://www.google.com"
)

func wmicCreateProcess(cmdLine string) int {
	var out []byte
	var err error
	var s, spid string
	var ok bool
	var pid int64

	cmd := command.CommandTimeout(time.Second*5, "cmd", "/c", fmt.Sprintf(`wmic process call create '%s'`, cmdLine))
	if out, err = cmd.CombinedOutput(); err != nil {
		panic(fmt.Sprintf("%s:\n%s", err, string(out)))
	}

	if s = wmicPidRe.FindString(string(out)); s == "" {
		panic(fmt.Sprintf("pid not found in:\n%s", string(out)))
	}

	if _, spid, ok = strings.Cut(s, "="); !ok {
		panic(fmt.Sprintf("could not split %s", s))
	}

	spid = strings.Trim(spid, " \t")
	if pid, err = strconv.ParseInt(spid, 0, 32); err != nil {
		panic(err)
	}

	return int(pid)
}

func init() {
	var err error

	if osqueryBin, err = os.ReadFile(osqueryTestBinPath); err != nil {
		panic(err)
	}

	sysmon.SetAgnosticConfig(sysmonTestConfig)

}

func drainOldAutologgerEvents(t *testing.T) {
	tt := toast.FromT(t)

	t.Log("Draining out Autologger trace from old events")

	cnt := 0
	c := etw.NewRealTimeConsumer(context.Background())
	// name of the edr trace
	c.FromTraceNames(config.EdrTraceName)

	tt.CheckErr(c.Start())

	now := time.Now()
	i := 0
loop:
	for {
		select {
		case e := <-c.Events:
			i = 0
			if e.System.TimeCreated.SystemTime.After(now) {
				break loop
			}
			cnt++
		default:
			if i == 10 {
				break loop
			}
			time.Sleep(500 * time.Millisecond)
			i++
		}
	}

	tt.CheckErr(c.Stop())
	t.Logf("Drained %d old events from autologger", cnt)
}

func testingRule() (r engine.Rule) {
	r = engine.NewRule()
	r.Name = "Testing:MatchAllSysmon"
	// FileCreate, FileDeleted and FileDeletedDetected
	r.Meta.Events = map[string][]int64{
		sysmonChannel:     {},
		kernelFileChannel: {}}
	r.Actions = append(r.Actions, ActionFiledump, ActionRegdump, ActionBrief, ActionReport)
	r.Meta.Criticality = 10
	return r
}

func generateCert(c server.ManagerConfig) {
	hosts := []string{c.AdminAPI.Host, c.EndpointAPI.Host}
	key, cert, err := utils.GenerateCert("Test", hosts, time.Hour*24*365)
	if err != nil {
		panic(err)
	}
	if err = os.MkdirAll(mroot, 0777); err != nil {
		panic(err)
	}
	if err = utils.HidsWriteData(c.TLS.Cert, cert); err != nil {
		panic(err)
	}
	if err = utils.HidsWriteData(c.TLS.Key, key); err != nil {
		panic(err)
	}
}

func randport() (port int) {
	for ; port <= 10000; port = rand.Intn(65535) {
	}
	return
}

func randomIoCs(n int) (iocs []*ioc.IOC) {
	for ; n > 0; n-- {
		iocs = append(iocs, &ioc.IOC{
			Uuid:      utils.UUIDOrPanic().String(),
			GroupUuid: utils.UUIDOrPanic().String(),
			Source:    "Xyz",
			Value:     fmt.Sprintf("%d.some.random.domain", rand.Intn(10000)),
			Type:      "domain",
		})
	}
	return
}

func makeClientConfig(mc *server.ManagerConfig) (c cconfig.Client) {
	var err error

	c = cconfig.Client{
		Proto:  "https",
		Host:   "localhost",
		Port:   mc.EndpointAPI.Port,
		UUID:   utils.UUIDOrPanic().String(),
		Key:    utils.UUIDOrPanic().String(),
		Unsafe: true,
	}

	if c.ServerFingerprint, err = utils.CertFileSha256(mc.TLS.Cert); err != nil {
		panic(err)
	}

	return
}

func prepareManager() (m *server.Manager, cconf cconfig.Client) {
	var err error

	mconf := mconf
	generateCert(mconf)
	cconf = makeClientConfig(&mconf)

	if m, err = server.NewManager(&mconf); err != nil {
		panic(err)
	}

	// we don't handle error as we don't care if user
	// already exists
	m.CreateNewAdminAPIUser(testAdminUser)

	osquery := tools.New(los.OS, tools.ToolOSQueryi, "osquery", osqueryBin)
	m.TestAddTool(osquery)

	m.AddEndpoint(cconf.UUID, cconf.Key)
	if err := m.AddIoCs(randomIoCs(1000)); err != nil {
		panic(err)
	}
	m.Run()

	return
}

func cleanup() {
	os.RemoveAll(mroot)
}

func installSysmon() {
	var i *sysmon.Info
	var c *sysmon.Config
	var err error

	sysmon.DefaultTimeout = time.Second * 60

	if sysmonInstalled {
		return
	}

	if i, err = sysmon.NewSysmonInfo(); errors.Is(err, sysmon.ErrSysmonNotInstalled) {
		if err = sysmon.InstallOrUpdate("../sysmon/data/Sysmon64.exe"); err != nil {
			panic(err)
		}

		if i, err = sysmon.NewSysmonInfo(); err != nil {
			panic(err)
		}
	}

	if err != nil {
		panic(err)
	}

	// we deserialize config
	if err = xml.Unmarshal([]byte(sysmonTestConfig), &c); err != nil {
		panic(err)
	}
	// we force the good schema version to be the one of sysmon installed
	c.SchemaVersion = i.Config.Version.Schema
	if sha256, err := c.Sha256(); err != nil {
		panic(err)
	} else if sha256 == i.Config.Hash {
		return
	}

	if xmlConfig, err := c.XML(); err != nil {
		panic(err)
	} else {
		// configuring Sysmon
		if err = sysmon.Configure(bytes.NewBuffer(xmlConfig)); err != nil {
			panic(err)
		}
	}

	sysmonInstalled = true
}

func TestAgent(t *testing.T) {
	// draining old events from autologger
	drainOldAutologgerEvents(t)

	tt := toast.FromT(t)
	// we use tt in separate threads and FailNow breaks
	// some tests in this case (seems to break thread)
	tt.FailNow = false

	defer cleanup()

	manager, clConf := prepareManager()
	manager.Logger.ErrorHandler = tt.CheckErr

	installSysmon()

	var gotSysmonEvent bool
	var gotProcessTermination bool

	tmp, err := utils.HidsMkTmpDir()
	tt.CheckErr(err)
	defer os.RemoveAll(tmp)

	c := BuildDefaultConfig(tmp)
	c.EtwConfig.TraceFiles.Read = true
	c.EtwConfig.TraceFiles.Write = true
	// make logger log to stdout
	c.Logfile = "whids.log"
	c.FwdConfig.Local = false
	c.FwdConfig.Client = clConf
	// enable audit policy to trigger FileSystem events hooks
	c.AuditConfig.Enable = true
	c.AuditConfig.AuditDirs = []string{`C:\Windows`, `C:\Users`}
	// empty all actions
	c.Actions = config.Actions{
		AvailableActions: AvailableActions,
		Low:              []string{},
		Medium:           []string{},
		High:             []string{},
		Critical:         []string{},
	}
	c.EtwConfig.ConfigureAutologger()

	// creating new agent
	a, err := NewAgent(c)
	start := time.Now()
	tt.CheckErr(err)
	defer a.Stop()

	// loading testing rule
	r := testingRule()
	tt.CheckErr(a.Engine.LoadRule(&r))

	a.logger.ErrorHandler = tt.CheckErr
	// reduce scheduled task ticker
	for _, t := range a.scheduler.Tasks() {
		if t.Tick() > 0 {
			t.Ticker(time.Second * 5)
		}
	}

	// testing process tracker
	// this hook is inserted after all others so the process tracker structure
	// should be in a good state to test it
	a.preHooks.Hook(func(a *Agent, e *event.EdrEvent) {

		if e.Channel() == sysmonChannel {
			srcGuid := sourceGUIDFromEvent(e)
			//t.Logf("contains guid:%s : %t", srcGuid, a.tracker.ContainsGuid(srcGuid))
			if !a.tracker.ContainsGuid(srcGuid) {
				return
			}

			tr := a.tracker.GetByGuid(srcGuid)
			if a.tracker.ContainsGuid(tr.ParentProcessGUID) {
				tt.Assert(!a.tracker.GetParentByGuid(srcGuid).IsZero())
			}

			if strings.Contains(tr.CommandLine, powershellCmd) {
				// don't apply to all events
				if rand.Int()%2 == 0 {
					// terminate bogus commands
					tr.TerminateProcess()
				}
			}

			switch e.EventID() {
			case SysmonProcessCreate:
				tt.Assert(!a.tracker.IsTerminated(srcGuid))
			case SysmonProcessTerminate:
				// at this point process should be always flagged as terminated
				tt.Assert(a.tracker.IsTerminated(srcGuid))
			default:
				// some events come after process termination so it is not a relevant test
				//tt.Assert(!a.tracker.IsTerminated(srcGuid))
			}
		}
	}, fltAnyEvent)

	// add a final hook to catch all events after enrichment
	a.preHooks.Hook(func(a *Agent, e *event.EdrEvent) {
		if e.Timestamp().After(start) && !start.IsZero() {
			t.Log("Caught up late")
			start = time.Time{}
		}

		if e.Channel() == kernelFileChannel {
			t.Log(utils.PrettyJsonOrPanic(e.Event))
		}

		if e.Channel() == sysmonChannel {
			gotSysmonEvent = true
			switch e.EventID() {
			case SysmonDNSQuery, SysmonNetworkConnect:
				//t.Log(utils.PrettyJsonOrPanic(e.Event))
			}
		}

		if isSysmonProcessTerminate(e) {
			gotProcessTermination = true
		}
		// testing process track structure
	}, fltAnyEvent)

	a.postHooks.Hook(func(h *Agent, e *event.EdrEvent) {
		/*if e.IsDetection() {
			t.Log(e.GetDetection().Actions.Slice())
		}*/
	}, fltAnyEvent)

	tt.TimeIt(
		"configuring autologgers",
		func() { tt.CheckErr(a.config.EtwConfig.ConfigureAutologger()) },
	)

	t.Log("Running agent")
	// we start running the agent
	tt.CheckErr(a.Run())
	// generate fake network trafic not originating from edr
	pid := wmicCreateProcess(format("powershell -Command while(1){powershell -Command %s;sleep 1}", powershellCmd))
	// terminate wmic process
	defer terminate(pid)

	time.Sleep(20 * time.Second)
	t.Log("Stopping agent")
	a.Stop()

	tt.Assert(gotSysmonEvent, "failed to monitor Sysmon events")
	tt.Assert(gotProcessTermination, "failed to get Sysmon process termination event")

	report := a.Report(false)
	for _, c := range report.Commands {
		// control that we did not get any error
		tt.Assert(c.Error == "")
	}

	a.WaitWithTimeout(time.Second * 15)
	// to display statistics
	a.logger = golog.Stdout
	a.LogStats()
}

```

`agent/commands.go`:

```go
package agent

import (
	"crypto/md5"
	"crypto/sha1"
	"crypto/sha256"
	"crypto/sha512"
	"encoding/hex"
	"fmt"
	"io"
	"io/fs"
	"os"
	"path/filepath"
	"regexp"
	"time"

	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/utils"
)

type FileInfo struct {
	Dir     string            `json:"dir"`
	Name    string            `json:"name"`
	Size    int64             `json:"size"`
	ModTime time.Time         `json:"modtime"`
	Type    string            `json:"type"`
	Hashes  map[string]string `json:"hashes,omitempty"`
	Err     error             `json:"error"`
}

func (fi *FileInfo) Path() string {
	return filepath.Join(fi.Dir, fi.Name)
}

func (fi *FileInfo) Hash() error {
	var buffer [4 * utils.Mega]byte

	file, err := os.Open(fi.Path())
	if err != nil {
		return err
	}
	defer file.Close()

	fi.Hashes = make(map[string]string)

	md5 := md5.New()
	sha1 := sha1.New()
	sha256 := sha256.New()
	sha512 := sha512.New()

	for read, err := file.Read(buffer[:]); err != io.EOF && read != 0; read, err = file.Read(buffer[:]) {
		if err != nil && err != io.EOF && err != io.ErrUnexpectedEOF {
			return err
		}
		md5.Write(buffer[:read])
		sha1.Write(buffer[:read])
		sha256.Write(buffer[:read])
		sha512.Write(buffer[:read])
	}

	fi.Hashes["md5"] = hex.EncodeToString(md5.Sum(nil))
	fi.Hashes["sha1"] = hex.EncodeToString(sha1.Sum(nil))
	fi.Hashes["sha256"] = hex.EncodeToString(sha256.Sum(nil))
	fi.Hashes["sha512"] = hex.EncodeToString(sha512.Sum(nil))

	return nil
}

func (fi *FileInfo) FromFSFileInfo(fsfi fs.FileInfo) {
	fi.Name = fsfi.Name()
	fi.Size = fsfi.Size()
	fi.ModTime = fsfi.ModTime()
	switch {
	case fsfi.IsDir():
		fi.Type = "dir"
	case fsfi.Mode().IsRegular():
		fi.Type = "file"
	case fsfi.Mode()&os.ModeSymlink == os.ModeSymlink:
		fi.Type = "link"
	}
}

type WalkItem struct {
	Dirs  []FileInfo `json:"dirs"`
	Files []FileInfo `json:"files"`
	Err   string     `json:"err"`
}

func (wi *WalkItem) FromWalkerWalkItem(o fswalker.WalkItem) {
	wi.Dirs = make([]FileInfo, len(o.Dirs))
	for i, fi := range o.Dirs {
		wi.Dirs[i].Dir = o.Dirpath
		wi.Dirs[i].FromFSFileInfo(fi)
	}

	wi.Files = make([]FileInfo, len(o.Files))
	for i, fi := range o.Files {
		wi.Files[i].Dir = o.Dirpath
		wi.Files[i].FromFSFileInfo(fi)
	}

	if o.Err != nil {
		wi.Err = o.Err.Error()
	}
}

func cmdHash(path string) (nfi FileInfo, err error) {
	var fi fs.FileInfo

	if fi, err = os.Stat(path); err != nil {
		return
	}

	if !fi.Mode().IsRegular() {
		err = fmt.Errorf("no such file: %s", path)
		return
	}

	nfi.Dir = filepath.Dir(path)
	nfi.FromFSFileInfo(fi)
	err = nfi.Hash()
	return
}

func cmdDir(path string) (sfi []FileInfo, err error) {
	var ofi []os.DirEntry

	if ofi, err = os.ReadDir(path); err != nil {
		return
	}

	sfi = make([]FileInfo, len(ofi))
	for i, de := range ofi {
		var fi fs.FileInfo

		sfi[i].Dir = path
		if fi, sfi[i].Err = de.Info(); sfi[i].Err != nil {
			continue
		}
		sfi[i].FromFSFileInfo(fi)
	}

	return
}

func cmdWalk(path string) []WalkItem {
	out := make([]WalkItem, 0)

	for wi := range fswalker.Walk(path) {
		new := WalkItem{}
		new.FromWalkerWalkItem(wi)
		out = append(out, new)
	}

	return out
}

func cmdFind(path string, pattern string, hash bool) (out []FileInfo, err error) {
	var pr *regexp.Regexp

	out = make([]FileInfo, 0)

	if pr, err = regexp.Compile(pattern); err != nil {
		return
	}

	for wi := range fswalker.Walk(path) {
		for _, fi := range wi.Files {
			path := filepath.Join(wi.Dirpath, fi.Name())
			if pr.MatchString(path) {
				nfi := FileInfo{Dir: wi.Dirpath}
				nfi.FromFSFileInfo(fi)
				// we need to hash file
				if hash {
					nfi.Err = nfi.Hash()
				}
				out = append(out, nfi)
			}

		}
	}

	return
}

func cmdStat(path string) (nfi FileInfo, err error) {
	var fi fs.FileInfo

	if fi, err = os.Stat(path); err != nil {
		return
	}

	nfi.Dir = filepath.Dir(los.TrimPathSep(path))
	nfi.FromFSFileInfo(fi)
	return
}

```

`agent/commands_test.go`:

```go
package agent

import (
	"fmt"
	"path/filepath"
	"regexp"
	"runtime"
	"testing"

	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/utils"
)

var (
	testDir  string
	testFile string

	format = fmt.Sprintf
)

func init() {
	switch runtime.GOOS {
	case "windows":
		testDir = `C:\Windows\System32`
		testFile = "cmd.exe"
	default:
		testDir = "/usr/bin"
		testFile = "ls"
	}
}

func TestCmdHash(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	fi, err := cmdHash(filepath.Join(testDir, testFile))
	tt.CheckErr(err)
	tt.Assert(fi.Type == "file")
	t.Log(utils.PrettyJsonOrPanic(fi))
}

func TestCmdDir(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)
	dir := testDir
	d, err := cmdDir(dir)
	tt.CheckErr(err)
	for _, fi := range d {
		tt.Assert(fi.Dir == dir)
	}
	t.Log(utils.PrettyJsonOrPanic(d))
}

func TestCmdFind(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)
	rex := regexp.QuoteMeta(format("%c%s", filepath.Separator, testFile))
	fis, err := cmdFind(testDir, format(`%s$`, rex), true)
	tt.CheckErr(err)
	tt.Assert(len(fis) > 0)
	for _, fi := range fis {
		tt.Assert(fi.Name == testFile)

	}
}

func TestCmdStat(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)
	st, err := cmdStat(filepath.Join(testDir, testFile))
	tt.CheckErr(err)
	tt.Assert(st.Name == testFile)
}

func TestCmdWalk(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	items := cmdWalk(testDir)
	tt.Assert(len(items) > 0)
	for _, it := range items {
		tt.Assert(it.Err == "")
	}
}

```

`agent/config/canary.go`:

```go
package config

import (
	"github.com/0xrawsec/golang-utils/datastructs"
)

// Canary configuration
type Canary struct {
	HideFiles       bool     `json:"hide-files" toml:"hide-files" comment:"Flag to set to hide files"`
	HideDirectories bool     `json:"hide-dirs" toml:"hide-dirs" comment:"Flag to set to hide directories"`
	SetAuditACL     bool     `json:"set-audit-acl" toml:"set-audit-acl" comment:"Set Audit ACL to the canary directories, sub-directories and files to generate File System audit events\n https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-file-system"`
	Directories     []string `json:"directories" toml:"directories" comment:"Directories where canary files will be created"`
	Files           []string `json:"files" toml:"files" comment:"Canary files to monitor. Files will be created if not existing"`
	Delete          bool     `json:"delete" toml:"delete" comment:"Whether to delete or not the canary files when service stops"`
	createdDir      *datastructs.SyncedSet
}

// Canaries structure holding canary configuration
type Canaries struct {
	Enable    bool      `json:"enable" toml:"enable" comment:"Enable canary files management"`
	Actions   []string  `json:"actions" toml:"actions" comment:"Actions to apply when a canary file is touched"`
	Whitelist []string  `json:"whitelist" toml:"whitelist" comment:"Process images being allowed to touch the canaries"`
	Canaries  []*Canary `json:"group" toml:"group" comment:"Canary files to create at every run"`
}

```

`agent/config/canary_test.go`:

```go
package config

import (
	"runtime"
	"testing"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/toast"
)

var (
	canaryConfig = Canaries{
		Enable:    true,
		Actions:   make([]string, 0),
		Whitelist: make([]string, 0),
		Canaries:  make([]*Canary, 0),
	}
)

func init() {
	switch runtime.GOOS {
	case "windows":
		canaryConfig.Canaries = append(canaryConfig.Canaries,
			&Canary{
				HideFiles:   true,
				Directories: []string{`C:\Windows\`, `C:\Windows\System32\`},
				Files:       []string{`readme.txt`, `readme.pdf`},
				Delete:      true,
			})
	default:
	}
}

func TestCanaries(t *testing.T) {
	tt := toast.FromT(t)
	e := engine.NewEngine()

	defer canaryConfig.Clean()
	defer canaryConfig.RestoreACLs()

	tt.CheckErr(canaryConfig.Configure())

	// checking that the files created have been well created
	for _, canary := range canaryConfig.Canaries {
		for _, file := range canary.paths() {
			tt.Assert(fsutil.Exists(file))
		}
	}

	tt.CheckErr(canaryConfig.Clean())
	rules := []engine.Rule{
		canaryConfig.GenRuleFSAudit(),
		canaryConfig.GenRuleKernelFile(),
		canaryConfig.GenRuleSysmon(),
	}

	for _, r := range rules {
		tt.CheckErr(e.LoadRule(&r))
	}

	// checking that files created got well deleted
	for _, canary := range canaryConfig.Canaries {
		for _, file := range canary.paths() {
			t.Logf("%s existing: %t", file, fsutil.Exists(file))
			tt.Assert(!fsutil.Exists(file))
		}
	}

	tt.CheckErr(canaryConfig.RestoreACLs())
}

```

`agent/config/canary_windows.go`:

```go
//go:build windows
// +build windows

package config

import (
	"fmt"
	"math/rand"
	"os"
	"path/filepath"
	"regexp"
	"strings"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/whids/utils"
)

// expands environment variables found in directories
func (c *Canary) expandDir() (dirs []string) {
	return utils.ExpandEnvs(c.Directories...)
}

// create the canary files and directories
func (c *Canary) create() (err error) {
	c.createdDir = datastructs.NewSyncedSet()

	for _, dir := range c.expandDir() {
		// we create directory only if it is not existing
		if !fsutil.Exists(dir) {
			if err := os.MkdirAll(dir, 0777); err != nil {
				return err
			}
			if c.HideDirectories {
				if err := utils.HideFile(dir); err != nil {
					return err
				}
			}
			c.createdDir.Add(dir)
		}
	}

	for _, fp := range c.paths() {
		// we create files only if it is not existing
		if !fsutil.Exists(fp) {
			var fd *os.File

			if fd, err = os.Create(fp); err != nil {
				return err
			}
			defer fd.Close()
			rand.Seed(time.Now().Unix())
			buf := [1024]byte{}
			size := rand.Int() % 50 * utils.Mega
			written, n := 0, 0
			for written < size && err == nil {
				if _, err = rand.Read(buf[:]); err != nil {
					continue
				}
				n, err = fd.Write(buf[:])
				written += n
			}
			fd.Close()

			if c.HideFiles {
				if err := utils.HideFile(fp); err != nil {
					return err
				}
			}
		}
	}

	return nil
}

// clean the canary files
func (c *Canary) clean() (last error) {
	if c.Delete {
		// we remove canary files
		for _, fp := range c.paths() {
			if err := os.Remove(fp); err != nil {
				last = err
			}
		}

		// we remove only empty directories
		for _, dir := range c.expandDir() {
			empty, err := utils.IsDirEmpty(dir)

			if err != nil || !empty {
				last = err
				continue
			}

			if err := os.Remove(dir); err != nil {
				last = err
			}
		}

		// we remove directory which have been created
		if c.createdDir != nil {
			for _, i := range c.createdDir.Slice() {
				dir := i.(string)
				if err := os.RemoveAll(dir); err != nil {
					last = err
				}
			}
		}
	}

	return
}

// return a list containing the full paths of the canary files
func (c *Canary) paths() (files []string) {
	files = make([]string, 0, len(c.Files)*len(c.Directories))
	for _, dir := range c.expandDir() {
		for _, fn := range c.Files {
			files = append(files, filepath.Join(dir, fn))
		}
	}
	return
}

func (c *Canaries) canaryRegexp() string {
	repaths := make([]string, 0)
	for _, c := range c.Canaries {

		// adding list of created dir
		for _, i := range c.createdDir.Slice() {
			dir := fmt.Sprintf("%s%c", i.(string), os.PathSeparator)
			repaths = append(repaths, regexp.QuoteMeta(dir))
		}

		for _, fp := range c.paths() {
			dir := filepath.Dir(fp)
			if !c.createdDir.Contains(dir) {
				repaths = append(repaths, regexp.QuoteMeta(fp))
			}
		}
	}
	return fmt.Sprintf("(?i:(%s))", strings.Join(repaths, "|"))
}

func (c *Canaries) whitelistRegexp() string {
	wl := make([]string, 0, len(c.Whitelist))
	for _, im := range c.Whitelist {
		wl = append(wl, regexp.QuoteMeta(im))
	}
	return fmt.Sprintf("(?i:(%s))", strings.Join(wl, "|"))
}

// Configure creates canaries and set ACLs if needed
func (c *Canaries) Configure() error {
	auditDirs := make([]string, 0)
	if c.Enable {
		for _, cf := range c.Canaries {
			// add the list of directories to audit
			if cf.SetAuditACL {
				auditDirs = append(auditDirs, cf.expandDir()...)
			}

			if err := cf.create(); err != nil {
				return fmt.Errorf("failed at creating canary: %w", err)
			}
		}

		// run this function async as it might take a little bit of time
		if err := utils.SetEDRAuditACL(auditDirs...); err != nil {
			return fmt.Errorf("error while setting canaries' Audit ACLs: %w", err)
		}
	}

	return nil
}

// RestoreACLs restore EDR configured ACLs
func (c *Canaries) RestoreACLs() error {
	auditDirs := make([]string, 0)
	for _, cf := range c.Canaries {
		// add the list of directories to audit
		if cf.SetAuditACL {
			auditDirs = append(auditDirs, cf.expandDir()...)
		}
	}

	if err := utils.RemoveEDRAuditACL(auditDirs...); err != nil {
		return fmt.Errorf("error while setting canaries' Audit ACLs: %w", err)
	}

	return nil
}

// GenRuleFSAudit generate a rule matching FS Audit events for the configured canaries
func (c *Canaries) GenRuleFSAudit() (r engine.Rule) {
	r = engine.NewRule()
	r.Name = "Builtin:CanaryAccessed"
	r.Meta.Events = map[string][]int64{"Security": {4663}}
	r.Meta.Criticality = 10
	r.Matches = []string{
		"$read: AccessMask &= '0x1'",
		"$write: AccessMask &= '0x2'",
		"$append: AccessMask &= '0x4'",
		fmt.Sprintf("$wl_images: ProcessName ~= '%s'", c.whitelistRegexp()),
		fmt.Sprintf("$canary: ObjectName ~= '%s'", c.canaryRegexp()),
	}
	r.Condition = "!$wl_images and ($read or $write or $append) and $canary"
	r.Actions = append(r.Actions, c.Actions...)
	return
}

// GenRuleSysmon generate a rule matching sysmon events for the configured canaries
func (c *Canaries) GenRuleSysmon() (r engine.Rule) {
	r = engine.NewRule()
	r.Name = "Builtin:CanaryModified"
	// FileCreate, FileDeleted and FileDeletedDetected
	r.Meta.Events = map[string][]int64{"Microsoft-Windows-Sysmon/Operational": {11, 23, 26}}
	r.Meta.Criticality = 10
	r.Matches = []string{
		fmt.Sprintf("$wl_images: Image ~= '%s'", c.whitelistRegexp()),
		fmt.Sprintf("$canary: TargetFilename ~= '%s'", c.canaryRegexp()),
	}
	r.Condition = "!$wl_images and $canary"
	r.Actions = append(r.Actions, c.Actions...)
	return
}

// GenRuleSysmon generate a rule matching sysmon events for the configured canaries
func (c *Canaries) GenRuleKernelFile() (r engine.Rule) {
	r = engine.NewRule()
	r.Name = "Builtin:CanaryReadWrite"
	// FileCreate, FileDeleted and FileDeletedDetected
	r.Meta.Events = map[string][]int64{"Microsoft-Windows-Kernel-File/Analytic": {15, 16}}
	r.Meta.Criticality = 10
	r.Matches = []string{
		fmt.Sprintf("$wl_images: Image ~= '%s'", c.whitelistRegexp()),
		fmt.Sprintf("$canary: FileName ~= '%s'", c.canaryRegexp()),
	}
	r.Condition = "!$wl_images and $canary"
	r.Actions = append(r.Actions, c.Actions...)
	return
}

// Clean cleans up the canaries
func (c *Canaries) Clean() (last error) {
	if c.Enable {
		for _, cf := range c.Canaries {
			if err := cf.clean(); err != nil {
				last = err
			}
		}
	}
	return
}

```

`agent/config/config.go`:

```go
package config

import (
	"fmt"
	"os"
	"path/filepath"
	"time"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/whids/api/client/config"
	"github.com/0xrawsec/whids/utils"
	"github.com/pelletier/go-toml/v2"
)

const (
	// default action lower and upper bounds
	ActionLowLow, ActionLowHigh           = 1, 4
	ActionMediumLow, ActionMediumHigh     = 5, 7
	ActionHighLow, ActionHighHigh         = 8, 9
	ActionCriticalLow, ActionCriticalHigh = 10, 10
)

type Actions struct {
	AvailableActions []string `json:"available-actions,omitempty" toml:"available-actions" comment:"List of available actions (here as a memo for easier configuration, but it is not used in any way by the engine)"`
	Low              []string `json:"low,omitempty" toml:"low" comment:"Default actions to be taken when event criticality is in [1; 4]"`
	Medium           []string `json:"medium,omitempty" toml:"medium" comment:"Default actions to be taken when event criticality is in [5; 7]"`
	High             []string `json:"high,omitempty" toml:"high" comment:"Default actions to be taken when event criticality is in [8; 9]"`
	Critical         []string `json:"critical,omitempty" toml:"critical" comment:"Default actions to be taken when event criticality is 10"`
}

// Dump structure definition
type Dump struct {
	Dir           string `json:"dir,omitempty" toml:"dir" comment:"Directory used to store dumps"`
	MaxDumps      int    `json:"max-dumps,omitempty" toml:"max-dumps" comment:"Maximum number of dumps per process"` // maximum number of dump per GUID
	Compression   bool   `json:"compression,omitempty" toml:"compression" comment:"Enable dumps compression"`
	DumpUntracked bool   `json:"dump-untracked,omitempty" toml:"dump-untracked" comment:"Dumps untracked process. Untracked processes are missing\n enrichment information and may generate unwanted dumps"` // whether or not we should dump untracked processes, if true it would create many FPs
}

// Sysmon holds Sysmon related configuration
type Sysmon struct {
	Bin              string `json:"bin,omitempty" toml:"bin" comment:"Path to Sysmon binary"`
	ArchiveDirectory string `json:"archive-directory,omitempty" toml:"archive-directory" comment:"Path to Sysmon Archive directory"`
	CleanArchived    bool   `json:"clean-archived,omitempty" toml:"clean-archived" comment:"Delete files older than 5min archived by Sysmon"`
}

// Rules holds rules configuration
type Rules struct {
	RulesDB        string        `json:"rules-db,omitempty" toml:"rules-db" comment:"Path to Gene rules database"`
	ContainersDB   string        `json:"containers-db,omitempty" toml:"containers-db" comment:"Path to Gene rules containers\n (c.f. Gene documentation)"`
	UpdateInterval time.Duration `json:"update-interval,omitempty" toml:"update-interval" comment:"Update interval at which rules should be pulled from manager\n NB: only applies if a manager server is configured"`
}

func (c *Rules) RulesPaths() (path, sha256Path string) {
	path = filepath.Join(c.RulesDB, "database.gen")
	sha256Path = fmt.Sprintf("%s.sha256", path)
	return
}

// Audit holds Windows audit configuration
type Audit struct {
	Enable        bool     `json:"enable,omitempty" toml:"enable" comment:"Enable following Audit Policies or not"`
	AuditPolicies []string `json:"audit-policies,omitempty" toml:"audit-policies" comment:"Audit Policies to enable (c.f. auditpol /get /category:* /r)"`
	AuditDirs     []string `json:"audit-dirs,omitempty" toml:"audit-dirs" comment:"Set Audit ACL to directories, sub-directories and files to generate File System audit events\n https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-file-system)"`
}

// Agent structure
// WARNING: it is very important that any field/structure in Agent config has omitempty in JSON tag otherwise
// there are Sha256 stability issues because JSON and TOML do not decode empty slices the same way.
type Agent struct {
	path string

	DatabasePath    string           `json:"db-path,omitempty" toml:"db-path" comment:"Path to local database root directory"`
	CritTresh       int              `json:"criticality-treshold,omitempty" toml:"criticality-treshold" comment:"Dumps/forward only events above criticality threshold\n or filtered events (i.e. Gene filtering rules)"`
	EnableHooks     bool             `json:"en-hooks,omitempty" toml:"en-hooks" comment:"Enable enrichment hooks and dump hooks"`
	EnableFiltering bool             `json:"en-filters,omitempty" toml:"en-filters" comment:"Enable event filtering (log filtered events, not only alerts)\n See documentation: https://github.com/0xrawsec/gene"`
	Logfile         string           `json:"logfile,omitempty" toml:"logfile" comment:"Logfile used to log messages generated by the engine"` // for WHIDS log messages (not alerts)
	LogAll          bool             `json:"log-all,omitempty" toml:"log-all" comment:"Log any incoming event passing through the engine"`    // log all events to logfile (used for debugging)
	Endpoint        bool             `json:"endpoint,omitempty" toml:"endpoint" comment:"True if current host is the endpoint on which logs are generated\n Example: turn this off if running on a WEC"`
	EtwConfig       Etw              `json:"etw,omitempty" toml:"etw" comment:"ETW configuration"`
	FwdConfig       config.Forwarder `json:"forwarder,omitempty" toml:"forwarder" comment:"Forwarder configuration"`
	Sysmon          Sysmon           `json:"sysmon,omitempty" toml:"sysmon" comment:"Sysmon related settings"`
	Actions         Actions          `json:"actions,omitempty" toml:"actions" comment:"Default actions to apply to events, depending on their criticality"`
	Dump            Dump             `json:"dump,omitempty" toml:"dump" comment:"Dump related settings"`
	Report          Report           `json:"report,omitempty" toml:"reporting" comment:"Reporting related settings"`
	RulesConfig     Rules            `json:"rules,omitempty" toml:"rules" comment:"Gene rules related settings\n Gene repo: https://github.com/0xrawsec/gene\n Gene rules repo: https://github.com/0xrawsec/gene-rules"`
	AuditConfig     Audit            `json:"audit,omitempty" toml:"audit" comment:"Windows auditing configuration"`
	CanariesConfig  Canaries         `json:"canaries,omitempty" toml:"canaries" comment:"Canary files configuration"`
}

// LoadAgentConfig loads a HIDS configuration from a file
func LoadAgentConfig(path string) (c Agent, err error) {
	fd, err := os.Open(path)
	if err != nil {
		return
	}
	defer fd.Close()
	dec := toml.NewDecoder(fd)
	err = dec.Decode(&c)
	c.path = path
	return
}

func (c *Agent) Sha256() (string, error) {
	return utils.Sha256Interface(c)
}

// IsForwardingEnabled returns true if a forwarder is actually configured to forward logs
func (c *Agent) IsForwardingEnabled() bool {
	return !c.FwdConfig.Local && c.FwdConfig.Client.HasConnectionSettings()
}

// Prepare creates directory used in the config if not existing
func (c *Agent) Prepare() (err error) {
	if !fsutil.Exists(c.RulesConfig.RulesDB) {
		if err = os.MkdirAll(c.RulesConfig.RulesDB, 0600); err != nil {
			return
		}
	}

	if !fsutil.Exists(c.RulesConfig.ContainersDB) {
		if err = os.MkdirAll(c.RulesConfig.ContainersDB, 0600); err != nil {
			return
		}
	}

	if !fsutil.Exists(c.Dump.Dir) {
		if err = os.MkdirAll(c.Dump.Dir, 0600); err != nil {
			return
		}
	}

	if !fsutil.Exists(filepath.Dir(c.FwdConfig.Logging.Dir)) {
		if err = os.MkdirAll(filepath.Dir(c.FwdConfig.Logging.Dir), 0600); err != nil {
			return
		}
	}

	if !fsutil.Exists(filepath.Dir(c.Logfile)) {
		if err = os.MkdirAll(filepath.Dir(c.Logfile), 0600); err != nil {
			return
		}
	}

	return
}

// Verify validate HIDS configuration object
func (c *Agent) Verify() error {
	if !fsutil.IsDir(c.RulesConfig.RulesDB) {
		return fmt.Errorf("rules database must be a directory")
	}
	if !fsutil.IsDir(c.RulesConfig.ContainersDB) {
		return fmt.Errorf("containers database must be a directory")
	}
	return nil
}

func (c *Agent) Path() string {
	return c.path
}

// Save saves configuration to path
func (c *Agent) Save(path string) (err error) {
	var b []byte

	if b, err = utils.Toml(c); err != nil {
		return
	}

	return utils.HidsWriteData(path, b)
}

```

`agent/config/config_test.go`:

```go
package config

import (
	"fmt"
	"os"
	"path/filepath"
	"testing"
	"time"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/api/client/config"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/tools"
)

func buildDefaultConfig(root string) Agent {

	logDir := filepath.Join(root, "Logs")
	dbDir := filepath.Join(root, "Database")

	return Agent{
		DatabasePath: filepath.Join(dbDir, "Sod"),
		RulesConfig: Rules{
			RulesDB:        filepath.Join(dbDir, "Rules"),
			ContainersDB:   filepath.Join(dbDir, "Containers"),
			UpdateInterval: 60 * time.Second,
		},

		FwdConfig: config.Forwarder{
			Local:  true,
			Client: config.Client{},
			Logging: config.ForwarderLogging{
				Dir:              filepath.Join(logDir, "Alerts"),
				RotationInterval: time.Hour * 5,
			},
		},
		EtwConfig: Etw{
			Providers: []string{
				"Microsoft-Windows-Sysmon",
				"Microsoft-Windows-Windows Defender",
				"Microsoft-Windows-PowerShell",
				"Microsoft-Antimalware-Scan-Interface",
			},
			Traces: []string{"Eventlog-Security"},
		},
		Sysmon: Sysmon{
			Bin:              "C:\\Windows\\Sysmon64.exe",
			ArchiveDirectory: "C:\\Sysmon\\",
			CleanArchived:    true,
		},
		Actions: Actions{
			Low:      []string{},
			Medium:   []string{"brief", "filedump", "regdump"},
			High:     []string{"report", "filedump", "regdump"},
			Critical: []string{"report", "filedump", "regdump", "memdump"},
		},
		Dump: Dump{
			Dir:           filepath.Join(root, "Dumps"),
			Compression:   true,
			MaxDumps:      4,
			DumpUntracked: false,
		},
		Report: Report{
			EnableReporting: false,
			OSQuery: OSQuery{
				Tables: []string{"processes", "services", "scheduled_tasks", "drivers", "startup_items", "process_open_sockets"}},
			Commands: []ReportCommand{{
				Description: "Example command",
				Name:        "osqueryi.exe",
				Args:        []string{"--json", "-A", "processes"},
				ExpectJSON:  true,
			}},
			CommandTimeout: 60 * time.Second,
		},
		AuditConfig: Audit{
			AuditPolicies: []string{"File System"},
		},
		CanariesConfig: Canaries{
			Enable: false,
			Canaries: []*Canary{
				{
					Directories: []string{"$SYSTEMDRIVE", "$SYSTEMROOT"},
					Files:       []string{"readme.pdf", "readme.docx", "readme.txt"},
					Delete:      true,
				},
			},
			Actions: []string{"kill", "memdump", "filedump", "blacklist", "report"},
			Whitelist: []string{
				"System",
				"C:\\Windows\\explorer.exe",
			},
		},
		CritTresh:       5,
		Logfile:         filepath.Join(logDir, "whids.log"),
		EnableHooks:     true,
		EnableFiltering: true,
		Endpoint:        true,
		LogAll:          false}
}

func TestConfig(t *testing.T) {
	var err error
	var sha256, savedSha256 string

	t.Parallel()

	tt := toast.FromT(t)
	tmp := t.TempDir()

	cfg := buildDefaultConfig(tmp)
	path := filepath.Join(tmp, "config.toml")

	pathRules, pathSha256 := cfg.RulesConfig.RulesPaths()
	tt.Assert(pathRules == filepath.Join(cfg.RulesConfig.RulesDB, "database.gen"))
	tt.Assert(pathSha256 == filepath.Join(cfg.RulesConfig.RulesDB, "database.gen.sha256"))

	// testing IsForwardingEnabled
	tt.Assert(cfg.IsForwardingEnabled() == false)
	cfg.FwdConfig.Local = false
	tt.Assert(cfg.IsForwardingEnabled() == false)
	cfg.FwdConfig.Client = config.Client{
		Proto: "http",
		Host:  "localhost",
		UUID:  "{0000}",
		Key:   "key",
	}
	tt.Assert(cfg.IsForwardingEnabled())

	// test hash stability of Save function
	sha256, err = cfg.Sha256()
	tt.CheckErr(err)
	tt.CheckErr(cfg.Save(path))
	cfg, err = LoadAgentConfig(path)
	tt.CheckErr(err)
	tt.Assert(cfg.Path() == path)
	// testing that sha256 did not get modified
	savedSha256, err = cfg.Sha256()
	tt.CheckErr(err)
	tt.Assert(sha256 == savedSha256)

	// test Prepare and Verify
	tt.CheckErr(cfg.Prepare())
	tt.CheckErr(cfg.Verify())

	goodProvLen := len(cfg.EtwConfig.Providers)
	// if there is no duplicate it should be the same number
	tt.Assert(len(cfg.EtwConfig.UnifiedProviders()) == goodProvLen)
	cfg.EtwConfig.Providers = append(cfg.EtwConfig.Providers, cfg.EtwConfig.Providers...)
	tt.Assert(len(cfg.EtwConfig.Providers) == goodProvLen*2)
	// should get rid of duplicates
	tt.Assert(len(cfg.EtwConfig.UnifiedProviders()) == goodProvLen)

	goodTracesLen := len(cfg.EtwConfig.Traces) + 1
	// should always be one more than configured because of EdrTrace always present
	tt.Assert(len(cfg.EtwConfig.UnifiedTraces()) == goodTracesLen)
	cfg.EtwConfig.Traces = append(cfg.EtwConfig.Traces, cfg.EtwConfig.Traces...)
	tt.Assert(len(cfg.EtwConfig.UnifiedTraces()) == goodTracesLen)
}

func TestReporting(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp := t.TempDir()
	cfg := buildDefaultConfig(tmp)
	// copy osquery binary
	src := fmt.Sprintf("../data/%s.%s%s", los.OS, tools.ToolOSQueryi, los.ExecExt)
	dst := los.ExecFilename(tools.ToolOSQueryi)
	tt.CheckErr(fsutil.CopyFile(src, dst))
	os.Setenv(los.PathEnvVar, los.BuildPathEnv(los.GetPathEnv(), tmp))

	for _, cmd := range cfg.Report.PrepareCommands() {
		cmd.Run()
		tt.Assert(cmd.Error == "", cmd.Error)
	}
}

```

`agent/config/etw.go`:

```go
package config

type TraceFiles struct {
	Read  bool `json:"en-read" toml:"" comment:"Enable file write tracing events"`
	Write bool `json:"en-write" toml:"" comment:"Enable file read tracing events"`
}

type Etw struct {
	TraceFiles TraceFiles `json:"trace-files" toml:"trace-files" comment:"Enable file read/write events via an optimized Microsoft-Windows-Kernel-File provider"`
	//enTraceFile bool     `json:"trace-files" toml:"trace-files" comment:"Enable file read/write events via an optimized Microsoft-Windows-Kernel-File provider"`
	Providers []string `json:"providers" toml:"providers" comment:"ETW providers to enable in the EDR autologger setting"`
	Traces    []string `json:"traces" toml:"traces" comment:"Additional ETW traces to retrieve events"`
}

func (e *Etw) FileTraceEnabled() bool {
	return e.TraceFiles.Read || e.TraceFiles.Write
}

```

`agent/config/etw_test.go`:

```go
//go:build windows
// +build windows

package config

import (
	"testing"

	"github.com/0xrawsec/toast"
)

func TestEtwConfiguration(t *testing.T) {
	tt := toast.FromT(t)

	Autologger.Delete()
	defer Autologger.Delete()
	tt.Assert(!Autologger.Exists())

	c := Etw{
		Providers: []string{
			"Microsoft-Windows-Windows Defender",
			"Microsoft-Windows-PowerShell",
			"Microsoft-Antimalware-Scan-Interface",
		},
		Traces: []string{"Eventlog-Security"},
	}

	tt.CheckErr(c.ConfigureAutologger())
	tt.Assert(Autologger.Exists())
}

func TestEtwTraceFiles(t *testing.T) {
	tt := toast.FromT(t)

	c := Etw{
		Providers: []string{
			"Microsoft-Windows-Windows Defender",
			"Microsoft-Windows-PowerShell",
			"Microsoft-Antimalware-Scan-Interface",
		},
		Traces: []string{"Eventlog-Security"},
	}

	tt.Assert(!c.FileTraceEnabled())

	// only read
	c.TraceFiles.Read = true
	tt.Assert(c.FileTraceEnabled())
	tt.Assert(c.optimizedKernelFileProvider() == KernelFileProviderName+":0xff:12,14,15")

	// only write
	c.TraceFiles.Read = false
	c.TraceFiles.Write = true
	tt.Assert(c.FileTraceEnabled())
	tt.Assert(c.optimizedKernelFileProvider() == KernelFileProviderName+":0xff:12,14,16")

	// both read and write
	tt.Assert(c.FileTraceEnabled())
	c.TraceFiles.Read = true
	tt.Assert(c.optimizedKernelFileProvider() == KernelFileProviderName+":0xff:12,14,15,16")
}

```

`agent/config/etw_windows.go`:

```go
//go:build windows
// +build windows

package config

import (
	"fmt"
	"strings"

	"github.com/0xrawsec/golang-etw/etw"
	"github.com/0xrawsec/whids/utils"
)

const (
	/** Public const **/

	EdrTraceName        = `EdrTrace`
	EdrTraceGuid        = "{e32c0429-d46b-47a9-ab6c-074012efe5ba}"
	EdrBufferSize       = 64 // 64kB is the max ETW event size so the buffer needs to be at least this big
	EdrTraceLogFileMode = 0x8001c0
	EdrTraceClockTime   = 2   // System Time -> only way to handle time sync properly
	EdrTraceMaxFileSize = 500 // 500MB of ETW RT session backup file should be enough not to lose event

	KernelFileProviderName = "Microsoft-Windows-Kernel-File"
)

var (
	Autologger = etw.AutoLogger{
		Name:        EdrTraceName,
		Guid:        EdrTraceGuid,
		LogFileMode: EdrTraceLogFileMode,
		BufferSize:  EdrBufferSize,
		ClockType:   EdrTraceClockTime,
		MaxFileSize: EdrTraceMaxFileSize,
	}
)

func (e *Etw) optimizedKernelFileProvider() string {
	// create / close event ids
	eventIds := []string{"12", "14"}
	if e.TraceFiles.Read {
		eventIds = append(eventIds, "15")
	}
	if e.TraceFiles.Write {
		eventIds = append(eventIds, "16")
	}

	return fmt.Sprintf("%s:0xff:%s", KernelFileProviderName, strings.Join(eventIds, ","))
}

func (c *Etw) ConfigureAutologger() (lastErr error) {

	if err := Autologger.Create(); err != nil {
		return fmt.Errorf("failed to create autologger: %w", err)
	}

	for _, p := range c.UnifiedProviders() {
		if prov, err := etw.ParseProvider(p); err != nil {
			lastErr = fmt.Errorf("failed to parse provider: %w", err)
		} else {
			if err := Autologger.EnableProvider(prov); err != nil {
				lastErr = fmt.Errorf("failed to enable provider: %w", err)
			}
		}
	}

	return
}

func (c *Etw) UnifiedProviders() (providers []string) {
	providers = make([]string, 0, len(c.Providers))
	for _, p := range c.Providers {
		// we don't take kernel file provider if we enabled tracing feature
		if strings.HasPrefix(p, KernelFileProviderName) && c.FileTraceEnabled() {
			continue
		}
		providers = append(providers, p)
	}

	if c.FileTraceEnabled() {
		// we append specific kernel file provider
		providers = append(providers, c.optimizedKernelFileProvider())
	}

	return utils.DedupStringSlice(providers)
}

func (c *Etw) UnifiedTraces() []string {
	return utils.DedupStringSlice(append(c.Traces, EdrTraceName))

}

```

`agent/config/reports.go`:

```go
package config

import (
	"encoding/json"
	"fmt"
	"os/exec"
	"time"

	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils/command"
)

// ReportCommand is a structure both to configure commands to run in a report
// but also to store the outcome of the command after it ran
type ReportCommand struct {
	Description string        `json:"description" toml:"description" comment:"Description of the command to run, for reporting purposes"`
	Name        string        `json:"name" toml:"name" comment:"Name of the command to execute (can be a binary)"`
	Args        []string      `json:"args" toml:"args" comment:"Argument of the command line"`
	ExpectJSON  bool          `json:"expect-json" toml:"expect-json" comment:"Expect JSON formated output on stdout"`
	Stdout      interface{}   `json:"stdout" toml:",omitempty"`
	Stderr      string        `json:"stderr" toml:",omitempty"`
	Error       string        `json:"error" toml:",omitempty"`
	Timestamp   time.Time     `json:"timestamp" toml:",omitempty"`
	Timeout     time.Duration `json:"timeout" toml:"timeout" comment:"Timeout to apply to the command (if > 0 this takes precedence over the global report timeout setting)"`
}

// Run the desired command
func (c *ReportCommand) Run() {
	var cmd *command.Cmd
	var err error
	var stdout []byte

	if c.Timeout > 0 {
		cmd = command.CommandTimeout(c.Timeout, c.Name, c.Args...)
	} else {
		cmd = command.Command(c.Name, c.Args...)
	}

	defer cmd.Terminate()
	// set timestamp
	c.Timestamp = time.Now()

	if stdout, err = cmd.Output(); err != nil {
		c.Error = err.Error()
		if ee, ok := err.(*exec.ExitError); ok {
			c.Stderr = string(ee.Stderr)
		}
		// return if we encountered an error
		return
	}

	if c.ExpectJSON {
		if err = json.Unmarshal(stdout, &(c.Stdout)); err != nil {
			c.Stdout = string(stdout)
			c.Error = err.Error()
		}
		return
	}

	// we don't want to parse output as JSON
	c.Stdout = stdout
}

var (
	osqueryiArgs = []string{"--json", "-A"}
)

// OSQuery holds configuration about OSQuery tool
type OSQuery struct {
	Tables []string `json:"tables" toml:"tables" comment:"OSQuery tables to add to the report"`
}

// PrepareCommands builds up osquery commands
func (c *OSQuery) PrepareCommands() (cmds []ReportCommand) {
	cmds = make([]ReportCommand, len(c.Tables))

	for i, t := range c.Tables {
		cmds[i].Description = fmt.Sprintf("OSQuery %s table", t)
		cmds[i].Name = tools.ToolOSQueryi
		cmds[i].Args = osqueryiArgs
		cmds[i].Args = append(cmds[i].Args, t)

		cmds[i].ExpectJSON = true
	}

	return
}

// Report holds report configuration
type Report struct {
	EnableReporting bool            `json:"en-reporting" toml:"en-reporting" comment:"Enables IR reporting"`
	CommandTimeout  time.Duration   `json:"timeout" toml:"timeout" comment:"Timeout after which every command expires (to prevent too long commands)"`
	OSQuery         OSQuery         `json:"osquery" toml:"osquery" comment:"OSQuery configuration"`
	Commands        []ReportCommand `json:"commands" toml:"commands" comment:"Commands to execute in addition to the OSQuery ones"`
}

// PrepareCommands builds up all commands to run
func (c *Report) PrepareCommands() (cmds []ReportCommand) {

	cmds = make([]ReportCommand, 0, len(c.OSQuery.Tables)+len(c.Commands))
	// OSQuery commands processed first
	for _, rc := range c.OSQuery.PrepareCommands() {
		rc.Timeout = c.CommandTimeout
		cmds = append(cmds, rc)
	}

	// other commands
	for _, rc := range c.Commands {
		if rc.Timeout == 0 {
			rc.Timeout = c.CommandTimeout
		}
		cmds = append(cmds, rc)
	}
	return
}

```

`agent/cron.go`:

```go
package agent

import (
	"errors"
	"fmt"
	"os"
	"os/exec"
	"path/filepath"
	"strconv"
	"strings"
	"time"

	"github.com/0xrawsec/crony"
	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils"
)

func (a *Agent) containCmd() *exec.Cmd {
	ip := a.forwarder.Client.ManagerIP
	// only allow connection to the manager configured
	return exec.Command("netsh.exe",
		"advfirewall",
		"firewall",
		"add",
		"rule",
		fmt.Sprintf("name=%s", ContainRuleName),
		"dir=out",
		fmt.Sprintf("remoteip=0.0.0.0-%s,%s-255.255.255.255", utils.PrevIP(ip), utils.NextIP(ip)),
		"action=block")
}

func (a *Agent) uncontainCmd() *exec.Cmd {
	return exec.Command("netsh.exe", "advfirewall",
		"firewall",
		"delete",
		"rule",
		fmt.Sprintf("name=%s", ContainRuleName),
	)
}

func (a *Agent) handleManagerCommand(cmd *api.EndpointCommand) {

	// command documentation template:
	/*
		// after copying the template remove #
		#@command: {
			"name": "cmd",
			"description": "Desc",
			"help": "cmd [OPTIONS...] MANDATORY",
			"example": "example"
		}
	*/

	// Switch processing the commands
	switch cmd.Name {

	// Aliases
	/*
		@command: {
				"name": "contain",
				"description": "Isolate host at network level",
				"help": "`contain`"
			}
	*/
	case "contain":
		cmd.FromExecCmd(a.containCmd())

	/*
		@command: {
			"name": "uncontain",
			"description": "Uncontain host (i.e. remove network isolation)",
			"help": "`uncontain`"
		}
	*/
	case "uncontain":
		cmd.FromExecCmd(a.uncontainCmd())

	/*
		@command: {
			"name": "osquery",
			"description": "Alias to `osqueryi --json -A`",
			"help": "`osquery OSQUERY_TABLE`",
			"example": "`osquery processes`"
		}
	*/
	case "osquery":
		// osquery alias
		cmd.Name = tools.ToolOSQueryi
		cmd.Args = append([]string{"--json", "-A"}, cmd.Args...)
		cmd.ExpectJSON = true

	/*
		@command: {
			"name": "sysmon",
			"description": "Alias to the sysmon binary deployed by the EDR. See sysmon binary command line switches for all available options.",
			"help": "`sysmon [OPTIONS]`",
			"example": "`sysmon -h`"
		}
	*/
	case "sysmon":
		// when installed, C:\\Windows\\ takes precedence over
		// the tool present in toolsDir
		cmd.Name = tools.ToolSysmon

	// internal commands
	/*
		@command: {
			"name": "terminate",
			"description": "Terminate a process given its PID",
			"help": "`terminate PID`",
			"example": "`terminate 1337`"
		}
	*/
	case "terminate":
		cmd.Unrunnable()
		if len(cmd.Args) > 0 {
			spid := cmd.Args[0]
			if pid, err := strconv.Atoi(spid); err != nil {
				cmd.ErrorFrom(fmt.Errorf("failed to parse pid: %w", err))
			} else if err := terminate(pid); err != nil {
				cmd.ErrorFrom(err)
			}
		}

	/*
		@command: {
			"name": "hash",
			"description": "Hash a file",
			"help": "`hash FILE`",
			"example": "`hash C:\\\\Windows\\\\System32\\\\cmd.exe`"
		}
	*/
	case "hash":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		if len(cmd.Args) > 0 {
			if out, err := cmdHash(cmd.Args[0]); err != nil {
				cmd.ErrorFrom(err)
			} else {
				cmd.Json = out
			}
		}

	/*
		@command: {
			"name": "rexhash",
			"description": "Recursively find files matching pattern and hashes them",
			"help": "`rexhash DIRECTORY PATTERN`",
			"example": "`rexhash C:\\\\Windows\\\\System32 cmd\\\\.exe`"
		}
	*/
	case "rexhash":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		if len(cmd.Args) == 2 {
			if out, err := cmdFind(cmd.Args[0], cmd.Args[1], true); err != nil {
				cmd.ErrorFrom(err)
			} else {
				cmd.Json = out
			}
		}

	/*
		@command: {
			"name": "stat",
			"description": "Stat a file or a directory",
			"help": "`stat FILE|DIRECTORY`",
			"example": "`stat C:\\\\Windows\\\\System32\\\\cmd.exe`"
		}
	*/
	case "stat":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		if len(cmd.Args) > 0 {
			if out, err := cmdStat(cmd.Args[0]); err != nil {
				cmd.ErrorFrom(err)
			} else {
				cmd.Json = out
			}
		}

	/*
		@command: {
			"name": "ls",
			"description": "List a directory",
			"help": "`ls DIRECTORY`",
			"example": "`ls C:\\\\Windows\\\\`"
		}
	*/
	case "ls":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		if len(cmd.Args) > 0 {
			if out, err := cmdDir(cmd.Args[0]); err != nil {
				cmd.ErrorFrom(err)
			} else {
				cmd.Json = out
			}
		}

	/*
		@command: {
			"name": "walk",
			"description": "Recursively list a directory",
			"help": "`walk DIRECTORY`",
			"example": "`walk C:\\\\Windows\\\\System32`"
		}
	*/
	case "walk":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		if len(cmd.Args) > 0 {
			cmd.Json = cmdWalk(cmd.Args[0])
		}

	/*
		@command: {
			"name": "find",
			"description": "Recursively find a pattern in filename",
			"help": "`find DIRECTORY REGEX_PATTERN`",
			"example": "`find C:\\\\Windows\\\\System32 cmd.*\\.exe`"
		}
	*/
	case "find":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		if len(cmd.Args) == 2 {
			if out, err := cmdFind(cmd.Args[0], cmd.Args[1], false); err != nil {
				cmd.ErrorFrom(err)
			} else {
				cmd.Json = out
			}
		}

	/*
		@command: {
			"name": "report",
			"description": "Generate a full IR ready report",
			"help": "`report`"
		}
	*/
	case "report":
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		cmd.Json = a.Report(false)

	/*
		@command: {
			"name": "processes",
			"description": "Retrieve the full list of processes running (monitored from Sysmon logs)",
			"help": "`processes`"
		}
	*/
	case "processes":
		a.tracker.RLock()
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		cmd.Json = a.tracker.PS()
		a.tracker.RUnlock()

	/*
		@command: {
			"name": "modules",
			"description": "Retrieve the full list of modules ever loaded since boot (monitored from Sysmon logs)",
			"help": "`modules`"
		}
	*/
	case "modules":
		a.tracker.RLock()
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		cmd.Json = a.tracker.Modules()
		a.tracker.RUnlock()

	/*
		@command: {
			"name": "drivers",
			"description": "Retrieve the full list of drivers ever loaded since boot (monitored from Sysmon logs)",
			"help": "`drivers`"
		}
	*/
	case "drivers":
		a.tracker.RLock()
		cmd.Unrunnable()
		cmd.ExpectJSON = true
		cmd.Json = a.tracker.Drivers
		a.tracker.RUnlock()
	}

	// we finally run the command
	if err := cmd.Run(); err != nil {
		a.logger.Errorf("failed to run command sent by manager \"%s\": %s", cmd.String(), err)
	}
}

////////////////// Tasks definition

// routine which manages command to be executed on the endpoint
// it is made in such a way that we can send burst of commands
func (a *Agent) taskCommandRunner() {
	defaultSleep := time.Second * 5
	sleep := defaultSleep

	burstDur := time.Duration(0)
	tgtBurstDur := time.Second * 30
	burstSleep := time.Millisecond * 500

	for {
		if cmd, err := a.forwarder.Client.FetchCommand(); err != nil && err != client.ErrNothingToDo {
			a.logger.Error(err)
		} else if err == nil {
			// reduce sleeping time if a command was received
			sleep = burstSleep
			burstDur = 0
			a.logger.Infof("[command runner] handling manager command: %s", cmd.String())
			a.handleManagerCommand(cmd)
			if err := a.forwarder.Client.PostCommand(cmd); err != nil {
				a.logger.Error("[command runner]", err)
			}
		}

		// if we reached the targetted burst duration
		if burstDur >= tgtBurstDur {
			sleep = defaultSleep
		}

		if sleep == burstSleep {
			burstDur += sleep
		}

		time.Sleep(sleep)
	}
}

func (a *Agent) scheduleCleanArchivedTask() error {
	if a.config.Sysmon.CleanArchived {
		archivePath := a.config.Sysmon.ArchiveDirectory

		if archivePath == "" {
			return errors.New("sysmon archive directory not configured")
		}

		if !fsutil.IsDir(archivePath) {
			return fmt.Errorf("no such Sysmon archive directory: %s", archivePath)
		}

		// to track already reported deletion errors
		reported := datastructs.NewSyncedSet()

		a.logger.Infof("Scheduling archive cleanup loop for directory: %s", archivePath)
		a.scheduler.Schedule(crony.NewTask("Sysmon archived files cleaner").Func(func() {
			// used to mark files for which we already reported errors
			// expiration fixed to five minutes
			expired := time.Now().Add(time.Minute * -5)
			for wi := range fswalker.Walk(archivePath) {
				for _, fi := range wi.Files {
					if archivedRe.MatchString(fi.Name()) {
						path := filepath.Join(wi.Dirpath, fi.Name())
						if fi.ModTime().Before(expired) {
							// we print out error only once
							if err := os.Remove(path); err != nil && !reported.Contains(path) {
								a.logger.Error("[sysmon archived files cleaner]", "failed to remove archived file:", err)
								reported.Add(path)
							}
						}
					}
				}
			}
		}).Ticker(time.Minute), crony.PrioMedium)
	}

	return nil
}

func (a *Agent) taskUploadDumps() {
	// Sending dump files over to the manager
	for wi := range fswalker.Walk(a.config.Dump.Dir) {
		for _, fi := range wi.Files {
			sp := strings.Split(wi.Dirpath, string(os.PathSeparator))
			// upload only file with some extensions
			if uploadExts.Contains(filepath.Ext(fi.Name())) {
				if len(sp) >= 2 {
					var shrink *client.UploadShrinker
					var err error

					guid := sp[len(sp)-2]
					ehash := sp[len(sp)-1]
					fullpath := filepath.Join(wi.Dirpath, fi.Name())

					// we create upload shrinker object
					if shrink, err = client.NewUploadShrinker(fullpath, guid, ehash); err != nil {
						a.logger.Errorf("[dump uploader] failed to create upload iterator: %s", err)
						continue
					}

					if shrink.Size() > a.config.FwdConfig.Client.MaxUploadSize {
						a.logger.Warnf("[dump uploader] dump file is above allowed upload limit, %s will be deleted without being sent", fullpath)
						goto CleanShrinker
					}

					// we shrink a file into several chunks to reduce memory impact
					for fu := shrink.Next(); fu != nil; fu = shrink.Next() {
						if err = a.forwarder.Client.PostDump(fu); err != nil {
							a.logger.Error(err)
							break
						}
					}

				CleanShrinker:
					// close shrinker otherwise we cannot remove files
					shrink.Close()

					if shrink.Err() == nil {
						a.logger.Infof("[dump uploader] dump file successfully sent to manager, deleting: %s", fullpath)
						if err := os.Remove(fullpath); err != nil {
							a.logger.Errorf("[dump uploader] failed to remove file %s: %s", fullpath, err)
						}
					} else {
						a.logger.Errorf("[dump uploader] failed to post dump file: %s", shrink.Err())
					}
				} else {
					a.logger.Errorf("[dump uploader] unexpected directory layout, cannot send dump to manager")
				}
			}
		}
	}
}

func (a *Agent) updateTools() (err error) {
	var mtools map[string]*tools.Tool
	var locToolNames []string

	// getting the list of tools from the manager, only metatada are returned
	if mtools, err = a.forwarder.Client.ListTools(); err != nil {
		return
	}

	// updating local tools from remote
	for _, t := range mtools {
		var old *tools.Tool

		// if the tool is already there we continue
		if a.db.Search(&tools.Tool{}, "Metadata.Sha512", "=", t.Metadata.Sha512).Len() == 1 {
			continue
		}

		// we get the tool from manager
		if t, err = a.forwarder.Client.GetTool(t.Metadata.Sha256); err != nil {
			return
		}

		// search for a tool with the same name
		if err = a.db.Search(&tools.Tool{}, "Name", "=", t.Name).And("OS", "=", los.OS).AssignUnique(&old); err != nil && !sod.IsNoObjectFound(err) {
			return
		} else if err == nil {
			// we use same UUID not to duplicate entry
			t.Initialize(old.UUID())
		}

		// we update local database
		if err = a.db.InsertOrUpdate(t); err != nil {
			return
		}

		// dumping the tool on local folder
		if err = t.Dump(toolsDir); err != nil {
			return
		}
	}

	// We retrieve the names of the local files
	if err = a.db.AssignIndex(&tools.Tool{}, "Name", &locToolNames); err != nil {
		return
	}

	// deleting local tools
	for _, locName := range locToolNames {
		// if we have a tool locally that has been deleted from remote
		if _, ok := mtools[locName]; !ok {
			var t *tools.Tool
			s := a.db.Search(&tools.Tool{}, "Name", "=", locName)
			if err = s.AssignUnique(&t); err != nil {
				return
			}

			if err = t.Remove(toolsDir); err != nil {
				return
			}

			if err = s.Delete(); err != nil {
				return
			}
		}
	}

	return
}

func (a *Agent) scheduleTasks() {
	inLittleWhile := time.Now().Add(time.Second * 5)

	// routines scheduled only if connected to a manager
	if a.config.IsForwardingEnabled() {
		// High prio tasks

		// agent configuration update
		a.scheduler.Schedule(
			crony.NewTask("Configuration update").
				Func(func() {
					task := "[configuration update]"
					a.logger.Info(task, "update starting")
					if err := a.updateAgentConfig(); err != nil {
						a.logger.Error(task, err)
					}
				}).Ticker(time.Minute*15).
				Schedule(time.Now()),
			crony.PrioHigh,
		)

		// updating tools
		a.scheduler.Schedule(crony.NewTask("Utilities update").
			Func(func() {
				task := "[utilities update]"
				a.logger.Info(task, "update starting")
				if err := a.updateTools(); err != nil {
					a.logger.Error(task, err)
				}
			}).Ticker(time.Minute*15).
			Schedule(inLittleWhile),
			crony.PrioHigh)

		// updating engine
		a.scheduler.Schedule(crony.NewTask("Rule/IOC Update").
			Func(func() {
				task := "[rule/ioc update]"
				a.logger.Info(task, "update starting")
				if err := a.update(false); err != nil {
					a.logger.Error(task, err)
				}
			}).Ticker(a.config.RulesConfig.UpdateInterval).
			Schedule(inLittleWhile),
			crony.PrioHigh)

		// command runner routine, we run it only once as it creates a go routine to handle commands
		a.scheduler.Schedule(
			crony.NewAsyncTask("Command handler goroutine").
				Func(a.taskCommandRunner).
				Schedule(time.Now()),
			crony.PrioHigh)

		// Medium Prio Tasks

		// uploading dumps
		a.scheduler.Schedule(crony.NewTask("Upload Dump").
			Func(func() {
				task := "[upload dump]"
				a.logger.Info(task, "dump upload starting")
				a.taskUploadDumps()
				a.logger.Info(task, "dump upload done")
			}).Ticker(time.Minute).
			Schedule(time.Now()),
			crony.PrioMedium)

		// updating sysmon
		a.scheduler.Schedule(crony.NewTask("Sysmon update").
			Func(func() {
				task := "[sysmon update]"
				a.logger.Info(task, "update starting")
				if err := a.updateSysmonBin(); err != nil {
					a.logger.Error(task, err)
				}
			}).Ticker(time.Hour).
			Schedule(inLittleWhile),
			crony.PrioMedium)

		// updating sysmon configuration
		a.scheduler.Schedule(crony.NewTask("Sysmon configuration update").
			Func(func() {
				task := "[sysmon config update]"
				a.logger.Info(task, "update starting")
				if err := a.updateSysmonConfig(); err != nil {
					a.logger.Error(task, err)
				}
			}).Ticker(time.Minute*15).
			Schedule(inLittleWhile),
			crony.PrioMedium)

		// Low Prio Tasks

		// updating system information
		a.scheduler.Schedule(crony.NewTask("System Info Update").
			Func(func() {
				task := "[system info update]"
				a.logger.Info(task, "update starting")
				if err := a.updateSystemInfo(); err != nil {
					a.logger.Error(task, err)
				}
			}).Ticker(a.config.RulesConfig.UpdateInterval).
			Schedule(inLittleWhile),
			crony.PrioLow)

	}

	// routines scheduled in any case

	// Forwarder scheduling
	a.scheduler.Schedule(crony.NewTask("Log forwarder").
		Func(func() {
			// this call starts a new go routine so we don't need to create
			// a new AsyncTask as it is not a blocking call
			a.forwarder.Run()
		}).Schedule(time.Now()), crony.PrioHigh)

	// routine managing Sysmon archived files cleanup
	if err := a.scheduleCleanArchivedTask(); err != nil {
		a.logger.Error("failed to schedule sysmon archived file cleaning: ", err)
	}

	// routine creating canary files
	a.scheduler.Schedule(crony.NewAsyncTask("Canary configuration").
		Func(func() {
			task := "[canary configuration]"
			if err := a.config.CanariesConfig.Configure(); err != nil {
				a.logger.Error(task, err)
			}
		}).Schedule(time.Now()), crony.PrioHigh)

	// Action handler scheduling
	a.scheduler.Schedule(crony.NewAsyncTask("Action Handler").
		Func(func() {
			a.actionHandler.handleActionsLoop()
		}).Schedule(time.Now()), crony.PrioHigh)

	a.scheduler.Schedule(crony.NewAsyncTask("Action Handler File Compression").
		Func(func() {
			a.actionHandler.compressionLoop()
		}).Schedule(time.Now()), crony.PrioHigh)
}

```

`agent/defaults.go`:

```go
package agent

import (
	"path/filepath"
	"time"

	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/api"
	clientConfig "github.com/0xrawsec/whids/api/client/config"
)

func BuildDefaultConfig(root string) *config.Agent {

	logDir := filepath.Join(root, "Logs")
	dbDir := filepath.Join(root, "Database")

	return &config.Agent{
		DatabasePath: filepath.Join(dbDir, "Sod"),
		RulesConfig: config.Rules{
			RulesDB:        filepath.Join(dbDir, "Rules"),
			ContainersDB:   filepath.Join(dbDir, "Containers"),
			UpdateInterval: 60 * time.Second,
		},

		FwdConfig: clientConfig.Forwarder{
			Local: true,
			Client: clientConfig.Client{
				MaxUploadSize: api.DefaultMaxUploadSize,
			},
			Logging: clientConfig.ForwarderLogging{
				Dir:              filepath.Join(logDir, "Alerts"),
				RotationInterval: time.Hour * 5,
			},
		},
		EtwConfig: config.Etw{
			Providers: []string{
				"Microsoft-Windows-Sysmon",
				"Microsoft-Windows-Windows Defender",
				"Microsoft-Windows-PowerShell",
				"Microsoft-Antimalware-Scan-Interface",
			},
			Traces: []string{"Eventlog-Security"},
		},
		Sysmon: config.Sysmon{
			Bin:              "C:\\Windows\\Sysmon64.exe",
			ArchiveDirectory: "C:\\Sysmon\\",
			CleanArchived:    true,
		},
		Actions: config.Actions{
			AvailableActions: AvailableActions,
			Low:              []string{},
			Medium:           []string{"brief", "filedump", "regdump"},
			High:             []string{"report", "filedump", "regdump"},
			Critical:         []string{"report", "filedump", "regdump", "memdump"},
		},
		Dump: config.Dump{
			Dir:           filepath.Join(root, "Dumps"),
			Compression:   true,
			MaxDumps:      4,
			DumpUntracked: false,
		},
		Report: config.Report{
			EnableReporting: false,
			OSQuery: config.OSQuery{
				Tables: []string{"processes", "services", "scheduled_tasks", "drivers", "startup_items", "process_open_sockets"}},
			Commands: []config.ReportCommand{{
				Description: "Example command",
				Name:        "osqueryi.exe",
				Args:        []string{"--json", "-A", "processes"},
				ExpectJSON:  true,
			}},
			CommandTimeout: 60 * time.Second,
		},
		AuditConfig: config.Audit{
			AuditPolicies: []string{"File System"},
		},
		CanariesConfig: config.Canaries{
			Enable: false,
			Canaries: []*config.Canary{
				{
					Directories: []string{"$SYSTEMDRIVE", "$SYSTEMROOT"},
					Files:       []string{"readme.pdf", "readme.docx", "readme.txt"},
					Delete:      true,
				},
			},
			Actions: []string{"kill", "memdump", "filedump", "blacklist", "report"},
			Whitelist: []string{
				"System",
				"C:\\Windows\\explorer.exe",
			},
		},
		CritTresh:       5,
		Logfile:         filepath.Join(logDir, "whids.log"),
		EnableHooks:     true,
		EnableFiltering: true,
		Endpoint:        true,
		LogAll:          false}
}

```

`agent/etw.go`:

```go
package agent

import (
	"github.com/0xrawsec/golang-etw/etw"
	"github.com/0xrawsec/whids/utils"
)

var (
	microsoftKernelFileGUID = etw.MustParseGUIDFromString("{EDD08927-9CC4-4E65-B970-C2560FB5C289}")
	targetFileName          = pathSysmonTargetFilename.Last()
)

func (a *Agent) eventRecordCallback(er *etw.EventRecord) bool {
	// skip EDR events early
	return !(er.EventHeader.ProviderId.Equals(microsoftKernelFileGUID) && er.EventHeader.ProcessId == u32PID)
}

func (a *Agent) microsoftKernelFileProcessing(h *etw.EventRecordHelper) (err error) {
	var fo uint64
	var fn string

	switch h.EventID() {
	case 12:

		// we skip file create events
		h.Skip()

		if fo, err = h.GetPropertyUint("FileObject"); err != nil {
			break
		}

		if fn, err = h.GetPropertyString("FileName"); err != nil {
			break
		}

		kf := &KernelFile{
			FileName:   utils.ResolveCDrive(fn),
			FileObject: fo,
		}

		a.tracker.AddKernelFile(kf)

	case 14:

		// skip file close events
		h.Skip()

		if object, err := h.GetPropertyUint("FileObject"); err == nil {
			a.tracker.DelKernelFile(object)
		}

	case 15, 16:
		var kf *KernelFile
		var ok bool

		h.Skip()

		// check if it it worth processing the event
		if (h.EventID() == KernelFileRead && !a.config.EtwConfig.TraceFiles.Read) ||
			(h.EventID() == KernelFileWrite && !a.config.EtwConfig.TraceFiles.Write) {
			break
		}

		// Default
		h.SetProperty("TargetFileName", unkFieldValue)

		if fo, err = h.GetPropertyUint("FileObject"); err != nil {
			break
		}

		if kf, ok = a.tracker.GetKernelFile(fo); !ok {
			break
		}

		if (h.EventID() == KernelFileRead && kf.Flags.Read) || (h.EventID() == KernelFileWrite && kf.Flags.Write) {
			break
		}

		h.SetProperty(targetFileName, kf.FileName)
		h.SelectFields(targetFileName)
		kf.Flags.Read = (h.EventID() == KernelFileRead)
		kf.Flags.Write = (h.EventID() == KernelFileWrite)
		// don't skip event
		h.Flags.Skip = false

	default:
		h.Skip()
	}

	return
}

func (a *Agent) preparedCallback(h *etw.EventRecordHelper) (err error) {

	switch {
	// if events are comming from Microsoft-Kernel-File provider
	case h.TraceInfo.ProviderGUID.Equals(microsoftKernelFileGUID) && a.config.EtwConfig.FileTraceEnabled():
		return a.microsoftKernelFileProcessing(h)
	}

	return
}

```

`agent/eventids.go`:

```go
package agent

// Sysmon Event IDs
const (
	_ = iota
	SysmonProcessCreate
	SysmonFileTime
	SysmonNetworkConnect
	SysmonServiceStateChange
	SysmonProcessTerminate
	SysmonDriverLoad
	SysmonImageLoad
	SysmonCreateRemoteThread
	SysmonRawAccessRead
	SysmonAccessProcess
	SysmonFileCreate
	SysmonRegKey
	SysmonRegSetValue
	SysmonRegName
	SysmonCreateStreamHash
	SysmonServiceConfigurationChange
	SysmonCreateNamedPipe
	SysmonConnectNamedPipe
	SysmonWMIFilter
	SysmonWMIConsumer
	SysmonWMIBinding
	SysmonDNSQuery
	SysmonFileDelete
	SysmonClipboardChange
	SysmonProcessTampering
	SysmonFileDeleteDetected
)

const (
	// https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4663
	SecurityAccessObject = 4663
)

// Microsoft-Windows-Kernel-File/Analytic
const (
	KernelFileNameCreate = iota + 10
	KernelFileNameDelete
	KernelFileCreate
	KernelFileCleanup
	KernelFileClose
	KernelFileRead
	KernelFileWrite
	KernelFileSetInformation
	KernelFileSetDelete
	KernelFileRename
	KernelFileDirEnum
	KernelFileFlush
	KernelFileQueryInformation
	KernelFileFSCTL
	KernelFileOperationEnd
	KernelFileDirNotify
	KernelFileDeletePath
	KernelFileRenamePath
	KernelFileSetLinkPath
	KernelFileCreateNewFile
	KernelFileSetSecurity
	KernelFileQuerySecurity
	KernelFileSetEA
	KernelFileQueryEA
)

var (
	KernelFileOperations = map[int64]string{
		KernelFileNameCreate:       "NameCreate",
		KernelFileNameDelete:       "NameDelete",
		KernelFileCreate:           "Create",
		KernelFileCleanup:          "Cleanup",
		KernelFileClose:            "Close",
		KernelFileRead:             "Read",
		KernelFileWrite:            "Write",
		KernelFileSetInformation:   "SetInformation",
		KernelFileSetDelete:        "SetDelete",
		KernelFileRename:           "Rename",
		KernelFileDirEnum:          "DirEnum",
		KernelFileFlush:            "Flush",
		KernelFileQueryInformation: "QueryInformation",
		KernelFileFSCTL:            "FSCTL",
		KernelFileOperationEnd:     "OperationEnd",
		KernelFileDirNotify:        "DirNotify",
		KernelFileDeletePath:       "DeletePath",
		KernelFileRenamePath:       "RenamePath",
		KernelFileSetLinkPath:      "SetLinkPath",
		KernelFileCreateNewFile:    "CreateNewFile",
		KernelFileSetSecurity:      "SetSecurity",
		KernelFileQuerySecurity:    "QuerySecurity",
		KernelFileSetEA:            "SetEA",
		KernelFileQueryEA:          "QueryEA",
	}
)

```

`agent/filters.go`:

```go
package agent

import (
	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/whids/event"
)

//Sysmon related
var (
	// sysmonChannel Sysmon windows event log channel
	sysmonChannel = "Microsoft-Windows-Sysmon/Operational"

	// Filters definitions
	fltAnyEvent = NewFilter([]int64{}, "")

	// Sysmon filters
	fltAnySysmon       = NewFilter([]int64{}, sysmonChannel)
	fltProcessCreate   = NewFilter([]int64{SysmonProcessCreate}, sysmonChannel)
	fltTrack           = NewFilter([]int64{SysmonProcessCreate, SysmonDriverLoad}, sysmonChannel)
	fltProcTermination = NewFilter([]int64{SysmonProcessTerminate}, sysmonChannel)
	fltImageLoad       = NewFilter([]int64{SysmonImageLoad}, sysmonChannel)
	fltRegSetValue     = NewFilter([]int64{SysmonRegSetValue}, sysmonChannel)
	//fltNetwork         = NewFilter([]int64{SysmonNetworkConnect, SysmonDNSQuery}, sysmonChannel)
	//fltDNS             = NewFilter([]int64{SysmonDNSQuery}, sysmonChannel)
	fltClipboard      = NewFilter([]int64{SysmonClipboardChange}, sysmonChannel)
	fltImageTampering = NewFilter([]int64{SysmonProcessTampering}, sysmonChannel)

	fltImageSize = NewFilter([]int64{
		SysmonProcessCreate,
		SysmonDriverLoad,
		SysmonImageLoad},
		sysmonChannel)

	fltStats = NewFilter([]int64{
		SysmonProcessCreate,
		SysmonNetworkConnect,
		SysmonFileCreate,
		SysmonDNSQuery,
		SysmonFileDelete,
		SysmonFileDeleteDetected},
		sysmonChannel)
)

// Security channel related
var (
	// securityChannel Security windows event log channel
	securityChannel = "Security"
	// Security filters
	fltFSObjectAccess = NewFilter([]int64{SecurityAccessObject}, securityChannel)
)

// ETW Kernel File related
var (
	kernelFileChannel = "Microsoft-Windows-Kernel-File/Analytic"
	/*fltKernelFile     = NewFilter([]int64{
	KernelFileCreate,
	KernelFileClose,
	KernelFileRead,
	KernelFileWrite},
	kernelFileChannel)
	*/
	fltKernelFile = NewFilter([]int64{},
		kernelFileChannel)
)

// Filter structure
type Filter struct {
	EventIDs *datastructs.SyncedSet
	Channel  string
}

// NewFilter creates a new Filter structure
func NewFilter(eids []int64, channel string) *Filter {
	f := &Filter{}
	f.EventIDs = datastructs.NewInitSyncedSet(datastructs.ToInterfaceSlice(eids)...)
	f.Channel = channel
	return f
}

// Match checks if an event matches the filter
func (f *Filter) Match(e *event.EdrEvent) bool {
	if !f.EventIDs.Contains(e.EventID()) && f.EventIDs.Len() > 0 {
		return false
	}
	// Don't check channel if empty string
	if f.Channel != "" && f.Channel != e.Channel() {
		return false
	}
	return true
}

```

`agent/guids.go`:

```go
package agent

const (
	SysmonProviderGuid = "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}"
)

```

`agent/hookdefs.go`:

```go
package agent

import (
	"fmt"
	"math"
	"net"
	"os"
	"path/filepath"
	"strings"
	"time"

	"github.com/0xrawsec/gene/v2/engine"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-win32/win32"
	"github.com/0xrawsec/golang-win32/win32/advapi32"
	"github.com/0xrawsec/golang-win32/win32/kernel32"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/utils"
)

////////////////////////////////// Hooks //////////////////////////////////

const (
	// Empty GUID
	nullGUID      = "{00000000-0000-0000-0000-000000000000}"
	unkFieldValue = "?"
)

var (
	selfPath, _ = filepath.Abs(os.Args[0])
)

// hook applying on Sysmon events containing image information and
// adding a new field containing the image size

func hookSetImageSize(h *Agent, e *event.EdrEvent) {
	var image string
	var ok bool
	var path *engine.XPath
	var imSzPath *engine.XPath

	switch e.EventID() {
	case SysmonProcessCreate:
		path = pathSysmonImage
		imSzPath = pathImSize
	default:
		path = pathSysmonImageLoaded
		imSzPath = pathImLoadedSize
	}

	if image, ok = e.GetString(path); !ok {
		goto RETURN
	}

	if !fsutil.IsFile(image) {
		goto RETURN
	}

	if stat, err := os.Stat(image); err == nil {
		e.SetIfMissing(imSzPath, toString(stat.Size()))
		return
	}

RETURN:
	e.SetIfMissing(imSzPath, unkFieldValue)
}

func hookImageLoad(h *Agent, e *event.EdrEvent) {
	var ok bool
	var guid string
	var track *ProcessTrack
	var mi *ModuleInfo

	if guid, ok = e.GetString(pathSysmonProcessGUID); !ok {
		goto RETURN
	}

	if track = h.tracker.GetByGuid(guid); track.IsZero() {
		goto RETURN
	}

	// we get a module info from cache or we update
	mi = h.tracker.GetModuleOrUpdate(ModuleInfoFromEvent(e))

	// make sure that we are taking signature of the image and not
	// one of its DLL
	if mi.Image == track.Image {
		track.Signed = mi.Signed
		track.Signature = mi.Signature
		track.SignatureStatus = mi.SignatureStatus
	} else {
		// update module list
		track.Modules = append(track.Modules, mi)
	}

	e.SetIfMissing(pathImageLoadParentImage, track.ParentImage)
	e.SetIfMissing(pathImageLoadParentCommandLine, track.ParentCommandLine)
	return

RETURN:
	e.SetIfMissing(pathImageLoadParentImage, unkFieldValue)
	e.SetIfMissing(pathImageLoadParentCommandLine, unkFieldValue)
}

func trackSysmonProcessCreate(h *Agent, e *event.EdrEvent) {
	var ok bool
	var track *ProcessTrack
	var pid int64
	var guid, image, commandLine, pCommandLine, pImage, pguid, user, il, cd, hashes string

	// We need to be sure that process termination is enabled
	// before initiating process tracking not to fill up memory
	// with structures that will never be freed
	if h.bootCompleted && !h.flagProcTermEn {
		goto DEFAULT
	}

	if guid, ok = e.GetString(pathSysmonProcessGUID); !ok {
		goto DEFAULT
	}

	if pid, ok = e.GetInt(pathSysmonProcessId); !ok {
		goto DEFAULT
	}

	if image, ok = e.GetString(pathSysmonImage); !ok {
		goto DEFAULT
	}

	// Boot sequence is completed when LogonUI.exe is strarted
	if strings.EqualFold(image, "C:\\Windows\\System32\\LogonUI.exe") {
		h.logger.Infof("Boot sequence completed")
		h.bootCompleted = true
	}

	if commandLine, ok = e.GetString(pathSysmonCommandLine); !ok {
		goto DEFAULT
	}

	if pCommandLine, ok = e.GetString(pathSysmonParentCommandLine); !ok {
		goto DEFAULT
	}

	if pImage, ok = e.GetString(pathSysmonParentImage); !ok {
		goto DEFAULT
	}

	if pguid, ok = e.GetString(pathSysmonParentProcessGUID); !ok {
		goto DEFAULT
	}

	if user, ok = e.GetString(pathSysmonUser); !ok {
		goto DEFAULT
	}

	if il, ok = e.GetString(pathSysmonIntegrityLevel); !ok {
		goto DEFAULT
	}

	if cd, ok = e.GetString(pathSysmonCurrentDirectory); !ok {
		goto DEFAULT
	}

	if hashes, ok = e.GetString(pathSysmonHashes); !ok {
		goto DEFAULT
	}

	track = NewProcessTrack(image, pguid, guid, pid)
	track.ParentImage = pImage
	track.CommandLine = commandLine
	track.ParentCommandLine = pCommandLine
	track.CurrentDirectory = cd
	track.User = user
	track.IntegrityLevel = il
	track.SetHashes(hashes)

	// Getting process protection level first
	if pl, err := kernel32.GetProcessProtectionLevel(uint32(pid)); err == nil {
		track.ProtectionLevel = uint32(pl)
	}

	if parent := h.tracker.GetByGuid(pguid); !parent.IsZero() {
		track.Ancestors = append(parent.Ancestors, parent.Image)
		track.ParentUser = parent.User
		track.ParentIntegrityLevel = parent.IntegrityLevel
		track.ParentServices = parent.Services
		track.ParentCurrentDirectory = parent.CurrentDirectory
		track.ParentProtectionLevel = parent.ProtectionLevel
	} else {
		// For processes created by System
		if pimage, ok := e.GetString(pathSysmonParentImage); ok {
			track.Ancestors = append(track.Ancestors, pimage)
			// if parent is System
			if strings.EqualFold(pimage, "System") {
				ptrack := NewProcessTrack(pimage,
					nullGUID, pguid, e.GetIntOr(pathSysmonParentProcessId, -1))
				h.tracker.Add(ptrack)
			}
		}
	}

	h.tracker.Add(track)
	e.SetIfMissing(pathAncestors, strings.Join(track.Ancestors, "|"))
	e.SetIfMissing(pathProtectionLevel, fmt.Sprintf("0x%x", track.ProtectionLevel))
	e.SetIfMissing(pathParentProtectionLevel, fmt.Sprintf("0x%x", track.ParentProtectionLevel))
	if track.ParentUser != "" {
		e.SetIfMissing(pathParentUser, track.ParentUser)
	}
	if track.ParentIntegrityLevel != "" {
		e.SetIfMissing(pathParentIntegrityLevel, track.ParentIntegrityLevel)
	}

	if track.ParentServices != "" {
		e.SetIfMissing(pathParentServices, track.ParentServices)
	}

DEFAULT:
	// Default values
	e.SetIfMissing(pathAncestors, unkFieldValue)
	e.SetIfMissing(pathParentUser, unkFieldValue)
	e.SetIfMissing(pathParentIntegrityLevel, unkFieldValue)
	e.SetIfMissing(pathParentServices, unkFieldValue)
}

// hook tracking processes
func hookTrack(h *Agent, e *event.EdrEvent) {
	switch e.EventID() {
	case SysmonProcessCreate:
		// moved to a function to make code cleaner
		trackSysmonProcessCreate(h, e)

	case SysmonDriverLoad:
		d := DriverInfoFromEvent(e)
		h.tracker.Drivers = append(h.tracker.Drivers, *d)
	}
}

// hook managing statistics about some events
func hookStats(h *Agent, e *event.EdrEvent) {
	// We do not store stats if process termination is not enabled
	if !h.flagProcTermEn {
		return
	}

	if pt := h.tracker.SourceTrackFromEvent(e); !pt.IsZero() {
		switch e.EventID() {
		case SysmonProcessCreate:
			pt.Stats.CreateProcessCount++

		case SysmonNetworkConnect:
			if ip, ok := e.GetString(pathSysmonDestIP); ok {
				if port, ok := e.GetInt(pathSysmonDestPort); ok {
					if ts, ok := e.GetString(pathSysmonUtcTime); ok {
						pt.Stats.UpdateCon(ts, ip, uint16(port))
					}
				}
			}

		case SysmonDNSQuery:
			if ts, ok := e.GetString(pathSysmonUtcTime); ok {
				if qvalue, ok := e.GetString(pathQueryName); ok {
					if qresults, ok := e.GetString(pathQueryResults); ok {
						if qresults != "" && qresults != "-" {
							records := strings.Split(qresults, ";")
							for _, r := range records {
								// check if it is a valid IP
								if net.ParseIP(r) != nil {
									pt.Stats.UpdateNetResolve(ts, r, qvalue)
								}
							}
						}
					}
				}
			}

		case SysmonFileCreate:
			now := time.Now()

			// Set new fields
			e.Set(pathFileCount, unkFieldValue)
			e.Set(pathFileCountByExt, unkFieldValue)
			e.Set(pathFileExtension, unkFieldValue)

			if pt.Stats.Files.TimeFirstFileCreated.IsZero() {
				pt.Stats.Files.TimeFirstFileCreated = now
			}

			if target, ok := e.GetString(pathSysmonTargetFilename); ok {
				ext := filepath.Ext(target)
				pt.Stats.Files.CountFilesCreatedByExt[ext]++
				// Setting file count by extension
				e.Set(pathFileCountByExt, toString(pt.Stats.Files.CountFilesCreatedByExt[ext]))
				// Setting file extension
				e.Set(pathFileExtension, ext)
			}
			pt.Stats.Files.CountFilesCreated++
			// Setting total file count
			e.Set(pathFileCount, toString(pt.Stats.Files.CountFilesCreated))
			// Setting frequency
			freq := now.Sub(pt.Stats.Files.TimeFirstFileCreated)
			if freq != 0 {
				eps := pt.Stats.Files.CountFilesCreated * int64(math.Pow10(9)) / freq.Nanoseconds()
				e.Set(pathFileFrequency, toString(int64(eps)))
			} else {
				e.Set(pathFileFrequency, toString(0))
			}
			// Finally set last event timestamp
			pt.Stats.Files.TimeLastFileCreated = now

		case SysmonFileDelete, SysmonFileDeleteDetected:
			now := time.Now()

			// Set new fields
			e.Set(pathFileCount, unkFieldValue)
			e.Set(pathFileCountByExt, unkFieldValue)
			e.Set(pathFileExtension, unkFieldValue)

			if pt.Stats.Files.TimeFirstFileDeleted.IsZero() {
				pt.Stats.Files.TimeFirstFileDeleted = now
			}

			if target, ok := e.GetString(pathSysmonTargetFilename); ok {
				ext := filepath.Ext(target)
				pt.Stats.Files.CountFilesDeletedByExt[ext]++
				// Setting file count by extension
				e.Set(pathFileCountByExt, toString(pt.Stats.Files.CountFilesDeletedByExt[ext]))
				// Setting file extension
				e.Set(pathFileExtension, ext)
			}
			pt.Stats.Files.CountFilesDeleted++
			// Setting total file count
			e.Set(pathFileCount, toString(pt.Stats.Files.CountFilesDeleted))

			// Setting frequency
			freq := now.Sub(pt.Stats.Files.TimeFirstFileDeleted)
			if freq != 0 {
				eps := pt.Stats.Files.CountFilesDeleted * int64(math.Pow10(9)) / freq.Nanoseconds()
				e.Set(pathFileFrequency, toString(int64(eps)))
			} else {
				e.Set(pathFileFrequency, toString(0))
			}

			// Finally set last event timestamp
			pt.Stats.Files.TimeLastFileDeleted = time.Now()
		}
	}
}

// hook updating a threat score by process
func hookUpdateGeneScore(h *Agent, e *event.EdrEvent) {
	var t *ProcessTrack

	if h.IsHIDSEvent(e) {
		return
	}

	if t = h.tracker.SourceTrackFromEvent(e); t.IsZero() {
		return
	}

	if d := e.GetDetection(); d != nil {
		t.ThreatScore.Update(d)
	}
}

// hook terminating previously blacklisted processes (according to their CommandLine)
func hookTerminator(h *Agent, e *event.EdrEvent) {
	var commandLine string
	var pid int64
	var ok bool

	if e.EventID() != SysmonProcessCreate {
		return
	}

	if commandLine, ok = e.GetString(pathSysmonCommandLine); !ok {
		return
	}

	if pid, ok = e.GetInt(pathSysmonProcessId); !ok {
		return
	}

	// terminate if blacklisted
	if h.tracker.IsBlacklisted(commandLine) {
		h.logger.Warnf("Terminating blacklisted  process PID=%d CommandLine=\"%s\"", pid, commandLine)
		if err := terminate(int(pid)); err != nil {
			h.logger.Errorf("Failed to terminate process PID=%d: %s", pid, err)
		}
	}
}

// hook setting flagProcTermEn variable
// it is also used to cleanup any structures needing to be cleaned
func hookProcTerm(h *Agent, e *event.EdrEvent) {
	var guid string
	var ok bool

	h.logger.Debug("Process termination events are enabled")
	h.flagProcTermEn = true

	if guid, ok = e.GetString(pathSysmonProcessGUID); !ok {
		return
	}

	// Releasing resources
	h.tracker.Terminate(guid)
	h.memdumped.Del(guid)
}

func hookSelfGUID(h *Agent, e *event.EdrEvent) {
	// no need to continue if EDR guid is already known
	if h.guid != "" {
		return
	}

	// Sometimes it happens that other events are generated before process creation
	// Check parent image first because we launch whids.exe -h to test process termination
	// and we catch it up if we check image first
	if pimage, ok := e.GetString(pathSysmonParentImage); ok {
		if ppid, ok := e.GetInt(pathSysmonParentProcessId); ok {
			if pimage == selfPath && ppid == int64(os.Getpid()) {
				if pguid, ok := e.GetString(pathSysmonParentProcessGUID); ok {
					h.guid = pguid
					h.logger.Infof("Found self GUID from PGUID: %s", h.guid)
					return
				}
			}
		}
	}

	if image, ok := e.GetString(pathSysmonImage); ok {
		if pid, ok := e.GetInt(pathSysmonProcessId); ok {
			if image == selfPath && pid == int64(os.Getpid()) {
				if guid, ok := e.GetString(pathSysmonProcessGUID); ok {
					h.guid = guid
					h.logger.Infof("Found self GUID: %s", h.guid)
					return
				}
			}
		}
	}
}

func hookFileSystemAudit(h *Agent, e *event.EdrEvent) {
	var ok bool
	var pid int64
	var pt *ProcessTrack

	e.SetIfMissing(pathSysmonProcessGUID, nullGUID)
	e.SetIfMissing(pathSysmonCommandLine, unkFieldValue)
	e.SetIfMissing(pathSysmonImage, unkFieldValue)
	e.SetIfMissing(pathImageHashes, unkFieldValue)

	if pid, ok = e.GetInt(pathFSAuditProcessId); !ok {
		return
	}

	if pt = h.tracker.GetByPID(pid); pt.IsZero() {
		return
	}

	e.SetIf(pathSysmonImage, pt.Image, pt.Image != "")
	e.SetIf(pathSysmonCommandLine, pt.CommandLine, pt.CommandLine != "")
	e.SetIf(pathImageHashes, pt.imageHashes, pt.imageHashes != "")
	e.SetIf(pathSysmonProcessGUID, pt.ProcessGUID, pt.ProcessGUID != "")

	if obj, ok := e.GetString(pathFSAuditObjectName); ok {
		if fsutil.IsFile(obj) {
			pt.Stats.Files.LastAccessed.Add(obj)
		}
	}
}

func hookProcessIntegrityProcTamp(h *Agent, e *event.EdrEvent) {
	var ok bool
	var pid int64
	var mainTid int

	// Default values
	e.SetIfMissing(pathProcessIntegrity, toString(-1.0))

	// if not Sysmon Process Tampering event
	if e.EventID() != SysmonProcessTampering {
		return
	}

	// getting pid from event
	if pid, ok = e.GetInt(pathSysmonProcessId); !ok {
		return
	}

	// prevents stopping ourselves
	if pid == int64(os.Getpid()) {
		return
	}

	if !kernel32.IsPIDRunning(int(pid)) {
		h.logger.Errorf("Cannot check process integrity process with PID=%d is stopped", pid)
		return
	}

	if mainTid = kernel32.GetFirstTidOfPid(int(pid)); mainTid < 0 {
		return
	}

	// if we found the main thread of pid
	hThread, err := kernel32.OpenThread(kernel32.THREAD_SUSPEND_RESUME, win32.FALSE, win32.DWORD(mainTid))
	if err != nil {
		h.logger.Errorf("Cannot open main thread before checking integrity of PID=%d", pid)
		return
	}
	// close thread
	defer kernel32.CloseHandle(hThread)

	// we first need to wait main process thread
	if ok := kernel32.WaitThreadRuns(hThread, time.Millisecond*50, time.Millisecond*500); !ok {
		// We check whether the thread still exists
		checkThread, err := kernel32.OpenThread(kernel32.PROCESS_SUSPEND_RESUME, win32.FALSE, win32.DWORD(mainTid))
		if err == nil {
			h.logger.Warnf("Timeout reached while waiting main thread of PID=%d", pid)
		}
		// close thread
		kernel32.CloseHandle(checkThread)
		return
	}

	da := win32.DWORD(kernel32.PROCESS_VM_READ | kernel32.PROCESS_QUERY_INFORMATION)
	hProcess, err := kernel32.OpenProcess(da, win32.FALSE, win32.DWORD(pid))

	if err != nil {
		h.logger.Errorf("Cannot open process to check integrity of PID=%d: %s", pid, err)
		return
	}
	// close process
	defer kernel32.CloseHandle(hProcess)

	bdiff, slen, err := kernel32.CheckProcessIntegrity(hProcess)
	if err != nil {
		h.logger.Errorf("Cannot check integrity of PID=%d: %s", pid, err)
		return
	}

	if slen != 0 {
		integrity := utils.Round(float64(bdiff)*100/float64(slen), 2)
		e.Set(pathProcessIntegrity, toString(integrity))
	}
}

// too big to be put in hookEnrichAnySysmon
func hookEnrichServices(h *Agent, e *event.EdrEvent) {
	var err error

	// We do this only if we can cleanup resources
	eventID := e.EventID()

	if !h.flagProcTermEn {
		return
	}

	switch eventID {
	case SysmonDriverLoad, SysmonWMIBinding, SysmonWMIConsumer, SysmonWMIFilter:
		// Nothing to do
		return

	case SysmonCreateRemoteThread, SysmonAccessProcess:
		// First try to resolve it by tracked process
		if src := h.tracker.SourceTrackFromEvent(e); !src.IsZero() {
			e.Set(pathSourceServices, src.Services)
		} else {
			// If it fails we resolve the services by PID
			if spid, ok := e.GetInt(pathSysmonSourceProcessId); ok {
				if svcs, err := advapi32.ServiceWin32NamesByPid(uint32(spid)); err == nil {
					e.Set(pathSourceServices, svcs)
				} else {
					h.logger.Errorf("Failed to resolve service from PID=%d: %s", spid, err)
				}
			}
		}

		// First try to resolve it by tracked process
		if t := h.tracker.TargetTrackFromEvent(e); !t.IsZero() {
			e.Set(pathTargetServices, t.Services)
		} else {
			// If it fails we resolve the services by PID
			if tpid, ok := e.GetInt(pathSysmonTargetProcessId); ok {
				if svcs, err := advapi32.ServiceWin32NamesByPid(uint32(tpid)); err == nil {
					e.Set(pathTargetServices, svcs)
				} else {
					h.logger.Errorf("Failed to resolve service from PID=%d: %s", tpid, err)
				}
			}
		}

		// Default
		e.SetIfMissing(pathSourceServices, unkFieldValue)
		e.SetIfMissing(pathTargetServices, unkFieldValue)

	default:
		// try to resolve by track
		if track := h.tracker.SourceTrackFromEvent(e); !track.IsZero() {
			if track.Services == "" {
				track.Services, err = advapi32.ServiceWin32NamesByPid(uint32(track.PID))
				if err != nil {
					h.logger.Errorf("Failed to resolve service from PID=%d Image=%s", track.PID, track.Image)
					track.Services = unkFieldValue
				}
			}
			e.Set(pathServices, track.Services)
			return
		}

		// image, guid and pid are supposed to be available for all the remaining Sysmon logs
		if pid, ok := e.GetInt(pathSysmonProcessId); ok {
			services, err := advapi32.ServiceWin32NamesByPid(uint32(pid))
			if err != nil {
				h.logger.Errorf("Failed to resolve service from PID=%d: %s", pid, err)
				services = unkFieldValue
			}
			e.Set(pathServices, services)
			return
		}

		// Default
		e.SetIfMissing(pathServices, unkFieldValue)
	}
}

func hookEnrichAnySysmon(h *Agent, e *event.EdrEvent) {
	eventID := e.EventID()
	switch eventID {
	case SysmonProcessCreate, SysmonDriverLoad:
		// ProcessCreation is already processed in hookTrack
		// DriverLoad does not contain any GUID information
		break

	case SysmonCreateRemoteThread, SysmonAccessProcess:
		// Handling CreateRemoteThread and ProcessAccess events

		// source process processing
		if strack := h.tracker.SourceTrackFromEvent(e); !strack.IsZero() {
			if strack.User != "" {
				e.SetIfMissing(pathSourceUser, strack.User)
			}

			if strack.IntegrityLevel != "" {
				e.SetIfMissing(pathSourceIntegrityLevel, strack.IntegrityLevel)
			}

			if strack.imageHashes != "" {
				e.SetIfMissing(pathSourceHashes, strack.imageHashes)
			}

			// Source Protection level
			e.SetIfMissing(pathSourceProtectionLevel, toHex(strack.ProtectionLevel))

			// Source process score
			e.Set(pathSrcProcessGeneScore, toString(strack.ThreatScore.Score))
		}

		// target process processing
		if ttrack := h.tracker.TargetTrackFromEvent(e); !ttrack.IsZero() {
			if ttrack.User != "" {
				e.SetIfMissing(pathTargetUser, ttrack.User)
			}
			if ttrack.IntegrityLevel != "" {
				e.SetIfMissing(pathTargetIntegrityLevel, ttrack.IntegrityLevel)
			}
			if ttrack.ParentProcessGUID != "" {
				e.SetIfMissing(pathTargetParentProcessGuid, ttrack.ParentProcessGUID)
			}
			if ttrack.imageHashes != "" {
				e.SetIfMissing(pathTargetHashes, ttrack.imageHashes)
			}

			e.SetIfMissing(pathTargetProtectionLevel, toHex(ttrack.ProtectionLevel))

			// Target process score
			e.Set(pathTgtProcessGeneScore, toString(ttrack.ThreatScore.Score))
		}

		// Default Values for fields
		e.SetIfMissing(pathSourceUser, unkFieldValue)
		e.SetIfMissing(pathSourceIntegrityLevel, unkFieldValue)
		e.SetIfMissing(pathTargetUser, unkFieldValue)
		e.SetIfMissing(pathTargetIntegrityLevel, unkFieldValue)
		e.SetIfMissing(pathTargetParentProcessGuid, unkFieldValue)
		e.SetIfMissing(pathSourceHashes, unkFieldValue)
		e.SetIfMissing(pathTargetHashes, unkFieldValue)
		e.SetIfMissing(pathSourceProtectionLevel, toHex(ZeroProtectionLevel))
		e.SetIfMissing(pathTargetProtectionLevel, toHex(ZeroProtectionLevel))
		e.SetIfMissing(pathSrcProcessGeneScore, "-1")
		e.SetIfMissing(pathTgtProcessGeneScore, "-1")

	default:

		if track := h.tracker.SourceTrackFromEvent(e); !track.IsZero() {

			// setting CommandLine field
			if track.CommandLine != "" {
				e.SetIfMissing(pathSysmonCommandLine, track.CommandLine)
			}

			// setting User field
			if track.User != "" {
				e.SetIfMissing(pathSysmonUser, track.User)
			}

			// setting IntegrityLevel
			if track.IntegrityLevel != "" {
				e.SetIfMissing(pathSysmonIntegrityLevel, track.IntegrityLevel)
			}

			// setting CurrentDirectory
			if track.CurrentDirectory != "" {
				e.SetIfMissing(pathSysmonCurrentDirectory, track.CurrentDirectory)
			}

			// event never has ImageHashes field since it is not Sysmon standard
			if track.imageHashes != "" {
				e.Set(pathImageHashes, track.imageHashes)
			}

			// Signature information
			e.SetIfMissing(pathImageSigned, toString(track.Signed))
			e.SetIfMissing(pathImageSignature, track.Signature)
			e.SetIfMissing(pathImageSignatureStatus, track.SignatureStatus)

			// Protection level
			e.SetIfMissing(pathProtectionLevel, toHex(track.ProtectionLevel))

			// Overal criticality score
			e.Set(pathProcessGeneScore, toString(track.ThreatScore.Score))
		}

		// Setting GeneScore only if we can identify process by its GUID
		// Default values
		e.SetIfMissing(pathProcessGeneScore, "-1")
		e.SetIfMissing(pathSysmonCommandLine, unkFieldValue)
		e.SetIfMissing(pathSysmonUser, unkFieldValue)
		e.SetIfMissing(pathSysmonIntegrityLevel, unkFieldValue)
		e.SetIfMissing(pathSysmonCurrentDirectory, unkFieldValue)
		e.SetIfMissing(pathImageHashes, unkFieldValue)
		e.SetIfMissing(pathImageSigned, unkFieldValue)
		e.SetIfMissing(pathImageSignature, unkFieldValue)
		e.SetIfMissing(pathImageSignatureStatus, unkFieldValue)
		e.SetIfMissing(pathProtectionLevel, toHex(ZeroProtectionLevel))
	}
}

func hookClipboardEvents(h *Agent, e *event.EdrEvent) {
	e.Set(pathSysmonClipboardData, unkFieldValue)
	if hashes, ok := e.GetString(pathSysmonHashes); ok {
		fname := fmt.Sprintf("CLIP-%s", sysmonArcFileRe.ReplaceAllString(hashes, ""))
		path := filepath.Join(h.config.Sysmon.ArchiveDirectory, fname)
		if fi, err := os.Stat(path); err == nil {
			// limit size of ClipboardData to 1 Mega
			if fi.Mode().IsRegular() && fi.Size() < utils.Mega {
				if data, err := os.ReadFile(path); err == nil {
					// We try to decode utf16 content because regexp can only match utf8
					// Thus doing this is needed to apply detection rule on clipboard content
					if enc, err := utils.Utf16ToUtf8(data); err == nil {
						e.Set(pathSysmonClipboardData, string(enc))
					} else {
						e.Set(pathSysmonClipboardData, fmt.Sprintf("%q", data))
					}
				}
			}
		}
	}
}

var (
	pathKernelFileFileObject = engine.Path("/Event/EventData/FileObject")
	pathKernelFileFileName   = engine.Path("/Event/EventData/FileName")
)

func hookKernelFiles(h *Agent, e *event.EdrEvent) {
	var ok bool
	var fileName string

	// Enrich all events with Sysmon Info
	pt := h.tracker.GetByPID(int64(e.Event.System.Execution.ProcessID))

	// update list of last accessed files
	if fileName, ok = e.GetString(pathSysmonTargetFilename); ok && !pt.IsZero() {
		pt.Stats.Files.LastAccessed.Add(fileName)
	}

	// We enrich event with other data
	e.SetIfOr(pathSysmonProcessGUID, pt.ProcessGUID, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathSysmonImage, pt.Image, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathSysmonCommandLine, pt.CommandLine, !pt.IsZero(), unkFieldValue)
	// put hashes in ImageHashes field to avoid confusion in analyst's mind
	// not to think it is file content hashes
	e.SetIfOr(pathImageHashes, pt.imageHashes, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathSysmonProcessId, toString(pt.PID), !pt.IsZero(), toString(-1))
	e.SetIfOr(pathSysmonIntegrityLevel, pt.IntegrityLevel, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathSysmonUser, pt.User, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathServices, pt.Services, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathImageSignature, pt.Signature, !pt.IsZero(), unkFieldValue)
	e.SetIfOr(pathImageSignatureStatus, pt.SignatureStatus, !pt.IsZero(), unkFieldValue)
	e.Set(pathSysmonEventType, KernelFileOperations[e.EventID()])

	/*fileName := unkFieldValue

	// Enrich all events with Sysmon Info
	pt := h.tracker.GetByPID(int64(e.Event.System.Execution.ProcessID))

	if e.EventID() == KernelFileCreate {
		// We track file
		kf := KernelFileFromEvent(e)
		// we actually resolve drive letters
		h.tracker.AddKernelFile(kf)
		e.Set(pathKernelFileFileName, kf.FileName)
		// to be able to update list of last accessed files
		fileName = kf.FileName
	} else {
		var fo uint64
		var ok bool

		// We correlate with the filename
		if fo, ok = e.GetUint(pathKernelFileFileObject); ok {
			if kf, ok := h.tracker.GetKernelFile(fo); ok {
				fileName = kf.FileName

				// if we are dealing with a file read or a file write
				if e.EventID() == KernelFileRead || e.EventID() == KernelFileWrite {
					// we skip event if we have already reported one
					if kf.EventCount[e.EventID()] > 0 {
						e.Skip()
					}
				}

				// we update event count
				kf.EventCount[e.EventID()]++
			}
			e.Set(pathKernelFileFileName, fileName)
		}

		// We delete entry in tracking structure
		if e.EventID() == KernelFileClose {
			h.tracker.DelKernelFile(fo)
		}
	}

	// update the list of last accessed files
	if fsutil.IsFile(fileName) && !pt.IsZero() {
		pt.Stats.Files.LastAccessed.Add(fileName)
	}

	if !e.IsSkipped() {
		// We enrich event with other data
		e.SetIfOr(pathSysmonProcessGUID, pt.ProcessGUID, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathSysmonImage, pt.Image, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathSysmonCommandLine, pt.CommandLine, !pt.IsZero(), unkFieldValue)
		// put hashes in ImageHashes field to avoid confusion in analyst's mind
		// not to think it is file content hashes
		e.SetIfOr(pathImageHashes, pt.hashes, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathSysmonProcessId, toString(pt.PID), !pt.IsZero(), toString(-1))
		e.SetIfOr(pathSysmonIntegrityLevel, pt.IntegrityLevel, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathSysmonUser, pt.User, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathServices, pt.Services, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathImageSignature, pt.Signature, !pt.IsZero(), unkFieldValue)
		e.SetIfOr(pathImageSignatureStatus, pt.SignatureStatus, !pt.IsZero(), unkFieldValue)
		e.Set(pathSysmonEventType, KernelFileOperations[e.EventID()])
	}*/
}

```

`agent/hooks.go`:

```go
package agent

import (
	"sync"

	"github.com/0xrawsec/whids/event"
)

// Hook structure definition
// hooking functions are supposed to run quickly since it is
// run synchronously with the Gene scanner. Likewise, the
// hooking functions should never panic the program.
type Hook func(*Agent, *event.EdrEvent)

type eventMap map[int64][]Hook

type hookCache struct {
	c map[string]eventMap
}

func newHookCache() *hookCache {
	return &hookCache{
		c: make(map[string]eventMap),
	}
}

func (h hookCache) get(e *event.EdrEvent) (hooks []Hook, ok bool) {
	var eventIdsMap eventMap

	if eventIdsMap, ok = h.c[e.Channel()]; !ok {
		return
	}

	hooks, ok = eventIdsMap[e.EventID()]
	return
}

func (h hookCache) cache(hk Hook, e *event.EdrEvent) {
	// create eventMap if necessary
	if _, ok := h.c[e.Channel()]; !ok {
		h.c[e.Channel()] = make(eventMap)
	}

	// create Hook slice if necessary
	em := h.c[e.Channel()]
	if _, ok := em[e.EventID()]; !ok {
		em[e.EventID()] = make([]Hook, 0, 1)
	}

	// append the hook to the list of hooks
	if hk != nil {
		em[e.EventID()] = append(em[e.EventID()], hk)
	}
}

// HookManager structure definition to easier handle hooks
type HookManager struct {
	sync.RWMutex
	Filters []*Filter
	Hooks   []Hook
	cache   *hookCache
}

// NewHookMan creates a new HookManager structure
func NewHookMan() *HookManager {
	return &HookManager{Filters: make([]*Filter, 0),
		Hooks: make([]Hook, 0),
		cache: newHookCache(),
	}
}

// Hook register a hook for a given filter
func (hm *HookManager) Hook(h Hook, f *Filter) {
	hm.Lock()
	defer hm.Unlock()

	hm.Hooks = append(hm.Hooks, h)
	hm.Filters = append(hm.Filters, f)
}

// RunHooksOn runs the hook on a given event
func (hm *HookManager) RunHooksOn(h *Agent, e *event.EdrEvent) (ret bool) {
	var ok bool
	var hooks []Hook

	hm.Lock()
	defer hm.Unlock()

	// Don't waste resources if nothing to do
	if len(hm.Filters) == 0 {
		return
	}

	// We have to check all the filters if we don't know yet
	// which hooks should apply on this kind of event
	if hooks, ok = hm.cache.get(e); !ok {
		// we create an empty slice for e in order to return
		// cache hooks for events with no filters
		hm.cache.cache(nil, e)
		// we go through all the filters
		for i, f := range hm.Filters {
			if f.Match(e) {
				hm.cache.cache(hm.Hooks[i], e)
			}
		}
		// we update the list of hooks to apply
		hooks, _ = hm.cache.get(e)
	}

	for _, hook := range hooks {
		// debug hooks
		//log.Infof("Running hook: %s", getFunctionName(hook))
		hook(h, e)
		// We set return value to true if a hook has been applied
		ret = true
	}

	return
}

```

`agent/hookutils.go`:

```go
package agent

import (
	"fmt"
	"os"
	"syscall"

	"github.com/0xrawsec/golang-win32/win32"
	"github.com/0xrawsec/golang-win32/win32/kernel32"
	"github.com/0xrawsec/whids/event"
)

func toString(i any) string {
	return fmt.Sprintf("%v", i)
}

func toHex(i any) string {
	switch i.(type) {
	case int, uint, int8, int16, int32, int64, uint8, uint16, uint32, uint64:
		return fmt.Sprintf("0x%x", i)
	}
	return "cannot format to hex"
}

func terminate(pid int) error {
	// prevents from terminating our own process
	if os.Getpid() != pid {
		pHandle, err := kernel32.OpenProcess(kernel32.PROCESS_ALL_ACCESS, win32.FALSE, win32.DWORD(pid))
		if err != nil {
			return err
		}
		err = syscall.TerminateProcess(syscall.Handle(pHandle), 0)
		if err != nil {
			return err
		}
	}
	return nil
}

// helper function which checks if the event belongs to current WHIDS
func isSysmonProcessTerminate(e *event.EdrEvent) bool {
	return e.Channel() == sysmonChannel && e.EventID() == SysmonProcessTerminate
}

```

`agent/iocs.go`:

```go
package agent

import (
	"fmt"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/whids/api/server"
)

var (
	IoCRules = []engine.Rule{
		ruleHashIoC(),
		ruleDomainIoC(),
	}
)

func ruleHashIoC() (r engine.Rule) {
	r = engine.NewRule()
	r.Name = "Builtin:HashIoC"
	// FileCreate, FileDeleted and FileDeletedDetected
	r.Meta.Events = map[string][]int64{"Microsoft-Windows-Sysmon/Operational": {1, 6, 7}}
	r.Meta.Criticality = 10
	r.Matches = []string{
		fmt.Sprintf("$ioc_md5: extract('MD5=(?P<md5>[A-F0-9]{32})', Hashes) in %s", server.IoCContainerName),
		fmt.Sprintf("$ioc_sha1: extract('SHA1=(?P<sha1>[A-F0-9]{40})', Hashes) in %s", server.IoCContainerName),
		fmt.Sprintf("$ioc_sha256: extract('SHA256=(?P<sha256>[A-F0-9]{64})', Hashes) in %s", server.IoCContainerName),
	}
	r.Condition = "$ioc_md5 or $ioc_sha1 or $ioc_sha256"
	return
}

func ruleDomainIoC() (r engine.Rule) {
	r = engine.NewRule()
	r.Name = "Builtin:DomainIoC"
	// FileCreate, FileDeleted and FileDeletedDetected
	r.Meta.Events = map[string][]int64{"Microsoft-Windows-Sysmon/Operational": {22}}
	r.Meta.Criticality = 10
	r.Matches = []string{
		fmt.Sprintf("$ioc_domain: extract('(?P<dom>\\w+\\.\\w+$)',QueryName) in %s'", server.IoCContainerName),
		fmt.Sprintf("$ioc_subdomain: extract('(?P<sub>\\w+\\.\\w+\\.\\w+$)',QueryName) in %s'", server.IoCContainerName),
		fmt.Sprintf("$ioc_hostname: extract('(?P<subsub>\\w+\\.\\w+\\.\\w+\\.\\w+$)',QueryName) in %s'", server.IoCContainerName),
	}
	r.Condition = "$ioc_domain or $ioc_subdomain or $ioc_hostname"
	return
}

```

`agent/paths.go`:

```go
package agent

import (
	"github.com/0xrawsec/gene/v2/engine"
)

const (
	eventData = "/Event/EventData/"
)

func EventDataPath(field string) *engine.XPath {
	return engine.Path(eventData + field)
}

var (
	// Path definitions
	////////////////////////// Getters ///////////////////////////
	// DNS-Client logs
	pathDNSQueryValue   = EventDataPath("QueryName")
	pathDNSQueryType    = EventDataPath("QueryType")
	pathDNSQueryResults = EventDataPath("QueryResults")

	// FileSystemAudit
	pathFSAuditProcessId  = pathSysmonProcessId
	pathFSAuditObjectName = EventDataPath("ObjectName")

	// Sysmon related paths
	// Common to several events
	pathSysmonUtcTime        = EventDataPath("UtcTime")
	pathSysmonImage          = EventDataPath("Image")
	pathSysmonHashes         = EventDataPath("Hashes")
	pathSysmonTargetFilename = EventDataPath("TargetFilename")
	pathSysmonProcessGUID    = EventDataPath("ProcessGuid")
	pathSysmonProcessId      = EventDataPath("ProcessId")

	// EventID 1: ProcessCreate
	pathSysmonCommandLine       = EventDataPath("CommandLine")
	pathSysmonParentCommandLine = EventDataPath("ParentCommandLine")
	pathSysmonParentImage       = EventDataPath("ParentImage")
	pathSysmonParentProcessGUID = EventDataPath("ParentProcessGuid")
	pathSysmonParentProcessId   = EventDataPath("ParentProcessId")
	pathSysmonUser              = EventDataPath("User")
	pathSysmonIntegrityLevel    = EventDataPath("IntegrityLevel")
	pathSysmonCurrentDirectory  = EventDataPath("CurrentDirectory")

	// EventID 3: NetworkConnect
	pathSysmonDestIP       = EventDataPath("DestinationIp")
	pathSysmonDestPort     = EventDataPath("DestinationPort")
	pathSysmonDestHostname = EventDataPath("DestinationHostname")

	// EventID 6/7
	pathSysmonFileVersion      = engine.Path(eventData + "FileVersion")
	pathSysmonDescription      = engine.Path(eventData + "Description")
	pathSysmonProduct          = engine.Path(eventData + "Product")
	pathSysmonCompany          = engine.Path(eventData + "Company")
	pathSysmonOriginalFileName = engine.Path(eventData + "OriginalFileName")
	pathSysmonSignature        = EventDataPath("Signature")
	pathSysmonSigned           = EventDataPath("Signed")
	pathSysmonSignatureStatus  = EventDataPath("SignatureStatus")

	// EventID 7
	pathSysmonImageLoaded = EventDataPath("ImageLoaded")

	// EventID 8: CreateRemoteThread
	pathSysmonCRTSourceProcessGuid = EventDataPath("SourceProcessGuid")
	pathSysmonCRTTargetProcessGuid = EventDataPath("TargetProcessGuid")

	// EventID 8/10
	pathSysmonSourceProcessId = EventDataPath("SourceProcessId")
	pathSysmonTargetProcessId = EventDataPath("TargetProcessId")

	// EventID 10: ProcessAccess
	pathSysmonSourceProcessGUID = EventDataPath("SourceProcessGUID")
	pathSysmonTargetProcessGUID = EventDataPath("TargetProcessGUID")
	pathSysmonSourceImage       = EventDataPath("SourceImage")
	pathSysmonTargetImage       = EventDataPath("TargetImage")

	// EventID 12,13,14: Registry
	pathSysmonEventType    = EventDataPath("EventType")
	pathSysmonTargetObject = EventDataPath("TargetObject")
	pathSysmonDetails      = EventDataPath("Details")

	// EventID 20
	pathSysmonDestination = EventDataPath("Destination")

	// EventID 22: DNSQuery
	pathQueryName    = EventDataPath("QueryName")
	pathQueryResults = EventDataPath("QueryResults")

	// EventID 23:
	pathSysmonArchived = EventDataPath("Archived")

	// Gene criticality path
	pathGeneCriticality = engine.Path("/Event/GeneInfo/Criticality")

	///////////////////////// Setters //////////////////////////////////////
	pathProcessGeneScore    = EventDataPath("ProcessThreatScore")
	pathSrcProcessGeneScore = EventDataPath("SourceProcessThreatScore")
	pathTgtProcessGeneScore = EventDataPath("TargetProcessThreatScore")

	pathAncestors            = EventDataPath("Ancestors")
	pathParentUser           = EventDataPath("ParentUser")
	pathParentIntegrityLevel = EventDataPath("ParentIntegrityLevel")

	// Use to store image sizes information by hook
	pathImSize       = EventDataPath("ImageSize")
	pathImLoadedSize = EventDataPath("ImageLoadedSize")

	// Use to store process information by hook
	pathParentIntegrity  = EventDataPath("ParentProcessIntegrity")
	pathProcessIntegrity = EventDataPath("ProcessIntegrity")
	pathIntegrityTimeout = EventDataPath("ProcessIntegrityTimeout")

	// Use to store pathServices information by hook
	pathServices       = EventDataPath("Services")
	pathParentServices = EventDataPath("ParentServices")
	pathSourceServices = EventDataPath("SourceServices")
	pathTargetServices = EventDataPath("TargetServices")

	// Use to store process by hook
	pathSourceIsParent = EventDataPath("SourceIsParent")

	// Use to store value size by hooking on SetValue events
	pathValueSize = EventDataPath("ValueSize")

	// Use to store parent image and command line in image load events
	pathImageLoadParentImage       = EventDataPath("ParentImage")
	pathImageLoadParentCommandLine = EventDataPath("ParentCommandLine")

	// Used to store user and integrity information in sysmon CreateRemoteThread and ProcessAccess events
	pathSourceUser              = EventDataPath("SourceUser")
	pathSourceIntegrityLevel    = EventDataPath("SourceIntegrityLevel")
	pathTargetUser              = EventDataPath("TargetUser")
	pathTargetIntegrityLevel    = EventDataPath("TargetIntegrityLevel")
	pathTargetParentProcessGuid = EventDataPath("TargetParentProcessGuid")

	// Used to store Image Hashes information into any Sysmon Event
	pathImageHashes  = EventDataPath("ImageHashes")
	pathSourceHashes = EventDataPath("SourceHashes")
	pathTargetHashes = EventDataPath("TargetHashes")

	// Used to store image signature related information
	pathImageSignature       = EventDataPath("ImageSignature")
	pathImageSigned          = EventDataPath("ImageSigned")
	pathImageSignatureStatus = EventDataPath("ImageSignatureStatus")

	// Use to enrich Clipboard events
	pathSysmonClipboardData = EventDataPath("ClipboardData")

	pathFileCount      = EventDataPath("Count")
	pathFileCountByExt = EventDataPath("CountByExt")
	pathFileExtension  = EventDataPath("Extension")
	pathFileFrequency  = EventDataPath("FrequencyEps")

	// ProcessProtectionLevel
	pathProtectionLevel       = EventDataPath("ProtectionLevel")
	pathSourceProtectionLevel = EventDataPath("SourceProtectionLevel")
	pathTargetProtectionLevel = EventDataPath("TargetProtectionLevel")
	pathParentProtectionLevel = EventDataPath("ParentProtectionLevel")
)

```

`agent/ptrack.go`:

```go
package agent

import (
	"math"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/whids/event"
)

type ConStat struct {
	FirstSeen string          `json:"first-seen"`
	LastSeen  string          `json:"last-seen"`
	Resolved  map[string]uint `json:"resolved"`
	Ports     map[uint16]uint `json:"ports"`
	Count     int             `json:"count"`
}

type FileStats struct {
	LastAccessed           *datastructs.RingSet `json:"last-accessed"`
	CountFilesCreated      int64                `json:"file-create-count"`
	CountFilesCreatedByExt map[string]int64     `json:"file-create-count-by-ext"`
	TimeFirstFileCreated   time.Time            `json:"first-file-create"`
	TimeLastFileCreated    time.Time            `json:"last-file-create"`
	CountFilesDeleted      int64                `json:"file-delete-count"`
	CountFilesDeletedByExt map[string]int64     `json:"file-delete-count-by-ext"`
	TimeFirstFileDeleted   time.Time            `json:"first-file-delete"`
	TimeLastFileDeleted    time.Time            `json:"last-file-delete"`
}

type ProcStats struct {
	CreateProcessCount int64               `json:"create-process-count"`
	Connections        map[string]*ConStat `json:"connections"`
	Files              FileStats           `json:"files"`
}

func NewProcStats() ProcStats {
	return ProcStats{
		Connections: make(map[string]*ConStat),
		Files: FileStats{
			LastAccessed:           datastructs.NewRingSet(50),
			CountFilesCreatedByExt: make(map[string]int64),
			CountFilesDeletedByExt: make(map[string]int64),
		},
	}
}

func (p *ProcStats) UpdateNetResolve(timestamp, ip, qname string) {
	cs := p.ConStat(ip)
	if cs.FirstSeen == "" {
		cs.FirstSeen = timestamp
	}
	cs.LastSeen = timestamp
	cs.Resolved[qname]++
}

func (p *ProcStats) UpdateCon(timestamp, ip string, port uint16) {
	cs := p.ConStat(ip)
	if cs.FirstSeen == "" {
		cs.FirstSeen = timestamp
	}
	cs.LastSeen = timestamp
	cs.Ports[port]++
	cs.Count++
}

func (p *ProcStats) ConStat(ip string) *ConStat {
	if _, ok := p.Connections[ip]; !ok {
		p.Connections[ip] = &ConStat{Resolved: make(map[string]uint), Ports: make(map[uint16]uint)}
	}
	return p.Connections[ip]
}

type ThreatScore struct {
	Signatures map[string]uint `json:"signatures"`
	Score      int64           `json:"score"`
}

func NewGeneScore() ThreatScore {
	return ThreatScore{make(map[string]uint), 0}
}

func (g *ThreatScore) Update(d *engine.Detection) {
	if d != nil {
		for _, s := range d.Signature.Slice() {
			g.Signatures[s.(string)]++
		}
		g.Score += int64(d.Criticality)
	}
}

func sysmonHashesToMap(hashes string) map[string]string {
	m := make(map[string]string)
	for _, h := range strings.Split(hashes, ",") {
		i := strings.Index(h, "=")
		if i+1 < len(h) {
			v := strings.ToLower(h[i+1:])

			// it is sha1
			if len(v) == 40 {
				m["sha1"] = v
				continue
			}

			// it is sha256
			if len(v) == 64 {
				m["sha256"] = v
			}

			// md5 or imphash
			if len(v) == 32 {
				switch {
				case strings.HasPrefix(h, "MD5="):
					m["md5"] = v
				case strings.HasPrefix(h, "IMPHASH="):
					m["imphash"] = v
				}
			}
		}
	}
	return m
}

const (
	naField             = "N/A"
	ZeroProtectionLevel = uint32(math.MaxUint32) // 0xffffffff is PROTECTION_SAME but it is a flag used by WinAPI and is not a valid protection level
)

type ProcessTrack struct {
	/* Private */
	imageHashes string
	empty       bool

	/* Public */
	Image                  string            `json:"image"`
	ParentImage            string            `json:"parent-image"`
	PID                    int64             `json:"pid"`
	CommandLine            string            `json:"command-line"`
	ParentCommandLine      string            `json:"parent-command-line"`
	CurrentDirectory       string            `json:"cwd"`
	ParentCurrentDirectory string            `json:"parent-cwd"`
	ProcessGUID            string            `json:"process-guid"`
	User                   string            `json:"user"`
	ParentUser             string            `json:"parent-user"`
	IntegrityLevel         string            `json:"integrity-lvl"`
	ParentIntegrityLevel   string            `json:"parent-integrity-lvl"`
	ParentProcessGUID      string            `json:"parent-process-guid"`
	Services               string            `json:"services"`
	ParentServices         string            `json:"parent-services"`
	ProtectionLevel        uint32            `json:"protection-lvl"`
	ParentProtectionLevel  uint32            `json:"parent-protection-lvl"`
	HashesMap              map[string]string `json:"hashes"`
	Signature              string            `json:"signature"`
	SignatureStatus        string            `json:"signature-status"`
	Signed                 bool              `json:"signed"`
	Ancestors              []string          `json:"ancestors"`
	Modules                []*ModuleInfo     `json:"modules"`
	Integrity              float64           `json:"integrity"`
	IntegrityTimeout       bool              `json:"integrity-timeout"`
	MemDumped              bool              `json:"memory-dumped"`
	DumpCount              int               `json:"dump-count"`
	ChildCount             int               `json:"child-count"` // number of currently running child proceses
	Stats                  ProcStats         `json:"statistics"`
	ThreatScore            ThreatScore       `json:"threat-score"`
	Terminated             bool              `json:"terminated"`
	TimeTerminated         time.Time         `json:"time-terminated"`
}

var (
	emptyTrack = ProcessTrack{empty: true}
)

// emptyProcessTrack returns a reference to emptyTrack, no modification
// must be done to the structure returned by this function call
func emptyProcessTrack() *ProcessTrack {
	return &emptyTrack
}

// NewProcessTrack creates a new processTrack structure enforcing
// that minimal information is encoded (image, guid, pid)
func NewProcessTrack(image, pguid, guid string, pid int64) *ProcessTrack {
	return &ProcessTrack{
		Image:                 image,
		ParentProcessGUID:     pguid,
		ProcessGUID:           guid,
		PID:                   pid,
		Signature:             "?",
		SignatureStatus:       "?",
		Ancestors:             make([]string, 0),
		Modules:               make([]*ModuleInfo, 0),
		Integrity:             -1.0,
		ProtectionLevel:       ZeroProtectionLevel, // 0x0 is a valid protection level and 0xfffffffe is ProtectionNone
		ParentProtectionLevel: ZeroProtectionLevel,
		Stats:                 NewProcStats(),
		ThreatScore:           NewGeneScore(),
	}
}

func (t *ProcessTrack) IsZero() bool {
	return t.empty
}

func (t *ProcessTrack) SetHashes(hashes string) {
	t.imageHashes = hashes
	t.HashesMap = sysmonHashesToMap(hashes)
}

func (t *ProcessTrack) TerminateProcess() error {
	if !t.Terminated {
		return terminate(int(t.PID))
	}
	return nil
}

type ModuleInfo struct {
	hashes           string
	Image            string            `json:"image"`
	FileVersion      string            `json:"file-version"`
	Description      string            `json:"description"`
	Product          string            `json:"product"`
	Company          string            `json:"company"`
	OriginalFileName string            `json:"orginal-filename"`
	Hashes           map[string]string `json:"hashes"`
	Signature        string            `json:"signature"`
	SignatureStatus  string            `json:"signature-status"`
	Signed           bool              `json:"signed"`
	// Statistics
	LoadCount int64     `json:"load-count"`
	FirstLoad time.Time `json:"first-load"`
	LastLoad  time.Time `json:"last-load"`
}

func ModuleInfoFromEvent(e *event.EdrEvent) (i *ModuleInfo) {
	var ok bool

	i = &ModuleInfo{}
	i.Image = e.GetStringOr(pathSysmonImageLoaded, "?")
	i.FileVersion = e.GetStringOr(pathSysmonFileVersion, "?")
	i.Description = e.GetStringOr(pathSysmonDescription, "?")
	i.Product = e.GetStringOr(pathSysmonProduct, "?")
	i.Company = e.GetStringOr(pathSysmonCompany, "?")
	i.OriginalFileName = e.GetStringOr(pathSysmonOriginalFileName, "?")
	if i.hashes, ok = e.GetString(pathSysmonHashes); ok {
		i.Hashes = sysmonHashesToMap(i.hashes)
	}
	i.Signature = e.GetStringOr(pathSysmonSignature, "?")
	i.SignatureStatus = e.GetStringOr(pathSysmonSignatureStatus, "?")
	i.Signed, _ = e.GetBool(pathSysmonSigned)
	i.LoadCount = 1
	i.FirstLoad = e.Timestamp()
	i.LastLoad = e.Timestamp()
	return
}

func (i *ModuleInfo) Id() string {
	return i.hashes
}

func (i *ModuleInfo) UpdateStatistics(other *ModuleInfo) {
	i.LastLoad = other.LastLoad
	i.LoadCount++
}

type DriverInfo struct {
	/* Private */
	hashes string

	/* Public */
	Image           string            `json:"image"`
	HashesMap       map[string]string `json:"hashes"`
	Signed          bool              `json:"signed"`
	Signature       string            `json:"signature"`
	SignatureStatus string            `json:"signature-status"`
}

func DriverInfoFromEvent(e *event.EdrEvent) (i *DriverInfo) {
	var ok bool

	i = &DriverInfo{}

	i.Image = e.GetStringOr(pathSysmonImageLoaded, "?")
	if i.hashes, ok = e.GetString(pathSysmonHashes); ok {
		i.HashesMap = sysmonHashesToMap(i.hashes)
	}
	i.Signature = e.GetStringOr(pathSysmonSignature, "?")
	i.SignatureStatus = e.GetStringOr(pathSysmonSignatureStatus, "?")
	i.Signed, _ = e.GetBool(pathSysmonSigned)

	return
}

type KernelFile struct {
	FileName   string
	FileObject uint64
	Flags      struct {
		Read  bool
		Write bool
	}
}

func sourceGUIDFromEvent(e *event.EdrEvent) (src string) {
	var ok bool

	src = nullGUID
	pGuid := pathSysmonProcessGUID

	// the interesting pid to dump depends on the event
	switch e.EventID() {
	case SysmonAccessProcess:
		pGuid = pathSysmonSourceProcessGUID
	case SysmonCreateRemoteThread:
		pGuid = pathSysmonCRTSourceProcessGuid
	}

	if src, ok = e.GetString(pGuid); !ok {
		return
	}

	return
}

func targetGUIDFromEvent(e *event.EdrEvent) (target string) {
	var ok bool
	var pGuid *engine.XPath

	target = nullGUID

	// the interesting pid to dump depends on the event
	switch e.EventID() {
	case SysmonAccessProcess:
		pGuid = pathSysmonTargetProcessGUID
	case SysmonCreateRemoteThread:
		pGuid = pathSysmonCRTTargetProcessGuid
	default:
		// no target for other events
		return
	}

	if target, ok = e.GetString(pGuid); !ok {
		return
	}

	return
}

type ActivityTracker struct {
	sync.RWMutex
	kernel *ProcessTrack
	// to store process track by parent process GUID
	//pguids      map[string]int
	guids map[string]*ProcessTrack
	// PIDs can be re-used so we have to jungle with two data structures
	rpids       map[int64]*ProcessTrack // for running processes
	tpids       map[int64]*ProcessTrack // for terminated processes
	blacklisted *datastructs.SyncedSet
	free        *datastructs.Fifo
	// Kernel-Files
	files map[uint64]*KernelFile
	// modules loaded
	modules map[string]*ModuleInfo
	// driver loaded
	Drivers []DriverInfo
}

func NewActivityTracker() *ActivityTracker {
	pt := &ActivityTracker{
		//pguids:      make(map[string]int),
		guids:       make(map[string]*ProcessTrack),
		rpids:       make(map[int64]*ProcessTrack),
		tpids:       make(map[int64]*ProcessTrack),
		blacklisted: datastructs.NewSyncedSet(),
		free:        &datastructs.Fifo{},
		files:       make(map[uint64]*KernelFile),
		modules:     make(map[string]*ModuleInfo),
		Drivers:     make([]DriverInfo, 0),
	}
	// startup the routine to free resources
	pt.freeRtn()
	return pt
}

func (pt *ActivityTracker) delete(t *ProcessTrack) {
	pt.Lock()
	defer pt.Unlock()

	if t := pt.guids[t.ParentProcessGUID]; t != nil {
		t.ChildCount--
	}

	delete(pt.guids, t.ProcessGUID)
	// delete from terminated processes
	delete(pt.tpids, t.PID)
}

func (pt *ActivityTracker) freeRtn() {
	go func() {
		for {
			for e := pt.free.Pop(); e != nil; e = pt.free.Pop() {
				t := e.Value.(*ProcessTrack)
				now := time.Now()
				// delete the track only after some time because some
				// events come after process terminate events and we don't
				// want to miss correlation
				timeToDel := t.TimeTerminated.Add(time.Second * 10)
				if timeToDel.After(now) {
					delta := timeToDel.Sub(now)
					time.Sleep(delta)
				}
				// we don't free the process structure if it still has a child
				// this is mostly to keep track of parent processes when generating
				// a report
				if t.ChildCount > 0 {
					pt.free.Push(t)
					// we need to sleep there because we
					// can end up reprocessing the same
					// track over and over
					time.Sleep(1 * time.Second)
					continue
				}
				// delete ProcessTrack from ProcessTracker
				pt.delete(t)
			}
			// we have to wait here not to go in an
			// empty endless loop (if nothing in free list)
			time.Sleep(1 * time.Second)
		}
	}()
}

func (pt *ActivityTracker) TrackKernel(e *event.EdrEvent) (ok bool) {
	var image, guid string
	var pid int64

	if e.Event.System.Provider.Guid != SysmonProviderGuid || pt.kernel != nil {
		return
	}

	if image, ok = e.GetString(pathSysmonImage); !ok || !strings.EqualFold(image, "System") {
		// need to be explicit as it may return true if image is not System
		return false
	}

	if guid, ok = e.GetString(pathSysmonProcessGUID); !ok {
		return
	}

	if pid, ok = e.GetInt(pathSysmonProcessId); !ok {
		return
	}

	kernel := NewProcessTrack(image, naField, guid, pid)
	kernel.imageHashes = naField
	kernel.CurrentDirectory = naField
	kernel.CommandLine = naField
	kernel.Signature = naField
	kernel.SignatureStatus = naField
	kernel.IntegrityLevel = "System"
	kernel.Services = naField
	kernel.User = `NT AUTHORITY\SYSTEM`

	// modifying kernel track member
	pt.Lock()
	defer pt.Unlock()
	pt.add(kernel)
	pt.kernel = kernel

	return
}

// returns true if DumpCount member of processTrack is below max argument
// and increments if necessary. This function is used to check whether we
// should still dump information given a guid
func (pt *ActivityTracker) CheckDumpCountOrInc(guid string, max int, dfault bool) bool {
	pt.Lock()
	defer pt.Unlock()
	if track, ok := pt.guids[guid]; ok {
		if track.DumpCount < max {
			track.DumpCount++
			return true
		}
		return false
	}
	// we return a parametrized default value (cleaner than returning global)
	return dfault
}

func (pt *ActivityTracker) add(t *ProcessTrack) {
	if t := pt.guids[t.ParentProcessGUID]; t != nil {
		t.ChildCount++
	}
	pt.guids[t.ProcessGUID] = t
	pt.rpids[t.PID] = t
}

func (pt *ActivityTracker) Add(t *ProcessTrack) {
	pt.Lock()
	defer pt.Unlock()
	pt.add(t)
}

func (pt *ActivityTracker) PS() map[string]ProcessTrack {
	pt.RLock()
	defer pt.RUnlock()
	ps := make(map[string]ProcessTrack)
	for guid, t := range pt.guids {
		t.HashesMap = sysmonHashesToMap(t.imageHashes)
		ps[guid] = *t
	}
	return ps
}

func (pt *ActivityTracker) Blacklist(cmdLine string) {
	pt.blacklisted.Add(cmdLine)
}

func (pt *ActivityTracker) IsBlacklisted(cmdLine string) bool {
	return pt.blacklisted.Contains(cmdLine)
}

func (pt *ActivityTracker) SourceTrackFromEvent(e *event.EdrEvent) (t *ProcessTrack) {
	pt.RLock()
	defer pt.RUnlock()
	var guid string

	if guid = sourceGUIDFromEvent(e); guid == nullGUID {
		return emptyProcessTrack()
	}

	return pt.getByGuid(guid)
}

func (pt *ActivityTracker) TargetTrackFromEvent(e *event.EdrEvent) (t *ProcessTrack) {
	pt.RLock()
	defer pt.RUnlock()
	var guid string

	if guid = targetGUIDFromEvent(e); guid == nullGUID {
		return emptyProcessTrack()
	}

	return pt.getByGuid(guid)
}

func (pt *ActivityTracker) GetParentByGuid(guid string) *ProcessTrack {
	pt.RLock()
	defer pt.RUnlock()
	if c, ok := pt.guids[guid]; ok {
		return pt.getByGuid(c.ParentProcessGUID)
	}
	return emptyProcessTrack()
}

func (pt *ActivityTracker) getByGuid(guid string) *ProcessTrack {
	if t := pt.guids[guid]; t != nil {
		return t
	}
	return emptyProcessTrack()
}

// GetByPID get a process track by process GUID. If none is found an
// empty ProcessTrack is returned
func (pt *ActivityTracker) GetByGuid(guid string) *ProcessTrack {
	pt.RLock()
	defer pt.RUnlock()

	return pt.getByGuid(guid)
}

// GetByPID get a process track by PID. If none is found an empty ProcessTrack
// is returned
func (pt *ActivityTracker) GetByPID(pid int64) *ProcessTrack {
	pt.RLock()
	defer pt.RUnlock()

	// if we find processes in running processes
	if t := pt.rpids[pid]; t != nil {
		return t
	}

	// if we find process in terminated processes
	if t := pt.tpids[pid]; t != nil {
		return t
	}

	return emptyProcessTrack()
}

func (pt *ActivityTracker) ContainsGuid(guid string) bool {
	pt.RLock()
	defer pt.RUnlock()
	_, ok := pt.guids[guid]
	return ok
}

func (pt *ActivityTracker) ContainsPID(pid int64) bool {
	pt.RLock()
	defer pt.RUnlock()
	_, ok := pt.rpids[pid]
	return ok
}

func (pt *ActivityTracker) Modules() (s []ModuleInfo) {
	s = make([]ModuleInfo, 0)
	for _, m := range pt.modules {
		s = append(s, *m)
	}
	return
}

func (pt *ActivityTracker) AddKernelFile(f *KernelFile) {
	pt.Lock()
	defer pt.Unlock()
	pt.files[f.FileObject] = f
}

func (pt *ActivityTracker) GetKernelFile(key uint64) (f *KernelFile, ok bool) {
	pt.RLock()
	defer pt.RUnlock()
	f, ok = pt.files[key]
	return
}

func (pt *ActivityTracker) DelKernelFile(key uint64) {
	pt.Lock()
	defer pt.Unlock()
	delete(pt.files, key)
}

// GetModuleOrUpdate retrieves an already existing ModuleInfo or updates
// the map of known ModuleInfo and returns the ModuleInfo updated
func (pt *ActivityTracker) GetModuleOrUpdate(i *ModuleInfo) *ModuleInfo {
	pt.Lock()
	defer pt.Unlock()
	if old, ok := pt.modules[i.Id()]; ok {
		old.UpdateStatistics(i)
		return old
	}
	pt.modules[i.Id()] = i
	return i
}

func (pt *ActivityTracker) IsTerminated(guid string) bool {
	pt.Lock()
	defer pt.Unlock()
	if t := pt.getByGuid(guid); !t.IsZero() {
		return t.Terminated
	}
	return true
}

func (pt *ActivityTracker) Terminate(guid string) {
	pt.Lock()
	defer pt.Unlock()

	if t := pt.getByGuid(guid); !t.IsZero() {
		// don't terminate process twice
		if t.Terminated {
			return
		}
		t.Terminated = true
		t.TimeTerminated = time.Now()
		// PID entry must be cleared as soon as possible
		// to avoid issues like deleting a re-used PID in delete method
		delete(pt.rpids, t.PID)
		// we put it in the map of terminated processes
		pt.tpids[t.PID] = t
		pt.free.Push(t)
	}
	return
}

```

`agent/report.go`:

```go
package agent

import (
	"time"

	"github.com/0xrawsec/whids/agent/config"
)

// Report structure
type Report struct {
	Processes map[string]ProcessTrack `json:"processes"`
	Modules   []ModuleInfo            `json:"modules"`
	Drivers   []DriverInfo            `json:"drivers"`
	Commands  []config.ReportCommand  `json:"commands"`
	StartTime time.Time               `json:"start-timestamp"` // time at which report generation started
	StopTime  time.Time               `json:"stop-timestamp"`  // time at which report generation stopped
}

```

`agent/stats.go`:

```go
package agent

import (
	"time"

	"github.com/0xrawsec/whids/event"
)

var (
	CriticalityFactor float64 = 2
	MaxIssuesInARow   uint    = 10
)

type EventStats struct {
	start   time.Time
	counter struct {
		channels  map[string]float64
		event     float64
		detection float64
		dynamic   float64
	}
	// for performance issue detection
	row       uint
	notified  time.Time
	threshold float64
	duration  time.Duration
}

func NewEventStats(tresh float64, dur time.Duration) *EventStats {
	now := time.Now()
	return &EventStats{
		start:     now,
		notified:  now,
		threshold: tresh,
		duration:  dur,
	}
}

func (m *EventStats) SinceStart() time.Duration {
	return time.Since(m.start)
}

func (m *EventStats) Start() {
	m.start = time.Now()
	m.notified = time.Now()
}

func (m *EventStats) Threshold() float64 {
	return m.threshold
}

func (m *EventStats) Duration() time.Duration {
	return m.duration
}

func (m *EventStats) Update(e *event.EdrEvent) {
	m.counter.event++
	m.counter.dynamic++
	if e.IsDetection() {
		m.counter.detection++
	}
}

func (m *EventStats) Events() float64 {
	return m.counter.event
}

func (m *EventStats) Detections() float64 {
	return m.counter.detection
}

func (m *EventStats) EPS() float64 {
	delta := time.Since(m.start).Seconds()
	if delta > 0 {
		return m.counter.event / delta
	}
	return 0
}

func (m *EventStats) CriticalEPS() float64 {
	return m.threshold * CriticalityFactor
}

func (m *EventStats) DynEPS() float64 {
	delta := time.Since(m.notified).Seconds()
	if delta > 0 {
		return m.counter.dynamic / delta
	}
	return 0
}

func (m *EventStats) HasPerfIssue() (bool, float64) {
	eps := m.DynEPS()
	if m.DynEPS() >= m.threshold {
		if time.Since(m.notified) > m.duration {
			m.row++
			m.notified = time.Now()
			m.counter.dynamic = 0
			return true, eps
		}
	} else if time.Since(m.notified) > m.duration {
		if m.row > 0 {
			m.row--
		}
		m.notified = time.Now()
		m.counter.dynamic = 0
	}

	return false, eps
}

func (m *EventStats) HasCriticalPerfIssue() bool {
	return m.row > uint(MaxIssuesInARow)
}

```

`agent/sysinfo/sysinfo.go`:

```go
package sysinfo

import (
	"errors"

	"github.com/0xrawsec/whids/sysmon"
)

var (
	// must be set by main package
	edrInfo *EdrInfo
)

type EdrInfo struct {
	Version string `json:"version"`
	Commit  string `json:"commit"`
}

func RegisterEdrInfo(i *EdrInfo) {
	edrInfo = i
}

type SystemInfo struct {
	Edr *EdrInfo `json:"edr"`

	System struct {
		// HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\SystemInformation
		//SystemManufacturer
		Manufacturer string `json:"manufacturer"`
		//SystemProductName
		Name    string `json:"name"`
		Virtual bool   `json:"virtual"`
	} `json:"system"`

	BIOS struct {
		// HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\SystemInformation
		//BIOSVersion
		Version string `json:"version"`
		//BIOSReleaseDate
		Date string `json:"date"`
	} `json:"bios"`

	OS struct {
		Name string `json:"name"`
		//HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\
		// CurrentBuild
		Build string `json:"build"`
		// DisplayVersion + CurrentMajorVersionNumber + CurrentMinorVersionNumber + CurrentBuild
		Version string `json:"version"`
		// ProductName
		Product string `json:"product"`
		// CompositionEditionID
		Edition string `json:"edition"`
	} `json:"os"`

	CPU struct {
		// KEY_LOCAL_MACHINE\HARDWARE\DESCRIPTION\System\CentralProcessor\0
		// ProcessorNameString
		Name  string `json:"name"`
		Count int    `json:"count"`
	} `json:"cpu"`

	Sysmon *sysmon.Info `json:"sysmon"`

	Error string `json:"error"`
}

func (s *SystemInfo) Err() error {
	if s.Error == "" {
		return nil
	}
	return errors.New(s.Error)
}

```

`agent/sysinfo/sysinfo_test.go`:

```go
package sysinfo

import (
	"reflect"
	"testing"

	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/utils"
)

func TestSystemInfo(t *testing.T) {
	t.Parallel()

	var h string
	var err error

	tt := toast.FromT(t)
	ei := &EdrInfo{
		Version: "major.minor.patch",
		Commit:  "somerandomcommitid",
	}

	info := NewSystemInfo()
	tt.Assert(edrInfo == nil)
	tt.Assert(info.Edr == nil)

	// we register edr information
	RegisterEdrInfo(ei)
	tt.Assert(edrInfo != nil)
	tt.Assert(reflect.DeepEqual(edrInfo, ei))

	info = NewSystemInfo()
	tt.Assert(reflect.DeepEqual(info.Edr, ei))

	if h, err = utils.Sha256Interface(info); err != nil {
		t.Error(err)
	}
	t.Log(utils.PrettyJsonOrPanic(info))
	t.Logf("Structure hash: %s", h)
	for i := 0; i < 1000; i++ {
		if n, err := utils.Sha256Interface(info); err != nil {
			t.Error(err)
			t.FailNow()
		} else if n != h {
			t.Error("hash function is not stable")
		}
	}
}

```

`agent/sysinfo/windows_sysinfo.go`:

```go
//go:build windows
// +build windows

package sysinfo

import (
	"fmt"
	"strings"

	"github.com/0xrawsec/golang-win32/win32/advapi32"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/utils"
)

const (
	pathBuildInfo  = `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\`
	pathSystemInfo = `HKLM\SYSTEM\CurrentControlSet\Control\SystemInformation\`
	pathProcInfo   = `HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\`
	pathHotFixes   = `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\Packages\`
)

var (
	version = fmt.Sprintf("%s.%s.%s",
		utils.RegValueToString(pathBuildInfo, "CurrentMajorVersionNumber"),
		utils.RegValueToString(pathBuildInfo, "CurrentMinorVersionNumber"),
		utils.RegValueToString(pathBuildInfo, "CurrentBuild"),
	)
)

func NewSystemInfo() (info *SystemInfo) {
	var err error

	info = &SystemInfo{
		Edr: edrInfo,
	}

	info.System.Manufacturer = utils.RegValueToString(pathSystemInfo, "SystemManufacturer")
	info.System.Name = utils.RegValueToString(pathSystemInfo, "SystemProductName")
	// cheap VM detection
	name := strings.ToLower(info.System.Name)
	lowManuf := strings.ToLower(info.System.Manufacturer)
	info.System.Virtual = strings.Contains(name, "virtual") || strings.Contains(lowManuf, "vmware")

	info.BIOS.Version = utils.RegValueToString(pathSystemInfo, "BIOSVersion")
	info.BIOS.Date = utils.RegValueToString(pathSystemInfo, "BIOSReleaseDate")

	info.OS.Name = los.OS
	info.OS.Build = utils.RegValueToString(pathBuildInfo, "CurrentBuild")
	info.OS.Version = version
	info.OS.Product = utils.RegValueToString(pathBuildInfo, "ProductName")
	info.OS.Edition = utils.RegValueToString(pathBuildInfo, "CompositionEditionID")

	info.CPU.Name = utils.RegValueToString(pathProcInfo, "0", "ProcessorNameString")
	// counting the number of processors
	procs, _ := advapi32.RegEnumKeys(pathProcInfo)
	info.CPU.Count = len(procs)

	if info.Sysmon, err = sysmon.NewSysmonInfo(); err != nil {
		info.Error = err.Error()
	}

	return
}

```

`agent/test/events.json`:

```json
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"au.download.windowsupdate.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11184","Execution":{"ProcessID":"1044","ThreadID":"5700"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:16.820395800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"au.download.windowsupdate.com","QueryResults":"type:  5 audownload.windowsupdate.nsatc.net;type:  5 au.au-msedge.net;type:  5 au.c-0001.c-msedge.net;type:  5 c-0001.c-msedge.net;13.107.4.50;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11185","Execution":{"ProcessID":"1044","ThreadID":"5700"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:16.820594500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryResults":"type:  5 audownload.windowsupdate.nsatc.net;type:  5 au.au-msedge.net;type:  5 au.c-0001.c-msedge.net;type:  5 c-0001.c-msedge.net;::ffff:13.107.4.50;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11186","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:16.820645400Z"},"Version":"0"}}}
{"Event":{"EventData":{"CommandLine":"powershell -Command -","Company":"Microsoft Corporation","CurrentDirectory":"\\\\vboxsvr\\test\\","Description":"Windows PowerShell","FileVersion":"10.0.14393.0 (rs1_release.160715-1616)","Hashes":"SHA1=044A0CF1F6BC478A7172BF207EEF1E201A18BA02","Image":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","IntegrityLevel":"High","LogonGuid":"{B2796A13-A39F-5B00-0000-0020190B3200}","LogonId":"0x320b19","ParentCommandLine":"\"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe\" -dns -c all -r .\\all.gen","ParentImage":"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe","ParentProcessGuid":"{B2796A13-3501-5B03-0000-001012ABBD00}","ParentProcessId":"6472","ProcessGuid":"{B2796A13-3505-5B03-0000-001092F3BD00}","ProcessId":"4332","Product":"Microsoft┬« Windows┬« Operating System","TerminalSessionId":"1","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:17.177"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"372","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:17.188594900Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"ipconfig.exe /flushdns","Company":"Microsoft Corporation","CurrentDirectory":"\\\\vboxsvr\\test\\","Description":"IP Configuration Utility","FileVersion":"10.0.14393.0 (rs1_release.160715-1616)","Hashes":"SHA1=A95BEAA8B81FD799DB6051A79D959908FFBDB22F","Image":"C:\\Windows\\System32\\ipconfig.exe","IntegrityLevel":"High","LogonGuid":"{B2796A13-A39F-5B00-0000-0020190B3200}","LogonId":"0x320b19","ParentCommandLine":"\"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe\" -dns -c all -r .\\all.gen","ParentImage":"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe","ParentProcessGuid":"{B2796A13-3501-5B03-0000-001012ABBD00}","ParentProcessId":"6472","ProcessGuid":"{B2796A13-3505-5B03-0000-0010F5F8BD00}","ProcessId":"6288","Product":"Microsoft┬« Windows┬« Operating System","TerminalSessionId":"1","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:17.330"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"373","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:17.341671100Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\ipconfig.exe","ProcessGuid":"{B2796A13-3505-5B03-0000-0010F5F8BD00}","ProcessId":"6288","UtcTime":"2018-05-21 21:07:17.391"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"374","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:17.409004500Z"},"Version":"3"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"189.106.56.157.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11187","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.810427200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"189.106.56.157.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11188","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.815935900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"189.106.56.157.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11189","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.815954600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"189.106.56.157.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11190","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.816260500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"189.106.56.157.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11191","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.816294700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"189.106.56.157.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11192","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.816329500Z"},"Version":"0"}}}
{"Event":{"EventData":{"Address":"02000035C0A800FE0000000000000000","AddressLength":"16","QueryName":"189.106.56.157.in-addr.arpa"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1016","EventRecordID":"11193","Execution":{"ProcessID":"6732","ThreadID":"5488"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"1016","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.870741100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"189.106.56.157.in-addr.arpa","QueryType":"12","ResponseStatus":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11194","Execution":{"ProcessID":"6732","ThreadID":"5488"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.870761200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"189.106.56.157.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11195","Execution":{"ProcessID":"6732","ThreadID":"5488"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.870952600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","InterfaceCount":"2","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"189.106.56.157.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"11196","Execution":{"ProcessID":"6732","ThreadID":"5488"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.871004800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"189.106.56.157.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3014","EventRecordID":"11197","Execution":{"ProcessID":"6732","ThreadID":"5488"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.871565700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"189.106.56.157.in-addr.arpa.","QueryResults":"","Status":"121"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"11198","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.875565700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"189.106.56.157.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryStatus":"9003","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11199","Execution":{"ProcessID":"6732","ThreadID":"5756"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:22.875654100Z"},"Version":"0"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3504-5B03-0000-001034E7BD00}","ProcessId":"2828","UtcTime":"2018-05-21 21:07:21.773"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"375","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:21.793241800Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 3a8 -InterruptEvent 0 -NGENProcess 3d8 -Pipe 3dc -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3509-5B03-0000-0010C21CBE00}","ProcessId":"3120","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:21.785"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"376","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:21.849599200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"157.56.106.189","DestinationIsIpv6":"false","DestinationPort":"3544","DestinationPortName":"teredo","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"udp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"58046","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:11.926"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"377","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:23.142759600Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 29c -InterruptEvent 0 -NGENProcess 294 -Pipe 3d8 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-350B-5B03-0000-0010542FBE00}","ProcessId":"6292","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:23.704"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"378","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:23.757474600Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3509-5B03-0000-0010C21CBE00}","ProcessId":"3120","UtcTime":"2018-05-21 21:07:23.935"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"379","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:23.948935300Z"},"Version":"3"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11200","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.574056300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"au.download.windowsupdate.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11201","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.581029200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11202","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.581050300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11203","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.581300300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"au.download.windowsupdate.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11204","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.581376700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"au.download.windowsupdate.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11205","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.581420700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11206","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.581985100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11207","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.582253800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"au.download.windowsupdate.com","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11208","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.582308000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"au.download.windowsupdate.com","QueryResults":"","QueryType":"28","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11209","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.582343600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"au.download.windowsupdate.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11210","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.583334500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"au.download.windowsupdate.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11211","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.583344800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"au.download.windowsupdate.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11212","Execution":{"ProcessID":"1044","ThreadID":"1676"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.822921100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"au.download.windowsupdate.com","QueryResults":"type:  5 audownload.windowsupdate.nsatc.net;type:  5 au.au-msedge.net;type:  5 au.c-0001.c-msedge.net;type:  5 c-0001.c-msedge.net;13.107.4.50;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11213","Execution":{"ProcessID":"1044","ThreadID":"1676"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.823096400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"au.download.windowsupdate.com","QueryOptions":"1073897472","QueryResults":"type:  5 audownload.windowsupdate.nsatc.net;type:  5 au.au-msedge.net;type:  5 au.c-0001.c-msedge.net;type:  5 c-0001.c-msedge.net;::ffff:13.107.4.50;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11214","Execution":{"ProcessID":"1044","ThreadID":"4972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.823192800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11215","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.831022900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11216","Execution":{"ProcessID":"1044","ThreadID":"2068"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.831642200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11217","Execution":{"ProcessID":"1044","ThreadID":"2068"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.831651900Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11218","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.832802500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11219","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.832819300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11220","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.833191600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11221","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.833272300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11222","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.833320500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11223","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.833841600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11224","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.834141000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11225","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.834258500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryResults":"","QueryType":"28","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11226","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.834301300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11227","Execution":{"ProcessID":"1044","ThreadID":"1676"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.969470200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryResults":"type:  5 geover-prod.dodsp.mp.microsoft.com.nsatc.net;type:  5 prod.do.dsp.mp.microsoft.com.edgekey.net;type:  5 e1706.g.akamaiedge.net;23.200.133.70;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11228","Execution":{"ProcessID":"1044","ThreadID":"1676"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.969606900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"geover-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 geover-prod.dodsp.mp.microsoft.com.nsatc.net;type:  5 prod.do.dsp.mp.microsoft.com.edgekey.net;type:  5 e1706.g.akamaiedge.net;::ffff:23.200.133.70;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11229","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:24.969696700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"70.133.200.23.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11230","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.582633300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"70.133.200.23.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11231","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.583988700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"70.133.200.23.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11232","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.584003200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"70.133.200.23.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11233","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.584289300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"70.133.200.23.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11234","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.584317100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"70.133.200.23.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11235","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.584348400Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"70.133.200.23.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11236","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.622137700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"70.133.200.23.in-addr.arpa.","QueryResults":"type:  12 a23-200-133-70.deploy.static.akamaitechnologies.com;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11237","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.622249100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"70.133.200.23.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 a23-200-133-70.deploy.static.akamaitechnologies.com;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11238","Execution":{"ProcessID":"6732","ThreadID":"6324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.622322000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50824","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:13.910"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"380","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:25.965296100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50825","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:13.998"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"381","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.319186500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50826","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.004"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"382","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.319215400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50827","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.085"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"383","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.319234100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"a23-200-133-70.deploy.static.akamaitechnologies.com","DestinationIp":"23.200.133.70","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50828","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.382"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"384","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.656661200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50829","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.390"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"385","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.656690100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50830","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.391"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"386","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.656708200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50831","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.391"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"387","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:26.656724400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50832","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:14.831"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"388","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:27.353986000Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11239","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.785630100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11240","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.785641500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11241","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.785656000Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11242","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.787802400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11243","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.787820400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11244","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.788107200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11245","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.788160200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11246","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.788201800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11247","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.789086100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11248","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.789480100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11249","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.789567400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryResults":"","QueryType":"28","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11250","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.789606000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11251","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.824759100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryResults":"type:  5 kv501-prod.dodsp.mp.microsoft.com.nsatc.net;type:  5 kv501-prod.do.dsp.mp.microsoft.com.edgekey.net;type:  5 e10370.dscg.akamaiedge.net;23.217.242.156;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11252","Execution":{"ProcessID":"1044","ThreadID":"4152"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.824928400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"kv501-prod.do.dsp.mp.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 kv501-prod.dodsp.mp.microsoft.com.nsatc.net;type:  5 kv501-prod.do.dsp.mp.microsoft.com.edgekey.net;type:  5 e10370.dscg.akamaiedge.net;::ffff:23.217.242.156;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11253","Execution":{"ProcessID":"1044","ThreadID":"4200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.824975400Z"},"Version":"0"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-350B-5B03-0000-0010542FBE00}","ProcessId":"6292","UtcTime":"2018-05-21 21:07:30.833"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"389","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.845176000Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 29c -InterruptEvent 0 -NGENProcess 3cc -Pipe 294 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3512-5B03-0000-00104E65BE00}","ProcessId":"3500","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.838"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"390","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:30.972124400Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3512-5B03-0000-00104E65BE00}","ProcessId":"3500","UtcTime":"2018-05-21 21:07:31.191"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"391","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:31.194344100Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 3d0 -InterruptEvent 0 -NGENProcess 2f0 -Pipe 2b8 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3513-5B03-0000-0010836FBE00}","ProcessId":"644","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:31.193"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"392","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:31.198355500Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 3d0 -InterruptEvent 0 -NGENProcess 29c -Pipe 3a0 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3513-5B03-0000-00103D79BE00}","ProcessId":"3092","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:31.728"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"393","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:31.734824600Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3513-5B03-0000-0010836FBE00}","ProcessId":"644","UtcTime":"2018-05-21 21:07:31.741"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"394","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:31.743904200Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3513-5B03-0000-00103D79BE00}","ProcessId":"3092","UtcTime":"2018-05-21 21:07:31.908"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"395","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:31.913468300Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 2ac -InterruptEvent 0 -NGENProcess 290 -Pipe 2f0 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3513-5B03-0000-00103082BE00}","ProcessId":"6516","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:31.907"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"396","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:31.920703900Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3513-5B03-0000-00103082BE00}","ProcessId":"6516","UtcTime":"2018-05-21 21:07:32.027"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"397","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.033355900Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 3cc -InterruptEvent 0 -NGENProcess 3d0 -Pipe 2bc -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-00108288BE00}","ProcessId":"3908","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.032"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"398","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.037537800Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-00108288BE00}","ProcessId":"3908","UtcTime":"2018-05-21 21:07:32.140"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"399","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.156223000Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 290 -InterruptEvent 0 -NGENProcess 398 -Pipe 2ac -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-0010008FBE00}","ProcessId":"2932","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.159"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"400","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.166144600Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 398 -InterruptEvent 0 -NGENProcess 394 -Pipe 290 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-00108496BE00}","ProcessId":"3736","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.309"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"401","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.315875700Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-0010008FBE00}","ProcessId":"2932","UtcTime":"2018-05-21 21:07:32.330"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"402","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.335864900Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 398 -InterruptEvent 0 -NGENProcess 2b0 -Pipe 3a8 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-0010C49CBE00}","ProcessId":"3156","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.424"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"403","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.429904200Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-00108496BE00}","ProcessId":"3736","UtcTime":"2018-05-21 21:07:32.415"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"404","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.434358400Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-0010C49CBE00}","ProcessId":"3156","UtcTime":"2018-05-21 21:07:32.541"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"405","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.546356200Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 27c -InterruptEvent 0 -NGENProcess 28c -Pipe 278 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-00107EA3BE00}","ProcessId":"4660","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.546"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"406","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.552028500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"a23-217-242-156.deploy.static.akamaitechnologies.com","DestinationIp":"23.217.242.156","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50833","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:18.712"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"407","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.626278000Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-00107EA3BE00}","ProcessId":"4660","UtcTime":"2018-05-21 21:07:32.625"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"408","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.643876200Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 270 -InterruptEvent 0 -NGENProcess 280 -Pipe 398 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-001067A9BE00}","ProcessId":"4524","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.644"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"409","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.653411200Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-001067A9BE00}","ProcessId":"4524","UtcTime":"2018-05-21 21:07:32.732"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"410","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.748329500Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 288 -InterruptEvent 0 -NGENProcess 280 -Pipe 27c -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-001052AFBE00}","ProcessId":"4548","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.747"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"411","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.761738500Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-001052AFBE00}","ProcessId":"4548","UtcTime":"2018-05-21 21:07:32.858"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"412","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.867079700Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 270 -InterruptEvent 0 -NGENProcess 2b0 -Pipe 2b4 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-00103AB5BE00}","ProcessId":"5580","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.866"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"413","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.872647700Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-00103AB5BE00}","ProcessId":"5580","UtcTime":"2018-05-21 21:07:32.963"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"414","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.965329300Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 288 -InterruptEvent 0 -NGENProcess 3ac -Pipe 298 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3514-5B03-0000-00100ABBBE00}","ProcessId":"3196","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:32.961"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"415","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.967429900Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3514-5B03-0000-00100ABBBE00}","ProcessId":"3196","UtcTime":"2018-05-21 21:07:33.054"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"416","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.055979400Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 26c -InterruptEvent 0 -NGENProcess 3ac -Pipe 29c -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3515-5B03-0000-0010E2C0BE00}","ProcessId":"6276","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:33.054"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"417","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.060693900Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 270 -InterruptEvent 0 -NGENProcess 258 -Pipe 264 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3515-5B03-0000-0010EBC6BE00}","ProcessId":"2216","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:33.165"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"418","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.170063900Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3515-5B03-0000-0010E2C0BE00}","ProcessId":"6276","UtcTime":"2018-05-21 21:07:33.153"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"419","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.170292800Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3515-5B03-0000-0010EBC6BE00}","ProcessId":"2216","UtcTime":"2018-05-21 21:07:33.237"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"420","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.257514700Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 25c -InterruptEvent 0 -NGENProcess 270 -Pipe 280 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3515-5B03-0000-0010BCCCBE00}","ProcessId":"4920","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:33.255"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"421","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.259682200Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3515-5B03-0000-0010BCCCBE00}","ProcessId":"4920","UtcTime":"2018-05-21 21:07:33.343"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"422","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.347289500Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe -StartupEvent 260 -InterruptEvent 0 -NGENProcess 254 -Pipe 248 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=FCBA3B241A1974138B92E9F9DF1F70CF84791CA7","Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ParentProcessId":"3808","ProcessGuid":"{B2796A13-3515-5B03-0000-001091D2BE00}","ProcessId":"6752","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:33.346"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"423","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.353668500Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3515-5B03-0000-001091D2BE00}","ProcessId":"6752","UtcTime":"2018-05-21 21:07:33.427"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"424","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.443767500Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe","ProcessGuid":"{B2796A13-32C3-5B03-0000-001062239300}","ProcessId":"3808","UtcTime":"2018-05-21 21:07:33.448"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"425","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.457710300Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\conhost.exe","ProcessGuid":"{B2796A13-32C3-5B03-0000-00101C189300}","ProcessId":"5456","UtcTime":"2018-05-21 21:07:33.448"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"426","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.460805500Z"},"Version":"3"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"156.242.217.23.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11254","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.396766700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"156.242.217.23.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11255","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.398069700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"156.242.217.23.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11256","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.398083600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"156.242.217.23.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11257","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.398511900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"156.242.217.23.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11258","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.398560700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"156.242.217.23.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11259","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.398610700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"156.242.217.23.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11260","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.493030700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"156.242.217.23.in-addr.arpa.","QueryResults":"type:  12 a23-217-242-156.deploy.static.akamaitechnologies.com;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11261","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.493144600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"156.242.217.23.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 a23-217-242-156.deploy.static.akamaitechnologies.com;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11262","Execution":{"ProcessID":"6732","ThreadID":"4636"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:32.493219300Z"},"Version":"0"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe -StartupEvent 1f4 -InterruptEvent 0 -NGENProcess 1fc -Pipe 1f8 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=892DE0AFC7FFC0FA524D44EB3199F4F609625A2B","Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-0010F7229300}","ParentProcessId":"3248","ProcessGuid":"{B2796A13-3515-5B03-0000-001055DCBE00}","ProcessId":"2100","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:33.755"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"427","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.782311400Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3515-5B03-0000-001055DCBE00}","ProcessId":"2100","UtcTime":"2018-05-21 21:07:33.955"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"428","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.960354500Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe -StartupEvent 1ac -InterruptEvent 0 -NGENProcess 1c8 -Pipe 1bc -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=892DE0AFC7FFC0FA524D44EB3199F4F609625A2B","Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-0010F7229300}","ParentProcessId":"3248","ProcessGuid":"{B2796A13-3515-5B03-0000-001030E4BE00}","ProcessId":"5584","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:33.959"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"429","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:33.967008200Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe -StartupEvent 1f4 -InterruptEvent 0 -NGENProcess 288 -Pipe 1fc -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=892DE0AFC7FFC0FA524D44EB3199F4F609625A2B","Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-0010F7229300}","ParentProcessId":"3248","ProcessGuid":"{B2796A13-3516-5B03-0000-00109BEABE00}","ProcessId":"6124","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:34.170"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"430","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.178258000Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3515-5B03-0000-001030E4BE00}","ProcessId":"5584","UtcTime":"2018-05-21 21:07:34.165"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"431","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.178717000Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3516-5B03-0000-00109BEABE00}","ProcessId":"6124","UtcTime":"2018-05-21 21:07:34.313"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"432","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.317237100Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe -StartupEvent 1c8 -InterruptEvent 0 -NGENProcess 280 -Pipe 288 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=892DE0AFC7FFC0FA524D44EB3199F4F609625A2B","Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-0010F7229300}","ParentProcessId":"3248","ProcessGuid":"{B2796A13-3516-5B03-0000-001066F1BE00}","ProcessId":"1944","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:34.315"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"433","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.321078100Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe -StartupEvent 1d0 -InterruptEvent 0 -NGENProcess 278 -Pipe 234 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=892DE0AFC7FFC0FA524D44EB3199F4F609625A2B","Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-0010F7229300}","ParentProcessId":"3248","ProcessGuid":"{B2796A13-3516-5B03-0000-0010F8F9BE00}","ProcessId":"5752","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:34.596"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"434","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.603043600Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3516-5B03-0000-001066F1BE00}","ProcessId":"1944","UtcTime":"2018-05-21 21:07:34.587"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"435","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.607888200Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","ProcessGuid":"{B2796A13-3516-5B03-0000-0010F8F9BE00}","ProcessId":"5752","UtcTime":"2018-05-21 21:07:34.840"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"436","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.849333800Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe -StartupEvent 284 -InterruptEvent 0 -NGENProcess 298 -Pipe 270 -Comment \"NGen Worker Process\"","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":".NET Runtime Optimization Service","FileVersion":"4.7.2053.0 built by: NET47REL1","Hashes":"SHA1=892DE0AFC7FFC0FA524D44EB3199F4F609625A2B","Image":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"\"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe\" ExecuteQueuedItems 2 /LegacyServiceBehavior","ParentImage":"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngen.exe","ParentProcessGuid":"{B2796A13-32C3-5B03-0000-0010F7229300}","ParentProcessId":"3248","ProcessGuid":"{B2796A13-3516-5B03-0000-00105102BF00}","ProcessId":"6840","Product":"Microsoft┬« .NET Framework","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:34.849"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"437","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:34.856763900Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"\"\\\\VBOXSVR\\test\\test-dns.exe\"","Company":"?","CurrentDirectory":"\\\\VBOXSVR\\test\\","Description":"?","FileVersion":"?","Hashes":"SHA1=9CB8C155639D1FC88D2A727FAC77E9E6B8C75CA3","Image":"\\\\vboxsvr\\test\\test-dns.exe","IntegrityLevel":"Medium","LogonGuid":"{B2796A13-A39F-5B00-0000-00204D0B3200}","LogonId":"0x320b4d","ParentCommandLine":"\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" ","ParentImage":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","ParentProcessGuid":"{B2796A13-A44C-5B00-0000-0010B6094400}","ParentProcessId":"1496","ProcessGuid":"{B2796A13-3518-5B03-0000-00106721BF00}","ProcessId":"2512","Product":"?","TerminalSessionId":"1","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:36.250"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"438","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.316955800Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11263","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.467617400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11264","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.467650000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11265","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.469926600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.be"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11266","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.486645300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11267","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.486667500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11268","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487039200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.be","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11269","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487144700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"rawsec.be","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11270","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487188000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073897472","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11271","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487639200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073897472","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11272","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487856700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.be","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11273","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487881400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.be","QueryResults":"","QueryType":"28","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11274","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.487918800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"rawsec.be","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11275","Execution":{"ProcessID":"2512","ThreadID":"7164"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.536314000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.be","QueryResults":"217.70.184.38;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11276","Execution":{"ProcessID":"2512","ThreadID":"7164"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.536634500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073897472","QueryResults":"::ffff:217.70.184.38;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11277","Execution":{"ProcessID":"2512","ThreadID":"2960"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:36.536716400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11278","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.625301300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11279","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.625313200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11280","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.625535000Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11281","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.629634300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11282","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.629647800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11283","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.629961700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11284","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.630026300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11285","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.630054400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11286","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.630804300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11287","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.631059600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11288","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.631082900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"","QueryType":"28","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11289","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.631107300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"rawsec.lu","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11290","Execution":{"ProcessID":"2512","ThreadID":"7164"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.671787000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"62.210.16.62;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11291","Execution":{"ProcessID":"2512","ThreadID":"7164"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.671906900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"::ffff:62.210.16.62;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11292","Execution":{"ProcessID":"2512","ThreadID":"6892"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.671954000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"38.184.70.217.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11293","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.759196600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"38.184.70.217.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11294","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.760369800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"38.184.70.217.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11295","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.760382300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"38.184.70.217.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11296","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.760625200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"38.184.70.217.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11297","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.760651800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"38.184.70.217.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11298","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.760681100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"38.184.70.217.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11299","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.794945200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"38.184.70.217.in-addr.arpa.","QueryResults":"type:  12 webredir.vip.gandi.net;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11300","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.795200600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"38.184.70.217.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 webredir.vip.gandi.net;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11301","Execution":{"ProcessID":"6732","ThreadID":"2196"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.795604000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"c0a8:fe:7300:2e00:4d00:6500:6100:7300","DestinationIsIpv6":"true","DestinationPort":"53","DestinationPortName":"domain","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-3518-5B03-0000-00106721BF00}","ProcessId":"2512","Protocol":"udp","SourceHostname":"","SourceIp":"a00:20f:0:0:9820:ca8b:8096:ffff","SourceIsIpv6":"true","SourcePort":"52565","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:22.786"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"439","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:37.778506600Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"bbox.lan","DestinationIp":"192.168.0.254","DestinationIsIpv6":"false","DestinationPort":"53","DestinationPortName":"domain","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"false","ProcessGuid":"{B2796A13-3518-5B03-0000-00106721BF00}","ProcessId":"2512","Protocol":"udp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52565","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:22.822"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"440","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.100131100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"webredir.vip.gandi.net","DestinationIp":"217.70.184.38","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-3518-5B03-0000-00106721BF00}","ProcessId":"2512","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50834","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:22.965"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"441","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.100158800Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"62.16.210.62.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11302","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.996523700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"62.16.210.62.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11303","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.998867500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"62.16.210.62.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11304","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.998886000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"62.16.210.62.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11305","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.999217800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"62.16.210.62.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11306","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.999307800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"62.16.210.62.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11307","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:38.999356600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"62.16.210.62.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11308","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:39.034680100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"62.16.210.62.in-addr.arpa.","QueryResults":"type:  12 pf-lb-2.online.net;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11309","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:39.034817300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"62.16.210.62.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 pf-lb-2.online.net;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11310","Execution":{"ProcessID":"6732","ThreadID":"1992"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:39.034856300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"pf-lb-2.online.net","DestinationIp":"62.210.16.62","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-3518-5B03-0000-00106721BF00}","ProcessId":"2512","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50835","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-21 21:07:23.841"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"442","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:39.334314800Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50836","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:24.990"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"443","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:40.625728500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50837","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:25.468"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"444","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:41.270502800Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"\\\\vboxsvr\\test\\test-dns.exe","ProcessGuid":"{B2796A13-3518-5B03-0000-00106721BF00}","ProcessId":"2512","UtcTime":"2018-05-21 21:07:41.441"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"445","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:41.444240200Z"},"Version":"3"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50838","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:26.372"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"446","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:42.238746200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50839","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:26.844"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"447","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:42.865293200Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"181.226.77.40.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"11311","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.872171200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"192.168.0.254;","InterfaceCount":"2","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"181.226.77.40.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"11312","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.879875400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"181.226.77.40.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"11313","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.879895000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"181.226.77.40.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"11314","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.880228400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"181.226.77.40.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"11315","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.880268000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"181.226.77.40.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"11316","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.880313500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"192.168.0.254","QueryName":"181.226.77.40.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"11317","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.915510200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"181.226.77.40.in-addr.arpa.","QueryResults":"type:  12 db5-dspcdn.tlu.dl.delivery.mp.microsoft.com;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"11318","Execution":{"ProcessID":"6732","ThreadID":"4252"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.915619700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"181.226.77.40.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 db5-dspcdn.tlu.dl.delivery.mp.microsoft.com;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"11319","Execution":{"ProcessID":"6732","ThreadID":"2816"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-05-21T21:07:43.915649500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50840","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.411"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"448","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:44.765964000Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50841","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.616"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"449","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.086440200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50842","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.617"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"450","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.086486300Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50843","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.618"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"451","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.086505300Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50844","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.621"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"452","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.086522100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50845","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.877"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"453","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.409133400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50846","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:28.903"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"454","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.409173000Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50847","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.263"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"455","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:45.734155800Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50851","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.452"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"456","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:46.360330400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50853","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.828"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"457","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:46.360375400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50852","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.832"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"458","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:46.360408500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50849","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.838"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"459","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:46.360448600Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50855","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.911"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"460","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:46.681196000Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50856","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:29.925"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"461","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:46.681241500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50857","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.179"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"462","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.003821400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50858","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.179"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"463","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.003848500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50860","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.372"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"464","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.003865300Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50861","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.566"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"465","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.327023100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50862","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.567"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"466","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.327049700Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50848","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.600"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"467","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.327068100Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50859","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.637"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"468","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.327084400Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\SERVIC~2\\NETWOR~1\\AppData\\Local\\Temp\\{E2AF29E9-9F64-4EF8-AC8D-C7C1B17D06F4}\\MPSigStub.exe","ProcessGuid":"{B2796A13-34C6-5B03-0000-00108E3CB100}","ProcessId":"2564","UtcTime":"2018-05-21 21:07:47.421"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"469","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.421970500Z"},"Version":"3"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.107.4.50","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50863","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.782"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"470","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.650178200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50864","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.933"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"471","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.974614600Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"db5-dspcdn.tlu.dl.delivery.mp.microsoft.com","DestinationIp":"40.77.226.181","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"50865","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-21 21:07:30.939"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"472","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-05-21T21:07:47.974658500Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"\"C:\\Program Files\\Windows Defender\\\\MpCmdRun.exe\" GetDeviceTicket -AccessKey A97990DD-BD73-1F55-DC39-556BE030B4CD ","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":"Microsoft Malware Protection Command Line Utility","FileVersion":"4.10.14393.1593 (rs1_release.170731-1934)","Hashes":"SHA1=23318CBEA3EFC5ED3C218572AB95C6BD8C03CA5B","Image":"C:\\Program Files\\Windows Defender\\MpCmdRun.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E4030000}","LogonId":"0x3e4","ParentCommandLine":"\"C:\\Program Files\\Windows Defender\\MsMpEng.exe\"","ParentImage":"C:\\Program Files\\Windows Defender\\MsMpEng.exe","ParentProcessGuid":"{B2796A13-A33B-5B00-0000-0010F1520100}","ParentProcessId":"1800","ProcessGuid":"{B2796A13-3524-5B03-0000-0010DA57BF00}","ProcessId":"1324","Product":"Microsoft┬« Windows┬« Operating System","TerminalSessionId":"0","User":"NT AUTHORITY\\NETWORK SERVICE","UtcTime":"2018-05-21 21:07:48.432"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"473","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-05-21T21:07:48.522275600Z"},"Version":"5"}}}

```

`agent/test/new-events.json`:

```json
{"Event":{"EventData":{"CommandLine":"powershell -Command -","Company":"Microsoft Corporation","CurrentDirectory":"\\\\vboxsvr\\test\\","Description":"Windows PowerShell","FileVersion":"10.0.14393.0 (rs1_release.160715-1616)","Hashes":"SHA1=044A0CF1F6BC478A7172BF207EEF1E201A18BA02","Image":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","IntegrityLevel":"High","LogonGuid":"{B2796A13-A39F-5B00-0000-0020190B3200}","LogonId":"0x320b19","ParentCommandLine":"\"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe\" -dns -c all -r .\\all.gen","ParentImage":"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe","ParentProcessGuid":"{B2796A13-C047-5B23-0000-001060EC1902}","ParentProcessId":"6256","ProcessGuid":"{B2796A13-C049-5B23-0000-00107F2B1A02}","ProcessId":"4760","Product":"Microsoft┬« Windows┬« Operating System","TerminalSessionId":"1","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-06-15 13:34:01.745"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"5657","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-06-15T13:34:01.757594100Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"ipconfig.exe /flushdns","Company":"Microsoft Corporation","CurrentDirectory":"\\\\vboxsvr\\test\\","Description":"IP Configuration Utility","FileVersion":"10.0.14393.0 (rs1_release.160715-1616)","Hashes":"SHA1=A95BEAA8B81FD799DB6051A79D959908FFBDB22F","Image":"C:\\Windows\\System32\\ipconfig.exe","IntegrityLevel":"High","LogonGuid":"{B2796A13-A39F-5B00-0000-0020190B3200}","LogonId":"0x320b19","ParentCommandLine":"\"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe\" -dns -c all -r .\\all.gen","ParentImage":"\\\\vboxsvr\\test\\release\\windows\\whids-v1.2-amd64.exe","ParentProcessGuid":"{B2796A13-C047-5B23-0000-001060EC1902}","ParentProcessId":"6256","ProcessGuid":"{B2796A13-C049-5B23-0000-0010932D1A02}","ProcessId":"6304","Product":"Microsoft┬« Windows┬« Operating System","TerminalSessionId":"1","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-06-15 13:34:01.802"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"5658","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-06-15T13:34:01.822500800Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\ipconfig.exe","ProcessGuid":"{B2796A13-C049-5B23-0000-0010932D1A02}","ProcessId":"6304","UtcTime":"2018-06-15 13:34:01.886"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5659","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:01.897238800Z"},"Version":"3"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36399","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.329385700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36400","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.332478900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36401","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.332486100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"sls.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36402","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.334495000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36403","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.334507000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36404","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.334677100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"sls.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36405","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.334705600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"sls.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36406","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.334742600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"sls.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36407","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.335181700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"sls.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36408","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.335949300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"sls.update.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36409","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.335975100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"sls.update.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36410","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.350755100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"sls.update.microsoft.com","QueryResults":"type:  5 sls.update.microsoft.com.nsatc.net;13.74.179.117;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36411","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.350869400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36412","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.350924700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36413","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.351091100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 sls.update.microsoft.com.nsatc.net;::ffff:13.74.179.117;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36414","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:05.351223200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36415","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.898033100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36416","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.898059000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36417","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.898068400Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36418","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.903946100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36419","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.903959900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36420","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.904157100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36421","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.904197700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36422","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.904228100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"v10.vortex-win.data.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36423","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.904763100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36424","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.904851000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36425","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.904876000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36426","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.021614400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36427","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.021666200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36428","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.021675100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36429","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.022691600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36430","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.022703600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36431","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.022900900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36432","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.022929000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"fe2.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36433","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.022960700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"fe2.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36434","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.023344400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"fe2.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36435","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.023390800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36436","Execution":{"ProcessID":"1044","ThreadID":"6480"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.023418500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"fe2.update.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36437","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.071709900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com","QueryResults":"type:  5 fe2.update.microsoft.com.nsatc.net;23.103.189.158;134.170.58.121;65.55.163.221;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36438","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.071858000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36439","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.071863800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36440","Execution":{"ProcessID":"1044","ThreadID":"972"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.072244000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 fe2.update.microsoft.com.nsatc.net;::ffff:23.103.189.158;::ffff:134.170.58.121;::ffff:65.55.163.221;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36441","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.072322500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.74.179.117","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52234","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:42.396"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5660","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:06.418083100Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\SppExtComObj.Exe","ProcessGuid":"{B2796A13-C029-5B23-0000-0010F4901502}","ProcessId":"2520","UtcTime":"2018-06-15 13:34:07.089"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5661","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.092483600Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\sppsvc.exe","ProcessGuid":"{B2796A13-C027-5B23-0000-001011311502}","ProcessId":"2656","UtcTime":"2018-06-15 13:34:07.089"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5662","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.099396100Z"},"Version":"3"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36442","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.210384000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryResults":"type:  5 v10-win.vortex.data.microsoft.com.akadns.net;type:  5 geo.vortex.data.microsoft.com.akadns.net;type:  5 db5.vortex.data.microsoft.com.akadns.net;111.221.29.254;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36443","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.210519600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36444","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.210528500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36445","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.210758300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 v10-win.vortex.data.microsoft.com.akadns.net;type:  5 geo.vortex.data.microsoft.com.akadns.net;type:  5 db5.vortex.data.microsoft.com.akadns.net;::ffff:111.221.29.254;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36446","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:07.210910100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"23.103.189.158","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52235","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:44.239"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5663","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:08.450722400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"111.221.29.254","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A33B-5B00-0000-00104E490100}","ProcessId":"1652","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52236","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:44.515"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5664","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:08.715468700Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36447","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.162428700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36448","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.162430900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36449","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.162439400Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"sls.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36450","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.163487600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36451","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.163499200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36452","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.163681700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"sls.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36453","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.163709300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"sls.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36454","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.163740100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"sls.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36455","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.164128800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"sls.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36456","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.164190800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"sls.update.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36457","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.164218500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"sls.update.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36458","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.181872600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"sls.update.microsoft.com","QueryResults":"type:  5 sls.update.microsoft.com.nsatc.net;13.74.179.117;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36459","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.182044900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"sls.update.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36460","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.182054300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36461","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.182352800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"sls.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 sls.update.microsoft.com.nsatc.net;::ffff:13.74.179.117;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36462","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.182514300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36463","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.772540600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36464","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.772559300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36465","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.772568300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36466","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.773471400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36467","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.773482100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36468","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.773728000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36469","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.773761000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"fe2.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36470","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.773793200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"fe2.update.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36471","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.774410700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"fe2.update.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36472","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.774516100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36473","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.774549100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"fe2.update.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36474","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.790930100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"fe2.update.microsoft.com","QueryResults":"type:  5 fe2.update.microsoft.com.nsatc.net;191.234.72.188;134.170.58.125;191.232.80.60;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36475","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.791146000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"fe2.update.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36476","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.791155000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36477","Execution":{"ProcessID":"1044","ThreadID":"7112"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.791542700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"fe2.update.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 fe2.update.microsoft.com.nsatc.net;::ffff:191.234.72.188;::ffff:134.170.58.125;::ffff:191.232.80.60;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36478","Execution":{"ProcessID":"1044","ThreadID":"6664"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:10.791735500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"13.74.179.117","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52237","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:47.230"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5665","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.558248000Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36479","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.769621300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36480","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.770399100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36481","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.770409400Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36482","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.771222400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36483","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.771241100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36484","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.771536600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36485","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.771581600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36486","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.771621800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"v10.vortex-win.data.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36487","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.772159900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36488","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.772226900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36489","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.772257700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36490","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.917963400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryResults":"type:  5 v10-win.vortex.data.microsoft.com.akadns.net;type:  5 geo.vortex.data.microsoft.com.akadns.net;type:  5 db5.vortex.data.microsoft.com.akadns.net;64.4.54.254;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36491","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.918157100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36492","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.918166900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36493","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.918446700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 v10-win.vortex.data.microsoft.com.akadns.net;type:  5 geo.vortex.data.microsoft.com.akadns.net;type:  5 db5.vortex.data.microsoft.com.akadns.net;::ffff:64.4.54.254;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36494","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:11.918502900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"188.72.234.191.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36495","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.387367800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"188.72.234.191.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36496","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.393222800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"188.72.234.191.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36497","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.393246400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"188.72.234.191.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36498","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.393654700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"188.72.234.191.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36499","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.393691300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"188.72.234.191.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36500","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.393738600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"188.72.234.191.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36501","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.394620300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"188.72.234.191.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36502","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.394850200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"188.72.234.191.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36503","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.394896100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"188.72.234.191.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36504","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.394932300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"188.72.234.191.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36505","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.395198200Z"},"Version":"0"}}}
{"Event":{"EventData":{"Address":"02000035D043DEDE0000000000000000","AddressLength":"16","QueryName":"188.72.234.191.in-addr.arpa"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1016","EventRecordID":"36506","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"1016","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409016100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"188.72.234.191.in-addr.arpa","QueryType":"12","ResponseStatus":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36507","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409034400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"188.72.234.191.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36508","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409190600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","InterfaceCount":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"188.72.234.191.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36509","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409244600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"188.72.234.191.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3014","EventRecordID":"36510","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409517200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"188.72.234.191.in-addr.arpa.","QueryResults":"","Status":"121"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36511","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409597600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"188.72.234.191.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryStatus":"9003","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36512","Execution":{"ProcessID":"6732","ThreadID":"1736"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.409660500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"191.234.72.188","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A339-5B00-0000-001040000100}","ProcessId":"1044","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52238","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:47.906"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5666","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:12.573970900Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"64.4.54.254","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A33B-5B00-0000-00104E490100}","ProcessId":"1652","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52239","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:49.070"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5667","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:13.590589800Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\CompatTelRunner.exe","ProcessGuid":"{B2796A13-C02A-5B23-0000-0010F3D61502}","ProcessId":"4380","UtcTime":"2018-06-15 13:34:14.448"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5668","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:14.463442200Z"},"Version":"3"}}}
{"Event":{"EventData":{"CommandLine":"C:\\Windows\\system32\\CompatTelRunner.exe -m:appraiser.dll -f:UpdateAvStatus -cv:wXVItb7BOUaOa7RJ.3","Company":"Microsoft Corporation","CurrentDirectory":"C:\\Windows\\system32\\","Description":"Microsoft Compatibility Telemetry","FileVersion":"10.0.15156.1008 (WinBuild.160101.0800)","Hashes":"SHA1=6D375871493B472BB73BFB17CF8153A3F313C6F4","Image":"C:\\Windows\\System32\\CompatTelRunner.exe","IntegrityLevel":"System","LogonGuid":"{B2796A13-21C7-5B01-0000-0020E7030000}","LogonId":"0x3e7","ParentCommandLine":"C:\\Windows\\system32\\compattelrunner.exe","ParentImage":"C:\\Windows\\System32\\CompatTelRunner.exe","ParentProcessGuid":"{B2796A13-C029-5B23-0000-00106E981502}","ParentProcessId":"844","ProcessGuid":"{B2796A13-C056-5B23-0000-0010477C1B02}","ProcessId":"4368","Product":"Microsoft┬« Windows┬« Operating System","TerminalSessionId":"0","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-06-15 13:34:14.474"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"5669","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-06-15T13:34:14.483084300Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\CompatTelRunner.exe","ProcessGuid":"{B2796A13-C056-5B23-0000-0010477C1B02}","ProcessId":"4368","UtcTime":"2018-06-15 13:34:14.698"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5670","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:14.699319700Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\CompatTelRunner.exe","ProcessGuid":"{B2796A13-C029-5B23-0000-00106E981502}","ProcessId":"844","UtcTime":"2018-06-15 13:34:14.698"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5671","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:14.707677600Z"},"Version":"3"}}}
{"Event":{"EventData":{"Image":"C:\\Windows\\System32\\conhost.exe","ProcessGuid":"{B2796A13-C02A-5B23-0000-001014B81502}","ProcessId":"6080","UtcTime":"2018-06-15 13:34:14.698"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5672","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:14.709776200Z"},"Version":"3"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36513","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.049968200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36514","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.049972300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36515","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.049985200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36516","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.051985200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36517","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.052006200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36518","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.052359100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36519","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.052410000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36520","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.052455100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"v10.vortex-win.data.microsoft.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36521","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.053160100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36522","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.053311400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36523","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.053363600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"v10.vortex-win.data.microsoft.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36524","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.069381000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryResults":"type:  5 v10-win.vortex.data.microsoft.com.akadns.net;type:  5 geo.vortex.data.microsoft.com.akadns.net;type:  5 db5.vortex.data.microsoft.com.akadns.net;111.221.29.254;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36525","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.069626900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36526","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.069644300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36527","Execution":{"ProcessID":"1652","ThreadID":"6620"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.070080700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"v10.vortex-win.data.microsoft.com","QueryOptions":"1073897472","QueryResults":"type:  5 v10-win.vortex.data.microsoft.com.akadns.net;type:  5 geo.vortex.data.microsoft.com.akadns.net;type:  5 db5.vortex.data.microsoft.com.akadns.net;::ffff:111.221.29.254;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36528","Execution":{"ProcessID":"1652","ThreadID":"2180"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:15.070286400Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"111.221.29.254","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"C:\\Windows\\System32\\svchost.exe","Initiated":"true","ProcessGuid":"{B2796A13-A33B-5B00-0000-00104E490100}","ProcessId":"1652","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52240","SourcePortName":"","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2018-05-23 06:02:52.378"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5673","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:16.465140100Z"},"Version":"5"}}}
{"Event":{"EventData":{"CommandLine":"\"\\\\VBOXSVR\\test\\test-dns.exe\"","Company":"?","CurrentDirectory":"\\\\VBOXSVR\\test\\","Description":"?","FileVersion":"?","Hashes":"SHA1=0717261D425433B6FB242A08443450893B956EDE","Image":"\\\\vboxsvr\\test\\test-dns.exe","IntegrityLevel":"Medium","LogonGuid":"{B2796A13-A39F-5B00-0000-00204D0B3200}","LogonId":"0x320b4d","ParentCommandLine":"\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" ","ParentImage":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","ParentProcessGuid":"{B2796A13-A44C-5B00-0000-0010B6094400}","ParentProcessId":"1496","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Product":"?","TerminalSessionId":"1","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-06-15 13:34:16.808"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1","EventRecordID":"5674","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"1","TimeCreated":{"SystemTime":"2018-06-15T13:34:16.873392300Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36529","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.010604100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36530","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.010616200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36531","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.012126300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.be"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36532","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.024138700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.be","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36533","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.024154700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36534","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.024429600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.be","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36535","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.024503700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.be","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36536","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.024540300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"rawsec.be"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36537","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.025030700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"rawsec.be","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36538","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.025887500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"rawsec.be","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36539","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.025920500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.be","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36540","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.168327300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.be","QueryResults":"217.70.184.38;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36541","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.168624500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.be","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36542","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.168644600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36543","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.169281400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.be","QueryOptions":"1073897472","QueryResults":"::ffff:217.70.184.38;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36544","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.169647300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36545","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.433490000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36546","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.433500300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36547","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.433528900Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36548","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.435255700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36549","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.435277200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36550","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.435627900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36551","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.435667200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36552","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.435704200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36553","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.436573000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36554","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.436722000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36555","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.436747000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.lu","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36556","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.637112300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"62.210.16.62;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36557","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.637201500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36558","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.637209100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36559","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.637446500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"::ffff:62.210.16.62;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36560","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:17.637550500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.io","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36561","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.133232800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.io","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36562","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.133259100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.io","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36563","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.133312600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.io"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36564","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.134783900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.io","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36565","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.134797700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.io","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36566","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.135098000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.io","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36567","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.135124800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.io","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36568","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.135154200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"rawsec.io"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36569","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.135500500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"rawsec.io","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36570","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.135563800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"rawsec.io","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36571","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.135602200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.io","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36572","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.306805600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.io","QueryResults":"217.70.184.38;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36573","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.306909100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.io","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36574","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.306918400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.io","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36575","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.307204900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.io","QueryOptions":"1073897472","QueryResults":"::ffff:217.70.184.38;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36576","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.307292800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36577","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.522493500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36578","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.522516700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36579","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.522581800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36580","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.526549700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36581","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.526575100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36582","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.527176200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36583","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.527228400Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36584","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.527285100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36585","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.528470300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36586","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.528720600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36587","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.529059700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.lu","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36588","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.734432100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"62.210.16.62;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36589","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.734720400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36590","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.734739100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36591","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.735479000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"::ffff:62.210.16.62;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36592","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.735868500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"d043:dede:0:0:180:500:0:0","DestinationIsIpv6":"true","DestinationPort":"53","DestinationPortName":"domain","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"udp","SourceHostname":"","SourceIp":"a00:20f:0:0:9820:ca8b:8096:ffff","SourceIsIpv6":"true","SourcePort":"62161","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:54.035"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5675","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.511888900Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"resolver1.opendns.com","DestinationIp":"208.67.222.222","DestinationIsIpv6":"false","DestinationPort":"53","DestinationPortName":"domain","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"false","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"udp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"62161","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:54.179"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5676","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.511946400Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"webredir.vip.gandi.net","DestinationIp":"217.70.184.38","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52241","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:54.223"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5677","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.511983000Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"pf-lb-2.online.net","DestinationIp":"62.210.16.62","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52242","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:54.689"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5678","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:18.761821200Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"webredir.vip.gandi.net","DestinationIp":"217.70.184.38","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52243","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:55.347"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5679","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.543752200Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36593","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.813371900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36594","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.813382100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36595","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.813411600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36596","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.815267000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36597","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.815283500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36598","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.815611500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36599","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.815642300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36600","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.815676200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"rawsec.lu"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36601","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.816451200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"rawsec.lu","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36602","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.816532000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36603","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.816620400Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"rawsec.lu","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36604","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.993610900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"rawsec.lu","QueryResults":"62.210.16.62;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36605","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.993793900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"rawsec.lu","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36606","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.993813500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36607","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.994278500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"rawsec.lu","QueryOptions":"1073897472","QueryResults":"::ffff:62.210.16.62;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36608","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:19.994489500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"google.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36609","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.181574600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"google.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36610","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.181586200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"google.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36611","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.181615600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"google.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36612","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.185085000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"google.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36613","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.185176000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"google.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36614","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.185663300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"google.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36615","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.185711500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"google.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36616","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.185751200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"google.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36617","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.186914100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"google.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36618","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.187073400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"google.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36619","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.187107300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"google.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36620","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.237183600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"google.com","QueryResults":"216.58.215.46;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36621","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.237412100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"google.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36622","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.237431300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"google.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36623","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.238019800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"google.com","QueryOptions":"1073897472","QueryResults":"::ffff:216.58.215.46;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36624","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.238350500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"www.google.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36625","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.510883900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.google.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36626","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.510901300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"www.google.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36627","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.510954900Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"www.google.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36628","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.515041900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"www.google.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36629","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.515062900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.google.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36630","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.515798200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"www.google.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36631","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.515859800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"www.google.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36632","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.515922700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"www.google.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36633","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.516780900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"www.google.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36634","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.516931700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"www.google.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36635","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.517001700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"www.google.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36636","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.622148500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"www.google.com","QueryResults":"216.58.198.196;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36637","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.622464900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"www.google.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36638","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.622489400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.google.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36639","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.623198000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.google.com","QueryOptions":"1073897472","QueryResults":"::ffff:216.58.198.196;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36640","Execution":{"ProcessID":"4608","ThreadID":"6980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.623614300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"pf-lb-2.online.net","DestinationIp":"62.210.16.62","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52244","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:56.043"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5680","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.590030700Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"pf-lb-2.online.net","DestinationIp":"62.210.16.62","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52245","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:57.033"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5681","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.121861500Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"amazon.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36641","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.850112100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36642","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.850121900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"amazon.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36643","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.850147800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"amazon.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36644","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.854208900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"amazon.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36645","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.854219600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36646","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.854856800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36647","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.854888100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36648","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.855086700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"amazon.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36649","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.856368700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36650","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.857354400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"amazon.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36651","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:20.857385200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"amazon.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36652","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.284665900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"amazon.com","QueryResults":"176.32.103.205;176.32.98.166;205.251.242.103;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36653","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.284907300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"amazon.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36654","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.284926900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36655","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.285565500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1073897472","QueryResults":"::ffff:176.32.103.205;::ffff:176.32.98.166;::ffff:205.251.242.103;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36656","Execution":{"ProcessID":"4608","ThreadID":"32"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.285911800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"46.215.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36657","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.481727400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"196.198.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36658","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.481991100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"196.198.58.216.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36659","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.485042800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"46.215.58.216.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36660","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.485056700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"196.198.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36661","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.485073600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"46.215.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36662","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.485083400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"196.198.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36663","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.486351600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"46.215.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36664","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.486389100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"196.198.58.216.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36665","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.486410500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"46.215.58.216.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36666","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.486443600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"196.198.58.216.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36667","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.486489100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"46.215.58.216.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36668","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.486504200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"46.215.58.216.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36669","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487727400Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"196.198.58.216.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36670","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487813500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"46.215.58.216.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36671","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487857700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"46.215.58.216.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36672","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487908500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"196.198.58.216.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36673","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487930800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"46.215.58.216.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36674","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487950000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"196.198.58.216.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36675","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.487976300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"196.198.58.216.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36676","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.488015600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"46.215.58.216.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36677","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.488135200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"196.198.58.216.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36678","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.488187900Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"196.198.58.216.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36679","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.572408200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"196.198.58.216.in-addr.arpa.","QueryResults":"type:  12 par10s27-in-f196.1e100.net;type:  12 par10s27-in-f4.1e100.net;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36680","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.572643400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"196.198.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 par10s27-in-f196.1e100.net;type:  12 par10s27-in-f4.1e100.net;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36681","Execution":{"ProcessID":"6732","ThreadID":"6076"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.572727300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"46.215.58.216.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36682","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.658721400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"46.215.58.216.in-addr.arpa.","QueryResults":"type:  12 par21s17-in-f14.1e100.net;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36683","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.658885200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"46.215.58.216.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 par21s17-in-f14.1e100.net;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36684","Execution":{"ProcessID":"6732","ThreadID":"2548"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.659195800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"amazon.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36685","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.659735700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36686","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.659754900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"amazon.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36687","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.659909700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"amazon.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36688","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.662216200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"amazon.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36689","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.662233600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36690","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.662614300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36691","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.662645500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36692","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.662680300Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"amazon.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36693","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.663435800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36694","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.663541100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"amazon.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36695","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.663600000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"amazon.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36696","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.767458900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"amazon.com","QueryResults":"176.32.98.166;176.32.103.205;205.251.242.103;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36697","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.767695900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"amazon.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36698","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.767716000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36699","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.768301900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"amazon.com","QueryOptions":"1073897472","QueryResults":"::ffff:176.32.98.166;::ffff:176.32.103.205;::ffff:205.251.242.103;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36700","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.768643200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"216.58.215.46","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52246","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:57.340"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5682","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.622481800Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"par10s27-in-f196.1e100.net","DestinationIp":"216.58.198.196","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52247","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:57.662"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5683","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:21.872838100Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"www.amazon.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36701","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.389270500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.amazon.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36702","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.389291000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"www.amazon.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36703","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.389344500Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"www.amazon.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36704","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.392019700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"www.amazon.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36705","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.392091600Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.amazon.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36706","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.392634600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"www.amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36707","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.392684600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"www.amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36708","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.392738600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"www.amazon.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36709","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.393593500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"www.amazon.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36710","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.393701100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"www.amazon.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36711","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.393779200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"www.amazon.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36712","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.416080800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"www.amazon.com","QueryResults":"type:  5 www.cdn.amazon.com;type:  5 www.amazon.com.edgekey.net;type:  5 e15316.ci.akamaiedge.net;23.206.30.120;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36713","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.416204400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"www.amazon.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36714","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.416214200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.amazon.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36715","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.416527900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"www.amazon.com","QueryOptions":"1073897472","QueryResults":"type:  5 www.cdn.amazon.com;type:  5 www.amazon.com.edgekey.net;type:  5 e15316.ci.akamaiedge.net;::ffff:23.206.30.120;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36716","Execution":{"ProcessID":"4608","ThreadID":"5328"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.416786300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"205.103.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36717","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.497218200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"166.98.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36718","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.497358800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"205.103.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36719","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.500673400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"205.103.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36720","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.500706400Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"166.98.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36721","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.500726000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"166.98.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36722","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.500755900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"166.98.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36723","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.502129000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"205.103.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36724","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.502150800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"166.98.32.176.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36725","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.502187400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"205.103.32.176.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36726","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.502206200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"166.98.32.176.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36727","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.502255700Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"205.103.32.176.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36728","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.502264600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"166.98.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36729","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503448000Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"205.103.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36730","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503532800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"166.98.32.176.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36731","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503611800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"205.103.32.176.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36732","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503645700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"166.98.32.176.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36733","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503666700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"205.103.32.176.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36734","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503691200Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"166.98.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36735","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503713500Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"205.103.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36736","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503730000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"166.98.32.176.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36737","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503923700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"205.103.32.176.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36738","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.503935800Z"},"Version":"0"}}}
{"Event":{"EventData":{"Address":"02000035D043DEDE0000000000000000","AddressLength":"16","QueryName":"205.103.32.176.in-addr.arpa"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1016","EventRecordID":"36739","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"1016","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.594359500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"205.103.32.176.in-addr.arpa","QueryType":"12","ResponseStatus":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36740","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.594388100Z"},"Version":"0"}}}
{"Event":{"EventData":{"Address":"02000035D043DEDE0000000000000000","AddressLength":"16","QueryName":"166.98.32.176.in-addr.arpa"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"1016","EventRecordID":"36741","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"1016","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595300200Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"166.98.32.176.in-addr.arpa","QueryType":"12","ResponseStatus":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36742","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595325200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"166.98.32.176.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36743","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595513000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"205.103.32.176.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"9003"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36744","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595525100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","InterfaceCount":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"166.98.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36745","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595572800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","InterfaceCount":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"205.103.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36746","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595583100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"166.98.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3014","EventRecordID":"36747","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.595973100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"205.103.32.176.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3014","EventRecordID":"36748","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.596013700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"166.98.32.176.in-addr.arpa.","QueryResults":"","Status":"121"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36749","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.596116300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"205.103.32.176.in-addr.arpa.","QueryResults":"","Status":"121"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36750","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.596136000Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"205.103.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryStatus":"9003","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36751","Execution":{"ProcessID":"6732","ThreadID":"484"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.596243500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"166.98.32.176.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryStatus":"9003","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36752","Execution":{"ProcessID":"6732","ThreadID":"4140"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.596252000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"github.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36753","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.980693400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36754","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.980700600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"github.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36755","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.980858100Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"github.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36756","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.983190100Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"github.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36757","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.983200800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36758","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.983430600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"github.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36759","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.983448900Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"github.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36760","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.983469000Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"github.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36761","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.983848700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"github.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36762","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.984180700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"github.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36763","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.984196300Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"github.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36764","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.123690700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"github.com","QueryResults":"192.30.253.112;192.30.253.113;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36765","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.123928500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"github.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36766","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.123958400Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36767","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.124763800Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1073897472","QueryResults":"::ffff:192.30.253.112;::ffff:192.30.253.113;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36768","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.125807600Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"176.32.103.205","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52248","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:58.459"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5684","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.638352800Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"","DestinationIp":"176.32.98.166","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52249","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:58.893"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5685","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:22.902446700Z"},"Version":"5"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"120.30.206.23.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36769","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.502595700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"112.253.30.192.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36770","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.503209700Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"120.30.206.23.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36771","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.505518900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"120.30.206.23.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36772","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.505543000Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"112.253.30.192.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36773","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.505560000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"112.253.30.192.in-addr.arpa.","QueryOptions":"1073872896","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36774","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.505578300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"112.253.30.192.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36775","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.506431900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"112.253.30.192.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36776","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.506474300Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"120.30.206.23.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"","QueryType":"12","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36777","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.506501500Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"112.253.30.192.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36778","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.506521200Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"120.30.206.23.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36779","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.506532800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"120.30.206.23.in-addr.arpa","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36780","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.506569800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"120.30.206.23.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36781","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507279800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"112.253.30.192.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36782","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507337800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"120.30.206.23.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36783","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507362800Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"120.30.206.23.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36784","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507398000Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"112.253.30.192.in-addr.arpa.","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36785","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507411800Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"120.30.206.23.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36786","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507428300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"112.253.30.192.in-addr.arpa.","QueryResults":"","QueryType":"12","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36787","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507442600Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","InterfaceCount":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"0","QueryName":"112.253.30.192.in-addr.arpa."},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3012","EventRecordID":"36788","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507472100Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"120.30.206.23.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36789","Execution":{"ProcessID":"6732","ThreadID":"2740"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507559500Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"112.253.30.192.in-addr.arpa.","QueryResults":"","Status":"123"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3013","EventRecordID":"36790","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.507574300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"github.com","QueryOptions":"1073766400","QueryType":"1","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36791","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.541835700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1073766400","QueryResults":"","QueryStatus":"87","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36792","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.541859300Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","IsAsyncQuery":"0","IsNetworkQuery":"0","NetworkQueryIndex":"0","QueryName":"github.com","QueryOptions":"1073897472","QueryType":"28","ServerList":""},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3006","EventRecordID":"36793","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.541929000Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Ethernet","DNSServerAddress":"208.67.222.222;208.67.220.220;","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"fe80::7130:3f5e:d14f:943e;10.0.2.15;","NetworkIndex":"0","QueryName":"github.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36794","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.545896400Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"github.com","QueryOptions":"1073897472","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36795","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.545914200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1073897472","QueryResults":"","QueryType":"1","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36796","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.546276600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"github.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36797","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.546310900Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"github.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3010","EventRecordID":"36798","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.546331400Z"},"Version":"0"}}}
{"Event":{"EventData":{"AdapterName":"Teredo Tunneling Pseudo-Interface","DNSServerAddress":"","InterfaceCount":"1","IsParallelNetworkQuery":"1","LocalAddress":"2001:0:9d38:90d7:4a:6d2f:ccf0:86f0;fe80::4a:6d2f:ccf0:86f0;","NetworkIndex":"1","QueryName":"github.com"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3009","EventRecordID":"36799","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.547309600Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"1","QueryName":"github.com","QueryType":"1"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3019","EventRecordID":"36800","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.547414500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"1","NetworkIndex":"0","QueryName":"github.com","QueryResults":"","QueryType":"1","Status":"1460"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36801","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.547443100Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"112.253.30.192.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36802","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.643297900Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"112.253.30.192.in-addr.arpa.","QueryResults":"type:  12 lb-192-30-253-112-iad.github.com;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36803","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.643438900Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"112.253.30.192.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 lb-192-30-253-112-iad.github.com;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36804","Execution":{"ProcessID":"6732","ThreadID":"6184"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.643481800Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"120.30.206.23.in-addr.arpa","QueryType":"12","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36805","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.649362700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"120.30.206.23.in-addr.arpa.","QueryResults":"type:  12 a23-206-30-120.deploy.static.akamaitechnologies.com;","QueryType":"12","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36806","Execution":{"ProcessID":"6732","ThreadID":"6200"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.649470200Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"120.30.206.23.in-addr.arpa.","QueryOptions":"1073872896","QueryResults":"type:  12 a23-206-30-120.deploy.static.akamaitechnologies.com;","QueryStatus":"0","QueryType":"12"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36807","Execution":{"ProcessID":"6732","ThreadID":"1324"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-18"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.649567900Z"},"Version":"0"}}}
{"Event":{"EventData":{"DnsServerIpAddress":"208.67.222.222","QueryName":"github.com","QueryType":"1","ResponseStatus":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3011","EventRecordID":"36808","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.671768700Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","NetworkIndex":"0","QueryName":"github.com","QueryResults":"192.30.253.112;192.30.253.113;","QueryType":"1","Status":"0"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3020","EventRecordID":"36809","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.671956500Z"},"Version":"0"}}}
{"Event":{"EventData":{"InterfaceIndex":"0","QueryName":"github.com","QueryOptions":"1074421760","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3016","EventRecordID":"36810","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.671967700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1074421760","QueryResults":"","QueryType":"28","Status":"9701"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3018","EventRecordID":"36811","Execution":{"ProcessID":"4608","ThreadID":"6876"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.672398700Z"},"Version":"0"}}}
{"Event":{"EventData":{"QueryName":"github.com","QueryOptions":"1073897472","QueryResults":"::ffff:192.30.253.112;::ffff:192.30.253.113;","QueryStatus":"0","QueryType":"28"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-DNS-Client/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3008","EventRecordID":"36812","Execution":{"ProcessID":"4608","ThreadID":"3352"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}","Name":"Microsoft-Windows-DNS-Client"},"Security":{"UserID":"S-1-5-21-4228426178-1801199070-633696311-1001"},"Task":"0","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.672583000Z"},"Version":"0"}}}
{"Event":{"EventData":{"DestinationHostname":"a23-206-30-120.deploy.static.akamaitechnologies.com","DestinationIp":"23.206.30.120","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52250","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:02:59.459"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5686","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:23.669366100Z"},"Version":"5"}}}
{"Event":{"EventData":{"Image":"\\\\vboxsvr\\test\\test-dns.exe","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","UtcTime":"2018-06-15 13:34:24.402"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"5","EventRecordID":"5687","Execution":{"ProcessID":"6732","ThreadID":"4824"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"5","TimeCreated":{"SystemTime":"2018-06-15T13:34:24.405458300Z"},"Version":"3"}}}
{"Event":{"EventData":{"DestinationHostname":"lb-192-30-253-112-iad.github.com","DestinationIp":"192.30.253.112","DestinationIsIpv6":"false","DestinationPort":"80","DestinationPortName":"http","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52251","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:03:00.315"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5688","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:24.449378500Z"},"Version":"5"}}}
{"Event":{"EventData":{"DestinationHostname":"lb-192-30-253-112-iad.github.com","DestinationIp":"192.30.253.112","DestinationIsIpv6":"false","DestinationPort":"443","DestinationPortName":"https","Image":"\\\\vboxsvr\\test\\test-dns.exe","Initiated":"true","ProcessGuid":"{B2796A13-C058-5B23-0000-001088871B02}","ProcessId":"4608","Protocol":"tcp","SourceHostname":"DESKTOP-5SUA567.lan","SourceIp":"10.0.2.15","SourceIsIpv6":"false","SourcePort":"52252","SourcePortName":"","User":"DESKTOP-5SUA567\\Gen Eric","UtcTime":"2018-05-23 06:03:00.859"},"GeneInfo":{"Criticality":0,"Signature":["All"]},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-5SUA567","Correlation":{},"EventID":"3","EventRecordID":"5689","Execution":{"ProcessID":"6732","ThreadID":"5980"},"Keywords":"0x8000000000000000","Level":"4","Opcode":"0","Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"Security":{"UserID":"S-1-5-18"},"Task":"3","TimeCreated":{"SystemTime":"2018-06-15T13:34:24.965743400Z"},"Version":"5"}}}

```

`api/client/api_client.go`:

```go
package client

import (
	"bytes"
	"compress/gzip"
	"encoding/json"
	"errors"
	"fmt"
	"io"
	"io/ioutil"
	"net"
	"net/http"
	"os"
	"strings"
	"time"

	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/golang-utils/fsutil"
	aconfig "github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/agent/sysinfo"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client/config"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils"
)

const (
	// UserAgent used by the client
	UserAgent = "Whids-API-Client/1.0"
	// Mega byte size
	Mega = 1 << 20
)

var (
	// Hostname the client is running on (initialized in init() function)
	Hostname string

	ErrNothingToDo              = errors.New("nothing to do")
	ErrServerUnauthenticated    = errors.New("server authentication failed")
	ErrUnexpectedNilResponse    = errors.New("unexpected nil response")
	ErrUnexpectedResponseStatus = errors.New("unexpected response status code")
	ErrNoSysmonConfig           = errors.New("no sysmon config available in manager")
	ErrNoAgentConfig            = errors.New("no sysmon config available in manager")
)

func init() {
	var err error
	Hostname, err = os.Hostname()
	if err != nil {
		id := data.Md5([]byte(time.Now().Format(time.RFC3339Nano)))
		Hostname = fmt.Sprintf("HOST-%s", id)
	}
}

func ValidateResponse(resp *http.Response, status ...int) error {
	if resp == nil {
		return ErrUnexpectedNilResponse
	}

	for _, s := range status {
		if resp.StatusCode == s {
			return nil
		}
	}

	return fmt.Errorf("%w %d: %s", ErrUnexpectedResponseStatus, resp.StatusCode, respBodyToString(resp))
}

// ManagerClient structure definition
type ManagerClient struct {
	Config *config.Client

	ManagerIP  net.IP
	HTTPClient http.Client
}

// NewManagerClient creates a new Client to interface with the manager
func NewManagerClient(c *config.Client) (*ManagerClient, error) {

	tpt := c.Transport()

	mc := &ManagerClient{
		Config:     c,
		ManagerIP:  c.ManagerIP(),
		HTTPClient: http.Client{Transport: tpt},
	}

	// host
	if mc.Config.Host == "" {
		return nil, fmt.Errorf("field \"host\" is missing from configuration")
	}
	// protocol
	if mc.Config.Proto == "" {
		mc.Config.Proto = "https"
	}

	switch mc.Config.Proto {
	case "http", "https":
	default:
		return nil, fmt.Errorf("protocol not supported (only http(s))")
	}

	// key
	if mc.Config.Key == "" {
		return nil, fmt.Errorf("field \"key\" is missing from configuration")
	}

	return mc, nil
}

// Prepare prepares a http.Request to be sent to the manager
func (m *ManagerClient) Prepare(method, url string, body io.Reader) (r *http.Request, err error) {
	if r, err = http.NewRequest(method, m.buildURI(url), body); err != nil {
		return
	}

	r.Header.Add("User-Agent", UserAgent)
	r.Header.Add(api.EndpointHostnameHeader, Hostname)
	// the address used by the client to connect to the manager
	r.Header.Add(api.EndpointIPHeader, m.Config.LocalAddr())
	r.Header.Add(api.EndpointUUIDHeader, m.Config.UUID)
	r.Header.Add(api.AuthKeyHeader, m.Config.Key)

	return
}

func (m *ManagerClient) PrepareAndDo(method, url string, body io.Reader) (resp *http.Response, err error) {
	var req *http.Request

	if req, err = m.Prepare(method, url, body); err != nil {
		return
	}

	return m.HTTPClient.Do(req)
}

func (m *ManagerClient) PrepareAndDoGzip(method, url string, body io.Reader) (resp *http.Response, err error) {
	var req *http.Request

	if req, err = m.PrepareGzip(method, url, body); err != nil {
		return
	}

	return m.HTTPClient.Do(req)
}

// PrepareGzip prepares a http.Request gzip encoded to be sent to the manager
func (m *ManagerClient) PrepareGzip(method, url string, body io.Reader) (*http.Request, error) {
	// Prepare gzip content
	compBody := new(bytes.Buffer)
	w := gzip.NewWriter(compBody)
	b, err := ioutil.ReadAll(body)
	if err != nil {
		return nil, fmt.Errorf("PostLogs failed to prepare body")
	}
	w.Write(b)
	w.Close()

	r, err := m.Prepare(method, url, bytes.NewBuffer(compBody.Bytes()))

	// setting header
	r.Header.Add("Content-Encoding", "gzip")

	return r, err
}

// IsServerAuthEnforced returns true if server authentication is requested by the client
func (m *ManagerClient) IsServerAuthEnforced() bool {
	return m.Config.ServerKey != ""
}

// IsServerUp returns true if manager server is up
func (m *ManagerClient) IsServerUp() (up bool) {
	var err error
	var resp *http.Response

	if resp, err = m.PrepareAndDo("GET", api.EptAPIServerKeyPath, nil); err != nil {
		return
	}

	defer resp.Body.Close()
	return ValidateResponse(resp, http.StatusOK) == nil
}

// AuthenticateServer returns nil if server is authenticated (or if server authentication is not enforced)
// otherwise it returns ErrServerUnauthenticated
func (m *ManagerClient) AuthenticateServer() (err error) {
	var resp *http.Response

	if !m.IsServerAuthEnforced() {
		return
	}

	if resp, err = m.PrepareAndDo("GET", api.EptAPIServerKeyPath, nil); err != nil {
		return fmt.Errorf("%w, %s", ErrServerUnauthenticated, err)
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return fmt.Errorf("%w, %s", ErrServerUnauthenticated, err)
	}

	if resp == nil {
		return fmt.Errorf("%w, received empty response from server", ErrServerUnauthenticated)
	}

	key := respBodyToString(resp)
	if key != m.Config.ServerKey {
		return fmt.Errorf("%w, keys are not matching", ErrServerUnauthenticated)
	}

	return
}

func (m *ManagerClient) buildURI(url string) string {
	url = strings.Trim(url, "/")
	network := m.Config.Host
	if m.Config.Port != 0 {
		network = fmt.Sprintf("%s:%d", network, m.Config.Port)
	}
	return fmt.Sprintf("%s://%s/%s", m.Config.Proto, network, url)
}

// GetRulesSha256 returns the sha256 string of the latest batch of rules available on the server
func (m *ManagerClient) GetRulesSha256() (string, error) {

	if err := m.AuthenticateServer(); err != nil {
		return "", err
	}

	resp, err := m.PrepareAndDo("GET", api.EptAPIRulesSha256Path, nil)
	if err != nil {
		return "", fmt.Errorf("failed to issue HTTP request: %s", err)
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return "", err
	}

	return respBodyAsString(resp)
}

// GetIoCs get IoCs from manager
func (m *ManagerClient) GetIoCs() (iocs []string, err error) {
	var resp *http.Response

	iocs = make([]string, 0)

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if resp, err = m.PrepareAndDo("GET", api.EptAPIIoCsPath, nil); err != nil {
		return
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	dec := json.NewDecoder(resp.Body)
	if err = dec.Decode(&iocs); err != nil {
		return
	}

	return
}

// GetIoCsSha256 retrieves a sha256 from the IoCs available in the manager
func (m *ManagerClient) GetIoCsSha256() (sha string, err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if resp, err = m.PrepareAndDo("GET", api.EptAPIIoCsSha256Path, nil); err != nil {
		return
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return respBodyAsString(resp)
}

// GetRules retrieve the latest batch of Gene rules available on the server
func (m *ManagerClient) GetRules() (rules string, err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if resp, err = m.PrepareAndDo("GET", api.EptAPIRulesPath, nil); err != nil {
		return
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return respBodyAsString(resp)
}

func (m *ManagerClient) IsFileAboveUploadLimit(path string) bool {
	if fsutil.IsFile(path) {
		stats, err := os.Stat(path)
		if err == nil {
			return stats.Size() > m.Config.MaxUploadSize
		}
	}
	return true
}

// PostDump client helper to upload a file to the Manager
func (m *ManagerClient) PostDump(f *FileUpload) (err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	buf := new(bytes.Buffer)
	enc := json.NewEncoder(buf)

	if err = enc.Encode(f); err != nil {
		return err
	}

	if resp, err = m.PrepareAndDo("POST", api.EptAPIPostDumpPath, buf); err != nil {
		return
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return
}

// PostLogs posts logs to be collected
func (m *ManagerClient) PostLogs(r io.Reader) (err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if resp, err = m.PrepareAndDoGzip("POST", api.EptAPIPostLogsPath, r); err != nil {
		return
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return
}

var ()

func (m *ManagerClient) PostCommand(command *api.EndpointCommand) (err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	// stripping unecessary content to send back the command
	command.Strip()

	// command should now contain stdout and stderr
	jsonCommand, err := json.Marshal(command)
	if err != nil {
		return fmt.Errorf("PostCommand failed to marshal command")
	}

	// send back the response
	if resp, err = m.PrepareAndDoGzip("POST", api.EptAPICommandPath, bytes.NewBuffer(jsonCommand)); err != nil {
		return
	}

	defer resp.Body.Close()
	if ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return nil

}

func (m *ManagerClient) FetchCommand() (command *api.EndpointCommand, err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	// getting command to be executed
	if resp, err = m.PrepareAndDo("GET", api.EptAPICommandPath, nil); err != nil {
		return
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusNoContent, http.StatusOK); err != nil {
		return
	}

	// if there is no command to execute, the server replies with this status code
	if resp.StatusCode == http.StatusNoContent {
		err = ErrNothingToDo
		return
	}

	dec := json.NewDecoder(resp.Body)
	// unmarshal command to be executed
	if err = dec.Decode(&command); err != nil {
		return
	}

	if command != nil {
		command.Runnable()
	}

	return
}

func (m *ManagerClient) PostSystemInfo(info *sysinfo.SystemInfo) (err error) {
	var resp *http.Response
	var data []byte

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if data, err = json.Marshal(info); err != nil {
		return
	}

	if resp, err = m.PrepareAndDoGzip("POST", api.EptAPIPostSystemInfo, bytes.NewBuffer(data)); err != nil {
		return err
	}

	defer resp.Body.Close()
	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return
}

func (m *ManagerClient) GetSysmonConfigSha256(schemaVersion string) (sha256 string, err error) {
	var req *http.Request
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if req, err = m.Prepare("GET", api.EptAPISysmonConfigSha256Path, nil); err != nil {
		return
	}

	requestAddURLParam(req, api.QpOS, los.OS)
	requestAddURLParam(req, api.QpVersion, schemaVersion)

	if resp, err = m.HTTPClient.Do(req); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK, http.StatusNoContent); err == nil {
		if resp.StatusCode == http.StatusNoContent {
			err = ErrNoSysmonConfig
			return
		}
		sha256, err = respBodyAsString(resp)
	}

	return
}

func (m *ManagerClient) GetSysmonConfig(schemaVersion string) (c *sysmon.Config, err error) {
	var req *http.Request
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if req, err = m.Prepare("GET", api.EptAPISysmonConfigPath, nil); err != nil {
		return
	}

	requestAddURLParam(req, api.QpOS, los.OS)
	requestAddURLParam(req, api.QpVersion, schemaVersion)

	if resp, err = m.HTTPClient.Do(req); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK, http.StatusNoContent); err == nil {
		if resp.StatusCode == http.StatusNoContent {
			err = ErrNoSysmonConfig
			return
		}
		dec := json.NewDecoder(resp.Body)
		err = dec.Decode(&c)
	}

	return
}

func (m *ManagerClient) GetAgentConfigSha256() (sha256 string, err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if resp, err = m.PrepareAndDo("GET", api.EptAPIConfigSha256Path, nil); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK, http.StatusNoContent); err == nil {
		if resp.StatusCode == http.StatusNoContent {
			err = ErrNoAgentConfig
			return
		}
		sha256 = respBodyToString(resp)
	}

	return
}

func (m *ManagerClient) GetAgentConfig() (config *aconfig.Agent, err error) {
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if resp, err = m.PrepareAndDo("GET", api.EptAPIConfigPath, nil); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK, http.StatusNoContent); err == nil {
		if resp.StatusCode == http.StatusNoContent {
			err = ErrNoAgentConfig
			return
		}
		// decoding configuration
		dec := json.NewDecoder(resp.Body)
		err = dec.Decode(&config)
	}

	return
}

func (m *ManagerClient) PostAgentConfig(c *aconfig.Agent) (err error) {
	var b []byte
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if b, err = utils.Json(c); err != nil {
		return
	}

	if resp, err = m.PrepareAndDoGzip("POST", api.EptAPIConfigPath, bytes.NewBuffer(b)); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK); err != nil {
		return
	}

	return
}

func (m *ManagerClient) ListTools() (t map[string]*tools.Tool, err error) {
	var req *http.Request
	var resp *http.Response

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if req, err = m.Prepare("GET", api.EptAPITools, nil); err != nil {
		return
	}

	requestAddURLParam(req, api.QpOS, los.OS)

	if resp, err = m.HTTPClient.Do(req); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK); err == nil {
		dec := json.NewDecoder(resp.Body)
		err = dec.Decode(&t)
	}

	return
}

func (m *ManagerClient) GetTool(hash string) (t *tools.Tool, err error) {
	var req *http.Request
	var resp *http.Response
	var tools map[string]*tools.Tool

	if err = m.AuthenticateServer(); err != nil {
		return
	}

	if req, err = m.Prepare("GET", api.EptAPITools, nil); err != nil {
		return
	}

	requestAddURLParam(req, api.QpOS, los.OS)
	requestAddURLParam(req, api.QpHash, hash)
	requestAddURLParam(req, api.QpBinary, "true")

	if resp, err = m.HTTPClient.Do(req); err != nil {
		return
	}

	defer resp.Body.Close()

	if err = ValidateResponse(resp, http.StatusOK); err == nil {
		dec := json.NewDecoder(resp.Body)
		err = dec.Decode(&tools)
		if len(tools) > 0 {
			for _, tool := range tools {
				t = tool
				break
			}

		}
	}

	return
}

// Close closes idle connections from underlying transport
func (m *ManagerClient) Close() {
	m.HTTPClient.CloseIdleConnections()
}

```

`api/client/config/client.go`:

```go
package config

import (
	"context"
	"crypto/tls"
	"crypto/x509"
	"fmt"
	"net"
	"net/http"
	"time"

	"github.com/0xrawsec/golang-utils/crypto/data"
)

// Client structure definition
type Client struct {
	Proto             string `json:"proto" toml:"proto" comment:"Protocol to use to connect to manager (http or https)"`
	Host              string `json:"host" toml:"host" comment:"Hostname or IP of the manager"`
	Port              int    `json:"port" toml:"port" comment:"Port at which endpoint API is running on manager server"`
	UUID              string `json:"endpoint-uuid" toml:"endpoint-uuid" comment:"Endpoint UUID configured on manager used to authenticate this endpoint"`
	Key               string `json:"endpoint-key" toml:"endpoint-key" comment:"Endpoint key configured on manager used to authenticate this endpoint"`
	ServerKey         string `json:"server-key" toml:"server-key" comment:"Key configured on manager, used to authenticate server on this endpoint\n This settings does not protect from MITM, so configuring server\n certificate pinning is recommended."`
	ServerFingerprint string `json:"server-fingerprint" toml:"server-fingerprint" comment:"Configure manager certificate pinning\n Put here the manager's certificate fingerprint"`
	Unsafe            bool   `json:"unsafe" toml:"unsafe" comment:"Allow unsafe HTTPS connection"`
	MaxUploadSize     int64  `json:"max-upload-size" toml:"max-upload-size" comment:"Maximum allowed upload size"`

	localAddr string
}

func (c *Client) HasConnectionSettings() bool {
	return c.Proto != "" && c.Host != "" && c.UUID != "" && c.Key != ""
}

// ManagerIP returns the IP address of the manager if any, returns nil otherwise
func (c *Client) ManagerIP() net.IP {
	if ip := net.ParseIP(c.Host); ip != nil {
		return ip
	}

	if ips, err := net.LookupIP(c.Host); err == nil {
		return ips[0]
	}

	return nil
}

func (c *Client) DialContext(ctx context.Context, network, addr string) (con net.Conn, err error) {
	dialer := net.Dialer{
		Timeout:   30 * time.Second,
		KeepAlive: 30 * time.Second,
		DualStack: true,
	}
	con, err = dialer.DialContext(ctx, network, addr)

	if err == nil && con != nil {
		if addr, ok := con.LocalAddr().(*net.TCPAddr); ok {
			c.localAddr = addr.IP.String()
		}
	}

	return
}

func (c *Client) DialTLSContext(ctx context.Context, network, addr string) (net.Conn, error) {
	con, err := tls.Dial(network, addr, &tls.Config{InsecureSkipVerify: c.Unsafe})

	if err != nil {
		return con, err
	}

	if con != nil {
		if addr, ok := con.LocalAddr().(*net.TCPAddr); ok {
			c.localAddr = addr.IP.String()
		}
	}

	if c.ServerFingerprint == "" {
		return con, err
	}

	connstate := con.ConnectionState()
	for _, peercert := range connstate.PeerCertificates {
		der, err := x509.MarshalPKIXPublicKey(peercert.PublicKey)
		hash := data.Sha256(der)
		if err != nil {
			return con, err
		}

		if hash == c.ServerFingerprint {
			return con, err
		}
	}
	return con, fmt.Errorf("server fingerprint not verified")
}

// Transport creates an approriate HTTP transport from a configuration
// Cert pinning inspired by: https://medium.com/@zmanian/server-public-key-pinning-in-go-7a57bbe39438
func (c *Client) Transport() http.RoundTripper {
	return &http.Transport{
		Proxy:                 nil,
		DialContext:           c.DialContext,
		DialTLSContext:        c.DialTLSContext,
		MaxIdleConns:          100,
		IdleConnTimeout:       90 * time.Second,
		TLSHandshakeTimeout:   10 * time.Second,
		ExpectContinueTimeout: 1 * time.Second,
	}
}

func (c *Client) LocalAddr() string {
	return c.localAddr
}

```

`api/client/config/forwarder.go`:

```go
package config

import (
	"time"
)

// ForwarderLogging structure to encode Logging configuration of the forwarder
type ForwarderLogging struct {
	Dir              string        `json:"dir,omitempty" toml:"dir" comment:"Directory used to store logs"`
	RotationInterval time.Duration `json:"rotation-interval,omitempty" toml:"rotation-interval" comment:"Logfile rotation interval"`
}

// Forwarder config structure definition
type Forwarder struct {
	Local   bool             `json:"local,omitempty" toml:"local" comment:"If forwarder is local (this setting equals true)\n neither alerts nor dumps will be forwarded to manager"`
	Client  Client           `json:"manager,omitempty" toml:"manager" comment:"Configure connection to the manager"`
	Logging ForwarderLogging `json:"logging,omitempty" toml:"logging" comment:"Forwarder's logging configuration"`
}

```

`api/client/forwarder.go`:

```go
package client

import (
	"bytes"
	"compress/gzip"
	"context"
	"fmt"
	"os"
	"path/filepath"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/golang-utils/fileutils"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
	"github.com/0xrawsec/golang-utils/fsutil/logfile"
	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/whids/api/client/config"
	"github.com/0xrawsec/whids/utils"
)

const (
	// DefaultLogfileSize default forwarder logfile size
	DefaultLogfileSize = logfile.MB * 5
	// DiskSpaceThreshold allow 1GB of queued events
	DiskSpaceThreshold = logfile.GB
	// MinRotationInterval is the minimum rotation interval allowed
	MinRotationInterval = time.Minute
)

// Forwarder structure definition
type Forwarder struct {
	sync.Mutex
	sync.WaitGroup
	ctx       context.Context
	cancel    context.CancelFunc
	fwdConfig *config.Forwarder
	logfile   logfile.LogFile

	Logger      *golog.Logger
	Client      *ManagerClient
	TimeTresh   time.Duration
	Sleep       time.Duration
	EventTresh  uint64
	Pipe        *bytes.Buffer
	EventsPiped uint64
	Local       bool
}

// NewForwarder creates a new Forwarder structure
// Todo: needs update with client
func NewForwarder(ctx context.Context, c *config.Forwarder, l *golog.Logger) (*Forwarder, error) {
	var err error

	cctx, cancel := context.WithCancel(ctx)

	// Initialize the Forwarder
	co := Forwarder{
		ctx:       cctx,
		cancel:    cancel,
		fwdConfig: c,
		Logger:    l,
		TimeTresh: time.Second * 10,
		Sleep:     time.Second,
		// Writing events too quickly has a perf impact
		EventTresh: 500,
		Pipe:       new(bytes.Buffer),
		Local:      c.Local,
	}

	if !co.Local {
		if co.Client, err = NewManagerClient(&c.Client); err != nil {
			return nil, fmt.Errorf("field to initialize manager client: %s", err)
		}
	}

	// queue directory
	if c.Logging.Dir == "" {
		return nil, fmt.Errorf("field \"logs-dir\" is missing from configuration")
	}

	// creating the queue directory
	if !fsutil.Exists(c.Logging.Dir) && !fsutil.IsDir(c.Logging.Dir) {
		// TOCTU may happen here so we double check error code
		if err = os.Mkdir(c.Logging.Dir, utils.DefaultFilePerm); err != nil && !os.IsExist(err) {
			return nil, fmt.Errorf("cannot create queue directory : %s", err)
		}
	}

	return &co, nil
}

// LogfilePath returns the path of the logfile if it exists else returns empty string
func (f *Forwarder) LogfilePath() string {
	if f.logfile != nil {
		return f.logfile.Path()
	}
	return ""
}

// ArchiveLogs archives the old log files not compressed into compressed
func (f *Forwarder) ArchiveLogs() {
	for wi := range fswalker.Walk(f.fwdConfig.Logging.Dir) {
		for _, fi := range wi.Files {
			// fullpath
			fp := filepath.Join(f.fwdConfig.Logging.Dir, fi.Name())
			f.Logger.Infof("Archiving old log: %s", fp)

			if !strings.HasSuffix(fp, ".gz") {
				if err := fileutils.GzipFile(fp); err != nil {
					f.Logger.Errorf("Failed to archive log: %s", err)
				}
			}
		}
	}
}

// PipeEvent pipes an event to be sent through the forwarder
func (f *Forwarder) PipeEvent(event interface{}) (err error) {
	var b []byte

	f.Lock()
	defer f.Unlock()

	if b, err = utils.Json(event); err != nil {
		return err
	}

	b = append(b, '\n')
	if _, err = f.Pipe.Write(b); err != nil {
		return
	}

	f.EventsPiped++

	return
}

// Save save the piped events to the disks
func (f *Forwarder) Save() (err error) {
	f.Logger.Debugf("Collector saved logs to be sent later on")

	// Clean queued files if needed
	if f.DiskSpaceQueue() > DiskSpaceThreshold {
		f.Logger.Infof("Disk space taken by queued events reached %dMB threshold, need cleanup",
			DiskSpaceThreshold/logfile.MB)
		if err := f.CleanOlderQueued(); err != nil {
			f.Logger.Errorf("Error attempting to remove older queue file: %s", err)
		}
	}

	if f.logfile == nil {
		// This will reopen the first available alerts.gz.X file if several
		//lf := filepath.Join(f.fwdConfig.LogConf.Dir, "alerts.gz")
		lf := filepath.Join(f.fwdConfig.Logging.Dir, "alerts.log")
		ri := f.fwdConfig.Logging.RotationInterval
		f.Logger.Infof("Rotating logfile every %s", ri)
		if f.logfile, err = logfile.OpenTimeRotateLogFile(lf, utils.DefaultFilePerm, ri); err != nil {
			return
		}
	}
	_, err = f.logfile.Write(f.Pipe.Bytes())
	return
}

// HasQueuedEvents checks whether some events are waiting to be sent
func (f *Forwarder) HasQueuedEvents() bool {
	for wi := range fswalker.Walk(f.fwdConfig.Logging.Dir) {
		if len(wi.Files) > 0 {
			return true
		}
	}
	return false
}

// CleanOlderQueued cleans up the older queue file
func (f *Forwarder) CleanOlderQueued() error {
	var older string
	var olderTime time.Time
	empty := time.Time{}
	for wi := range fswalker.Walk(f.fwdConfig.Logging.Dir) {
		for _, fi := range wi.Files {
			// initialization
			if olderTime == empty {
				olderTime = fi.ModTime()
				older = filepath.Join(f.fwdConfig.Logging.Dir, fi.Name())
				continue
			}
			// check if we have an older file
			if fi.ModTime().Before(olderTime) {
				olderTime = fi.ModTime()
				older = filepath.Join(f.fwdConfig.Logging.Dir, fi.Name())
			}
		}
	}
	absOlder, _ := filepath.Abs(older)
	absLogfile, _ := filepath.Abs(f.LogfilePath())
	// prevent from deleting the current file we are working on
	if absLogfile != absOlder {
		f.Logger.Infof("Attempt to delete older queue file to make more space: %s", absOlder)
		return os.Remove(absOlder)
	}
	return nil
}

// DiskSpaceQueue compute the disk space (in bytes) taken by queued events
func (f *Forwarder) DiskSpaceQueue() int64 {
	var dp int64
	for wi := range fswalker.Walk(f.fwdConfig.Logging.Dir) {
		for _, fi := range wi.Files {
			dp += fi.Size()
		}
	}
	return dp
}

// Here we rely on the fact that the layout of the directory is known
// and should be alert.log, alert.log.1, alert.log.2.gz, alert.log.3.gz ...
// if we append in reverse order, older files appears first in the list
func (f *Forwarder) listLogfiles() (files []string) {
	files = make([]string, 0)
	for wi := range fswalker.Walk(f.fwdConfig.Logging.Dir) {
		for _, fi := range wi.Files {
			fp := filepath.Join(f.fwdConfig.Logging.Dir, fi.Name())
			files = append([]string{fp}, files...)
		}
	}
	return
}

// ProcessQueue processes the events queued
func (f *Forwarder) ProcessQueue() {
	f.Lock()
	defer f.Unlock()

	// if it is a local collector no need to process
	if f.Local {
		return
	}

	// returns if Manager is not up, this prevents closing logfile
	// for nothing
	if !f.Client.IsServerUp() {
		return
	}

	f.Logger.Info("Processing queued files")

	if f.logfile != nil {
		f.logfile.Close()
	}

	// Reset logfile for latter Save function use
	f.logfile = nil
	for _, fp := range f.listLogfiles() {
		f.Logger.Infof("Processing queued file: %s", fp)
		fd, err := os.Open(fp)
		if err != nil {
			f.Logger.Errorf("Failed to open queued file (%s): %s", fp, err)
			continue
		}
		switch {
		case strings.HasSuffix(fp, ".gz"):
			var gzr *gzip.Reader
			// the file is gzip so we have to pass a gzip reader to prepCollectReq
			gzr, err = gzip.NewReader(fd)
			if err != nil {
				f.Logger.Errorf("Failed to create gzip reader for queued file (%s): %s", fp, err)
				// close file
				fd.Close()
				continue
			}
			err = f.Client.PostLogs(gzr)
			// we can close the reader since we don't need those anymore
			gzr.Close()
			fd.Close()
		case strings.HasSuffix(fp, ".log.1"), strings.HasSuffix(fp, ".log"):
			err = f.Client.PostLogs(fd)
			fd.Close()
		}

		// We do not remove the logs if we failed to send
		if err != nil {
			f.Logger.Errorf("%s", err)
			continue
		}

		// everything went fine, then we can delete the queued file
		f.Logger.Infof("Deleting queue file : %s", fp)
		if err = os.Remove(fp); err != nil {
			f.Logger.Errorf("Failed to delete queued file (%s): %s", fp, err)
		}
	}
}

// Reset resets the forwarder
func (f *Forwarder) Reset() {
	f.Pipe.Reset()
	f.EventsPiped = 0
}

// Collect sends the piped event to the remote server
func (f *Forwarder) Collect() {
	var err error

	// Locking collector for sending data
	f.Lock()
	// Unlocking collector after sending data
	defer f.Unlock()
	// Reset the collector
	defer f.Reset()

	// if not a local forwarder
	if !f.Local {
		if err = f.Client.PostLogs(bytes.NewBuffer(f.Pipe.Bytes())); err == nil {
			// no need to save logs on disk
			return
		}
		f.Logger.Errorf("%s", err)
	}

	// Save the events in queue directory
	if err = f.Save(); err != nil {
		f.Logger.Errorf("Failed to save events: %s", err)
	}
}

// Run starts the Forwarder worker function
func (f *Forwarder) Run() {
	f.Add(1)
	// Process Piped Events
	go func() {
		defer f.Done()

		timer := time.Now()
		for f.ctx.Err() == nil {
			// We have queued events so we try to send them before sending pending events
			// We check if server is up not to close the current logfile if not needed
			if f.HasQueuedEvents() {
				f.ProcessQueue()
			}

			// Sending piped events
			if f.EventsPiped >= f.EventTresh || time.Now().After(timer.Add(f.TimeTresh)) || f.Local {
				// Send out events if there are pending events
				if f.EventsPiped > 0 {
					f.Collect()
				}
				// reset timer
				timer = time.Now()
			}

			time.Sleep(f.Sleep)
		}
	}()
}

// Close closes the forwarder properly
func (f *Forwarder) Close() {

	// forwarder is already closed -> nothing to do
	if f.ctx.Err() != nil {
		return
	}

	// we cancel forwarder's context
	f.cancel()
	// we wait for forwarding routine to terminate
	f.Wait()

	// we collect last events if needed
	if f.EventsPiped > 0 {
		f.Collect()
	}

	// we close logfile
	if f.logfile != nil {
		f.logfile.Close()
	}

	// Close idle connections if not local
	if !f.Local {
		defer f.Client.Close()
	}
}

```

`api/client/upload.go`:

```go
package client

import (
	"fmt"
	"io"
	"io/fs"
	"os"
	"path/filepath"
	"regexp"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/whids/utils"
)

const ()

var (
	guidRe      = regexp.MustCompile(`(?i:\{[a-f0-9]{8}-([a-f0-9]{4}-){3}[a-f0-9]{12}\})`)
	eventHashRe = regexp.MustCompile(`(?i:[a-f0-9]{32,})`) // at least md5
	filenameRe  = regexp.MustCompile(`[\w\s\.-]+`)

	UploadShrinkerBufferSize = int64(3 * utils.Mega)
)

type UploadShrinker struct {
	name  string
	f     *os.File
	fu    *FileUpload
	buff  []byte
	chunk int
	total int
	size  int64
	err   error
}

// NewUploadShrinker creates a new object to shrink files to be uploaded to the manager
func NewUploadShrinker(path, guid, ehash string) (it *UploadShrinker, err error) {
	var fd *os.File
	var stat fs.FileInfo

	if fd, err = os.Open(path); err != nil {
		return
	}

	if stat, err = fd.Stat(); err != nil {
		return
	}

	size := stat.Size()
	total := int(size/UploadShrinkerBufferSize) + 1

	it = &UploadShrinker{
		name: filepath.Base(path),
		f:    fd,
		fu: &FileUpload{
			Name:      filepath.Base(path),
			GUID:      guid,
			EventHash: ehash,
			Total:     total,
		},
		buff:  make([]byte, UploadShrinkerBufferSize),
		chunk: 1,
		total: total,
		size:  size,
	}

	return
}

// Size returns the size of the file to be shrinked
func (i *UploadShrinker) Size() int64 {
	return i.size
}

// Next returns the next FileUpload or nil if finished
func (i *UploadShrinker) Next() *FileUpload {
	var n int
	var err error

	if i.Done() {
		return nil
	}

	if n, err = i.f.Read(i.buff); err != nil && err != io.EOF {
		i.err = err
		return nil
	}

	i.fu.Chunk = i.chunk
	i.fu.Content = i.buff[:n]
	i.chunk++

	return i.fu
}

// Done returns true when all files have been sent
func (i *UploadShrinker) Done() bool {
	return i.chunk > i.total
}

// Err report any error encountered while iterating over Next
func (i *UploadShrinker) Err() error {
	return i.err
}

// Close closes the underlying file
func (i *UploadShrinker) Close() error {
	return i.f.Close()
}

//////////////////////// FileUpload

// FileUpload structure used to forward files from the client to the manager
type FileUpload struct {
	Name      string `json:"filename"`
	GUID      string `json:"guid"`
	EventHash string `json:"event-hash"`
	Content   []byte `json:"content"`
	Chunk     int    `json:"chunk"` // identify the chunk number
	Total     int    `json:"total"` // total number of chunks needed to reconstruct the file
}

// Validate that the file upload follows the expected format
func (f *FileUpload) Validate() error {
	if !filenameRe.MatchString(f.Name) {
		return fmt.Errorf("bad filename")
	}
	if !guidRe.MatchString(f.GUID) {
		return fmt.Errorf("bad guid")
	}
	if !eventHashRe.MatchString(f.EventHash) {
		return fmt.Errorf("bad event hash")
	}
	return nil
}

// Implode returns the full path of the FileUpload
func (f *FileUpload) Implode() string {
	return filepath.Join(f.GUID, f.EventHash, f.Name)
}

// Dump dumps the FileUpload into the given root directory dir
func (f *FileUpload) Dump(root string) (err error) {
	// Return error if cannot dump file
	if err = f.Validate(); err != nil {
		return
	}

	dirpath := filepath.Join(root, f.GUID, f.EventHash)

	// Create directory if doesn't exist
	if !fsutil.IsDir(dirpath) {
		if err = os.MkdirAll(dirpath, utils.DefaultFilePerm); err != nil {
			return
		}
	}

	return f.write(root)
}

func (f *FileUpload) write(root string) (err error) {
	var out *os.File
	var content []byte

	path := filepath.Join(root, f.Implode())
	if f.Chunk < f.Total {
		return utils.HidsWriteData(fmt.Sprintf("%s.%d", path, f.Chunk), f.Content)
	} else {
		// special case where we have only one chunk
		if f.Total == 1 {
			return utils.HidsWriteData(path, f.Content)
		}

		// we reassemble chunks
		if out, err = utils.HidsCreateFile(path); err != nil {
			return
		}

		for i := 1; i < f.Total; i++ {
			chunkPath := fmt.Sprintf("%s.%d", path, i)
			if content, err = os.ReadFile(chunkPath); err != nil {
				return
			}

			if _, err = out.Write(content); err != nil {
				return
			}

			os.Remove(chunkPath)
		}

		if _, err = out.Write(f.Content); err != nil {
			return
		}

		return out.Close()
	}
}

```

`api/client/utlis.go`:

```go
package client

import (
	"io/ioutil"
	"net/http"
)

func requestAddURLParam(r *http.Request, key, value string) {
	q := r.URL.Query()
	q.Add(key, value)
	r.URL.RawQuery = q.Encode()
}

func respBodyToString(r *http.Response) string {
	defer r.Body.Close()
	if b, err := ioutil.ReadAll(r.Body); err != nil {
		return "failed to read response body"
	} else {
		return string(b)
	}
}

func respBodyAsString(r *http.Response) (s string, err error) {
	var b []byte
	defer r.Body.Close()
	if b, err = ioutil.ReadAll(r.Body); err != nil {
		return
	}
	return string(b), err
}

```

`api/command.go`:

```go
package api

import (
	"encoding/json"
	"errors"
	"fmt"
	"os"
	"os/exec"
	"path/filepath"
	"time"

	"github.com/0xrawsec/whids/utils"
	"github.com/0xrawsec/whids/utils/command"
	"github.com/google/shlex"
)

// EndpointFile describes a File to drop or fetch from the endpoint
type EndpointFile struct {
	UUID  string `json:"uuid"`
	Name  string `json:"name"`
	Data  []byte `json:"data"`
	Error string `json:"error"`
}

// EndpointCommand structure representing a command sent to an endpoint
type EndpointCommand struct {
	UUID string   `json:"uuid"`
	Name string   `json:"name"`
	Args []string `json:"args"`
	// used to drop files on the endpoint
	Drop []*EndpointFile `json:"drop"`
	// used to fetch files from the endpoint
	Fetch  map[string]*EndpointFile `json:"fetch"`
	Json   interface{}              `json:"json"`
	Stdout []byte                   `json:"stdout"`
	Stderr []byte                   `json:"stderr"`
	Error  string                   `json:"error"`
	//Error      error         `json:"error"`
	Sent       bool          `json:"sent"`
	Background bool          `json:"background"`
	Completed  bool          `json:"completed"`
	ExpectJSON bool          `json:"expect-json"`
	Timeout    time.Duration `json:"timeout"`
	SentTime   time.Time     `json:"sent-time"`

	runnable bool
}

// NewEndpointCommand creates a new Command to run on an endpoint
func NewEndpointCommand() *EndpointCommand {
	id := utils.UnsafeUUID()
	cmd := &EndpointCommand{
		UUID:     id.String(),
		Drop:     make([]*EndpointFile, 0),
		Fetch:    make(map[string]*EndpointFile),
		runnable: true}
	return cmd
}

// SetCommandLine sets the command line to execute on the endpoint
func (c *EndpointCommand) SetCommandLine(cl string) error {
	args, err := shlex.Split(cl)
	if err != nil {
		return fmt.Errorf("failed to parse command line: %w", err)
	}

	if len(args) > 0 {
		c.Name = args[0]
	}
	if len(args) > 1 {
		c.Args = args[1:]
	}
	return nil
}

// AddDropFile adds a file to drop on the endpoint. Argument filepath
// is the path of the file on the local filesystem
func (c *EndpointCommand) AddDropFile(filename, filepath string) error {
	var err error

	ef := EndpointFile{
		UUID: utils.UnsafeUUID().String(),
		Name: filename}
	if ef.Data, err = os.ReadFile(filepath); err != nil {
		return fmt.Errorf("failed at reading file to drop: %w", err)
	}

	c.Drop = append(c.Drop, &ef)

	return nil
}

// AddDropFileFromPath adds a file to drop on the endpoint. It
// is a wrapper around AddDropFile
func (c *EndpointCommand) AddDropFileFromPath(path string) error {
	return c.AddDropFile(filepath.Base(path), path)
}

// AddFetchFile adds a file to fetch from the endpoint.
func (c *EndpointCommand) AddFetchFile(filepath string) {
	c.Fetch[filepath] = &EndpointFile{UUID: utils.UnsafeUUID().String()}
}

func (c *EndpointCommand) FromExecCmd(cmd *exec.Cmd) {
	if cmd.Args != nil {
		if len(cmd.Args) > 0 {
			c.Name = cmd.Args[0]
			if len(cmd.Args) > 1 {
				c.Args = make([]string, len(cmd.Args[1:]))
				copy(c.Args, cmd.Args[1:])
			}
		} else {
			c.Name = cmd.Path
		}
	} else {
		c.Name = cmd.Path
	}
}

func (c *EndpointCommand) Runnable() {
	c.runnable = true
}

func (c *EndpointCommand) Unrunnable() {
	c.runnable = false
}

// Run runs the command according to the specified settings
// it aims at being used on the endpoint
func (c *EndpointCommand) Run() (err error) {
	// current working directory for command
	var cwd string
	var cmd *command.Cmd

	// if we want to execute a binary
	if len(c.Drop) > 0 {
		var tmpDir string

		if tmpDir, err = utils.HidsMkTmpDir(); err != nil {
			return fmt.Errorf("failed to create temporary directory: %w", err)
		}

		// dropping files before command is run so that we can used
		// dropped files as arguments to the command line
		for _, ef := range c.Drop {
			binPath := filepath.Join(tmpDir, ef.Name)
			err := os.WriteFile(binPath, ef.Data, 0700)
			if err != nil {
				ef.Error = fmt.Sprintf("%s", err)
			}
		}

		// current working directory is where we dropped files
		cwd = tmpDir

		// remove temporary directory after Run is finished
		defer os.RemoveAll(tmpDir)
	}

	// we have something to run
	if c.Name != "" && c.runnable {

		if c.Timeout > 0 {
			cmd = command.CommandTimeout(c.Timeout, c.Name, c.Args...)
		} else {
			cmd = command.Command(c.Name, c.Args...)
		}

		defer cmd.Terminate()

		// ToDo consider removing that !
		c.Name = cmd.Path
		c.Args = cmd.Args

		// if we dropped a binary we use the relative directory as working directory
		if cwd != "" {
			cmd.Dir = cwd
		}

		// we run the command and wait for its output
		stdout, err := cmd.Output()
		if err != nil {
			if ee, ok := err.(*exec.ExitError); ok {
				c.Stderr = ee.Stderr
			}
			c.ErrorFrom(err)
		}

		// if we expect JSON output
		if c.ExpectJSON {
			if err := json.Unmarshal(stdout, &c.Json); err != nil {
				c.Stdout = stdout
			}
		} else {
			c.Stdout = stdout
		}
	}

	// fetching files after the command has been ran
	for fn := range c.Fetch {
		data, err := os.ReadFile(fn)
		if err != nil {
			c.Fetch[fn].Error = fmt.Sprintf("%s", err)
		}
		c.Fetch[fn].Data = data
	}

	return
}

func (c *EndpointCommand) ErrorFrom(err error) {
	c.Error = err.Error()
}

func (c *EndpointCommand) Err() error {
	if c.Error == "" {
		return nil
	}
	return errors.New(c.Error)
}

func (c EndpointCommand) String() string {
	return fmt.Sprintf("%s %s", c.Name, c.Args)
}

// Strip reduces the command to the strict necessary fields
// to make the return trip from the endpoint to the manager
func (c *EndpointCommand) Strip() {
	//c.Name = ""
	//c.Args = nil
	for _, ef := range c.Drop {
		ef.Data = nil
	}
}

// Complete updates a command from another
func (c *EndpointCommand) Complete(other *EndpointCommand) error {
	if c.UUID == other.UUID {
		c.Name = other.Name
		c.Args = other.Args
		c.Json = other.Json
		c.Stdout = other.Stdout
		c.Stderr = other.Stderr
		c.Error = other.Error
		c.Drop = other.Drop
		c.Fetch = other.Fetch
		c.ExpectJSON = other.ExpectJSON
		c.Completed = true
		return nil
	}
	return fmt.Errorf("command does not have the same ID")
}

```

`api/default.go`:

```go
package api

import "github.com/0xrawsec/whids/utils"

const (
	// DefaultLogPerm default logfile permission for Manager
	DefaultLogPerm = 0600
	// DefaultManagerLogSize  default size for Manager's logfiles
	DefaultManagerLogSize = utils.Mega * 100
	// DefaultKeySize default size for API key generation
	DefaultKeySize = 64
	// EptAPIDefaultPort default port used by manager's endpoint API
	EptAPIDefaultPort = 1519
	// AdmAPIDefaultPort default port used by manager's admin API
	AdmAPIDefaultPort = 1520
	// DefaultMaxUploadSize default maximum upload size
	DefaultMaxUploadSize = 100 * utils.Mega
)

```

`api/endpoint.go`:

```go
package api

import (
	"fmt"
	"time"

	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/agent/sysinfo"
)

// Endpoint structure used to track and interact with endpoints
type Endpoint struct {
	sod.Item
	Uuid           string              `json:"uuid" sod:"unique"`
	Hostname       string              `json:"hostname"`
	IP             string              `json:"ip"`
	Group          string              `json:"group"`
	Criticality    int                 `json:"criticality"`
	Key            string              `json:"key,omitempty"`
	Command        *EndpointCommand    `json:"command,omitempty"`
	Score          float64             `json:"score"`
	Status         string              `json:"status"`
	SystemInfo     *sysinfo.SystemInfo `json:"system-info,omitempty"`
	Config         *config.Agent       `json:"config,omitempty"`
	LastEvent      time.Time           `json:"last-event"`
	LastDetection  time.Time           `json:"last-detection"`
	LastConnection time.Time           `json:"last-connection"`
}

// NewEndpoint returns a new Endpoint structure
func NewEndpoint(uuid, key string) *Endpoint {
	e := &Endpoint{Uuid: uuid, Key: key}
	e.Initialize(e.Uuid)
	return e
}

// Validate overwrite sod.Item function
func (e *Endpoint) Validate() error {
	if e.Criticality < 0 || e.Criticality > 10 {
		return fmt.Errorf("criticality field must be in [0;10]")
	}
	return nil
}

// Copy returns a pointer to a new copy of the Endpoint
func (e *Endpoint) Copy() *Endpoint {
	new := *e
	return &new
}

// UpdateLastConnection updates the LastConnection member of Endpoint structure
func (e *Endpoint) UpdateLastConnection() {
	e.LastConnection = time.Now().UTC()
}

```

`api/headers.go`:

```go
package api

const (
	AuthKeyHeader = "X-Api-Key"

	// Endpoint related
	EndpointUUIDHeader     = "X-Endpoint-Uuid"
	EndpointIPHeader       = "X-Endpoint-IP"
	EndpointHostnameHeader = "X-Endpoint-Hostname"
)

```

`api/openapi/openapi.go`:

```go
package openapi

import (
	"bytes"
	"encoding/json"
	"encoding/xml"
	"fmt"
	"io/ioutil"
	"net/http"
	"net/url"
	"reflect"
	"strings"
	"time"
)

const (
	ContentTypeJson        = "application/json"
	ContentTypeXML         = "application/xml"
	ContentTypeOctetStream = "application/octet-stream"
)

type OpenAPI struct {
	OpenAPI       string                `json:"openapi,omitempty"`
	Info          *Info                 `json:"info,omitempty"`
	Servers       []*Server             `json:"servers,omitempty"`
	TestingServer *Server               `json:"-"` // there to generate tests
	Paths         map[string]*PathItem  `json:"paths,omitempty"`
	Components    Components            `json:"components,omitempty"`
	Security      []SecurityRequirement `json:"security,omitempty"`
	// Not in OpenAPI spec
	Client            *http.Client              `json:"-"`
	ApiKey            *SecurityScheme           `json:"-"`
	ValidateOperation func(i interface{}) error `json:"-"`
}

type Components struct {
	Schemas         map[string]Schema         `json:"schemas,omitempty"`
	SecuritySchemes map[string]SecurityScheme `json:"securitySchemes,omitempty"`
}

type SecurityScheme struct {
	Type             string     `json:"type,omitempty"`
	Description      string     `json:"description,omitempty"`
	Name             string     `json:"name,omitempty"`
	In               string     `json:"in,omitempty"`
	Scheme           string     `json:"scheme,omitempty"`
	BearerFormat     string     `json:"bearerFormat,omitempty"`
	Flows            *OAuthFlow `json:"flows,omitempty"`
	OpenIdConnectUrl string     `json:"openIdConnect_url,omitempty"`
	// Not in OpenAPI spec but here for easier integration
	Value string `json:"-"`
}

type OAuthFlow struct {
}

func New(openapi string, info *Info, server *Server) *OpenAPI {
	oa := &OpenAPI{
		OpenAPI: openapi,
		Info:    info,
		Servers: make([]*Server, 0),
		Paths:   make(map[string]*PathItem),
		Components: Components{
			Schemas:         make(map[string]Schema),
			SecuritySchemes: make(map[string]SecurityScheme),
		},
		Security: make([]SecurityRequirement, 0),
	}
	oa.Servers = append(oa.Servers, server)
	return oa
}

func (oa *OpenAPI) AuthApiKey(header string, value string) {
	s := SecurityScheme{
		Type:  "apiKey",
		Name:  header,
		In:    "header",
		Value: value,
	}
	oa.Components.SecuritySchemes["ApiKeyAuth"] = s
	oa.ApiKey = &s
	oa.Security = append(oa.Security, SecurityRequirement{"ApiKeyAuth": []string{}})
}

func (oa *OpenAPI) ApiURL(path string) string {
	// take testing server in priority
	server := oa.TestingServer
	if server == nil {
		server = oa.FirstServer()
	}
	serverURL := strings.Trim(server.URL, "/")
	path = strings.Trim(path, "/")
	return fmt.Sprintf("%s/%s", serverURL, path)
}

func (oa *OpenAPI) FirstServer() *Server {
	if len(oa.Servers) == 0 {
		panic("OpenAPI structure needs to have at least one server configured")
	}
	return oa.Servers[0]
}

func (oa *OpenAPI) Prepare(method string, path string, data []byte, params map[string]string, headers map[string]string) *http.Request {
	body := new(bytes.Buffer)
	URL := oa.ApiURL(path)

	// preparing request body
	if data != nil {
		if len(data) > 0 {
			body.Write(data)
		}
	}

	// preparing parameters to be passed to the query
	if params != nil {
		v := url.Values{}
		for param, value := range params {
			v.Set(param, value)
		}

		if len(params) > 0 {
			URL = fmt.Sprintf("%s?%s", URL, v.Encode())
		}
	}

	req, err := http.NewRequest(method, URL, body)
	if err != nil {
		panic(err)
	}

	// Set Headers
	for f, v := range headers {
		req.Header.Add(f, v)
	}

	return req
}

func (oa *OpenAPI) docPath(path PathItem, op Operation) {
	pi := &PathItem{}

	op.Tags = []string{path.Summary}

	switch strings.ToUpper(op.Method) {
	case "GET":
		pi.Get = &op
	case "PUT":
		pi.Put = &op
	case "POST":
		pi.Post = &op
	case "DELETE":
		pi.Delete = &op
	case "OPTIONS":
		pi.Options = &op
	case "HEAD":
		pi.Head = &op
	case "PATCH":
		pi.Patch = &op
	case "TRACE":
		pi.Trace = &op
	}

	if _, ok := oa.Paths[path.Value]; ok {
		oa.Paths[path.Value].Merge(pi)
	} else {
		oa.Paths[path.Value] = pi
	}
}

func (oa *OpenAPI) do(base *PathItem, op *Operation) (err error) {
	var req *http.Request
	var resp *http.Response
	var data []byte

	body := new(bytes.Buffer)
	URL := oa.ApiURL(base.Value)

	if op.Validate == nil {
		op.Validate = oa.ValidateOperation
	}

	if op.RequestBody != nil {
		if data, err = op.RequestBody.ContentBytes(); err != nil {
			return
		}
	}

	// preparing request body
	if data != nil {
		if len(data) > 0 {
			body.Write(data)
		}
	}

	// preparing parameters to be passed to the query
	if len(op.Parameters) > 0 {
		v := url.Values{}
		for _, p := range op.Parameters {
			switch p.In {
			case "query":
				if !p.skip {
					v.Set(p.Name, p.Value)
				}
			case "path":
				URL = fmt.Sprintf("%s/%s", URL, p.Value)
				base.Value = fmt.Sprintf("%s/{%s}", base.Value, p.Name)
				if p.suffix != "" {
					URL = fmt.Sprintf("%s%s", URL, p.suffix)
					base.Value = fmt.Sprintf("%s%s", base.Value, p.suffix)
				}
			}
		}

		if len(v) > 0 {
			URL = fmt.Sprintf("%s?%s", URL, v.Encode())
		}
	}

	req, err = http.NewRequest(op.Method, URL, body)
	if err != nil {
		return
	}

	// Set authentication header
	if oa.ApiKey != nil {
		req.Header.Add(oa.ApiKey.Name, oa.ApiKey.Value)
	}

	if resp, err = oa.Client.Do(req); err != nil {
		return
	}

	if err = op.ParseResponse(resp); err != nil {
		return
	}

	return
}

// Test does exactly what Do does except that it does not document Operation
// the other difference is that this method returns any error encountered instead
// of panicing
func (oa *OpenAPI) Test(base PathItem, op Operation) error {
	return oa.do(&base, &op)
}

func (oa *OpenAPI) Do(base PathItem, op Operation) {

	if err := oa.do(&base, &op); err != nil {
		panic(err)
	}

	// Document path
	oa.docPath(base, op)
}

type Info struct {
	Title          string   `json:"title,omitempty"`
	Description    string   `json:"description,omitempty"`
	TermsOfService string   `json:"termsOfService,omitempty"`
	Contact        *Contact `json:"contact,omitempty"`
	License        *License `json:"license,omitempty"`
	Version        string   `json:"version,omitempty"`
}

func NewInfo(title, description, version string) *Info {
	return &Info{Title: title,
		Description: description,
		Version:     version}
}

type Contact struct {
	Name  string `json:"name,omitempty"`
	URL   string `json:"url,omitempty"`
	Email string `json:"email,omitempty"`
}

type License struct {
	Name string `json:"name,omitempty"`
	URL  string `json:"url,omitempty"`
}

type PathItem struct {
	Ref         string      `json:"$ref,omitempty"`
	Summary     string      `json:"summary,omitempty"`
	Description string      `json:"description,omitempty"`
	Get         *Operation  `json:"get,omitempty"`
	Put         *Operation  `json:"put,omitempty"`
	Post        *Operation  `json:"post,omitempty"`
	Delete      *Operation  `json:"delete,omitempty"`
	Options     *Operation  `json:"options,omitempty"`
	Head        *Operation  `json:"head,omitempty"`
	Patch       *Operation  `json:"patch,omitempty"`
	Trace       *Operation  `json:"trace,omitempty"`
	Servers     []Server    `json:"servers,omitempty"`
	Parameters  []Parameter `json:"parameters,omitempty"`
	// Not OpenAPI standard
	Value string `json:"-"`
}

func (p *PathItem) Update() {}

func (p *PathItem) Merge(other *PathItem) {
	p.Summary = other.Summary
	p.Description = other.Description

	// merging parameters
	params := make(map[string]Parameter)
	for _, param := range p.Parameters {
		params[param.Name] = param
	}
	for _, param := range other.Parameters {
		params[param.Name] = param
	}
	p.Parameters = make([]Parameter, 0, len(params))
	for _, param := range params {
		p.Parameters = append(p.Parameters, param)
	}

	// merging operations
	// Get
	if other.Get != nil {
		if p.Get == nil {
			p.Get = other.Get
		} else {
			p.Get.Merge(other.Get)
		}
	}
	// Put
	if other.Put != nil {
		if p.Put == nil {
			p.Put = other.Put
		} else {
			p.Put.Merge(other.Put)
		}
	}
	// Post
	if other.Post != nil {
		if p.Post == nil {
			p.Post = other.Post
		} else {
			p.Post.Merge(other.Post)
		}
	}
	// Delete
	if other.Delete != nil {
		if p.Delete == nil {
			p.Delete = other.Delete
		} else {
			p.Delete.Merge(other.Delete)
		}
	}
	// Options
	if other.Options != nil {
		if p.Options == nil {
			p.Options = other.Options
		} else {
			p.Options.Merge(other.Options)
		}
	}
	// Head
	if other.Head != nil {
		if p.Head == nil {
			p.Head = other.Head
		} else {
			p.Head.Merge(other.Head)
		}
	}
	// Patch
	if other.Patch != nil {
		if p.Patch == nil {
			p.Patch = other.Patch
		} else {
			p.Patch.Merge(other.Patch)
		}
	}
	// Trace
	if other.Trace != nil {
		if p.Trace == nil {
			p.Trace = other.Trace
		} else {
			p.Trace.Merge(other.Trace)
		}
	}

}

type Operation struct {
	Tags         []string     `json:"tags,omitempty"`
	Summary      string       `json:"summary,omitempty"`
	Description  string       `json:"description,omitempty"`
	ExternalDocs *ExternalDoc `json:"externalDocs,omitempty"`
	OperationId  string       `json:"operationId,omitempty"`
	Parameters   []*Parameter `json:"parameters,omitempty"`
	RequestBody  *RequestBody `json:"requestBody,omitempty"`
	Responses    Responses    `json:"responses,omitempty"`
	//Callbacks    Callback
	Deprecated bool                `json:"deprecated,omitempty"`
	Security   SecurityRequirement `json:"security,omitempty"`
	Servers    []Server            `json:"servers,omitempty"`
	// Not OpenAPI standard
	Method   string                         `json:"-"`
	Output   interface{}                    `json:"-"`
	Validate func(output interface{}) error `json:"-"`
}

func (o *Operation) softInit() {
	if o.Responses == nil {
		o.Responses = make(Responses)
	}
}

func (o *Operation) GET(params ...*Parameter) Operation {
	new := o.SetParams(params...)
	return new.SetMethod("GET")
}

func (o *Operation) DELETE(params ...*Parameter) Operation {
	new := o.SetParams(params...)
	return new.SetMethod("DELETE")
}

func (o *Operation) POST(b *RequestBody, params ...*Parameter) Operation {
	new := o.SetMethod("POST")
	if b != nil {
		new = new.SetRequestBody(b)
	}
	return new.SetParams(params...)
}

func (o *Operation) SetMethod(method string) Operation {
	new := *o
	new.Method = method
	return new
}

func (o *Operation) SetParams(params ...*Parameter) Operation {
	new := *o
	new.Parameters = append(new.Parameters, params...)
	return new
}

func (o *Operation) SetRequestBody(b *RequestBody) Operation {
	new := *o
	new.RequestBody = b
	return new
}

func (o *Operation) ParseResponse(r *http.Response) (err error) {
	var data []byte

	o.softInit()
	ct := r.Header.Get("Content-Type")

	if data, err = ioutil.ReadAll(r.Body); err != nil {
		return
	}

	switch ct {
	case ContentTypeJson:
		if err = json.Unmarshal(data, &o.Output); err != nil {
			return err
		}
	case "":
		break
	default:
		return fmt.Errorf("cannot parse Content-Type: %s", ct)
	}

	o.Responses[fmt.Sprintf("%d", r.StatusCode)] = Response{
		Description: fmt.Sprintf("HTTP %d response", r.StatusCode),
		Content: map[string]MediaType{
			ct: {
				Example: o.Output,
				//Schema:  SchemaFrom(o.Output, ct),
			},
		},
	}

	if o.Validate != nil {
		if err := o.Validate(o.Output); err != nil {
			return err
		}
	}

	return nil
}

func (o *Operation) Merge(other *Operation) {
	// merging parameters
	params := make(map[string]*Parameter)
	for _, param := range o.Parameters {
		params[param.Name] = param
	}
	for _, param := range other.Parameters {
		params[param.Name] = param
	}
	o.Parameters = make([]*Parameter, 0, len(params))
	for _, param := range params {
		o.Parameters = append(o.Parameters, param)
	}

	// merging responses

}

type Server struct {
	URL         string                    `json:"url,omitempty"`
	Description string                    `json:"description,omitempty"`
	Variables   map[string]ServerVariable `json:"variables,omitempty"`
}

type ServerVariable struct {
	Enum        []string `json:"enum,omitempty"`
	Default     string   `json:"default,omitempty"`
	Description string   `json:"description,omitempty"`
}

type Parameter struct {
	Name            string  `json:"name,omitempty"`
	In              string  `json:"in,omitempty"`
	Description     string  `json:"description,omitempty"`
	Required        bool    `json:"required"`
	Deprecated      bool    `json:"deprecated,omitempty"`
	AllowEmptyValue bool    `json:"allowEmptyValue"`
	Schema          *Schema `json:"schema,omitempty"`
	// Not OpenAPI standard
	Value  string `json:"-"`
	skip   bool
	suffix string
}

func (p *Parameter) Suffix(s string) *Parameter {
	p.suffix = fmt.Sprintf("%s%s", p.suffix, s)
	return p
}

func (p *Parameter) Skip() *Parameter {
	p.skip = true
	return p
}

func (p *Parameter) Require() *Parameter {
	p.Required = true
	return p
}

func QueryParameter(name string, value interface{}, opts ...string) *Parameter {
	desc := fmt.Sprintf("%s query parameter", name)
	if len(opts) > 0 {
		desc = opts[0]
	}
	return &Parameter{
		Description:     desc,
		Name:            name,
		Value:           fmt.Sprintf("%v", value),
		In:              "query",
		Schema:          SchemaFrom(value, ""),
		AllowEmptyValue: true,
	}
}

func PathParameter(name string, value interface{}, opts ...string) *Parameter {
	desc := fmt.Sprintf("%s path parameter", name)
	if len(opts) > 0 {
		desc = opts[0]
	}
	return &Parameter{
		Description:     desc,
		Name:            name,
		Value:           fmt.Sprintf("%v", value),
		In:              "path",
		Schema:          SchemaFrom(value, ""),
		AllowEmptyValue: false,
		Required:        true,
	}
}

type ExternalDoc struct {
}

type RequestBody struct {
	Description string               `json:"description,omitempty"`
	Content     map[string]MediaType `json:"content,omitempty"`
	Required    bool                 `json:"required,omitempty"`
}

func JsonRequestBody(desc string, data interface{}, required bool) *RequestBody {
	return MakeRequestBody(desc, ContentTypeJson, data, required)
}

func XMLRequestBody(desc string, data interface{}, required bool) *RequestBody {
	return MakeRequestBody(desc, ContentTypeXML, data, required)
}

func BinaryRequestBody(desc string, data interface{}, required bool) *RequestBody {
	return MakeRequestBody(desc, ContentTypeOctetStream, data, required)
}

func MakeRequestBody(desc, contentType string, data interface{}, required bool) *RequestBody {
	content := make(map[string]MediaType)
	content[contentType] = MediaType{
		Schema:  SchemaFrom(data, contentType),
		Example: data,
	}
	return &RequestBody{
		Description: desc,
		Content:     content,
		Required:    required,
	}
}

func (r *RequestBody) ContentBytes() (b []byte, err error) {
	for ct, mt := range r.Content {
		switch ct {
		case ContentTypeJson:
			return json.Marshal(mt.Example)
		case ContentTypeXML:
			return xml.Marshal(mt.Example)
		case ContentTypeOctetStream:
			var ok bool
			if b, ok = mt.Example.([]byte); !ok {
				return nil, fmt.Errorf("failed to cast Example to []byte")
			}
			return b, nil
		default:
			return nil, fmt.Errorf("unknown Content-Type: %s", ct)
		}
	}
	return nil, nil
}

type Responses map[string]Response

type Response struct {
	Description string               `json:"description,omitempty"`
	Headers     map[string]Header    `json:"headers,omitempty"`
	Content     map[string]MediaType `json:"content,omitempty"`
	Links       map[string]Link      `json:"links,omitempty"`
}

type Header struct {
	Description     string  `json:"description,omitempty"`
	Required        bool    `json:"required,omitempty"`
	Deprecated      bool    `json:"deprecated,omitempty"`
	AllowEmptyValue bool    `json:"allowEmptyValue,omitempty"`
	Schema          *Schema `json:"schema,omitempty"`
}

type MediaType struct {
	Schema   *Schema             `json:"schema,omitempty"`
	Example  interface{}         `json:"example,omitempty"`
	Examples map[string]Example  `json:"examples,omitempty"`
	Encoding map[string]Encoding `json:"encoding,omitempty"`
}

type Schema struct {
	Type       string             `json:"type,omitempty"`
	Format     string             `json:"format,omitempty"`
	Properties map[string]*Schema `json:"properties,omitempty"`
	Items      *Schema            `json:"items,omitempty"`
}

func schema(typ, format string) *Schema {
	return &Schema{typ, format, nil, nil}
}

func SchemaFromString(s string) *Schema {
	if _, err := time.Parse(time.RFC3339, s); err == nil {
		return schema("string", "date")
	}
	if _, err := time.Parse(time.RFC3339Nano, s); err == nil {
		return schema("string", "date")
	}
	return schema("string", "")
}

func SchemaFrom(i interface{}, contentType string) (s *Schema) {
	var t reflect.Type
	v := reflect.ValueOf(i)

	if v.IsValid() {
		t = v.Type()
	} else {
		return schema("object", "")
	}

	// Handling base types
	switch v := i.(type) {
	case int8, int16, int32, uint8, uint16, uint32:
		return schema("integer", "int32")
	case int64, int, uint64, uint:
		return schema("integer", "int64")
	case float32:
		return schema("number", "float")
	case float64:
		return schema("number", "double")
	case []byte:
		return schema("string", "binary")
	case time.Time:
		return schema("string", "date")
	case string:
		return SchemaFromString(v)
	case bool:
		return schema("boolean", "")
	}

	switch v.Kind() {
	case reflect.Ptr:
		t = v.Type().Elem()
		return SchemaFrom(reflect.New(t).Elem().Interface(), contentType)
	case reflect.Struct:
		fields := make(map[string]*Schema)
		for i := 0; i < t.NumField(); i++ {
			fieldName := t.Field(i).Name
			if string(fieldName[0]) == strings.ToUpper(string(fieldName[0])) {
				switch contentType {
				case ContentTypeJson, ContentTypeXML:
					tag := "json"
					if contentType == ContentTypeXML {
						tag = "xml"
					}
					tagVal := t.Field(i).Tag.Get(tag)

					// this field should be ignored
					if tagVal == "-" {
						continue
					}

					if tagVal != "" {
						name := strings.SplitN(tagVal, ",", 2)[0]
						fields[name] = SchemaFrom(v.Field(i).Interface(), contentType)
					} else {
						// if there is no json tag we take field name
						fields[fieldName] = SchemaFrom(v.Field(i).Interface(), contentType)
					}
				default:
					panic(fmt.Sprintf("Unkown Content-Type: %s", contentType))
				}
			}
		}
		return &Schema{
			"object", "", fields, nil}
	case reflect.Slice:
		e := t.Elem()
		return &Schema{
			Type:  "array",
			Items: SchemaFrom(reflect.New(e).Interface(), contentType)}
	case reflect.Map:
		// gives the type of the values contained the map
		e := t.Elem()
		return &Schema{
			Type: "object",
			Properties: map[string]*Schema{
				fmt.Sprintf("key(%s)", t.Key()): SchemaFrom(reflect.New(e).Interface(), contentType),
			}}
	}

	return &Schema{
		"object", "", nil, nil}
}

type Link struct {
	OperationRef string                 `json:"operationRef,omitempty"`
	OperationId  string                 `json:"operationId,omitempty"`
	Parameters   map[string]interface{} `json:"parameters,omitempty"`
	RequestBody  interface{}            `json:"requestBody,omitempty"`
	Description  string                 `json:"description,omitempty"`
	Server       Server                 `json:"server,omitempty"`
}

type Example struct {
	Summary       string      `json:"summary,omitempty"`
	Description   string      `json:"description,omitempty"`
	Value         interface{} `json:"value,omitempty"`
	ExternalValue string      `json:"externalValue,omitempty"`
}

type Encoding struct {
	ContentType   string            `json:"contentType,omitempty"`
	Headers       map[string]Header `json:"headers,omitempty"`
	Style         string            `json:"style,omitempty"`
	Explode       bool              `json:"explode,omitempty"`
	AllowReserved bool              `json:"allowReserved,omitempty"`
}

type SecurityRequirement map[string][]string

```

`api/query_params.go`:

```go
package api

const (
	QpIdentifier  = "identifier"
	QpGroup       = "group"
	QpStatus      = "status"
	QpShowKey     = "showkey"
	QpNewKey      = "newkey"
	QpCriticality = "criticality"
	QpWait        = "wait"
	QpSince       = "since"
	QpUntil       = "until"
	QpLast        = "last"
	QpLimit       = "limit"
	QpPivot       = "pivot"
	QpDelta       = "delta"
	QpSkip        = "skip"
	QpSource      = "source"
	QpValue       = "value"
	QpType        = "type"
	QpName        = "name"
	QpFilters     = "filters"
	QpUpdate      = "update"
	QpRaw         = "raw"
	QpGunzip      = "gunzip"
	QpUuid        = "uuid"
	QpGroupUuid   = "guuid"
	QpFormat      = "format"
	QpVersion     = "version"
	QpOS          = "os"
	QpBinary      = "binary"
	QpHash        = "hash"
)

```

`api/reports.go`:

```go
package api

import (
	"time"

	"github.com/0xrawsec/gene/v2/reducer"
	"github.com/0xrawsec/sod"
)

type ArchivedReport struct {
	sod.Item
	reducer.ReducedStats
	ArchivedTimestamp time.Time `json:"archived-time"`
}

```

`api/routes.go`:

```go
package api

// Routes used by Clients
const (
	// GET based API routes

	// EptAPIServerKeyPath API route used to get server key
	EptAPIServerKeyPath = "/key"
	// EptAPIConfigPath API route used to get/post endpoint configuration
	EptAPIConfigPath       = "/config"
	EptAPIConfigSha256Path = "/config/sha256"
	// EptAPIRulesPath API route used to get Gene rules available in server
	EptAPIRulesPath = "/rules"
	// EptAPIRulesSha256Path API route used to retrieve sha256 of latest batch of Gene rules
	EptAPIRulesSha256Path = "/rules/sha256"

	// Routes to work with sysmon configuration
	EptAPISysmonConfigPath       = "/sysmon/config"
	EptAPISysmonConfigSha256Path = "/sysmon/config/sha256"

	// EptAPIIoCsPath API route used to serve IOC container
	EptAPIIoCsPath = "/iocs"
	// EptAPIIoCsSha256Path API route used to serve sha256 of IOC container
	EptAPIIoCsSha256Path = "/iocs/sha256"
	// EptAPITools API route used to update local tools
	EptAPITools = "/tools"

	// POST based API routes

	// EptAPIPostLogsPath API route used to post logs
	EptAPIPostLogsPath = "/logs"
	// EptAPIPostDumpPath API route used to dump things
	EptAPIPostDumpPath = "/upload/dumps"
	// EptAPIPostSystemInfo API route used to send system information
	EptAPIPostSystemInfo = "/info/system"

	// GET and POST routes

	// EptAPICommandPath used to GET commands and POST results
	EptAPICommandPath = "/commands"
)

var (
	EptAPIVerbosePaths = []string{
		EptAPIServerKeyPath,
		EptAPICommandPath,
		EptAPIRulesSha256Path,
		EptAPIIoCsSha256Path,
	}
)

// Routes used for Admin API
const (
	uuidRe = "[[:xdigit:]]{8}-[[:xdigit:]]{4}-[[:xdigit:]]{4}-[[:xdigit:]]{4}-[[:xdigit:]]{12}"

	AdmAPIUsers    = "/users"
	AdmAPIUserByID = AdmAPIUsers + "/{uuuid:" + uuidRe + "}"

	AdmAPIStatsPath     = "/stats"
	AdmAPIIocsPath      = "/iocs"
	AdmAPIRulesPath     = "/rules"
	AdmAPIEndpointsPath = "/endpoints"

	AdmAPIEndpointsOSPath = AdmAPIEndpointsPath + `/{os:\w+}`

	// Sysmon related
	AdmAPIEndpointsSysmonPath   = AdmAPIEndpointsOSPath + `/sysmon`
	AdmAPIEndpointsSysmonBinary = AdmAPIEndpointsSysmonPath + `/binary`
	AdmAPIEndpointsSysmonConfig = AdmAPIEndpointsSysmonPath + `/config`

	// OSQueryi related
	AdmAPIEndpointsOSQueryiPath   = AdmAPIEndpointsOSPath + `/osqueryi`
	AdmAPIEndpointsOSQueryiBinary = AdmAPIEndpointsOSQueryiPath + `/binary`

	// Endpoint by UUID
	AdmAPIEndpointsByIDPath = AdmAPIEndpointsPath + "/{euuid:" + uuidRe + "}"
	// Config related
	AdmAPIConfigSuffix       = "/config"
	AdmAPIEndpointConfigPath = AdmAPIEndpointsByIDPath + AdmAPIConfigSuffix
	// Command related
	AdmAPICommandSuffix            = "/command"
	AdmAPIEndpointCommandPath      = AdmAPIEndpointsByIDPath + AdmAPICommandSuffix
	AdmAPIEndpointCommandFieldPath = AdmAPIEndpointCommandPath + "/{field}"
	// Logs related
	AdmAPILogsSuffix             = "/logs"
	AdmAPIEndpointLogsPath       = AdmAPIEndpointsByIDPath + AdmAPILogsSuffix
	AdmAPIDetectionSuffix        = "/detections"
	AdmAPIEndpointDetectionsPath = AdmAPIEndpointsByIDPath + AdmAPIDetectionSuffix
	// Reports related
	AdmAPIReportSuffix              = "/report"
	AdmAPIEndpointsReportsPath      = AdmAPIEndpointsPath + "/reports"
	AdmAPIEndpointReportPath        = AdmAPIEndpointsByIDPath + AdmAPIReportSuffix
	AdmAPIArchiveSuffix             = "/archive"
	AdmAPIEndpointReportArchivePath = AdmAPIEndpointReportPath + AdmAPIArchiveSuffix
	// Dumps related
	AdmAPIArticfactsSuffix       = "/artifacts"
	AdmAPIEndpointsArtifactsPath = AdmAPIEndpointsPath + AdmAPIArticfactsSuffix
	AdmAPIEndpointArtifacts      = AdmAPIEndpointsByIDPath + AdmAPIArticfactsSuffix
	AdmAPIEndpointArtifact       = AdmAPIEndpointArtifacts + "/{pguid:" + uuidRe + "}/{ehash:[[:xdigit:]]+}/{fname:.*}"

	//Websockets
	AdmAPIStreamEvents     = "/stream/events"
	AdmAPIStreamDetections = "/stream/detections"
)

```

`api/rules.go`:

```go
package api

import (
	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/sod"
)

type EdrRule struct {
	sod.Item
	engine.Rule
}

```

`api/server/adminapi_test.go`:

```go
package server

import (
	"bytes"
	"crypto/tls"
	"encoding/json"
	"fmt"
	"io/ioutil"
	"math/rand"
	"net/http"
	"net/url"
	"sync"
	"testing"
	"time"

	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/utils"
	"github.com/gorilla/websocket"
)

var (
	testAdminUser = &AdminAPIUser{
		Identifier: "test",
		Key:        utils.NewKeyOrPanic(api.DefaultKeySize),
	}
)

func prepare(method, URL string, data []byte, params map[string]string) *http.Request {
	key := testAdminUser.Key
	buf := new(bytes.Buffer)

	// preparing request body
	if data != nil {
		if len(data) > 0 {
			buf.Write(data)
		}
	}

	// preparing parameters to be passed to the query
	if params != nil {
		v := url.Values{}
		for param, value := range params {
			v.Set(param, value)
		}

		if len(params) > 0 {
			URL = fmt.Sprintf("%s?%s", URL, v.Encode())
		}
	}

	uri := fmt.Sprintf("https://%s:%d%s", mconf.AdminAPI.Host, mconf.AdminAPI.Port, URL)
	req, err := http.NewRequest(method, uri, buf)
	if err != nil {
		panic(err)
	}
	req.Header.Add(api.AuthKeyHeader, key)
	return req
}

func do(req *http.Request) (r AdminAPIResponse) {
	cl := http.Client{Transport: cconf.Transport()}
	resp, err := cl.Do(req)
	if err != nil {
		panic(err)
	}
	if resp.StatusCode != 200 {
		panic(fmt.Errorf("Unexpected response status: %d", resp.StatusCode))
	}
	defer resp.Body.Close()
	b, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		panic(err)
	}
	if err := json.Unmarshal(b, &r); err != nil {
		panic(err)
	}
	return
}

func get(url string) (r AdminAPIResponse) {
	return do(prepare("GET", url, nil, nil))
}

func put(url string) (r AdminAPIResponse) {
	return do(prepare("PUT", url, nil, nil))
}

func post(url string, data []byte) (r AdminAPIResponse) {
	cl := http.Client{Transport: cconf.Transport()}
	key := testAdminUser.Key
	uri := fmt.Sprintf("https://%s:%d%s", mconf.AdminAPI.Host, mconf.AdminAPI.Port, url)
	req, err := http.NewRequest("POST", uri, bytes.NewBuffer(data))
	if err != nil {
		panic(err)
	}
	req.Header.Add(api.AuthKeyHeader, key)
	resp, err := cl.Do(req)
	if err != nil {
		panic(err)
	}
	if resp.StatusCode != 200 {
		panic(fmt.Errorf("Unexpected response status: %d", resp.StatusCode))
	}
	defer resp.Body.Close()
	b, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		panic(err)
	}
	if len(b) > 0 {
		if err := json.Unmarshal(b, &r); err != nil {
			panic(err)
		}
	}
	return
}

func failOnAdminAPIError(t *testing.T, r AdminAPIResponse) {
	if r.Error != "" {
		t.Errorf("Unexpected API error: %s", r.Error)
		t.FailNow()
	}
}

func getEndpointUUID() string {
	r := get(api.AdmAPIEndpointsPath)
	a := r.Data.([]interface{})
	m := a[0].(map[string]interface{})
	return m["uuid"].(string)
}

func prepareTest() (m *Manager, c *client.ManagerClient) {
	var err error

	key := utils.NewKeyOrPanic(api.DefaultKeySize)

	if m, err = NewManager(&mconf); err != nil {
		panic(err)
	}

	// we don't handle error as we don't care if user
	// already exists
	m.CreateNewAdminAPIUser(testAdminUser)

	m.AddEndpoint(cconf.UUID, key)
	m.Run()

	cconf.Key = key
	if c, err = client.NewManagerClient(&cconf); err != nil {
		panic(err)
	}
	// wait that server is up
	// might generate error message in log
	for !c.IsServerUp() {
		time.Sleep(time.Nanosecond * 500)
	}
	return
}

func prettyJSON(i interface{}) string {
	b, err := json.MarshalIndent(i, "", "  ")
	if err != nil {
		panic(err)
	}
	return string(b)
}

func JSON(i interface{}) []byte {
	b, err := json.Marshal(i)
	if err != nil {
		panic(err)
	}
	return b
}

/////////////////// Test functions

func TestAdminAPIGetEndpoints(t *testing.T) {
	m, _ := prepareTest()
	defer func() {
		m.Shutdown()
		m.Wait()
	}()
	r := get(api.AdmAPIEndpointsPath)
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))
}

func TestAdminAPIGetCommand(t *testing.T) {
	m, _ := prepareTest()
	defer func() {
		m.Shutdown()
		m.Wait()
	}()
	euuid := getEndpointUUID()
	r := get(format("%s/%s/command", api.AdmAPIEndpointsPath, euuid))
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))
}

func TestAdminAPIPostCommand(t *testing.T) {
	m, c := prepareTest()
	defer func() {
		m.Shutdown()
		m.Wait()
	}()
	euuid := c.Config.UUID
	ca := CommandAPI{
		CommandLine: "/bin/ls",
		FetchFiles:  []string{"/etc/fstab"},
	}
	r := post(format("%s/%s/command", api.AdmAPIEndpointsPath, euuid), JSON(ca))
	failOnAdminAPIError(t, r)
	time.Sleep(2 * time.Second)
	if cmd, err := c.FetchCommand(); err != nil {
		t.Errorf("Failed to Fetch command: %s", err)
		t.FailNow()
	} else {
		if err = cmd.Run(); err != nil {
			t.Errorf("Failed to run command: %s", err)
			t.FailNow()
		}

		if err := c.PostCommand(cmd); err != nil {
			t.Errorf("Failed to post command: %s", err)
			t.FailNow()
		}
	}

	r = get(format("%s/%s/command", api.AdmAPIEndpointsPath, euuid))
	cmd := api.EndpointCommand{}
	if err := r.UnmarshalData(&cmd); err != nil {
		t.Errorf("Failed to unmarshal response data")
		t.FailNow()
	}
	t.Logf("stdout: %s", cmd.Stdout)
	t.Logf("received: %s", prettyJSON(r))
}

func TestAdminAPIGetCommandField(t *testing.T) {
	var stdout []byte
	var files map[string]*api.EndpointFile

	m, c := prepareTest()
	defer func() {
		m.Shutdown()
		m.Wait()
	}()
	euuid := c.Config.UUID
	ca := CommandAPI{
		CommandLine: "/bin/ls",
		FetchFiles:  []string{"/etc/fstab"},
	}
	r := post(format("%s/%s/command", api.AdmAPIEndpointsPath, euuid), JSON(ca))
	failOnAdminAPIError(t, r)

	if cmd, err := c.FetchCommand(); err != nil {
		t.Errorf("Failed to Fetch command: %s", err)
		t.FailNow()
	} else {
		if err = cmd.Run(); err != nil {
			t.Errorf("Failed to run command: %s", err)
			t.FailNow()
		}

		if err := c.PostCommand(cmd); err != nil {
			t.Errorf("Failed to post command: %s", err)
			t.FailNow()
		}
	}

	r = get(format("%s/%s/command/stdout", api.AdmAPIEndpointsPath, euuid))
	failOnAdminAPIError(t, r)

	if err := r.UnmarshalData(&stdout); err != nil {
		t.Errorf("Failed to unmarshal response data")
		t.FailNow()

	}
	t.Logf("stdout: %s", stdout)

	r = get(format("%s/%s/command/files", api.AdmAPIEndpointsPath, euuid))
	failOnAdminAPIError(t, r)
	t.Logf("files: %s", prettyJSON(r))
	if err := r.UnmarshalData(&files); err != nil {
		t.Errorf("Failed to unmarshal response data")
		t.FailNow()
	}
	for f, ef := range files {
		t.Logf("file: %s\ncontent: %s\n", f, string(ef.Data))
	}
}
func TestAdminAPIGetNewEndpoint(t *testing.T) {
	m, _ := prepareTest()
	mconfBak := mconf
	mconf.SetPath("data/test-config.json")
	defer func() {
		// we added an endpoint so we
		// need to restore configuration
		mconf = mconfBak
		m.Shutdown()
		m.Wait()
	}()

	r := put(api.AdmAPIEndpointsPath)
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))

	r = get(api.AdmAPIEndpointsPath)
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))
}

func TestAdminAPIGetEndpointReport(t *testing.T) {

	events := []string{
		`{"Event":{"EventData":{"CommandLine":"\"C:\\Program Files\\Mozilla Firefox\\firefox.exe\"","CurrentDirectory":"C:\\Program Files\\Mozilla Firefox\\","Image":"C:\\Program Files\\Mozilla Firefox\\firefox.exe","ImageHashes":"SHA1=6923508844E6FE0C1DEDD684FE299EBC26D778F3,MD5=988976B1058A1DAE198C93A5688142FD,SHA256=28BE8E0485DBA68F6A4B37F6A68D7AE542B0DA00925A69EA12A4E7AA3B477EC6,IMPHASH=AECE7B7E776840D7A7255A31B309B7E4","ImageSignature":"Mozilla Corporation","ImageSignatureStatus":"Valid","ImageSigned":"true","IntegrityLevel":"Medium","ProcessGuid":"{515cd0d1-c09c-615c-6886-000000008b00}","ProcessId":"9472","ProcessThreatScore":"60","QueryName":"analytics-collector-28944298.us-east-1.elb.amazonaws.com","QueryResults":"-","QueryStatus":"9501","RuleName":"-","Services":"N/A","User":"DESKTOP-LJRVE06\\Generic","UtcTime":"2021-10-04 03:47:27.711"},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-LJRVE06","EventID":22,"Execution":{"ProcessID":3188,"ThreadID":1536},"Keywords":{"Value":9223372036854776000,"Name":""},"Level":{"Value":4,"Name":"Information"},"Opcode":{"Value":0,"Name":"Info"},"Task":{"Value":0,"Name":""},"Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"TimeCreated":{"SystemTime":"2021-10-04T03:47:28.7994921Z"}},"EdrData":{"Endpoint":{"UUID":"03e31275-2277-d8e0-bb5f-480fac7ee4ef","IP":"192.168.56.110","Hostname":"DESKTOP-LJRVE06","Group":"HR"},"Event":{"Hash":"107115af9a7ae294b66499d9f24b4da40840f8dc","Detection":true,"ReceiptTime":"2021-10-06T07:00:47.488763072Z"}},"Detection":{"Signature":["HeurSysmonLongDomain"],"Criticality":6,"Actions":["brief","filedump","regdump"]}}}`,
		`{"Event":{"EventData":{"CallTrace":"C:\\Windows\\SYSTEM32\\ntdll.dll+9c524|C:\\Windows\\System32\\wow64.dll+17014|C:\\Windows\\System32\\wow64.dll+16c85|C:\\Windows\\System32\\wow64.dll+1723b|C:\\Windows\\System32\\wow64.dll+1e5b|C:\\Windows\\System32\\wow64.dll+301d|C:\\Windows\\System32\\wow64.dll+67e3|C:\\Windows\\System32\\wow64cpu.dll+1783|C:\\Windows\\System32\\wow64cpu.dll+1199|C:\\Windows\\System32\\wow64.dll+baea|C:\\Windows\\System32\\wow64.dll+b9a7|C:\\Windows\\SYSTEM32\\ntdll.dll+d3fb3|C:\\Windows\\SYSTEM32\\ntdll.dll+c1dbd|C:\\Windows\\SYSTEM32\\ntdll.dll+717f3|C:\\Windows\\SYSTEM32\\ntdll.dll+7179e|C:\\Windows\\SYSTEM32\\ntdll.dll+71ffc(wow64)|C:\\Windows\\System32\\KERNELBASE.dll+110926(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+f614(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+f89d(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12ef1(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12f58(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12e7b(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12fc9(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+aa418(wow64)","GrantedAccess":"0x1010","RuleName":"-","SourceHashes":"SHA1=12950D906FF703F3A1E0BD973FCA2B433E5AB207,MD5=9A66A3DE2589F7108426AF37AB7F6B41,SHA256=A913415626433D5D0F07D3EC4084A67FF6F5138C3C3F64E36DD0C1AE4C423C65,IMPHASH=7DF1816239C5BC855600D41210406C5B","SourceImage":"C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe","SourceIntegrityLevel":"System","SourceProcessGUID":"{515cd0d1-421a-615d-e087-000000008b00}","SourceProcessId":"6176","SourceProcessThreatScore":"54","SourceServices":"N/A","SourceThreadId":"5788","SourceUser":"NT AUTHORITY\\SYSTEM","TargetHashes":"?","TargetImage":"C:\\Windows\\system32\\lsass.exe","TargetIntegrityLevel":"?","TargetParentProcessGuid":"?","TargetProcessGUID":"{515cd0d1-6dae-6154-0c00-000000008b00}","TargetProcessId":"708","TargetProcessThreatScore":"-1","TargetServices":"KeyIso,SamSs,VaultSvc","TargetUser":"?","UtcTime":"2021-10-06 06:28:43.309"},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-LJRVE06","EventID":10,"Execution":{"ProcessID":3188,"ThreadID":3104},"Keywords":{"Value":9223372036854776000,"Name":""},"Level":{"Value":4,"Name":"Information"},"Opcode":{"Value":0,"Name":"Info"},"Task":{"Value":0,"Name":""},"Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"TimeCreated":{"SystemTime":"2021-10-04T03:15:27.1523337Z"}},"EdrData":{"Endpoint":{"UUID":"03e31275-2277-d8e0-bb5f-480fac7ee4ef","IP":"192.168.56.110","Hostname":"DESKTOP-LJRVE06","Group":"HR"},"Event":{"Hash":"af6ee1bef517b5f2d45205f3fb0cf3b48b8d3851","Detection":true,"ReceiptTime":"2021-10-06T06:28:44.894685897Z"}},"Detection":{"Signature":["SuspiciousLsassAccess"],"Criticality":8,"Actions":["report","filedump","regdump","memdump"]}}}`,
		`{"Event":{"EventData":{"CommandLine":"\"C:\\Program Files (x86)\\Google\\Update\\Install\\{B29ED602-C455-4B82-80D2-A5992C371348}\\CR_C52DD.tmp\\setup.exe\" --install-archive=\"C:\\Program Files (x86)\\Google\\Update\\Install\\{B29ED602-C455-4B82-80D2-A5992C371348}\\CR_C52DD.tmp\\CHROME_PATCH.PACKED.7Z\" --previous-version=\"94.0.4606.61\" --verbose-logging --do-not-launch-chrome --channel=stable --system-level","Count":"104","CountByExt":"9","CreationUtcTime":"2021-10-06 06:28:31.108","CurrentDirectory":"C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\","Extension":".dll","FrequencyEps":"6","Image":"C:\\Program Files (x86)\\Google\\Update\\Install\\{B29ED602-C455-4B82-80D2-A5992C371348}\\CR_C52DD.tmp\\setup.exe","ImageHashes":"SHA1=0019051003B762EBA424E00BA0D34023608D48D6,MD5=46EB8A20A6B5B16C0BC24B907E0AA684,SHA256=C5360313BD1E95409174C03B71AC83FA13FBFFD3D13412A71D38FB451783FC0E,IMPHASH=44B4DFB0DCCA5DE0AA33EAEC613BAC84","ImageSignature":"Google LLC","ImageSignatureStatus":"Valid","ImageSigned":"true","IntegrityLevel":"System","ProcessGuid":"{515cd0d1-41ff-615d-d587-000000008b00}","ProcessId":"400","ProcessThreatScore":"91","RuleName":"-","Services":"N/A","TargetFilename":"C:\\Program Files\\Google\\Chrome\\Temp\\source400_1020262374\\Chrome-bin\\94.0.4606.71\\vk_swiftshader.dll","User":"NT AUTHORITY\\SYSTEM","UtcTime":"2021-10-06 06:28:31.109"},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-LJRVE06","EventID":11,"Execution":{"ProcessID":3188,"ThreadID":3104},"Keywords":{"Value":9223372036854776000,"Name":""},"Level":{"Value":4,"Name":"Information"},"Opcode":{"Value":0,"Name":"Info"},"Task":{"Value":0,"Name":""},"Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"TimeCreated":{"SystemTime":"2021-10-04T03:15:14.9259991Z"}},"EdrData":{"Endpoint":{"UUID":"03e31275-2277-d8e0-bb5f-480fac7ee4ef","IP":"192.168.56.110","Hostname":"DESKTOP-LJRVE06","Group":"HR"},"Event":{"Hash":"7f21f22e69db69f712798574f04baf28c8d44106","Detection":true,"ReceiptTime":"2021-10-06T06:28:32.368300493Z"}},"Detection":{"Signature":["ExecutableFileCreated"],"Criticality":7,"Actions":["brief","filedump","regdump"]}}}`,
		`{"Event":{"EventData":{"CallTrace":"C:\\Windows\\SYSTEM32\\ntdll.dll+9c524|C:\\Windows\\System32\\wow64.dll+17014|C:\\Windows\\System32\\wow64.dll+16c85|C:\\Windows\\System32\\wow64.dll+1723b|C:\\Windows\\System32\\wow64.dll+1e5b|C:\\Windows\\System32\\wow64.dll+301d|C:\\Windows\\System32\\wow64.dll+67e3|C:\\Windows\\System32\\wow64cpu.dll+1783|C:\\Windows\\System32\\wow64cpu.dll+1199|C:\\Windows\\System32\\wow64.dll+baea|C:\\Windows\\System32\\wow64.dll+b9a7|C:\\Windows\\SYSTEM32\\ntdll.dll+7190b|C:\\Windows\\SYSTEM32\\ntdll.dll+717f3|C:\\Windows\\SYSTEM32\\ntdll.dll+7179e|C:\\Windows\\SYSTEM32\\ntdll.dll+71ffc(wow64)|C:\\Windows\\System32\\KERNELBASE.dll+110926(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+f614(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+f89d(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12ef1(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12f58(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12e7b(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+12aa8(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+1cf31(wow64)|C:\\Program Files (x86)\\Google\\Update\\1.3.36.112\\goopdate.dll+1d691(wow64)","GrantedAccess":"0x1010","RuleName":"-","SourceHashes":"SHA1=12950D906FF703F3A1E0BD973FCA2B433E5AB207,MD5=9A66A3DE2589F7108426AF37AB7F6B41,SHA256=A913415626433D5D0F07D3EC4084A67FF6F5138C3C3F64E36DD0C1AE4C423C65,IMPHASH=7DF1816239C5BC855600D41210406C5B","SourceImage":"C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe","SourceIntegrityLevel":"System","SourceProcessGUID":"{515cd0d1-41e9-615d-a787-000000008b00}","SourceProcessId":"5368","SourceProcessThreatScore":"50","SourceServices":"gupdate","SourceThreadId":"8284","SourceUser":"NT AUTHORITY\\SYSTEM","TargetHashes":"?","TargetImage":"C:\\Windows\\system32\\lsass.exe","TargetIntegrityLevel":"?","TargetParentProcessGuid":"?","TargetProcessGUID":"{515cd0d1-6dae-6154-0c00-000000008b00}","TargetProcessId":"708","TargetProcessThreatScore":"-1","TargetServices":"KeyIso,SamSs,VaultSvc","TargetUser":"?","UtcTime":"2021-10-06 06:28:42.590"},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-LJRVE06","EventID":10,"Execution":{"ProcessID":3188,"ThreadID":3104},"Keywords":{"Value":9223372036854776000,"Name":""},"Level":{"Value":4,"Name":"Information"},"Opcode":{"Value":0,"Name":"Info"},"Task":{"Value":0,"Name":""},"Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"TimeCreated":{"SystemTime":"2021-10-04T03:15:26.4082567Z"}},"EdrData":{"Endpoint":{"UUID":"03e31275-2277-d8e0-bb5f-480fac7ee4ef","IP":"192.168.56.110","Hostname":"DESKTOP-LJRVE06","Group":"HR"},"Event":{"Hash":"72241c0e9816fca5d44787752e87715db3ada5f4","Detection":true,"ReceiptTime":"2021-10-06T06:28:43.620696097Z"}},"Detection":{"Signature":["SuspiciousLsassAccess"],"Criticality":8,"Actions":["report","filedump","regdump","memdump"]}}}`,
		`{"Event":{"EventData":{"CommandLine":"\"C:\\Program Files\\Mozilla Firefox\\firefox.exe\"","CurrentDirectory":"C:\\Program Files\\Mozilla Firefox\\","Image":"C:\\Program Files\\Mozilla Firefox\\firefox.exe","ImageHashes":"SHA1=6923508844E6FE0C1DEDD684FE299EBC26D778F3,MD5=988976B1058A1DAE198C93A5688142FD,SHA256=28BE8E0485DBA68F6A4B37F6A68D7AE542B0DA00925A69EA12A4E7AA3B477EC6,IMPHASH=AECE7B7E776840D7A7255A31B309B7E4","ImageSignature":"Mozilla Corporation","ImageSignatureStatus":"Valid","ImageSigned":"true","IntegrityLevel":"Medium","ProcessGuid":"{515cd0d1-c09c-615c-6886-000000008b00}","ProcessId":"9472","ProcessThreatScore":"30","QueryName":"analytics-collector-28944298.us-east-1.elb.amazonaws.com","QueryResults":"54.209.192.22;23.21.66.55;54.84.193.129;34.230.149.116;","QueryStatus":"0","RuleName":"-","Services":"N/A","User":"DESKTOP-LJRVE06\\Generic","UtcTime":"2021-10-04 03:46:23.070"},"System":{"Channel":"Microsoft-Windows-Sysmon/Operational","Computer":"DESKTOP-LJRVE06","EventID":22,"Execution":{"ProcessID":3188,"ThreadID":1536},"Keywords":{"Value":9223372036854776000,"Name":""},"Level":{"Value":4,"Name":"Information"},"Opcode":{"Value":0,"Name":"Info"},"Task":{"Value":0,"Name":""},"Provider":{"Guid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","Name":"Microsoft-Windows-Sysmon"},"TimeCreated":{"SystemTime":"2021-10-04T03:46:23.342471Z"}},"EdrData":{"Endpoint":{"UUID":"03e31275-2277-d8e0-bb5f-480fac7ee4ef","IP":"192.168.56.110","Hostname":"DESKTOP-LJRVE06","Group":"HR"},"Event":{"Hash":"5b74a882fba6a5a762d6e9cabfa1d3a9883ba203","Detection":true,"ReceiptTime":"2021-10-06T06:59:46.487128874Z"}},"Detection":{"Signature":["HeurSysmonLongDomain"],"Criticality":6,"Actions":["brief","filedump","regdump"]}}}`,
	}

	m, mc := prepareTest()
	mconfBak := mconf
	defer func() {
		// we added an endpoint so we
		// need to restore configuration
		mconf = mconfBak
		m.Shutdown()
		m.Wait()
	}()
	euuid := mc.Config.UUID
	// creating a new endpoint
	r := put(api.AdmAPIEndpointsPath)
	failOnAdminAPIError(t, r)

	for _, e := range events {
		r, err := mc.PrepareGzip("POST", api.EptAPIPostLogsPath, bytes.NewBufferString(e))
		if err != nil {
			t.Logf("Failed to prepare request: %s", err)
			t.FailNow()
		}
		mc.HTTPClient.Do(r)
	}

	time.Sleep(1 * time.Second)

	r = get(api.AdmAPIEndpointsReportsPath)
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))

	r = do(prepare("DELETE", api.AdmAPIEndpointsPath+"/"+euuid+"/report", nil, nil))
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))

	time.Sleep(1 * time.Second)
	r = get(api.AdmAPIEndpointsReportsPath)
	failOnAdminAPIError(t, r)
	t.Logf("received: %s", prettyJSON(r))
}

func TestAdminAPIGetEndpointLogs(t *testing.T) {
	tt := toast.FromT(t)

	// cleanup previous data
	clean(&mconf, &fconf)

	n := 1000
	m, mc := prepareTest()
	mconfBak := mconf
	defer func() {
		// we added an endpoint so we
		// need to restore configuration
		mconf = mconfBak
		m.Shutdown()
		m.Wait()
	}()
	euuid := mc.Config.UUID

	// creating a new endpoint
	r := put(api.AdmAPIEndpointsPath)
	failOnAdminAPIError(t, r)

	npivot := 0
	buf := new(bytes.Buffer)
	for e := range emitEvents(n, false) {
		switch rand.Int() % 3 {
		case 0:
			e.Event.System.TimeCreated.SystemTime = e.Event.System.TimeCreated.SystemTime.Add(-time.Hour)
		case 1:
			e.Event.System.TimeCreated.SystemTime = e.Event.System.TimeCreated.SystemTime.Add(time.Hour)
		default:
			npivot++
		}
		buf.WriteString(format("%s\n", utils.JsonOrPanic(e)))
	}

	req, err := mc.PrepareGzip("POST", api.EptAPIPostLogsPath, buf)
	tt.CheckErr(err)
	_, err = mc.HTTPClient.Do(req)
	tt.CheckErr(err)

	time.Sleep(1 * time.Second)

	// test pivoting
	v := url.Values{}
	v.Set(api.QpPivot, time.Now().Format(time.RFC3339))
	v.Set(api.QpDelta, "1m")
	r = get(api.AdmAPIEndpointsPath + "/" + euuid + "/logs?" + v.Encode())
	tt.CheckErr(r.Err())

	data := make([]event.EdrEvent, 0)
	r.UnmarshalData(&data)
	tt.Assert(len(data) == npivot, format("Wrong number of events %d instead of %d", len(data), npivot))

	// test pivoting with delta
	v = url.Values{}
	v.Set(api.QpPivot, time.Now().Format(time.RFC3339))
	v.Set(api.QpDelta, "3h")
	r = get(api.AdmAPIEndpointsPath + "/" + euuid + "/logs?" + v.Encode())
	tt.CheckErr(r.Err())

	data = make([]event.EdrEvent, 0)
	r.UnmarshalData(&data)
	tt.Assert(len(data) == n, format("Wrong number of events %d instead of %d", len(data), len(events)))

	// test with start and stop
	v = url.Values{}
	v.Set(api.QpSince, time.Now().Add(-3*time.Hour).Format(time.RFC3339))
	v.Set(api.QpUntil, time.Now().Add(3*time.Hour).Format(time.RFC3339))
	r = get(api.AdmAPIEndpointsPath + "/" + euuid + "/logs?" + v.Encode())
	tt.CheckErr(r.Err())

	data = make([]event.EdrEvent, 0)
	r.UnmarshalData(&data)
	tt.Assert(len(data) == n, format("Wrong number of events %d instead of %d", len(data), len(events)))
}

func TestAdminAPIGetEndpointAlerts(t *testing.T) {

	tt := toast.FromT(t)

	// cleanup previous data
	clean(&mconf, &fconf)

	m, mc := prepareTest()
	mconfBak := mconf
	defer func() {
		// we added an endpoint so we
		// need to restore configuration
		mconf = mconfBak
		m.Shutdown()
		m.Wait()
	}()
	euuid := mc.Config.UUID

	// creating a new endpoint
	r := put(api.AdmAPIEndpointsPath)
	tt.CheckErr(r.Err())

	npivot := 0
	n, ndet := 1000, 100
	for e := range emitMixedEvents(n, ndet) {
		if e.IsDetection() {
			switch rand.Int() % 3 {
			case 0:
				e.Event.System.TimeCreated.SystemTime = e.Event.System.TimeCreated.SystemTime.Add(-time.Hour)
			case 1:
				e.Event.System.TimeCreated.SystemTime = e.Event.System.TimeCreated.SystemTime.Add(time.Hour)
			default:
				npivot++
			}
		}
		r, err := mc.PrepareGzip("POST", api.EptAPIPostLogsPath, bytes.NewBuffer(utils.JsonOrPanic(e)))
		tt.CheckErr(err)
		_, err = mc.HTTPClient.Do(r)
		tt.CheckErr(err)
	}

	time.Sleep(1 * time.Second)

	// test pivoting
	v := url.Values{}
	v.Set(api.QpPivot, time.Now().Format(time.RFC3339))
	r = get(api.AdmAPIEndpointsPath + "/" + euuid + api.AdmAPIDetectionSuffix + "?" + v.Encode())
	// checking response error
	tt.CheckErr(r.Err())

	data := make([]*event.EdrEvent, 0)
	r.UnmarshalData(&data)
	tt.Assert(len(data) == npivot, format("Wrong number of events %d instead of %d", len(data), npivot))

	// test pivoting with delta
	v = url.Values{}
	v.Set(api.QpPivot, time.Now().Format(time.RFC3339))
	v.Set(api.QpDelta, "3h")
	r = get(api.AdmAPIEndpointsPath + "/" + euuid + api.AdmAPIDetectionSuffix + "?" + v.Encode())
	// checking response error
	tt.CheckErr(r.Err())

	data = make([]*event.EdrEvent, 0)
	r.UnmarshalData(&data)
	tt.Assert(len(data) == ndet, format("Wrong number of events %d instead of %d", len(data), len(events)))

	// test with start and stop
	v = url.Values{}
	v.Set(api.QpSince, time.Now().Add(-3*time.Hour).Format(time.RFC3339))
	v.Set(api.QpUntil, time.Now().Add(3*time.Hour).Format(time.RFC3339))
	r = get(api.AdmAPIEndpointsPath + "/" + euuid + api.AdmAPIDetectionSuffix + "?" + v.Encode())
	// checking response error
	tt.CheckErr(r.Err())

	data = make([]*event.EdrEvent, 0)
	r.UnmarshalData(&data)
	tt.Assert(len(data) == ndet, format("Wrong number of events %d instead of %d", len(data), len(events)))
}

func TestEventStream(t *testing.T) {
	tt := toast.FromT(t)

	// cleanup previous data
	clean(&mconf, &fconf)

	m, mc := prepareTest()
	defer func() {
		m.Shutdown()
		m.Wait()
	}()

	expctd := float64(20000)
	total := float64(0)
	sumEps := float64(0)
	nclients := float64(4)
	wg := sync.WaitGroup{}

	for i := float64(0); i < nclients; i++ {

		u := url.URL{
			Scheme: "wss",
			Host:   format("%s:%d", mconf.AdminAPI.Host, mconf.AdminAPI.Port),
			Path:   api.AdmAPIStreamEvents}
		key := testAdminUser.Key
		dialer := *websocket.DefaultDialer
		dialer.TLSClientConfig = &tls.Config{InsecureSkipVerify: true}
		t.Logf("connecting to %s", u.String())
		c, resp, err := dialer.Dial(u.String(), http.Header{api.AuthKeyHeader: {key}})
		if err != nil {
			if err == websocket.ErrBadHandshake {
				t.Logf("handshake failed with status %d", resp.StatusCode)
			}
			t.Errorf("failed to dial: %s", err)
			t.FailNow()
		}
		defer c.Close()

		wg.Add(1)
		go func() {
			defer wg.Done()
			recvd := float64(0)
			start := time.Now()

			for {
				_, _, err := c.ReadMessage()
				tt.CheckErr(err)

				recvd++
				if recvd == expctd {
					break
				}
			}

			eps := recvd / float64(time.Since(start).Seconds())
			total += recvd
			// we take into account only normal clients
			sumEps += eps
			t.Logf("Normal client received %.1f EPS", eps)
		}()
	}

	// we have to split in chunks otherwise post may fail in WSL
	schunk := 5000
	for i := 0; i < int(expctd)/schunk; i++ {
		tt.CheckErr(mc.PostLogs(readerFromEvents(schunk)))
	}

	wg.Wait()

	tt.Assert(total == expctd*nclients, format("Received less events than expected received=%.0f VS expected=%.0f", total, expctd*nclients))

	t.Logf("Average %.1f EPS/client", sumEps/nclients)

}

```

`api/server/api_client_test.go`:

```go
package server

import (
	"encoding/json"
	"encoding/xml"
	"fmt"
	"math/rand"
	"path/filepath"
	"runtime"
	"strings"
	"testing"

	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/golang-utils/crypto/file"
	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/ioc"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/utils"
)

func TestClientGetRules(t *testing.T) {

	tt := toast.FromT(t)
	m, c := prep()
	defer cleanup(m)

	rules, err := c.GetRules()
	tt.CheckErr(err)

	sha256, err := c.GetRulesSha256()
	tt.CheckErr(err)
	tt.Assert(sha256 == data.Sha256([]byte(rules)))
}

func TestClientPostDump(t *testing.T) {
	var err error

	tt := toast.FromT(t)
	m, c := prep()
	defer cleanup(m)

	for wi := range fswalker.Walk("./dumps") {
		for _, fi := range wi.Files {
			var shrink *client.UploadShrinker
			sp := strings.Split(wi.Dirpath, "/")
			guid := sp[len(sp)-2]
			ehash := sp[len(sp)-1]
			path := filepath.Join(wi.Dirpath, fi.Name())

			shrink, err = client.NewUploadShrinker(path, guid, ehash)
			tt.CheckErr(err)

			for fu := shrink.Next(); fu != nil; fu = shrink.Next() {
				tt.CheckErr(c.PostDump(fu))
			}

			tt.CheckErr(shrink.Err())
		}
	}
}
func TestClientContainer(t *testing.T) {

	tt := toast.FromT(t)
	m, c := prep()
	defer cleanup(m)

	niocs := 1000
	iocs := make([]ioc.IOC, 0, niocs)
	del := 0
	guuid := utils.UUIDOrPanic().String()
	toDelGuuid := utils.UUIDOrPanic().String()
	for i := 0; i < niocs; i++ {
		key := guuid
		if rand.Int()%3 == 0 {
			key = toDelGuuid
			del++
		}

		iocs = append(iocs, ioc.IOC{
			Uuid:      utils.UUIDOrPanic().String(),
			GroupUuid: key,
			Source:    "Test",
			Value:     fmt.Sprintf("%d.random.com", i),
			Type:      "domain",
		})
	}

	// posting IOCs to manager
	r := post(api.AdmAPIIocsPath, JSON(iocs))
	tt.CheckErr(r.Err())

	// getting IOCs on client
	strIocs, err := c.GetIoCs()
	tt.CheckErr(err)
	// we must have the same number of iocs
	tt.Assert(len(strIocs) == niocs)
	// we control that the integrity of what we received
	rsha256, _ := c.GetIoCsSha256()
	tt.Assert(rsha256 == utils.Sha256StringSlice(strIocs))

	// deleting iocs from admin API
	req := prepare("DELETE",
		api.AdmAPIIocsPath,
		nil,
		map[string]string{api.QpGroupUuid: toDelGuuid})
	r = do(req)
	tt.CheckErr(r.Err())

	strIocs, err = c.GetIoCs()
	tt.CheckErr(err)
	tt.Assert(len(strIocs) == niocs-del)
	rsha256, _ = c.GetIoCsSha256()
	// control integrity of what we downloaded
	tt.Assert(rsha256 == utils.Sha256StringSlice(strIocs))
}

func TestClientExecuteCommand(t *testing.T) {
	var cmdline string
	var cmd *api.EndpointCommand
	var err error

	tt := toast.FromT(t)
	m, c := prep()
	defer cleanup(m)

	cmd = api.NewEndpointCommand()

	switch runtime.GOOS {
	case "windows":
		cmdline = "cmd /c dir"
	default:
		cmdline = "/usr/bin/ls -hail ./"
	}

	tt.CheckErr(cmd.SetCommandLine(cmdline))
	tt.CheckErr(m.AddCommand(cconf.UUID, cmd))

	// client fetching command to execute
	cmd, err = c.FetchCommand()
	tt.CheckErr(err)
	// running command
	tt.CheckErr(cmd.Run())
	// posting back command to manager
	tt.CheckErr(c.PostCommand(cmd))

	// manager fetching command
	cmd, err = m.GetCommand(cconf.UUID)
	tt.CheckErr(err)
	// we expect some output
	tt.Assert(len(cmd.Stdout) > 0)

	t.Logf("Stdout of command executed: %s", string(cmd.Stdout))

}
func TestClientExecuteDroppedCommand(t *testing.T) {
	var cmd *api.EndpointCommand
	var err error
	var dropname, dropfile, fetchfile, cmdline string

	tt := toast.FromT(t)
	m, c := prep()
	defer cleanup(m)

	switch runtime.GOOS {
	case "windows":
		dropname = `./dropped.exe`
		dropfile = `C:\Windows\System32\cmd.exe`
		fetchfile = `C:\Windows\System32\reg.exe`
		cmdline = format("%s /c dir C:", dropname)

	default:
		dropname = "./dropped"
		dropfile = "/usr/bin/ls"
		fetchfile = "/usr/bin/true"
		cmdline = format("%s -hail", dropname)
	}

	cmd = api.NewEndpointCommand()
	// adding files to drop
	tt.CheckErr(cmd.AddDropFile(dropname, dropfile))

	// adding files to fetch
	cmd.AddFetchFile(fetchfile)
	cmd.AddFetchFile("/nonexistingfile")

	// setting up the command line to be executed
	tt.CheckErr(cmd.SetCommandLine(cmdline))
	// create the command on manager's side
	tt.CheckErr(m.AddCommand(cconf.UUID, cmd))

	// fetching the command on client side
	cmd, err = c.FetchCommand()
	tt.CheckErr(err)
	// running command
	tt.CheckErr(cmd.Run())
	tt.CheckErr(cmd.Err())
	// posting back command to manager
	tt.CheckErr(c.PostCommand(cmd))

	// getting command on manager's side
	cmd, err = m.GetCommand(cconf.UUID)
	tt.CheckErr(err)
	// expecting some output on stdout
	tt.Assert(len(cmd.Stdout) != 0)

	t.Logf("Stdout of command executed: %s", string(cmd.Stdout))

	expMD5, err := file.Md5(fetchfile)
	tt.CheckErr(err)
	// checking that the file we fetched corresponds to the one on disk
	tt.Assert(data.Md5(cmd.Fetch[fetchfile].Data) == expMD5)
	// we must get an error for non existing file
	tt.Assert(cmd.Fetch["/nonexistingfile"].Error != "")

	t.Logf(cmd.Fetch["/nonexistingfile"].Error)
}

func TestClientSysmonConfig(t *testing.T) {
	var err error

	sversion := "4.70"
	tt := toast.FromT(t)
	m, c := prep()
	defer cleanup(m)

	// test emptyness
	sha256, err := c.GetSysmonConfigSha256(sversion)
	tt.ExpectErr(err, client.ErrNoSysmonConfig)
	tt.Assert(sha256 == "")

	_, err = c.GetSysmonConfig(sversion)
	tt.ExpectErr(err, client.ErrNoSysmonConfig)

	// preparing sysmon config structure
	cfg := &sysmon.Config{}
	tt.CheckErr(xml.Unmarshal([]byte(sysmonXMLConfig), &cfg))
	cfg.OS = los.OS
	cfgSha256, err := cfg.Sha256()
	tt.CheckErr(err)

	// adding sysmon config and testing sha256
	tt.CheckErr(m.db.InsertOrUpdate(cfg))
	sha256, err = c.GetSysmonConfigSha256(sversion)
	tt.CheckErr(err)
	tt.Assert(sha256 == cfgSha256)

	remoteCfg, err := c.GetSysmonConfig(sversion)
	tt.CheckErr(err)
	tt.Assert(remoteCfg.XmlSha256 == sha256)

	b, err := json.MarshalIndent(remoteCfg, "", "  ")
	tt.CheckErr(err)
	t.Log(string(b))
}

```

`api/server/command.go`:

```go
package server

import (
	"time"

	"github.com/0xrawsec/whids/api"
)

// CommandAPI structure used by Admin API clients to POST commands
type CommandAPI struct {
	CommandLine string        `json:"command-line"`
	FetchFiles  []string      `json:"fetch-files"`
	DropFiles   []string      `json:"drop-files"`
	Timeout     time.Duration `json:"timeout"`
}

// ToCommand converts a CommandAPI to an EndpointCommand
func (c *CommandAPI) ToCommand() (*api.EndpointCommand, error) {
	cmd := api.NewEndpointCommand()
	// adding command line
	if err := cmd.SetCommandLine(c.CommandLine); err != nil {
		return cmd, err
	}

	// adding files to fetch
	for _, ff := range c.FetchFiles {
		cmd.AddFetchFile(ff)
	}

	// adding files to drop on the endpoint
	for _, df := range c.DropFiles {
		cmd.AddDropFileFromPath(df)
	}

	cmd.Timeout = c.Timeout

	return cmd, nil
}

```

`api/server/config_test.go`:

```go
package server

import (
	"time"

	"github.com/0xrawsec/whids/api/client/config"
)

var (
	mconf = ManagerConfig{
		AdminAPI: AdminAPIConfig{
			Host: "localhost",
			Port: randport(),
		},
		EndpointAPI: EndpointAPIConfig{
			Host: "",
			Port: randport(),
		},
		Logging: ManagerLogConfig{
			Root:        "./data/logs",
			LogBasename: "alerts",
		},
		Database: "./data/database",
		DumpDir:  "./data/uploads/",
		TLS: TLSConfig{
			Cert: "./data/cert.pem",
			Key:  "./data/key.pem",
		},
	}

	cconf = makeClientConfig(&mconf)

	fconf = makeForwarderConfig(&mconf)
)

func makeClientConfig(mc *ManagerConfig) config.Client {
	return config.Client{
		Proto:             "https",
		Host:              "localhost",
		Port:              mc.EndpointAPI.Port,
		UUID:              "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
		Key:               "don'tcomplain",
		ServerFingerprint: "511dc40cb2363974a97dfd47437feb8307cbd9d938645e1442775aa97ec14227",
		Unsafe:            true,
	}
}

func makeForwarderConfig(mc *ManagerConfig) config.Forwarder {
	return config.Forwarder{
		Client: cconf,
		Logging: config.ForwarderLogging{
			Dir:              "./data/Queued",
			RotationInterval: time.Second * 2,
		},
	}
}

```

`api/server/forwarder_test.go`:

```go
package server

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"io"
	"math"
	"math/rand"
	"os"
	"path/filepath"
	"sync"
	"testing"
	"time"

	"github.com/0xrawsec/golang-utils/readers"
	"github.com/0xrawsec/golang-utils/sync/semaphore"
	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/api/client/config"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/logger"
	"github.com/0xrawsec/whids/utils"
)

var (
	eventFile = "./data/events.json"
	events    = make([]event.EdrEvent, 0)
)

func init() {
	// initialize random generator's seed
	rand.Seed(time.Now().UnixNano())

	data, err := os.ReadFile(eventFile)
	if err != nil {
		panic(err)
	}
	for line := range readers.Readlines(bytes.NewBuffer(data)) {
		event := event.EdrEvent{}
		json.Unmarshal(line, &event)
		events = append(events, event)
	}
}

func randport() (port int) {
	for ; port <= 10000; port = rand.Intn(65535) {
	}
	return
}

func emitEvents(count int, detection bool) (ce chan *event.EdrEvent) {
	ce = make(chan *event.EdrEvent)
	go func() {
		defer close(ce)
		for count > 0 {
			i := rand.Int() % len(events)
			e := events[i]
			if detection && !e.IsDetection() {
				continue
			}
			if !detection && e.IsDetection() {
				continue
			}
			e.Event.System.TimeCreated.SystemTime = time.Now()
			ce <- &e
			count--
		}
	}()
	return
}

func emitMixedEvents(ecount, dcount int) (ce chan *event.EdrEvent) {
	ce = make(chan *event.EdrEvent)
	go func() {
		defer close(ce)
		for ecount > 0 || dcount > 0 {
			i := rand.Int() % len(events)
			e := events[i]
			if dcount == 0 && e.IsDetection() {
				continue
			}
			if ecount == 0 && !e.IsDetection() {
				continue
			}
			e.Event.System.TimeCreated.SystemTime = time.Now()
			ce <- &e
			if e.IsDetection() {
				dcount--
			} else {
				ecount--
			}
		}
	}()
	return
}

func countEvents(s *logger.EventSearcher) (n int) {
	for range s.Events(time.Now().Add(-time.Hour), time.Now().Add(time.Hour), "", math.MaxInt, 0) {
		n++
	}
	return

}

func readerFromEvents(count int) io.Reader {
	buf := new(bytes.Buffer)
	for event := range emitEvents(count, false) {
		buf.WriteString(format("%s\n", string(utils.JsonOrPanic(event))))
	}
	return buf
}

func clean(mc *ManagerConfig, fc *config.Forwarder) {
	os.RemoveAll(mc.Database)
	os.RemoveAll(mc.Logging.Root)
	os.RemoveAll(fc.Logging.Dir)
}

func TestForwarderBasic(t *testing.T) {
	clean(&mconf, &fconf)
	//defer clean(&mconf, &fconf)

	nevents := 1000
	key := utils.NewKeyOrPanic(api.DefaultKeySize)
	testfile := "Testlog.gz"
	mconf.Logging.LogBasename = testfile

	r, err := NewManager(&mconf)
	if err != nil {
		panic(err)
	}
	r.AddEndpoint(cconf.UUID, key)
	r.Run()

	fconf.Client.Key = key
	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	f, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
	if err != nil {
		t.Errorf("Failed to create collector: %s", err)
		t.FailNow()
	}
	f.Run()
	defer f.Close()

	cnt := 0
	for e := range emitEvents(nevents, false) {
		if cnt == 500 {
			time.Sleep(2 * time.Second)
		}
		if err := f.PipeEvent(e); err != nil {
			t.Errorf("failed to pipe event: %s", err)
		}
	}
	time.Sleep(5 * time.Second)

	// shuts down the receiver before counting lines
	r.Shutdown()
	if n := countEvents(r.eventSearcher); n != nevents {
		t.Errorf("Some events were lost on the way: %d logged by server instead of %d sent", n, nevents)
	}

	t.Log("Shutting down")
}

func TestCollectorAuthFailure(t *testing.T) {
	clean(&mconf, &fconf)
	defer clean(&mconf, &fconf)

	nevents := 1000
	testfile := "TestServerAuthFailure.log.gz"
	key := utils.NewKeyOrPanic(api.DefaultKeySize)
	serverKey := "rogueserver"
	mconf.Logging.LogBasename = testfile

	clean(&mconf, &fconf)

	mconf.EndpointAPI.ServerKey = serverKey
	r, err := NewManager(&mconf)
	if err != nil {
		panic(err)
	}
	r.AddEndpoint(cconf.UUID, key)
	r.Run()
	defer r.Shutdown()

	fconf.Client.Key = key
	fconf.Client.ServerKey = utils.NewKeyOrPanic(api.DefaultKeySize)

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	f, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
	if err != nil {
		t.Errorf("Failed to create collector: %s", err)
		t.FailNow()
	}
	f.Run()
	defer f.Close()

	cnt := 0
	for e := range emitEvents(nevents, false) {
		if cnt == 500 {
			time.Sleep(2 * time.Second)
		}
		if err := f.PipeEvent(e); err != nil {
			t.Errorf("failed to pipe event: %s", err)
		}
	}
	time.Sleep(5 * time.Second)

	// shuts down the receiver before counting lines
	r.Shutdown()
	if n := countEvents(r.eventSearcher); n != 0 {
		t.Errorf("Some events were logged while it should not")
	}
}

func TestCollectorAuthSuccess(t *testing.T) {
	clean(&mconf, &fconf)
	defer clean(&mconf, &fconf)

	nevents := 1000
	testfile := "TestServerAuthSuccess.log.gz"
	key := utils.NewKeyOrPanic(api.DefaultKeySize)
	serverKey := utils.NewKeyOrPanic(api.DefaultKeySize)
	mconf.Logging.LogBasename = testfile
	mconf.EndpointAPI.ServerKey = serverKey

	r, err := NewManager(&mconf)
	if err != nil {
		panic(err)
	}
	r.AddEndpoint(cconf.UUID, key)
	r.Run()
	defer r.Shutdown()

	fconf.Client.Key = key
	fconf.Client.ServerKey = serverKey

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	f, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
	if err != nil {
		t.Errorf("Failed to create collector: %s", err)
		t.FailNow()
	}
	f.Run()
	defer f.Close()

	cnt := 0
	for e := range emitEvents(nevents, false) {
		if cnt == 500 {
			time.Sleep(2 * time.Second)
		}
		if err := f.PipeEvent(e); err != nil {
			t.Errorf("failed to pipe event: %s", err)
		}
	}
	time.Sleep(5 * time.Second)

	// shuts down the receiver before counting lines
	r.Shutdown()
	if n := countEvents(r.eventSearcher); n != nevents {
		t.Errorf("Some events were lost on the way: %d logged by server instead of %d sent", n, nevents)
	}
}

func TestForwarderParallel(t *testing.T) {

	if testing.Short() {
		t.Skip()
	}

	clean(&mconf, &fconf)
	defer clean(&mconf, &fconf)

	jobs := semaphore.New(10)
	nclients, nevents := 100, 1000
	wg := sync.WaitGroup{}
	testfile := "TestCollectorParallel.log.gz"
	key := utils.NewKeyOrPanic(api.DefaultKeySize)
	mconf.Logging.LogBasename = testfile

	r, err := NewManager(&mconf)
	if err != nil {
		panic(err)
	}
	r.AddEndpoint(cconf.UUID, key)
	r.Run()
	defer r.Shutdown()

	for i := 0; i < nclients; i++ {
		wg.Add(1)
		jobs.Acquire()
		go func() {
			defer jobs.Release()
			defer wg.Done()
			fconf.Client.Key = key

			ctx, cancel := context.WithCancel(context.Background())
			defer cancel()

			c, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
			if err != nil {
				t.Errorf("Failed to create collector: %s", err)
			}
			c.Run()
			defer c.Close()
			for e := range emitEvents(nevents, false) {
				if err := c.PipeEvent(e); err != nil {
					t.Errorf("failed to pipe event: %s", err)
				}
			}
			time.Sleep(2 * time.Second)
		}()
	}
	wg.Wait()
	time.Sleep(2 * time.Second)

	// shuts down the receiver before counting lines
	r.Shutdown()
	if n := countEvents(r.eventSearcher); n != nclients*nevents {
		t.Errorf("Some events were lost on the way: %d logged by server instead of %d sent", n, nclients*nevents)
	}
}

func TestForwarderQueueBasic(t *testing.T) {
	// cleanup
	clean(&mconf, &fconf)
	defer clean(&mconf, &fconf)

	nevents := 1000
	testfile := "TestCollectorQueue.log"
	//outfile := fmt.Sprintf("%s.1", testfile)

	// Initialize the receiver
	key := utils.NewKeyOrPanic(api.DefaultKeySize)
	mconf.Logging.LogBasename = testfile
	clean(&mconf, &fconf)

	r, err := NewManager(&mconf)
	if err != nil {
		panic(err)
	}
	r.AddEndpoint(cconf.UUID, key)

	// Inititialize the forwarder
	fconf.Client.Key = key

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	f, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
	if err != nil {
		t.Errorf("Failed to create collector: %s", err)
		t.FailNow()
	}
	// Running the forwarder
	f.Run()
	defer f.Close()

	// Sending events
	for e := range emitEvents(nevents/2, false) {
		if err := f.PipeEvent(e); err != nil {
			t.Errorf("failed to pipe event: %s", err)
		}
	}

	// Running the receiver after the events have been
	// piped by the forwarder, to queue events
	time.Sleep(5 * time.Second)
	r.Run()

	// Wait the forwarder send the events
	time.Sleep(5 * time.Second)

	// Simulate first shutdown
	r.Shutdown()

	// Sending another wave of events
	for e := range emitEvents(nevents/2, false) {
		if err := f.PipeEvent(e); err != nil {
			t.Errorf("failed to pipe event: %s", err)
		}
	}

	// reinitialize a Receiver
	r, err = NewManager(&mconf)
	if err != nil {
		panic(err)
	}
	r.AddEndpoint(cconf.UUID, key)
	r.Run()

	time.Sleep(5 * time.Second)

	// shuts down the receiver before counting lines
	r.Shutdown()
	if n := countEvents(r.eventSearcher); n != nevents {
		t.Errorf("Some events were lost on the way: %d logged by server instead of %d sent", n, nevents)
	}
}

func TestForwarderCleanup(t *testing.T) {

	tt := toast.FromT(t)

	// cleanup
	clean(&mconf, &fconf)
	defer clean(&mconf, &fconf)

	// Change rotation interval not to create unexpected number of files
	fconf.Logging.RotationInterval = time.Hour

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	// Inititialize the forwarder
	f, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
	tt.CheckErr(err)
	// decreases sleep time to speed up test
	f.Sleep = time.Millisecond * 500
	// Running the forwarder
	f.Run()
	defer f.Close()

	// create bogus files inside queue directory
	numberOfQueuedFiles := client.DiskSpaceThreshold / client.DefaultLogfileSize
	numberOfFilesToDelete := 10
	for i := 0; i < numberOfQueuedFiles+numberOfFilesToDelete; i++ {
		fp := filepath.Join(fconf.Logging.Dir, fmt.Sprintf("queue.bogus.%d", i))
		fd, err := os.Create(fp)
		tt.CheckErr(err)

		buf := make([]byte, 4096)
		rand.Read(buf)
		for written := 0; written < client.DefaultLogfileSize; {
			n, err := fd.Write(buf)
			tt.CheckErr(err)
			written += n
		}
		fd.Close()
	}

	// send enough events to trigger cleanup
	// every loop should trigger a cleanup
	for i := 0; i < numberOfFilesToDelete; i++ {
		for e := range emitEvents(int(f.EventTresh), false) {
			if err := f.PipeEvent(e); err != nil {
				t.Errorf("failed to pipe event: %s", err)
			}
		}
		time.Sleep(1 * time.Second)
	}

	// closing the forwarder triggers last cleanup
	f.Close()

	files, _ := os.ReadDir(fconf.Logging.Dir)
	// we expect the number of queued files + file to log alerts
	expected := numberOfQueuedFiles + 1
	tt.Assert(len(files) == expected, format("Expecting %d remaining in directory but got %d", expected, len(files)))
}

```

`api/server/log_streamer.go`:

```go
package server

import (
	"math/rand"
	"sync"
	"time"

	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/whids/event"
)

type LogStream struct {
	closed bool
	queue  datastructs.Fifo
	S      chan *event.EdrEvent
}

func (s *LogStream) Queue(e *event.EdrEvent) bool {
	if s.closed {
		return false
	}
	s.queue.Push(e)
	return true
}

func (s *LogStream) Stream() {
	go func() {
		defer close(s.S)
		for !s.closed {
			if i := s.queue.Pop(); i != nil {
				e := i.Value.(*event.EdrEvent)
				s.S <- e
			} else {
				time.Sleep(time.Millisecond * 50)
			}
		}
	}()
}

func (s *LogStream) Close() {
	s.closed = true
}

type EventStreamer struct {
	sync.RWMutex
	streams map[int]*LogStream
}

func NewEventStreamer() *EventStreamer {
	return &EventStreamer{
		streams: map[int]*LogStream{},
	}
}

func (s *EventStreamer) NewStream() *LogStream {
	s.Lock()
	defer s.Unlock()
	ls := &LogStream{S: make(chan *event.EdrEvent), queue: datastructs.Fifo{}}
	s.streams[s.newId()] = ls
	return ls
}

func (s *EventStreamer) newId() int {
	var id int
	for {
		id = rand.Int()
		if _, ok := s.streams[id]; !ok {
			return id
		}
	}
}

func (s *EventStreamer) Queue(e *event.EdrEvent) {
	s.Lock()
	defer s.Unlock()
	// we queue only if there is at least a stream open
	if len(s.streams) > 0 {
		for id, stream := range s.streams {
			if ok := stream.Queue(e); !ok {
				delete(s.streams, id)
			}
		}
	}
}

```

`api/server/manager.go`:

```go
package server

import (
	"bytes"
	"compress/gzip"
	"context"
	crand "crypto/rand"
	"crypto/sha256"
	"encoding/hex"
	"encoding/json"
	"errors"
	"fmt"
	"math"
	"math/big"
	"math/rand"
	"net"
	"net/http"
	"os"
	"path/filepath"
	"regexp"
	"runtime"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/ioc"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils"
	"github.com/pelletier/go-toml/v2"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/gene/v2/reducer"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/whids/logger"
)

const (
	// IoCContainerName default container name to store manager's IoCs
	IoCContainerName = "edr_iocs"
)

var (
	noBracketGuidRe = regexp.MustCompile(`(?i:[a-f0-9]{8}-([a-f0-9]{4}-){3}[a-f0-9]{12})`)
)

func init() {
	// tries to initialize the math random generator with random seed
	i, err := crand.Int(crand.Reader, big.NewInt(math.MaxInt64))
	if err != nil {
		panic(err)
	}
	rand.Seed(i.Int64())
}

///////////////////// Utils

// IPFromRequest extracts the user IP address from req, if present.
// source: https://blog.golang.org/context/userip/userip.go
func IPFromRequest(req *http.Request) (net.IP, error) {
	ip, _, err := net.SplitHostPort(req.RemoteAddr)
	if err != nil {
		return nil, fmt.Errorf("%q is not IP:port", req.RemoteAddr)
	}

	userIP := net.ParseIP(ip)
	if userIP == nil {
		return nil, fmt.Errorf("%q is not IP:port", req.RemoteAddr)
	}
	return userIP, nil
}

func (m *Manager) gunzipMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		if r.Header.Get("Content-Encoding") == "gzip" {
			var err error
			if r.Body, err = gzip.NewReader(r.Body); err != nil {
				http.Error(w, "Cannot create gzip reader", http.StatusInternalServerError)
				m.Logger.Errorf("Failed to create reader to uncompress request: %s", err)
				return
			}
		}
		next.ServeHTTP(w, r)
	})
}

//////////////////// TLSConfig

// TLSConfig structure definition
type TLSConfig struct {
	Cert string `toml:"cert" comment:"Path to the certificate file to use for TLS connections"`
	Key  string `toml:"key" comment:"Path to the key to use for TLS connection"`
}

// Empty returns true if current TLSConfig is empty else false
func (t *TLSConfig) Empty() bool {
	return *t == TLSConfig{}
}

// Verify checks whether the files holding cert and key exist
func (t *TLSConfig) Verify() error {
	switch {
	case !fsutil.IsFile(t.Cert):
		return fmt.Errorf("certificate file (%s) not found", t.Cert)
	case !fsutil.IsFile(t.Key):
		return fmt.Errorf("key file (%s) not found", t.Key)
	}
	return nil
}

/////////////////////// Manager

// EndpointAPIConfig structure holding configuration for the API used by endpoints
type EndpointAPIConfig struct {
	Host      string `toml:"host" comment:"Hostname or IP where the API should listen to"`
	Port      int    `toml:"port" comment:"Port used by the API"`
	ServerKey string `toml:"server-key" comment:"Server key used to do basic authentication of the server on clients.\n Configure certificate pinning on client offers better security."`
}

// ManagerLogConfig structure to hold manager's logging configuration
type ManagerLogConfig struct {
	Root        string `toml:"root" comment:"Root directory where logfiles are stored"`
	LogBasename string `toml:"logfile" comment:"Logfile name (relative to root) used to store logs"`
	VerboseHTTP bool   `toml:"verbose-http" comment:"Enables verbose HTTP logs\n When disabled beaconing requests are filtered out"`
}

// ManagerConfig defines manager's configuration structure
type ManagerConfig struct {
	// TOML strings need to be first otherwise issue parsing back config
	Database    string            `toml:"db" comment:"Path to store database"`
	Repair      bool              `toml:"repair-db" comment:"Attempt to repair broken database"`
	DumpDir     string            `toml:"dump-dir" comment:"Directory where to dump artifacts collected on hosts"`
	AdminAPI    AdminAPIConfig    `toml:"admin-api" comment:"Settings to configure administrative API (not supposed to be reachable by endpoints)"`
	EndpointAPI EndpointAPIConfig `toml:"endpoint-api" comment:"Settings to configure API used by endpoints"`
	Logging     ManagerLogConfig  `toml:"logging" comment:"Logging settings"`
	TLS         TLSConfig         `toml:"tls" comment:"TLS settings. Leave empty, not to use TLS"`
	path        string
}

// LoadManagerConfig loads the manager configuration from a file
func LoadManagerConfig(path string) (*ManagerConfig, error) {
	mc := ManagerConfig{}
	b, err := os.ReadFile(path)
	if err != nil {
		return nil, err
	}
	err = toml.Unmarshal(b, &mc)
	mc.path = path
	return &mc, err
}

// SetPath exposes the path member for changes
func (mc *ManagerConfig) SetPath(path string) {
	mc.path = path
}

// EndpointAPIUrl returns the URL of the Endpoint API
func (mc *ManagerConfig) EndpointAPIUrl() string {
	proto := "https"
	if mc.TLS.Empty() {
		proto = "http"
	}

	return fmt.Sprintf("%s://%s:%d", proto, mc.EndpointAPI.Host, mc.EndpointAPI.Port)
}

// EndpointAPIUrl returns the URL of the Admin API
func (mc *ManagerConfig) AdminAPIUrl() string {
	proto := "https"
	if mc.TLS.Empty() {
		proto = "http"
	}

	return fmt.Sprintf("%s://%s:%d", proto, mc.AdminAPI.Host, mc.AdminAPI.Port)
}

// Save saves the configuration to a path specified by the path member of the structure
func (mc *ManagerConfig) Save() error {
	b, err := toml.Marshal(mc)
	if err != nil {
		return err
	}
	return os.WriteFile(mc.path, b, 0650)
}

// Manager structure definition
type Manager struct {
	sync.RWMutex
	/* Private */
	db                *sod.DB
	eventStreamer     *EventStreamer
	eventLogger       *logger.EventLogger
	eventSearcher     *logger.EventSearcher
	detectionLogger   *logger.EventLogger
	detectionSearcher *logger.EventSearcher
	endpointAPI       *http.Server
	adminAPI          *http.Server
	stop              chan bool
	done              bool

	// Gene related members
	gene struct {
		engine  *engine.Engine
		reducer *reducer.Reducer
		rules   string // to cache the rules concatenated
		sha256  string // rules integrity check and update
	}

	iocs *ioc.IoCs

	/* Public */
	Logger *golog.Logger
	Config *ManagerConfig
}

// NewManager creates a new WHIDS manager with a logfile as parameter
func NewManager(c *ManagerConfig) (*Manager, error) {
	var err error

	m := Manager{
		iocs:   ioc.NewIocs(),
		Logger: golog.FromStdout(),
		Config: c}

	eventDir := filepath.Join(c.Logging.Root, "events")
	m.eventLogger = logger.NewEventLogger(eventDir, c.Logging.LogBasename, utils.Giga)
	m.eventSearcher = logger.NewEventSearcher(eventDir)
	detectionDir := filepath.Join(c.Logging.Root, "detections")
	m.detectionLogger = logger.NewEventLogger(detectionDir, "logs.gz", utils.Giga)
	m.detectionSearcher = logger.NewEventSearcher(detectionDir)

	// database initialization
	m.db = sod.Open(c.Database)

	// Create a new streamer
	m.eventStreamer = NewEventStreamer()

	if c.EndpointAPI.Port <= 0 || c.EndpointAPI.Port > 65535 {
		return nil, fmt.Errorf("manager Endpoint API Error: invalid port to listen to %d", c.EndpointAPI.Port)
	}

	if c.AdminAPI.Port <= 0 || c.AdminAPI.Port > 65535 {
		return nil, fmt.Errorf("manager Admin API Error: invalid port to listen to %d", c.EndpointAPI.Port)
	}

	if err := os.MkdirAll(c.Logging.Root, utils.DefaultFilePerm); err != nil {
		return nil, fmt.Errorf("failed at creating log directory: %s", err)
	}

	if err := m.initializeDB(); err != nil {
		return nil, fmt.Errorf("failed to initialize manager's database: %w", err)
	}

	// initialize IoCs from db
	m.iocs.FromDB(m.db)

	m.stop = make(chan bool)
	if err = c.TLS.Verify(); err != nil && !c.TLS.Empty() {
		return nil, err
	}

	// Gene components initialization
	if err := m.initializeGeneFromDB(); err != nil {
		return &m, fmt.Errorf("manager cannot initialize gene components: %s", err)
	}

	// Dump Directory initialization
	if m.Config.DumpDir != "" && !fsutil.IsDir(m.Config.DumpDir) {
		if err := os.MkdirAll(m.Config.DumpDir, utils.DefaultFilePerm); err != nil {
			return &m, fmt.Errorf("failed to created dump directory (%s): %s", m.Config.DumpDir, err)
		}
	}
	return &m, nil
}

func (m *Manager) createTableOrRepair(o sod.Object, s sod.Schema) (err error) {
	// if everything went fine we return
	if err = m.db.Create(o, s); err == nil {
		return
	}

	// if err is something else than an index corruption error
	if !sod.IsIndexCorrupted(err) {
		return
	}

	// we repair DB if wanted
	if m.Config.Repair {
		return m.db.Repair(o)
	}

	return
}

func (m *Manager) initializeDB() (err error) {

	// Creating Endpoint table
	endpointSchema := sod.DefaultSchema
	endpointSchema.Asynchrone(100, 10*time.Second)
	if err = m.createTableOrRepair(&api.Endpoint{}, endpointSchema); err != nil {
		return
	}

	// Creating AdminAPIUser table
	if err = m.createTableOrRepair(&AdminAPIUser{}, sod.DefaultSchema); err != nil {
		return
	}

	// Creating IOC table
	if err = m.createTableOrRepair(&ioc.IOC{}, sod.DefaultSchema); err != nil {
		return
	}

	// Creating Sysmon config table
	if err = m.createTableOrRepair(&sysmon.Config{}, sod.DefaultSchema); err != nil {
		return
	}

	// Creating Tools table
	if err = m.createTableOrRepair(&tools.Tool{}, sod.DefaultSchema); err != nil {
		return
	}

	// Create schema for ArchivedReport
	// we need to set indexed fields manually here as we don't
	// have access to ReducedStats structure
	archReportsDesc := sod.FieldDescriptors(&api.ArchivedReport{})
	archReportsDesc.Constraint("Identifier", sod.Constraints{Index: true})
	archReportsDesc.Constraint("ArchivedTimestamp", sod.Constraints{Index: true})
	archivedReportSchema := sod.NewCustomSchema(archReportsDesc, sod.DefaultExtension)

	if err = m.createTableOrRepair(&api.ArchivedReport{}, archivedReportSchema); err != nil {
		return
	}

	// Create schema for EdrRule
	rulesDesc := sod.FieldDescriptors(&api.EdrRule{})
	rulesDesc.Constraint("Name", sod.Constraints{Index: true, Unique: true})
	rulesSchema := sod.NewCustomSchema(rulesDesc, ".gen")

	if err = m.createTableOrRepair(&api.EdrRule{}, rulesSchema); err != nil {
		return
	}

	return
}

func (m *Manager) initializeGeneFromDB() error {
	engine := engine.NewEngine()
	engine.SetDumpRaw(true)

	reducer := reducer.NewReducer(engine)

	if objs, err := m.db.All(&api.EdrRule{}); err != nil {
		return err
	} else {
		for _, o := range objs {
			rule := o.(*api.EdrRule)
			if err := engine.LoadRule(&rule.Rule); err != nil {
				return fmt.Errorf("fail to load rule %s: %s", rule.Name, err)
			}
		}
	}

	// we update gene components only if no error is met
	m.gene.engine = engine
	m.gene.reducer = reducer
	m.updateRulesCache()

	return nil

}

func (m *Manager) updateRulesCache() {
	sha256 := sha256.New()
	buf := new(bytes.Buffer)
	for rr := range m.gene.engine.GetRawRule(".*") {
		chunk := []byte(rr + "\n")
		buf.Write(chunk)
		sha256.Write(chunk)
	}
	m.gene.rules = buf.String()
	m.gene.sha256 = hex.EncodeToString(sha256.Sum(nil))
}

// AddCommand sets a command to be executed on endpoint specified by UUID
func (m *Manager) AddCommand(uuid string, c *api.EndpointCommand) error {
	if endpt, ok := m.Endpoint(uuid); ok {
		endpt.Command = c
		return m.db.InsertOrUpdate(endpt)
	}
	return ErrUnkEndpoint
}

// GetCommand gets the command set for an endpoint specified by UUID
func (m *Manager) GetCommand(uuid string) (*api.EndpointCommand, error) {
	if endpt, ok := m.Endpoint(uuid); ok {
		// We return the command of an unmutable endpoint struct
		// so if Command is modified this will not affect Endpoint
		return endpt.Command, nil
	}
	return nil, ErrUnkEndpoint
}

// Endpoint returns an Endpoint pointer from database
// Result must be handled with care as any change to the Endpoint
// might be commited to the database. If an Endpoint needs to be
// modified but changes don't need to be commited, use Endpoint.Copy()
// to work on a copy
func (m *Manager) Endpoint(uuid string) (*api.Endpoint, bool) {
	if o, err := m.db.GetByUUID(&api.Endpoint{}, uuid); err == nil {
		// we return copy to endpoints not to modify cached structures
		return o.(*api.Endpoint), true
	}
	return nil, false
}

// Endpoints returns a slice of Endpoint pointers from database
// Result must be handled with care as any change to the Endpoint
// might be commited to the database. If an Endpoint needs to be
// modified but changes don't need to be commited, use Endpoint.Copy()
// to work on a copy
func (m *Manager) Endpoints() (endpoints []*api.Endpoint, err error) {
	var all []sod.Object

	if all, err = m.db.All(&api.Endpoint{}); err != nil {
		return
	}

	endpoints = make([]*api.Endpoint, 0, len(all))
	for _, o := range all {
		// we return copy to endpoints not to modify cached structures
		endpoints = append(endpoints, o.(*api.Endpoint))
	}

	return
}

func (m *Manager) ImportRules(directory string) (err error) {
	engine := engine.NewEngine()
	engine.SetDumpRaw(true)

	if err = engine.LoadDirectory(directory); err != nil {
		return
	}

	rules := make([]*api.EdrRule, 0, engine.Count())
	for rr := range engine.GetRawRule(".*") {
		rule := &api.EdrRule{}
		if err = json.Unmarshal([]byte(rr), &rule); err != nil {
			return
		}
		rules = append(rules, rule)
	}

	if _, err = m.db.InsertOrUpdateMany(sod.ToObjectSlice(rules)...); err != nil {
		return err
	}

	return
}

// CreateNewAdminAPIUser creates a new user in the user able to access admin API in database.
func (m *Manager) CreateNewAdminAPIUser(user *AdminAPIUser) (err error) {
	if err = m.db.InsertOrUpdate(user); err != nil && !sod.IsUnique(err) {
		return err
	} else if sod.IsUnique(err) {
		err = errors.New("user with same Identifier or Uuid or Key already exists in database")
		return
	}

	return

}

// AddEndpoint adds new endpoint to the manager
func (m *Manager) AddEndpoint(uuid, key string) {
	m.db.InsertOrUpdate(api.NewEndpoint(uuid, key))
}

func (m *Manager) AddIoCs(iocs []*ioc.IOC) (err error) {

	// we preprocess to update existing IOCs
	insert := make([]*ioc.IOC, 0, len(iocs))
	for _, i := range iocs {
		// we need to apply transformation before searching otherwise we
		// might not find some values which have been transformed
		i.Transform()
		search := m.db.Search(&ioc.IOC{},
			"Uuid", "=", i.Uuid)
		if o, err := search.One(); err == nil {
			// in order to update existing IOCs
			i.Initialize(o.UUID())
		}

		insert = append(insert, i)
	}

	// Do bulk insertion
	if _, err = m.db.InsertOrUpdateMany(sod.ToObjectSlice(insert)...); err != nil {
		//wt.Write(admErr(err))
		return
	}

	// Add IoCs to sync with endpoints
	m.iocs.Add(insert...)

	return
}

// UpdateReducer updates the reducer member of the Manager
func (m *Manager) UpdateReducer(identifier string, e *event.EdrEvent) {
	if e.Event.Detection != nil {
		isigs := e.Event.Detection.Signature.Slice()
		sigs := make([]string, 0, len(isigs))

		for _, s := range isigs {
			sigs = append(sigs, s.(string))
		}

		if len(sigs) > 0 {
			m.gene.reducer.Update(e.Timestamp(), identifier, sigs)
		}
	}
}

func (m *Manager) logAPIErrorf(fmt string, i ...interface{}) {
	funcName := "unk.UnknownFunc"
	if pc, _, _, ok := runtime.Caller(1); ok {
		split := strings.Split(runtime.FuncForPC(pc).Name(), "/")
		funcName = split[len(split)-1]
	}

	msg := format("%s: %s", funcName, format(fmt, i...))

	m.Logger.Error(msg)
}

// Wait the Manager to Shutdown
func (m *Manager) Wait() {
	<-m.stop
}

// IsDone returns true when manager is done
func (m *Manager) IsDone() bool {
	return m.done
}

// Shutdown the Manager
func (m *Manager) Shutdown() (lastErr error) {
	defer func() { go func() { m.stop <- true }() }()
	if m.done {
		return
	}
	m.done = true
	if m.endpointAPI != nil {
		m.endpointAPI.Shutdown(context.Background())
	}
	if m.adminAPI != nil {
		m.adminAPI.Shutdown(context.Background())
	}

	if err := m.detectionLogger.Close(); err != nil {
		lastErr = err
	}

	if err := m.eventLogger.Close(); err != nil {
		lastErr = err
	}

	if err := m.db.Close(); err != nil {
		lastErr = err
	}

	return
}

// Run starts a new thread spinning the receiver
func (m *Manager) Run() {
	m.runEndpointAPI()
	m.runAdminAPI()
}

```

`api/server/manager_admin_api.go`:

```go
package server

import (
	"compress/gzip"
	"encoding/json"
	"errors"
	"fmt"
	"io"
	"io/fs"
	"io/ioutil"
	"net/http"
	"os"
	"path/filepath"
	"strconv"
	"strings"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/gene/v2/reducer"
	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/ioc"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/tools"
	"github.com/0xrawsec/whids/utils"
	"github.com/gorilla/mux"
	"github.com/gorilla/websocket"
)

const (
	MaxLimitLogAPI = 10000
)

var (
	// Used to specify a command timeout for command execution
	CommandTimeout = 15 * time.Second
)

func admApiParseDuration(pLast string) (d time.Duration, err error) {
	var n int

	if d, err = time.ParseDuration(pLast); err != nil {
		if n, err = fmt.Sscanf(pLast, "%dd", &d); n != 1 || err != nil {
			err = fmt.Errorf("invalid duration format")
			return
		}
		d *= 24 * time.Hour
	}
	return
}

func admApiParseTime(stimestamp string) (t time.Time, err error) {
	if t, err = time.Parse(time.RFC3339, stimestamp); err != nil {
		return
	}
	return
}

// AdminAPIConfig configuration for Administrative API
type AdminAPIConfig struct {
	Host string `toml:"host" comment:"Hostname or IP address where the API should listen to"`
	Port int    `toml:"port" comment:"Port used by the API"`
}

//////////////// AdminAPIResponse

// AdminAPIResponse standard structure to encode any response
// from the AdminAPI
type AdminAPIResponse struct {
	Data    interface{} `json:"data"`
	Message string      `json:"message"`
	Error   string      `json:"error"`
}

// NewAdminAPIResponse creates a new response from data
func NewAdminAPIResponse(data interface{}) *AdminAPIResponse {
	return &AdminAPIResponse{Data: data, Message: "OK"}
}

// NewAdminAPIRespError creates a new response from an error
func NewAdminAPIRespError(err error) *AdminAPIResponse {
	return &AdminAPIResponse{Message: "NOK", Error: format("%s", err)}
}

// NewAdminAPIRespErrorString creates a new error response from an error
func NewAdminAPIRespErrorString(err string) *AdminAPIResponse {
	return &AdminAPIResponse{Message: "NOK", Error: err}
}

// UnmarshalData unmarshals the Data field of the response to an interface
func (r *AdminAPIResponse) UnmarshalData(i interface{}) error {
	b, err := json.Marshal(r.Data)
	if err != nil {
		return err
	}
	return json.Unmarshal(b, i)
}

// ToJSON serializes the response to JSON
func (r *AdminAPIResponse) ToJSON() []byte {
	b, err := json.Marshal(r)
	if err != nil {
		safe := AdminAPIResponse{Error: format("failed to encode data to JSON: %s", err)}
		sb, _ := json.Marshal(safe)
		return sb
	}
	return b
}

// Err returns a response Error field in a form of a Go error
func (r *AdminAPIResponse) Err() error {
	if r.Error != "" {
		return errors.New(r.Error)
	}
	return nil
}

func admErr(s interface{}) []byte {
	return NewAdminAPIRespErrorString(format("%s", s)).ToJSON()
}

func admErrorf(fmt string, i ...interface{}) []byte {
	return NewAdminAPIRespErrorString(format(fmt, i...)).ToJSON()
}

func admJSONResp(data interface{}) []byte {
	return NewAdminAPIResponse(data).ToJSON()
}

/////////////////// Manager functions

var (
	upgrader = websocket.Upgrader{} // use default options
)

func (m *Manager) adminAuthorizationMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(wt http.ResponseWriter, rq *http.Request) {

		auth := rq.Header.Get(api.AuthKeyHeader)

		// Key is unique and thus indexed, doing this way we only query
		// index in memory for authorization
		if m.db.Search(&AdminAPIUser{}, "Key", "=", auth).Len() == 1 {
			next.ServeHTTP(wt, rq)
		} else {
			http.Error(wt, "Not Authorized", http.StatusForbidden)
			return
		}
	})
}

func (m *Manager) admLogHTTPMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		// src-ip:src-port http-method http-proto url user-agent UUID content-length
		//fmt.Printf("%s %s %s %s %s \"%s\" %d\n", time.Now().Format(time.RFC3339Nano), r.RemoteAddr, r.Method, r.Proto, r.URL, r.UserAgent(), r.ContentLength)
		m.Logger.Log(r.RemoteAddr, r.Method, r.Proto, r.URL, r.UserAgent(), r.ContentLength)
		next.ServeHTTP(w, r)
	})
}

func (m *Manager) adminRespHeaderMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(wt http.ResponseWriter, rq *http.Request) {

		wt.Header().Set("Access-Control-Allow-Origin", "*")
		wt.Header().Set("Content-Type", "application/json")

		next.ServeHTTP(wt, rq)
	})
}

func (m *Manager) admAPIUsers(wt http.ResponseWriter, rq *http.Request) {
	var err error

	identifier := rq.URL.Query().Get(api.QpIdentifier)

	switch rq.Method {
	case "GET":
		if users, err := m.db.All(&AdminAPIUser{}); err != nil {
			wt.Write(admErr(err))
			return
		} else {
			wt.Write(admJSONResp(users))
		}
	case "PUT":
		var uuid, key string

		// verify that we have at least an identifier to create the user
		if identifier == "" {
			wt.Write(admErr("at least an identifier is needed to create user"))
			return
		}

		if uuid, key, err = utils.UUIDKeyPair(api.DefaultKeySize); err != nil {
			wt.Write(admErr(format("error while generating user's uuid/key pair: %s", err)))
			return
		}

		user := AdminAPIUser{
			Identifier: identifier,
			Uuid:       uuid,
			Key:        key,
		}

		if err = m.CreateNewAdminAPIUser(&user); err != nil {
			wt.Write(admErr(err))
			return
		}

		wt.Write(admJSONResp(user))

	case "POST":
		var user AdminAPIUser

		if err = readPostAsJSON(rq, &user); err != nil && rq.ContentLength > 0 {
			wt.Write(admErr(err))
			return
		}

		// verify that we have at least an identifier to create the user
		if user.Identifier == "" {
			wt.Write(admErr("at least an identifier is needed to create user"))
			return
		}

		// we generate a new UUID if needed
		// force UUID to lower case
		user.Uuid = strings.ToLower(user.Uuid)
		if !noBracketGuidRe.MatchString(user.Uuid) {
			if user.Uuid, err = utils.NewUUIDString(); err != nil {
				wt.Write(admErr(format("failed to generate uuid: %s", err)))
				return
			}
		}

		// we generate a new key if needed
		if user.Key == "" {
			if user.Key, err = utils.NewKey(api.DefaultKeySize); err != nil {
				wt.Write(admErr(format("failed to generate key: %s", err)))
				return
			}
		}

		if err = m.CreateNewAdminAPIUser(&user); err != nil {
			wt.Write(admErr(err))
			return
		}

		wt.Write(admJSONResp(user))
	}
}

func (m *Manager) admAPIUser(wt http.ResponseWriter, rq *http.Request) {
	var err error
	var uuid string

	newKey, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpNewKey))

	if uuid, err = muxGetVar(rq, "uuuid"); err == nil {
		if o, err := m.db.Search(&AdminAPIUser{}, "Uuid", "=", uuid).One(); err == nil {
			// we sucessfully retrieved object from DB
			user := o.(*AdminAPIUser)
			switch rq.Method {
			case "DELETE":
				if err := m.db.Delete(user); err != nil {
					wt.Write(admErr(err))
					return
				}
			case "POST":
				var new AdminAPIUser

				if err = readPostAsJSON(rq, &new); err != nil && rq.ContentLength > 0 {
					wt.Write(admErr(err))
					return
				}

				// updating only some allowed fields of existing user
				if newKey {
					if user.Key, err = utils.NewKey(api.DefaultKeySize); err != nil {
						wt.Write(admErr(format("failed to generate key: %s", err)))
						return
					}
				}

				if new.Key != "" {
					user.Key = new.Key
				}

				if new.Group != "" {
					user.Group = new.Group
				}

				if new.Description != "" {
					user.Description = new.Description
				}

				// save new user to database
				if err := m.db.InsertOrUpdate(user); err != nil {
					wt.Write(admErr(err))
					return
				}
			}
			// return user anyway
			wt.Write(admJSONResp(user))
		} else if sod.IsNoObjectFound(err) {
			wt.Write(admErr(format("unknown user for uuid: %s", uuid)))
		} else {
			msg := format("failed to search user in database: %s", err)
			m.logAPIErrorf(msg)
			wt.Write(admErr(msg))
		}
	} else {
		wt.Write(admErr(err))
	}
}

func (m *Manager) admAPIEndpoints(wt http.ResponseWriter, rq *http.Request) {

	showKey, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpShowKey))
	group := rq.URL.Query().Get(api.QpGroup)
	status := rq.URL.Query().Get(api.QpStatus)
	criticality, _ := strconv.ParseInt(rq.URL.Query().Get(api.QpCriticality), 10, 8)

	switch {
	case rq.Method == "GET":
		// we return the list of all endpoints
		if endpoints, err := m.Endpoints(); err != nil {
			wt.Write(admErr(err))
		} else {
			out := make([]*api.Endpoint, 0, len(endpoints))
			for _, endpt := range endpoints {
				// filter on group
				if group != "" && endpt.Group != group {
					continue
				}
				// filter on status
				if status != "" && endpt.Status != status {
					continue
				}
				if endpt.Criticality < int(criticality) {
					continue
				}
				// never show config
				endpt.Config = nil
				// never show command
				endpt.Command = nil
				if !showKey {
					// to prevent modifying data in the db cache
					endpt = endpt.Copy()
					endpt.Key = ""
				}
				// score is updated at every call as it depends on all the other endpoints
				endpt.Score = m.gene.reducer.BoundedScore(endpt.Uuid)
				out = append(out, endpt)
			}
			wt.Write(admJSONResp(out))
		}

	case rq.Method == "PUT":
		var uuid, key string
		var err error

		// on error we return
		if uuid, key, err = utils.UUIDKeyPair(api.DefaultKeySize); err != nil {
			wt.Write(admErr(format("failed to generate endpoint uuid/key pair: %s", err)))
			return
		}

		endpt := api.NewEndpoint(uuid, key)
		// save endpoint to database
		if err := m.db.InsertOrUpdate(endpt); err != nil {
			m.logAPIErrorf("failed to save new endpoint: %s", err)
			wt.Write(admErr(err))
			return
		}

		wt.Write(admJSONResp(endpt))
	}
}

func (m *Manager) admAPIEndpoint(wt http.ResponseWriter, rq *http.Request) {
	var euuid string
	var err error

	showKey, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpShowKey))
	newKey, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpNewKey))

	if euuid, err = muxGetVar(rq, "euuid"); err == nil {
		if endpt, ok := m.Endpoint(euuid); ok {
			var err error

			switch rq.Method {
			case "POST":
				new := api.Endpoint{Criticality: -1}

				if err = readPostAsJSON(rq, &new); err != nil && rq.ContentLength > 0 {
					wt.Write(admErr(err.Error()))
					return
				}

				if new.Status != "" {
					endpt.Status = new.Status
				}

				if new.Group != "" {
					endpt.Group = new.Group
				}

				if new.Criticality != -1 {
					endpt.Criticality = new.Criticality
				}

				// if we want to generate a new random key
				if newKey {
					if endpt.Key, err = utils.NewKey(api.DefaultKeySize); err != nil {
						wt.Write(admErrorf("failed to generate new endpoint key: %s", err))
						return
					}
				}

				// save endpoint to database
				if err = m.db.InsertOrUpdate(endpt); err != nil {
					m.logAPIErrorf("failed to save updated endpoint UUID=%s", euuid)
					wt.Write(admErr(err))
					return
				}

			case "DELETE":
				// deleting endpoints from live config
				if err = m.db.Delete(endpt); err != nil {
					m.logAPIErrorf("failed to delete endpoint UUID=%s from database", euuid)
					wt.Write(admErr(err))
					return
				}
			}

			// never show command
			endpt.Command = nil
			// never show config
			endpt.Config = nil

			// score is updated at every call as it depends on all the other endpoints
			endpt.Score = m.gene.reducer.BoundedScore(endpt.Uuid)

			// we return the endpoint anyway
			if !showKey {
				// to prevent modifying struct in db cache
				endpt = endpt.Copy()
				endpt.Key = ""
			}

			apiResp := NewAdminAPIResponse(endpt)
			if err != nil {
				apiResp.Error = err.Error()
			}
			wt.Write(apiResp.ToJSON())
		} else {
			wt.Write(admErr(format("Unknown endpoint: %s", euuid)))
		}
	} else {
		wt.Write(admErr(format("Failed to parse URL: %s", err)))
	}
}

func (m *Manager) admAPIEndpointConfig(wt http.ResponseWriter, rq *http.Request) {
	var euuid string
	var err error

	qpfmt := rq.URL.Query().Get(api.QpFormat)

	if euuid, err = muxGetVar(rq, "euuid"); err == nil {
		if endpt, ok := m.Endpoint(euuid); ok {
			var err error

			switch rq.Method {

			case "POST":
				c := config.Agent{}
				switch qpfmt {
				case "toml":
					err = readPostAsTOML(rq, &c)
				default:
					err = readPostAsJSON(rq, &c)
				}

				if err != nil && rq.ContentLength > 0 {
					wt.Write(admErr(err.Error()))
					return
				}

				endpt.Config = &c

				if err = m.db.InsertOrUpdate(endpt); err != nil {
					m.logAPIErrorf("failed to save updated endpoint UUID=%s", euuid)
					wt.Write(admErr(err))
					return
				}

			case "DELETE":

				// delete configuration
				endpt.Config = nil

				if err = m.db.InsertOrUpdate(endpt); err != nil {
					m.logAPIErrorf("failed to save updated endpoint UUID=%s", euuid)
					wt.Write(admErr(err))
					return
				}
			}

			var respData any
			respData = endpt.Config

			if qpfmt == "toml" {
				if endpt.Config != nil {
					respData, err = utils.TomlString(endpt.Config)
				}
			}

			apiResp := NewAdminAPIResponse(respData)
			if err != nil {
				apiResp.Error = err.Error()
			}

			wt.Write(apiResp.ToJSON())
		} else {
			wt.Write(admErr(format("Unknown endpoint: %s", euuid)))
		}
	} else {
		wt.Write(admErr(format("Failed to parse URL: %s", err)))
	}
}

func (m *Manager) admAPIEndpointCommand(wt http.ResponseWriter, rq *http.Request) {
	var euuid string
	var err error
	var endpt *api.Endpoint
	var ok bool

	if euuid, err = muxGetVar(rq, "euuid"); err != nil {
		wt.Write(admErr(err))
		return
	}

	if endpt, ok = m.Endpoint(euuid); !ok {
		wt.Write(admErrorf("unknown endpoint: %s", euuid))
		return
	}

	switch rq.Method {
	case "GET":
		// query parameters
		wait, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpWait))

		if endpt.Command != nil {
			for wait && !endpt.Command.Completed {
				time.Sleep(time.Millisecond * 50)
				endpt, _ = m.Endpoint(euuid)
			}
		}

		wt.Write(admJSONResp(endpt.Command))

	case "POST":
		// add a default timeout if not specified
		c := CommandAPI{
			Timeout: CommandTimeout,
		}

		// we read POST data
		if err = readPostAsJSON(rq, &c); err != nil {
			wt.Write(admErr(err))
			return
		}

		tmpCmd, err := c.ToCommand()
		if err != nil {
			wt.Write(admErrorf("failed to create command to execute: %s", err))
			return
		}

		endpt.Command = tmpCmd
		// save modification
		if err := m.db.InsertOrUpdate(endpt); err != nil {
			wt.Write(admErr(err))
			return
		}

		wt.Write(admJSONResp(endpt))
	}
}

func (m *Manager) admAPIEndpointCommandField(wt http.ResponseWriter, rq *http.Request) {
	var euuid, field string
	var err error

	if euuid, err = muxGetVar(rq, "euuid"); err != nil {
		wt.Write(admErr(err))
	} else {
		if endpt, ok := m.Endpoint(euuid); ok {
			if field, err = muxGetVar(rq, "field"); err != nil {
				wt.Write(admErr(err))
			} else {
				if endpt.Command != nil {
					// success path
					switch field {
					case "stdout":
						wt.Write(admJSONResp(endpt.Command.Stdout))
					case "stderr":
						wt.Write(admJSONResp(endpt.Command.Stderr))
					case "error":
						wt.Write(admJSONResp(endpt.Command.Error))
					case "completed":
						wt.Write(admJSONResp(endpt.Command.Completed))
					case "files", "fetch":
						wt.Write(admJSONResp(endpt.Command.Fetch))
					default:
						wt.Write(admErr(format("Field %s not handled", field)))
					}
				} else {
					wt.Write(admErr(format("Command is not set for endpoint: %s", euuid)))
				}
			}
		} else {
			wt.Write(admErr(format("Unknown endpoint: %s", euuid)))
		}
	}
}

func (m *Manager) admAPIEndpointLogs(wt http.ResponseWriter, rq *http.Request) {
	var err error
	var euuid string
	var start, stop, pivot time.Time
	var last, delta time.Duration
	var skip int64

	// default limit
	limit := 1000

	logs := make([]*event.EdrEvent, 0)
	pStart := rq.URL.Query().Get(api.QpSince)
	pStop := rq.URL.Query().Get(api.QpUntil)
	pLast := rq.URL.Query().Get(api.QpLast)

	pPivot := rq.URL.Query().Get(api.QpPivot)
	pDelta := rq.URL.Query().Get(api.QpDelta)

	pLimit := rq.URL.Query().Get(api.QpLimit)
	pSkip := rq.URL.Query().Get(api.QpSkip)

	now := time.Now()

	// Parsing parameters
	if pStart != "" {
		if start, err = admApiParseTime(pStart); err != nil {
			wt.Write(admErr("Failed to parse start parameter, it must be RFC3339 formated"))
			return
		}
	}

	if pStop != "" {
		if stop, err = admApiParseTime(pStop); err != nil {
			wt.Write(admErr("Failed to parse stop parameter, it must be RFC3339 formated"))
			return
		}
	}

	if pLast != "" {
		if last, err = time.ParseDuration(pLast); err != nil {
			if n, err := fmt.Sscanf(pLast, "%dd", &last); n != 1 || err != nil {
				wt.Write(admErr("Failed to parse last parameter, it must be a valid Go time.Duration format"))
				return
			}
			last *= 24 * time.Hour
		}
	}

	if pPivot != "" {
		if pivot, err = admApiParseTime(pPivot); err != nil {
			wt.Write(admErr("Failed to parse pivot parameter, it must be RFC3339 formated"))
			return
		}
	}

	if pDelta != "" {
		if delta, err = time.ParseDuration(pDelta); err != nil {
			wt.Write(admErr("Failed to parse delta parameter, it must be a valid Go time.Duration format"))
			return
		}
	}

	if pSkip != "" {
		if skip, err = strconv.ParseInt(pSkip, 10, 64); err != nil {
			wt.Write(admErr(format("Failed to parse skip parameter: %s", err)))
			return
		}
	}

	if pLimit != "" {
		// we don't raise error here on bad conversion
		if l, err := strconv.Atoi(pLimit); err == nil {
			if l <= MaxLimitLogAPI {
				limit = l
			} else {
				limit = MaxLimitLogAPI
			}
		}
	}

	// Default settings last hour
	if pStart == "" && pStop == "" && pPivot == "" && pDelta == "" && pLast == "" {
		last = time.Hour
	}

	// Using last parameter
	if last != 0 {
		start = now.Add(-last)
		stop = now
		goto searchLogs
	}

	// 10 min delta if delta is not provided
	if pPivot != "" && pDelta == "" {
		delta = time.Minute * 10
	}

	// computing start and stop from pivot and delta
	if !pivot.IsZero() && delta != 0 {
		start = pivot.Add(-delta)
		stop = pivot.Add(+delta)
	}

	if !start.IsZero() && stop.IsZero() {
		stop = now
	}

searchLogs:
	// Controlling parameters
	if start.After(stop) {
		wt.Write(admErr("Start date must be before stop date"))
		return
	}
	if euuid, err = muxGetVar(rq, "euuid"); err != nil {
		wt.Write(admErr(err))
	} else {
		searcher := m.eventSearcher

		if strings.HasSuffix(rq.URL.Path, api.AdmAPIDetectionSuffix) {
			searcher = m.detectionSearcher
		}

		for rawEvent := range searcher.Events(start, stop, euuid, int(limit), int(skip)) {
			if e, err := rawEvent.Event(); err != nil {
				m.logAPIErrorf("failed to encode event to JSON: %s", err)
			} else {
				logs = append(logs, e)
			}
		}

		// we had an issue doing the search
		if searcher.Err() != nil {
			wt.Write(admErr(format("failed to search events: %s", searcher.Err())))
			return
		}

		wt.Write(admJSONResp(logs))
	}
}

func (m *Manager) admAPIEndpointReport(wt http.ResponseWriter, rq *http.Request) {
	var euuid string
	var err error

	if euuid, err = muxGetVar(rq, "euuid"); err != nil {
		wt.Write(admErr(err))
	} else {
		if endpt, ok := m.Endpoint(euuid); ok {
			// we return the report anyway
			rs := m.gene.reducer.ReduceCopy(endpt.Uuid)
			switch rq.Method {
			case "GET":
				wt.Write(admJSONResp(rs))
			case "DELETE":
				if rs != nil {
					ar := api.ArchivedReport{}
					ar.ReducedStats = *rs
					ar.ArchivedTimestamp = time.Now()

					resp := NewAdminAPIResponse(rs)

					// we archive the report in database
					if err := m.db.InsertOrUpdate(&ar); err != nil {
						resp.Error = fmt.Sprintf("failed to save archive: %s", err)
					}

					// we reset reducer
					m.gene.reducer.Delete(endpt.Uuid)

					wt.Write(resp.ToJSON())
				} else {
					wt.Write(admErr("No report to delete"))
				}
			}
		} else {
			wt.Write(admErr(format("Unknown endpoint: %s", euuid)))
		}
	}
}

func (m *Manager) admAPIEndpointReportArchive(wt http.ResponseWriter, rq *http.Request) {
	var euuid string
	var err error
	var since, until time.Time
	var last time.Duration
	var limit uint64

	pSince := rq.URL.Query().Get(api.QpSince)
	pUntil := rq.URL.Query().Get(api.QpUntil)
	pLast := rq.URL.Query().Get(api.QpLast)
	pLimit := rq.URL.Query().Get(api.QpLimit)

	if pSince != "" {
		if since, err = admApiParseTime(pSince); err != nil {
			wt.Write(admErr(format("Failed to parse since parameter: %s", err)))
			return
		}
	}

	if pUntil != "" {
		if until, err = admApiParseTime(pUntil); err != nil {
			wt.Write(admErr(format("Failed to parse until parameter: %s", err)))
			return
		}
	}

	if pLast != "" {
		if last, err = admApiParseDuration(pLast); err != nil {
			wt.Write(admErr(format("Failed to parse last parameter: %s", err)))
			return
		}
	}

	if pLimit != "" {
		if limit, err = strconv.ParseUint(pLimit, 0, 64); err != nil {
			wt.Write(admErr(format("Failed to parse limit parameter: %s", err)))
			return
		}
	}

	// initialization of since and until
	if since.IsZero() && until.IsZero() {
		since = time.Now().Add(-time.Hour * 24)
		until = time.Now()
	} else if until.IsZero() {
		until = time.Now()
	}

	// handling case where last is specified
	if last != 0 {
		until = time.Now()
		since = until.Add(-last)
	}

	if euuid, err = muxGetVar(rq, "euuid"); err != nil {
		wt.Write(admErr(err))
	} else {
		if endpt, ok := m.Endpoint(euuid); ok {
			search := m.db.Search(&api.ArchivedReport{}, "Identifier", "=", endpt.Uuid).
				And("ArchivedTimestamp", ">=", since).
				And("ArchivedTimestamp", "<=", until)
			if limit > 0 {
				search.Limit(limit)
			}
			if res, err := search.Reverse().Collect(); err != nil {
				wt.Write(admErr(err))
			} else {
				wt.Write(admJSONResp(res))
			}
		} else {
			wt.Write(admErr(format("Unknown endpoint: %s", euuid)))
		}
	}
}

func (m *Manager) admAPIEndpointsReports(wt http.ResponseWriter, rq *http.Request) {
	out := make(map[string]*reducer.ReducedStats)
	if endpoints, err := m.Endpoints(); err != nil {
		wt.Write(admErr(err))
	} else {
		for _, e := range endpoints {
			out[e.Uuid] = m.gene.reducer.ReduceCopy(e.Uuid)
		}
		wt.Write(admJSONResp(out))
	}
}

type DumpFile struct {
	Name      string    `json:"name"`
	Size      int64     `json:"size"`
	Timestamp time.Time `json:"timestamp"`
}

type EndpointDumps struct {
	Created      time.Time  `json:"creation"`
	Modification time.Time  `json:"modification"`
	ProcessGUID  string     `json:"process-guid"`
	EventHash    string     `json:"event-hash"`
	BaseURL      string     `json:"base-url"`
	Files        []DumpFile `json:"files"`
}

func listEndpointDumps(root, uuid string, since time.Time) (dumps []EndpointDumps, err error) {
	var procGUIDs, eventHashes, eventDumps []fs.DirEntry

	dumps = make([]EndpointDumps, 0)
	urlPath := fmt.Sprintf("%s/%s%s", api.AdmAPIEndpointsPath, uuid, api.AdmAPIArticfactsSuffix)

	path := filepath.Join(root, uuid)
	if procGUIDs, err = os.ReadDir(path); err != nil {
		return
	}

	for _, pfi := range procGUIDs {
		if pfi.IsDir() {
			evtHashDir := filepath.Join(path, pfi.Name())
			if eventHashes, err = os.ReadDir(evtHashDir); err != nil {
				err = fmt.Errorf("failed to list (event hash) directory: %s", err)
				return
			}

			for _, efi := range eventHashes {
				// we remove the curly brackets of the process GUID as gorilla
				// has issue handling those. Important for API retrieving dump file
				pguid := strings.Trim(pfi.Name(), "{}")
				ehash := efi.Name()
				baseURL := format("%s/%s/%s/", urlPath, pguid, ehash)
				ed := EndpointDumps{ProcessGUID: pguid, EventHash: ehash, BaseURL: baseURL, Files: make([]DumpFile, 0)}
				if efi.IsDir() {
					evtDumpDir := filepath.Join(evtHashDir, ehash)
					if eventDumps, err = os.ReadDir(evtDumpDir); err != nil {
						err = fmt.Errorf("failed to list (event dump) directory: %s", err)
						return
					}

					for _, dfi := range eventDumps {
						var info fs.FileInfo
						if info, err = dfi.Info(); err != nil {
							err = fmt.Errorf("failed to read file (%s) info: %s", filepath.Join(evtDumpDir, dfi.Name()), err)
							return
						}
						f := DumpFile{info.Name(), info.Size(), info.ModTime().UTC()}
						// we add file to the list of files only if it has
						// been modified after the since parameter
						ed.Files = append(ed.Files, f)

						// update creation date
						if ed.Created.IsZero() || info.ModTime().Before(ed.Created) {
							ed.Created = info.ModTime().UTC()
						}

						// update modification date
						if ed.Modification.Before(info.ModTime()) {
							ed.Modification = info.ModTime().UTC()
						}
					}
				}

				// we don't update if update timestamp is before since parameter
				if since.Before(ed.Modification) {
					dumps = append(dumps, ed)
				}
			}
		}
	}
	return

}

func (m *Manager) admAPIArtifacts(wt http.ResponseWriter, rq *http.Request) {
	var err error
	var since time.Time
	var uuids []fs.DirEntry

	pSince := rq.URL.Query().Get("since")
	resp := make(map[string][]EndpointDumps)

	if pSince != "" {
		if since, err = admApiParseTime(pSince); err != nil {
			wt.Write(admErr(format("Failed to parse since parameter: %s", err)))
			return
		}
	}

	if uuids, err = os.ReadDir(m.Config.DumpDir); err != nil {
		wt.Write(admErr(format("Failed to read dump directory: %s", err)))
		return
	}

	for _, uuid := range uuids {
		if uuid.IsDir() {
			if resp[uuid.Name()], err = listEndpointDumps(m.Config.DumpDir, uuid.Name(), since); err != nil {
				wt.Write(admErr(format("Failed list dumps for uuid=%s , %s", uuid.Name(), err)))
				return
			}
		}
	}
	wt.Write(admJSONResp(resp))
}

func (m *Manager) admAPIEndpointArtifacts(wt http.ResponseWriter, rq *http.Request) {
	var euuid string
	var err error
	var since time.Time
	var dumps []EndpointDumps

	pSince := rq.URL.Query().Get("since")

	if pSince != "" {
		if since, err = admApiParseTime(pSince); err != nil {
			wt.Write(admErr(format("Failed to parse since parameter: %s", err)))
			return
		}
	}

	if euuid, err = muxGetVar(rq, "euuid"); err != nil {
		wt.Write(admErr(err))
	} else {
		if _, ok := m.Endpoint(euuid); ok {
			if dumps, err = listEndpointDumps(m.Config.DumpDir, euuid, since); err != nil {
				wt.Write(admErr(format("Failed to list dumps, %s", err)))
				return
			}
			wt.Write(admJSONResp(dumps))
			return
		} else {
			wt.Write(admErr(format("Unknown endpoint: %s", euuid)))
		}
	}
}

func (m *Manager) admAPIEndpointArtifact(wt http.ResponseWriter, rq *http.Request) {

	raw, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpRaw))
	gunzip, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpGunzip))

	if euuid, err := muxGetVar(rq, "euuid"); err == nil {
		if pguid, err := muxGetVar(rq, "pguid"); err == nil {
			if ehash, err := muxGetVar(rq, "ehash"); err == nil {
				if fname, err := muxGetVar(rq, "fname"); err == nil {
					// sanitize pguid
					pguid = format("{%s}", strings.Trim(pguid, "{}"))
					dumpDir := filepath.Join(m.Config.DumpDir, euuid, pguid, ehash)
					if dumpFiles, err := os.ReadDir(dumpDir); err == nil {
						for _, dfi := range dumpFiles {
							exists := filepath.Join(dumpDir, dfi.Name())
							fetch := filepath.Join(dumpDir, fname)
							if exists == fetch {
								var r io.ReadCloser
								if fd, err := os.Open(fetch); err == nil {
									r = fd
									if gunzip {
										if r, err = gzip.NewReader(fd); err != nil {
											wt.Write(admErr(format("Failed to gunzip file: %s", err)))
											return
										}
									}

									// defer closing of the reader
									defer r.Close()

									if data, err := ioutil.ReadAll(r); err == nil {
										// if we want the raw file
										if raw {
											wt.Header().Set("Content-Type", "application/octet-stream")
											wt.Write(data)
										} else {
											wt.Write(admJSONResp(data))
										}
									} else {
										wt.Write(admErr(format("Cannot read file: %s", err)))
									}
								} else {
									wt.Write(admErr(format("Cannot open file: %s", err)))
								}
								// we have to return here as we successed or failed to read file
								return
							}
						}
						wt.Write(admErr("File not found"))
					} else {
						wt.Write(admErr(format("Failed at listing dump directory: %s", err)))
					}
				} else {
					wt.Write(admErr(err.Error()))
				}
			} else {
				wt.Write(admErr(err.Error()))
			}
		} else {
			wt.Write(admErr(err.Error()))
		}
	} else {
		wt.Write(admErr(err.Error()))
	}
}

func (m *Manager) admAPIEndpointSysmonConfig(wt http.ResponseWriter, rq *http.Request) {
	var config = &sysmon.Config{}

	format := rq.URL.Query().Get(api.QpFormat)
	raw, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpRaw))
	sversion := rq.URL.Query().Get(api.QpVersion)

	if os, err := muxGetVar(rq, "os"); err == nil {
		switch rq.Method {
		case "GET":
			err = m.db.Search(&sysmon.Config{}, "OS", "=", os).
				And("SchemaVersion", "=", sversion).AssignOne(&config)
			if err == nil {
				if format == "xml" {
					if xml, err := config.XML(); err == nil {
						if raw {
							wt.Header().Set("Content-Type", "application/xml")
							wt.Write(xml)
						} else {
							wt.Write(admJSONResp(string(xml)))
						}
					} else {
						wt.Write(admErr(err))
					}
				} else {
					wt.Write(admJSONResp(config))
				}
			} else {
				wt.Write(admErr(err))
			}

		case "POST":
			var new = &sysmon.Config{}

			readPost := readPostAsJSON
			if format == "xml" {
				readPost = readPostAsXML
			}

			if err := readPost(rq, new); err == nil {
				m.db.Search(&sysmon.Config{}, "OS", "=", os).
					And("SchemaVersion", "=", new.SchemaVersion).AssignOne(&config)

				new.Initialize(config.UUID())
				// setting up configuration OS
				new.OS = os
				if err := m.db.InsertOrUpdate(new); err == nil {
					// we return configuration
					wt.Write(admJSONResp(new))
				} else {
					wt.Write(admErr(err))
				}
			} else {
				wt.Write(admErr(err))
			}

		case "DELETE":
			if o, err := m.db.Search(&sysmon.Config{}, "OS", "=", os).
				And("SchemaVersion", "=", sversion).One(); err == nil {
				if err = m.db.Delete(o); err == nil {
					wt.Write(admJSONResp(o))
				} else {
					wt.Write(admErr(err))
				}
			} else {
				wt.Write(admErr(err))
			}
		}
	} else {
		wt.Write(admErr(err))
	}
}

func (m *Manager) admAPIEndpointToolMgmt(toolName string, wt http.ResponseWriter, rq *http.Request) {
	var err error
	var os string
	var tool *tools.Tool
	var s *sod.Search

	binary, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpBinary))

	if os, err = muxGetVar(rq, "os"); err != nil {
		goto fail
	}

	s = m.db.Search(&tools.Tool{}, "OS", "=", os).
		And("Name", "=", toolName)

	switch rq.Method {
	case "GET":

		if err = s.AssignUnique(&tool); err != nil {
			goto fail
		}

		if !binary {
			tool.Binary = nil
		}

		wt.Write(admJSONResp(tool))
		return

	case "POST":
		defer rq.Body.Close()

		var data []byte
		if data, err = io.ReadAll(rq.Body); err != nil {
			goto fail
		}

		if len(data) == 0 {
			err = fmt.Errorf("empty content")
			goto fail
		}

		err = s.AssignUnique(&tool)

		switch {
		case sod.IsNoObjectFound(err):
			tool = tools.New(os, toolName, toolName, data)
		case err == nil:
			tool.Update(data)
		default:
			goto fail
		}

		if err = m.db.InsertOrUpdate(tool); err != nil {
			goto fail
		}

		if !binary {
			tool.Binary = nil
		}

		wt.Write(admJSONResp(tool))
		return

	case "DELETE":

		if err = s.AssignUnique(&tool); err != nil {
			goto fail
		}

		if err = s.Delete(); err != nil {
			goto fail
		}

		if !binary {
			tool.Binary = nil
		}

		wt.Write(admJSONResp(tool))
		return
	}

fail:
	wt.Write(admErr(err))

}

func (m *Manager) admAPIEndpointSysmonBinary(wt http.ResponseWriter, rq *http.Request) {
	m.admAPIEndpointToolMgmt(tools.ToolSysmon, wt, rq)
}

func (m *Manager) admAPIEndpointOSQueryiBinary(wt http.ResponseWriter, rq *http.Request) {
	m.admAPIEndpointToolMgmt(tools.ToolOSQueryi, wt, rq)
}

type stats struct {
	EndpointCount int `json:"endpoint-count"`
	RuleCount     int `json:"rule-count"`
}

func (m *Manager) admAPIStats(wt http.ResponseWriter, rq *http.Request) {
	if count, err := m.db.Count(&api.Endpoint{}); err != nil {
		wt.Write(admErr(err))
	} else {
		s := stats{
			EndpointCount: count,
			RuleCount:     m.gene.engine.Count(),
		}
		wt.Write(admJSONResp(s))
	}
}

func (m *Manager) admAPIIocs(wt http.ResponseWriter, rq *http.Request) {

	source := rq.URL.Query().Get(api.QpSource)
	guuid := rq.URL.Query().Get(api.QpGroupUuid)
	uuid := rq.URL.Query().Get(api.QpUuid)
	value := rq.URL.Query().Get(api.QpValue)
	itype := rq.URL.Query().Get(api.QpType)

	switch rq.Method {
	case "GET":
		if value == "" && source == "" && itype == "" && guuid == "" && uuid == "" {
			if objs, err := m.db.All(&ioc.IOC{}); err != nil {
				wt.Write(admErr(err))
			} else {
				wt.Write(admJSONResp(objs))
			}
			return
		} else {
			// searching out IoCs
			if objs, err := m.db.Search(&ioc.IOC{}, "Value", "=", value).
				Or("Source", "=", source).
				Or("Type", "=", itype).
				Or("GroupUuid", "=", guuid).
				Or("Uuid", "=", uuid).
				Collect(); err != nil {
				wt.Write(admErr(err))
			} else {
				wt.Write(admJSONResp(objs))
			}
			return
		}

	case "POST":
		var iocs []*ioc.IOC
		if err := readPostAsJSON(rq, &iocs); err != nil && rq.ContentLength > 0 {
			wt.Write(admErr(err))
		} else {

			if err := m.AddIoCs(iocs); err != nil {
				wt.Write(admErr(err))
				return
			}

			wt.Write(admJSONResp(iocs))
		}

	case "DELETE":
		var search *sod.Search

		if value != "" {
			search = m.db.Search(&ioc.IOC{}, "Value", "=", value)
		}

		if source != "" {
			if search == nil {
				search = m.db.Search(&ioc.IOC{}, "Source", "=", source)
			} else {
				search = search.And("Source", "=", source)
			}
		}
		if itype != "" {
			if search == nil {
				search = m.db.Search(&ioc.IOC{}, "Type", "=", itype)
			} else {
				search = search.And("Type", "=", itype)
			}
		}
		if guuid != "" {
			if search == nil {
				search = m.db.Search(&ioc.IOC{}, "GroupUuid", "=", guuid)
			} else {
				search = search.And("GroupUuid", "=", guuid)
			}
		}
		if uuid != "" {
			if search == nil {
				search = m.db.Search(&ioc.IOC{}, "Uuid", "=", uuid)
			} else {
				search = search.And("Uuid", "=", uuid)
			}
		}

		if search != nil {
			if objs, err := search.Collect(); err != nil {
				wt.Write(admErr(err))
			} else {
				// Deletes all the entries matching the search
				if err := search.Delete(); err != nil {
					wt.Write(admErr(err))
				} else {
					// deleting IoCs pushed to endpoints
					m.iocs.Del(ioc.FromObjects(objs...)...)
					// writing out deleted IoCs
					wt.Write(admJSONResp(objs))
				}
			}
		} else {
			wt.Write(admJSONResp(nil))
		}
		return
	}
}

func (m *Manager) admAPIRules(wt http.ResponseWriter, rq *http.Request) {
	// used in case of POST / DELETE

	name := rq.URL.Query().Get(api.QpName)
	filters, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpFilters))
	update, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpUpdate))

	switch rq.Method {
	case "GET":

		if name == "" {
			name = ".*"
		}

		if objs, err := m.db.Search(&api.EdrRule{}, "Name", "~=", name).Collect(); err != nil {
			wt.Write(admErr(err))
		} else {
			rules := make([]*api.EdrRule, 0)
			for _, o := range objs {
				rule := o.(*api.EdrRule)
				if filters && !rule.Meta.Filter {
					continue
				}
				rules = append(rules, rule)
			}
			wt.Write(admJSONResp(rules))
		}

	case "DELETE":

		search := m.db.Search(&api.EdrRule{}, "Name", "=", name)
		if objs, err := search.Collect(); err != nil {
			wt.Write(admErr(err))
		} else {
			if err := search.Delete(); err != nil {
				wt.Write(admErr(err))
			} else if err := m.initializeGeneFromDB(); err != nil {
				// we need to re-init gene engine in case of update
				wt.Write(admErr(err))
			} else {
				wt.Write(admJSONResp(objs))
			}
		}

	case "POST":
		defer rq.Body.Close()

		var rules []*api.EdrRule

		dec := json.NewDecoder(rq.Body)
		if err := dec.Decode(&rules); err != nil {
			wt.Write(admErr(err))
		} else {
			// we verify that we can compile rules
			for _, rule := range rules {
				eng := engine.NewEngine()
				if _, err := rule.Compile(eng); err != nil {
					// we abort API call
					wt.Write(admErr(err))
					return
				}
			}

			// we add rules
			for _, rule := range rules {
				o, err := m.db.Search(&api.EdrRule{}, "Name", "=", rule.Name).One()
				switch {
				case err == nil:
					if update {
						// to be able to replace rule
						rule.Initialize(o.UUID())
					} else {
						wt.Write(admErr(fmt.Sprintf(`rule %s already exist, use update URL parameter to force update`, rule.Name)))
						return
					}
				case sod.IsNoObjectFound(err):
					// we don't do anything
				default:
					// we abort API call
					wt.Write(admErr(err))
					return
				}
			}

			// we make insertion
			if _, err := m.db.InsertOrUpdateMany(sod.ToObjectSlice(rules)...); err != nil {
				err := fmt.Errorf("partial insert/update due to error: %s", err)
				wt.Write(admErr(err))
				return
			}

			// we need to re-init gene engine in case of update
			if err := m.initializeGeneFromDB(); err != nil {
				err := fmt.Errorf("failed to re-initialize engine due to error: %s", err)
				wt.Write(admErr(err))
				return
			}

			// SUCCESS
			wt.Write(admJSONResp(rules))
		}

	}

}

func (m *Manager) wsHandleControlMessage(c *websocket.Conn) {
	for {
		if _, _, err := c.NextReader(); err != nil {
			c.Close()
			m.logAPIErrorf("error in WS control handler: %s", err)
			break
		}
	}
}

func (m *Manager) admAPIStreamEvents(w http.ResponseWriter, r *http.Request) {
	c, err := upgrader.Upgrade(w, r, nil)
	if err != nil {
		m.logAPIErrorf("failed to upgrade to websocket: %s", err)
		return
	}
	defer c.Close()

	stream := m.eventStreamer.NewStream()
	stream.Stream()
	defer stream.Close()

	go m.wsHandleControlMessage(c)

	for e := range stream.S {
		err = c.WriteJSON(e)
		if err != nil {
			m.logAPIErrorf("error in WriteJSON: %s", err)
			break
		}
	}
}

func (m *Manager) admAPIStreamDetections(w http.ResponseWriter, r *http.Request) {
	c, err := upgrader.Upgrade(w, r, nil)
	if err != nil {
		m.logAPIErrorf("failed to upgrade to websocket: %s", err)
		return
	}
	defer c.Close()

	stream := m.eventStreamer.NewStream()
	stream.Stream()
	defer stream.Close()

	go m.wsHandleControlMessage(c)

	for e := range stream.S {
		// check if event is associated to a detection
		if e.IsDetection() {
			err = c.WriteJSON(e)
			if err != nil {
				break
			}
		}
	}
}

func (m *Manager) runAdminAPI() {

	go func() {
		// If we fail due to server crash we properly shutdown
		// the receiver to avoid log corruption
		defer func() {
			if err := recover(); err != nil {
				m.Shutdown()
			}
		}()

		rt := mux.NewRouter()
		// Middleware initialization
		// Manages Request Logging
		rt.Use(m.admLogHTTPMiddleware)
		// Manages Authorization
		rt.Use(m.adminAuthorizationMiddleware)
		// Manages Compression
		rt.Use(m.gunzipMiddleware)
		// Set API response headers
		rt.Use(m.adminRespHeaderMiddleware)

		// Routes initialization
		rt.HandleFunc(api.AdmAPIUsers, m.admAPIUsers).Methods("GET", "PUT", "POST")
		rt.HandleFunc(api.AdmAPIUserByID, m.admAPIUser).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIEndpointsPath, m.admAPIEndpoints).Methods("GET", "PUT")
		rt.HandleFunc(api.AdmAPIEndpointsByIDPath, m.admAPIEndpoint).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIEndpointConfigPath, m.admAPIEndpointConfig).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIEndpointCommandPath, m.admAPIEndpointCommand).Methods("GET", "POST")
		rt.HandleFunc(api.AdmAPIEndpointCommandFieldPath, m.admAPIEndpointCommandField).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointsReportsPath, m.admAPIEndpointsReports).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointReportPath, m.admAPIEndpointReport).Methods("GET", "DELETE")
		rt.HandleFunc(api.AdmAPIEndpointReportArchivePath, m.admAPIEndpointReportArchive).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointLogsPath, m.admAPIEndpointLogs).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointDetectionsPath, m.admAPIEndpointLogs).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointsArtifactsPath, m.admAPIArtifacts).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointArtifacts, m.admAPIEndpointArtifacts).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointArtifact, m.admAPIEndpointArtifact).Methods("GET")
		rt.HandleFunc(api.AdmAPIEndpointsSysmonConfig, m.admAPIEndpointSysmonConfig).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIEndpointsSysmonBinary, m.admAPIEndpointSysmonBinary).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIEndpointsOSQueryiBinary, m.admAPIEndpointOSQueryiBinary).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIIocsPath, m.admAPIIocs).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIRulesPath, m.admAPIRules).Methods("GET", "POST", "DELETE")
		rt.HandleFunc(api.AdmAPIStatsPath, m.admAPIStats).Methods("GET")
		// WebSocket handlers
		rt.HandleFunc(api.AdmAPIStreamEvents, m.admAPIStreamEvents)
		rt.HandleFunc(api.AdmAPIStreamDetections, m.admAPIStreamDetections)

		uri := format("%s:%d", m.Config.AdminAPI.Host, m.Config.AdminAPI.Port)
		m.adminAPI = &http.Server{
			Handler:      rt,
			Addr:         uri,
			WriteTimeout: 15 * time.Second,
			ReadTimeout:  15 * time.Second,
		}

		if m.Config.TLS.Empty() {
			// Bind to a port and pass our router in
			m.Logger.Infof("Running admin HTTP API server on: %s", uri)
			if err := m.adminAPI.ListenAndServe(); err != http.ErrServerClosed {
				m.Logger.Abort(1, err)
			}
		} else {
			// Bind to a port and pass our router in
			m.Logger.Infof("Running admin HTTPS API server on: %s", uri)
			if err := m.adminAPI.ListenAndServeTLS(m.Config.TLS.Cert, m.Config.TLS.Key); err != http.ErrServerClosed {
				m.Logger.Abort(1, err)
			}
		}
	}()
}

```

`api/server/manager_endpoint_api.go`:

```go
package server

import (
	"bufio"
	"encoding/json"
	"fmt"
	"io/ioutil"
	"net/http"
	"net/url"
	"path/filepath"
	"strconv"
	"time"

	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/agent/sysinfo"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/tools"

	"github.com/gorilla/mux"
)

var (
	// ErrUnkEndpoint error to return when endpoint is unknown
	ErrUnkEndpoint = fmt.Errorf("unknown endpoint")
)

/////////////////// Utils

func (m *Manager) eptAPIMutEndpointFromRequest(rq *http.Request) *api.Endpoint {
	uuid := rq.Header.Get(api.EndpointUUIDHeader)
	if endpt, ok := m.Endpoint(uuid); ok {
		return endpt
	}
	return nil
}

// Middleware definitions

func (m *Manager) endpointAuthorizationMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(wt http.ResponseWriter, rq *http.Request) {
		var endpt *api.Endpoint
		var ok bool

		uuid := rq.Header.Get(api.EndpointUUIDHeader)
		key := rq.Header.Get(api.AuthKeyHeader)
		hostname := rq.Header.Get(api.EndpointHostnameHeader)
		ip := rq.Header.Get(api.EndpointIPHeader)

		if endpt, ok = m.Endpoint(uuid); !ok {
			http.Error(wt, "Not Authorized", http.StatusForbidden)
			// we have to return not to reach ServeHTTP
			return
		}

		if endpt.Uuid != uuid || endpt.Key != key {
			http.Error(wt, "Not Authorized", http.StatusForbidden)
			// we have to return not to reach ServeHTTP
			return
		}

		endpt.IP = ip

		switch {
		case endpt.Hostname == "":
			endpt.Hostname = hostname
		case endpt.Hostname != hostname:
			m.logAPIErrorf("two hosts are using the same credentials %s (%s) and %s (%s)", endpt.Hostname, endpt.IP, hostname, ip)
			http.Error(wt, "Not Authorized", http.StatusForbidden)
			// we have to return not to reach ServeHTTP
			return
		}

		// update last connection timestamp
		endpt.UpdateLastConnection()
		if err := m.db.InsertOrUpdate(endpt); err != nil {
			m.logAPIErrorf("failed to commit endpoint changes")
		}
		next.ServeHTTP(wt, rq)
	})
}

func isVerboseURL(u *url.URL) bool {
	for _, vu := range api.EptAPIVerbosePaths {
		if u.Path == vu {
			return true
		}
	}
	return false
}

func (m *Manager) endptLogHTTPMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		// src-ip:src-port http-method http-proto url user-agent UUID content-length
		//fmt.Printf("%s %s %s %s %s \"%s\" \"%s\" %d\n", time.Now().Format(time.RFC3339Nano), r.RemoteAddr, r.Method, r.Proto, r.URL, r.UserAgent(), r.Header.Get(api.EndpointUUIDHeader), r.ContentLength)
		m.Logger.Log(r.RemoteAddr, r.Method, r.Proto, r.URL, r.UserAgent(), r.Header.Get(api.EndpointUUIDHeader), r.ContentLength)
		next.ServeHTTP(w, r)
	})
}

func (m *Manager) endptQuietLogHTTPMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		if !isVerboseURL(r.URL) {
			// src-ip:src-port http-method http-proto url user-agent UUID content-length
			//fmt.Printf("%s %s %s %s %s \"%s\" \"%s\" %d\n", time.Now().Format(time.RFC3339Nano), r.RemoteAddr, r.Method, r.Proto, r.URL, r.UserAgent(), r.Header.Get(api.EndpointUUIDHeader), r.ContentLength)
			m.Logger.Log(r.RemoteAddr, r.Method, r.Proto, r.URL, r.UserAgent(), r.Header.Get(api.EndpointUUIDHeader), r.ContentLength)
		}
		next.ServeHTTP(w, r)
	})
}

func (m *Manager) runEndpointAPI() {

	go func() {
		// If we fail due to server crash we properly shutdown
		// the receiver to avoid log corruption
		defer func() {
			if err := recover(); err != nil {
				m.Shutdown()
			}
		}()

		rt := mux.NewRouter()
		// Middleware initialization
		// Manages Request Logging
		if m.Config.Logging.VerboseHTTP {
			rt.Use(m.endptLogHTTPMiddleware)
		} else {
			rt.Use(m.endptQuietLogHTTPMiddleware)
		}

		// Manages Authorization
		rt.Use(m.endpointAuthorizationMiddleware)
		// Manages Compression
		rt.Use(m.gunzipMiddleware)

		// Routes initialization
		// POST based
		rt.HandleFunc(api.EptAPIPostLogsPath, m.eptAPICollect).Methods("POST")
		rt.HandleFunc(api.EptAPIPostDumpPath, m.eptAPIUploadDump).Methods("POST")
		rt.HandleFunc(api.EptAPIPostSystemInfo, m.eptAPISystemInfo).Methods("POST")

		// GET based
		rt.HandleFunc(api.EptAPIServerKeyPath, m.eptAPIServerKey).Methods("GET")
		rt.HandleFunc(api.EptAPIRulesPath, m.eptAPIRules).Methods("GET")
		rt.HandleFunc(api.EptAPIRulesSha256Path, m.eptAPIRulesSha256).Methods("GET")
		rt.HandleFunc(api.EptAPIIoCsPath, m.eptAPIIoCs).Methods("GET")
		rt.HandleFunc(api.EptAPIIoCsSha256Path, m.eptAPIIoCsSha256).Methods("GET")
		rt.HandleFunc(api.EptAPISysmonConfigPath, m.eptAPISysmonConfig).Methods("GET")
		rt.HandleFunc(api.EptAPISysmonConfigSha256Path, m.eptAPISysmonConfigSha256).Methods("GET")
		rt.HandleFunc(api.EptAPITools, m.eptAPITools).Methods("GET")
		rt.HandleFunc(api.EptAPIConfigSha256Path, m.eptAPIConfigSha256).Methods("GET")

		// GET and POST
		rt.HandleFunc(api.EptAPICommandPath, m.eptAPICommand).Methods("GET", "POST")
		rt.HandleFunc(api.EptAPIConfigPath, m.eptAPIConfig).Methods("GET", "POST")

		uri := fmt.Sprintf("%s:%d", m.Config.EndpointAPI.Host, m.Config.EndpointAPI.Port)
		m.endpointAPI = &http.Server{
			Handler:      rt,
			Addr:         uri,
			WriteTimeout: 15 * time.Second,
			ReadTimeout:  15 * time.Second,
		}

		if m.Config.TLS.Empty() {
			// Bind to a port and pass our router in
			m.Logger.Infof("Running endpoint HTTP API server on: %s", uri)
			if err := m.endpointAPI.ListenAndServe(); err != http.ErrServerClosed {
				m.Logger.Abort(1, err)
			}
		} else {
			// Bind to a port and pass our router in
			m.Logger.Infof("Running endpoint HTTPS API server on: %s", uri)
			if err := m.endpointAPI.ListenAndServeTLS(m.Config.TLS.Cert, m.Config.TLS.Key); err != http.ErrServerClosed {
				m.Logger.Abort(1, err)
			}
		}
	}()
}

// eptAPIServerKey HTTP handler used to authenticate server on client side
func (m *Manager) eptAPIServerKey(wt http.ResponseWriter, rq *http.Request) {
	wt.Write([]byte(m.Config.EndpointAPI.ServerKey))
}

// eptAPIRules HTTP handler used to serve the rules
func (m *Manager) eptAPIRules(wt http.ResponseWriter, rq *http.Request) {
	m.RLock()
	defer m.RUnlock()
	wt.Write([]byte(m.gene.rules))
}

// eptAPIConfigSha256 HTTP handler
func (m *Manager) eptAPIConfigSha256(wt http.ResponseWriter, rq *http.Request) {
	var endpt *api.Endpoint

	if endpt = m.eptAPIMutEndpointFromRequest(rq); endpt == nil {
		m.logAPIErrorf("unknown endpoint")
		return
	}

	// if configuration is nil we return StatusNoContent
	if endpt.Config == nil {
		http.Error(wt, "", http.StatusNoContent)
		return
	}

	sha256, err := endpt.Config.Sha256()
	if err != nil {
		http.Error(wt, "failed to compute config hash", http.StatusInternalServerError)
		return
	}

	wt.Write([]byte(sha256))
}

// eptAPIConfigHTTP handler
func (m *Manager) eptAPIConfig(wt http.ResponseWriter, rq *http.Request) {
	var endpt *api.Endpoint

	if endpt = m.eptAPIMutEndpointFromRequest(rq); endpt == nil {
		m.logAPIErrorf("unknown endpoint")
		return
	}

	switch rq.Method {
	case "GET":

		// if configuration is nil we return StatusNoContent
		if endpt.Config == nil {
			http.Error(wt, "", http.StatusNoContent)
			return
		}

		out, err := json.Marshal(endpt.Config)
		if err != nil {
			m.logAPIErrorf("failed at serializing config to JSON: %s", err)
			http.Error(wt, "failed to serialize config", http.StatusInternalServerError)
			return
		}

		wt.Write(out)

	case "POST":
		var config config.Agent

		// we don't update configuration if not nil
		if endpt.Config != nil {
			m.logAPIErrorf("client attempt to modify config: %s", endpt.Uuid)
			http.Error(wt, "", http.StatusForbidden)
			return
		}

		// handle modification
		if err := readPostAsJSON(rq, &config); err != nil {
			m.logAPIErrorf("failed to unmarshal client config: %s", err)
			http.Error(wt, "failed to unmarshal config", http.StatusInternalServerError)
			return
		}

		endpt.Config = &config

		if err := m.db.InsertOrUpdate(endpt); err != nil {
			m.logAPIErrorf("failed to update client config: %s", err)
			http.Error(wt, "failed to update client config", http.StatusInternalServerError)
			return
		}
	}
}

// eptAPIRulesSha256 returns the sha256 of the latest set of rules loaded into the manager
func (m *Manager) eptAPIRulesSha256(wt http.ResponseWriter, rq *http.Request) {
	m.RLock()
	defer m.RUnlock()
	wt.Write([]byte(m.gene.sha256))
}

func (m *Manager) eptAPIIoCs(wt http.ResponseWriter, rq *http.Request) {
	if data, err := json.Marshal(m.iocs.StringSlice()); err != nil {
		m.logAPIErrorf("failed to marshal IoCs: %s", err)
		http.Error(wt, "failed to marshal IoCs", http.StatusInternalServerError)
	} else {
		wt.Write(data)
	}
}

func (m *Manager) eptAPIIoCsSha256(wt http.ResponseWriter, rq *http.Request) {
	wt.Write([]byte(m.iocs.Hash()))
}

// eptAPIUploadDump HTTP handler used to upload dump files from client to manager
func (m *Manager) eptAPIUploadDump(wt http.ResponseWriter, rq *http.Request) {
	defer rq.Body.Close()

	if m.Config.DumpDir == "" {
		m.logAPIErrorf("handler won't dump because no dump directory set")
		http.Error(wt, "failed to dump file", http.StatusInternalServerError)
		return
	}

	fu := client.FileUpload{}
	dec := json.NewDecoder(rq.Body)

	if endpt := m.eptAPIMutEndpointFromRequest(rq); endpt != nil {
		if err := dec.Decode(&fu); err != nil {
			m.logAPIErrorf("handler failed to decode JSON")
			http.Error(wt, "failed to decode JSON", http.StatusInternalServerError)
			return
		}

		endptDumpDir := filepath.Join(m.Config.DumpDir, endpt.Uuid)
		if err := fu.Dump(endptDumpDir); err != nil {
			m.logAPIErrorf("handler failed to dump file (%s): %s", fu.Implode(), err)
			http.Error(wt, "failed to dump file", http.StatusInternalServerError)
			return
		}
	} else {
		m.logAPIErrorf("failed to retrieve endpoint from request")
	}
}

// Container HTTP handler serves Gene containers to clients

// eptAPICollect HTTP handler
func (m *Manager) eptAPICollect(wt http.ResponseWriter, rq *http.Request) {
	defer rq.Body.Close()

	cnt := 0
	uuid := rq.Header.Get(api.EndpointUUIDHeader)
	endpt, _ := m.Endpoint(uuid)

	etid := m.eventLogger.InitTransaction()
	dtid := m.detectionLogger.InitTransaction()
	s := bufio.NewScanner(rq.Body)
	for s.Scan() {
		tok := []byte(s.Text())
		e := event.EdrEvent{}

		if err := json.Unmarshal(tok, &e); err != nil {
			m.logAPIErrorf("failed to unmarshal: %s", tok)
		} else {

			// building up EdrData
			edrData := event.EdrData{}
			edrData.Event.ReceiptTime = time.Now().UTC()

			edrData.Endpoint.UUID = uuid
			if endpt != nil {
				// updating EdrData fields
				edrData.Endpoint.IP = endpt.IP
				edrData.Endpoint.Hostname = endpt.Hostname
				edrData.Endpoint.Group = endpt.Group

				// updating reducer
				m.UpdateReducer(endpt.Uuid, &e)

				// updating last event
				endpt.LastEvent = e.Timestamp()
				// updating last detection
				if e.IsDetection() {
					endpt.LastDetection = e.Timestamp()
				}
			}

			edrData.Event.Detection = e.IsDetection()

			// setting EdrData
			e.Event.EdrData = &edrData
			// compute event Hash and save it into the event
			e.Commit()

			// If it is an alert
			if e.IsDetection() {
				if _, err := m.detectionLogger.WriteEvent(dtid, uuid, &e); err != nil {
					m.logAPIErrorf("failed to write detection: %s", err)
				}
			}

			if _, err := m.eventLogger.WriteEvent(etid, uuid, &e); err != nil {
				m.logAPIErrorf("failed to write event: %s", err)
			}

			// we queue event for streaming
			m.eventStreamer.Queue(&e)
		}
		cnt++
	}

	if endpt != nil {
		if err := m.db.InsertOrUpdate(endpt); err != nil {
			m.logAPIErrorf("failed to update endpoint UUID=%s: %s", endpt.Uuid, err)
		}
	}

	if err := m.eventLogger.CommitTransaction(); err != nil {
		m.logAPIErrorf("failed to commit event logger transaction: %s", err)
	}

	if err := m.detectionLogger.CommitTransaction(); err != nil {
		m.logAPIErrorf("failed to commit detection logger transaction: %s", err)
	}
	m.Logger.Debugf("count Event Received: %d", cnt)

}

// eptAPICommand HTTP handler
func (m *Manager) eptAPICommand(wt http.ResponseWriter, rq *http.Request) {

	switch rq.Method {
	case "GET":
		if endpt := m.eptAPIMutEndpointFromRequest(rq); endpt != nil {
			// we send back the command to execute only if was not already sent
			if endpt.Command != nil {
				if !endpt.Command.Sent {
					jsonCmd, err := json.Marshal(endpt.Command)
					if err != nil {
						m.logAPIErrorf("failed at serializing command to JSON: %s", err)
					} else {
						wt.Write(jsonCmd)
					}
					endpt.Command.Sent = true
					endpt.Command.SentTime = time.Now()
					if err := m.db.InsertOrUpdate(endpt); err != nil {
						m.logAPIErrorf("failed to update endpoint data: %s", err)
					}
					return
				}
			}
			// if the command is nil or already sent
			http.Error(wt, "", http.StatusNoContent)
		}
	case "POST":
		if endpt := m.eptAPIMutEndpointFromRequest(rq); endpt != nil {
			// if command is nil we actually don't expect any result
			if endpt.Command != nil {
				if !endpt.Command.Completed {
					defer rq.Body.Close()
					body, err := ioutil.ReadAll(rq.Body)
					if err != nil {
						m.logAPIErrorf("failed to read response body: %s", err)
					} else {
						rcmd := api.EndpointCommand{}
						err := json.Unmarshal(body, &rcmd)
						if err != nil {
							m.logAPIErrorf("failed to unmarshal received command: %s", err)
						} else {
							// we complete the command executed on the endpoint
							endpt.Command.Complete(&rcmd)
							if err := m.db.InsertOrUpdate(endpt); err != nil {
								m.logAPIErrorf("to update endpoint data: %s", err)
							}
						}
					}
				} else {
					m.logAPIErrorf("command is already completed")
				}
			}
		}
	}
}

// Command HTTP handler
func (m *Manager) eptAPISystemInfo(wt http.ResponseWriter, rq *http.Request) {
	switch rq.Method {
	case "POST":
		if endpt := m.eptAPIMutEndpointFromRequest(rq); endpt != nil {
			info := sysinfo.SystemInfo{}
			if err := readPostAsJSON(rq, &info); err != nil {
				m.logAPIErrorf("failed to receive system information for %s", endpt.Uuid)
				http.Error(wt, "failed to unmarshal data", http.StatusInternalServerError)
			} else {
				endpt.SystemInfo = &info
				m.db.InsertOrUpdate(endpt)
				if err := m.db.InsertOrUpdate(endpt); err != nil {
					m.logAPIErrorf("failed to update endpoint data: %s", err)
				}
			}
		}
	}
}

func (m *Manager) eptAPISysmonConfig(wt http.ResponseWriter, rq *http.Request) {
	var config *sysmon.Config

	os := rq.URL.Query().Get(api.QpOS)
	sversion := rq.URL.Query().Get(api.QpVersion)

	if err := m.db.Search(&sysmon.Config{}, "OS", "=", os).And("SchemaVersion", "=", sversion).AssignOne(&config); err == nil {
		if json, err := json.Marshal(config); err == nil {
			wt.Write(json)
		} else {
			http.Error(wt, "failed to marshal data", http.StatusInternalServerError)
		}
	} else {
		http.Error(wt, "no config available", http.StatusNoContent)
	}
}

func (m *Manager) eptAPISysmonConfigSha256(wt http.ResponseWriter, rq *http.Request) {
	var config *sysmon.Config

	os := rq.URL.Query().Get(api.QpOS)
	sversion := rq.URL.Query().Get(api.QpVersion)

	if err := m.db.Search(&sysmon.Config{}, "OS", "=", os).And("SchemaVersion", "=", sversion).AssignOne(&config); err == nil {
		wt.Write([]byte(config.XmlSha256))
	} else {
		http.Error(wt, "no config available", http.StatusNoContent)
	}
}

func (m *Manager) eptAPITools(wt http.ResponseWriter, rq *http.Request) {
	var stools []*tools.Tool

	binary, _ := strconv.ParseBool(rq.URL.Query().Get(api.QpBinary))
	os := rq.URL.Query().Get(api.QpOS)
	hash := rq.URL.Query().Get(api.QpHash)

	search := m.db.Search(&tools.Tool{}, "OS", "=", os)

	// key=name value=tool
	out := make(map[string]*tools.Tool)

	// if we want to get a single file
	switch len(hash) {
	case 32:
		search = search.And("Metadata.Md5", "=", hash)
	case 40:
		search = search.And("Metadata.Sha1", "=", hash)
	case 64:
		search = search.And("Metadata.Sha256", "=", hash)
	case 128:
		search = search.And("Metadata.Sha512", "=", hash)
	}

	if err := search.Assign(&stools); err != nil {
		http.Error(wt, err.Error(), http.StatusInternalServerError)
		return
	}

	// create map to send to endpoints
	for _, t := range stools {
		// if binary content is not needed we don't transfer it
		if !binary {
			t.Binary = nil
		}

		out[t.Name] = t
	}

	if json, err := json.Marshal(out); err != nil {
		http.Error(wt, "failed to marshal data", http.StatusInternalServerError)
		return
	} else {
		wt.Write(json)
	}
}

```

`api/server/manager_test_func.go`:

```go
package server

import "github.com/0xrawsec/whids/tools"

/*
Commodity functions used to configure manager from tests
without having to use HTTP API
*/

func (m *Manager) TestAddTool(t *tools.Tool) error {
	return m.db.InsertOrUpdate(t)
}

```

`api/server/openapi_def.go`:

```go
package server

var OpenAPIDefinition = `
{
  "openapi": "3.0.2",
  "info": {
    "title": "WHIDS API documentation",
    "version": "1.0"
  },
  "servers": [
    {
      "url": "https://localhost:1520"
    }
  ],
  "paths": {
    "/endpoints": {
      "get": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Get endpoints",
        "parameters": [
          {
            "name": "showkey",
            "in": "query",
            "description": "Show or not key",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "group",
            "in": "query",
            "description": "Filter by group",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by status",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "criticality",
            "in": "query",
            "description": "Filter by criticality",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "criticality": 0,
                      "group": "",
                      "hostname": "OpenHappy",
                      "ip": "127.0.0.1",
                      "key": "f5s8HgzGzBetvBIHhsT2LrDX0N7sGXobQbxWuxrfjriD6kKarCifHq9HsEyKSPHT",
                      "last-connection": "2022-08-25T15:16:32.049198117Z",
                      "last-detection": "2022-08-25T17:16:30.985842372+02:00",
                      "last-event": "2022-08-25T17:16:30.985842372+02:00",
                      "score": 0,
                      "status": "",
                      "system-info": {
                        "bios": {
                          "date": "12/01/2006",
                          "version": "VirtualBox"
                        },
                        "cpu": {
                          "count": 4,
                          "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                        },
                        "edr": {
                          "commit": "deadbeeeeeeeeeeeeeeeeef",
                          "version": "major.minor.patch"
                        },
                        "error": null,
                        "os": {
                          "build": "18362",
                          "edition": "Enterprise",
                          "name": "windows",
                          "product": "Windows 10 Pro",
                          "version": "10.0.18362"
                        },
                        "sysmon": {
                          "config": {
                            "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                            "version": {
                              "binary": "15.0",
                              "schema": "4.70"
                            }
                          },
                          "driver": {
                            "image": "C:\\Windows\\SysmonDrv.sys",
                            "name": "SysmonDrv",
                            "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                          },
                          "service": {
                            "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                            "name": "Sysmon64",
                            "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                          },
                          "version": "v13.23"
                        },
                        "system": {
                          "manufacturer": "innotek GmbH",
                          "name": "VirtualBox",
                          "virtual": true
                        }
                      },
                      "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Create a new endpoint",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "",
                    "hostname": "",
                    "ip": "",
                    "key": "aEiMQPYozy80CBttLiWgfCF8zpDgYoIUWNQPKhTwjLWJGKn7YMh914TfDzuGDJRe",
                    "last-connection": "0001-01-01T00:00:00Z",
                    "last-detection": "0001-01-01T00:00:00Z",
                    "last-event": "0001-01-01T00:00:00Z",
                    "score": 0,
                    "status": "",
                    "uuid": "9c379554-6adc-e685-a137-85e058733860"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/artifacts": {
      "get": {
        "tags": [
          "Artifact Search and Retrieval"
        ],
        "summary": "Artifacts on all endpoints",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve artifacts received since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d": [
                      {
                        "base-url": "/endpoints/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/artifacts/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/3d8441643c204ba9b9dcb5c414b25a3129f66f6c/",
                        "creation": "2022-08-25T15:16:37.677528168Z",
                        "event-hash": "3d8441643c204ba9b9dcb5c414b25a3129f66f6c",
                        "files": [
                          {
                            "name": "bar.txt",
                            "size": 4,
                            "timestamp": "2022-08-25T15:16:37.677528168Z"
                          },
                          {
                            "name": "foo.txt",
                            "size": 4,
                            "timestamp": "2022-08-25T15:16:37.677528168Z"
                          }
                        ],
                        "modification": "2022-08-25T15:16:37.677528168Z",
                        "process-guid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                      }
                    ]
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/reports": {
      "get": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Get all detection reports",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d": {
                      "alert-count": 50,
                      "alert-criticality-metric": 0,
                      "avg-alert-criticality": 0,
                      "avg-signature-criticality": 0,
                      "bounded-score": 0,
                      "count-by-signature": {
                        "DefenderConfigChanged": 4,
                        "NewAutorun": 23,
                        "SuspiciousService": 9,
                        "UnknownServices": 9,
                        "UntrustedDriverLoaded": 5
                      },
                      "count-uniq-signatures": 5,
                      "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                      "median-time": "2022-08-25T17:16:35.472131213+02:00",
                      "score": 0,
                      "signature-count": 50,
                      "signature-criticality-metric": 0,
                      "signature-diversity": 100,
                      "signatures": [
                        "DefenderConfigChanged",
                        "SuspiciousService",
                        "NewAutorun",
                        "UntrustedDriverLoaded",
                        "UnknownServices"
                      ],
                      "start-time": "2022-08-25T17:16:35.470679762+02:00",
                      "std-dev-alert-criticality": 0,
                      "std-dev-signature-criticality": -92233720368547760,
                      "stop-time": "2022-08-25T17:16:35.473582664+02:00",
                      "sum-alert-criticality": 0,
                      "sum-rule-criticality": 0,
                      "tactics": null,
                      "techniques": null
                    }
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{os}/osqueryi/binary": {
      "get": {
        "tags": [
          "Manage OSQueryi installation"
        ],
        "summary": "Get information about OSQueryi binary",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "osqueryi",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "osqueryi",
                    "os": "windows",
                    "uuid": "6e687d83-0b1c-71d1-c462-590934e8449a"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Manage OSQueryi installation"
        ],
        "summary": "Add or update OSQueryi binary to deploy on endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "OSQueryi binary to deploy",
          "content": {
            "application/octet-stream": {
              "schema": {
                "type": "string",
                "format": "binary"
              },
              "example": "TVpmb29iYXI="
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "osqueryi",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "osqueryi",
                    "os": "windows",
                    "uuid": "6e687d83-0b1c-71d1-c462-590934e8449a"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manage OSQueryi installation"
        ],
        "summary": "Delete OSQueryi binary from manager and connected endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "osqueryi",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "osqueryi",
                    "os": "windows",
                    "uuid": "6e687d83-0b1c-71d1-c462-590934e8449a"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{os}/sysmon/binary": {
      "get": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Get information about Sysmon binary",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "sysmon",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "sysmon",
                    "os": "windows",
                    "uuid": "27e43f8d-785c-7e10-1969-469bdb795d73"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Add or update Sysmon binary to deploy on connected endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Sysmon binary to deploy",
          "content": {
            "application/octet-stream": {
              "schema": {
                "type": "string",
                "format": "binary"
              },
              "example": "TVpmb29iYXI="
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "sysmon",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "sysmon",
                    "os": "windows",
                    "uuid": "27e43f8d-785c-7e10-1969-469bdb795d73"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Delete Sysmon binary from manager and connected endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "sysmon",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "sysmon",
                    "os": "windows",
                    "uuid": "27e43f8d-785c-7e10-1969-469bdb795d73"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{os}/sysmon/config": {
      "get": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Get a Sysmon configuration",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version",
            "in": "query",
            "description": "version query parameter",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "format query parameter",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "raw",
            "in": "query",
            "description": "raw query parameter",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "CheckRevocation": false,
                    "CopyOnDeletePE": false,
                    "DnsLookup": false,
                    "EventFiltering": {
                      "ClipboardChange": {
                        "onmatch": "exclude"
                      },
                      "CreateRemoteThread": {
                        "onmatch": "exclude"
                      },
                      "DriverLoad": {
                        "onmatch": "exclude"
                      },
                      "FileCreate": {
                        "onmatch": "exclude"
                      },
                      "FileCreateStreamHash": {
                        "onmatch": "exclude"
                      },
                      "FileCreateTime": {
                        "onmatch": "exclude"
                      },
                      "FileDelete": {
                        "onmatch": "exclude"
                      },
                      "FileDeleteDetected": {
                        "onmatch": "exclude"
                      },
                      "NetworkConnect": {
                        "onmatch": "exclude"
                      },
                      "PipeEvent": {
                        "onmatch": "exclude"
                      },
                      "ProcessCreate": {
                        "onmatch": "exclude"
                      },
                      "ProcessTampering": {
                        "onmatch": "exclude"
                      },
                      "ProcessTerminate": {
                        "onmatch": "exclude"
                      },
                      "RawAccessRead": {
                        "onmatch": "exclude"
                      },
                      "RuleGroup": [
                        {
                          "ImageLoad": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "Signature": [
                              {
                                "condition": "is",
                                "value": "Microsoft Windows Publisher"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Corporation"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Windows"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "ProcessAccess": {
                            "GrantedAccess": [
                              {
                                "condition": "is",
                                "value": "0x1000"
                              },
                              {
                                "condition": "is",
                                "value": "0x2000"
                              },
                              {
                                "condition": "is",
                                "value": "0x3000"
                              },
                              {
                                "condition": "is",
                                "value": "0x100000"
                              },
                              {
                                "condition": "is",
                                "value": "0x101000"
                              }
                            ],
                            "SourceImage": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\System32\\VBoxService.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\taskmgr.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "RegistryEvent": {
                            "EventType": [
                              {
                                "condition": "is not",
                                "value": "SetValue"
                              }
                            ],
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "DnsQuery": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        }
                      ],
                      "WmiEvent": {
                        "onmatch": "exclude"
                      }
                    },
                    "HashAlgorithms": [
                      "*"
                    ],
                    "OS": "windows",
                    "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                    "schemaversion": "4.70"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Add or update a Sysmon configuration",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "format query parameter",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Sysmon configuration file. Raw XML file that you would use to configure Sysmon can be posted here.",
          "content": {
            "application/xml": {
              "schema": {
                "type": "object",
                "properties": {
                  "InnerConfig": {
                    "type": "object",
                    "properties": {
                      "": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "EventFiltering": {
                        "type": "object",
                        "properties": {
                          "Filters": {
                            "type": "object",
                            "properties": {
                              "": {
                                "type": "object",
                                "properties": {
                                  "EventFilter": {
                                    "type": "object",
                                    "properties": {
                                      "onmatch": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "Hashes": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "Image": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "IsExecutable": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "ProcessGuid": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "ProcessId": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "RuleName": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "TargetFilename": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "User": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "UtcTime": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "RuleGroup": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "Filters": {
                                  "type": "object",
                                  "properties": {
                                    "": {
                                      "type": "object",
                                      "properties": {
                                        "EventFilter": {
                                          "type": "object",
                                          "properties": {
                                            "onmatch": {
                                              "type": "string"
                                            }
                                          }
                                        },
                                        "Hashes": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "Image": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "IsExecutable": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "ProcessGuid": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "ProcessId": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "RuleName": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "TargetFilename": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "User": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "UtcTime": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "groupRelation": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      },
                      "Sysmon": {
                        "type": "object",
                        "properties": {
                          "Local": {
                            "type": "string"
                          },
                          "Space": {
                            "type": "string"
                          }
                        }
                      },
                      "schemaversion": {
                        "type": "string"
                      }
                    }
                  },
                  "Item": {
                    "type": "object"
                  }
                }
              },
              "example": {
                "schemaversion": "4.70",
                "CheckRevocation": false,
                "CopyOnDeletePE": false,
                "DnsLookup": false,
                "HashAlgorithms": [
                  "*"
                ],
                "EventFiltering": {
                  "ProcessCreate": {
                    "onmatch": "exclude"
                  },
                  "FileCreateTime": {
                    "onmatch": "exclude"
                  },
                  "NetworkConnect": {
                    "onmatch": "exclude"
                  },
                  "ProcessTerminate": {
                    "onmatch": "exclude"
                  },
                  "DriverLoad": {
                    "onmatch": "exclude"
                  },
                  "CreateRemoteThread": {
                    "onmatch": "exclude"
                  },
                  "RawAccessRead": {
                    "onmatch": "exclude"
                  },
                  "FileCreate": {
                    "onmatch": "exclude"
                  },
                  "FileCreateStreamHash": {
                    "onmatch": "exclude"
                  },
                  "PipeEvent": {
                    "onmatch": "exclude"
                  },
                  "WmiEvent": {
                    "onmatch": "exclude"
                  },
                  "FileDelete": {
                    "onmatch": "exclude"
                  },
                  "ClipboardChange": {
                    "onmatch": "exclude"
                  },
                  "ProcessTampering": {
                    "onmatch": "exclude"
                  },
                  "FileDeleteDetected": {
                    "onmatch": "exclude"
                  },
                  "RuleGroup": [
                    {
                      "ImageLoad": {
                        "onmatch": "exclude",
                        "Image": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon64.exe"
                          }
                        ],
                        "Signature": [
                          {
                            "condition": "is",
                            "value": "Microsoft Windows Publisher"
                          },
                          {
                            "condition": "is",
                            "value": "Microsoft Corporation"
                          },
                          {
                            "condition": "is",
                            "value": "Microsoft Windows"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    },
                    {
                      "ProcessAccess": {
                        "onmatch": "exclude",
                        "SourceImage": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\System32\\VBoxService.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\system32\\taskmgr.exe"
                          }
                        ],
                        "GrantedAccess": [
                          {
                            "condition": "is",
                            "value": "0x1000"
                          },
                          {
                            "condition": "is",
                            "value": "0x2000"
                          },
                          {
                            "condition": "is",
                            "value": "0x3000"
                          },
                          {
                            "condition": "is",
                            "value": "0x100000"
                          },
                          {
                            "condition": "is",
                            "value": "0x101000"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    },
                    {
                      "RegistryEvent": {
                        "onmatch": "exclude",
                        "EventType": [
                          {
                            "condition": "is not",
                            "value": "SetValue"
                          }
                        ],
                        "Image": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon64.exe"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    },
                    {
                      "DnsQuery": {
                        "onmatch": "exclude",
                        "Image": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon64.exe"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    }
                  ]
                },
                "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                "OS": "windows"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "CheckRevocation": false,
                    "CopyOnDeletePE": false,
                    "DnsLookup": false,
                    "EventFiltering": {
                      "ClipboardChange": {
                        "onmatch": "exclude"
                      },
                      "CreateRemoteThread": {
                        "onmatch": "exclude"
                      },
                      "DriverLoad": {
                        "onmatch": "exclude"
                      },
                      "FileCreate": {
                        "onmatch": "exclude"
                      },
                      "FileCreateStreamHash": {
                        "onmatch": "exclude"
                      },
                      "FileCreateTime": {
                        "onmatch": "exclude"
                      },
                      "FileDelete": {
                        "onmatch": "exclude"
                      },
                      "FileDeleteDetected": {
                        "onmatch": "exclude"
                      },
                      "NetworkConnect": {
                        "onmatch": "exclude"
                      },
                      "PipeEvent": {
                        "onmatch": "exclude"
                      },
                      "ProcessCreate": {
                        "onmatch": "exclude"
                      },
                      "ProcessTampering": {
                        "onmatch": "exclude"
                      },
                      "ProcessTerminate": {
                        "onmatch": "exclude"
                      },
                      "RawAccessRead": {
                        "onmatch": "exclude"
                      },
                      "RuleGroup": [
                        {
                          "ImageLoad": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "Signature": [
                              {
                                "condition": "is",
                                "value": "Microsoft Windows Publisher"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Corporation"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Windows"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "ProcessAccess": {
                            "GrantedAccess": [
                              {
                                "condition": "is",
                                "value": "0x1000"
                              },
                              {
                                "condition": "is",
                                "value": "0x2000"
                              },
                              {
                                "condition": "is",
                                "value": "0x3000"
                              },
                              {
                                "condition": "is",
                                "value": "0x100000"
                              },
                              {
                                "condition": "is",
                                "value": "0x101000"
                              }
                            ],
                            "SourceImage": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\System32\\VBoxService.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\taskmgr.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "RegistryEvent": {
                            "EventType": [
                              {
                                "condition": "is not",
                                "value": "SetValue"
                              }
                            ],
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "DnsQuery": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        }
                      ],
                      "WmiEvent": {
                        "onmatch": "exclude"
                      }
                    },
                    "HashAlgorithms": [
                      "*"
                    ],
                    "OS": "windows",
                    "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                    "schemaversion": "4.70"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Delete a Sysmon configuration",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version",
            "in": "query",
            "description": "version query parameter",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "CheckRevocation": false,
                    "CopyOnDeletePE": false,
                    "DnsLookup": false,
                    "EventFiltering": {
                      "ClipboardChange": {
                        "onmatch": "exclude"
                      },
                      "CreateRemoteThread": {
                        "onmatch": "exclude"
                      },
                      "DriverLoad": {
                        "onmatch": "exclude"
                      },
                      "FileCreate": {
                        "onmatch": "exclude"
                      },
                      "FileCreateStreamHash": {
                        "onmatch": "exclude"
                      },
                      "FileCreateTime": {
                        "onmatch": "exclude"
                      },
                      "FileDelete": {
                        "onmatch": "exclude"
                      },
                      "FileDeleteDetected": {
                        "onmatch": "exclude"
                      },
                      "NetworkConnect": {
                        "onmatch": "exclude"
                      },
                      "PipeEvent": {
                        "onmatch": "exclude"
                      },
                      "ProcessCreate": {
                        "onmatch": "exclude"
                      },
                      "ProcessTampering": {
                        "onmatch": "exclude"
                      },
                      "ProcessTerminate": {
                        "onmatch": "exclude"
                      },
                      "RawAccessRead": {
                        "onmatch": "exclude"
                      },
                      "RuleGroup": [
                        {
                          "ImageLoad": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "Signature": [
                              {
                                "condition": "is",
                                "value": "Microsoft Windows Publisher"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Corporation"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Windows"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "ProcessAccess": {
                            "GrantedAccess": [
                              {
                                "condition": "is",
                                "value": "0x1000"
                              },
                              {
                                "condition": "is",
                                "value": "0x2000"
                              },
                              {
                                "condition": "is",
                                "value": "0x3000"
                              },
                              {
                                "condition": "is",
                                "value": "0x100000"
                              },
                              {
                                "condition": "is",
                                "value": "0x101000"
                              }
                            ],
                            "SourceImage": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\System32\\VBoxService.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\taskmgr.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "RegistryEvent": {
                            "EventType": [
                              {
                                "condition": "is not",
                                "value": "SetValue"
                              }
                            ],
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "DnsQuery": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        }
                      ],
                      "WmiEvent": {
                        "onmatch": "exclude"
                      }
                    },
                    "HashAlgorithms": [
                      "*"
                    ],
                    "OS": "windows",
                    "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                    "schemaversion": "4.70"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}": {
      "get": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Get information about a single endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "last-connection": "2022-08-25T15:16:32.059915491Z",
                    "last-detection": "2022-08-25T17:16:30.985842372+02:00",
                    "last-event": "2022-08-25T17:16:30.985842372+02:00",
                    "score": 0,
                    "status": "",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Modify an existing endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "showkey",
            "in": "query",
            "description": "Show endpoint key in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "newkey",
            "in": "query",
            "description": "Generate a new key for endpoint",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Fields to modify. NB: Not all the fields can be modified",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "Item": {
                    "type": "object"
                  },
                  "command": {
                    "type": "object",
                    "properties": {
                      "args": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "background": {
                        "type": "boolean"
                      },
                      "completed": {
                        "type": "boolean"
                      },
                      "drop": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "data": {
                              "type": "string",
                              "format": "binary"
                            },
                            "error": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "uuid": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "error": {
                        "type": "string"
                      },
                      "expect-json": {
                        "type": "boolean"
                      },
                      "fetch": {
                        "type": "object",
                        "properties": {
                          "key(string)": {
                            "type": "object",
                            "properties": {
                              "data": {
                                "type": "string",
                                "format": "binary"
                              },
                              "error": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "uuid": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      },
                      "json": {
                        "type": "object"
                      },
                      "name": {
                        "type": "string"
                      },
                      "sent": {
                        "type": "boolean"
                      },
                      "sent-time": {
                        "type": "string",
                        "format": "date"
                      },
                      "stderr": {
                        "type": "string",
                        "format": "binary"
                      },
                      "stdout": {
                        "type": "string",
                        "format": "binary"
                      },
                      "timeout": {
                        "type": "object"
                      },
                      "uuid": {
                        "type": "string"
                      }
                    }
                  },
                  "config": {
                    "type": "object",
                    "properties": {
                      "actions": {
                        "type": "object",
                        "properties": {
                          "available-actions": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "critical": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "high": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "low": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "medium": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "audit": {
                        "type": "object",
                        "properties": {
                          "audit-dirs": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "audit-policies": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "enable": {
                            "type": "boolean"
                          }
                        }
                      },
                      "canaries": {
                        "type": "object",
                        "properties": {
                          "actions": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "enable": {
                            "type": "boolean"
                          },
                          "group": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "delete": {
                                  "type": "boolean"
                                },
                                "directories": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "files": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "hide-dirs": {
                                  "type": "boolean"
                                },
                                "hide-files": {
                                  "type": "boolean"
                                },
                                "set-audit-acl": {
                                  "type": "boolean"
                                }
                              }
                            }
                          },
                          "whitelist": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "criticality-treshold": {
                        "type": "integer",
                        "format": "int64"
                      },
                      "db-path": {
                        "type": "string"
                      },
                      "dump": {
                        "type": "object",
                        "properties": {
                          "compression": {
                            "type": "boolean"
                          },
                          "dir": {
                            "type": "string"
                          },
                          "dump-untracked": {
                            "type": "boolean"
                          },
                          "max-dumps": {
                            "type": "integer",
                            "format": "int64"
                          }
                        }
                      },
                      "en-filters": {
                        "type": "boolean"
                      },
                      "en-hooks": {
                        "type": "boolean"
                      },
                      "endpoint": {
                        "type": "boolean"
                      },
                      "etw": {
                        "type": "object",
                        "properties": {
                          "providers": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "traces": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "forwarder": {
                        "type": "object",
                        "properties": {
                          "local": {
                            "type": "boolean"
                          },
                          "logging": {
                            "type": "object",
                            "properties": {
                              "dir": {
                                "type": "string"
                              },
                              "rotation-interval": {
                                "type": "object"
                              }
                            }
                          },
                          "manager": {
                            "type": "object",
                            "properties": {
                              "endpoint-key": {
                                "type": "string"
                              },
                              "endpoint-uuid": {
                                "type": "string"
                              },
                              "host": {
                                "type": "string"
                              },
                              "max-upload-size": {
                                "type": "integer",
                                "format": "int64"
                              },
                              "port": {
                                "type": "integer",
                                "format": "int64"
                              },
                              "proto": {
                                "type": "string"
                              },
                              "server-fingerprint": {
                                "type": "string"
                              },
                              "server-key": {
                                "type": "string"
                              },
                              "unsafe": {
                                "type": "boolean"
                              }
                            }
                          }
                        }
                      },
                      "log-all": {
                        "type": "boolean"
                      },
                      "logfile": {
                        "type": "string"
                      },
                      "report": {
                        "type": "object",
                        "properties": {
                          "commands": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "args": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "description": {
                                  "type": "string"
                                },
                                "error": {
                                  "type": "string"
                                },
                                "expect-json": {
                                  "type": "boolean"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "stderr": {
                                  "type": "string",
                                  "format": "binary"
                                },
                                "stdout": {
                                  "type": "object"
                                },
                                "timeout": {
                                  "type": "object"
                                },
                                "timestamp": {
                                  "type": "string",
                                  "format": "date"
                                }
                              }
                            }
                          },
                          "en-reporting": {
                            "type": "boolean"
                          },
                          "osquery": {
                            "type": "object",
                            "properties": {
                              "tables": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            }
                          },
                          "timeout": {
                            "type": "object"
                          }
                        }
                      },
                      "rules": {
                        "type": "object",
                        "properties": {
                          "containers-db": {
                            "type": "string"
                          },
                          "rules-db": {
                            "type": "string"
                          },
                          "update-interval": {
                            "type": "object"
                          }
                        }
                      },
                      "sysmon": {
                        "type": "object",
                        "properties": {
                          "archive-directory": {
                            "type": "string"
                          },
                          "bin": {
                            "type": "string"
                          },
                          "clean-archived": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  },
                  "criticality": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "group": {
                    "type": "string"
                  },
                  "hostname": {
                    "type": "string"
                  },
                  "ip": {
                    "type": "string"
                  },
                  "key": {
                    "type": "string"
                  },
                  "last-connection": {
                    "type": "string",
                    "format": "date"
                  },
                  "last-detection": {
                    "type": "string",
                    "format": "date"
                  },
                  "last-event": {
                    "type": "string",
                    "format": "date"
                  },
                  "score": {
                    "type": "number",
                    "format": "double"
                  },
                  "status": {
                    "type": "string"
                  },
                  "system-info": {
                    "type": "object",
                    "properties": {
                      "bios": {
                        "type": "object",
                        "properties": {
                          "date": {
                            "type": "string"
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "cpu": {
                        "type": "object",
                        "properties": {
                          "count": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "name": {
                            "type": "string"
                          }
                        }
                      },
                      "edr": {
                        "type": "object",
                        "properties": {
                          "commit": {
                            "type": "string"
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "error": {
                        "type": "object"
                      },
                      "os": {
                        "type": "object",
                        "properties": {
                          "build": {
                            "type": "string"
                          },
                          "edition": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "product": {
                            "type": "string"
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "sysmon": {
                        "type": "object",
                        "properties": {
                          "config": {
                            "type": "object",
                            "properties": {
                              "hash": {
                                "type": "string"
                              },
                              "version": {
                                "type": "object",
                                "properties": {
                                  "binary": {
                                    "type": "string"
                                  },
                                  "schema": {
                                    "type": "string"
                                  }
                                }
                              }
                            }
                          },
                          "driver": {
                            "type": "object",
                            "properties": {
                              "image": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "sha256": {
                                "type": "string"
                              }
                            }
                          },
                          "service": {
                            "type": "object",
                            "properties": {
                              "image": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "sha256": {
                                "type": "string"
                              }
                            }
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "system": {
                        "type": "object",
                        "properties": {
                          "manufacturer": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "virtual": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  },
                  "uuid": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "uuid": "",
                "hostname": "",
                "ip": "",
                "group": "New Group",
                "criticality": 0,
                "key": "New Key",
                "score": 0,
                "status": "New Status",
                "last-event": "0001-01-01T00:00:00Z",
                "last-detection": "0001-01-01T00:00:00Z",
                "last-connection": "0001-01-01T00:00:00Z"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "New Group",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "last-connection": "2022-08-25T15:16:32.059915491Z",
                    "last-detection": "2022-08-25T17:16:30.985842372+02:00",
                    "last-event": "2022-08-25T17:16:30.985842372+02:00",
                    "score": 0,
                    "status": "New Status",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Delete an existing endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "New Group",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "last-connection": "2022-08-25T15:16:32.059915491Z",
                    "last-detection": "2022-08-25T17:16:30.985842372+02:00",
                    "last-event": "2022-08-25T17:16:30.985842372+02:00",
                    "score": 0,
                    "status": "New Status",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/artifacts": {
      "get": {
        "tags": [
          "Artifact Search and Retrieval"
        ],
        "summary": "Artifacts for a single endpoint",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve artifacts received since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "base-url": "/endpoints/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/artifacts/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/3d8441643c204ba9b9dcb5c414b25a3129f66f6c/",
                      "creation": "2022-08-25T15:16:37.677528168Z",
                      "event-hash": "3d8441643c204ba9b9dcb5c414b25a3129f66f6c",
                      "files": [
                        {
                          "name": "bar.txt",
                          "size": 4,
                          "timestamp": "2022-08-25T15:16:37.677528168Z"
                        },
                        {
                          "name": "foo.txt",
                          "size": 4,
                          "timestamp": "2022-08-25T15:16:37.677528168Z"
                        }
                      ],
                      "modification": "2022-08-25T15:16:37.677528168Z",
                      "process-guid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/artifacts/{pguid}/{ehash}/{filename}": {
      "get": {
        "tags": [
          "Artifact Search and Retrieval"
        ],
        "summary": "Retrieve the content of an artifact",
        "parameters": [
          {
            "name": "raw",
            "in": "query",
            "description": "Retrieve raw file content",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "gunzip",
            "in": "query",
            "description": "Serve gunziped file content",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pguid",
            "in": "path",
            "description": "pguid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "ehash",
            "in": "path",
            "description": "ehash path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filename",
            "in": "path",
            "description": "filename path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": "QmxhaA==",
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/command": {
      "get": {
        "tags": [
          "Endpoint Command Execution"
        ],
        "summary": "Get the result of a command executed on endpoint",
        "parameters": [
          {
            "name": "wait",
            "in": "query",
            "description": "Wait command to end before responding, making the call blocking",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "args": [
                      "printf",
                      "Hello World"
                    ],
                    "background": false,
                    "completed": true,
                    "drop": [],
                    "error": "",
                    "expect-json": false,
                    "fetch": {},
                    "json": null,
                    "name": "/usr/bin/printf",
                    "sent": true,
                    "sent-time": "2022-08-25T17:16:35.356293573+02:00",
                    "stderr": null,
                    "stdout": "SGVsbG8gV29ybGQ=",
                    "timeout": 0,
                    "uuid": "b70a9c39-f3b8-1cde-52c4-82722cc855a6"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Endpoint Command Execution"
        ],
        "summary": "Send a command to be executed by the endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Command to be executed. One can also specify files \n\t\t\t\tto drop from the manager to the endpoint prior to command execution \n\t\t\t\tand files to fetch after execution. A timeout for the can also \n\t\t\t\tbe specified, if zero there will be no timeout. For a full list of \n\t\t\t\tavailable EDR specific commands check [documentation](https://github.com/0xrawsec/whids/blob/master/doc/edr-commands.md).",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "command-line": {
                    "type": "string"
                  },
                  "drop-files": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "fetch-files": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "timeout": {
                    "type": "object"
                  }
                }
              },
              "example": {
                "command-line": "printf \"Hello World\"",
                "fetch-files": null,
                "drop-files": null,
                "timeout": 0
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "command": {
                      "args": [
                        "Hello World"
                      ],
                      "background": false,
                      "completed": false,
                      "drop": [],
                      "error": "",
                      "expect-json": false,
                      "fetch": {},
                      "json": null,
                      "name": "printf",
                      "sent": false,
                      "sent-time": "0001-01-01T00:00:00Z",
                      "stderr": null,
                      "stdout": null,
                      "timeout": 0,
                      "uuid": "b70a9c39-f3b8-1cde-52c4-82722cc855a6"
                    },
                    "criticality": 0,
                    "group": "",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "key": "IUh6ClwELVvP0XsNPnWkN7UPOE3OlIWcpGXqoYaPWzS73INXNq3rSsyBtWeCNUnS",
                    "last-connection": "2022-08-25T15:16:34.301452975Z",
                    "last-detection": "2022-08-25T17:16:33.245051327+02:00",
                    "last-event": "2022-08-25T17:16:33.245051327+02:00",
                    "score": 0,
                    "status": "",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/command/{field}": {
      "get": {
        "tags": [
          "Endpoint Command Execution"
        ],
        "summary": "Retrieve only a field of the command structure",
        "parameters": [
          {
            "name": "wait",
            "in": "query",
            "description": "Wait command to end before responding, making the call blocking",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "field",
            "in": "path",
            "description": "Field of the Command structure to return",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": "SGVsbG8gV29ybGQ=",
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/config": {
      "get": {
        "tags": [
          "Endpoint Configuration"
        ],
        "summary": "Get endpoint configuration",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "Select input and output format (allowed toml, json)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "actions": {
                      "available-actions": null,
                      "critical": [],
                      "high": [],
                      "low": [],
                      "medium": []
                    },
                    "audit": {
                      "audit-dirs": [],
                      "audit-policies": [],
                      "enable": false
                    },
                    "canaries": {
                      "actions": [],
                      "enable": false,
                      "group": null,
                      "whitelist": []
                    },
                    "criticality-treshold": 0,
                    "db-path": "somerandompath",
                    "dump": {
                      "compression": false,
                      "dir": "",
                      "dump-untracked": false,
                      "max-dumps": 0
                    },
                    "en-filters": false,
                    "en-hooks": false,
                    "endpoint": false,
                    "etw": {
                      "providers": [],
                      "traces": []
                    },
                    "forwarder": {
                      "local": false,
                      "logging": {
                        "dir": "",
                        "rotation-interval": 0
                      },
                      "manager": {
                        "endpoint-key": "",
                        "endpoint-uuid": "",
                        "host": "",
                        "max-upload-size": 0,
                        "port": 0,
                        "proto": "",
                        "server-fingerprint": "",
                        "server-key": "",
                        "unsafe": false
                      }
                    },
                    "log-all": false,
                    "logfile": "",
                    "report": {
                      "commands": null,
                      "en-reporting": false,
                      "osquery": {
                        "tables": []
                      },
                      "timeout": 0
                    },
                    "rules": {
                      "containers-db": "",
                      "rules-db": "",
                      "update-interval": 0
                    },
                    "sysmon": {
                      "archive-directory": "",
                      "bin": "",
                      "clean-archived": false
                    }
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Endpoint Configuration"
        ],
        "summary": "Change endpoint configuration",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "Select input and output format (allowed toml, json)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Configuration content",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "actions": {
                    "type": "object",
                    "properties": {
                      "available-actions": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "critical": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "high": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "low": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "medium": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "audit": {
                    "type": "object",
                    "properties": {
                      "audit-dirs": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "audit-policies": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "enable": {
                        "type": "boolean"
                      }
                    }
                  },
                  "canaries": {
                    "type": "object",
                    "properties": {
                      "actions": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "enable": {
                        "type": "boolean"
                      },
                      "group": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "delete": {
                              "type": "boolean"
                            },
                            "directories": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "files": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "hide-dirs": {
                              "type": "boolean"
                            },
                            "hide-files": {
                              "type": "boolean"
                            },
                            "set-audit-acl": {
                              "type": "boolean"
                            }
                          }
                        }
                      },
                      "whitelist": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "criticality-treshold": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "db-path": {
                    "type": "string"
                  },
                  "dump": {
                    "type": "object",
                    "properties": {
                      "compression": {
                        "type": "boolean"
                      },
                      "dir": {
                        "type": "string"
                      },
                      "dump-untracked": {
                        "type": "boolean"
                      },
                      "max-dumps": {
                        "type": "integer",
                        "format": "int64"
                      }
                    }
                  },
                  "en-filters": {
                    "type": "boolean"
                  },
                  "en-hooks": {
                    "type": "boolean"
                  },
                  "endpoint": {
                    "type": "boolean"
                  },
                  "etw": {
                    "type": "object",
                    "properties": {
                      "providers": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "traces": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "forwarder": {
                    "type": "object",
                    "properties": {
                      "local": {
                        "type": "boolean"
                      },
                      "logging": {
                        "type": "object",
                        "properties": {
                          "dir": {
                            "type": "string"
                          },
                          "rotation-interval": {
                            "type": "object"
                          }
                        }
                      },
                      "manager": {
                        "type": "object",
                        "properties": {
                          "endpoint-key": {
                            "type": "string"
                          },
                          "endpoint-uuid": {
                            "type": "string"
                          },
                          "host": {
                            "type": "string"
                          },
                          "max-upload-size": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "port": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "proto": {
                            "type": "string"
                          },
                          "server-fingerprint": {
                            "type": "string"
                          },
                          "server-key": {
                            "type": "string"
                          },
                          "unsafe": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  },
                  "log-all": {
                    "type": "boolean"
                  },
                  "logfile": {
                    "type": "string"
                  },
                  "report": {
                    "type": "object",
                    "properties": {
                      "commands": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "args": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "description": {
                              "type": "string"
                            },
                            "error": {
                              "type": "string"
                            },
                            "expect-json": {
                              "type": "boolean"
                            },
                            "name": {
                              "type": "string"
                            },
                            "stderr": {
                              "type": "string",
                              "format": "binary"
                            },
                            "stdout": {
                              "type": "object"
                            },
                            "timeout": {
                              "type": "object"
                            },
                            "timestamp": {
                              "type": "string",
                              "format": "date"
                            }
                          }
                        }
                      },
                      "en-reporting": {
                        "type": "boolean"
                      },
                      "osquery": {
                        "type": "object",
                        "properties": {
                          "tables": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "timeout": {
                        "type": "object"
                      }
                    }
                  },
                  "rules": {
                    "type": "object",
                    "properties": {
                      "containers-db": {
                        "type": "string"
                      },
                      "rules-db": {
                        "type": "string"
                      },
                      "update-interval": {
                        "type": "object"
                      }
                    }
                  },
                  "sysmon": {
                    "type": "object",
                    "properties": {
                      "archive-directory": {
                        "type": "string"
                      },
                      "bin": {
                        "type": "string"
                      },
                      "clean-archived": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              },
              "example": {
                "db-path": "somerandompath",
                "criticality-treshold": 0,
                "en-hooks": false,
                "en-filters": false,
                "logfile": "",
                "log-all": false,
                "endpoint": false,
                "etw": {
                  "providers": null,
                  "traces": null
                },
                "forwarder": {
                  "local": false,
                  "manager": {
                    "proto": "",
                    "host": "",
                    "port": 0,
                    "endpoint-uuid": "",
                    "endpoint-key": "",
                    "server-key": "",
                    "server-fingerprint": "",
                    "unsafe": false,
                    "max-upload-size": 0
                  },
                  "logging": {
                    "dir": "",
                    "rotation-interval": 0
                  }
                },
                "sysmon": {
                  "bin": "",
                  "archive-directory": "",
                  "clean-archived": false
                },
                "actions": {
                  "available-actions": null,
                  "low": null,
                  "medium": null,
                  "high": null,
                  "critical": null
                },
                "dump": {
                  "dir": "",
                  "max-dumps": 0,
                  "compression": false,
                  "dump-untracked": false
                },
                "report": {
                  "en-reporting": false,
                  "osquery": {
                    "tables": null
                  },
                  "commands": null,
                  "timeout": 0
                },
                "rules": {
                  "rules-db": "",
                  "containers-db": "",
                  "update-interval": 0
                },
                "audit": {
                  "enable": false,
                  "audit-policies": null,
                  "audit-dirs": null
                },
                "canaries": {
                  "enable": false,
                  "actions": null,
                  "whitelist": null,
                  "group": null
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "actions": {
                      "available-actions": null,
                      "critical": null,
                      "high": null,
                      "low": null,
                      "medium": null
                    },
                    "audit": {
                      "audit-dirs": null,
                      "audit-policies": null,
                      "enable": false
                    },
                    "canaries": {
                      "actions": null,
                      "enable": false,
                      "group": null,
                      "whitelist": null
                    },
                    "criticality-treshold": 0,
                    "db-path": "somerandompath",
                    "dump": {
                      "compression": false,
                      "dir": "",
                      "dump-untracked": false,
                      "max-dumps": 0
                    },
                    "en-filters": false,
                    "en-hooks": false,
                    "endpoint": false,
                    "etw": {
                      "providers": null,
                      "traces": null
                    },
                    "forwarder": {
                      "local": false,
                      "logging": {
                        "dir": "",
                        "rotation-interval": 0
                      },
                      "manager": {
                        "endpoint-key": "",
                        "endpoint-uuid": "",
                        "host": "",
                        "max-upload-size": 0,
                        "port": 0,
                        "proto": "",
                        "server-fingerprint": "",
                        "server-key": "",
                        "unsafe": false
                      }
                    },
                    "log-all": false,
                    "logfile": "",
                    "report": {
                      "commands": null,
                      "en-reporting": false,
                      "osquery": {
                        "tables": null
                      },
                      "timeout": 0
                    },
                    "rules": {
                      "containers-db": "",
                      "rules-db": "",
                      "update-interval": 0
                    },
                    "sysmon": {
                      "archive-directory": "",
                      "bin": "",
                      "clean-archived": false
                    }
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Endpoint Configuration"
        ],
        "summary": "Delete endpoint configuration (this causes the endpoint to sync again its current configuration)",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "Select input and output format (allowed toml, json)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": null,
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/detections": {
      "get": {
        "tags": [
          "Endpoint Log Retrieval"
        ],
        "summary": "Retrieve detections logs",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve logs since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "until",
            "in": "query",
            "description": "Retrieve logs until date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "last",
            "in": "query",
            "description": "Return last logs from duration (ex: '1d' for last day)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pivot",
            "in": "query",
            "description": "Timestamp to pivot around (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "delta",
            "in": "query",
            "description": "Delta duration used to pivot (ex: '5m' to get logs 5min around pivot) ",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reports to return",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "skip",
            "in": "query",
            "description": "Skip number of events",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Event": {
                        "Detection": {
                          "Actions": [],
                          "Criticality": 4,
                          "Signature": [
                            "SuspiciousService"
                          ]
                        },
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": true,
                            "Hash": "812d7326b29a59d6a4aa84623ce052a9b17269ac",
                            "ReceiptTime": "2022-08-25T15:16:30.932036889Z"
                          }
                        },
                        "EventData": {
                          "Ancestors": "System|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\wininit.exe|C:\\Windows\\System32\\services.exe",
                          "CommandLine": "\"C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2106.6-0\\MsMpEng.exe\"",
                          "Company": "Microsoft Corporation",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Description": "Antimalware Service Executable",
                          "FileVersion": "4.18.2106.6 (WinBuild.160101.0800)",
                          "Hashes": "SHA1=FBF03B5D6DC1A7EDAB0BA8D4DD27291C739E5813,MD5=B1C15F9DB942B373B2FC468B7048E63F,SHA256=1DC05B6DD6281840CEB822604B0E403E499180D636D02EC08AD77B4EB56F1B9C,IMPHASH=8AA2B8727E6858A3557A4C09970B9A5D",
                          "Image": "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2106.6-0\\MsMpEng.exe",
                          "ImageSize": "136640",
                          "IntegrityLevel": "System",
                          "LogonGuid": "{515cd0d1-7667-6123-e703-000000000000}",
                          "LogonId": "0x3E7",
                          "OriginalFileName": "MsMpEng.exe",
                          "ParentCommandLine": "C:\\Windows\\system32\\services.exe",
                          "ParentImage": "C:\\Windows\\System32\\services.exe",
                          "ParentIntegrityLevel": "System",
                          "ParentProcessGuid": "{515cd0d1-7666-6123-0b00-000000007300}",
                          "ParentProcessId": "692",
                          "ParentServices": "N/A",
                          "ParentUser": "NT AUTHORITY\\SYSTEM",
                          "ProcessGuid": "{515cd0d1-7669-6123-4e00-000000007300}",
                          "ProcessId": "3276",
                          "Product": "Microsoft® Windows® Operating System",
                          "RuleName": "-",
                          "Services": "WinDefend",
                          "TerminalSessionId": "0",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:25.475"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 1,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-25T17:16:29.880615209+02:00"
                          }
                        }
                      }
                    },
                    {
                      "Event": {
                        "Detection": {
                          "Actions": [],
                          "Criticality": 10,
                          "Signature": [
                            "UnknownServices"
                          ]
                        },
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": true,
                            "Hash": "1373ccc3a3f3f97575af79ca8e77ad341cefc177",
                            "ReceiptTime": "2022-08-25T15:16:30.932574287Z"
                          }
                        },
                        "EventData": {
                          "Ancestors": "System|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\wininit.exe|C:\\Windows\\System32\\services.exe",
                          "CommandLine": "C:\\Windows\\System32\\VBoxService.exe",
                          "Company": "Oracle Corporation",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Description": "VirtualBox Guest Additions Service",
                          "FileVersion": "6.0.8.130520",
                          "Hashes": "SHA1=AE49D900887E95D7B3040BFD2C888D3439F94035,MD5=3001126B78719A1189A0A5270DA316A0,SHA256=9A66844E7ADA8E2D1D454136D68413CE74D90004BAD754D79DAA1A020A27E86C,IMPHASH=6A98677D1BE25D4274AAA7C9C37E832F",
                          "Image": "C:\\Windows\\System32\\VBoxService.exe",
                          "ImageSize": "2732048",
                          "IntegrityLevel": "System",
                          "LogonGuid": "{515cd0d1-7667-6123-e703-000000000000}",
                          "LogonId": "0x3E7",
                          "OriginalFileName": "VBoxService.exe",
                          "ParentCommandLine": "C:\\Windows\\system32\\services.exe",
                          "ParentImage": "C:\\Windows\\System32\\services.exe",
                          "ParentIntegrityLevel": "System",
                          "ParentProcessGuid": "{515cd0d1-7666-6123-0b00-000000007300}",
                          "ParentProcessId": "692",
                          "ParentServices": "N/A",
                          "ParentUser": "NT AUTHORITY\\SYSTEM",
                          "ProcessGuid": "{515cd0d1-7668-6123-2300-000000007300}",
                          "ProcessId": "1592",
                          "Product": "Oracle VM VirtualBox Guest Additions",
                          "RuleName": "-",
                          "Services": "VBoxService",
                          "TerminalSessionId": "0",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:24.054"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 1,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-25T17:16:29.880658585+02:00"
                          }
                        }
                      }
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/logs": {
      "get": {
        "tags": [
          "Endpoint Log Retrieval"
        ],
        "summary": "Retrieve any kind of logs (detections + filtered)",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve logs since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "until",
            "in": "query",
            "description": "Retrieve logs until date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "last",
            "in": "query",
            "description": "Return last logs from duration (ex: '1d' for last day)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pivot",
            "in": "query",
            "description": "Timestamp to pivot around (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "delta",
            "in": "query",
            "description": "Delta duration used to pivot (ex: '5m' to get logs 5min around pivot) ",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reports to return",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "skip",
            "in": "query",
            "description": "Skip number of events",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Event": {
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": false,
                            "Hash": "b719cf83208f1d828995cf029761efb55b69dff5",
                            "ReceiptTime": "2022-08-25T15:16:30.925770826Z"
                          }
                        },
                        "EventData": {
                          "CommandLine": "C:\\Windows\\system32\\svchost.exe -k appmodel -p -s StateRepository",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Details": "C:\\Windows\\SystemApps\\Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy",
                          "EventType": "SetValue",
                          "Image": "C:\\Windows\\system32\\svchost.exe",
                          "ImageHashes": "SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
                          "ImageSignature": "?",
                          "ImageSignatureStatus": "?",
                          "ImageSigned": "false",
                          "IntegrityLevel": "System",
                          "ProcessGuid": "{515cd0d1-7668-6123-3c00-000000007300}",
                          "ProcessId": "2556",
                          "ProcessThreatScore": "0",
                          "RuleName": "-",
                          "Services": "StateRepository",
                          "TargetObject": "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModel\\StateRepository\\Cache\\Package\\Data\\21\\InstalledLocation",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:29.754"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 13,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-25T17:16:29.879781042+02:00"
                          }
                        }
                      }
                    },
                    {
                      "Event": {
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": false,
                            "Hash": "a381b25f9df0bf5c895e487f61e97fbbb938322f",
                            "ReceiptTime": "2022-08-25T15:16:30.92623972Z"
                          }
                        },
                        "EventData": {
                          "CommandLine": "C:\\Windows\\System32\\svchost.exe -k LocalSystemNetworkRestricted -p -s StorSvc",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Device": "\\Device\\HarddiskVolume2",
                          "Image": "C:\\Windows\\System32\\svchost.exe",
                          "ImageHashes": "SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
                          "ImageSignature": "?",
                          "ImageSignatureStatus": "?",
                          "ImageSigned": "false",
                          "IntegrityLevel": "System",
                          "ProcessGuid": "{515cd0d1-766a-6123-5400-000000007300}",
                          "ProcessId": "3788",
                          "ProcessThreatScore": "0",
                          "RuleName": "-",
                          "Services": "StorSvc",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:31.536"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 9,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-25T17:16:29.879783302+02:00"
                          }
                        }
                      }
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/report": {
      "get": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Retrieve report for a single endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alert-count": 50,
                    "alert-criticality-metric": 0,
                    "avg-alert-criticality": 0,
                    "avg-signature-criticality": 0,
                    "bounded-score": 0,
                    "count-by-signature": {
                      "DefenderConfigChanged": 4,
                      "NewAutorun": 23,
                      "SuspiciousService": 9,
                      "UnknownServices": 9,
                      "UntrustedDriverLoaded": 5
                    },
                    "count-uniq-signatures": 5,
                    "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                    "median-time": "2022-08-25T17:16:35.472131213+02:00",
                    "score": 0,
                    "signature-count": 50,
                    "signature-criticality-metric": 0,
                    "signature-diversity": 100,
                    "signatures": [
                      "UnknownServices",
                      "DefenderConfigChanged",
                      "SuspiciousService",
                      "NewAutorun",
                      "UntrustedDriverLoaded"
                    ],
                    "start-time": "2022-08-25T17:16:35.470679762+02:00",
                    "std-dev-alert-criticality": 0,
                    "std-dev-signature-criticality": -92233720368547760,
                    "stop-time": "2022-08-25T17:16:35.473582664+02:00",
                    "sum-alert-criticality": 0,
                    "sum-rule-criticality": 0,
                    "tactics": null,
                    "techniques": null
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Delete and archive a report for a single endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alert-count": 50,
                    "alert-criticality-metric": 0,
                    "avg-alert-criticality": 0,
                    "avg-signature-criticality": 0,
                    "bounded-score": 0,
                    "count-by-signature": {
                      "DefenderConfigChanged": 4,
                      "NewAutorun": 23,
                      "SuspiciousService": 9,
                      "UnknownServices": 9,
                      "UntrustedDriverLoaded": 5
                    },
                    "count-uniq-signatures": 5,
                    "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                    "median-time": "2022-08-25T17:16:35.472131213+02:00",
                    "score": 0,
                    "signature-count": 50,
                    "signature-criticality-metric": 0,
                    "signature-diversity": 100,
                    "signatures": [
                      "UnknownServices",
                      "DefenderConfigChanged",
                      "SuspiciousService",
                      "NewAutorun",
                      "UntrustedDriverLoaded"
                    ],
                    "start-time": "2022-08-25T17:16:35.470679762+02:00",
                    "std-dev-alert-criticality": 0,
                    "std-dev-signature-criticality": -92233720368547760,
                    "stop-time": "2022-08-25T17:16:35.473582664+02:00",
                    "sum-alert-criticality": 0,
                    "sum-rule-criticality": 0,
                    "tactics": null,
                    "techniques": null
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/report/archive": {
      "get": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Get archived reports",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve report since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "until",
            "in": "query",
            "description": "Retrieve report until date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "last",
            "in": "query",
            "description": "Return last reports from duration (ex: '1d' for last day)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reports to return",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "alert-count": 50,
                      "alert-criticality-metric": 0,
                      "archived-time": "2022-08-25T17:16:36.540475659+02:00",
                      "avg-alert-criticality": 0,
                      "avg-signature-criticality": 0,
                      "bounded-score": 0,
                      "count-by-signature": {
                        "DefenderConfigChanged": 4,
                        "NewAutorun": 23,
                        "SuspiciousService": 9,
                        "UnknownServices": 9,
                        "UntrustedDriverLoaded": 5
                      },
                      "count-uniq-signatures": 5,
                      "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                      "median-time": "2022-08-25T17:16:35.472131213+02:00",
                      "score": 0,
                      "signature-count": 50,
                      "signature-criticality-metric": 0,
                      "signature-diversity": 100,
                      "signatures": [
                        "UnknownServices",
                        "DefenderConfigChanged",
                        "SuspiciousService",
                        "NewAutorun",
                        "UntrustedDriverLoaded"
                      ],
                      "start-time": "2022-08-25T17:16:35.470679762+02:00",
                      "std-dev-alert-criticality": 0,
                      "std-dev-signature-criticality": -92233720368547760,
                      "stop-time": "2022-08-25T17:16:35.473582664+02:00",
                      "sum-alert-criticality": 0,
                      "sum-rule-criticality": 0,
                      "tactics": null,
                      "techniques": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/iocs": {
      "get": {
        "tags": [
          "IoC Management (control IoCs pushed on Endpoints)"
        ],
        "summary": "Query IoCs loaded on manager and currently pushed to endpoints.\n\t\t\t\tQuery parameters can be used to restrict the search. Search criteria are\n\t\t\t\tORed together.",
        "parameters": [
          {
            "name": "uuid",
            "in": "query",
            "description": "Filter by uuid",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "guuid",
            "in": "query",
            "description": "Filter by group uuid\n\t\t\t\t\t(used to group IoCs, from the same event for example)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "source",
            "in": "query",
            "description": "Filter by source",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "value",
            "in": "query",
            "description": "Filter by value",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by type",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "guuid": "1bc4351d-8302-6e80-7648-10f8842695a8",
                      "source": "XyzTIProvider",
                      "type": "domain",
                      "uuid": "d673f6ee-4a92-a5f9-a665-c3abc4a8bf87",
                      "value": "some.random.domain"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "IoC Management (control IoCs pushed on Endpoints)"
        ],
        "summary": "Add IoCs to be pushed on endpoints for detection",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "Item": {
                      "type": "object"
                    },
                    "guuid": {
                      "type": "string"
                    },
                    "source": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "uuid": {
                      "type": "string"
                    },
                    "value": {
                      "type": "string"
                    }
                  }
                }
              },
              "example": [
                {
                  "uuid": "d673f6ee-4a92-a5f9-a665-c3abc4a8bf87",
                  "guuid": "1bc4351d-8302-6e80-7648-10f8842695a8",
                  "source": "XyzTIProvider",
                  "value": "some.random.domain",
                  "type": "domain"
                }
              ]
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "guuid": "1bc4351d-8302-6e80-7648-10f8842695a8",
                      "source": "XyzTIProvider",
                      "type": "domain",
                      "uuid": "d673f6ee-4a92-a5f9-a665-c3abc4a8bf87",
                      "value": "some.random.domain"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "IoC Management (control IoCs pushed on Endpoints)"
        ],
        "summary": "Delete IoCs from manager, modulo a synchronization delay, endpoints should \n\t\t\tstop using those for detection. Query parameters can be used to select IoCs to delete.\n\t\t\tDeletion criteria are ANDed together.",
        "parameters": [
          {
            "name": "uuid",
            "in": "query",
            "description": "Filter by uuid",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "guuid",
            "in": "query",
            "description": "Filter by group uuid\n\t\t\t\t\t(used to group IoCs, from the same event for example)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "source",
            "in": "query",
            "description": "Filter by source",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "value",
            "in": "query",
            "description": "Filter by value",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by type",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": null,
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/rules": {
      "get": {
        "tags": [
          "Rules Management"
        ],
        "summary": "Get rules loaded on endpoints",
        "parameters": [
          {
            "name": "name",
            "in": "query",
            "description": "Regex matching the names of the rules to retrieve",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filters",
            "in": "query",
            "description": "Show only filters (rules used to filter-in logs)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Actions": [
                        "memdump",
                        "kill"
                      ],
                      "Condition": "$foo or $bar",
                      "Matches": [
                        "$foo: Image ~= 'C:\\\\Malware.exe'",
                        "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                      ],
                      "Meta": {
                        "Computers": null,
                        "Criticality": 10,
                        "Disable": false,
                        "Events": {
                          "Microsoft-Windows-Sysmon/Operational": [
                            11,
                            23,
                            26
                          ]
                        },
                        "Filter": false,
                        "Schema": "2.0.0"
                      },
                      "Name": "TestRule",
                      "Tags": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Rules Management"
        ],
        "summary": "Add or modify a rule",
        "parameters": [
          {
            "name": "update",
            "in": "query",
            "description": "Update rule if already existing",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Rule to add to the manager",
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "Actions": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "Condition": {
                      "type": "string"
                    },
                    "Matches": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "Meta": {
                      "type": "object",
                      "properties": {
                        "ATTACK": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "": {
                                "type": "string"
                              },
                              "ID": {
                                "type": "string"
                              },
                              "Reference": {
                                "type": "string"
                              },
                              "Tactic": {
                                "type": "string"
                              }
                            }
                          }
                        },
                        "Computers": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "Criticality": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "Disable": {
                          "type": "boolean"
                        },
                        "Events": {
                          "type": "object",
                          "properties": {
                            "key(string)": {
                              "type": "array",
                              "items": {
                                "type": "integer",
                                "format": "int64"
                              }
                            }
                          }
                        },
                        "Filter": {
                          "type": "boolean"
                        },
                        "Schema": {
                          "type": "object",
                          "properties": {
                            "Major": {
                              "type": "integer",
                              "format": "int64"
                            },
                            "Minor": {
                              "type": "integer",
                              "format": "int64"
                            },
                            "Patch": {
                              "type": "integer",
                              "format": "int64"
                            }
                          }
                        }
                      }
                    },
                    "Name": {
                      "type": "string"
                    },
                    "Tags": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              },
              "example": [
                {
                  "Name": "TestRule",
                  "Tags": null,
                  "Meta": {
                    "Events": {
                      "Microsoft-Windows-Sysmon/Operational": [
                        11,
                        23,
                        26
                      ]
                    },
                    "Computers": null,
                    "Criticality": 10,
                    "Disable": false,
                    "Filter": false,
                    "Schema": "2.0.0"
                  },
                  "Matches": [
                    "$foo: Image ~= 'C:\\\\Malware.exe'",
                    "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                  ],
                  "Condition": "$foo or $bar",
                  "Actions": [
                    "memdump",
                    "kill"
                  ]
                }
              ]
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Actions": [
                        "memdump",
                        "kill"
                      ],
                      "Condition": "$foo or $bar",
                      "Matches": [
                        "$foo: Image ~= 'C:\\\\Malware.exe'",
                        "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                      ],
                      "Meta": {
                        "Computers": null,
                        "Criticality": 10,
                        "Disable": false,
                        "Events": {
                          "Microsoft-Windows-Sysmon/Operational": [
                            11,
                            23,
                            26
                          ]
                        },
                        "Filter": false,
                        "Schema": "2.0.0"
                      },
                      "Name": "TestRule",
                      "Tags": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Rules Management"
        ],
        "summary": "Delete rules from manager",
        "parameters": [
          {
            "name": "name",
            "in": "query",
            "description": "Name of the rule to delete. To avoid mistakes, this\n\t\t\t\tparameter cannot be a regex.",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Actions": [
                        "memdump",
                        "kill"
                      ],
                      "Condition": "$foo or $bar",
                      "Matches": [
                        "$foo: Image ~= 'C:\\\\Malware.exe'",
                        "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                      ],
                      "Meta": {
                        "Computers": null,
                        "Criticality": 10,
                        "Disable": false,
                        "Events": {
                          "Microsoft-Windows-Sysmon/Operational": [
                            11,
                            23,
                            26
                          ]
                        },
                        "Filter": false,
                        "Schema": "2.0.0"
                      },
                      "Name": "TestRule",
                      "Tags": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/stats": {
      "get": {
        "tags": [
          "Statistics about the manager"
        ],
        "summary": "Get statistics",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "endpoint-count": 1,
                    "rule-count": 0
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/users": {
      "get": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "List all users",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "description": "",
                      "group": "",
                      "identifier": "test",
                      "key": "plM6aQxHK74KL4MGlHL8OmYgRHiofhuKdid0PRYX7fTi6OrfQfmVUOOjhlnYBPCX",
                      "uuid": ""
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Create a new user with identifier",
        "parameters": [
          {
            "name": "identifier",
            "in": "query",
            "description": "identifier query parameter",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "",
                    "group": "",
                    "identifier": "TestAdminUser",
                    "key": "HxQMrEXiGTTBHxcarw4fcsEus8QRpuoE1vc3DGLjx7suOpajDnX1M2DNs7r0aGcf",
                    "uuid": "953c4e69-ba7f-e621-c8f5-db971bdcc313"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Create a new user from POST data",
        "requestBody": {
          "description": "Data to create the user with. Fields uuid and key if empty will be generated.",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "Item": {
                    "type": "object"
                  },
                  "description": {
                    "type": "string"
                  },
                  "group": {
                    "type": "string"
                  },
                  "identifier": {
                    "type": "string"
                  },
                  "key": {
                    "type": "string"
                  },
                  "uuid": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "uuid": "b88b47af-6936-49fd-e7ce-4741583ba5bd",
                "identifier": "SecondTestAdmin",
                "key": "ChangeMe",
                "group": "CSIRT",
                "description": "Second admin user"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "Second admin user",
                    "group": "CSIRT",
                    "identifier": "SecondTestAdmin",
                    "key": "ChangeMe",
                    "uuid": "b88b47af-6936-49fd-e7ce-4741583ba5bd"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/users/{uuid}": {
      "post": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Modify existing admin API user",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "newkey",
            "in": "query",
            "description": "Generate a new random key for user",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Data to update user with",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "Item": {
                    "type": "object"
                  },
                  "description": {
                    "type": "string"
                  },
                  "group": {
                    "type": "string"
                  },
                  "identifier": {
                    "type": "string"
                  },
                  "key": {
                    "type": "string"
                  },
                  "uuid": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "uuid": "",
                "identifier": "",
                "key": "NewWeakKey",
                "group": "SOC",
                "description": "Second admin user changed"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "Second admin user changed",
                    "group": "SOC",
                    "identifier": "SecondTestAdmin",
                    "key": "NewWeakKey",
                    "uuid": "b88b47af-6936-49fd-e7ce-4741583ba5bd"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Delete an existing admin API user",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "Second admin user changed",
                    "group": "SOC",
                    "identifier": "SecondTestAdmin",
                    "key": "NewWeakKey",
                    "uuid": "b88b47af-6936-49fd-e7ce-4741583ba5bd"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "name": "X-Api-Key",
        "in": "header"
      }
    }
  },
  "security": [
    {
      "ApiKeyAuth": []
    }
  ]
}
`

```

`api/server/openapi_test.go`:

```go
package server

import (
	"context"
	"encoding/json"
	"encoding/xml"
	"fmt"
	"net/http"
	"os"
	"reflect"
	"testing"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/code/builder"
	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/agent/sysinfo"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/client"
	"github.com/0xrawsec/whids/api/openapi"
	"github.com/0xrawsec/whids/ioc"
	"github.com/0xrawsec/whids/sysmon"
	"github.com/0xrawsec/whids/utils"
)

const (
	guid      = "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
	eventHash = "3d8441643c204ba9b9dcb5c414b25a3129f66f6c"

	fakeSystemInfo = `
		{
		"edr": {
			"commit": "deadbeeeeeeeeeeeeeeeeef",
			"version": "major.minor.patch"
		},
		"system": {
			"manufacturer": "innotek GmbH",
			"name": "VirtualBox",
			"virtual": true
		},
		"bios": {
			"version": "VirtualBox",
			"date": "12/01/2006"
		},
		"os": {
			"name": "windows",
			"build": "18362",
			"version": "10.0.18362",
			"product": "Windows 10 Pro",
			"edition": "Enterprise"
		},
		"cpu": {
			"name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz",
			"count": 4
		},
		"sysmon": {
			"version": "v13.23",
			"service": {
			"name": "Sysmon64",
			"image": "C:\\Program Files\\Whids\\Sysmon64.exe",
			"sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
			},
			"driver": {
			"name": "SysmonDrv",
			"image": "C:\\Windows\\SysmonDrv.sys",
			"sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
			},
			"config": {
			"version": {
				"schema": "4.70",
				"binary": "15.0"
			},
			"hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837"
			}
		}
	}
	`

	sysmonXMLConfig = `<Sysmon schemaversion="4.70">
  <CheckRevocation>false</CheckRevocation>
  <CopyOnDeletePE>false</CopyOnDeletePE>
  <DnsLookup>false</DnsLookup>
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>
    <ProcessCreate onmatch="exclude"></ProcessCreate>
    <FileCreateTime onmatch="exclude"></FileCreateTime>
    <NetworkConnect onmatch="exclude"></NetworkConnect>
    <ProcessTerminate onmatch="exclude"></ProcessTerminate>
    <DriverLoad onmatch="exclude"></DriverLoad>
    <CreateRemoteThread onmatch="exclude"></CreateRemoteThread>
    <RawAccessRead onmatch="exclude"></RawAccessRead>
    <FileCreate onmatch="exclude"></FileCreate>
    <FileCreateStreamHash onmatch="exclude"></FileCreateStreamHash>
    <PipeEvent onmatch="exclude"></PipeEvent>
    <WmiEvent onmatch="exclude"></WmiEvent>
    <FileDelete onmatch="exclude"></FileDelete>
    <ClipboardChange onmatch="exclude"></ClipboardChange>
    <ProcessTampering onmatch="exclude"></ProcessTampering>
    <FileDeleteDetected onmatch="exclude"></FileDeleteDetected>
    <RuleGroup groupRelation="or">
      <ImageLoad onmatch="exclude">
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        <Signature condition="is">Microsoft Windows Publisher</Signature>
        <Signature condition="is">Microsoft Corporation</Signature>
        <Signature condition="is">Microsoft Windows</Signature>
      </ImageLoad>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <ProcessAccess onmatch="exclude">
        <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        <GrantedAccess condition="is">0x1000</GrantedAccess>
        <GrantedAccess condition="is">0x2000</GrantedAccess>
        <GrantedAccess condition="is">0x3000</GrantedAccess>
        <GrantedAccess condition="is">0x100000</GrantedAccess>
        <GrantedAccess condition="is">0x101000</GrantedAccess>
      </ProcessAccess>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <RegistryEvent onmatch="exclude">
        <EventType condition="is not">SetValue</EventType>
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
      </RegistryEvent>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <DnsQuery onmatch="exclude">
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
      </DnsQuery>
    </RuleGroup>
  </EventFiltering>
</Sysmon>`
)

var (
	defaultServerConfig = ManagerConfig{
		AdminAPI: AdminAPIConfig{
			Host: "localhost",
			Port: api.AdmAPIDefaultPort,
		},
		TLS: mconf.TLS,
	}

	openAPI = openapi.New(
		"3.0.2",
		&openapi.Info{
			Title:   "WHIDS API documentation",
			Version: "1.0",
		},

		&openapi.Server{
			URL: defaultServerConfig.AdminAPIUrl(),
		})

	systemInfo  = &sysinfo.SystemInfo{}
	agentConfig = config.Agent{
		DatabasePath: "somerandompath",
	}
)

func init() {
	openAPI.AuthApiKey(api.AuthKeyHeader, testAdminUser.Key)
	openAPI.Client = &http.Client{Transport: cconf.Transport()}
	openAPI.ValidateOperation = validateOperation
	openAPI.TestingServer = &openapi.Server{URL: mconf.AdminAPIUrl()}
	client.Hostname = "OpenHappy"

	if err := json.Unmarshal([]byte(fakeSystemInfo), systemInfo); err != nil {
		panic(err)
	}
}

func validateOperation(output interface{}) (err error) {
	var data []byte
	var resp AdminAPIResponse

	if data, err = json.Marshal(output); err != nil {
		return err
	}

	if err := json.Unmarshal(data, &resp); err != nil {
		return err
	}

	if err := resp.Err(); err != nil {
		return err
	}
	return nil
}

func prep() (m *Manager, c *client.ManagerClient) {
	var err error

	mconf := mconf
	cconf := makeClientConfig(&mconf)

	key := utils.NewKeyOrPanic(api.DefaultKeySize)

	if m, err = NewManager(&mconf); err != nil {
		panic(err)
	}

	// we don't handle error as we don't care if user
	// already exists
	m.CreateNewAdminAPIUser(testAdminUser)

	m.AddEndpoint(cconf.UUID, key)
	m.Run()

	cconf.Key = key
	if c, err = client.NewManagerClient(&cconf); err != nil {
		panic(err)
	}
	// wait that server is up
	// might generate error message in log
	for !c.IsServerUp() {
		time.Sleep(time.Nanosecond * 500)
	}
	fconf.Client.Key = key

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	// sending logs to manager
	f, err := client.NewForwarder(ctx, &fconf, golog.FromStdout())
	if err != nil {
		panic(err)
	}
	f.Run()
	defer f.Close()

	// Create fake events on client
	for e := range emitMixedEvents(50, 50) {
		if err := f.PipeEvent(e); err != nil {
			panic(fmt.Errorf("failed to pipe event: %s", err))
		}
	}

	// Create fake dumps
	for _, name := range []string{"foo.txt", "bar.txt"} {
		c.PostDump(&client.FileUpload{
			Name:      name,
			GUID:      fmt.Sprintf("{%s}", guid),
			EventHash: eventHash,
			Content:   []byte("Blah"),
			Chunk:     1,
			Total:     1,
		})
	}

	// post fake system information
	if err := c.PostSystemInfo(systemInfo); err != nil {
		panic(err)
	}

	return
}

func cleanup(m *Manager) {
	m.Shutdown()
	m.Wait()
	os.RemoveAll(m.Config.Database)
	os.RemoveAll(m.Config.DumpDir)
}

func runAdminApiTest(t *testing.T, f func(*testing.T)) {
	m, c := prep()

	ctx, cancel := context.WithCancel(context.Background())
	go func() {
		for ctx.Err() == nil {
			if c.IsServerUp() {
				if cmd, err := c.FetchCommand(); err != nil && err != client.ErrNothingToDo {
					t.Logf("Client failed to fetch command: %s", err)
					break
				} else if err != client.ErrNothingToDo {
					t.Log(cmd)
					if err := cmd.Run(); err != nil {
						t.Logf("Failed to run command: %s", err)
						break
					}
					if err := c.PostCommand(cmd); err != nil {
						t.Logf("Failed to post command: %s", err)
						break
					}
				}
			}
			time.Sleep(time.Second)
		}
	}()

	defer func() {
		cancel()
		cleanup(m)
	}()

	f(t)
}

func writeConfig(filename string, data []byte) {
	f, err := os.Create(filename)
	if err != nil {
		panic(err)
	}
	defer f.Close()
	f.Write(data)
}

func TestOpenApiUserManagement(t *testing.T) {
	f := func(t *testing.T) {
		// User Management
		usersPath := openapi.PathItem{
			Summary: "Admin API User's Management",
			Value:   api.AdmAPIUsers,
		}

		openAPI.Do(usersPath,
			openapi.Operation{
				Method:  "GET",
				Summary: "List all users",
				Output:  AdminAPIResponse{},
			},
		)

		openAPI.Do(usersPath,
			openapi.Operation{
				Method:  "PUT",
				Summary: "Create a new user with identifier",
				Parameters: []*openapi.Parameter{
					openapi.QueryParameter(api.QpIdentifier, "TestAdminUser").Require(),
				},
				Output: AdminAPIResponse{},
			},
		)

		guid := utils.UUIDOrPanic().String()
		openAPI.Do(usersPath,
			openapi.Operation{
				Method:  "POST",
				Summary: "Create a new user from POST data",
				RequestBody: openapi.JsonRequestBody(
					"Data to create the user with. Fields uuid and key if empty will be generated.",
					AdminAPIUser{
						Identifier:  "SecondTestAdmin",
						Uuid:        guid,
						Key:         "ChangeMe",
						Description: "Second admin user",
						Group:       "CSIRT",
					}, true),
				Output: AdminAPIResponse{},
			},
		)

		openAPI.Do(usersPath,
			openapi.Operation{
				Method:  "POST",
				Summary: "Modify existing admin API user",
				Parameters: []*openapi.Parameter{
					openapi.PathParameter("uuid", guid),
					openapi.QueryParameter(api.QpNewKey, true, "Generate a new random key for user").Skip(),
				},
				RequestBody: openapi.JsonRequestBody(
					"Data to update user with",
					AdminAPIUser{
						Key:         "NewWeakKey",
						Description: "Second admin user changed",
						Group:       "SOC",
					}, true),
			})

		openAPI.Do(usersPath,
			openapi.Operation{
				Method:  "DELETE",
				Summary: "Delete an existing admin API user",
				Parameters: []*openapi.Parameter{
					openapi.PathParameter("uuid", guid),
				},
			})
	}

	runAdminApiTest(t, f)
}

func TestOpenApiEndpointManagement(t *testing.T) {
	f := func(t *testing.T) {

		// Endpoint Management
		endpointPath := openapi.PathItem{
			Summary: "Endpoint Management",
			Value:   api.AdmAPIEndpointsPath,
		}

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get endpoints",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpShowKey, true, "Show or not key"),
				openapi.QueryParameter(api.QpGroup, "", "Filter by group"),
				openapi.QueryParameter(api.QpStatus, "", "Filter by status"),
				openapi.QueryParameter(api.QpCriticality, 0, "Filter by criticality"),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "PUT",
			Summary: "Create a new endpoint",
			Output:  AdminAPIResponse{},
		})

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get information about a single endpoint",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "POST",
			Summary: "Modify an existing endpoint",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID),
				openapi.QueryParameter(api.QpShowKey, true, "Show endpoint key in response").Skip(),
				openapi.QueryParameter(api.QpNewKey, true, "Generate a new key for endpoint").Skip(),
			},
			RequestBody: openapi.JsonRequestBody(
				"Fields to modify. NB: Not all the fields can be modified",
				api.Endpoint{
					Key:    "New Key",
					Group:  "New Group",
					Status: "New Status",
				}, true),
			Output: AdminAPIResponse{},
		})

		// Delete endpoint after everything
		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete an existing endpoint",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID),
			},
			Output: AdminAPIResponse{},
		})
	}

	runAdminApiTest(t, f)
}

func TestOpenApiEndpointConfiguration(t *testing.T) {
	f := func(t *testing.T) {
		tt := toast.FromT(t)

		c := &config.Agent{}
		out := &AdminAPIResponse{Data: c}
		qptoml := openapi.QueryParameter(api.QpFormat, "toml", "Select input and output format (allowed toml, json)")
		qpjson := openapi.QueryParameter(api.QpFormat, "json", "Select input and output format (allowed toml, json)")
		agentConfigStr, err := utils.TomlString(agentConfig)
		tt.CheckErr(err)
		tomlBody := openapi.BinaryRequestBody("Configuration content", []byte(agentConfigStr), true)
		configAPI := openapi.Operation{
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPIConfigSuffix),
			},
			Output: out,
		}

		// Endpoint Management
		endpointPath := openapi.PathItem{
			Summary: "Endpoint Configuration",
			Value:   api.AdmAPIEndpointsPath,
		}

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "POST",
			Summary: "Change endpoint configuration",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPIConfigSuffix),
				qpjson,
			},
			//RequestBody: openapi.BinaryRequestBody("Configuration content", []byte(agentConfigStr), true),
			RequestBody: openapi.JsonRequestBody("Configuration content", agentConfig, true),
			Output:      AdminAPIResponse{Data: config.Agent{}},
		})

		// cannot parse toml string into config.Agent
		tt.Assert(openAPI.Test(endpointPath, configAPI.GET(qptoml)) != nil)
		tt.CheckErr(openAPI.Test(endpointPath, configAPI.GET()))
		tt.CheckErr(openAPI.Test(endpointPath, configAPI.GET(qpjson)))
		// checking that POST method worked as intented
		tt.Assert(reflect.DeepEqual(*c, agentConfig))

		tt.CheckErr(openAPI.Test(endpointPath, configAPI.DELETE()))
		tt.CheckErr(openAPI.Test(endpointPath, configAPI.POST(tomlBody, qptoml)))
		c = &config.Agent{}
		out.Data = c
		tt.CheckErr(openAPI.Test(endpointPath, configAPI.GET()))
		tt.Assert(c.DatabasePath == agentConfig.DatabasePath)

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get endpoint configuration",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPIConfigSuffix),
				qpjson,
			},
			Output: AdminAPIResponse{Data: config.Agent{}},
		})

		// deleting configuration

		tt.CheckErr(openAPI.Test(endpointPath, configAPI.DELETE()))
		tt.CheckErr(openAPI.Test(endpointPath, configAPI.GET(qpjson)))
		tt.Assert(out.Data == nil)

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete endpoint configuration (this causes the endpoint to sync again its current configuration)",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPIConfigSuffix),
				qpjson,
			},
			Output: AdminAPIResponse{Data: config.Agent{}},
		})

	}

	runAdminApiTest(t, f)
}

func TestOpenApiEndpointCommands(t *testing.T) {
	f := func(t *testing.T) {

		endpointPath := openapi.PathItem{
			Summary: "Endpoint Command Execution",
			Value:   api.AdmAPIEndpointsPath,
		}

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "POST",
			Summary: "Send a command to be executed by the endpoint",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid", cconf.UUID).Suffix("/command"),
			},
			RequestBody: openapi.JsonRequestBody(
				`Command to be executed. One can also specify files 
				to drop from the manager to the endpoint prior to command execution 
				and files to fetch after execution. A timeout for the can also 
				be specified, if zero there will be no timeout. For a full list of 
				available EDR specific commands check [documentation](https://github.com/0xrawsec/whids/blob/master/doc/edr-commands.md).`,
				CommandAPI{CommandLine: `printf "Hello World"`},
				true),
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get the result of a command executed on endpoint",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(
					api.QpWait,
					true,
					"Wait command to end before responding, making the call blocking"),
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPICommandSuffix),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointPath, openapi.Operation{
			Method:  "GET",
			Summary: "Retrieve only a field of the command structure",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(
					api.QpWait,
					true,
					"Wait command to end before responding, making the call blocking").Skip(),
				openapi.PathParameter("uuid",
					cconf.UUID).Suffix(api.AdmAPICommandSuffix),
				openapi.PathParameter("field",
					"stdout",
					"Field of the Command structure to return"),
			},
			Output: AdminAPIResponse{},
		})
	}

	runAdminApiTest(t, f)
}

func TestOpenApiReports(t *testing.T) {
	f := func(t *testing.T) {

		sum := "Detection Reports"
		endpointsPath := openapi.PathItem{
			Summary: sum,
			Value:   api.AdmAPIEndpointsPath,
		}

		reportsPath := openapi.PathItem{
			Summary: sum,
			Value:   api.AdmAPIEndpointsReportsPath,
		}

		openAPI.Do(reportsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get all detection reports",
			Output:  AdminAPIResponse{},
		})

		openAPI.Do(endpointsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Retrieve report for a single endpoint",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid",
					cconf.UUID).Suffix(api.AdmAPIReportSuffix)},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointsPath, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete and archive a report for a single endpoint",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("uuid",
					cconf.UUID).Suffix(api.AdmAPIReportSuffix)},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get archived reports",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpSince, time.Now().Format(time.RFC3339), "Retrieve report since date (RFC3339)"),
				openapi.QueryParameter(api.QpUntil, time.Now().Format(time.RFC3339), "Retrieve report until date (RFC3339)"),
				openapi.QueryParameter(api.QpLast, "1d", "Return last reports from duration (ex: `1d` for last day)"),
				openapi.QueryParameter(api.QpLimit, 42, "Maximum number of reports to return"),
				openapi.PathParameter("uuid",
					cconf.UUID).Suffix(api.AdmAPIReportSuffix).Suffix(api.AdmAPIArchiveSuffix)},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}

func TestOpenApiLogs(t *testing.T) {
	f := func(t *testing.T) {

		logsPath := openapi.PathItem{
			Summary: "Endpoint Log Retrieval",
			Value:   api.AdmAPIEndpointsPath,
		}

		nowStr := time.Now().Format(time.RFC3339)

		openAPI.Do(logsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Retrieve any kind of logs (detections + filtered)",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpSince, nowStr, "Retrieve logs since date (RFC3339)").Skip(),
				openapi.QueryParameter(api.QpUntil, nowStr, "Retrieve logs until date (RFC3339)").Skip(),
				openapi.QueryParameter(api.QpLast, "1d", "Return last logs from duration (ex: `1d` for last day)"),
				openapi.QueryParameter(api.QpPivot, nowStr, "Timestamp to pivot around (RFC3339)"),
				openapi.QueryParameter(api.QpDelta, "5m", "Delta duration used to pivot (ex: `5m` to get logs 5min around pivot) "),
				openapi.QueryParameter(api.QpLimit, 2, "Maximum number of reports to return"),
				openapi.QueryParameter(api.QpSkip, 0, "Skip number of events").Skip(),
				openapi.PathParameter("uuid",
					cconf.UUID).Suffix(api.AdmAPILogsSuffix)},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(logsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Retrieve detections logs",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpSince, nowStr, "Retrieve logs since date (RFC3339)").Skip(),
				openapi.QueryParameter(api.QpUntil, nowStr, "Retrieve logs until date (RFC3339)").Skip(),
				openapi.QueryParameter(api.QpLast, "1d", "Return last logs from duration (ex: `1d` for last day)"),
				openapi.QueryParameter(api.QpPivot, nowStr, "Timestamp to pivot around (RFC3339)"),
				openapi.QueryParameter(api.QpDelta, "5m", "Delta duration used to pivot (ex: `5m` to get logs 5min around pivot) "),
				openapi.QueryParameter(api.QpLimit, 2, "Maximum number of reports to return"),
				openapi.QueryParameter(api.QpSkip, 0, "Skip number of events").Skip(),
				openapi.PathParameter("uuid",
					cconf.UUID).Suffix(api.AdmAPIDetectionSuffix),
			},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}

func TestOpenApiArtifacts(t *testing.T) {
	f := func(t *testing.T) {

		sum := "Artifact Search and Retrieval"

		artifactsPath := openapi.PathItem{
			Summary: sum,
			Value:   api.AdmAPIEndpointsArtifactsPath,
		}

		endpointsPath := openapi.PathItem{
			Summary: sum,
			Value:   api.AdmAPIEndpointsPath,
		}

		nowStr := time.Now().Format(time.RFC3339)

		openAPI.Do(artifactsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Artifacts on all endpoints",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpSince, nowStr, "Retrieve artifacts received since date (RFC3339)").Skip(),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Artifacts for a single endpoint",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpSince, nowStr, "Retrieve artifacts received since date (RFC3339)").Skip(),
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPIArticfactsSuffix),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(endpointsPath, openapi.Operation{
			Method:  "GET",
			Summary: "Retrieve the content of an artifact",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpRaw, false, "Retrieve raw file content").Skip(),
				openapi.QueryParameter(api.QpGunzip, false, "Serve gunziped file content").Skip(),
				openapi.PathParameter("uuid", cconf.UUID).Suffix(api.AdmAPIArticfactsSuffix),
				openapi.PathParameter("pguid", guid),
				openapi.PathParameter("ehash", eventHash),
				openapi.PathParameter("filename", "foo.txt"),
			},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}

func TestOpenApiIoCs(t *testing.T) {
	f := func(t *testing.T) {

		iocsPath := openapi.PathItem{
			Summary: "IoC Management (control IoCs pushed on Endpoints)",
			Value:   api.AdmAPIIocsPath,
		}
		provider := "XyzTIProvider"

		openAPI.Do(iocsPath, openapi.Operation{
			Method:  "POST",
			Summary: "Add IoCs to be pushed on endpoints for detection",
			RequestBody: openapi.JsonRequestBody("",
				[]ioc.IOC{
					{
						Uuid:      utils.UUIDOrPanic().String(),
						GroupUuid: utils.UUIDOrPanic().String(),
						Source:    provider,
						Value:     "some.random.domain",
						Type:      "domain",
					},
				},
				true),
			Output: AdminAPIResponse{},
		})

		openAPI.Do(iocsPath, openapi.Operation{
			Method: "GET",
			Summary: `Query IoCs loaded on manager and currently pushed to endpoints.
				Query parameters can be used to restrict the search. Search criteria are
				ORed together.`,
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpUuid, "Test", "Filter by uuid").Skip(),
				openapi.QueryParameter(api.QpGroupUuid, "Test", `Filter by group uuid
					(used to group IoCs, from the same event for example)`).Skip(),
				openapi.QueryParameter(api.QpSource, "Test", "Filter by source").Skip(),
				openapi.QueryParameter(api.QpValue, "Test", "Filter by value").Skip(),
				openapi.QueryParameter(api.QpType, "Test", "Filter by type").Skip(),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(iocsPath, openapi.Operation{
			Method: "DELETE",
			Summary: `Delete IoCs from manager, modulo a synchronization delay, endpoints should 
			stop using those for detection. Query parameters can be used to select IoCs to delete.
			Deletion criteria are ANDed together.`,
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpUuid, "Test", "Filter by uuid").Skip(),
				openapi.QueryParameter(api.QpGroupUuid, "Test", `Filter by group uuid
					(used to group IoCs, from the same event for example)`).Skip(),
				openapi.QueryParameter(api.QpSource, "Test", "Filter by source").Skip(),
				openapi.QueryParameter(api.QpValue, "Test", "Filter by value").Skip(),
				openapi.QueryParameter(api.QpType, "Test", "Filter by type").Skip(),
			},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}

func TestOpenApiRules(t *testing.T) {
	f := func(t *testing.T) {

		sum := "Rules Management"
		rulesPath := openapi.PathItem{
			Summary: sum,
			Value:   api.AdmAPIRulesPath,
		}

		name := "TestRule"
		openAPI.Do(rulesPath, openapi.Operation{
			Method:  "POST",
			Summary: "Add or modify a rule",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpUpdate, true, "Update rule if already existing"),
			},
			RequestBody: openapi.JsonRequestBody(
				"Rule to add to the manager",
				[]engine.Rule{
					{
						Name: name,
						Meta: engine.MetaSection{
							Events:      map[string][]int64{"Microsoft-Windows-Sysmon/Operational": {11, 23, 26}},
							Criticality: 10,
							Schema:      engine.ParseVersion("2.0.0"),
						},
						Matches: []string{
							fmt.Sprintf("$foo: Image ~= '%s'", `C:\\Malware.exe`),
							fmt.Sprintf("$bar: TargetFilename ~= '%s'", `C:\\config.txt`),
						},
						Condition: "$foo or $bar",
						Actions:   []string{"memdump", "kill"},
					},
				},
				true),
			Output: AdminAPIResponse{},
		})

		// ToDo find a way to get a single rule name
		openAPI.Do(rulesPath, openapi.Operation{
			Method:  "GET",
			Summary: "Get rules loaded on endpoints",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpName, name, "Regex matching the names of the rules to retrieve"),
				openapi.QueryParameter(api.QpFilters, false, "Show only filters (rules used to filter-in logs)"),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(rulesPath, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete rules from manager",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter(api.QpName, name, `Name of the rule to delete. To avoid mistakes, this
				parameter cannot be a regex.`),
			},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
	t.Log(prettyJSON(openAPI))
}

func TestOpenApiSysmon(t *testing.T) {

	f := func(t *testing.T) {

		tt := toast.FromT(t)

		path := openapi.PathItem{
			Summary: "Manage Sysmon",
			Value:   api.AdmAPIEndpointsPath,
		}

		config := &sysmon.Config{}
		tt.CheckErr(xml.Unmarshal([]byte(sysmonXMLConfig), &config))
		config.OS = "windows"

		openAPI.Do(path, openapi.Operation{
			Method:  "POST",
			Summary: "Add or update a Sysmon configuration",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/sysmon").Suffix("/config"),
				openapi.QueryParameter("format", "xml"),
			},
			RequestBody: openapi.XMLRequestBody(
				"Sysmon configuration file. Raw XML file that you would use to configure Sysmon can be posted here.",
				config,
				true,
			),
			Output: AdminAPIResponse{},
		})

		openAPI.Do(path, openapi.Operation{
			Method:  "GET",
			Summary: "Get a Sysmon configuration",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/sysmon").Suffix("/config"),
				openapi.QueryParameter("version", "4.70").Require(),
				openapi.QueryParameter("format", "json"),
				openapi.QueryParameter("raw", true).Skip(),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(path, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete a Sysmon configuration",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/sysmon").Suffix("/config"),
				openapi.QueryParameter("version", "4.70").Require(),
			},
			Output: AdminAPIResponse{},
		})

		// Manage Sysmon installer

		openAPI.Do(path, openapi.Operation{
			Method:  "POST",
			Summary: "Add or update Sysmon binary to deploy on connected endpoints",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/sysmon").Suffix("/binary"),
				openapi.QueryParameter(api.QpBinary, true, "Show binary in response"),
			},
			RequestBody: openapi.BinaryRequestBody(
				"Sysmon binary to deploy",
				[]byte("MZfoobar"),
				true,
			),
			Output: AdminAPIResponse{},
		})

		openAPI.Do(path, openapi.Operation{
			Method:  "GET",
			Summary: "Get information about Sysmon binary",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/sysmon").Suffix("/binary"),
				openapi.QueryParameter(api.QpBinary, true, "Show binary in response"),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(path, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete Sysmon binary from manager and connected endpoints",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/sysmon").Suffix("/binary"),
				openapi.QueryParameter(api.QpBinary, true, "Show binary in response"),
			},
			Output: AdminAPIResponse{},
		})
	}

	runAdminApiTest(t, f)
}

func TestOpenApiOSQueryi(t *testing.T) {
	f := func(t *testing.T) {

		path := openapi.PathItem{
			Summary: "Manage OSQueryi installation",
			Value:   api.AdmAPIEndpointsPath,
		}

		openAPI.Do(path, openapi.Operation{
			Method:  "POST",
			Summary: "Add or update OSQueryi binary to deploy on endpoints",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/osqueryi/binary"),
				openapi.QueryParameter(api.QpBinary, true, "Show binary in response"),
			},
			RequestBody: openapi.BinaryRequestBody(
				"OSQueryi binary to deploy",
				[]byte("MZfoobar"),
				true,
			),
			Output: AdminAPIResponse{},
		})

		openAPI.Do(path, openapi.Operation{
			Method:  "GET",
			Summary: "Get information about OSQueryi binary",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/osqueryi/binary"),
				openapi.QueryParameter(api.QpBinary, true, "Show binary in response"),
			},
			Output: AdminAPIResponse{},
		})

		openAPI.Do(path, openapi.Operation{
			Method:  "DELETE",
			Summary: "Delete OSQueryi binary from manager and connected endpoints",
			Parameters: []*openapi.Parameter{
				openapi.PathParameter("os", "windows").Suffix("/osqueryi/binary"),
				openapi.QueryParameter(api.QpBinary, true, "Show binary in response"),
			},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}

func TestOpenApiStatistics(t *testing.T) {
	f := func(t *testing.T) {

		path := openapi.PathItem{
			Summary: "Statistics about the manager",
			Value:   api.AdmAPIStatsPath,
		}

		openAPI.Do(path, openapi.Operation{
			Method:  "GET",
			Summary: "Get statistics",
			Output:  AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}

/*
func TestOpenApiTemplate(t *testing.T) {
	f := func(t *testing.T) {

		path := openapi.PathItem{
			Summary: "Summary",
			Value:   api.AdmAPIEndpointsArtifactsPath,
		}

		openAPI.Do(path, openapi.Operation{
			Method:  "GET",
			Summary: "Artifacts on all endpoints",
			Parameters: []*openapi.Parameter{
				openapi.QueryParameter("", "", ""),
			},
			Output: AdminAPIResponse{},
		})

	}

	runAdminApiTest(t, f)
}
*/

func TestOpenApiFinisher(t *testing.T) {
	b := builder.CodeBuilder{}
	//pkg := reflect.TypeOf(OpenAPIDefinition).PkgPath()
	b.Package("server")
	b.WriteString("\n")
	b.DefVariable("OpenAPIDefinition", "\n"+prettyJSON(openAPI)+"\n")
	writeConfig("openapi_def.go", b.Bytes())
}

```

`api/server/users.go`:

```go
package server

import (
	"github.com/0xrawsec/sod"
)

// AdminAPIUser structure definition
type AdminAPIUser struct {
	sod.Item
	Uuid        string `json:"uuid" sod:"unique"`
	Identifier  string `json:"identifier" sod:"unique"`
	Key         string `json:"key,omitempty" sod:"unique"`
	Group       string `json:"group" sod:"index"`
	Description string `json:"description"`
}

```

`api/server/utils.go`:

```go
package server

import (
	"encoding/json"
	"encoding/xml"
	"fmt"
	"io/ioutil"
	"net/http"

	"github.com/gorilla/mux"
	"github.com/pelletier/go-toml/v2"
)

func muxGetVar(rq *http.Request, name string) (string, error) {
	vars := mux.Vars(rq)
	if value, ok := vars[name]; ok {
		return value, nil
	}
	return "", fmt.Errorf("unknown mux variable")
}

func format(format string, a ...interface{}) string {
	return fmt.Sprintf(format, a...)
}

// read posted data and unseriablize it from JSON
func readPostAsJSON(rq *http.Request, i interface{}) error {
	defer rq.Body.Close()
	b, err := ioutil.ReadAll(rq.Body)
	if err != nil {
		return fmt.Errorf("failed to read POST body: %w", err)
	}
	return json.Unmarshal(b, i)
}

func readPostAsTOML(rq *http.Request, i interface{}) error {
	defer rq.Body.Close()
	b, err := ioutil.ReadAll(rq.Body)
	if err != nil {
		return fmt.Errorf("failed to read POST body: %w", err)
	}
	return toml.Unmarshal(b, i)
}

func readPostAsXML(rq *http.Request, i interface{}) error {
	defer rq.Body.Close()
	b, err := ioutil.ReadAll(rq.Body)
	if err != nil {
		return fmt.Errorf("failed to read POST body: %w", err)
	}
	return xml.Unmarshal(b, i)
}

```

`doc/admin.openapi.json`:

```json

{
  "openapi": "3.0.2",
  "info": {
    "title": "WHIDS API documentation",
    "version": "1.0"
  },
  "servers": [
    {
      "url": "https://localhost:1520"
    }
  ],
  "paths": {
    "/endpoints": {
      "get": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Get endpoints",
        "parameters": [
          {
            "name": "showkey",
            "in": "query",
            "description": "Show or not key",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "group",
            "in": "query",
            "description": "Filter by group",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by status",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "criticality",
            "in": "query",
            "description": "Filter by criticality",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "criticality": 0,
                      "group": "",
                      "hostname": "OpenHappy",
                      "ip": "127.0.0.1",
                      "key": "gCx59uTlWsW9a4MX2yJOEN4NSCln3TOu58aTXJcbii5fSRvR34kmyBhN6JfbiJyw",
                      "last-connection": "2022-08-24T10:48:29.474420629Z",
                      "last-detection": "2022-08-24T12:48:28.433692184+02:00",
                      "last-event": "2022-08-24T12:48:28.433692184+02:00",
                      "score": 0,
                      "status": "",
                      "system-info": {
                        "bios": {
                          "date": "12/01/2006",
                          "version": "VirtualBox"
                        },
                        "cpu": {
                          "count": 4,
                          "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                        },
                        "edr": {
                          "commit": "deadbeeeeeeeeeeeeeeeeef",
                          "version": "major.minor.patch"
                        },
                        "error": null,
                        "os": {
                          "build": "18362",
                          "edition": "Enterprise",
                          "name": "windows",
                          "product": "Windows 10 Pro",
                          "version": "10.0.18362"
                        },
                        "sysmon": {
                          "config": {
                            "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                            "version": {
                              "binary": "15.0",
                              "schema": "4.70"
                            }
                          },
                          "driver": {
                            "image": "C:\\Windows\\SysmonDrv.sys",
                            "name": "SysmonDrv",
                            "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                          },
                          "service": {
                            "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                            "name": "Sysmon64",
                            "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                          },
                          "version": "v13.23"
                        },
                        "system": {
                          "manufacturer": "innotek GmbH",
                          "name": "VirtualBox",
                          "virtual": true
                        }
                      },
                      "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Create a new endpoint",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "",
                    "hostname": "",
                    "ip": "",
                    "key": "8vDtCLSXvKqycbzcNj5j1lYvn0l2FmBz2YIg1WpYB6FwUSR50KDsgJxfQK6KQth3",
                    "last-connection": "0001-01-01T00:00:00Z",
                    "last-detection": "0001-01-01T00:00:00Z",
                    "last-event": "0001-01-01T00:00:00Z",
                    "score": 0,
                    "status": "",
                    "uuid": "1b98404b-b614-c91a-f351-4f8b4216838d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/artifacts": {
      "get": {
        "tags": [
          "Artifact Search and Retrieval"
        ],
        "summary": "Artifacts on all endpoints",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve artifacts received since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d": [
                      {
                        "base-url": "/endpoints/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/artifacts/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/3d8441643c204ba9b9dcb5c414b25a3129f66f6c/",
                        "creation": "2022-08-24T10:48:34.904939052Z",
                        "event-hash": "3d8441643c204ba9b9dcb5c414b25a3129f66f6c",
                        "files": [
                          {
                            "name": "bar.txt",
                            "size": 4,
                            "timestamp": "2022-08-24T10:48:34.904939052Z"
                          },
                          {
                            "name": "foo.txt",
                            "size": 4,
                            "timestamp": "2022-08-24T10:48:34.904939052Z"
                          }
                        ],
                        "modification": "2022-08-24T10:48:34.904939052Z",
                        "process-guid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                      }
                    ]
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/reports": {
      "get": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Get all detection reports",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d": {
                      "alert-count": 50,
                      "alert-criticality-metric": 0,
                      "avg-alert-criticality": 0,
                      "avg-signature-criticality": 0,
                      "bounded-score": 0,
                      "count-by-signature": {
                        "DefenderConfigChanged": 4,
                        "NewAutorun": 19,
                        "SuspiciousService": 5,
                        "UnknownServices": 9,
                        "UntrustedDriverLoaded": 13
                      },
                      "count-uniq-signatures": 5,
                      "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                      "median-time": "2022-08-24T12:48:32.709584161+02:00",
                      "score": 0,
                      "signature-count": 50,
                      "signature-criticality-metric": 0,
                      "signature-diversity": 100,
                      "signatures": [
                        "UntrustedDriverLoaded",
                        "NewAutorun",
                        "UnknownServices",
                        "DefenderConfigChanged",
                        "SuspiciousService"
                      ],
                      "start-time": "2022-08-24T12:48:32.708425432+02:00",
                      "std-dev-alert-criticality": 0,
                      "std-dev-signature-criticality": -92233720368547760,
                      "stop-time": "2022-08-24T12:48:32.71074289+02:00",
                      "sum-alert-criticality": 0,
                      "sum-rule-criticality": 0,
                      "tactics": null,
                      "techniques": null
                    }
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{os}/osqueryi/binary": {
      "get": {
        "tags": [
          "Manage OSQueryi installation"
        ],
        "summary": "Get information about OSQueryi binary",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "osqueryi",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "osqueryi",
                    "os": "windows",
                    "uuid": "2010ab6c-4bba-a535-8720-2d66feef4e90"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Manage OSQueryi installation"
        ],
        "summary": "Add or update OSQueryi binary to deploy on endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "OSQueryi binary to deploy",
          "content": {
            "application/octet-stream": {
              "schema": {
                "type": "string",
                "format": "binary"
              },
              "example": "TVpmb29iYXI="
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "osqueryi",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "osqueryi",
                    "os": "windows",
                    "uuid": "2010ab6c-4bba-a535-8720-2d66feef4e90"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manage OSQueryi installation"
        ],
        "summary": "Delete OSQueryi binary from manager and connected endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "osqueryi",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "osqueryi",
                    "os": "windows",
                    "uuid": "2010ab6c-4bba-a535-8720-2d66feef4e90"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{os}/sysmon/binary": {
      "get": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Get information about Sysmon binary",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "sysmon",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "sysmon",
                    "os": "windows",
                    "uuid": "c4c0a5ef-ada8-8f80-ff6c-928e70c925c2"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Add or update Sysmon binary to deploy on connected endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Sysmon binary to deploy",
          "content": {
            "application/octet-stream": {
              "schema": {
                "type": "string",
                "format": "binary"
              },
              "example": "TVpmb29iYXI="
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "sysmon",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "sysmon",
                    "os": "windows",
                    "uuid": "c4c0a5ef-ada8-8f80-ff6c-928e70c925c2"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Delete Sysmon binary from manager and connected endpoints",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "binary",
            "in": "query",
            "description": "Show binary in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alias": "sysmon",
                    "binary": "TVpmb29iYXI=",
                    "metadata": {
                      "md5": "6d6b9b955abe00ae042be6c0090e3c47",
                      "sha1": "9cc75cdbefa6d4490db401c9b0dc6398c7fb2a39",
                      "sha256": "31b7bcfda3653f68213fd59b33fdcda5bf9513c31f0adde1c75beaaa31e0f44b",
                      "sha512": "1d23010c1687f3d96a3762767f17b7e14a4b1da7aaa56c4fb0a046d59738fc27417f7ddd9409279f9e8765ed9d7229e19f1ec628a8ccfcafe586dcd161585438"
                    },
                    "name": "sysmon",
                    "os": "windows",
                    "uuid": "c4c0a5ef-ada8-8f80-ff6c-928e70c925c2"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{os}/sysmon/config": {
      "get": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Get a Sysmon configuration",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version",
            "in": "query",
            "description": "version query parameter",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "format query parameter",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "raw",
            "in": "query",
            "description": "raw query parameter",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "CheckRevocation": false,
                    "CopyOnDeletePE": false,
                    "DnsLookup": false,
                    "EventFiltering": {
                      "ClipboardChange": {
                        "onmatch": "exclude"
                      },
                      "CreateRemoteThread": {
                        "onmatch": "exclude"
                      },
                      "DriverLoad": {
                        "onmatch": "exclude"
                      },
                      "FileCreate": {
                        "onmatch": "exclude"
                      },
                      "FileCreateStreamHash": {
                        "onmatch": "exclude"
                      },
                      "FileCreateTime": {
                        "onmatch": "exclude"
                      },
                      "FileDelete": {
                        "onmatch": "exclude"
                      },
                      "FileDeleteDetected": {
                        "onmatch": "exclude"
                      },
                      "NetworkConnect": {
                        "onmatch": "exclude"
                      },
                      "PipeEvent": {
                        "onmatch": "exclude"
                      },
                      "ProcessCreate": {
                        "onmatch": "exclude"
                      },
                      "ProcessTampering": {
                        "onmatch": "exclude"
                      },
                      "ProcessTerminate": {
                        "onmatch": "exclude"
                      },
                      "RawAccessRead": {
                        "onmatch": "exclude"
                      },
                      "RuleGroup": [
                        {
                          "ImageLoad": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "Signature": [
                              {
                                "condition": "is",
                                "value": "Microsoft Windows Publisher"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Corporation"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Windows"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "ProcessAccess": {
                            "GrantedAccess": [
                              {
                                "condition": "is",
                                "value": "0x1000"
                              },
                              {
                                "condition": "is",
                                "value": "0x2000"
                              },
                              {
                                "condition": "is",
                                "value": "0x3000"
                              },
                              {
                                "condition": "is",
                                "value": "0x100000"
                              },
                              {
                                "condition": "is",
                                "value": "0x101000"
                              }
                            ],
                            "SourceImage": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\System32\\VBoxService.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\taskmgr.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "RegistryEvent": {
                            "EventType": [
                              {
                                "condition": "is not",
                                "value": "SetValue"
                              }
                            ],
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "DnsQuery": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        }
                      ],
                      "WmiEvent": {
                        "onmatch": "exclude"
                      }
                    },
                    "HashAlgorithms": [
                      "*"
                    ],
                    "OS": "windows",
                    "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                    "schemaversion": "4.70"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Add or update a Sysmon configuration",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "format query parameter",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Sysmon configuration file. Raw XML file that you would use to configure Sysmon can be posted here.",
          "content": {
            "application/xml": {
              "schema": {
                "type": "object",
                "properties": {
                  "InnerConfig": {
                    "type": "object",
                    "properties": {
                      "": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "EventFiltering": {
                        "type": "object",
                        "properties": {
                          "Filters": {
                            "type": "object",
                            "properties": {
                              "": {
                                "type": "object",
                                "properties": {
                                  "EventFilter": {
                                    "type": "object",
                                    "properties": {
                                      "onmatch": {
                                        "type": "string"
                                      }
                                    }
                                  },
                                  "Hashes": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "Image": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "IsExecutable": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "ProcessGuid": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "ProcessId": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "RuleName": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "TargetFilename": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "User": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "UtcTime": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "": {
                                          "type": "string"
                                        },
                                        "condition": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "RuleGroup": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "Filters": {
                                  "type": "object",
                                  "properties": {
                                    "": {
                                      "type": "object",
                                      "properties": {
                                        "EventFilter": {
                                          "type": "object",
                                          "properties": {
                                            "onmatch": {
                                              "type": "string"
                                            }
                                          }
                                        },
                                        "Hashes": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "Image": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "IsExecutable": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "ProcessGuid": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "ProcessId": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "RuleName": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "TargetFilename": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "User": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        },
                                        "UtcTime": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "": {
                                                "type": "string"
                                              },
                                              "condition": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "groupRelation": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      },
                      "Sysmon": {
                        "type": "object",
                        "properties": {
                          "Local": {
                            "type": "string"
                          },
                          "Space": {
                            "type": "string"
                          }
                        }
                      },
                      "schemaversion": {
                        "type": "string"
                      }
                    }
                  },
                  "Item": {
                    "type": "object"
                  }
                }
              },
              "example": {
                "schemaversion": "4.70",
                "CheckRevocation": false,
                "CopyOnDeletePE": false,
                "DnsLookup": false,
                "HashAlgorithms": [
                  "*"
                ],
                "EventFiltering": {
                  "ProcessCreate": {
                    "onmatch": "exclude"
                  },
                  "FileCreateTime": {
                    "onmatch": "exclude"
                  },
                  "NetworkConnect": {
                    "onmatch": "exclude"
                  },
                  "ProcessTerminate": {
                    "onmatch": "exclude"
                  },
                  "DriverLoad": {
                    "onmatch": "exclude"
                  },
                  "CreateRemoteThread": {
                    "onmatch": "exclude"
                  },
                  "RawAccessRead": {
                    "onmatch": "exclude"
                  },
                  "FileCreate": {
                    "onmatch": "exclude"
                  },
                  "FileCreateStreamHash": {
                    "onmatch": "exclude"
                  },
                  "PipeEvent": {
                    "onmatch": "exclude"
                  },
                  "WmiEvent": {
                    "onmatch": "exclude"
                  },
                  "FileDelete": {
                    "onmatch": "exclude"
                  },
                  "ClipboardChange": {
                    "onmatch": "exclude"
                  },
                  "ProcessTampering": {
                    "onmatch": "exclude"
                  },
                  "FileDeleteDetected": {
                    "onmatch": "exclude"
                  },
                  "RuleGroup": [
                    {
                      "ImageLoad": {
                        "onmatch": "exclude",
                        "Image": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon64.exe"
                          }
                        ],
                        "Signature": [
                          {
                            "condition": "is",
                            "value": "Microsoft Windows Publisher"
                          },
                          {
                            "condition": "is",
                            "value": "Microsoft Corporation"
                          },
                          {
                            "condition": "is",
                            "value": "Microsoft Windows"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    },
                    {
                      "ProcessAccess": {
                        "onmatch": "exclude",
                        "SourceImage": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\System32\\VBoxService.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\system32\\taskmgr.exe"
                          }
                        ],
                        "GrantedAccess": [
                          {
                            "condition": "is",
                            "value": "0x1000"
                          },
                          {
                            "condition": "is",
                            "value": "0x2000"
                          },
                          {
                            "condition": "is",
                            "value": "0x3000"
                          },
                          {
                            "condition": "is",
                            "value": "0x100000"
                          },
                          {
                            "condition": "is",
                            "value": "0x101000"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    },
                    {
                      "RegistryEvent": {
                        "onmatch": "exclude",
                        "EventType": [
                          {
                            "condition": "is not",
                            "value": "SetValue"
                          }
                        ],
                        "Image": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon64.exe"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    },
                    {
                      "DnsQuery": {
                        "onmatch": "exclude",
                        "Image": [
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon.exe"
                          },
                          {
                            "condition": "is",
                            "value": "C:\\Windows\\Sysmon64.exe"
                          }
                        ]
                      },
                      "groupRelation": "or"
                    }
                  ]
                },
                "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                "OS": "windows"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "CheckRevocation": false,
                    "CopyOnDeletePE": false,
                    "DnsLookup": false,
                    "EventFiltering": {
                      "ClipboardChange": {
                        "onmatch": "exclude"
                      },
                      "CreateRemoteThread": {
                        "onmatch": "exclude"
                      },
                      "DriverLoad": {
                        "onmatch": "exclude"
                      },
                      "FileCreate": {
                        "onmatch": "exclude"
                      },
                      "FileCreateStreamHash": {
                        "onmatch": "exclude"
                      },
                      "FileCreateTime": {
                        "onmatch": "exclude"
                      },
                      "FileDelete": {
                        "onmatch": "exclude"
                      },
                      "FileDeleteDetected": {
                        "onmatch": "exclude"
                      },
                      "NetworkConnect": {
                        "onmatch": "exclude"
                      },
                      "PipeEvent": {
                        "onmatch": "exclude"
                      },
                      "ProcessCreate": {
                        "onmatch": "exclude"
                      },
                      "ProcessTampering": {
                        "onmatch": "exclude"
                      },
                      "ProcessTerminate": {
                        "onmatch": "exclude"
                      },
                      "RawAccessRead": {
                        "onmatch": "exclude"
                      },
                      "RuleGroup": [
                        {
                          "ImageLoad": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "Signature": [
                              {
                                "condition": "is",
                                "value": "Microsoft Windows Publisher"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Corporation"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Windows"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "ProcessAccess": {
                            "GrantedAccess": [
                              {
                                "condition": "is",
                                "value": "0x1000"
                              },
                              {
                                "condition": "is",
                                "value": "0x2000"
                              },
                              {
                                "condition": "is",
                                "value": "0x3000"
                              },
                              {
                                "condition": "is",
                                "value": "0x100000"
                              },
                              {
                                "condition": "is",
                                "value": "0x101000"
                              }
                            ],
                            "SourceImage": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\System32\\VBoxService.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\taskmgr.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "RegistryEvent": {
                            "EventType": [
                              {
                                "condition": "is not",
                                "value": "SetValue"
                              }
                            ],
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "DnsQuery": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        }
                      ],
                      "WmiEvent": {
                        "onmatch": "exclude"
                      }
                    },
                    "HashAlgorithms": [
                      "*"
                    ],
                    "OS": "windows",
                    "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                    "schemaversion": "4.70"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Manage Sysmon"
        ],
        "summary": "Delete a Sysmon configuration",
        "parameters": [
          {
            "name": "os",
            "in": "path",
            "description": "os path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version",
            "in": "query",
            "description": "version query parameter",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "CheckRevocation": false,
                    "CopyOnDeletePE": false,
                    "DnsLookup": false,
                    "EventFiltering": {
                      "ClipboardChange": {
                        "onmatch": "exclude"
                      },
                      "CreateRemoteThread": {
                        "onmatch": "exclude"
                      },
                      "DriverLoad": {
                        "onmatch": "exclude"
                      },
                      "FileCreate": {
                        "onmatch": "exclude"
                      },
                      "FileCreateStreamHash": {
                        "onmatch": "exclude"
                      },
                      "FileCreateTime": {
                        "onmatch": "exclude"
                      },
                      "FileDelete": {
                        "onmatch": "exclude"
                      },
                      "FileDeleteDetected": {
                        "onmatch": "exclude"
                      },
                      "NetworkConnect": {
                        "onmatch": "exclude"
                      },
                      "PipeEvent": {
                        "onmatch": "exclude"
                      },
                      "ProcessCreate": {
                        "onmatch": "exclude"
                      },
                      "ProcessTampering": {
                        "onmatch": "exclude"
                      },
                      "ProcessTerminate": {
                        "onmatch": "exclude"
                      },
                      "RawAccessRead": {
                        "onmatch": "exclude"
                      },
                      "RuleGroup": [
                        {
                          "ImageLoad": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "Signature": [
                              {
                                "condition": "is",
                                "value": "Microsoft Windows Publisher"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Corporation"
                              },
                              {
                                "condition": "is",
                                "value": "Microsoft Windows"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "ProcessAccess": {
                            "GrantedAccess": [
                              {
                                "condition": "is",
                                "value": "0x1000"
                              },
                              {
                                "condition": "is",
                                "value": "0x2000"
                              },
                              {
                                "condition": "is",
                                "value": "0x3000"
                              },
                              {
                                "condition": "is",
                                "value": "0x100000"
                              },
                              {
                                "condition": "is",
                                "value": "0x101000"
                              }
                            ],
                            "SourceImage": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\System32\\VBoxService.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\system32\\taskmgr.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "RegistryEvent": {
                            "EventType": [
                              {
                                "condition": "is not",
                                "value": "SetValue"
                              }
                            ],
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        },
                        {
                          "DnsQuery": {
                            "Image": [
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon.exe"
                              },
                              {
                                "condition": "is",
                                "value": "C:\\Windows\\Sysmon64.exe"
                              }
                            ],
                            "onmatch": "exclude"
                          },
                          "groupRelation": "or"
                        }
                      ],
                      "WmiEvent": {
                        "onmatch": "exclude"
                      }
                    },
                    "HashAlgorithms": [
                      "*"
                    ],
                    "OS": "windows",
                    "XmlSha256": "a939006f3ccb8862411bb67a73976e35a61149d4c65952c7d3b588e7015dd7f4",
                    "schemaversion": "4.70"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}": {
      "get": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Get information about a single endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "last-connection": "2022-08-24T10:48:29.474420629Z",
                    "last-detection": "2022-08-24T12:48:28.433692184+02:00",
                    "last-event": "2022-08-24T12:48:28.433692184+02:00",
                    "score": 0,
                    "status": "",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Modify an existing endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "showkey",
            "in": "query",
            "description": "Show endpoint key in response",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "newkey",
            "in": "query",
            "description": "Generate a new key for endpoint",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Fields to modify. NB: Not all the fields can be modified",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "Item": {
                    "type": "object"
                  },
                  "command": {
                    "type": "object",
                    "properties": {
                      "args": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "background": {
                        "type": "boolean"
                      },
                      "completed": {
                        "type": "boolean"
                      },
                      "drop": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "data": {
                              "type": "string",
                              "format": "binary"
                            },
                            "error": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "uuid": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "error": {
                        "type": "string"
                      },
                      "expect-json": {
                        "type": "boolean"
                      },
                      "fetch": {
                        "type": "object",
                        "properties": {
                          "key(string)": {
                            "type": "object",
                            "properties": {
                              "data": {
                                "type": "string",
                                "format": "binary"
                              },
                              "error": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "uuid": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      },
                      "json": {
                        "type": "object"
                      },
                      "name": {
                        "type": "string"
                      },
                      "sent": {
                        "type": "boolean"
                      },
                      "sent-time": {
                        "type": "string",
                        "format": "date"
                      },
                      "stderr": {
                        "type": "string",
                        "format": "binary"
                      },
                      "stdout": {
                        "type": "string",
                        "format": "binary"
                      },
                      "timeout": {
                        "type": "object"
                      },
                      "uuid": {
                        "type": "string"
                      }
                    }
                  },
                  "config": {
                    "type": "object",
                    "properties": {
                      "actions": {
                        "type": "object",
                        "properties": {
                          "available-actions": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "critical": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "high": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "low": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "medium": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "audit": {
                        "type": "object",
                        "properties": {
                          "audit-dirs": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "audit-policies": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "enable": {
                            "type": "boolean"
                          }
                        }
                      },
                      "canaries": {
                        "type": "object",
                        "properties": {
                          "actions": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "enable": {
                            "type": "boolean"
                          },
                          "group": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "delete": {
                                  "type": "boolean"
                                },
                                "directories": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "files": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "hide-dirs": {
                                  "type": "boolean"
                                },
                                "hide-files": {
                                  "type": "boolean"
                                },
                                "set-audit-acl": {
                                  "type": "boolean"
                                }
                              }
                            }
                          },
                          "whitelist": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "criticality-treshold": {
                        "type": "integer",
                        "format": "int64"
                      },
                      "db-path": {
                        "type": "string"
                      },
                      "dump": {
                        "type": "object",
                        "properties": {
                          "compression": {
                            "type": "boolean"
                          },
                          "dir": {
                            "type": "string"
                          },
                          "dump-untracked": {
                            "type": "boolean"
                          },
                          "max-dumps": {
                            "type": "integer",
                            "format": "int64"
                          }
                        }
                      },
                      "en-filters": {
                        "type": "boolean"
                      },
                      "en-hooks": {
                        "type": "boolean"
                      },
                      "endpoint": {
                        "type": "boolean"
                      },
                      "etw": {
                        "type": "object",
                        "properties": {
                          "providers": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "traces": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "forwarder": {
                        "type": "object",
                        "properties": {
                          "local": {
                            "type": "boolean"
                          },
                          "logging": {
                            "type": "object",
                            "properties": {
                              "dir": {
                                "type": "string"
                              },
                              "rotation-interval": {
                                "type": "object"
                              }
                            }
                          },
                          "manager": {
                            "type": "object",
                            "properties": {
                              "endpoint-key": {
                                "type": "string"
                              },
                              "endpoint-uuid": {
                                "type": "string"
                              },
                              "host": {
                                "type": "string"
                              },
                              "max-upload-size": {
                                "type": "integer",
                                "format": "int64"
                              },
                              "port": {
                                "type": "integer",
                                "format": "int64"
                              },
                              "proto": {
                                "type": "string"
                              },
                              "server-fingerprint": {
                                "type": "string"
                              },
                              "server-key": {
                                "type": "string"
                              },
                              "unsafe": {
                                "type": "boolean"
                              }
                            }
                          }
                        }
                      },
                      "log-all": {
                        "type": "boolean"
                      },
                      "logfile": {
                        "type": "string"
                      },
                      "report": {
                        "type": "object",
                        "properties": {
                          "commands": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "args": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "description": {
                                  "type": "string"
                                },
                                "error": {
                                  "type": "string"
                                },
                                "expect-json": {
                                  "type": "boolean"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "stderr": {
                                  "type": "string",
                                  "format": "binary"
                                },
                                "stdout": {
                                  "type": "object"
                                },
                                "timeout": {
                                  "type": "object"
                                },
                                "timestamp": {
                                  "type": "string",
                                  "format": "date"
                                }
                              }
                            }
                          },
                          "en-reporting": {
                            "type": "boolean"
                          },
                          "osquery": {
                            "type": "object",
                            "properties": {
                              "tables": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            }
                          },
                          "timeout": {
                            "type": "object"
                          }
                        }
                      },
                      "rules": {
                        "type": "object",
                        "properties": {
                          "containers-db": {
                            "type": "string"
                          },
                          "rules-db": {
                            "type": "string"
                          },
                          "update-interval": {
                            "type": "object"
                          }
                        }
                      },
                      "sysmon": {
                        "type": "object",
                        "properties": {
                          "archive-directory": {
                            "type": "string"
                          },
                          "bin": {
                            "type": "string"
                          },
                          "clean-archived": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  },
                  "criticality": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "group": {
                    "type": "string"
                  },
                  "hostname": {
                    "type": "string"
                  },
                  "ip": {
                    "type": "string"
                  },
                  "key": {
                    "type": "string"
                  },
                  "last-connection": {
                    "type": "string",
                    "format": "date"
                  },
                  "last-detection": {
                    "type": "string",
                    "format": "date"
                  },
                  "last-event": {
                    "type": "string",
                    "format": "date"
                  },
                  "score": {
                    "type": "number",
                    "format": "double"
                  },
                  "status": {
                    "type": "string"
                  },
                  "system-info": {
                    "type": "object",
                    "properties": {
                      "bios": {
                        "type": "object",
                        "properties": {
                          "date": {
                            "type": "string"
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "cpu": {
                        "type": "object",
                        "properties": {
                          "count": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "name": {
                            "type": "string"
                          }
                        }
                      },
                      "edr": {
                        "type": "object",
                        "properties": {
                          "commit": {
                            "type": "string"
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "error": {
                        "type": "object"
                      },
                      "os": {
                        "type": "object",
                        "properties": {
                          "build": {
                            "type": "string"
                          },
                          "edition": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "product": {
                            "type": "string"
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "sysmon": {
                        "type": "object",
                        "properties": {
                          "config": {
                            "type": "object",
                            "properties": {
                              "hash": {
                                "type": "string"
                              },
                              "version": {
                                "type": "object",
                                "properties": {
                                  "binary": {
                                    "type": "string"
                                  },
                                  "schema": {
                                    "type": "string"
                                  }
                                }
                              }
                            }
                          },
                          "driver": {
                            "type": "object",
                            "properties": {
                              "image": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "sha256": {
                                "type": "string"
                              }
                            }
                          },
                          "service": {
                            "type": "object",
                            "properties": {
                              "image": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "sha256": {
                                "type": "string"
                              }
                            }
                          },
                          "version": {
                            "type": "string"
                          }
                        }
                      },
                      "system": {
                        "type": "object",
                        "properties": {
                          "manufacturer": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "virtual": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  },
                  "uuid": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "uuid": "",
                "hostname": "",
                "ip": "",
                "group": "New Group",
                "criticality": 0,
                "key": "New Key",
                "score": 0,
                "status": "New Status",
                "last-event": "0001-01-01T00:00:00Z",
                "last-detection": "0001-01-01T00:00:00Z",
                "last-connection": "0001-01-01T00:00:00Z"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "New Group",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "last-connection": "2022-08-24T10:48:29.474420629Z",
                    "last-detection": "2022-08-24T12:48:28.433692184+02:00",
                    "last-event": "2022-08-24T12:48:28.433692184+02:00",
                    "score": 0,
                    "status": "New Status",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Endpoint Management"
        ],
        "summary": "Delete an existing endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "criticality": 0,
                    "group": "New Group",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "last-connection": "2022-08-24T10:48:29.474420629Z",
                    "last-detection": "2022-08-24T12:48:28.433692184+02:00",
                    "last-event": "2022-08-24T12:48:28.433692184+02:00",
                    "score": 0,
                    "status": "New Status",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/artifacts": {
      "get": {
        "tags": [
          "Artifact Search and Retrieval"
        ],
        "summary": "Artifacts for a single endpoint",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve artifacts received since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "base-url": "/endpoints/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/artifacts/5a92baeb-9384-47d3-92b4-a0db6f9b8c6d/3d8441643c204ba9b9dcb5c414b25a3129f66f6c/",
                      "creation": "2022-08-24T10:48:34.904939052Z",
                      "event-hash": "3d8441643c204ba9b9dcb5c414b25a3129f66f6c",
                      "files": [
                        {
                          "name": "bar.txt",
                          "size": 4,
                          "timestamp": "2022-08-24T10:48:34.904939052Z"
                        },
                        {
                          "name": "foo.txt",
                          "size": 4,
                          "timestamp": "2022-08-24T10:48:34.904939052Z"
                        }
                      ],
                      "modification": "2022-08-24T10:48:34.904939052Z",
                      "process-guid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/artifacts/{pguid}/{ehash}/{filename}": {
      "get": {
        "tags": [
          "Artifact Search and Retrieval"
        ],
        "summary": "Retrieve the content of an artifact",
        "parameters": [
          {
            "name": "raw",
            "in": "query",
            "description": "Retrieve raw file content",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "gunzip",
            "in": "query",
            "description": "Serve gunziped file content",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pguid",
            "in": "path",
            "description": "pguid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "ehash",
            "in": "path",
            "description": "ehash path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filename",
            "in": "path",
            "description": "filename path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": "QmxhaA==",
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/command": {
      "get": {
        "tags": [
          "Endpoint Command Execution"
        ],
        "summary": "Get the result of a command executed on endpoint",
        "parameters": [
          {
            "name": "wait",
            "in": "query",
            "description": "Wait command to end before responding, making the call blocking",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "args": [
                      "printf",
                      "Hello World"
                    ],
                    "background": false,
                    "completed": true,
                    "drop": [],
                    "error": "",
                    "expect-json": false,
                    "fetch": {},
                    "json": null,
                    "name": "/usr/bin/printf",
                    "sent": true,
                    "sent-time": "2022-08-24T12:48:32.653944225+02:00",
                    "stderr": null,
                    "stdout": "SGVsbG8gV29ybGQ=",
                    "timeout": 0,
                    "uuid": "d8f859cb-a5a6-f547-9e80-ae30ddfc3ef7"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Endpoint Command Execution"
        ],
        "summary": "Send a command to be executed by the endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Command to be executed. One can also specify files \n\t\t\t\tto drop from the manager to the endpoint prior to command execution \n\t\t\t\tand files to fetch after execution. A timeout for the can also \n\t\t\t\tbe specified, if zero there will be no timeout. For a full list of \n\t\t\t\tavailable EDR specific commands check [documentation](https://github.com/0xrawsec/whids/blob/master/doc/edr-commands.md).",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "command-line": {
                    "type": "string"
                  },
                  "drop-files": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "fetch-files": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "timeout": {
                    "type": "object"
                  }
                }
              },
              "example": {
                "command-line": "printf \"Hello World\"",
                "fetch-files": null,
                "drop-files": null,
                "timeout": 0
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "command": {
                      "args": [
                        "Hello World"
                      ],
                      "background": false,
                      "completed": false,
                      "drop": [],
                      "error": "",
                      "expect-json": false,
                      "fetch": {},
                      "json": null,
                      "name": "printf",
                      "sent": false,
                      "sent-time": "0001-01-01T00:00:00Z",
                      "stderr": null,
                      "stdout": null,
                      "timeout": 0,
                      "uuid": "d8f859cb-a5a6-f547-9e80-ae30ddfc3ef7"
                    },
                    "criticality": 0,
                    "group": "",
                    "hostname": "OpenHappy",
                    "ip": "127.0.0.1",
                    "key": "CR7kBoCE8iNvFnbp7emRyNYMF2Ih9POtzNHkOC6iUsNURhR64NfUS22mESgBlFYr",
                    "last-connection": "2022-08-24T10:48:31.650949593Z",
                    "last-detection": "2022-08-24T12:48:30.602528676+02:00",
                    "last-event": "2022-08-24T12:48:30.602528676+02:00",
                    "score": 0,
                    "status": "",
                    "system-info": {
                      "bios": {
                        "date": "12/01/2006",
                        "version": "VirtualBox"
                      },
                      "cpu": {
                        "count": 4,
                        "name": "Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz"
                      },
                      "edr": {
                        "commit": "deadbeeeeeeeeeeeeeeeeef",
                        "version": "major.minor.patch"
                      },
                      "error": null,
                      "os": {
                        "build": "18362",
                        "edition": "Enterprise",
                        "name": "windows",
                        "product": "Windows 10 Pro",
                        "version": "10.0.18362"
                      },
                      "sysmon": {
                        "config": {
                          "hash": "2d1652d67b565cabf2e774668f2598188373e957ef06aa5653bf9bf6fe7fe837",
                          "version": {
                            "binary": "15.0",
                            "schema": "4.70"
                          }
                        },
                        "driver": {
                          "image": "C:\\Windows\\SysmonDrv.sys",
                          "name": "SysmonDrv",
                          "sha256": "e9ea8c0390c65c055d795b301ee50de8f8884313530023918c2eea56de37a525"
                        },
                        "service": {
                          "image": "C:\\Program Files\\Whids\\Sysmon64.exe",
                          "name": "Sysmon64",
                          "sha256": "b448cd80b09fa43a3848f5181362ac52ffcb283f88693b68f1a0e4e6ae932863"
                        },
                        "version": "v13.23"
                      },
                      "system": {
                        "manufacturer": "innotek GmbH",
                        "name": "VirtualBox",
                        "virtual": true
                      }
                    },
                    "uuid": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/command/{field}": {
      "get": {
        "tags": [
          "Endpoint Command Execution"
        ],
        "summary": "Retrieve only a field of the command structure",
        "parameters": [
          {
            "name": "wait",
            "in": "query",
            "description": "Wait command to end before responding, making the call blocking",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "field",
            "in": "path",
            "description": "Field of the Command structure to return",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": "SGVsbG8gV29ybGQ=",
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/config": {
      "get": {
        "tags": [
          "Endpoint Configuration"
        ],
        "summary": "Get endpoint configuration",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "Select input and output format (allowed toml, json)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "actions": {
                      "available-actions": null,
                      "critical": [],
                      "high": [],
                      "low": [],
                      "medium": []
                    },
                    "audit": {
                      "audit-dirs": [],
                      "audit-policies": [],
                      "enable": false
                    },
                    "canaries": {
                      "actions": [],
                      "enable": false,
                      "group": null,
                      "whitelist": []
                    },
                    "criticality-treshold": 0,
                    "db-path": "somerandompath",
                    "dump": {
                      "compression": false,
                      "dir": "",
                      "dump-untracked": false,
                      "max-dumps": 0
                    },
                    "en-filters": false,
                    "en-hooks": false,
                    "endpoint": false,
                    "etw": {
                      "providers": [],
                      "traces": []
                    },
                    "forwarder": {
                      "local": false,
                      "logging": {
                        "dir": "",
                        "rotation-interval": 0
                      },
                      "manager": {
                        "endpoint-key": "",
                        "endpoint-uuid": "",
                        "host": "",
                        "max-upload-size": 0,
                        "port": 0,
                        "proto": "",
                        "server-fingerprint": "",
                        "server-key": "",
                        "unsafe": false
                      }
                    },
                    "log-all": false,
                    "logfile": "",
                    "report": {
                      "commands": null,
                      "en-reporting": false,
                      "osquery": {
                        "tables": []
                      },
                      "timeout": 0
                    },
                    "rules": {
                      "containers-db": "",
                      "rules-db": "",
                      "update-interval": 0
                    },
                    "sysmon": {
                      "archive-directory": "",
                      "bin": "",
                      "clean-archived": false
                    }
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Endpoint Configuration"
        ],
        "summary": "Change endpoint configuration",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "Select input and output format (allowed toml, json)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "Configuration content",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "actions": {
                    "type": "object",
                    "properties": {
                      "available-actions": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "critical": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "high": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "low": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "medium": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "audit": {
                    "type": "object",
                    "properties": {
                      "audit-dirs": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "audit-policies": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "enable": {
                        "type": "boolean"
                      }
                    }
                  },
                  "canaries": {
                    "type": "object",
                    "properties": {
                      "actions": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "enable": {
                        "type": "boolean"
                      },
                      "group": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "delete": {
                              "type": "boolean"
                            },
                            "directories": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "files": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "hide-dirs": {
                              "type": "boolean"
                            },
                            "hide-files": {
                              "type": "boolean"
                            },
                            "set-audit-acl": {
                              "type": "boolean"
                            }
                          }
                        }
                      },
                      "whitelist": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "criticality-treshold": {
                    "type": "integer",
                    "format": "int64"
                  },
                  "db-path": {
                    "type": "string"
                  },
                  "dump": {
                    "type": "object",
                    "properties": {
                      "compression": {
                        "type": "boolean"
                      },
                      "dir": {
                        "type": "string"
                      },
                      "dump-untracked": {
                        "type": "boolean"
                      },
                      "max-dumps": {
                        "type": "integer",
                        "format": "int64"
                      }
                    }
                  },
                  "en-filters": {
                    "type": "boolean"
                  },
                  "en-hooks": {
                    "type": "boolean"
                  },
                  "endpoint": {
                    "type": "boolean"
                  },
                  "etw": {
                    "type": "object",
                    "properties": {
                      "providers": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "traces": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "forwarder": {
                    "type": "object",
                    "properties": {
                      "local": {
                        "type": "boolean"
                      },
                      "logging": {
                        "type": "object",
                        "properties": {
                          "dir": {
                            "type": "string"
                          },
                          "rotation-interval": {
                            "type": "object"
                          }
                        }
                      },
                      "manager": {
                        "type": "object",
                        "properties": {
                          "endpoint-key": {
                            "type": "string"
                          },
                          "endpoint-uuid": {
                            "type": "string"
                          },
                          "host": {
                            "type": "string"
                          },
                          "max-upload-size": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "port": {
                            "type": "integer",
                            "format": "int64"
                          },
                          "proto": {
                            "type": "string"
                          },
                          "server-fingerprint": {
                            "type": "string"
                          },
                          "server-key": {
                            "type": "string"
                          },
                          "unsafe": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  },
                  "log-all": {
                    "type": "boolean"
                  },
                  "logfile": {
                    "type": "string"
                  },
                  "report": {
                    "type": "object",
                    "properties": {
                      "commands": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "args": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "description": {
                              "type": "string"
                            },
                            "error": {
                              "type": "string"
                            },
                            "expect-json": {
                              "type": "boolean"
                            },
                            "name": {
                              "type": "string"
                            },
                            "stderr": {
                              "type": "string",
                              "format": "binary"
                            },
                            "stdout": {
                              "type": "object"
                            },
                            "timeout": {
                              "type": "object"
                            },
                            "timestamp": {
                              "type": "string",
                              "format": "date"
                            }
                          }
                        }
                      },
                      "en-reporting": {
                        "type": "boolean"
                      },
                      "osquery": {
                        "type": "object",
                        "properties": {
                          "tables": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "timeout": {
                        "type": "object"
                      }
                    }
                  },
                  "rules": {
                    "type": "object",
                    "properties": {
                      "containers-db": {
                        "type": "string"
                      },
                      "rules-db": {
                        "type": "string"
                      },
                      "update-interval": {
                        "type": "object"
                      }
                    }
                  },
                  "sysmon": {
                    "type": "object",
                    "properties": {
                      "archive-directory": {
                        "type": "string"
                      },
                      "bin": {
                        "type": "string"
                      },
                      "clean-archived": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              },
              "example": {
                "db-path": "somerandompath",
                "criticality-treshold": 0,
                "en-hooks": false,
                "en-filters": false,
                "logfile": "",
                "log-all": false,
                "endpoint": false,
                "etw": {
                  "providers": null,
                  "traces": null
                },
                "forwarder": {
                  "local": false,
                  "manager": {
                    "proto": "",
                    "host": "",
                    "port": 0,
                    "endpoint-uuid": "",
                    "endpoint-key": "",
                    "server-key": "",
                    "server-fingerprint": "",
                    "unsafe": false,
                    "max-upload-size": 0
                  },
                  "logging": {
                    "dir": "",
                    "rotation-interval": 0
                  }
                },
                "sysmon": {
                  "bin": "",
                  "archive-directory": "",
                  "clean-archived": false
                },
                "actions": {
                  "available-actions": null,
                  "low": null,
                  "medium": null,
                  "high": null,
                  "critical": null
                },
                "dump": {
                  "dir": "",
                  "max-dumps": 0,
                  "compression": false,
                  "dump-untracked": false
                },
                "report": {
                  "en-reporting": false,
                  "osquery": {
                    "tables": null
                  },
                  "commands": null,
                  "timeout": 0
                },
                "rules": {
                  "rules-db": "",
                  "containers-db": "",
                  "update-interval": 0
                },
                "audit": {
                  "enable": false,
                  "audit-policies": null,
                  "audit-dirs": null
                },
                "canaries": {
                  "enable": false,
                  "actions": null,
                  "whitelist": null,
                  "group": null
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "actions": {
                      "available-actions": null,
                      "critical": null,
                      "high": null,
                      "low": null,
                      "medium": null
                    },
                    "audit": {
                      "audit-dirs": null,
                      "audit-policies": null,
                      "enable": false
                    },
                    "canaries": {
                      "actions": null,
                      "enable": false,
                      "group": null,
                      "whitelist": null
                    },
                    "criticality-treshold": 0,
                    "db-path": "somerandompath",
                    "dump": {
                      "compression": false,
                      "dir": "",
                      "dump-untracked": false,
                      "max-dumps": 0
                    },
                    "en-filters": false,
                    "en-hooks": false,
                    "endpoint": false,
                    "etw": {
                      "providers": null,
                      "traces": null
                    },
                    "forwarder": {
                      "local": false,
                      "logging": {
                        "dir": "",
                        "rotation-interval": 0
                      },
                      "manager": {
                        "endpoint-key": "",
                        "endpoint-uuid": "",
                        "host": "",
                        "max-upload-size": 0,
                        "port": 0,
                        "proto": "",
                        "server-fingerprint": "",
                        "server-key": "",
                        "unsafe": false
                      }
                    },
                    "log-all": false,
                    "logfile": "",
                    "report": {
                      "commands": null,
                      "en-reporting": false,
                      "osquery": {
                        "tables": null
                      },
                      "timeout": 0
                    },
                    "rules": {
                      "containers-db": "",
                      "rules-db": "",
                      "update-interval": 0
                    },
                    "sysmon": {
                      "archive-directory": "",
                      "bin": "",
                      "clean-archived": false
                    }
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Endpoint Configuration"
        ],
        "summary": "Delete endpoint configuration (this causes the endpoint to sync again its current configuration)",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "format",
            "in": "query",
            "description": "Select input and output format (allowed toml, json)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": null,
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/detections": {
      "get": {
        "tags": [
          "Endpoint Log Retrieval"
        ],
        "summary": "Retrieve detections logs",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve logs since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "until",
            "in": "query",
            "description": "Retrieve logs until date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "last",
            "in": "query",
            "description": "Return last logs from duration (ex: '1d' for last day)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pivot",
            "in": "query",
            "description": "Timestamp to pivot around (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "delta",
            "in": "query",
            "description": "Delta duration used to pivot (ex: '5m' to get logs 5min around pivot) ",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reports to return",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "skip",
            "in": "query",
            "description": "Skip number of events",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Event": {
                        "Detection": {
                          "Actions": [],
                          "Criticality": 4,
                          "Signature": [
                            "SuspiciousService"
                          ]
                        },
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": true,
                            "Hash": "039f9f93b6f830ecb8be3a6be503c0a679d7f765",
                            "ReceiptTime": "2022-08-24T10:48:28.371120128Z"
                          }
                        },
                        "EventData": {
                          "Ancestors": "System|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\wininit.exe|C:\\Windows\\System32\\services.exe",
                          "CommandLine": "\"C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2106.6-0\\MsMpEng.exe\"",
                          "Company": "Microsoft Corporation",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Description": "Antimalware Service Executable",
                          "FileVersion": "4.18.2106.6 (WinBuild.160101.0800)",
                          "Hashes": "SHA1=FBF03B5D6DC1A7EDAB0BA8D4DD27291C739E5813,MD5=B1C15F9DB942B373B2FC468B7048E63F,SHA256=1DC05B6DD6281840CEB822604B0E403E499180D636D02EC08AD77B4EB56F1B9C,IMPHASH=8AA2B8727E6858A3557A4C09970B9A5D",
                          "Image": "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2106.6-0\\MsMpEng.exe",
                          "ImageSize": "136640",
                          "IntegrityLevel": "System",
                          "LogonGuid": "{515cd0d1-7667-6123-e703-000000000000}",
                          "LogonId": "0x3E7",
                          "OriginalFileName": "MsMpEng.exe",
                          "ParentCommandLine": "C:\\Windows\\system32\\services.exe",
                          "ParentImage": "C:\\Windows\\System32\\services.exe",
                          "ParentIntegrityLevel": "System",
                          "ParentProcessGuid": "{515cd0d1-7666-6123-0b00-000000007300}",
                          "ParentProcessId": "692",
                          "ParentServices": "N/A",
                          "ParentUser": "NT AUTHORITY\\SYSTEM",
                          "ProcessGuid": "{515cd0d1-7669-6123-4e00-000000007300}",
                          "ProcessId": "3276",
                          "Product": "Microsoft® Windows® Operating System",
                          "RuleName": "-",
                          "Services": "WinDefend",
                          "TerminalSessionId": "0",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:25.475"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 1,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-24T12:48:27.325122364+02:00"
                          }
                        }
                      }
                    },
                    {
                      "Event": {
                        "Detection": {
                          "Actions": [],
                          "Criticality": 4,
                          "Signature": [
                            "SuspiciousService"
                          ]
                        },
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": true,
                            "Hash": "039f9f93b6f830ecb8be3a6be503c0a679d7f765",
                            "ReceiptTime": "2022-08-24T10:48:28.370602986Z"
                          }
                        },
                        "EventData": {
                          "Ancestors": "System|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\wininit.exe|C:\\Windows\\System32\\services.exe",
                          "CommandLine": "\"C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2106.6-0\\MsMpEng.exe\"",
                          "Company": "Microsoft Corporation",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Description": "Antimalware Service Executable",
                          "FileVersion": "4.18.2106.6 (WinBuild.160101.0800)",
                          "Hashes": "SHA1=FBF03B5D6DC1A7EDAB0BA8D4DD27291C739E5813,MD5=B1C15F9DB942B373B2FC468B7048E63F,SHA256=1DC05B6DD6281840CEB822604B0E403E499180D636D02EC08AD77B4EB56F1B9C,IMPHASH=8AA2B8727E6858A3557A4C09970B9A5D",
                          "Image": "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2106.6-0\\MsMpEng.exe",
                          "ImageSize": "136640",
                          "IntegrityLevel": "System",
                          "LogonGuid": "{515cd0d1-7667-6123-e703-000000000000}",
                          "LogonId": "0x3E7",
                          "OriginalFileName": "MsMpEng.exe",
                          "ParentCommandLine": "C:\\Windows\\system32\\services.exe",
                          "ParentImage": "C:\\Windows\\System32\\services.exe",
                          "ParentIntegrityLevel": "System",
                          "ParentProcessGuid": "{515cd0d1-7666-6123-0b00-000000007300}",
                          "ParentProcessId": "692",
                          "ParentServices": "N/A",
                          "ParentUser": "NT AUTHORITY\\SYSTEM",
                          "ProcessGuid": "{515cd0d1-7669-6123-4e00-000000007300}",
                          "ProcessId": "3276",
                          "Product": "Microsoft® Windows® Operating System",
                          "RuleName": "-",
                          "Services": "WinDefend",
                          "TerminalSessionId": "0",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:25.475"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 1,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-24T12:48:27.325122364+02:00"
                          }
                        }
                      }
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/logs": {
      "get": {
        "tags": [
          "Endpoint Log Retrieval"
        ],
        "summary": "Retrieve any kind of logs (detections + filtered)",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve logs since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "until",
            "in": "query",
            "description": "Retrieve logs until date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "last",
            "in": "query",
            "description": "Return last logs from duration (ex: '1d' for last day)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pivot",
            "in": "query",
            "description": "Timestamp to pivot around (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "delta",
            "in": "query",
            "description": "Delta duration used to pivot (ex: '5m' to get logs 5min around pivot) ",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reports to return",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "skip",
            "in": "query",
            "description": "Skip number of events",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Event": {
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": false,
                            "Hash": "0a4077f1d13ff7d07dcc2fa4f458a63a2b950911",
                            "ReceiptTime": "2022-08-24T10:48:28.364112404Z"
                          }
                        },
                        "EventData": {
                          "CommandLine": "C:\\Windows\\system32\\svchost.exe -k appmodel -p -s StateRepository",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Details": "S-1-15-2-2434737943-167758768-3180539153-984336765-1107280622-3591121930-2677285773",
                          "EventType": "SetValue",
                          "Image": "C:\\Windows\\system32\\svchost.exe",
                          "ImageHashes": "SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
                          "ImageSignature": "?",
                          "ImageSignatureStatus": "?",
                          "ImageSigned": "false",
                          "IntegrityLevel": "System",
                          "ProcessGuid": "{515cd0d1-7668-6123-3c00-000000007300}",
                          "ProcessId": "2556",
                          "ProcessThreatScore": "0",
                          "RuleName": "-",
                          "Services": "StateRepository",
                          "TargetObject": "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModel\\StateRepository\\Cache\\PackageFamily\\Data\\15\\PackageSID",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:29.669"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 13,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-24T12:48:27.324288913+02:00"
                          }
                        }
                      }
                    },
                    {
                      "Event": {
                        "EdrData": {
                          "Endpoint": {
                            "Group": "",
                            "Hostname": "OpenHappy",
                            "IP": "127.0.0.1",
                            "UUID": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d"
                          },
                          "Event": {
                            "Detection": false,
                            "Hash": "45f99356c67ddb05b3961580ddd05301c3de30d8",
                            "ReceiptTime": "2022-08-24T10:48:28.36456168Z"
                          }
                        },
                        "EventData": {
                          "CommandLine": "C:\\Windows\\system32\\svchost.exe -k appmodel -p -s StateRepository",
                          "CurrentDirectory": "C:\\Windows\\system32\\",
                          "Details": "windows.protocol",
                          "EventType": "SetValue",
                          "Image": "C:\\Windows\\system32\\svchost.exe",
                          "ImageHashes": "SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
                          "ImageSignature": "?",
                          "ImageSignatureStatus": "?",
                          "ImageSigned": "false",
                          "IntegrityLevel": "System",
                          "ProcessGuid": "{515cd0d1-7668-6123-3c00-000000007300}",
                          "ProcessId": "2556",
                          "ProcessThreatScore": "0",
                          "RuleName": "-",
                          "Services": "StateRepository",
                          "TargetObject": "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModel\\StateRepository\\Cache\\ApplicationExtension\\Data\\538\\Category",
                          "User": "NT AUTHORITY\\SYSTEM",
                          "UtcTime": "2021-08-23 10:20:30.799"
                        },
                        "System": {
                          "Channel": "Microsoft-Windows-Sysmon/Operational",
                          "Computer": "DESKTOP-LJRVE06",
                          "Correlation": {
                            "ActivityID": "",
                            "RelatedActivityID": ""
                          },
                          "EventID": 13,
                          "Execution": {
                            "ProcessID": 3220,
                            "ThreadID": 3848
                          },
                          "Keywords": {
                            "Name": "",
                            "Value": 9223372036854776000
                          },
                          "Level": {
                            "Name": "Information",
                            "Value": 4
                          },
                          "Opcode": {
                            "Name": "Info",
                            "Value": 0
                          },
                          "Provider": {
                            "Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
                            "Name": "Microsoft-Windows-Sysmon"
                          },
                          "Task": {
                            "Name": "",
                            "Value": 0
                          },
                          "TimeCreated": {
                            "SystemTime": "2022-08-24T12:48:27.3242892+02:00"
                          }
                        }
                      }
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/report": {
      "get": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Retrieve report for a single endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alert-count": 50,
                    "alert-criticality-metric": 0,
                    "avg-alert-criticality": 0,
                    "avg-signature-criticality": 0,
                    "bounded-score": 0,
                    "count-by-signature": {
                      "DefenderConfigChanged": 4,
                      "NewAutorun": 19,
                      "SuspiciousService": 5,
                      "UnknownServices": 9,
                      "UntrustedDriverLoaded": 13
                    },
                    "count-uniq-signatures": 5,
                    "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                    "median-time": "2022-08-24T12:48:32.709584161+02:00",
                    "score": 0,
                    "signature-count": 50,
                    "signature-criticality-metric": 0,
                    "signature-diversity": 100,
                    "signatures": [
                      "DefenderConfigChanged",
                      "SuspiciousService",
                      "UntrustedDriverLoaded",
                      "NewAutorun",
                      "UnknownServices"
                    ],
                    "start-time": "2022-08-24T12:48:32.708425432+02:00",
                    "std-dev-alert-criticality": 0,
                    "std-dev-signature-criticality": -92233720368547760,
                    "stop-time": "2022-08-24T12:48:32.71074289+02:00",
                    "sum-alert-criticality": 0,
                    "sum-rule-criticality": 0,
                    "tactics": null,
                    "techniques": null
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Delete and archive a report for a single endpoint",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "alert-count": 50,
                    "alert-criticality-metric": 0,
                    "avg-alert-criticality": 0,
                    "avg-signature-criticality": 0,
                    "bounded-score": 0,
                    "count-by-signature": {
                      "DefenderConfigChanged": 4,
                      "NewAutorun": 19,
                      "SuspiciousService": 5,
                      "UnknownServices": 9,
                      "UntrustedDriverLoaded": 13
                    },
                    "count-uniq-signatures": 5,
                    "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                    "median-time": "2022-08-24T12:48:32.709584161+02:00",
                    "score": 0,
                    "signature-count": 50,
                    "signature-criticality-metric": 0,
                    "signature-diversity": 100,
                    "signatures": [
                      "UntrustedDriverLoaded",
                      "NewAutorun",
                      "UnknownServices",
                      "DefenderConfigChanged",
                      "SuspiciousService"
                    ],
                    "start-time": "2022-08-24T12:48:32.708425432+02:00",
                    "std-dev-alert-criticality": 0,
                    "std-dev-signature-criticality": -92233720368547760,
                    "stop-time": "2022-08-24T12:48:32.71074289+02:00",
                    "sum-alert-criticality": 0,
                    "sum-rule-criticality": 0,
                    "tactics": null,
                    "techniques": null
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/endpoints/{uuid}/report/archive": {
      "get": {
        "tags": [
          "Detection Reports"
        ],
        "summary": "Get archived reports",
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "description": "Retrieve report since date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "until",
            "in": "query",
            "description": "Retrieve report until date (RFC3339)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "last",
            "in": "query",
            "description": "Return last reports from duration (ex: '1d' for last day)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reports to return",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "alert-count": 50,
                      "alert-criticality-metric": 0,
                      "archived-time": "2022-08-24T12:48:33.777146389+02:00",
                      "avg-alert-criticality": 0,
                      "avg-signature-criticality": 0,
                      "bounded-score": 0,
                      "count-by-signature": {
                        "DefenderConfigChanged": 4,
                        "NewAutorun": 19,
                        "SuspiciousService": 5,
                        "UnknownServices": 9,
                        "UntrustedDriverLoaded": 13
                      },
                      "count-uniq-signatures": 5,
                      "identifier": "5a92baeb-9384-47d3-92b4-a0db6f9b8c6d",
                      "median-time": "2022-08-24T12:48:32.709584161+02:00",
                      "score": 0,
                      "signature-count": 50,
                      "signature-criticality-metric": 0,
                      "signature-diversity": 100,
                      "signatures": [
                        "UntrustedDriverLoaded",
                        "NewAutorun",
                        "UnknownServices",
                        "DefenderConfigChanged",
                        "SuspiciousService"
                      ],
                      "start-time": "2022-08-24T12:48:32.708425432+02:00",
                      "std-dev-alert-criticality": 0,
                      "std-dev-signature-criticality": -92233720368547760,
                      "stop-time": "2022-08-24T12:48:32.71074289+02:00",
                      "sum-alert-criticality": 0,
                      "sum-rule-criticality": 0,
                      "tactics": null,
                      "techniques": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/iocs": {
      "get": {
        "tags": [
          "IoC Management (control IoCs pushed on Endpoints)"
        ],
        "summary": "Query IoCs loaded on manager and currently pushed to endpoints.\n\t\t\t\tQuery parameters can be used to restrict the search. Search criteria are\n\t\t\t\tORed together.",
        "parameters": [
          {
            "name": "uuid",
            "in": "query",
            "description": "Filter by uuid",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "guuid",
            "in": "query",
            "description": "Filter by group uuid\n\t\t\t\t\t(used to group IoCs, from the same event for example)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "source",
            "in": "query",
            "description": "Filter by source",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "value",
            "in": "query",
            "description": "Filter by value",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by type",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "guuid": "871c086e-f3c7-5d12-76e6-7e109d30d648",
                      "source": "XyzTIProvider",
                      "type": "domain",
                      "uuid": "e7b3aefe-f0ff-1861-55a2-bf6e693e1a06",
                      "value": "some.random.domain"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "IoC Management (control IoCs pushed on Endpoints)"
        ],
        "summary": "Add IoCs to be pushed on endpoints for detection",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "Item": {
                      "type": "object"
                    },
                    "guuid": {
                      "type": "string"
                    },
                    "source": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "uuid": {
                      "type": "string"
                    },
                    "value": {
                      "type": "string"
                    }
                  }
                }
              },
              "example": [
                {
                  "uuid": "e7b3aefe-f0ff-1861-55a2-bf6e693e1a06",
                  "guuid": "871c086e-f3c7-5d12-76e6-7e109d30d648",
                  "source": "XyzTIProvider",
                  "value": "some.random.domain",
                  "type": "domain"
                }
              ]
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "guuid": "871c086e-f3c7-5d12-76e6-7e109d30d648",
                      "source": "XyzTIProvider",
                      "type": "domain",
                      "uuid": "e7b3aefe-f0ff-1861-55a2-bf6e693e1a06",
                      "value": "some.random.domain"
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "IoC Management (control IoCs pushed on Endpoints)"
        ],
        "summary": "Delete IoCs from manager, modulo a synchronization delay, endpoints should \n\t\t\tstop using those for detection. Query parameters can be used to select IoCs to delete.\n\t\t\tDeletion criteria are ANDed together.",
        "parameters": [
          {
            "name": "uuid",
            "in": "query",
            "description": "Filter by uuid",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "guuid",
            "in": "query",
            "description": "Filter by group uuid\n\t\t\t\t\t(used to group IoCs, from the same event for example)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "source",
            "in": "query",
            "description": "Filter by source",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "value",
            "in": "query",
            "description": "Filter by value",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by type",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": null,
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/rules": {
      "get": {
        "tags": [
          "Rules Management"
        ],
        "summary": "Get rules loaded on endpoints",
        "parameters": [
          {
            "name": "name",
            "in": "query",
            "description": "Regex matching the names of the rules to retrieve",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filters",
            "in": "query",
            "description": "Show only filters (rules used to filter-in logs)",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Actions": [
                        "memdump",
                        "kill"
                      ],
                      "Condition": "$foo or $bar",
                      "Matches": [
                        "$foo: Image ~= 'C:\\\\Malware.exe'",
                        "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                      ],
                      "Meta": {
                        "Computers": null,
                        "Criticality": 10,
                        "Disable": false,
                        "Events": {
                          "Microsoft-Windows-Sysmon/Operational": [
                            11,
                            23,
                            26
                          ]
                        },
                        "Filter": false,
                        "Schema": "2.0.0"
                      },
                      "Name": "TestRule",
                      "Tags": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Rules Management"
        ],
        "summary": "Add or modify a rule",
        "parameters": [
          {
            "name": "update",
            "in": "query",
            "description": "Update rule if already existing",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Rule to add to the manager",
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "Actions": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "Condition": {
                      "type": "string"
                    },
                    "Matches": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "Meta": {
                      "type": "object",
                      "properties": {
                        "ATTACK": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "": {
                                "type": "string"
                              },
                              "ID": {
                                "type": "string"
                              },
                              "Reference": {
                                "type": "string"
                              },
                              "Tactic": {
                                "type": "string"
                              }
                            }
                          }
                        },
                        "Computers": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "Criticality": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "Disable": {
                          "type": "boolean"
                        },
                        "Events": {
                          "type": "object",
                          "properties": {
                            "key(string)": {
                              "type": "array",
                              "items": {
                                "type": "integer",
                                "format": "int64"
                              }
                            }
                          }
                        },
                        "Filter": {
                          "type": "boolean"
                        },
                        "Schema": {
                          "type": "object",
                          "properties": {
                            "Major": {
                              "type": "integer",
                              "format": "int64"
                            },
                            "Minor": {
                              "type": "integer",
                              "format": "int64"
                            },
                            "Patch": {
                              "type": "integer",
                              "format": "int64"
                            }
                          }
                        }
                      }
                    },
                    "Name": {
                      "type": "string"
                    },
                    "Tags": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              },
              "example": [
                {
                  "Name": "TestRule",
                  "Tags": null,
                  "Meta": {
                    "Events": {
                      "Microsoft-Windows-Sysmon/Operational": [
                        11,
                        23,
                        26
                      ]
                    },
                    "Computers": null,
                    "Criticality": 10,
                    "Disable": false,
                    "Filter": false,
                    "Schema": "2.0.0"
                  },
                  "Matches": [
                    "$foo: Image ~= 'C:\\\\Malware.exe'",
                    "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                  ],
                  "Condition": "$foo or $bar",
                  "Actions": [
                    "memdump",
                    "kill"
                  ]
                }
              ]
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Actions": [
                        "memdump",
                        "kill"
                      ],
                      "Condition": "$foo or $bar",
                      "Matches": [
                        "$foo: Image ~= 'C:\\\\Malware.exe'",
                        "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                      ],
                      "Meta": {
                        "Computers": null,
                        "Criticality": 10,
                        "Disable": false,
                        "Events": {
                          "Microsoft-Windows-Sysmon/Operational": [
                            11,
                            23,
                            26
                          ]
                        },
                        "Filter": false,
                        "Schema": "2.0.0"
                      },
                      "Name": "TestRule",
                      "Tags": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Rules Management"
        ],
        "summary": "Delete rules from manager",
        "parameters": [
          {
            "name": "name",
            "in": "query",
            "description": "Name of the rule to delete. To avoid mistakes, this\n\t\t\t\tparameter cannot be a regex.",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "Actions": [
                        "memdump",
                        "kill"
                      ],
                      "Condition": "$foo or $bar",
                      "Matches": [
                        "$foo: Image ~= 'C:\\\\Malware.exe'",
                        "$bar: TargetFilename ~= 'C:\\\\config.txt'"
                      ],
                      "Meta": {
                        "Computers": null,
                        "Criticality": 10,
                        "Disable": false,
                        "Events": {
                          "Microsoft-Windows-Sysmon/Operational": [
                            11,
                            23,
                            26
                          ]
                        },
                        "Filter": false,
                        "Schema": "2.0.0"
                      },
                      "Name": "TestRule",
                      "Tags": null
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/stats": {
      "get": {
        "tags": [
          "Statistics about the manager"
        ],
        "summary": "Get statistics",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "endpoint-count": 1,
                    "rule-count": 0
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/users": {
      "get": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "List all users",
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": [
                    {
                      "description": "",
                      "group": "",
                      "identifier": "test",
                      "key": "plM6aQxHK74KL4MGlHL8OmYgRHiofhuKdid0PRYX7fTi6OrfQfmVUOOjhlnYBPCX",
                      "uuid": ""
                    }
                  ],
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Create a new user with identifier",
        "parameters": [
          {
            "name": "identifier",
            "in": "query",
            "description": "identifier query parameter",
            "required": true,
            "allowEmptyValue": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "",
                    "group": "",
                    "identifier": "TestAdminUser",
                    "key": "xkTKBxE6TgXPvszVUxCwmxwPE2BILBq3WNt1ex8UOooGpFfe9Ud8pFll1kURwV90",
                    "uuid": "54f050b8-6648-9aee-a2f4-23d51f592bee"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Create a new user from POST data",
        "requestBody": {
          "description": "Data to create the user with. Fields uuid and key if empty will be generated.",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "Item": {
                    "type": "object"
                  },
                  "description": {
                    "type": "string"
                  },
                  "group": {
                    "type": "string"
                  },
                  "identifier": {
                    "type": "string"
                  },
                  "key": {
                    "type": "string"
                  },
                  "uuid": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "uuid": "ce3818bd-99d3-3571-6235-56fb9f0ed01f",
                "identifier": "SecondTestAdmin",
                "key": "ChangeMe",
                "group": "CSIRT",
                "description": "Second admin user"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "Second admin user",
                    "group": "CSIRT",
                    "identifier": "SecondTestAdmin",
                    "key": "ChangeMe",
                    "uuid": "ce3818bd-99d3-3571-6235-56fb9f0ed01f"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    },
    "/users/{uuid}": {
      "post": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Modify existing admin API user",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "newkey",
            "in": "query",
            "description": "Generate a new random key for user",
            "required": false,
            "allowEmptyValue": true,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "requestBody": {
          "description": "Data to update user with",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "Item": {
                    "type": "object"
                  },
                  "description": {
                    "type": "string"
                  },
                  "group": {
                    "type": "string"
                  },
                  "identifier": {
                    "type": "string"
                  },
                  "key": {
                    "type": "string"
                  },
                  "uuid": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "uuid": "",
                "identifier": "",
                "key": "NewWeakKey",
                "group": "SOC",
                "description": "Second admin user changed"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "Second admin user changed",
                    "group": "SOC",
                    "identifier": "SecondTestAdmin",
                    "key": "NewWeakKey",
                    "uuid": "ce3818bd-99d3-3571-6235-56fb9f0ed01f"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Admin API User's Management"
        ],
        "summary": "Delete an existing admin API user",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "uuid path parameter",
            "required": true,
            "allowEmptyValue": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "HTTP 200 response",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "description": "Second admin user changed",
                    "group": "SOC",
                    "identifier": "SecondTestAdmin",
                    "key": "NewWeakKey",
                    "uuid": "ce3818bd-99d3-3571-6235-56fb9f0ed01f"
                  },
                  "error": "",
                  "message": "OK"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "name": "X-Api-Key",
        "in": "header"
      }
    }
  },
  "security": [
    {
      "ApiKeyAuth": []
    }
  ]
}


```

`doc/apis.md`:

```md


# Table of Contents
* [EDR statistics](#EDR statistics)
* [Rule Management Endpoints](#Rule-Management-Endpoints)
	* [List rules loaded in the EDR](#List-rules-loaded-in-the-EDR)
	* [Deleting rule](#Deleting-rule)
	* [Adding a new rule](#Adding-a-new-rule)
	* [Save Rules](#Save-Rules)
	* [Reloading rules](#Reloading-rules)
* [Endpoint Management](#Endpoint-Management)
	* [List all endpoints](#List-all-endpoints)
	* [Get a single endpoint](#Get-a-single-endpoint)
	* [Adding a new endpoint](#Adding-a-new-endpoint)
	* [Deleting an endpoint](#Deleting-an-endpoint)
* [Executing command on endpoint](#Executing-command-on-endpoint)
	* [Getting command information](#Getting-command-information)
	* [Getting a specific command field information](#Getting-a-specific-command-field-information)
	* [Executing a command on endpoint](#Executing-a-command-on-endpoint)
		* [The command we want to execute](#The-command-we-want-to-execute)
		* [Pushing the command on the endpoint](#Pushing-the-command-on-the-endpoint)
		* [Getting the result](#Getting-the-result)
* [Endpoint logs and alerts](#Endpoint-logs-and-alerts)
	* [Getting endpoint alerts](#Getting-endpoint-alerts)
	* [Getting endpoint logs](#Getting-endpoint-logs)
* [Endpoint artifacts](#Endpoint-artifacts)
	* [Listing available endpoint artifacts](#Listing-available-endpoint-artifacts)
	* [Downloading a given artifact](#Downloading-a-given-artifact)
* [Endpoint reports](#Endpoint-reports)
	* [All endpoint reports](#All-endpoint-reports)
	* [Getting a single endpoint report](#Getting-a-single-endpoint-report)
	* [Deleting an endpoint report](#Deleting-an-endpoint-report)

# EDR statistics

🟢 **GET** `/stats`

**Description:** Used to retrieve basic statistics about the EDR manager

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/stats"
```

**Response:**
```json
{
  "data": {
    "endpoint-count": 1,
    "rule-count": 133
  },
  "message": "OK",
  "error": ""
}
```

# Rule Management Endpoints

## List rules loaded in the EDR

🟢 **GET** `/rules?name=REGEXP`
2021-07-06T17:18:42.835802162Z
**Description:** This endpoint is usde to retrive rules loaded in the EDR manager (also deployed on all the endpoints connected).

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/rules?name=HighlyPol.*"
```

**Response:**
```json
{
  "data": [
    {
      "Name": "HighlyPolymorphicCode",
      "Tags": [
        "WHIDS"
      ],
      "Meta": {
        "EventIDs": [
          1
        ],
        "Channels": [
          "Microsoft-Windows-Sysmon/Operational"
        ],
        "Computers": [],
        "ATTACK": [
          {
            "ID": "T1093",
            "Tactic": "defense-evasion",
            "Reference": "https://attack.mitre.org/techniques/T1093"
          }
        ],
        "Criticality": 10,
        "Disable": false,
        "Filter": false
      },
      "Matches": [
        "$lowboundproc: ProcessIntegrity >= '50'",
        "$lowboundpproc: ParentProcessIntegrity >= '50'"
      ],
      "Condition": "$lowboundproc or $lowboundpproc"
    }
  ],
  "message": "OK",
  "error": ""
}
```

## Deleting rule

🟢 **DELETE** `/rules?name=RULE_NAME`

**Description:** Used to delete a rule from the EDR manager. The engine needs to be reloaded after deletion (c.f. [reloading rules](reloading-rules))

**Request:**
```bash
curl -skH "Api-key: admin" -X DELETE "https://localhost:8001/rules?name=HighlyPolymorphicCode"
```

**Response:**
```json
{
  "data": null,
  "message": "Rules updated succesfully, engine needs to be reloaded",
  "error": ""
}
```


## Adding a new rule

🟢 **POST** `/rules?update=[1|0|t|f|true|false]`

**Description:** Used to add a new rule to the manager or update an existing rule. In case of update the rule engine needs to be reloaded (c.f. [reloading rules](reloading-rules)).

Params:
* **update:** boolean value to force update if rule already exists

**Request:**
```bash
# Let's look at the rule definition
jq . /tmp/rule.gen
```

**Response:**
```json
{
  "Name": "HighlyPolymorphicCode",
  "Tags": [
    "WHIDS"
  ],
  "Meta": {
    "EventIDs": [
      1
    ],
    "Channels": [
      "Microsoft-Windows-Sysmon/Operational"
    ],
    "Computers": [],
    "ATTACK": [
      {
        "ID": "T1093",
        "Tactic": "defense-evasion",
        "Reference": "https://attack.mitre.org/techniques/T1093"
      }
    ],
    "Criticality": 10,
    "Disable": false,
    "Filter": false
  },
  "Matches": [
    "$lowboundproc: ProcessIntegrity >= '50'",
    "$lowboundpproc: ParentProcessIntegrity >= '50'"
  ],
  "Condition": "$lowboundproc or $lowboundpproc"
}
```

We try to create a new rule from the file shown above

**Request:**
```bash
curl -d @/tmp/rule.gen -skH "Api-key: admin" "https://localhost:8001/rules"
```

**Response:**
```json
{
  "data": null,
  "message": "NOK",
  "error": "Error loading rule: Rule \"HighlyPolymorphicCode\" already exists"
}
```

If we want the rule to be overwritten, we need to force update

**Request:**
```bash
curl -d @/tmp/rule.gen -skH "Api-key: admin" "https://localhost:8001/rules?update=true"
```

**Response:**
```json
{
  "data": null,
  "message": "Rules updated succesfully, engine needs to be reloaded",
  "error": ""
}
```

## Save Rules

🟢 **GET** `/rules/save`

**Description:** endpoint to use to save rules.

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/rules/save"
```

**Response:**
```json
{
  "data": null,
  "message": "Rules saved succesfully on disk",
  "error": ""
}
```

## Reloading rules

🟢 **GET** `/rules/reload`

**Description:** API endpoint used to reload the rule engine.

```bash
curl -skH "Api-key: admin" "https://localhost:8001/rules/reload"
```
```json
{
  "data": {
    "endpoint-count": 1,
    "rule-count": 132
  },
  "message": "OK",
  "error": ""
}
```

# Endpoint Management

## List all endpoints

🟢 **GET** `/endpoints`

**Description:** API endpoint to use to list all the available endpoints configured to communicate with the manager.

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/endpoints"
```

**Response:**
```json
{
  "data": [
    {
      "uuid": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
      "hostname": "DESKTOP-LLOYD",
      "ip": "192.168.42.42",
      "key": "ztBdB6XGl81Vx957YmVXjmh1SfnqliRMeoa7zYewtimXCGCNoR6O2Nfw9YjVD8KX",
      "last-connection": "2021-03-02T22:42:35.664304855+01:00"
    }
  ],
  "message": "OK",
  "error": ""
}
```

## Get a single endpoint

🟢 **GET** `/endpoints/{ENDPOINT_UUID}`

**Description:** endpoint used to list information about a single endpoint.

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef"
```

**Response:**
```json
{
  "data": {
    "uuid": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
    "hostname": "DESKTOP-LLOYD",
    "ip": "192.168.0.93",
    "key": "ztBdB6XGl81Vx957YmVXjmh1SfnqliRMeoa7zYewtimXCGCNoR6O2Nfw9YjVD8KX",
    "last-connection": "2021-03-02T16:39:13.64023147+01:00"
  },
  "message": "OK",
  "error": ""
}
```

## Adding a new endpoint

🟢 **PUT** `/endpoints`

**Description:** adds a **new endpoint** to the EDR. The endpoint will also be added to
the configuration of the manager and committed to disk. You can now configure a new
EDR agent on any endpoint.

**Request:**
```bash
curl -skH "Api-key: admin" -X PUT "https://localhost:8001/endpoints"
```

**Response:**
```json
{
  "data": {
    "uuid": "4a796766-bb17-2e35-64fb-2fb836bf04d0",
    "hostname": "",
    "ip": "",
    "key": "x5l68KpJwk6v5pc1wyJkgBWjTCDRzIGCn9aXapcOjVoWCgKFEh3KEffJRDdkIgNi",
    "last-connection": "0001-01-01T00:00:00Z"
  },
  "message": "OK",
  "error": ""
}
```

## Deleting an endpoint

🟢 **DELETE** `/endpoints/{ENDPOINT_UUID}`

**Description:** deletes an endpoint from the EDR. This change is immediate
and persistent. Thus if an EDR agent is still configured using these
credentials it will not be able to communicate with the manager any longer.

**Request:**
```bash
curl -skH "Api-key: admin" -X DELETE "https://localhost:8001/endpoints/49e63832-cb8e-e2ee-04d5-115e7a85b62f"
```
**Response:** information of the **deleted** endpoint
```json
{ 
  "data": {
    "uuid": "49e63832-cb8e-e2ee-04d5-115e7a85b62f",
    "hostname": "",
    "ip": "",
    "key": "FysqI9gCMT9C9eQgslsOfuW567Ba7X4xWfOe21Dbu7WBKxs1F5sbfXeSH033sj9v",
    "last-connection": "0001-01-01T00:00:00Z"
  },
  "message": "OK",
  "error": ""
}
```

# Executing command on endpoint

## Getting command information

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/command`

**Description:** this API endpoint is used to get information about a pending or executed 
command. In order to make sure the command has been ran, a specific flag in the response
can be checked.

**Request:**
```bash
# HTTP GET
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/command"
```

**Response:**
```json
{
  "data": {
    "uuid": "f3e15c2e-c46e-082d-53a3-fd7621453505",
    "name": "cmd.exe",
    "args": [
      "cmd.exe",
      "/c",
      "dir",
      "C:\\"
    ],
    "drop": [],
    "fetch": {},
    # stdout, base64 encoded
    "stdout": "IFZvbHVtZSBpbiBkcml2ZSBDIGhhcyBubyBsYWJlbC4NCiBWb2x1bWUgU2VyaWFsIE51bWJlciBpcyA5Mjc0LTcxQzENCg0KIERpcmVjdG9yeSBvZiBDOlwNCg0KMDMvMDIvMjAyMSAgMDg6MjggQU0gICAgPERJUj4gICAgICAgICAgUHJvZ3JhbSBGaWxlcw0KMDEvMTEvMjAyMSAgMDU6MDYgUE0gICAgPERJUj4gICAgICAgICAgUHJvZ3JhbSBGaWxlcyAoeDg2KQ0KMDYvMTIvMjAxOSAgMTA6NTEgQU0gICAgPERJUj4gICAgICAgICAgVXNlcnMNCjAzLzAzLzIwMjEgIDAyOjA1IFBNICAgIDxESVI+ICAgICAgICAgIFdpbmRvd3MNCiAgICAgICAgICAgICAgIDAgRmlsZShzKSAgICAgICAgICAgICAgMCBieXRlcw0KICAgICAgICAgICAgICAgNCBEaXIocykgIDE0LDY1Niw5MzcsOTg0IGJ5dGVzIGZyZWUNCg==",
    "stderr": null,
    "error": "",
    # true if the endpoint received the command
    "sent": true,
    "background": false,
    # flag to check to make sure command completed
    "completed": true,
    "timeout": 0,
    # time at which the command has been received by the endpoint
    "sent-time": "2021-03-03T14:32:40.939939135+01:00"
  },
  "message": "OK",
  "error": ""
}
```

## Getting a specific command field information

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/command/{FIELD}`

**Description:** this endpoint is used to retrieve only one field of the command. This way it
allows saving bandwith for polling patterns. Not all fields are accessible through that endpoint.

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/command/completed"
```

**Response:** the data field of the response contains only the value of the queried field
```json
{
  "data": true,
  "message": "OK",
  "error": ""
}
```

## Executing a command on endpoint

🟢 **POST** `/endpoints/{ENDPOINT_UUID}/command`

**Description:** this endpoint can be used to ask the endpoint to **execute a command** or
**fetch files from the endpoint**. Files can also be dropped prior to command execution, this
way it is possible to execute binaries or scripts not initially present on the endpoint. Such
dropped files are removed post command execution.

It is worth mentionning that it is the EDR agent installed on the endpoint which is 
responsible for checking commands to execute. So no connection from the EDR manager 
to the agent is made. 

**Post Data:**

  ```json
  {
    # command line to execute
    "command-line": "cmd /c dir C:\\\\Windows\\\\System32",
    # files to collect (post command execution) from the endpoint
    # it can be used to retrieve command's output file or collect
    # artifacts
    "fetch-files": [
      "C:\\\\Windows\\\\System32\\\\malware.exe"
    ],
    # files to drop on the endpoint (prior to execution)
    # it can be used to execute script, exe not initially
    # present on the endpoint.
    # the paths specified here must be local to the manager
    "drop-files": [
      ""
    ],
    # timeout for the command, if 0 or empty no timeout is applied
    "timeout": 10 ,
  }
  ```

### The command we want to execute

```bash
jq . /tmp/command.json
```
```json
{
  "command-line": "cmd.exe /c dir C:\\\\"
}
```

### Pushing the command on the endpoint

**Request:**
```bash
# POST command
curl -skH "Api-key: admin" -d @/tmp/command.json "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/command"
```
**Response:**
```json
{
  "data": {
    "uuid": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
    "hostname": "DESKTOP-LLOYD",
    "ip": "192.168.0.93",
    "key": "ztBdB6XGl81Vx957YmVXjmh1SfnqliRMeoa7zYewtimXCGCNoR6O2Nfw9YjVD8KX",
    "command": {
      "uuid": "f3e15c2e-c46e-082d-53a3-fd7621453505",
      "name": "cmd.exe",
      "args": [
        "/c",
        "dir",
        "C:\\"
      ],
      "drop": [],
      "fetch": {},
      "stdout": null,
      "stderr": null,
      "error": "",
      "sent": false,
      "background": false,
      "completed": false,
      "timeout": 0,
      "sent-time": "0001-01-01T00:00:00Z"
    },
    "last-connection": "2021-03-03T14:32:36.460166243+01:00"
  },
  "message": "OK",
  "error": ""
}
```

### Getting the result

**Request:**
```bash
# GET
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/command"
```

**Response:**
```json
{
  "data": {
    "uuid": "f3e15c2e-c46e-082d-53a3-fd7621453505",
    "name": "cmd.exe",
    "args": [
      "cmd.exe",
      "/c",
      "dir",
      "C:\\"
    ],
    "drop": [],
    "fetch": {},
    # stdout, base64 encoded
    "stdout": "IFZvbHVtZSBpbiBkcml2ZSBDIGhhcyBubyBsYWJlbC4NCiBWb2x1bWUgU2VyaWFsIE51bWJlciBpcyA5Mjc0LTcxQzENCg0KIERpcmVjdG9yeSBvZiBDOlwNCg0KMDMvMDIvMjAyMSAgMDg6MjggQU0gICAgPERJUj4gICAgICAgICAgUHJvZ3JhbSBGaWxlcw0KMDEvMTEvMjAyMSAgMDU6MDYgUE0gICAgPERJUj4gICAgICAgICAgUHJvZ3JhbSBGaWxlcyAoeDg2KQ0KMDYvMTIvMjAxOSAgMTA6NTEgQU0gICAgPERJUj4gICAgICAgICAgVXNlcnMNCjAzLzAzLzIwMjEgIDAyOjA1IFBNICAgIDxESVI+ICAgICAgICAgIFdpbmRvd3MNCiAgICAgICAgICAgICAgIDAgRmlsZShzKSAgICAgICAgICAgICAgMCBieXRlcw0KICAgICAgICAgICAgICAgNCBEaXIocykgIDE0LDY1Niw5MzcsOTg0IGJ5dGVzIGZyZWUNCg==",
    "stderr": null,
    "error": "",
    # true if the endpoint received the command
    "sent": true,
    "background": false,
    # flag to check to make sure command completed
    "completed": true,
    "timeout": 0,
    # time at which the command has been received by the endpoint
    "sent-time": "2021-03-03T14:32:40.939939135+01:00"
  },
  "message": "OK",
  "error": ""
}
```
As stdout may contain binary data it is **base64 encoded**, after decoding we get
```txt
 Volume in drive C has no label.
 Volume Serial Number is 9274-71C1

 Directory of C:\

03/02/2021  08:28 AM    <DIR>          Program Files
01/11/2021  05:06 PM    <DIR>          Program Files (x86)
06/12/2019  10:51 AM    <DIR>          Users
03/03/2021  02:05 PM    <DIR>          Windows
               0 File(s)              0 bytes
               4 Dir(s)  14,656,937,984 bytes free
```

# Endpoint logs and alerts

## Getting endpoint alerts

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/alerts`

**Description:** API endpoint to use in order to retrieve alerts collected from a given endpoint.

**Requirement:** endpoint logging must be configured on the manager (cf. [manager config](configuration.md#manager))

**Params:**
  * **start:** RFC 3339 formatted timestamp used as **starting point** for getting alerts
  * **stop:** RFC 3339 formatted timestamp used as **stopping point** for getting alerts
  * **pivot:** RFC 3339 formatted timestamp used as pivot point for retrieving logs
  * **delta:** duration string used for getting alerts around pivot point. Specifying
  a pivot and a delta will search alerts from `pivot-delta` to `pivot+delta`

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/alerts"
```

**Response:**
```json
{
  "data": [
    {
      "Event": {
        "EventData": {
          "Ancestors": "System|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System32\\wininit.exe|C:\\Windows\\System32\\services.exe",
          "CommandLine": "\"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeClickToRun.exe\" /service",
          "Company": "Microsoft Corporation",
          "CurrentDirectory": "C:\\Windows\\system32\\",
          "Description": "Microsoft Office Click-to-Run (SxS)",
          "FileVersion": "16.0.13628.20346",
          "Hashes": "SHA1=6A32BCEA6106E9151A5BDB4B7A8AA31C78C8C5C7,MD5=2B2DC8D683ACDC977F9E4109F0BBE0D9,SHA256=C779EA16CE7AD786AA83455F2A5A46A964ADE47FB8CDA5537CFE116B14ECACD3,IMPHASH=4606D7A079BA8D6E7F9540975D7E79FF",
          "Image": "C:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\OfficeClickToRun.exe",
          "ImageSize": "8905608",
          "IntegrityLevel": "System",
          "LogonGuid": "{515cd0d1-00f4-6040-e703-000000000000}",
          "LogonId": "0x3e7",
          "OriginalFileName": "OfficeClickToRun.exe",
          "ParentCommandLine": "C:\\Windows\\system32\\services.exe",
          "ParentImage": "C:\\Windows\\System32\\services.exe",
          "ParentIntegrityLevel": "System",
          "ParentProcessGuid": "{515cd0d1-00f4-6040-0b00-000000005a00}",
          "ParentProcessId": "640",
          "ParentServices": "N/A",
          "ParentUser": "NT AUTHORITY\\SYSTEM",
          "ProcessGuid": "{515cd0d1-00f6-6040-4400-000000005a00}",
          "ProcessId": "2796",
          "Product": "Microsoft Office",
          "RuleName": "-",
          "Services": "ClickToRunSvc",
          "TerminalSessionId": "0",
          "User": "NT AUTHORITY\\SYSTEM",
          "UtcTime": "2021-03-03 21:34:46.769"
        },
        "GeneInfo": {
          "Criticality": 10,
          "Signature": [
            "UnknownServices"
          ]
        },
        "System": {
          "Channel": "Microsoft-Windows-Sysmon/Operational",
          "Computer": "DESKTOP-LLOYD",
          "Correlation": {},
          "EventID": "1",
          "EventRecordID": "53336456",
          "Execution": {
            "ProcessID": "3288",
            "ThreadID": "724"
          },
          "Keywords": "0x8000000000000000",
          "Level": "4",
          "Opcode": "0",
          "Provider": {
            "Guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
            "Name": "Microsoft-Windows-Sysmon"
          },
          "Security": {
            "UserID": "S-1-5-18"
          },
          "Task": "1",
          "TimeCreated": {
            "SystemTime": "2021-03-03T21:34:51.790661600Z"
          },
          "Version": "5"
        }
      }
    },
    # [...]
  ],
  "message": "OK",
  "error": ""
}
```

## Getting endpoint logs

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/logs`

**Description:** used to retrieve logs of an endpoint. Those logs includes filtered in events as well as alerts.

**Requirement:** endpoint logging must be configured on the manager (cf. [manager config](configuration.md#manager))

Exact same behaviour as [endpoint alerts endpoint](#Getting-endpoint-alerts)

# Endpoint artifacts

## Listing available endpoint artifacts

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/artifacts`

**Description:** list the artifacts collected (following an alert) on a given endpoint.

**Params:**
  * **since:** RFC 3339 formatted timestamp used to retrieve artifact collected last updated after this date

**Request:**
```bash
curl -skH Api-key: admin https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/artifacts?since=2021-07-06T17:19:42.835802162Z
```

**Response:**
```json
{
  "data": [
    {
      "update": "2021-07-06T19:21:50.655802826Z",
      "process-guid": "515cd0d1-ab35-60e4-827c-000000004e00",
      "event-hash": "2252cc3dee2623a44f5d1644338129b9",
      "base-url": "/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/artifacts/515cd0d1-ab35-60e4-827c-000000004e00/2252cc3dee2623a44f5d1644338129b9/",
      "files": [
        "event.json.gz",
        "powershell.exe_12644_1625598794801114200.dmp.gz",
        "report.json.gz"
      ]
    }
  ],
  "message": "OK",
  "error": ""
}
```

## Downloading a given artifact

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/artifacts/{PROCESS_GUID}/{EVENT_HASH}/{FILENAME}`

**Description:** download a given artifact

**Params:**
  * **raw:** boolean telling that we want to receive the raw file 
  * **gunzip:** boolean instructing that artifact content must be gunzipped before being sent

**NB:** boolean must be in one of the following values (true, false, t, f, 0, 1)

**Request:**
```bash
curl -skH Api-key: admin https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/artifacts/515cd0d1-9064-60e4-577c-000000004e00/443884f68ad4203613ff54a80d4fba15/event.json.gz
```

**Response:**
```json
{
  "data": "H4sIAAAAAAAE/5xUW2/iRhT+K+g8tZKdnfFcfJGiyvgS6JINislW27oPXvvAWgseNDZJKOK/V2MDSbZNH5q84Jn5zu37vnOA5BGbDoLTj7joCvMRNiW2ndItBBAFef5b3VTqqc3zbN92uGFOnreoH+sS2yt8RrAgUptN0VSzukEIIO9Rc61WutiM0nqN7einZ0/+nOc3Sq3WmOcP26ro8Pw9fJlYOYw+tI/lEHJbNHsIYMCMZrPIHO+0xqaLa41lp7S5f1NieykRLIixLXW97WrVvMSZNm1XrNeowQJT22fU7fCAXrErJq88ChZMivYbmgFkk5BeU8cXJPaJTFOXsJSFNCHj2HdZGoXOmDOWiHDsENe6jcW1H0oZsjhxhOenLiUed2SYMjccu6kcc2plk9AR8jr0KeNUSEdyxmIRk5S4MUsiTjweSjdNZSoo8yIWsVTyhMk4JhENEx5xh0VSWNPb+STMJtdunFKPSof5kRhHnhCSkJhThxJOZCTGYMF0U6wQAoiC/P8Rc46R1X+ZOFRwLqQ5bDpc6brbz/AR1xDAoBGwYKZWqrnZ1RUEcBBUlBWpqF15FG1JqtJGlzCbEHL5P55BUwMhzwxdsOBO16u6KdaGqk/FxiQfBPEiGrBgXhhVRG9k+I4ufpDugJxuipUJ/QYztPIvcj9hfmz9l0shc61KbNv/6J58JeTSPUfSdz/EPYH7KUiPX4JmOHgOgleZHlrU54N3kvpEclsS5LZw3fKfSQdYn853eZ9Pq2pXdi+eGWYNFtzv1mcWbLDgVUmrXW9psGCBemMYy7A1xuoDE7DgVOqnxSh8WEzu7qeLL3mefckWya257cpF3dPrEIfaxLWJHFE3oF7geFe+T+BowQ02OG2WymypSNddXRbruttDQIkFWb1qim6nEYI/4KH53qin5lLgn0frLM3gANG3oml6ud7WpVatWnb2acvZ2b7dqObD3RZ1YTZHsTZrR222u64fdZxkHxd3c3v26/3nhBgPREprXPePITgcrWGtTmMIwKySfsneY6l01Z85gvie4xtk8ozlziQxRZ2JMDiHMseM8pvG4oTinJgRfMT9k9KVUQF59i7mGf6Mg04+NDzebUtVGVmbi7lWj3VlWjjAzdmWrkuYJ5Z26TiFzRkS++uSlzaRSyF9b7n8WvnGlifjvTcsU1eG5U73XBx6pvs2MpvawqaeebAo2u+niRiiI41Fh5VpfPCZOYTgFfuLV+wzJgUl5HcT6DPqtlYNBCDgeDz+DQAA//8BAAD//1JaS5vGBgAA",
  "message": "OK",
  "error": ""
}
```

# Endpoint reports

## All endpoint reports

🟢 **GET** `/endpoints/reports`

**Description:** API endpoint to get EDR reports about all the endpoints connected. Reports are not persistent accross restart of the manager.

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/reports"
```

**Response:**
```json
{
  "data": {
    "03e31275-2277-d8e0-bb5f-480fac7ee4ef": {
      "identifier": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
      "alert-count": 99,
      "count-by-signature": {
        "DefenderConfigChanged": 2,
        "ExecTimestomping": 1,
        "ExecutableFileCreated": 3,
        "HeurPersistentRAT": 1,
        "HeurSpawnShell": 1,
        "NewAutorun": 8,
        "StopSvchostAccess": 71,
        "UnknownServices": 6,
        "UntrustedDriverLoaded": 4,
        "UntrustedService": 3
      },
      "signatures": [
        "DefenderConfigChanged",
        "UntrustedDriverLoaded",
        "HeurPersistentRAT",
        "NewAutorun",
        "UnknownServices",
        "HeurSpawnShell",
        "UntrustedService",
        "ExecTimestomping",
        "ExecutableFileCreated",
        "StopSvchostAccess"
      ],
      "techniques": [
        "T1014",
        "T1060",
        "T1035"
      ],
      "tactics": [
        "Defense Evasion",
        "persistence",
        "Execution"
      ],
      "signature-count": 100,
      "sum-alert-criticality": 744,
      "avg-alert-criticality": 7.51,
      "std-dev-alert-criticality": 1.05,
      "sum-rule-criticality": 747,
      "avg-signature-criticality": 7.47,
      "std-dev-signature-criticality": 1.05,
      "signature-diversity": 100,
      "count-uniq-signatures": 10,
      "signature-criticality-metric": 70,
      "alert-criticality-metric": 751,
      # aggregated metric which can be used to rank endpoints
      # between them and prioritize investigation. It is made
      # in such a way that it is relative to every environment.
      # So a given noisy machine would not have the same score
      # in a noisy and quiet environment.
      "score": 821,
      "start-time": "2021-03-03T21:34:51.3769993Z",
      "median-time": "2021-03-03T21:43:01.53481525Z",
      "stop-time": "2021-03-03T21:51:11.6926312Z"
    },
    "1829e1ac-acf6-953f-c3a8-27818820bb9f": null,
    "5949e4a8-82c3-2284-58d1-0a93a3f8ed04": null,
    "7fa7a8ab-4725-bf63-f8b3-9c72ed07f45a": null
  },
  "message": "OK",
  "error": ""
}
```

## Getting a single endpoint report

🟢 **GET** `/endpoints/{ENDPOINT_UUID}/reports`

**Description:** API endpoint to get an EDR report about a given endpoint.

**Request:**
```bash
curl -skH "Api-key: admin" "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/report"
```

**Response:**
```json
{
  "data": {
    "identifier": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
    "alert-count": 99,
    "count-by-signature": {
      "DefenderConfigChanged": 2,
      "ExecTimestomping": 1,
      "ExecutableFileCreated": 3,
      "HeurPersistentRAT": 1,
      "HeurSpawnShell": 1,
      "NewAutorun": 8,
      "StopSvchostAccess": 71,
      "UnknownServices": 6,
      "UntrustedDriverLoaded": 4,
      "UntrustedService": 3
    },
    "signatures": [
      "DefenderConfigChanged",
      "UntrustedDriverLoaded",
      "HeurPersistentRAT",
      "NewAutorun",
      "ExecutableFileCreated",
      "StopSvchostAccess",
      "UnknownServices",
      "HeurSpawnShell",
      "UntrustedService",
      "ExecTimestomping"
    ],
    "techniques": [
      "T1014",
      "T1060",
      "T1035"
    ],
    "tactics": [
      "persistence",
      "Execution",
      "Defense Evasion"
    ],
    "signature-count": 100,
    "sum-alert-criticality": 744,
    "avg-alert-criticality": 7.51,
    "std-dev-alert-criticality": 1.05,
    "sum-rule-criticality": 747,
    "avg-signature-criticality": 7.47,
    "std-dev-signature-criticality": 1.05,
    "signature-diversity": 100,
    "count-uniq-signatures": 10,
    "signature-criticality-metric": 70,
    "alert-criticality-metric": 751,
    "score": 821,
    "start-time": "2021-03-03T21:34:51.3769993Z",
    "median-time": "2021-03-03T21:43:01.53481525Z",
    "stop-time": "2021-03-03T21:51:11.6926312Z"
  },
  "message": "OK",
  "error": ""
}
```

## Deleting an endpoint report

🟢 **DELETE** `/endpoints/{ENDPOINT_UUID}/reports`

**Description:** API to delete a report for a given endpoint. A report can be deleted after an enpoint has been investigated.

**Request:**
```bash
curl -skH "Api-key: admin" -X DELETE "https://localhost:8001/endpoints/03e31275-2277-d8e0-bb5f-480fac7ee4ef/report"
```

**Response:**
```json
{
  "data": {
    "identifier": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
    "alert-count": 99,
    "count-by-signature": {
      "DefenderConfigChanged": 2,
      "ExecTimestomping": 1,
      "ExecutableFileCreated": 3,
      "HeurPersistentRAT": 1,
      "HeurSpawnShell": 1,
      "NewAutorun": 8,
      "StopSvchostAccess": 71,
      "UnknownServices": 6,
      "UntrustedDriverLoaded": 4,
      "UntrustedService": 3
    },
    "signatures": [
      "NewAutorun",
      "DefenderConfigChanged",
      "UntrustedDriverLoaded",
      "HeurPersistentRAT",
      "ExecTimestomping",
      "ExecutableFileCreated",
      "StopSvchostAccess",
      "UnknownServices",
      "HeurSpawnShell",
      "UntrustedService"
    ],
    "techniques": [
      "T1060",
      "T1035",
      "T1014"
    ],
    "tactics": [
      "Defense Evasion",
      "persistence",
      "Execution"
    ],
    "signature-count": 100,
    "sum-alert-criticality": 744,
    "avg-alert-criticality": 7.51,
    "std-dev-alert-criticality": 1.05,
    "sum-rule-criticality": 747,
    "avg-signature-criticality": 7.47,
    "std-dev-signature-criticality": 1.05,
    "signature-diversity": 100,
    "count-uniq-signatures": 10,
    "signature-criticality-metric": 70,
    "alert-criticality-metric": 751,
    "score": 821,
    "start-time": "2021-03-03T21:34:51.3769993Z",
    "median-time": "2021-03-03T21:43:01.53481525Z",
    "stop-time": "2021-03-03T21:51:11.6926312Z"
  },
  "message": "OK",
  "error": ""
}
```

```

`doc/configuration.md`:

```md
# Configuration

## WHIDS

WHIDS configuration file example

```toml
# Windows log channels to listen to. Either channel names
# can be used (i.e. Microsoft-Windows-Sysmon/Operational) or aliases
channels = ["all"]

# Dumps/forward only events above criticality threshold
# or filtered events (i.e. Gene filtering rules)
criticality-treshold = 5

# Enable enrichment hooks and dump hooks
en-hooks = true

# Enable event filtering (log filtered events, not only alerts)
en-filters = true

# Logfile used to log messages generated by the engine
logfile = "C:\\Program Files\\Whids\\Logs\\whids.log"

# Log any incoming event passing through the engine
log-all = false

# True if current host is the endpoint on which logs are generated
# Example: turn this off if running on a WEC
endpoint = true

# Forwarder configuration
[forwarder]

  # If forwarder is local (this setting equals true)
  # neither alerts nor dumps will be forwarded to manager
  local = false

  # Configure connection to the manager
  [forwarder.manager]

    # Protocol to use to connect to manager (http or https)
    proto = "https"

    # Hostname or IP of the manager
    host = "192.168.56.1"

    # Port at which endpoint API is running on manager server
    port = 8000

    # Endpoint UUID configured on manager used to authenticate this endpoint
    endpoint-uuid = "03e31275-2277-d8e0-bb5f-480fac7ee4ef"

    # Endpoint key configured on manager used to authenticate this endpoint
    endpoint-key = "ztBdB6XGl81Vx957YmVXjmh1SfnqliRMeoa7zYewtimXCGCNoR6O2Nfw9YjVD8KX"

    # Key configured on manager, used to authenticate server on this endpoint
    # This settings does not protect from MITM, so configuring server
    # certificate pinning is recommended.
    server-key = ""

    # Configure manager certificate pinning
    # Put here the manager's certificate fingerprint
    server-fingerprint = ""

    # Allow unsafe HTTPS connection
    unsafe = true

    # Maximum allowed upload size
    max-upload-size = 104857600

  # Forwarder's logging configuration
  [forwarder.logging]

    # Directory used to store logs
    dir = "C:\\Program Files\\Whids\\Logs\\Alerts"

    # Logfile rotation interval
    rotation-interval = "1h0m0s"

# Sysmon related settings
[sysmon]

  # Path to Sysmon binary
  bin = "C:\\Windows\\Sysmon64.exe"

  # Path to Sysmon Archive directory
  archive-directory = "C:\\Sysmon\\"

  # Delete files older than 5min archived by Sysmon
  clean-archived = true

# Dump related settings
[dump]

  # Dump mode (choices: file, registry, memory)
  # Modes can be combined together, separated by |
  mode = "file|registry"

  # Directory used to store dumps
  dir = "C:\\Program Files\\Whids\\Dumps"

  # Dumps only when event criticality is above this threshold
  treshold = 8

  # Maximum number of dumps per process
  max-dumps = 4

  # Enable dumps compression
  compression = true

  # Dumps untracked process. Untracked processes are missing
  # enrichment information and may generate unwanted dumps
  dump-untracked = false

# Gene rules related settings
# Gene repo: https://github.com/0xrawsec/gene
# Gene rules repo: https://github.com/0xrawsec/gene-rules
[rules]

  # Path to Gene rules database
  rules-db = "C:\\Program Files\\Whids\\Database\\Rules"

  # Path to Gene rules containers
  # (c.f. Gene documentation)
  containers-db = "C:\\Program Files\\Whids\\Database\\Containers"

  # Update interval at which rules should be pulled from manager
  # NB: only applies if a manager server is configured
  update-interval = "1m0s"
```

## Manager

Manager configuration example

```toml
# Gene rule directory.
# See: https://github.com/0xrawsec/gene-rules
rules-dir = "./data/rules"

# Directory where to dump artifacts collected on hosts
dump-dir = "./data/dumps"

# Gene rules' containers directory
# (c.f. Gene documentation https://github.com/0xrawsec/gene)
containers-dir = "./data/containers"

# Settings to configure administrative API (not supposed to be reachable by endpoints)
[admin-api]

  # Hostname or IP address where the API should listen to
  host = "localhost"

  # Port used by the API
  port = 8001

  [[admin-api.users]]
    identifier = "admin"
    key = "admin"

# Settings to configure API used by endpoints
[endpoint-api]

  # Hostname or IP where the API should listen to
  host = ""

  # Port used by the API
  port = 8000

  # Server key used to do basic authentication of the server on clients.
  # Configure certificate pinning on client offers better security.
  server-key = ""

  [[endpoint-api.endpoints]]

    # Unique client identifier
    uuid = "03e31275-2277-d8e0-bb5f-480fac7ee4ef"
    # API key used to authenticate the client
    key = "ztBdB6XGl81Vx957YmVXjmh1SfnqliRMeoa7zYewtimXCGCNoR6O2Nfw9YjVD8KX"

  # Example of another endpoint configured
  [[endpoint-api.endpoints]]

    # Unique client identifier
    uuid = "03e31275-2277-d8e0-bb5f-480fac7ee4eb"
    # API key used to authenticate the client
    key = "ztBdB6XGl81Vx957YmVXjmh1SfnqliRMeoa7zYewtimXCGCNoR6O2Nfw9YjVD8Ky"

# Logging settings
[logging]

  # Root directory where logfiles are stored
  root = "./data/logs"

  # Logfile name (relative to root) used to store logs.
  logfile = "forwarded"

  # Enable endpoint logging.In addition to log in the main log file,
  # it will store logs individually for each endpoints.
  enable-endpoint-logging = true
    
  verbose-http = false

# TLS settings. Leave empty, not to use TLS
[tls]

  # Path to the certificate file to use for TLS connections
  cert = "cert.pem"

  # Path to the key to use for TLS connection
  key = "key.pem"

# MISP settings. Use this setting to push IOCs as containers on endpoints.
[misp]

  # HTTP protocol to use (http or https)
  protocol = ""

  # Hostname or IP address of MISP server
  host = ""

  # MISP API key
  api-key = ""
```
```

`doc/edr-commands.md`:

```md
# EDR commands documentation

This page documents the EDR specific commands endpoints can run. In addition to all the commands documented\
below, **any** other binary present on the endpoint can be executed, whether by absolute path or without if\
the binary is present in **PATH** environment variable. To understand how to send commands to endpoints and\
how to receive results, please take a look at the [**OpenAPI** documentation](https://validator.swagger.io/?url=https://raw.githubusercontent.com/0xrawsec/whids/master/doc/admin.openapi.json).

**IMPORTANT:** paths in command examples may contain escape sequences (Windows paths for instances).\
When such path is used inside JSON, escape characters needs to be escaped twice (to be JSON valid).\
For instance if one wants to execute `tasklist` command from an absolute path the command would have to\
be encoded as such `C:\\\\Windows\\\\System32\\\\tasklist.exe`


## Index
* [contain](#contain)
* [uncontain](#uncontain)
* [osquery](#osquery)
* [sysmon](#sysmon)
* [terminate](#terminate)
* [hash](#hash)
* [rexhash](#rexhash)
* [stat](#stat)
* [ls](#ls)
* [walk](#walk)
* [find](#find)
* [report](#report)
* [processes](#processes)
* [modules](#modules)
* [drivers](#drivers)

## contain

**Description:** Isolate host at network level

**Help:** `contain`


## uncontain

**Description:** Uncontain host (i.e. remove network isolation)

**Help:** `uncontain`


## osquery

**Description:** Alias to `osqueryi --json -A`

**Help:** `osquery OSQUERY_TABLE`

**Example:** `osquery processes`


## sysmon

**Description:** Alias to the sysmon binary deployed by the EDR. See sysmon binary command line switches for all available options.

**Help:** `sysmon [OPTIONS]`

**Example:** `sysmon -h`


## terminate

**Description:** Terminate a process given its PID

**Help:** `terminate PID`

**Example:** `terminate 1337`


## hash

**Description:** Hash a file

**Help:** `hash FILE`

**Example:** `hash C:\\Windows\\System32\\cmd.exe`


## rexhash

**Description:** Recursively find files matching pattern and hashes them

**Help:** `rexhash DIRECTORY PATTERN`

**Example:** `rexhash C:\\Windows\\System32 cmd\\.exe`


## stat

**Description:** Stat a file or a directory

**Help:** `stat FILE|DIRECTORY`

**Example:** `stat C:\\Windows\\System32\\cmd.exe`


## ls

**Description:** List a directory

**Help:** `ls DIRECTORY`

**Example:** `ls C:\\Windows\\`


## walk

**Description:** Recursively list a directory

**Help:** `walk DIRECTORY`

**Example:** `walk C:\\Windows\\System32`


## find

**Description:** Recursively find a pattern in filename

**Help:** `find DIRECTORY REGEX_PATTERN`

**Example:** `find C:\\Windows\\System32 cmd.*\.exe`


## report

**Description:** Generate a full IR ready report

**Help:** `report`


## processes

**Description:** Retrieve the full list of processes running (monitored from Sysmon logs)

**Help:** `processes`


## modules

**Description:** Retrieve the full list of modules ever loaded since boot (monitored from Sysmon logs)

**Help:** `modules`


## drivers

**Description:** Retrieve the full list of drivers ever loaded since boot (monitored from Sysmon logs)

**Help:** `drivers`



```

`doc/etw-providers.md`:

```md
# ETW Providers

This page contains a non-exhaustive list of ETW providers. Dependending on the version of Windows you are running you might have more or less providers available. To see the providers available on your system run the following command: `logman query providers`

|Name | GUID |
------|------|
|ACPI Driver Trace Provider                                                 |{DAB01D4D-2D48-477D-B1C3-DAAD0CE6F06B}|
|ADODB.1                                                                    |{04C8A86F-3369-12F8-4769-24E484A9E725}|
|ADOMD.1                                                                    |{7EA56435-3F2F-3F63-A829-F0B35B5CAD41}|
|ATA Port Driver Tracing Provider                                           |{D08BD885-501E-489A-BAC6-B7D24BFE6BBF}|
|Active Directory Domain Services: SAM                                      |{8E598056-8993-11D2-819E-0000F875A064}|
|Active Directory: Kerberos Client                                          |{BBA3ADD2-C229-4CDB-AE2B-57EB6966B0C4}|
|Active Directory: NetLogon                                                 |{F33959B4-DBEC-11D2-895B-00C04F79AB69}|
|Application Popup                                                          |{47BFA2B7-BD54-4FAC-B70B-29021084CA8F}|
|Application-Addon-Event-Provider                                           |{A83FA99F-C356-4DED-9FD6-5A5EB8546D68}|
|AuthFw NetShell Plugin                                                     |{935F4AE6-845D-41C6-97FA-380DAD429B72}|
|BCP.1                                                                      |{24722B88-DF97-4FF6-E395-DB533AC42A1E}|
|BFE Trace Provider                                                         |{106B464A-8043-46B1-8CB8-E92A0CD7A560}|
|BITS Service Trace                                                         |{4A8AAA94-CFC4-46A7-8E4E-17BC45608F0A}|
|Certificate Services Client CredentialRoaming Trace                        |{EF4109DC-68FC-45AF-B329-CA2825437209}|
|Certificate Services Client Trace                                          |{F01B7774-7ED7-401E-8088-B576793D7841}|
|Circular Kernel Session Provider                                           |{54DEA73A-ED1F-42A4-AF71-3E63D056F174}|
|Classpnp Driver Tracing Provider                                           |{FA8DE7C4-ACDE-4443-9994-C4E2359A9EDB}|
|Critical Section Trace Provider                                            |{3AC66736-CC59-4CFF-8115-8DF50E39816B}|
|DBNETLIB.1                                                                 |{BD568F20-FCCD-B948-054E-DB3421115D61}|
|Deduplication Tracing Provider                                             |{5EBB59D1-4739-4E45-872D-B8703956D84B}|
|Disk Class Driver Tracing Provider                                         |{945186BF-3DD6-4F3F-9C8E-9EDD3FC9D558}|
|Downlevel IPsec API                                                        |{94335EB3-79EA-44D5-8EA9-306F49B3A041}|
|Downlevel IPsec NetShell Plugin                                            |{E4FF10D8-8A88-4FC6-82C8-8C23E9462FE5}|
|Downlevel IPsec Policy Store                                               |{94335EB3-79EA-44D5-8EA9-306F49B3A070}|
|Downlevel IPsec Service                                                    |{94335EB3-79EA-44D5-8EA9-306F49B3A040}|
|EA IME API                                                                 |{E2A24A32-00DC-4025-9689-C108C01991C5}|
|Error Instrument                                                           |{CD7CF0D0-02CC-4872-9B65-0DBA0A90EFE8}|
|FD Core Trace                                                              |{480217A9-F824-4BD4-BBE8-F371CAAF9A0D}|
|FD Publication Trace                                                       |{649E3596-2620-4D58-A01F-17AEFE8185DB}|
|FD SSDP Trace                                                              |{DB1D0418-105A-4C77-9A25-8F96A19716A4}|
|FD WNet Trace                                                              |{8B20D3E4-581F-4A27-8109-DF01643A7A93}|
|FD WSDAPI Trace                                                            |{7E2DBFC7-41E8-4987-BCA7-76CADFAD765F}|
|FDPHost Service Trace                                                      |{F1C521CA-DA82-4D79-9EE4-D7A375723B68}|
|FWPKCLNT Trace Provider                                                    |{AD33FA19-F2D2-46D1-8F4C-E3C3087E45AD}|
|FWPUCLNT Trace Provider                                                    |{5A1600D2-68E5-4DE7-BCF4-1C2D215FE0FE}|
|File Kernel Trace; Operation Set 1                                         |{D75D8303-6C21-4BDE-9C98-ECC6320F9291}|
|File Kernel Trace; Operation Set 2                                         |{058DD951-7604-414D-A5D6-A56D35367A46}|
|File Kernel Trace; Optional Data                                           |{7DA1385C-F8F5-414D-B9D0-02FCA090F1EC}|
|File Kernel Trace; Volume To Log                                           |{127D46AF-4AD3-489F-9165-F00BA64D5467}|
|Heap Trace Provider                                                        |{222962AB-6180-4B88-A825-346B75F2A24A}|
|IKEEXT Trace Provider                                                      |{106B464D-8043-46B1-8CB8-E92A0CD7A560}|
|IMAPI1 Shim                                                                |{1FF10429-99AE-45BB-8A67-C9E945B9FB6C}|
|IMAPI2 Concatenate Stream                                                  |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E9D}|
|IMAPI2 Disc Master                                                         |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E91}|
|IMAPI2 Disc Recorder                                                       |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E93}|
|IMAPI2 Disc Recorder Enumerator                                            |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E92}|
|IMAPI2 Interleave Stream                                                   |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E9E}|
|IMAPI2 MSF                                                                 |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E9F}|
|IMAPI2 Media Eraser                                                        |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E97}|
|IMAPI2 Multisession Sequential                                             |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7EA0}|
|IMAPI2 Pseudo-Random Stream                                                |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E9C}|
|IMAPI2 Raw CD Writer                                                       |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E9A}|
|IMAPI2 Raw Image Writer                                                    |{07E397EC-C240-4ED7-8A2A-B9FF0FE5D581}|
|IMAPI2 Standard Data Writer                                                |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E98}|
|IMAPI2 Track-at-Once CD Writer                                             |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E99}|
|IMAPI2 Utilities                                                           |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E94}|
|IMAPI2 Write Engine                                                        |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E96}|
|IMAPI2 Zero Stream                                                         |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E9B}|
|IMAPI2 dll                                                                 |{0E85A5A5-4D5C-44B7-8BDA-5B7AB54F7E90}|
|IMAPI2FS Tracing                                                           |{F8036571-42D9-480A-BABB-DE7833CB059C}|
|IPMI Driver Trace                                                          |{D5C6A3E9-FA9C-434E-9653-165B4FC869E4}|
|IPMI Provider Trace                                                        |{651D672B-E11F-41B7-ADD3-C2F6A4023672}|
|Intel-iaLPSS-GPIO                                                          |{D386CC7A-620A-41C1-ABF5-55018C6C699A}|
|Intel-iaLPSS-I2C                                                           |{D4AEAC44-AD44-456E-9C90-33F8CDCED6AF}|
|Intel-iaLPSS2-GPIO2                                                        |{63848CFF-3EC7-4DDF-8072-5F95E8C8EB98}|
|Intel-iaLPSS2-I2C                                                          |{C2F86198-03CA-4771-8D4C-CE6E15CBCA56}|
|KMDFv1 Trace Provider                                                      |{544D4C9D-942C-46D5-BF50-DF5CD9524A50}|
|Layer2 Security HC Diagnostics Trace                                       |{2E8D9EC5-A712-48C4-8CE0-631EB0C1CD65}|
|Local Security Authority (LSA)                                             |{CC85922F-DB41-11D2-9244-006008269001}|
|LsaSrv                                                                     |{199FE037-2B82-40A9-82AC-E1D46C792B99}|
|MMC                                                                        |{9C88041D-349D-4647-8BFD-2C0A167BFE58}|
|MSADCE.1                                                                   |{76DBA919-5A36-FC80-2CAD-3185532B7CB1}|
|MSADCF.1                                                                   |{101C0E21-EBBA-A60A-EC3D-58797788928A}|
|MSADCO.1                                                                   |{5C6CE734-1B3E-705E-C2AB-B272D99AAF8F}|
|MSADDS.1                                                                   |{13CD7F92-5BAA-8C7C-3D72-B69FAC139A46}|
|MSADOX.1                                                                   |{6C770D53-0441-AFD4-DCAB-1D89155FECFC}|
|MSDADIAG.ETW                                                               |{8B98D3F2-3CC6-0B9C-6651-9649CCE5C752}|
|MSDAPRST.1                                                                 |{64A552E0-6C60-B907-E59C-10F1DFF76B0D}|
|MSDAREM.1                                                                  |{564F1E24-FC86-28E1-74F8-5CA0D950BEE0}|
|MSDART.1                                                                   |{CEB7253C-BB96-9DFE-51D1-53D966D0CF8B}|
|MSDASQL_1                                                                  |{B6501BA0-C61A-C4E6-6FA2-A4E7F8C8E7A0}|
|MSDATL3.1                                                                  |{87B93A44-1F73-EC83-7261-2DFC972D9B1E}|
|MUI Resource Trace                                                         |{D3DE60B2-A663-45D5-9826-A0A5949D2CB0}|
|Microsoft-Antimalware-AMFilter                                             |{CFEB0608-330E-4410-B00D-56D8DA9986E6}|
|Microsoft-Antimalware-Engine                                               |{0A002690-3839-4E3A-B3B6-96D8DF868D99}|
|Microsoft-Antimalware-Protection                                           |{E4B70372-261F-4C54-8FA6-A5A7914D73DA}|
|Microsoft-Antimalware-RTP                                                  |{8E92DEEF-5E17-413B-B927-59B2F06A3CFC}|
|Microsoft-Antimalware-Scan-Interface                                       |{2A576B87-09A7-520E-C21A-4942F0271D67}|
|Microsoft-Antimalware-Service                                              |{751EF305-6C6E-4FED-B847-02EF79D26AEF}|
|Microsoft-Antimalware-ShieldProvider                                       |{928F7D29-0577-5BE5-3BD3-B6BDAB9AB307}|
|Microsoft-AppV-Client                                                      |{E4F68870-5AE8-4E5B-9CE7-CA9ED75B0245}|
|Microsoft-AppV-Client-StreamingUX                                          |{28CB46C7-4003-4E50-8BD9-442086762D12}|
|Microsoft-AppV-ServiceLog                                                  |{9CC69D1C-7917-4ACD-8066-6BF8B63E551B}|
|Microsoft-AppV-SharedPerformance                                           |{FB4A19EE-EB5A-47A4-BC52-E71AAC6D0859}|
|Microsoft-Client-Licensing-Platform                                        |{B6CC0D55-9ECC-49A8-B929-2B9022426F2A}|
|Microsoft-Gaming-Services                                                  |{BC1BDB57-71A2-581A-147B-E0B49474A2D4}|
|Microsoft-IE                                                               |{9E3B3947-CA5D-4614-91A2-7B624E0E7244}|
|Microsoft-IE-JSDumpHeap                                                    |{7F8E35CA-68E8-41B9-86FE-D6ADC5B327E7}|
|Microsoft-IEFRAME                                                          |{5C8BB950-959E-4309-8908-67961A1205D5}|
|Microsoft-JScript                                                          |{57277741-3638-4A4B-BDBA-0AC6E45DA56C}|
|Microsoft-Office-Events                                                    |{8736922D-E8B2-47EB-8564-23E77E728CF3}|
|Microsoft-Office-Word                                                      |{DAF0B914-9C1C-450A-81B2-FEA7244F6FFA}|
|Microsoft-Office-Word2                                                     |{BB00E856-A12F-4AB7-B2C8-4E80CAEA5B07}|
|Microsoft-Office-Word3                                                     |{A1B69D49-2195-4F59-9D33-BDF30C0FE473}|
|Microsoft-OneCore-OnlineSetup                                              |{41862974-DA3B-4F0B-97D5-BB29FBB9B71E}|
|Microsoft-PerfTrack-IEFRAME                                                |{B2A40F1F-A05A-4DFD-886A-4C4F18C4334C}|
|Microsoft-PerfTrack-MSHTML                                                 |{FFDB9886-80F3-4540-AA8B-B85192217DDF}|
|Microsoft-User Experience Virtualization-Admin                             |{61BC445E-7A8D-420E-AB36-9C7143881B98}|
|Microsoft-User Experience Virtualization-Agent Driver                      |{DE29CF61-5EE6-43FF-9AAC-959C4E13CC6C}|
|Microsoft-User Experience Virtualization-App Agent                         |{1ED6976A-4171-4764-B415-7EA08BC46C51}|
|Microsoft-User Experience Virtualization-IPC                               |{21D79DB0-8E03-41CD-9589-F3EF7001A92A}|
|Microsoft-User Experience Virtualization-SQM Uploader                      |{57003E21-269B-4BDC-8434-B3BF8D57D2D5}|
|Microsoft-Windows Networking VPN Plugin Platform                           |{E5FC4A0F-7198-492F-9B0F-88FDCBFDED48}|
|Microsoft-Windows-AAD                                                      |{4DE9BC9C-B27A-43C9-8994-0915F1A5E24F}|
|Microsoft-Windows-ACL-UI                                                   |{EA4CC8B8-A150-47A3-AFB9-C8D194B19452}|
|Microsoft-Windows-ADSI                                                     |{7288C9F8-D63C-4932-A345-89D6B060174D}|
|Microsoft-Windows-AIT                                                      |{6ADDABF4-8C54-4EAB-BF4F-FBEF61B62EB0}|
|Microsoft-Windows-ASN1                                                     |{D92EF8AC-99DD-4AB8-B91D-C6EBA85F3755}|
|Microsoft-Windows-ATAPort                                                  |{CB587AD1-CC35-4EF1-AD93-36CC82A2D319}|
|Microsoft-Windows-ActionQueue                                              |{0DD4D48E-2BBF-452F-A7EC-BA3DBA8407AE}|
|Microsoft-Windows-All-User-Install-Agent                                   |{D2E990DA-8504-4702-A5E5-367FC2F823BF}|
|Microsoft-Windows-AllJoyn                                                  |{2ED299D2-2F6B-411D-8D15-F4CC6FDE0C70}|
|Microsoft-Windows-AppHost                                                  |{98E0765D-8C42-44A3-A57B-760D7F93225A}|
|Microsoft-Windows-AppID                                                    |{3CB2A168-FE19-4A4E-BDAD-DCF422F13473}|
|Microsoft-Windows-AppIDServiceTrigger                                      |{D02A9C27-79B8-40D6-9B97-CF3F8B7B5D60}|
|Microsoft-Windows-AppLocker                                                |{CBDA4DBF-8D5D-4F69-9578-BE14AA540D22}|
|Microsoft-Windows-AppModel-Exec                                            |{EB65A492-86C0-406A-BACE-9912D595BD69}|
|Microsoft-Windows-AppModel-MessagingDataModel                              |{1E2462BE-B025-48DA-8C1F-7B60B8CCAE53}|
|Microsoft-Windows-AppModel-Runtime                                         |{F1EF270A-0D32-4352-BA52-DBAB41E1D859}|
|Microsoft-Windows-AppModel-State                                           |{BFF15E13-81BF-45EE-8B16-7CFEAD00DA86}|
|Microsoft-Windows-AppReadiness                                             |{F0BE35F8-237B-4814-86B5-ADE51192E503}|
|Microsoft-Windows-AppSruProv                                               |{0CC157B3-CF07-4FC2-91EE-31AC92E05FE1}|
|Microsoft-Windows-AppXDeployment                                           |{8127F6D4-59F9-4ABF-8952-3E3A02073D5F}|
|Microsoft-Windows-AppXDeployment-Server                                    |{3F471139-ACB7-4A01-B7A7-FF5DA4BA2D43}|
|Microsoft-Windows-ApplicabilityEngine                                      |{10A208DD-A372-421C-9D99-4FAD6DB68B62}|
|Microsoft-Windows-Application Server-Applications                          |{C651F5F6-1C0D-492E-8AE1-B4EFD7C9D503}|
|Microsoft-Windows-Application-Experience                                   |{EEF54E71-0661-422D-9A98-82FD4940B820}|
|Microsoft-Windows-ApplicationExperience-Cache                              |{6D8A3A60-40AF-445A-98CA-99359E500146}|
|Microsoft-Windows-ApplicationExperience-LookupServiceTrigger               |{18F4A5FD-FD3B-40A5-8FC2-E5D261C5D02E}|
|Microsoft-Windows-ApplicationExperience-SwitchBack                         |{17D6E590-F5FE-11DC-95FF-0800200C9A66}|
|Microsoft-Windows-ApplicationExperienceInfrastructure                      |{5EC13D8E-4B3F-422E-A7E7-3121A1D90C7A}|
|Microsoft-Windows-AppxPackagingOM                                          |{BA723D81-0D0C-4F1E-80C8-54740F508DDF}|
|Microsoft-Windows-AssignedAccess                                           |{8530DB6E-51C0-43D6-9D02-A8C2088526CD}|
|Microsoft-Windows-AssignedAccessBroker                                     |{F2311B48-32BE-4902-A22A-7240371DBB2C}|
|Microsoft-Windows-AsynchronousCausality                                    |{19A4C69A-28EB-4D4B-8D94-5F19055A1B5C}|
|Microsoft-Windows-Audio                                                    |{AE4BD3BE-F36F-45B6-8D21-BDD6FB832853}|
|Microsoft-Windows-Audit                                                    |{75EBC33E-0936-4A55-9D26-5F298F3180BF}|
|Microsoft-Windows-Audit-CVE                                                |{85A62A0D-7E17-485F-9D4F-749A287193A6}|
|Microsoft-Windows-AuthenticationProvider                                   |{DDDC1D91-51A1-4A8D-95B5-350C4EE3D809}|
|Microsoft-Windows-AxInstallService                                         |{DAB3B18C-3C0F-43E8-80B1-E44BC0DAD901}|
|Microsoft-Windows-BTH-BTHPORT                                              |{8A1F9517-3A8C-4A9E-A018-4F17A200F277}|
|Microsoft-Windows-BTH-BTHUSB                                               |{33693E1D-246A-471B-83BE-3E75F47A832D}|
|Microsoft-Windows-BackgroundTransfer-ContentPrefetcher                     |{648A0644-7D62-4FD3-8841-440064762F95}|
|Microsoft-Windows-Backup                                                   |{1DB28F2E-8F80-4027-8C5A-A11F7F10F62D}|
|Microsoft-Windows-Base-Filtering-Engine-Connections                        |{121D3DA8-BAF1-4DCB-929F-2D4C9A47F7AB}|
|Microsoft-Windows-Base-Filtering-Engine-Resource-Flows                     |{92765247-03A9-4AE3-A575-B42264616E78}|
|Microsoft-Windows-Battery                                                  |{59819D0A-ADAF-46B2-8D7C-990BC39C7C15}|
|Microsoft-Windows-BfeTriggerProvider                                       |{54732EE5-61CA-4727-9DA1-10BE5A4F773D}|
|Microsoft-Windows-Biometrics                                               |{A0E3D8EA-C34F-4419-A1DB-90435B8B21D0}|
|Microsoft-Windows-BitLocker-API                                            |{5D674230-CA9F-11DA-A94D-0800200C9A66}|
|Microsoft-Windows-BitLocker-DrivePreparationTool                           |{632F767E-0EC3-47B9-BA1C-A0E62A74728A}|
|Microsoft-Windows-BitLocker-Driver                                         |{651DF93B-5053-4D1E-94C5-F6E6D25908D0}|
|Microsoft-Windows-BitLocker-Driver-Performance                             |{1DE130E1-C026-4CBF-BA0F-AB608E40AEEA}|
|Microsoft-Windows-Bits-Client                                              |{EF1CC15B-46C1-414E-BB95-E76B077BD51E}|
|Microsoft-Windows-Bluetooth-BthLEPrepairing                                |{4AF188AC-E9C4-4C11-B07B-1FABC07DFEB2}|
|Microsoft-Windows-Bluetooth-Bthmini                                        |{DB25B328-A6F6-444F-9D97-A50E20217D16}|
|Microsoft-Windows-Bluetooth-MTPEnum                                        |{04268430-D489-424D-B914-0CFF741D6684}|
|Microsoft-Windows-Bluetooth-Policy                                         |{0602ECEF-6381-4BC0-AEDA-EB9BB919B276}|
|Microsoft-Windows-BootUX                                                   |{67D781BD-CBD2-4BD2-AD1F-6152FB891246}|
|Microsoft-Windows-BranchCache                                              |{7EAFCF79-06A7-460B-8A55-BD0A0C9248AA}|
|Microsoft-Windows-BranchCacheClientEventProvider                           |{E837619C-A2A8-4689-833F-47B48EBD2442}|
|Microsoft-Windows-BranchCacheEventProvider                                 |{DD85457F-4E2D-44A5-A7A7-6253362E34DC}|
|Microsoft-Windows-BranchCacheMonitoring                                    |{A2F55524-8EBC-45FD-88E4-A1B39F169E08}|
|Microsoft-Windows-BranchCacheSMB                                           |{4A933674-FB3D-4E8D-B01D-17EE14E91A3E}|
|Microsoft-Windows-BrokerInfrastructure                                     |{E6835967-E0D2-41FB-BCEC-58387404E25A}|
|Microsoft-Windows-Build-RegDll                                             |{D39B6336-CFCB-483B-8C76-7C3E7D02BCB8}|
|Microsoft-Windows-CAPI2                                                    |{5BBCA4A8-B209-48DC-A8C7-B23D3E5216FB}|
|Microsoft-Windows-CDROM                                                    |{9B6123DC-9AF6-4430-80D7-7D36F054FB9F}|
|Microsoft-Windows-COM                                                      |{D4263C98-310C-4D97-BA39-B55354F08584}|
|Microsoft-Windows-COM-Perf                                                 |{B8D6861B-D20F-4EEC-BBAE-87E0DD80602B}|
|Microsoft-Windows-COM-RundownInstrumentation                               |{2957313D-FCAA-5D4A-2F69-32CE5F0AC44E}|
|Microsoft-Windows-COMRuntime                                               |{BF406804-6AFA-46E7-8A48-6C357E1D6D61}|
|Microsoft-Windows-CertPolEng                                               |{AF9CC194-E9A8-42BD-B0D1-834E9CFAB799}|
|Microsoft-Windows-CertificateServicesClient                                |{73370BD6-85E5-430B-B60A-FEA1285808A7}|
|Microsoft-Windows-CertificateServicesClient-AutoEnrollment                 |{F0DB7EF8-B6F3-4005-9937-FEB77B9E1B43}|
|Microsoft-Windows-CertificateServicesClient-CertEnroll                     |{54164045-7C50-4905-963F-E5BC1EEF0CCA}|
|Microsoft-Windows-CertificateServicesClient-CredentialRoaming              |{89A2278B-C662-4AFF-A06C-46AD3F220BCA}|
|Microsoft-Windows-CertificateServicesClient-Lifecycle-System               |{BC0669E1-A10D-4A78-834E-1CA3C806C93B}|
|Microsoft-Windows-CertificateServicesClient-Lifecycle-User                 |{BEA18B89-126F-4155-9EE4-D36038B02680}|
|Microsoft-Windows-CertificationAuthorityClient-CertCli                     |{98BF1CD3-583E-4926-95EE-A61BF3F46470}|
|Microsoft-Windows-ClearTypeTextTuner                                       |{0A88862D-20A3-4C1F-B76F-162C55ADBF93}|
|Microsoft-Windows-CloudStore                                               |{741BB90C-A7A3-49D6-BD82-1E6B858403F7}|
|Microsoft-Windows-CmiSetup                                                 |{75EBC33E-0CC6-49DA-8CD9-8903A5222AA0}|
|Microsoft-Windows-CodeIntegrity                                            |{4EE76BD8-3CF4-44A0-A0AC-3937643E37A3}|
|Microsoft-Windows-ComDlg32                                                 |{7F912B92-21AD-496E-B97A-88622A72BC42}|
|Microsoft-Windows-Compat-Appraiser                                         |{442C11C5-304B-45A4-AE73-DC2194C4E876}|
|Microsoft-Windows-Complus                                                  |{0F177893-4A9C-4709-B921-F432D67F43D5}|
|Microsoft-Windows-Containers-BindFlt                                       |{FC4E8F51-7A04-4BAB-8B91-6321416F72AB}|
|Microsoft-Windows-Containers-BindFlt-Mapping                               |{8FE0DD83-1368-5786-3A82-F746C6F1DD62}|
|Microsoft-Windows-Containers-Wcifs                                         |{AEC5C129-7C10-407D-BE97-91A042C61AAA}|
|Microsoft-Windows-Containers-Wcifs-Mapping                                 |{0223F0A3-6383-5A7A-7BC7-04D4739E2E32}|
|Microsoft-Windows-Containers-Wcnfs                                         |{B99317E5-89B7-4C0D-ABD1-6E705F7912DC}|
|Microsoft-Windows-CoreSystem-InitMachineConfig                             |{0B886108-1899-4D3A-9C0D-42D8FC4B9108}|
|Microsoft-Windows-CoreSystem-NetProvision-JoinProviderOnline               |{3629DD4D-D6F1-4302-A623-0768B51501C7}|
|Microsoft-Windows-CoreSystem-SmsRouter                                     |{A9C11050-9E93-4FA4-8FE0-7C4750A345B2}|
|Microsoft-Windows-CoreWindow                                               |{A3D95055-34CC-4E4A-B99F-EC88F5370495}|
|Microsoft-Windows-CorruptedFileRecovery-Client                             |{BA093605-3909-4345-990B-26B746ADEE0A}|
|Microsoft-Windows-CorruptedFileRecovery-Server                             |{D6F68875-CDF5-43A5-A3E3-53FFD683311C}|
|Microsoft-Windows-Crashdump                                                |{ECDAACFA-6FE9-477C-B5F0-85B76F8F50AA}|
|Microsoft-Windows-CredUI                                                   |{5A24FCDB-1CF3-477B-B422-EF4909D51223}|
|Microsoft-Windows-Crypto-BCrypt                                            |{C7E089AC-BA2A-11E0-9AF7-68384824019B}|
|Microsoft-Windows-Crypto-CNG                                               |{E3E0E2F0-C9C5-11E0-8AB9-9EBC4824019B}|
|Microsoft-Windows-Crypto-DPAPI                                             |{89FE8F40-CDCE-464E-8217-15EF97D4C7C3}|
|Microsoft-Windows-Crypto-DSSEnh                                            |{43DAD447-735F-4829-A6FF-9829A87419FF}|
|Microsoft-Windows-Crypto-NCrypt                                            |{E8ED09DC-100C-45E2-9FC8-B53399EC1F70}|
|Microsoft-Windows-Crypto-RNG                                               |{54D5AC20-E14F-4FDA-92DA-EBF7556FF176}|
|Microsoft-Windows-Crypto-RSAEnh                                            |{152FDB2B-6E9D-4B60-B317-815D5F174C4A}|
|Microsoft-Windows-D3D10Level9                                              |{7E7D3382-023C-43CB-95D2-6F0CA6D70381}|
|Microsoft-Windows-D3D9                                                     |{783ACA0A-790E-4D7F-8451-AA850511C6B9}|
|Microsoft-Windows-DAL-Provider                                             |{7E87506F-BACE-4BF1-BC09-3A1F37045C71}|
|Microsoft-Windows-DCLocator                                                |{CFAA5446-C6C4-4F5C-866F-31C9B55B962D}|
|Microsoft-Windows-DDisplay                                                 |{75051C9D-2833-4A29-8923-046DB7A432CA}|
|Microsoft-Windows-DHCPv6-Client                                            |{6A1F2B00-6A90-4C38-95A5-5CAB3B056778}|
|Microsoft-Windows-DLNA-Namespace                                           |{D38FB874-33E4-4DCF-911E-1B53BB106D53}|
|Microsoft-Windows-DNS-Client                                               |{1C95126E-7EEA-49A9-A3FE-A378B03DDB4D}|
|Microsoft-Windows-DSC                                                      |{50DF9E12-A8C4-4939-B281-47E1325BA63E}|
|Microsoft-Windows-DUI                                                      |{8360BD0F-A7DC-4391-91A7-A457C5C381E4}|
|Microsoft-Windows-DUSER                                                    |{8429E243-345B-47C1-8A91-2C94CAF0DAAB}|
|Microsoft-Windows-DVD                                                      |{E18D0FCA-9515-4232-98E4-89E456D8551B}|
|Microsoft-Windows-DXGI                                                     |{CA11C036-0102-4A2D-A6AD-F03CFED5D3C9}|
|Microsoft-Windows-DXP                                                      |{728B8C72-0F0F-4071-9BCC-27CB3B6DACBE}|
|Microsoft-Windows-Data-Pdf                                                 |{B97561FE-B27A-4C48-AA3E-7D3ADDC105B1}|
|Microsoft-Windows-DataIntegrityScan                                        |{13BC4371-4E21-4E46-A84F-8C0FFB548CED}|
|Microsoft-Windows-DateTimeControlPanel                                     |{741FC222-44ED-4BA7-98E3-F405B2D2C4B4}|
|Microsoft-Windows-Deduplication                                            |{F9FE3908-44B8-48D9-9A32-5A763FF5ED79}|
|Microsoft-Windows-Deduplication-Change                                     |{1D5E499D-739C-45A6-A3E1-8CBE0A352BEB}|
|Microsoft-Windows-Defrag-Core                                              |{E3257C8C-C7CB-444F-9DA0-5D92A2625289}|
|Microsoft-Windows-DeliveryOptimization                                     |{F8AD09BA-419C-5134-1750-270F4D0FB889}|
|Microsoft-Windows-Deplorch                                                 |{B9DA9FE6-AE5F-4F3E-B2FA-8E623C11DC75}|
|Microsoft-Windows-DesktopActivityModerator                                 |{32DD13DF-9C0B-4C3B-B854-EE76C050F5F4}|
|Microsoft-Windows-DesktopWindowManager-Diag                                |{31F60101-3703-48EA-8143-451F8DE779D2}|
|Microsoft-Windows-DevMgmt-UefiCsp                                          |{739D66D8-76C4-4004-873F-169AE5C6EACA}|
|Microsoft-Windows-DeviceAssociationService                                 |{56C71C31-CFBD-4CDD-8559-505E042BBBE1}|
|Microsoft-Windows-DeviceConfidence                                         |{1D5990C1-EC62-49F0-9E37-1F4DB12DB41E}|
|Microsoft-Windows-DeviceGuard                                              |{F717D024-F5B4-4F03-9AB9-331B2DC38FFB}|
|Microsoft-Windows-DeviceManagement-Enterprise-Diagnostics-Provider         |{3DA494E4-0FE2-415C-B895-FB5265C5C83B}|
|Microsoft-Windows-DeviceManagement-Pushrouter                              |{F1201B5A-E170-42B6-8D20-B57AC57E6416}|
|Microsoft-Windows-DeviceSetupManager                                       |{FCBB06BB-6A2A-46E3-ABAA-246CB4E508B2}|
|Microsoft-Windows-DeviceSync                                               |{09EC9687-D7AD-40CA-9C5E-78A04A5AE993}|
|Microsoft-Windows-DeviceUpdateAgent                                        |{E8F9AF91-AFBE-5A03-DFEC-5D591686326C}|
|Microsoft-Windows-DeviceUx                                                 |{DED165CF-485D-4770-A3E7-9C5F0320E80C}|
|Microsoft-Windows-Devices-Background                                       |{64EF2B1C-4AE1-4E64-8599-1636E441EC88}|
|Microsoft-Windows-DfsSvc                                                   |{7DA4FE0E-FD42-4708-9AA5-89B77A224885}|
|Microsoft-Windows-Dhcp-Client                                              |{15A7A4F8-0072-4EAB-ABAD-F98A4D666AED}|
|Microsoft-Windows-DiagCpl                                                  |{1A396961-5F3C-4C71-8310-44C653C0BF8A}|
|Microsoft-Windows-Diagnosis-AdvancedTaskManager                            |{178DADAF-7AC4-4593-AB3E-A45FDA6D0D55}|
|Microsoft-Windows-Diagnosis-DPS                                            |{6BBA3851-2C7E-4DEA-8F54-31E5AFD029E3}|
|Microsoft-Windows-Diagnosis-MSDE                                           |{A50B09F8-93EB-4396-84C9-DC921259F952}|
|Microsoft-Windows-Diagnosis-PCW                                            |{AABF8B86-7936-4FA2-ACB0-63127F879DBF}|
|Microsoft-Windows-Diagnosis-PLA                                            |{E4D53F84-7DE3-11D8-9435-505054503030}|
|Microsoft-Windows-Diagnosis-PerfHost                                       |{F27B948B-0A7C-4EB6-92EC-8A2C1B353ECD}|
|Microsoft-Windows-Diagnosis-Scheduled                                      |{40AB57C2-1C53-4DF9-9324-FF7CF898A02C}|
|Microsoft-Windows-Diagnosis-Scripted                                       |{E1DD7E52-621D-44E3-A1AD-0370C2B25946}|
|Microsoft-Windows-Diagnosis-ScriptedDiagnosticsProvider                    |{9363CCD9-D429-4452-9ADB-2501E704B810}|
|Microsoft-Windows-Diagnosis-WDC                                            |{05921578-2261-42C7-A0D3-26DDBCE6C50D}|
|Microsoft-Windows-Diagnosis-WDI                                            |{E01B1A7C-C5C9-4E67-99A9-5E85ACFB2E10}|
|Microsoft-Windows-Diagnostics-LoggingChannel                               |{4BD2826E-54A1-4BA9-BF63-92B73EA1AC4A}|
|Microsoft-Windows-Diagnostics-Networking                                   |{36C23E18-0E66-11D9-BBEB-505054503030}|
|Microsoft-Windows-Diagnostics-PerfTrack                                    |{030F2F57-ABD0-4427-BCF1-3A3587D7DC7D}|
|Microsoft-Windows-Diagnostics-PerfTrack-Counters                           |{C06ED57A-A7BD-42D7-B5FF-77A9DEC5732D}|
|Microsoft-Windows-Diagnostics-Performance                                  |{CFC18EC0-96B1-4EBA-961B-622CAEE05B0A}|
|Microsoft-Windows-Direct3D10                                               |{9B7E4C0F-342C-4106-A19F-4F2704F689F0}|
|Microsoft-Windows-Direct3D10_1                                             |{9B7E4C8F-342C-4106-A19F-4F2704F689F0}|
|Microsoft-Windows-Direct3D11                                               |{DB6F6DDB-AC77-4E88-8253-819DF9BBF140}|
|Microsoft-Windows-Direct3D12                                               |{5D8087DD-3A9B-4F56-90DF-49196CDC4F11}|
|Microsoft-Windows-Direct3DShaderCache                                      |{2D4EBCA6-EA64-453F-A292-AE2EA0EE513B}|
|Microsoft-Windows-DirectAccess-MediaManager                                |{DD2FE441-6C12-41FD-8232-3709C6045F63}|
|Microsoft-Windows-DirectComposition                                        |{C44219D0-F344-11DF-A5E2-B307DFD72085}|
|Microsoft-Windows-DirectManipulation                                       |{5786E035-EF2D-4178-84F2-5A6BBEDBB947}|
|Microsoft-Windows-DirectShow-Core                                          |{968F313B-097F-4E09-9CDD-BC62692D138B}|
|Microsoft-Windows-DirectShow-KernelSupport                                 |{3CC2D4AF-DA5E-4ED4-BCBE-3CF995940483}|
|Microsoft-Windows-DirectSound                                              |{8A93B54B-C75A-49B5-A5BE-9060715B1A33}|
|Microsoft-Windows-Directory-Services-SAM                                   |{0D4FDC09-8C27-494A-BDA0-505E4FD8ADAE}|
|Microsoft-Windows-Directory-Services-SAM-Utility                           |{BD8FEA17-5549-4B49-AA03-1981D16396A9}|
|Microsoft-Windows-Disk                                                     |{6B4DB0BC-9A3D-467D-81B9-A84C6F2F3D40}|
|Microsoft-Windows-DiskDiagnostic                                           |{E670A5A2-CE74-4AB4-9347-61B815319F4C}|
|Microsoft-Windows-DiskDiagnosticDataCollector                              |{E104FB41-6B04-4F3A-B47D-F0DF2F02B954}|
|Microsoft-Windows-DiskDiagnosticResolver                                   |{6B1FFE48-5B1E-4793-9F7F-AE926454499D}|
|Microsoft-Windows-Dism-Api                                                 |{75B0DA21-8B50-42EB-9448-EC48B1729B57}|
|Microsoft-Windows-Dism-Cli                                                 |{2F959466-24D4-4972-8729-0D5E3539EBC3}|
|Microsoft-Windows-Display                                                  |{6ECE3302-FEE1-4EA9-8B88-086D459ED976}|
|Microsoft-Windows-DisplayColorCalibration                                  |{3239EB6F-C7FC-4953-AA15-646829A4CA4C}|
|Microsoft-Windows-DisplaySwitch                                            |{192EDE41-9175-4C86-AC02-9D003C9D43AB}|
|Microsoft-Windows-DistributedCOM                                           |{1B562E86-B7AA-4131-BADC-B6F3A001407E}|
|Microsoft-Windows-Documents                                                |{C89B991E-3B48-49B2-80D3-AC000DFC9749}|
|Microsoft-Windows-DomainJoinManagerTriggerProvider                         |{5B004607-1087-4F16-B10E-979685A8D131}|
|Microsoft-Windows-Dot3MM                                                   |{F3419A17-E994-4C40-B593-79B8EDEC54E9}|
|Microsoft-Windows-DotNETRuntime                                            |{E13C0D23-CCBC-4E12-931B-D9CC2EEE27E4}|
|Microsoft-Windows-DotNETRuntimeRundown                                     |{A669021C-C450-4609-A035-5AF59AF4DF18}|
|Microsoft-Windows-DriverFrameworks-KernelMode-Performance                  |{486A5C7C-11CC-46C5-9DE7-43DFE0BB57C1}|
|Microsoft-Windows-DriverFrameworks-UserMode                                |{2E35AAEB-857F-4BEB-A418-2E6C0E54D988}|
|Microsoft-Windows-DriverFrameworks-UserMode-Performance                    |{9FA5DD5D-999E-466A-8CA9-7B3A66F8882F}|
|Microsoft-Windows-Dwm-Api                                                  |{292A52C4-FA27-4461-B526-54A46430BD54}|
|Microsoft-Windows-Dwm-Core                                                 |{9E9BBA3C-2E38-40CB-99F4-9E8281425164}|
|Microsoft-Windows-Dwm-Dwm                                                  |{D29D56EA-4867-4221-B02E-CFD998834075}|
|Microsoft-Windows-Dwm-Redir                                                |{7D99F6A4-1BEC-4C09-9703-3AAA8148347F}|
|Microsoft-Windows-Dwm-Udwm                                                 |{A2D1C713-093B-43A7-B445-D09370EC9F47}|
|Microsoft-Windows-DxgKrnl                                                  |{802EC45A-1E99-4B83-9920-87C98277BA9D}|
|Microsoft-Windows-DxpTaskSyncProvider                                      |{271C5228-C3FE-4E47-831F-48C3652CE5AC}|
|Microsoft-Windows-EDP-AppLearning                                          |{9803DAA0-81BA-483A-986C-F0E395B9F8D1}|
|Microsoft-Windows-EDP-Audit-Regular                                        |{50F99B2D-96D2-421F-BE4C-222C4140DA9F}|
|Microsoft-Windows-EDP-Audit-TCB                                            |{287D59B6-79BA-4741-A08B-2FEDEEDE6435}|
|Microsoft-Windows-EFS                                                      |{3663A992-84BE-40EA-BBA9-90C7ED544222}|
|Microsoft-Windows-ELS-Hyphenation                                          |{51AEDB05-890B-4ADE-8BA1-0BA14B8E8973}|
|Microsoft-Windows-EQoS                                                     |{54CB22FF-26B4-4393-A8C2-6B0715912C5F}|
|Microsoft-Windows-ESE                                                      |{478EA8A8-00BE-4BA6-8E75-8B9DC7DB9F78}|
|Microsoft-Windows-EapHost                                                  |{6EB8DB94-FE96-443F-A366-5FE0CEE7FB1C}|
|Microsoft-Windows-EapMethods-RasChap                                       |{58980F4B-BD39-4A3E-B344-492ED2254A4E}|
|Microsoft-Windows-EapMethods-RasTls                                        |{9CC0413E-5717-4AF5-82EB-6103D8707B45}|
|Microsoft-Windows-EapMethods-Sim                                           |{3D42A67D-9CE8-4284-B755-2550672B0CE0}|
|Microsoft-Windows-EapMethods-Ttls                                          |{D710D46C-235D-4798-AC20-9F83E1DCD557}|
|Microsoft-Windows-EaseOfAccess                                             |{74B4A4B1-2302-4768-AC5B-9773DD456B08}|
|Microsoft-Windows-EndpointTriggerProvider                                  |{92AAB24D-D9A9-4A60-9F94-201FED3E3E88}|
|Microsoft-Windows-Energy-Estimation-Engine                                 |{DDCC3826-A68A-4E0D-BCFD-9C06C27C6948}|
|Microsoft-Windows-EnergyEfficiencyWizard                                   |{1A772F65-BE1E-4FC6-96BB-248E03FA60F5}|
|Microsoft-Windows-EnhancedStorage-EhStorTcgDrv                             |{AA3AA23B-BB6D-425A-B58C-1D7E37F5D02A}|
|Microsoft-Windows-ErrorReportingConsole                                    |{017247F2-7E96-11DC-8314-0800200C9A66}|
|Microsoft-Windows-EventCollector                                           |{B977CF02-76F6-DF84-CC1A-6A4B232322B6}|
|Microsoft-Windows-EventLog-WMIProvider                                     |{35AC6CE8-6104-411D-976C-877F183D2D32}|
|Microsoft-Windows-EventSystem                                              |{899DAACE-4868-4295-AFCD-9EB8FB497561}|
|Microsoft-Windows-Eventlog                                                 |{FC65DDD8-D6EF-4962-83D5-6E5CFE9CE148}|
|Microsoft-Windows-FMS                                                      |{DEA07764-0790-44DE-B9C4-49677B17174F}|
|Microsoft-Windows-FailoverClustering-Client                                |{A82FDA5D-745F-409C-B0FE-18AE0678A0E0}|
|Microsoft-Windows-Fat-SQM                                                  |{3E59A529-B0B3-4A11-8129-9FFE6BB46EB9}|
|Microsoft-Windows-Fault-Tolerant-Heap                                      |{6B93BF66-A922-4C11-A617-CF60D95C133D}|
|Microsoft-Windows-Fax                                                      |{8E0E93FB-76AD-42EE-8770-B9DFEA596F65}|
|Microsoft-Windows-Feedback-Service-TriggerProvider                         |{E46EEAD8-0C54-4489-9898-8FA79D059E0E}|
|Microsoft-Windows-FileHistory-Catalog                                      |{B447B4DC-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileHistory-ConfigManager                                |{B447B4DD-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileHistory-Core                                         |{B447B4DB-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileHistory-Engine                                       |{B447B4DE-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileHistory-EventListener                                |{B447B4DF-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileHistory-Service                                      |{B447B4E0-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileHistory-UI                                           |{B447B4E1-7780-11E0-ADA3-18A90531A85A}|
|Microsoft-Windows-FileInfoMinifilter                                       |{A319D300-015C-48BE-ACDB-47746E154751}|
|Microsoft-Windows-FilterManager                                            |{F3C5E28E-63F6-49C7-A204-E48A1BC4B09D}|
|Microsoft-Windows-Firewall                                                 |{E595F735-B42A-494B-AFCD-B68666945CD3}|
|Microsoft-Windows-Firewall-CPL                                             |{546549BE-9D63-46AA-9154-4F6EB9526378}|
|Microsoft-Windows-FirstUX-PerfInstrumentation                              |{FBEF8096-2CA3-4082-ACDE-DCFB47E96B72}|
|Microsoft-Windows-Folder Redirection                                       |{7D7B0C39-93F6-4100-BD96-4DDA859652C5}|
|Microsoft-Windows-Forwarding                                               |{699E309C-E782-4400-98C8-E21D162D7B7B}|
|Microsoft-Windows-FunctionDiscovery                                        |{9DB0FDB5-3B21-440E-A94B-63738A4BE5DE}|
|Microsoft-Windows-FunctionDiscoveryHost                                    |{538CBBAD-4877-4EB2-B26E-7CAEE8F0F8CB}|
|Microsoft-Windows-GPIO-ClassExtension                                      |{55AB77F6-FA04-43EF-AF45-688FBF500482}|
|Microsoft-Windows-GPIOButtons                                              |{E13FF11E-E989-4838-A9FA-38A4D13914CF}|
|Microsoft-Windows-GenericRoaming                                           |{4EACB4D0-263B-4B93-8CD6-778A278E5642}|
|Microsoft-Windows-Graphics-Capture-Server                                  |{7D0CBD25-390E-524D-8C1E-2A8E846055C0}|
|Microsoft-Windows-Graphics-Printing                                        |{E7AA32FB-77D0-477F-987D-7E83DF1B7ED0}|
|Microsoft-Windows-Graphics-Printing3D                                      |{BE967569-E3C8-425B-AD0E-4F2C790B1848}|
|Microsoft-Windows-GroupPolicy                                              |{AEA1B4FA-97D1-45F2-A64C-4D69FFFD92C9}|
|Microsoft-Windows-GroupPolicyTriggerProvider                               |{BD2F4252-5E1E-49FC-9A30-F3978AD89EE2}|
|Microsoft-Windows-HAL                                                      |{63D1E632-95CC-4443-9312-AF927761D52A}|
|Microsoft-Windows-HealthCenter                                             |{588C5C5A-FFC5-44A2-9A7F-D5E8DBE6EFD7}|
|Microsoft-Windows-HealthCenterCPL                                          |{959F1FAC-7CA8-4ED1-89DC-CDFA7E093CB0}|
|Microsoft-Windows-Heap-Snapshot                                            |{901D2AFA-4FF6-46D7-8D0E-53645E1A47F5}|
|Microsoft-Windows-HelloForBusiness                                         |{906B8A99-63CE-58D7-86AB-10989BBD5567}|
|Microsoft-Windows-Help                                                     |{DE513A55-C345-438B-9A74-E18CAC5C5CC5}|
|Microsoft-Windows-HomeGroup-ControlPanel                                   |{134EA407-755D-4A93-B8A6-F290CD155023}|
|Microsoft-Windows-HomeGroup-ListenerService                                |{AF0A5A6D-E009-46D4-8867-42F2240F8A72}|
|Microsoft-Windows-HomeGroup-ProviderService                                |{C9BDB4EB-9287-4C8E-8378-6896F0D1C5EF}|
|Microsoft-Windows-Host-Network-Management                                  |{93F693DC-9163-4DEE-AF64-D855218AF242}|
|Microsoft-Windows-HotspotAuth                                              |{DE095DBE-8667-4168-94C2-48CA61665ACA}|
|Microsoft-Windows-Http-SQM-Provider                                        |{F5344219-87A4-4399-B14A-E59CD118ABB8}|
|Microsoft-Windows-HttpEvent                                                |{7B6BC78C-898B-4170-BBF8-1A469EA43FC5}|
|Microsoft-Windows-HttpLog                                                  |{C42A2738-2333-40A5-A32F-6ACC36449DCC}|
|Microsoft-Windows-HttpService                                              |{DD5EF90A-6398-47A4-AD34-4DCECDEF795F}|
|Microsoft-Windows-Hyper-V-ComputeLib                                       |{AF7FD3A7-B248-460C-A9F5-FEC39EF8468C}|
|Microsoft-Windows-Hyper-V-Guest-Drivers-Dynamic-Memory                     |{BA2FFB5C-E20A-4FB9-91B4-45F61B4B66A0}|
|Microsoft-Windows-Hyper-V-Guest-Drivers-IcSvc                              |{C18672D1-DC18-4DFD-91E4-170CF37160CF}|
|Microsoft-Windows-Hyper-V-Guest-Drivers-Storage-Filter                     |{0B9FDCCC-451C-449C-9BD8-6756FCC6091A}|
|Microsoft-Windows-Hyper-V-Guest-Drivers-Vmbus                              |{F2E2CE31-0E8A-4E46-A03B-2E0FE97E93C2}|
|Microsoft-Windows-Hyper-V-Hypervisor                                       |{52FC89F8-995E-434C-A91E-199986449890}|
|Microsoft-Windows-Hyper-V-Netvsc                                           |{152FBE4B-C7AD-4F68-BADA-A4FCC1464F6C}|
|Microsoft-Windows-Hyper-V-VID                                              |{5931D877-4860-4EE7-A95C-610A5F0D1407}|
|Microsoft-Windows-Hyper-V-VmSwitch                                         |{67DC0D66-3695-47C0-9642-33F76F7BD7AD}|
|Microsoft-Windows-IE-F12-Provider                                          |{D17FFF2F-392D-478C-A41D-737A216EB2A4}|
|Microsoft-Windows-IE-SmartScreen                                           |{52F82079-1974-4C67-81DA-807B892778BB}|
|Microsoft-Windows-IME-Broker                                               |{E2C15FD7-8924-4C8C-8CFE-DA0BE539CE27}|
|Microsoft-Windows-IME-CandidateUI                                          |{7C4117B1-ED82-4F47-B2CA-29E4E25719C7}|
|Microsoft-Windows-IME-CustomerFeedbackManager                              |{E2242B38-9453-42FD-B446-00746E76EB82}|
|Microsoft-Windows-IME-CustomerFeedbackManagerUI                            |{1B734B40-A458-4B81-954F-AD7C9461BED8}|
|Microsoft-Windows-IME-JPAPI                                                |{31BCAC7F-4AB8-47A1-B73A-A161EE68D585}|
|Microsoft-Windows-IME-JPLMP                                                |{DBC388BC-89C2-4FE0-B71F-6E4881FB575C}|
|Microsoft-Windows-IME-JPPRED                                               |{3AD571F3-BDAE-4942-8733-4D1B85870A1E}|
|Microsoft-Windows-IME-JPSetting                                            |{14371053-1813-471A-9510-1CF1D0A055A8}|
|Microsoft-Windows-IME-JPTIP                                                |{8C8A69AD-CC89-481F-BBAD-FD95B5006256}|
|Microsoft-Windows-IME-KRAPI                                                |{7562948E-2671-4DDA-8F8F-BF945EF984A1}|
|Microsoft-Windows-IME-KRTIP                                                |{E013E74B-97F4-4E1C-A120-596E5629ECFE}|
|Microsoft-Windows-IME-OEDCompiler                                          |{FD44A6E7-580F-4A9C-83D9-D820B7D3A033}|
|Microsoft-Windows-IME-TCCORE                                               |{F67B2345-47FA-4721-A6FB-FE08110EECF7}|
|Microsoft-Windows-IME-TCTIP                                                |{D5268C02-6F51-436F-983B-74F2EFBFAF3A}|
|Microsoft-Windows-IME-TIP                                                  |{BDD4B92E-19EF-4497-9C4A-E10E7FD2E227}|
|Microsoft-Windows-IPMIProvider                                             |{2A45D52E-BBF3-4843-8E18-B356ED5F6A65}|
|Microsoft-Windows-IPNAT                                                    |{A67075C2-3E39-4109-B6CD-6D750058A732}|
|Microsoft-Windows-IPSEC-SRV                                                |{C91EF675-842F-4FCF-A5C9-6EA93F2E4F8B}|
|Microsoft-Windows-IPxlatCfg                                                |{3E5AC668-AF52-4C15-B99B-A3E7A6616EBD}|
|Microsoft-Windows-IdCtrls                                                  |{6D7662A9-034E-4B1F-A167-67819C401632}|
|Microsoft-Windows-IdleTriggerProvider                                      |{9E03F75A-BCBE-428A-8F3C-D46F2A444935}|
|Microsoft-Windows-Immersive-Shell                                          |{315A8872-923E-4EA2-9889-33CD4754BF64}|
|Microsoft-Windows-Immersive-Shell-API                                      |{5F0E257F-C224-43E5-9555-2ADCB8540A58}|
|Microsoft-Windows-IndirectDisplays-ClassExtension-Events                   |{966CD1C0-3F69-42AD-9877-517DCE8462B4}|
|Microsoft-Windows-Input-HIDCLASS                                           |{6465DA78-E7A0-4F39-B084-8F53C7C30DC6}|
|Microsoft-Windows-InputSwitch                                              |{BB8E7234-BBF4-48A7-8741-339206ED1DFB}|
|Microsoft-Windows-Install-Agent                                            |{E0C6F6DE-258A-50E0-AC1A-103482D118BC}|
|Microsoft-Windows-International                                            |{3AA52B8B-6357-4C18-A92E-B53FB177853B}|
|Microsoft-Windows-International-RegionalOptionsControlPanel                |{C6BF6832-F7BD-4151-AC21-753CE4707453}|
|Microsoft-Windows-Iphlpsvc                                                 |{66A5C15C-4F8E-4044-BF6E-71D896038977}|
|Microsoft-Windows-Iphlpsvc-Trace                                           |{6600E712-C3B6-44A2-8A48-935C511F28C8}|
|Microsoft-Windows-IsolatedUserMode                                         |{73A33AB2-1966-4999-8ADD-868C41415269}|
|Microsoft-Windows-KdsSvc                                                   |{89203471-D554-47D4-BDE4-7552EC219999}|
|Microsoft-Windows-Kernel-Acpi                                              |{C514638F-7723-485B-BCFC-96565D735D4A}|
|Microsoft-Windows-Kernel-AppCompat                                         |{16A1ADC1-9B7F-4CD9-94B3-D8296AB1B130}|
|Microsoft-Windows-Kernel-Audit-API-Calls                                   |{E02A841C-75A3-4FA7-AFC8-AE09CF9B7F23}|
|Microsoft-Windows-Kernel-Boot                                              |{15CA44FF-4D7A-4BAA-BBA5-0998955E531E}|
|Microsoft-Windows-Kernel-BootDiagnostics                                   |{96AC7637-5950-4A30-B8F7-E07E8E5734C1}|
|Microsoft-Windows-Kernel-Disk                                              |{C7BDE69A-E1E0-4177-B6EF-283AD1525271}|
|Microsoft-Windows-Kernel-EventTracing                                      |{B675EC37-BDB6-4648-BC92-F3FDC74D3CA2}|
|Microsoft-Windows-Kernel-File                                              |{EDD08927-9CC4-4E65-B970-C2560FB5C289}|
|Microsoft-Windows-Kernel-General                                           |{A68CA8B7-004F-D7B6-A698-07E2DE0F1F5D}|
|Microsoft-Windows-Kernel-IO                                                |{ABF1F586-2E50-4BA8-928D-49044E6F0DB7}|
|Microsoft-Windows-Kernel-Interrupt-Steering                                |{951B41EA-C830-44DC-A671-E2C9958809B8}|
|Microsoft-Windows-Kernel-IoTrace                                           |{A103CABD-8242-4A93-8DF5-1CDF3B3F26A6}|
|Microsoft-Windows-Kernel-Licensing-StartServiceTrigger                     |{F5528ADA-BE5F-4F14-8AEF-A95DE7281161}|
|Microsoft-Windows-Kernel-LicensingSqm                                      |{A0AF438F-4431-41CB-A675-A265050EE947}|
|Microsoft-Windows-Kernel-LiveDump                                          |{BEF2AA8E-81CD-11E2-A7BB-5EAC6188709B}|
|Microsoft-Windows-Kernel-Memory                                            |{D1D93EF7-E1F2-4F45-9943-03D245FE6C00}|
|Microsoft-Windows-Kernel-Network                                           |{7DD42A49-5329-4832-8DFD-43D979153A88}|
|Microsoft-Windows-Kernel-Pep                                               |{5412704E-B2E1-4624-8FFD-55777B8F7373}|
|Microsoft-Windows-Kernel-PnP                                               |{9C205A39-1250-487D-ABD7-E831C6290539}|
|Microsoft-Windows-Kernel-PnP-Rundown                                       |{B3A0C2C8-83BB-4DDF-9F8D-4B22D3C38AD7}|
|Microsoft-Windows-Kernel-Power                                             |{331C3B3A-2005-44C2-AC5E-77220C37D6B4}|
|Microsoft-Windows-Kernel-PowerTrigger                                      |{AA1F73E8-15FD-45D2-ABFD-E7F64F78EB11}|
|Microsoft-Windows-Kernel-Prefetch                                          |{5322D61A-9EFA-4BC3-A3F9-14BE95C144F8}|
|Microsoft-Windows-Kernel-Process                                           |{22FB2CD6-0E7B-422B-A0C7-2FAD1FD0E716}|
|Microsoft-Windows-Kernel-Processor-Power                                   |{0F67E49F-FE51-4E9F-B490-6F2948CC6027}|
|Microsoft-Windows-Kernel-Registry                                          |{70EB4F03-C1DE-4F73-A051-33D13D5413BD}|
|Microsoft-Windows-Kernel-ShimEngine                                        |{0BF2FB94-7B60-4B4D-9766-E82F658DF540}|
|Microsoft-Windows-Kernel-StoreMgr                                          |{A6AD76E3-867A-4635-91B3-4904BA6374D7}|
|Microsoft-Windows-Kernel-Tm                                                |{4CEC9C95-A65F-4591-B5C4-30100E51D870}|
|Microsoft-Windows-Kernel-Tm-Trigger                                        |{CE20D1C3-A247-4C41-BCB8-3C7F52C8B805}|
|Microsoft-Windows-Kernel-WDI                                               |{2FF3E6B7-CB90-4700-9621-443F389734ED}|
|Microsoft-Windows-Kernel-WHEA                                              |{7B563579-53C8-44E7-8236-0F87B9FE6594}|
|Microsoft-Windows-Kernel-WSService-StartServiceTrigger                     |{3635D4B6-77E3-4375-8124-D545B7149337}|
|Microsoft-Windows-Kernel-XDV                                               |{F029AC39-38F0-4A40-B7DE-404D244004CB}|
|Microsoft-Windows-KernelStreaming                                          |{548C4417-CE45-41FF-99DD-528F01CE0FE1}|
|Microsoft-Windows-KnownFolders                                             |{8939299F-2315-4C5C-9B91-ABB86AA0627D}|
|Microsoft-Windows-L2NACP                                                   |{85FE7609-FF4A-48E9-9D50-12918E43E1DA}|
|Microsoft-Windows-LDAP-Client                                              |{099614A5-5DD7-4788-8BC9-E29F43DB28FC}|
|Microsoft-Windows-LLTD-Mapper                                              |{CCC64809-6B5F-4C1B-AB39-336904DA9B3B}|
|Microsoft-Windows-LLTD-MapperIO                                            |{0741C7BE-DAAC-4A5B-B00A-4BD9A2D89D0E}|
|Microsoft-Windows-LLTD-Responder                                           |{E159FC63-02FE-42F3-A234-028B9B8561CB}|
|Microsoft-Windows-LUA                                                      |{93C05D69-51A3-485E-877F-1806A8731346}|
|Microsoft-Windows-LanGPA                                                   |{CB070027-1534-4CF3-98EA-B9751F508376}|
|Microsoft-Windows-LanguagePackSetup                                        |{7237FFF9-A08A-4804-9C79-4A8704B70B87}|
|Microsoft-Windows-LimitsManagement                                         |{73AA0094-FACB-4AEB-BD1D-A7B98DD5C799}|
|Microsoft-Windows-LinkLayerDiscoveryProtocol                               |{DCBFB8F0-CD19-4F1C-A27D-23AC706DED72}|
|Microsoft-Windows-LiveId                                                   |{05F02597-FE85-4E67-8542-69567AB8FD4F}|
|Microsoft-Windows-MCCS-AccountAccessor                                     |{4025D192-273D-42EC-BDF8-940EC34EEDCA}|
|Microsoft-Windows-MCCS-AccountsHost                                        |{04ECCF8E-8490-4AD1-8ED5-0AE7750E69E6}|
|Microsoft-Windows-MCCS-AccountsRT                                          |{DD2743C6-1722-4674-9F6F-C80044C4232E}|
|Microsoft-Windows-MCCS-ActiveSyncCsp                                       |{602A0873-9BDE-48B3-B6B7-277035293458}|
|Microsoft-Windows-MCCS-ActiveSyncProvider                                  |{4A155F10-25AD-47E6-ABA8-2C4F5EEE7846}|
|Microsoft-Windows-MCCS-DavSyncProvider                                     |{5D86C4E2-8FCD-48D7-A713-9A04609C0189}|
|Microsoft-Windows-MCCS-EngineShared                                        |{BF460FC6-45C5-4119-ADD3-E361A6E7D5AC}|
|Microsoft-Windows-MCCS-InternetMail                                        |{618473BC-8EEF-4868-ADFF-A1B640B06411}|
|Microsoft-Windows-MCCS-InternetMailCsp                                     |{BEC5E7A4-0527-42E8-8174-FABDE799AD7F}|
|Microsoft-Windows-MCCS-NetworkHelper                                       |{25B99A4C-2F80-4FCD-982D-69CD1F77BADF}|
|Microsoft-Windows-MCCS-SyncController                                      |{7FCB9791-F481-46D1-846E-2EB6F003C4D3}|
|Microsoft-Windows-MCCS-SyncUtil                                            |{DCA074CE-547C-4595-AE90-56229B8E3BD9}|
|Microsoft-Windows-MF                                                       |{A7364E1A-894F-4B3D-A930-2ED9C8C4C811}|
|Microsoft-Windows-MF-FrameServer                                           |{9E22A3ED-7B32-4B99-B6C2-21DD6ACE01E1}|
|Microsoft-Windows-MFH264Enc                                                |{2A49DE31-8A5B-4D3A-A904-7FC7409AE90D}|
|Microsoft-Windows-MMCSS                                                    |{36008301-E154-466C-ACEC-5F4CBD6B4694}|
|Microsoft-Windows-MP4SDECD                                                 |{7F2BD991-AE93-454A-B219-0BC23F02262A}|
|Microsoft-Windows-MPEG2_DLNA-Encoder                                       |{86EFFF39-2BDD-4EFD-BD0B-853D71B2A9DC}|
|Microsoft-Windows-MPRMSG                                                   |{F2C628AE-D26C-4352-9C45-74754E1E2F9F}|
|Microsoft-Windows-MPS-CLNT                                                 |{37945DC2-899B-44D1-B79C-DD4A9E57FF98}|
|Microsoft-Windows-MPS-DRV                                                  |{50BD1BFD-936B-4DB3-86BE-E25B96C25898}|
|Microsoft-Windows-MPS-SRV                                                  |{5444519F-2484-45A2-991E-953E4B54C8E0}|
|Microsoft-Windows-MSDTC                                                    |{719BE4ED-E9BC-4DD8-A7CF-C85CE8E4975D}|
|Microsoft-Windows-MSDTC 2                                                  |{5D9E0020-3761-4F36-90C8-38CE6511BD12}|
|Microsoft-Windows-MSDTC Client                                             |{7A67066E-193F-4D3A-82D3-322FEE5259DE}|
|Microsoft-Windows-MSDTC Client 2                                           |{155CB334-3D7F-4FF1-B107-DF8AFC3C0363}|
|Microsoft-Windows-MSFTEDIT                                                 |{9640427C-7D03-4331-B8EE-FB77625BF381}|
|Microsoft-Windows-MSMPEG2ADEC                                              |{51311DE3-D55E-454A-9C58-43DC7B4C01D2}|
|Microsoft-Windows-MSMPEG2VDEC                                              |{AE5CF422-786A-476A-AC96-753B05877C99}|
|Microsoft-Windows-MSPaint                                                  |{1D75856D-36A7-4ECB-A3F5-B13152222D29}|
|Microsoft-Windows-MUI                                                      |{A8A1F2F6-A13A-45E9-B1FE-3419569E5EF2}|
|Microsoft-Windows-Magnification                                            |{C882FF1D-7585-4B33-B135-95C577179137}|
|Microsoft-Windows-Management-SecureAssessment                              |{A329CF81-57EC-46ED-AB7C-261A52B0754A}|
|Microsoft-Windows-Media-Protection-PlayReady-Performance                   |{D2402FDE-7526-5A7B-501A-25DC7C9C282E}|
|Microsoft-Windows-Media-Streaming                                          |{982824E5-E446-46AE-BC74-836401FFB7B6}|
|Microsoft-Windows-MediaEngine                                              |{8F2048E0-F260-4F57-A8D1-932376291682}|
|Microsoft-Windows-MediaFoundation-MFCaptureEngine                          |{B8197C10-845F-40CA-82AB-9341E98CFC2B}|
|Microsoft-Windows-MediaFoundation-MFReadWrite                              |{4B7EAC67-FC53-448C-A49D-7CC6DB524DA7}|
|Microsoft-Windows-MediaFoundation-MSVProc                                  |{A4112D1A-6DFA-476E-BB75-E350D24934E1}|
|Microsoft-Windows-MediaFoundation-Performance                              |{F404B94E-27E0-4384-BFE8-1D8D390B0AA3}|
|Microsoft-Windows-MediaFoundation-Performance-Core                         |{B20E65AC-C905-4014-8F78-1B6A508142EB}|
|Microsoft-Windows-MediaFoundation-Platform                                 |{BC97B970-D001-482F-8745-B8D7D5759F99}|
|Microsoft-Windows-MediaFoundation-PlayAPI                                  |{B65471E1-019D-436F-BC38-E15FA8E87F53}|
|Microsoft-Windows-Memory-Diagnostic-Task-Handler                           |{BABDA89A-4D5E-48EB-AF3D-E0E8410207C0}|
|Microsoft-Windows-MemoryDiagnostics-Results                                |{5F92BC59-248F-4111-86A9-E393E12C6139}|
|Microsoft-Windows-MemoryDiagnostics-Schedule                               |{73E9C9DE-A148-41F7-B1DB-4DA051FDC327}|
|Microsoft-Windows-Minstore                                                 |{55B24B1D-DD9C-44C0-BA77-4F749F1B6976}|
|Microsoft-Windows-Mobile-Broadband-Experience-Api                          |{2E2BBB16-0C36-4B9B-A567-40924A199FD5}|
|Microsoft-Windows-Mobile-Broadband-Experience-Api-Internal                 |{2AABD03B-F48B-419A-B4CE-7A14403F4A46}|
|Microsoft-Windows-Mobile-Broadband-Experience-Parser-Task                  |{28E25B07-C47F-473D-8B24-2E171CCA808A}|
|Microsoft-Windows-Mobile-Broadband-Experience-SmsApi                       |{0FF1C24B-7F05-45C0-ABDC-3C8521BE4F62}|
|Microsoft-Windows-MobilityCenter                                           |{91F42016-0B4E-4A4B-9BBB-825D06CBED35}|
|Microsoft-Windows-ModernDeployment-Diagnostics-Provider                    |{BAB3AD92-FB96-5902-450B-B8421BDEC7BD}|
|Microsoft-Windows-MountMgr                                                 |{E3BAC9F8-27BE-4823-8D7F-1CC320C05FA7}|
|Microsoft-Windows-Mprddm                                                   |{3A5BEF13-D0F7-4E7F-9EC8-5E707DF711D0}|
|Microsoft-Windows-MsiServer                                                |{17E92E2A-3D08-413E-BAEB-A79A262BF486}|
|Microsoft-Windows-NCSI                                                     |{314DE49F-CE63-4779-BA2B-D616F6963A88}|
|Microsoft-Windows-NDF-HelperClassDiscovery                                 |{FC3BC8A7-2F61-449C-A8B4-22AC22058F92}|
|Microsoft-Windows-NDIS                                                     |{CDEAD503-17F5-4A3E-B7AE-DF8CC2902EB9}|
|Microsoft-Windows-NDIS-PacketCapture                                       |{2ED6006E-4729-4609-B423-3EE7BCD678EF}|
|Microsoft-Windows-NFC-ClassExtension                                       |{85C070E6-F9AE-481F-AACB-BC550BFD35A1}|
|Microsoft-Windows-NTLM                                                     |{AC43300D-5FCC-4800-8E99-1BD3F85F0320}|
|Microsoft-Windows-NWiFi                                                    |{0BD3506A-9030-4F76-9B88-3E8FE1F7CFB6}|
|Microsoft-Windows-Narrator                                                 |{835B79E2-E76A-44C4-9885-26AD122D3B4D}|
|Microsoft-Windows-Ncasvc                                                   |{126DED58-A28D-4113-8E7A-59D7444B2AF1}|
|Microsoft-Windows-NcdAutoSetup                                             |{EC23F986-AE2D-4269-B52F-4E20765C1A94}|
|Microsoft-Windows-NdisImPlatformEventProvider                              |{11C5D8AD-756A-42C2-8087-EB1B4A72A846}|
|Microsoft-Windows-NdisImPlatformSysEvtProvider                             |{62DE9E48-90C6-4755-8813-6A7D655B0802}|
|Microsoft-Windows-Ndu                                                      |{DF271536-4298-45E1-B0F2-E88F78619C5D}|
|Microsoft-Windows-NetAdapterCim-Diag                                       |{6CC2405D-817F-4886-886F-D5D1643210F0}|
|Microsoft-Windows-Netshell                                                 |{AF2E340C-0743-4F5A-B2D3-2F7225D215DE}|
|Microsoft-Windows-Network-Connection-Broker                                |{3EB875EB-8F4A-4800-A00B-E484C97D7551}|
|Microsoft-Windows-Network-DataUsage                                        |{5C1C9AB3-8689-4E41-90FA-85858306D7B7}|
|Microsoft-Windows-Network-Setup                                            |{A111F1C2-5923-47C0-9A68-D0BAFB577901}|
|Microsoft-Windows-Network-and-Sharing-Center                               |{6A502821-AB44-40C8-B32F-37315D9D52E0}|
|Microsoft-Windows-NetworkBridge                                            |{A67075C2-3E39-4109-B6CD-6D750058A731}|
|Microsoft-Windows-NetworkConnectivityStatus                                |{014DE49F-CE63-4779-BA2B-D616F6963A87}|
|Microsoft-Windows-NetworkGCW                                               |{BE932B00-0F8E-4386-AB89-873F7D0274AA}|
|Microsoft-Windows-NetworkManagerTriggerProvider                            |{9B307223-4E4D-4BF5-9BE8-995CD8E7420B}|
|Microsoft-Windows-NetworkProfile                                           |{FBCFAC3F-8459-419F-8E48-1F0B49CDB85E}|
|Microsoft-Windows-NetworkProfileTriggerProvider                            |{FBCFAC3F-8460-419F-8E48-1F0B49CDB85E}|
|Microsoft-Windows-NetworkProvider                                          |{1E9A4978-78C2-441E-8858-75B5D1326BC5}|
|Microsoft-Windows-NetworkProvisioning                                      |{93A19AB3-FB2C-46EB-91EF-56B0A318B983}|
|Microsoft-Windows-NetworkSecurity                                          |{7B702970-90BC-4584-8B20-C0799086EE5A}|
|Microsoft-Windows-NetworkStatus                                            |{7868B0D4-1423-4681-AFDF-27913575441E}|
|Microsoft-Windows-Networking-Correlation                                   |{83ED54F0-4D48-4E45-B16E-726FFD1FA4AF}|
|Microsoft-Windows-Networking-RealTimeCommunication                         |{1E39B4CE-D1E6-46CE-B65B-5AB05D6CC266}|
|Microsoft-Windows-NlaSvc                                                   |{63B530F8-29C9-4880-A5B4-B8179096E7B8}|
|Microsoft-Windows-Ntfs                                                     |{3FF37A1C-A68D-4D6E-8C9B-F79E8B16C482}|
|Microsoft-Windows-Ntfs-UBPM                                                |{8E6A5303-A4CE-498F-AFDB-E03A8A82B077}|
|Microsoft-Windows-OLE-Perf                                                 |{84958368-7DA7-49A0-B33D-07FABB879626}|
|Microsoft-Windows-OLEACC                                                   |{19D2C934-EE9B-49E5-AAEB-9CCE721D2C65}|
|Microsoft-Windows-OOBE-FirstLogonAnim                                      |{2D4C0C5E-6704-493A-A44B-F5ADD4FC9283}|
|Microsoft-Windows-OOBE-Machine-Core                                        |{EC276CDE-2A17-473C-A010-2FF78D5426D2}|
|Microsoft-Windows-OOBE-Machine-DUI                                         |{F5DBAA02-15D6-4644-A784-7032D508BF64}|
|Microsoft-Windows-OOBE-Machine-Plugins-Wireless                            |{0F352580-E9E2-46C2-8336-6AC66E986416}|
|Microsoft-Windows-OfflineFiles                                             |{95353826-4FBE-41D4-9C42-F521C6E86360}|
|Microsoft-Windows-OfflineFiles-CscApi                                      |{19EE4CF9-5322-4843-B0D8-BAB81BE4E81E}|
|Microsoft-Windows-OfflineFiles-CscDclUser                                  |{D5418619-C167-44D9-BC36-765BEB5D55F3}|
|Microsoft-Windows-OfflineFiles-CscFastSync                                 |{791CD79C-65B5-48A3-804C-786048994F47}|
|Microsoft-Windows-OfflineFiles-CscNetApi                                   |{361F227C-AA14-4D19-9007-0C8D1A8A541B}|
|Microsoft-Windows-OfflineFiles-CscService                                  |{89D89015-C0DF-414C-BC48-F50E114832BC}|
|Microsoft-Windows-OfflineFiles-CscUM                                       |{5E23B838-5B71-47E6-B123-6FE02EF573EF}|
|Microsoft-Windows-OneBackup                                                |{72561CF0-C85C-4F78-9E8D-CBA9093DF62D}|
|Microsoft-Windows-OneX                                                     |{AB0D8EF9-866D-4D39-B83F-453F3B8F6325}|
|Microsoft-Windows-OobeLdr                                                  |{75EBC33E-8670-4EB6-B535-3B9D6BB222FD}|
|Microsoft-Windows-OtpCredentialProviderEvt                                 |{5CAD485A-210F-4C16-80C5-F892DE74E28D}|
|Microsoft-Windows-OverlayFilter                                            |{46C78E5C-A213-46A8-8A6B-622F6916201D}|
|Microsoft-Windows-P2P-Mesh                                                 |{3333D2FC-3AEE-479F-985D-8BEBAE552B99}|
|Microsoft-Windows-P2P-PNRP                                                 |{BBBC81CF-E219-469C-A405-F820EE496194}|
|Microsoft-Windows-P2PIMSvc                                                 |{2992E9CF-4F99-48F5-A0B6-B99B11CD387D}|
|Microsoft-Windows-PCI                                                      |{1A9443D4-B099-44D6-8EB1-829B9C2FE290}|
|Microsoft-Windows-PDC                                                      |{A6BF0DEB-3659-40AD-9F81-E25AF62CE3C7}|
|Microsoft-Windows-PDFReader                                                |{DFA86FAA-2C55-4140-BFF9-5CC586217A7B}|
|Microsoft-Windows-PDH                                                      |{04D66358-C4A1-419B-8023-23B73902DE2C}|
|Microsoft-Windows-PNRPSvc                                                  |{BBE94F36-F8DC-4C33-8227-81602B7A3D53}|
|Microsoft-Windows-PackageStateRoaming                                      |{5B5AB841-7D2E-4A95-BB4F-095CDF66D8F0}|
|Microsoft-Windows-ParentalControls                                         |{01090065-B467-4503-9B28-533766761087}|
|Microsoft-Windows-Partition                                                |{412BDFF2-A8C4-470D-8F33-63FE0D8C20E2}|
|Microsoft-Windows-PeerToPeerDrtEventProvider                               |{40AE003C-6F3D-4590-AE1C-0E8BE526B50F}|
|Microsoft-Windows-PerceptionRuntime                                        |{ADD0DE40-32B0-4B58-9D5E-938B2F5C1D1F}|
|Microsoft-Windows-PerceptionSensorDataService                              |{85BE49EA-38F1-4547-A604-80060202FB27}|
|Microsoft-Windows-PerfCtrs                                                 |{973143DD-F3C7-4EF5-B156-544AC38C39B6}|
|Microsoft-Windows-PerfDisk                                                 |{7F9D83DE-8ABB-457F-98E8-4AD161449ECC}|
|Microsoft-Windows-PerfNet                                                  |{CAB2B8A5-49B9-4EEC-B1B0-FAC21DA05A3B}|
|Microsoft-Windows-PerfOS                                                   |{F82FB576-E941-4956-A2C7-A0CF83F6450A}|
|Microsoft-Windows-PerfProc                                                 |{72D211E1-4C54-4A93-9520-4901681B2271}|
|Microsoft-Windows-Perflib                                                  |{13B197BD-7CEE-4B4E-8DD0-59314CE374CE}|
|Microsoft-Windows-Performance-Recorder-Control                             |{36B6F488-AAD7-48C2-AFE3-D4EC2C8B46FA}|
|Microsoft-Windows-PersistentMemory-Nvdimm                                  |{A7F2235F-BE51-51ED-DECF-F4498812A9A2}|
|Microsoft-Windows-PersistentMemory-PmemDisk                                |{0FA2EE03-1FEB-5057-3BB3-EB25521B8482}|
|Microsoft-Windows-PersistentMemory-ScmBus                                  |{C03715CE-EA6F-5B67-4449-DA1D1E1AFEB8}|
|Microsoft-Windows-Photo-Image-Codec                                        |{BE3A31EA-AA6C-4196-9DCC-9CA13A49E09F}|
|Microsoft-Windows-PhotoAcq                                                 |{76CFA528-B26E-B773-62D0-9588270442A6}|
|Microsoft-Windows-PktMon                                                   |{4D4F80D9-C8BD-4D73-BB5B-19C90402C5AC}|
|Microsoft-Windows-PlayToManager                                            |{BB311100-2D9F-4CD3-B2D6-F4EA3839C548}|
|Microsoft-Windows-PortableDeviceStatusProvider                             |{8C63B5A5-B484-4381-892D-EDD424582DF7}|
|Microsoft-Windows-PortableDeviceSyncProvider                               |{A3E1697B-A12C-46B9-84D1-7FFE73C4B678}|
|Microsoft-Windows-PortableWorkspaces-Creator-Tool                          |{42D5F8CB-0D2B-4522-8059-C35A37C94A77}|
|Microsoft-Windows-Power-CAD                                                |{DABA4D32-CC40-4266-BB95-C30344DBC680}|
|Microsoft-Windows-Power-Meter-Polling                                      |{306C4E0B-E148-543D-315B-C618EB93157C}|
|Microsoft-Windows-Power-Troubleshooter                                     |{CDC05E28-C449-49C6-B9D2-88CF761644DF}|
|Microsoft-Windows-PowerCfg                                                 |{9F0C4EA8-EC01-4200-A00D-B9701CBEA5D8}|
|Microsoft-Windows-PowerCpl                                                 |{B1F90B27-4551-49D6-B2BD-DFC6453762A6}|
|Microsoft-Windows-PowerShell                                               |{A0C1853B-5C40-4B15-8766-3CF1C58F985A}|
|Microsoft-Windows-PowerShell-DesiredStateConfiguration-FileDownloadManager |{AAF67066-0BF8-469F-AB76-275590C434EE}|
|Microsoft-Windows-PrimaryNetworkIcon                                       |{8CE93926-BDAE-4409-9155-2FE4799EF4D3}|
|Microsoft-Windows-PrintBRM                                                 |{CF3F502E-B40D-4071-996F-00981EDF938E}|
|Microsoft-Windows-PrintService                                             |{747EF6FD-E535-4D16-B510-42C90F6873A1}|
|Microsoft-Windows-PrintService-USBMon                                      |{7F812073-B28D-4AFC-9CED-B8010F914EF6}|
|Microsoft-Windows-ProcessExitMonitor                                       |{FD771D53-8492-4057-8E35-8C02813AF49B}|
|Microsoft-Windows-ProcessStateManager                                      |{D49918CF-9489-4BF1-9D7B-014D864CF71F}|
|Microsoft-Windows-Processor-Aggregator                                     |{CBA16CF2-2FAB-49F8-89AE-894E718649E7}|
|Microsoft-Windows-Program-Compatibility-Assistant                          |{4CB314DF-C11F-47D7-9C04-65FB0051561B}|
|Microsoft-Windows-Provisioning-Diagnostics-Provider                        |{ED8B9BD3-F66E-4FF2-B86B-75C7925F72A9}|
|Microsoft-Windows-Proximity-Common                                         |{28058203-D394-4AFC-B2A6-2F9155A3BB95}|
|Microsoft-Windows-Push-To-Install-Service                                  |{3A718A68-6974-4075-ABD3-E8243CAEF398}|
|Microsoft-Windows-PushNotifications-Developer                              |{5CAD3597-5FEC-4C62-9CE1-9D7ABC723D3A}|
|Microsoft-Windows-PushNotifications-InProc                                 |{815A1F4A-3F8D-4B37-9B31-5142F9D724A5}|
|Microsoft-Windows-PushNotifications-Platform                               |{88CD9180-4491-4640-B571-E3BEE2527943}|
|Microsoft-Windows-QoS-Pacer                                                |{914ED502-B70D-4ADD-B758-95692854F8A3}|
|Microsoft-Windows-QoS-WMI-Diag                                             |{725BA9B3-C1F3-4518-AF1B-C8D669191E15}|
|Microsoft-Windows-QoS-qWAVE                                                |{6BA132C4-DA49-415B-A7F4-31870DC9FE25}|
|Microsoft-Windows-RPC                                                      |{6AD52B32-D609-4BE9-AE07-CE8DAE937E39}|
|Microsoft-Windows-RPC-Events                                               |{F4AED7C7-A898-4627-B053-44A7CAA12FCD}|
|Microsoft-Windows-RPC-FirewallManager                                      |{F997CD11-0FC9-4AB4-ACBA-BC742A4C0DD3}|
|Microsoft-Windows-RPC-Proxy-LBS                                            |{272A979B-34B5-48EC-94F5-7225A59C85A0}|
|Microsoft-Windows-RPCSS                                                    |{D8975F88-7DDB-4ED0-91BF-3ADF48C48E0C}|
|Microsoft-Windows-RRAS                                                     |{24989972-0967-4E21-A926-93854033638E}|
|Microsoft-Windows-RTWorkQueue-Extended                                     |{83FAAA86-63C8-4DD8-A2DA-FBADDDFC0655}|
|Microsoft-Windows-RTWorkQueue-Threading                                    |{E18D0FC9-9515-4232-98E4-89E456D8551B}|
|Microsoft-Windows-RadioManager                                             |{92061E3D-21CD-45BC-A3DF-0E8AE5E8580A}|
|Microsoft-Windows-Ras-AgileVpn                                             |{B5325CD6-438E-4EC1-AA46-14F46F2570E4}|
|Microsoft-Windows-Ras-NdisWanPacketCapture                                 |{D84521F7-2235-4237-A7C0-14E3A9676286}|
|Microsoft-Windows-RasServer                                                |{29D13147-1C2E-48EC-9994-E29DFE496EB3}|
|Microsoft-Windows-RasSstp                                                  |{6C260F2C-049A-43D8-BF4D-D350A4E6611A}|
|Microsoft-Windows-ReFS                                                     |{CD9C6198-BF73-4106-803B-C17D26559018}|
|Microsoft-Windows-ReFS-v1                                                  |{059F0F37-910E-4FF0-A7EE-AE8D49DD319B}|
|Microsoft-Windows-ReadyBoost                                               |{E6307A09-292C-497E-AAD6-498F68E2B619}|
|Microsoft-Windows-ReadyBoostDriver                                         |{2A274310-42D5-4019-B816-E4B8C7ABE95C}|
|Microsoft-Windows-Registry-SQM-Provider                                    |{017BA13C-9A55-4F1F-8200-323055AAC810}|
|Microsoft-Windows-Remote-FileSystem-Log                                    |{20C46239-D059-4214-A11E-7D6769CBE020}|
|Microsoft-Windows-Remote-FileSystem-Monitor                                |{51734B23-5B7E-4892-BA8E-45BC110B735C}|
|Microsoft-Windows-RemoteApp and Desktop Connections                        |{1B8B402D-78DC-46FB-BF71-46E64AEDF165}|
|Microsoft-Windows-RemoteAssistance                                         |{5B0A651A-8807-45CC-9656-7579815B6AF0}|
|Microsoft-Windows-RemoteDesktopServices-RdpCoreTS                          |{1139C61B-B549-4251-8ED3-27250A1EDEC8}|
|Microsoft-Windows-RemoteDesktopServices-RemoteFX-Synth3dvsc                |{3903D5B9-988D-4C31-9CCD-4022F96703F0}|
|Microsoft-Windows-RemoteDesktopServices-RemoteFX-VM-Kernel-Mode-Transport  |{7EB5F4CF-A4F6-4E92-AA8F-A8E7EF937745}|
|Microsoft-Windows-RemoteDesktopServices-RemoteFX-VM-User-Mode-Transport    |{741C6BE3-F74B-4E4D-88E7-5CE3A35FAEB3}|
|Microsoft-Windows-RemoteDesktopServices-SessionServices                    |{F1394DE0-32C7-4A76-A6DE-B245E48F4615}|
|Microsoft-Windows-Remotefs-Rdbss                                           |{1A870028-F191-4699-8473-6FCD299EAB77}|
|Microsoft-Windows-ResetEng                                                 |{A4445C76-ED85-C8A3-02C1-532A38614A9E}|
|Microsoft-Windows-ResetEng-Trace                                           |{7FA514B5-A023-4B62-A6AB-2946A483E065}|
|Microsoft-Windows-Resource-Exhaustion-Detector                             |{9988748E-C2E8-4054-85F6-0C3E1CAD2470}|
|Microsoft-Windows-Resource-Exhaustion-Resolver                             |{91F5FB12-FDEA-4095-85D5-614B495CD9DE}|
|Microsoft-Windows-ResourcePublication                                      |{74C2135F-CC76-45C3-879A-EF3BB1EEAF86}|
|Microsoft-Windows-RestartManager                                           |{0888E5EF-9B98-4695-979D-E92CE4247224}|
|Microsoft-Windows-RetailDemo                                               |{D3F29EDA-805D-428A-9902-B259B937F84B}|
|Microsoft-Windows-Runtime-Graphics                                         |{FA5CF675-72EB-49E2-B447-DE5552FAFF1C}|
|Microsoft-Windows-Runtime-Media                                            |{8F0DB3A8-299B-4D64-A4ED-907B409D4584}|
|Microsoft-Windows-Runtime-Networking                                       |{6EB875EB-8F4A-4800-A00B-E484C97D7561}|
|Microsoft-Windows-Runtime-Networking-BackgroundTransfer                    |{B9D5B35D-BBB8-4625-9450-F71A5D414F4F}|
|Microsoft-Windows-Runtime-Web-Http                                         |{41877CB4-11FC-4188-B590-712C143C881D}|
|Microsoft-Windows-Runtime-WebAPI                                           |{6BD96334-DC49-441A-B9C4-41425BA628D8}|
|Microsoft-Windows-SCPNP                                                    |{9F650C63-9409-453C-A652-83D7185A2E83}|
|Microsoft-Windows-SEC                                                      |{16C6501A-FF2D-46EA-868D-8F96CB0CB52D}|
|Microsoft-Windows-SENSE                                                    |{FAE96D09-ADE1-5223-0098-AF7B67348531}|
|Microsoft-Windows-SMBClient                                                |{988C59C5-0A1C-45B6-A555-0C62276E327D}|
|Microsoft-Windows-SMBDirect                                                |{DB66EA65-B7BB-4CA9-8748-334CB5C32400}|
|Microsoft-Windows-SMBServer                                                |{D48CE617-33A2-4BC3-A5C7-11AA4F29619E}|
|Microsoft-Windows-SMBWitnessClient                                         |{32254F6C-AA33-46F0-A5E3-1CBCC74BF683}|
|Microsoft-Windows-SPB-ClassExtension                                       |{72CD9FF7-4AF8-4B89-AEDE-5F26FDA13567}|
|Microsoft-Windows-SPB-HIDI2C                                               |{991F8FE6-249D-44D6-B93D-5A3060C1DEDB}|
|Microsoft-Windows-Schannel-Events                                          |{91CC1150-71AA-47E2-AE18-C96E61736B6F}|
|Microsoft-Windows-Sdbus                                                    |{FE28004E-B08F-4407-92B3-BAD3A2C51708}|
|Microsoft-Windows-Sdstor                                                   |{AFE654EB-0A83-4EB4-948F-D4510EC39C30}|
|Microsoft-Windows-Search                                                   |{CA4E628D-8567-4896-AB6B-835B221F373F}|
|Microsoft-Windows-Search-Core                                              |{49C2C27C-FE2D-40BF-8C4E-C3FB518037E7}|
|Microsoft-Windows-Search-ProfileNotify                                     |{FC6F77DD-769A-470E-BCF9-1B6555A118BE}|
|Microsoft-Windows-Search-ProtocolHandlers                                  |{DAB065A9-620F-45BA-B5D6-D6BB8EFEDEE9}|
|Microsoft-Windows-Security-Adminless                                       |{EA216962-877B-5B73-F7C5-8AEF5375959E}|
|Microsoft-Windows-Security-Audit-Configuration-Client                      |{08466062-AED4-4834-8B04-CDDB414504E5}|
|Microsoft-Windows-Security-Auditing                                        |{54849625-5478-4994-A5BA-3E3B0328C30D}|
|Microsoft-Windows-Security-EnterpriseData-FileRevocationManager            |{2CD58181-0BB6-463E-828A-056FF837F966}|
|Microsoft-Windows-Security-ExchangeActiveSyncProvisioning                  |{9249D0D0-F034-402F-A29B-92FA8853D9F3}|
|Microsoft-Windows-Security-IdentityListener                                |{3C6C422B-019B-4F48-B67B-F79A3FA8B4ED}|
|Microsoft-Windows-Security-IdentityStore                                   |{00B7E1DF-B469-4C69-9C41-53A6576E3DAD}|
|Microsoft-Windows-Security-Kerberos                                        |{98E6CFCB-EE0A-41E0-A57B-622D4E1B30B1}|
|Microsoft-Windows-Security-LessPrivilegedAppContainer                      |{45EEC9E5-4A1B-5446-7AD8-A4AB1313C437}|
|Microsoft-Windows-Security-Mitigations                                     |{FAE10392-F0AF-4AC0-B8FF-9F4D920C3CDF}|
|Microsoft-Windows-Security-Netlogon                                        |{E5BA83F6-07D0-46B1-8BC7-7E669A1D31DC}|
|Microsoft-Windows-Security-SPP                                             |{E23B33B0-C8C9-472C-A5F9-F2BDFEA0F156}|
|Microsoft-Windows-Security-SPP-UX                                          |{6BDADC96-673E-468C-9F5B-F382F95B2832}|
|Microsoft-Windows-Security-SPP-UX-GC                                       |{BBBDD6A3-F35E-449B-A471-4D830C8EDA1F}|
|Microsoft-Windows-Security-SPP-UX-GenuineCenter-Logging                    |{FB829150-CD7D-44C3-AF5B-711A3C31CEDC}|
|Microsoft-Windows-Security-SPP-UX-Notifications                            |{C4EFC9BB-2570-4821-8923-1BAD317D2D4B}|
|Microsoft-Windows-Security-UserConsentVerifier                             |{40783728-8921-45D0-B231-919037B4B4FD}|
|Microsoft-Windows-Security-Vault                                           |{E6C92FB8-89D7-4D1F-BE46-D56E59804783}|
|Microsoft-Windows-SecurityMitigationsBroker                                |{EA8CD8A5-78FF-4418-B292-AADC6A7181DF}|
|Microsoft-Windows-SendTo                                                   |{35642CF5-DA5E-410B-9D9C-A45F3638042B}|
|Microsoft-Windows-Sens                                                     |{BE69781C-B63B-41A1-8E24-A4FC7B3FC498}|
|Microsoft-Windows-SenseIR                                                  |{B6D775EF-1436-4FE6-BAD3-9E436319E218}|
|Microsoft-Windows-Sensors                                                  |{D8900E18-36CB-4548-966F-13F068D1F78E}|
|Microsoft-Windows-Sensors-Core                                             |{751C292B-23E6-58CF-1FD4-38F8512C66C2}|
|Microsoft-Windows-Sensors-Core-Performance                                 |{9E051EAA-7FEE-4F9F-8897-D86F3692E8AF}|
|Microsoft-Windows-Serial-ClassExtension                                    |{47BC9477-A8BA-452E-B951-4F2ED3593CF9}|
|Microsoft-Windows-Serial-ClassExtension-V2                                 |{EEE173EF-7ED2-45DE-9877-01C70A852FBD}|
|Microsoft-Windows-ServiceReportingApi                                      |{606A6A38-70EC-4309-B3A3-82FF86F73329}|
|Microsoft-Windows-ServiceTriggerPerfEventProvider                          |{6545939F-3398-411A-88B7-6A8914B8CEC7}|
|Microsoft-Windows-Services                                                 |{0063715B-EEDA-4007-9429-AD526F62696E}|
|Microsoft-Windows-Services-Svchost                                         |{06184C97-5201-480E-92AF-3A3626C5B140}|
|Microsoft-Windows-Servicing                                                |{BD12F3B8-FC40-4A61-A307-B7A013A069C1}|
|Microsoft-Windows-SettingSync                                              |{83D6E83B-900B-48A3-9835-57656B6F6474}|
|Microsoft-Windows-SettingSync-Azure                                        |{9F973C1D-D056-4E38-84A5-7BE81CDD6AB6}|
|Microsoft-Windows-SettingSync-Desktop                                      |{579402A2-883C-45D8-B70A-9BC856407751}|
|Microsoft-Windows-SettingSync-OneDrive                                     |{F43C3C35-22E2-53EB-F169-07594054779E}|
|Microsoft-Windows-Setup                                                    |{75EBC33E-997F-49CF-B49F-ECC50184B75D}|
|Microsoft-Windows-SetupCl                                                  |{75EBC33E-D017-4D0F-93AB-0B4F86579164}|
|Microsoft-Windows-SetupPlatform                                            |{530FB9B9-C515-4472-9313-FB346F9255E3}|
|Microsoft-Windows-SetupQueue                                               |{A615ACB9-D5A4-4738-B561-1DF301D207F8}|
|Microsoft-Windows-SetupUGC                                                 |{75EBC33E-0870-49E5-BDCE-9D7028279489}|
|Microsoft-Windows-ShareMedia-ControlPanel                                  |{02012A8A-ADF5-4FAB-92CB-CCB7BB3E689A}|
|Microsoft-Windows-SharedAccess_NAT                                         |{A6F32731-9A38-4159-A220-3D9B7FC5FE5D}|
|Microsoft-Windows-Shell-AppWizCpl                                          |{08D945EB-C8BD-44AA-994F-86079D8DCE35}|
|Microsoft-Windows-Shell-AuthUI                                             |{63D2BB1D-E39A-41B8-9A3D-52DD06677588}|
|Microsoft-Windows-Shell-ConnectedAccountState                              |{6DF57621-E7E4-410F-A7E9-E43EEB61B11F}|
|Microsoft-Windows-Shell-Core                                               |{30336ED4-E327-447C-9DE0-51B652C86108}|
|Microsoft-Windows-Shell-DefaultPrograms                                    |{65D99466-7A8E-489C-B8E1-962BC945031E}|
|Microsoft-Windows-Shell-LockScreenContent                                  |{A3C0D58A-9FE5-4F24-A2CE-E16DE8BAA0D2}|
|Microsoft-Windows-Shell-OpenWith                                           |{11BD2A68-77FF-4991-9658-F451F2EB6CE1}|
|Microsoft-Windows-Shell-Search-UriHandler                                  |{606C6FE0-A9DC-4A9D-BDEA-830AFF6716E7}|
|Microsoft-Windows-Shell-Shwebsvc                                           |{F61CEFC0-AA2E-11DA-A746-0800200C9A66}|
|Microsoft-Windows-Shell-ZipFolder                                          |{1F84007D-19CE-4B15-9E81-8A3DD8EB9ECB}|
|Microsoft-Windows-ShellCommon-StartLayoutPopulation                        |{97CA8142-10B1-4BAA-9FBB-70A7D11231C3}|
|Microsoft-Windows-Shsvcs                                                   |{059C3E04-5535-4929-85E1-93030E78F47B}|
|Microsoft-Windows-SleepStudy                                               |{D37687E7-8BF0-4D11-B589-A7ABE080756A}|
|Microsoft-Windows-SmartCard-Audit                                          |{09AC07B9-6AC9-43BC-A50F-58419A797C69}|
|Microsoft-Windows-SmartCard-DeviceEnum                                     |{AAEAC398-3028-487C-9586-44EACAD03637}|
|Microsoft-Windows-SmartCard-TPM-VCard-Module                               |{125F2CF1-2768-4D33-976E-527137D080F8}|
|Microsoft-Windows-SmartScreen                                              |{3CB2A168-FE34-4A4E-BDAD-DCF422F34473}|
|Microsoft-Windows-Smartcard-Server                                         |{4FCBF664-A33A-4652-B436-9D558983D955}|
|Microsoft-Windows-Smartcard-Trigger                                        |{AEDD909F-41C6-401A-9E41-DFC33006AF5D}|
|Microsoft-Windows-SmbWmiProvider                                           |{50B9E206-9D55-4092-92E8-F157A8235799}|
|Microsoft-Windows-SoftwareRestrictionPolicies                              |{7D29D58A-931A-40AC-8743-48C733045548}|
|Microsoft-Windows-Speech-TTS                                               |{74DCC47A-846E-4C98-9E2C-80043ED82B15}|
|Microsoft-Windows-Speech-UserExperience                                    |{13480A22-D79F-4334-9D32-AA239398AD3C}|
|Microsoft-Windows-Spell-Checking                                           |{D0E22EFC-AC66-4B25-A72D-382736B5E940}|
|Microsoft-Windows-SpellChecker                                             |{B2FCD41F-9A40-4150-8C92-B224B7D8C8AA}|
|Microsoft-Windows-Spellchecking-Host                                       |{1BDA2AB1-BBC1-4ACB-A849-C0EF2B249672}|
|Microsoft-Windows-SruMon                                                   |{C8DBF506-E3D3-4822-930D-84C557EB6247}|
|Microsoft-Windows-SrumTelemetry                                            |{48D445A8-2F64-4D49-B093-A5774D8DC531}|
|Microsoft-Windows-StartLmhosts                                             |{2D7904D8-5C90-4209-BA6A-4C08F409934C}|
|Microsoft-Windows-StartupRepair                                            |{C914F0DF-835A-4A22-8C70-732C9A80C634}|
|Microsoft-Windows-StateRepository                                          |{89592015-D996-4636-8F61-066B5D4DD739}|
|Microsoft-Windows-StorDiag                                                 |{F5D05B38-80A6-4653-825D-C414E4AB3C68}|
|Microsoft-Windows-StorPort                                                 |{C4636A1E-7986-4646-BF10-7BC3B4A76E8E}|
|Microsoft-Windows-Storage-Tiering                                          |{4A104570-EC6D-4560-A40F-858FA955E84F}|
|Microsoft-Windows-Storage-Tiering-IoHeat                                   |{990C55FC-2662-47F6-B7D7-EB3C027CB13F}|
|Microsoft-Windows-StorageManagement                                        |{7E58E69A-E361-4F06-B880-AD2F4B64C944}|
|Microsoft-Windows-StorageManagement-WSP-FS                                 |{435F8E4B-8CC4-430E-9796-28CAE4976576}|
|Microsoft-Windows-StorageManagement-WSP-Health                             |{B1F01D1A-AE3A-4940-81EE-DDCCBAD380EF}|
|Microsoft-Windows-StorageManagement-WSP-Host                               |{595F33EA-D4AF-4F4D-B4DD-9DACDD17FC6E}|
|Microsoft-Windows-StorageManagement-WSP-Spaces                             |{88C09888-118D-48FC-8863-E1C6D39CA4DF}|
|Microsoft-Windows-StorageSpaces-Driver                                     |{595F7F52-C90A-4026-A125-8EB5E083F15E}|
|Microsoft-Windows-StorageSpaces-ManagementAgent                            |{AA4C798D-D91B-4B07-A013-787F5803D6FC}|
|Microsoft-Windows-StorageSpaces-SpaceManager                               |{69C8CA7E-1ADF-472B-BA4C-A0485986B9F6}|
|Microsoft-Windows-Store                                                    |{9C2A37F3-E5FD-5CAE-BCD1-43DAFEEE1FF0}|
|Microsoft-Windows-Storsvc                                                  |{A963A23C-0058-521D-71EC-A1CCE6173F21}|
|Microsoft-Windows-Subsys-Csr                                               |{E8316A2D-0D94-4F52-85DD-1E15B66C5891}|
|Microsoft-Windows-Subsys-SMSS                                              |{43E63DA5-41D1-4FBF-ADED-1BBED98FDD1D}|
|Microsoft-Windows-Superfetch                                               |{99806515-9F51-4C2F-B918-1EAE407AA8CB}|
|Microsoft-Windows-Sysmon                                                   |{5770385F-C22A-43E0-BF4C-06F5698FFBD9}|
|Microsoft-Windows-Sysprep                                                  |{75EBC33E-77B8-4BA8-9474-4F4A9DB2F5C6}|
|Microsoft-Windows-System-Profile-HardwareId                                |{3419DE6D-5D7F-4668-ACC8-F80566814D96}|
|Microsoft-Windows-System-Restore                                           |{126CDB97-D346-4894-8A34-658DA5EEA1B6}|
|Microsoft-Windows-SystemEventsBroker                                       |{B6BFCC79-A3AF-4089-8D4D-0EECB1B80779}|
|Microsoft-Windows-SystemSettingsHandlers                                   |{FBBD52E1-DF97-529D-4B67-53F67DA99A98}|
|Microsoft-Windows-SystemSettingsThreshold                                  |{8BCDF442-3070-4118-8C94-E8843BE363B3}|
|Microsoft-Windows-TCPIP                                                    |{2F07E2EE-15DB-40F1-90EF-9D7BA282188A}|
|Microsoft-Windows-TPM-WMI                                                  |{7D5387B0-CBE0-11DA-A94D-0800200C9A66}|
|Microsoft-Windows-TSF-UIManager                                            |{4DD778B8-379C-4D8C-B659-517A43D6DF7D}|
|Microsoft-Windows-TSF-msctf                                                |{4FBA1227-F606-4E5F-B9E8-FAB9AB5740F3}|
|Microsoft-Windows-TSF-msutb                                                |{74B655A2-8958-410E-80E2-3457051B8DFF}|
|Microsoft-Windows-TZSync                                                   |{3527CB55-1298-49D4-AB94-1243DB0FCAFF}|
|Microsoft-Windows-TZUtil                                                   |{2D318B91-E6E7-4C46-BD04-BFE6DB412CF9}|
|Microsoft-Windows-TabletPC-CoreInkRecognition                              |{C2FA0899-8A10-412B-A42E-9E5B284A2437}|
|Microsoft-Windows-TabletPC-InputPanel                                      |{E978F84E-582D-4167-977E-32AF52706888}|
|Microsoft-Windows-TabletPC-InputPersonalization                            |{A8106E5C-293A-4CD0-9397-2E6FAC7F9749}|
|Microsoft-Windows-TabletPC-MathInput                                       |{8443CCB7-FEB0-4B8D-8E28-8D4C7CB814E8}|
|Microsoft-Windows-TabletPC-MathRecognizer                                  |{BDB462FC-A297-49A2-BF2E-4F1809E12ABC}|
|Microsoft-Windows-TabletPC-Platform-Input-Core                             |{B5FD844A-01D4-4B10-A57F-58B13B561582}|
|Microsoft-Windows-TabletPC-Platform-Input-Ninput                           |{2C3E6D9F-8298-450F-8E5D-49B724F1216F}|
|Microsoft-Windows-TabletPC-Platform-Input-Wisp                             |{E5AA2A53-30BE-40F5-8D84-AD3F40A404CD}|
|Microsoft-Windows-TabletPC-Platform-Manipulations                          |{2FD7A9A5-B1A1-4FC7-B95C-C32FED818F30}|
|Microsoft-Windows-TaskScheduler                                            |{DE7B24EA-73C8-4A09-985D-5BDADCFA9017}|
|Microsoft-Windows-TaskbarCPL                                               |{05D7B0F0-2121-4EFF-BF6B-ED3F69B894D7}|
|Microsoft-Windows-TerminalServices-ClientActiveXCore                       |{28AA95BB-D444-4719-A36F-40462168127E}|
|Microsoft-Windows-TerminalServices-ClientUSBDevices                        |{6E400999-5B82-475F-B800-CEF6FE361539}|
|Microsoft-Windows-TerminalServices-LocalSessionManager                     |{5D896912-022D-40AA-A3A8-4FA5515C76D7}|
|Microsoft-Windows-TerminalServices-MediaRedirection                        |{3F7B2F99-B863-4045-AD05-F6AFB62E7AF1}|
|Microsoft-Windows-TerminalServices-PnPDevices                              |{27A8C1E2-EB19-463E-8424-B399DF27A216}|
|Microsoft-Windows-TerminalServices-Printers                                |{952773BF-C2B7-49BC-88F4-920744B82C43}|
|Microsoft-Windows-TerminalServices-RdpSoundDriver                          |{127E0DC5-E13B-4935-985E-78FD508B1D80}|
|Microsoft-Windows-TerminalServices-RemoteConnectionManager                 |{C76BAA63-AE81-421C-B425-340B4B24157F}|
|Microsoft-Windows-TerminalServices-ServerUSBDevices                        |{DCBE5AAA-16E2-457C-9337-366950045F0A}|
|Microsoft-Windows-Tethering-Manager                                        |{CC311F1F-623C-4CA4-BA44-A458016555E8}|
|Microsoft-Windows-Tethering-Station                                        |{585CAB4F-9351-436E-9D99-DC4B41A20DE0}|
|Microsoft-Windows-TextPredictionEngine                                     |{39A63500-7D76-49CD-994F-FFD796EF5A53}|
|Microsoft-Windows-ThemeCPL                                                 |{61F044AF-9104-4CA5-81EE-CB6C51BB01AB}|
|Microsoft-Windows-ThemeUI                                                  |{869FB599-80AA-485D-BCA7-DB18D72B7219}|
|Microsoft-Windows-Thermal-Polling                                          |{E8A7C168-81EE-465C-8E8E-D39A2AC1CA41}|
|Microsoft-Windows-Threat-Intelligence                                      |{F4E1897C-BB5D-5668-F1D8-040F4D8DD344}|
|Microsoft-Windows-Time-Service                                             |{06EDCFEB-0FD0-4E53-ACCA-A6F8BBF81BCB}|
|Microsoft-Windows-Time-Service-PTP-Provider                                |{CFFB980E-327C-5B87-19C6-62C4C3BE2290}|
|Microsoft-Windows-TimeBroker                                               |{0657ADC1-9AE8-4E18-932D-E6079CDA5AB3}|
|Microsoft-Windows-TriggerEmulatorProvider                                  |{F230D19A-5D93-47D9-A83F-53829EDFB8DF}|
|Microsoft-Windows-Troubleshooting-Recommended                              |{4969DE67-439C-516F-F805-A82A4F905730}|
|Microsoft-Windows-TunnelDriver                                             |{4EDBE902-9ED3-4CF0-93E8-B8B5FA920299}|
|Microsoft-Windows-TunnelDriver-SQM-Provider                                |{4214DCD2-7C33-4F74-9898-719CCCEEC20F}|
|Microsoft-Windows-UAC                                                      |{E7558269-3FA5-46ED-9F4D-3C6E282DDE55}|
|Microsoft-Windows-UAC-FileVirtualization                                   |{C02AFC2B-E24E-4449-AD76-BCC2C2575EAD}|
|Microsoft-Windows-UI-Input-Inking                                          |{BF1DB390-3E67-4D4D-A287-8958044A3DB4}|
|Microsoft-Windows-UI-Search                                                |{D8965FCF-7397-4E0E-B750-21A4580BD880}|
|Microsoft-Windows-UI-Shell                                                 |{E3EE1525-8742-4E05-871B-DD2A60330C53}|
|Microsoft-Windows-UIAnimation                                              |{E0A40B26-30C4-4656-BC9A-74A5C3A0B2EC}|
|Microsoft-Windows-UIAutomationCore                                         |{820A42D8-38C4-465D-B64E-D7D56EA1D612}|
|Microsoft-Windows-UIRibbon                                                 |{87D476FE-1A0F-4370-B785-60B028019693}|
|Microsoft-Windows-URLMon                                                   |{245F975D-909D-49ED-B8F9-9A75691D6B6B}|
|Microsoft-Windows-USB-CCID                                                 |{F708C483-4880-11E6-9121-5CF37068B67B}|
|Microsoft-Windows-USB-MAUSBHOST                                            |{7725B5F9-1F2E-4E21-BAEB-B2AF4690BC87}|
|Microsoft-Windows-USB-UCX                                                  |{36DA592D-E43A-4E28-AF6F-4BC57C5A11E8}|
|Microsoft-Windows-USB-USBHUB                                               |{7426A56B-E2D5-4B30-BDEF-B31815C1A74A}|
|Microsoft-Windows-USB-USBHUB3                                              |{AC52AD17-CC01-4F85-8DF5-4DCE4333C99B}|
|Microsoft-Windows-USB-USBPORT                                              |{C88A4EF5-D048-4013-9408-E04B7DB2814A}|
|Microsoft-Windows-USB-USBXHCI                                              |{30E1D284-5D88-459C-83FD-6345B39B19EC}|
|Microsoft-Windows-UniversalTelemetryClient                                 |{6489B27F-7C43-5886-1D00-0A61BB2A375B}|
|Microsoft-Windows-User Device Registration                                 |{23B8D46B-67DD-40A3-B636-D43E50552C6D}|
|Microsoft-Windows-User Profiles General                                    |{DB00DFB6-29F9-4A9C-9B3B-1F4F9E7D9770}|
|Microsoft-Windows-User Profiles Service                                    |{89B1E9F0-5AFF-44A6-9B44-0A07A7CE5845}|
|Microsoft-Windows-User-ControlPanel                                        |{319122A9-1485-4E48-AF35-7DB2D93B8AD2}|
|Microsoft-Windows-User-Diagnostic                                          |{305FC87B-002A-5E26-D297-60223012CA9C}|
|Microsoft-Windows-User-Loader                                              |{B059B83F-D946-4B13-87CA-4292839DC2F2}|
|Microsoft-Windows-UserAccountControl                                       |{2683B597-3CCA-410A-97FE-6F7EE3D09B94}|
|Microsoft-Windows-UserDataAccess-CEMAPI                                    |{83A9277A-D2FC-4B34-BF81-8CEB4407824F}|
|Microsoft-Windows-UserDataAccess-CallHistoryClient                         |{F5988ABB-323A-4098-8A34-85A3613D4638}|
|Microsoft-Windows-UserDataAccess-PimIndexMaintenance                       |{99C66BA7-5A97-40D5-AA01-8A07FB3DB292}|
|Microsoft-Windows-UserDataAccess-Poom                                      |{0BD19909-EB6F-4B16-8074-6DCE803F091D}|
|Microsoft-Windows-UserDataAccess-UnifiedStore                              |{56F519AB-9DF6-4345-8491-A4BA21AC825B}|
|Microsoft-Windows-UserDataAccess-UserDataApis                              |{B9B2DE3C-3FBD-4F42-8FF7-33C3BAD35FD4}|
|Microsoft-Windows-UserDataAccess-UserDataService                           |{FB19EE2C-0D22-4A2E-969E-DD41AE0CE1A9}|
|Microsoft-Windows-UserDataAccess-UserDataUtils                             |{D1F688BF-012F-4AEC-A38C-E7D4649F8CD2}|
|Microsoft-Windows-UserModePowerService                                     |{CE8DEE0B-D539-4000-B0F8-77BED049C590}|
|Microsoft-Windows-UserPnp                                                  |{96F4A050-7E31-453C-88BE-9634F4E02139}|
|Microsoft-Windows-UxInit                                                   |{4154A29C-40D9-445F-8D65-24DA473E8F65}|
|Microsoft-Windows-UxTheme                                                  |{422088E6-CD0C-4F99-BD0B-6985FA290BDF}|
|Microsoft-Windows-VAN                                                      |{01578F96-C270-4602-ADE0-578D9C29FC0C}|
|Microsoft-Windows-VDRVROOT                                                 |{E4480490-85B6-11DD-AD8B-0800200C9A66}|
|Microsoft-Windows-VHDMP                                                    |{E2816346-87F4-4F85-95C3-0C79409AA89D}|
|Microsoft-Windows-VIRTDISK                                                 |{4D20DF22-E177-4514-A369-F1759FEEDEB3}|
|Microsoft-Windows-VPN-Client                                               |{3C088E51-65BE-40D1-9B90-62BFEC076737}|
|Microsoft-Windows-VWiFi                                                    |{314B2B0D-81EE-4474-B6E0-C2AAEC0DDBDE}|
|Microsoft-Windows-VerifyHardwareSecurity                                   |{F3F53C76-B06D-4F15-B412-61164A0D2B73}|
|Microsoft-Windows-Video-For-Windows                                        |{712ABB2D-D806-4B42-9682-26DA01D8B307}|
|Microsoft-Windows-Volume                                                   |{9F7B5DF4-B902-48BC-BC94-95068C6C7D26}|
|Microsoft-Windows-VolumeControl                                            |{07DE7879-1C96-41CE-AFBD-C659A0E8E643}|
|Microsoft-Windows-VolumeSnapshot-Driver                                    |{67FE2216-727A-40CB-94B2-C02211EDB34A}|
|Microsoft-Windows-WABSyncProvider                                          |{17F14A23-551D-40CC-A086-E4194D64ED4C}|
|Microsoft-Windows-WCN-Config-Registrar                                     |{C100BECF-D33A-4A4B-BF23-BBEF4663D017}|
|Microsoft-Windows-WCN-Config-Registrar-Secure                              |{C100BECC-D33A-4A4B-BF23-BBEF4663D017}|
|Microsoft-Windows-WCNWiz                                                   |{E8AA5402-26A1-455E-A21B-F240ED62D155}|
|Microsoft-Windows-WDAG-PolicyEvaluator-CSP                                 |{64A98C25-9E00-404E-84AD-6700DFE02529}|
|Microsoft-Windows-WDAG-PolicyEvaluator-GP                                  |{E53DF8BA-367A-4406-98D5-709FFB169681}|
|Microsoft-Windows-WEPHOSTSVC                                               |{D5F7235B-48E2-4E9C-92FE-0E4950ABA9E8}|
|Microsoft-Windows-WER-Diag                                                 |{AD8AA069-A01B-40A0-BA40-948D1D8DEDC5}|
|Microsoft-Windows-WER-PayloadHealth                                        |{4AFDDFDE-002D-51AC-C109-C3B7897858D0}|
|Microsoft-Windows-WER-SystemErrorReporting                                 |{ABCE23E7-DE45-4366-8631-84FA6C525952}|
|Microsoft-Windows-WFP                                                      |{0C478C5B-0351-41B1-8C58-4A6737DA32E3}|
|Microsoft-Windows-WHEA-Logger                                              |{C26C4F3C-3F66-4E99-8F8A-39405CFED220}|
|Microsoft-Windows-WLAN-AutoConfig                                          |{9580D7DD-0379-4658-9870-D5BE7D52D6DE}|
|Microsoft-Windows-WLAN-Driver                                              |{DAA6A96B-F3E7-4D4D-A0D6-31A350E6A445}|
|Microsoft-Windows-WLAN-MediaManager                                        |{323DAD74-D3EC-44A8-8B9D-CAFEB4999274}|
|Microsoft-Windows-WLGPA                                                    |{46098845-8A94-442D-9095-366A6BCFEFA9}|
|Microsoft-Windows-WMI                                                      |{1EDEEE53-0AFE-4609-B846-D8C0B2075B1F}|
|Microsoft-Windows-WMI-Activity                                             |{1418EF04-B0B4-4623-BF7E-D74AB47BBDAA}|
|Microsoft-Windows-WMP                                                      |{F3F14FF3-7B80-4868-91D0-D77E497B025E}|
|Microsoft-Windows-WMP-Setup_WM                                             |{0D759F0F-CFF9-4902-8867-EB9E29D7A98B}|
|Microsoft-Windows-WMPDMCUI                                                 |{3F9E07BD-0E26-4241-A5A5-28CAFA150A75}|
|Microsoft-Windows-WMPNSS-PublicAPI                                         |{614696C9-85AF-4E64-B389-D2C0DB4FF87B}|
|Microsoft-Windows-WMPNSS-Service                                           |{6A2DC7C1-930A-4FB5-BB44-80B30AEBED6C}|
|Microsoft-Windows-WMPNSSUI                                                 |{7C314E58-8246-47D1-8F7A-4049DC543E0B}|
|Microsoft-Windows-WMVENCOD                                                 |{313B0545-BF9C-492E-9173-8DE4863B8573}|
|Microsoft-Windows-WPD-API                                                  |{31569DCF-9C6F-4B8E-843A-B7C1CC7FFCBA}|
|Microsoft-Windows-WPD-CompositeClassDriver                                 |{355C44FE-0C8E-4BF8-BE28-8BC7B5A42720}|
|Microsoft-Windows-WPD-MTPBT                                                |{92AB58D3-F351-4AF5-9C72-D52F36EE2C92}|
|Microsoft-Windows-WPD-MTPClassDriver                                       |{21B7C16E-C5AF-4A69-A74A-7245481C1B97}|
|Microsoft-Windows-WPD-MTPIP                                                |{C374D21E-69B2-4CD7-9A25-62187C5A5619}|
|Microsoft-Windows-WPD-MTPUS                                                |{DCFC4489-9CE0-403C-99DF-A05422C60898}|
|Microsoft-Windows-WPDClassInstaller                                        |{AD5162D8-DAF0-4A25-88A7-01CBEB33902E}|
|Microsoft-Windows-WSC-SRV                                                  |{5857D6CA-9732-4454-809B-2A87B70881F8}|
|Microsoft-Windows-WUSA                                                     |{09608C12-C1DA-4104-A6FE-B959CF57560A}|
|Microsoft-Windows-WWAN-CFE                                                 |{71C993B8-1E28-4543-9886-FB219B63FDB3}|
|Microsoft-Windows-WWAN-MM-EVENTS                                           |{7839BB2A-2EA3-4ECA-A00F-B558BA678BEC}|
|Microsoft-Windows-WWAN-MediaManager                                        |{F4C9BE26-414F-42D7-B540-8BFF965E6D32}|
|Microsoft-Windows-WWAN-NDISUIO-EVENTS                                      |{B3EEE223-D0A9-40CD-ADFC-50F1888138AB}|
|Microsoft-Windows-WWAN-SVC-EVENTS                                          |{3CB40AAA-1145-4FB8-B27B-7E30F0454316}|
|Microsoft-Windows-Wallet                                                   |{6ED11B00-C1B5-48CB-AECC-FF72EBEFBAE8}|
|Microsoft-Windows-Wcmsvc                                                   |{67D07935-283A-4791-8F8D-FA9117F3E6F2}|
|Microsoft-Windows-WebAuth                                                  |{DB6972B6-DDDF-4820-84B1-2ED6AC0B96E5}|
|Microsoft-Windows-WebAuthN                                                 |{3AE1EA61-C002-47FB-B06C-4022A8C98929}|
|Microsoft-Windows-WebIO                                                    |{50B3E73C-9370-461D-BB9F-26F32D68887D}|
|Microsoft-Windows-WebServices                                              |{E04FE2E0-C6CF-4273-B59D-5C97C9C374A4}|
|Microsoft-Windows-WebcamExperience                                         |{9E12CEB1-E3FF-46AD-A0AA-11738B122D20}|
|Microsoft-Windows-WebdavClient-LookupServiceTrigger                        |{22B6D684-FA63-4578-87C9-EFFCBE6643C7}|
|Microsoft-Windows-Websocket-Protocol-Component                             |{CBA5F63C-E2CF-4B36-8305-BDE1311924FC}|
|Microsoft-Windows-WiFiDisplay                                              |{712880E9-7813-41A3-8E4C-E4E0C4F6580A}|
|Microsoft-Windows-WiFiHotspotService                                       |{814182FE-58F7-11E1-853C-78E7D1CA7337}|
|Microsoft-Windows-WiFiNetworkManager                                       |{E5C16D49-2464-4382-BB20-97A4B5465DB9}|
|Microsoft-Windows-Win32k                                                   |{8C416C79-D49B-4F01-A467-E56D3AA8234C}|
|Microsoft-Windows-WinHttp                                                  |{7D44233D-3055-4B9C-BA64-0D47CA40A232}|
|Microsoft-Windows-WinINet                                                  |{43D1A55C-76D6-4F7E-995C-64C711E5CAFE}|
|Microsoft-Windows-WinINet-Capture                                          |{A70FF94F-570B-4979-BA5C-E59C9FEAB61B}|
|Microsoft-Windows-WinINet-Config                                           |{5402E5EA-1BDD-4390-82BE-E108F1E634F5}|
|Microsoft-Windows-WinJson                                                  |{4637124C-1D40-4B4D-892F-2AAECF24FF06}|
|Microsoft-Windows-WinMDE                                                   |{77549803-7BB1-418B-A98E-F2E22F35A873}|
|Microsoft-Windows-WinML                                                    |{C8517E09-BEA2-5BB6-BEF3-50B4C91C431E}|
|Microsoft-Windows-WinNat                                                   |{66C07ECD-6667-43FC-93F8-05CF07F446EC}|
|Microsoft-Windows-WinQuic                                                  |{2BCFEFE5-5026-536B-1686-B249CB49CAE3}|
|Microsoft-Windows-WinRM                                                    |{A7975C8F-AC13-49F1-87DA-5A984A4AB417}|
|Microsoft-Windows-WinRT-Error                                              |{A86F8471-C31D-4FBC-A035-665D06047B03}|
|Microsoft-Windows-Windeploy                                                |{75EBC33E-C8AE-4F93-9CA1-683A53E20CB6}|
|Microsoft-Windows-Windows Defender                                         |{11CD958A-C507-4EF3-B3F2-5FD9DFBD2C78}|
|Microsoft-Windows-Windows Firewall With Advanced Security                  |{D1BC9AFF-2ABF-4D71-9146-ECB2A986EB85}|
|Microsoft-Windows-WindowsBackup                                            |{01979C6A-42FA-414C-B8AA-EEE2C8202018}|
|Microsoft-Windows-WindowsColorSystem                                       |{D53270E3-C8CF-4707-958A-DAD20C90073C}|
|Microsoft-Windows-WindowsSystemAssessmentTool                              |{11A75546-3234-465E-BEC8-2D301CB501AC}|
|Microsoft-Windows-WindowsToGo-StartupOptions                               |{2E6CB42E-161D-413B-A6C1-84CA4C1E5890}|
|Microsoft-Windows-WindowsUIImmersive                                       |{74827CBB-1E0F-45A2-8523-C605866D2F22}|
|Microsoft-Windows-WindowsUpdateClient                                      |{945A8954-C147-4ACD-923F-40C45405A658}|
|Microsoft-Windows-Wininit                                                  |{206F6DEA-D3C5-4D10-BC72-989F03C8B84B}|
|Microsoft-Windows-Winlogon                                                 |{DBE9B383-7CF3-4331-91CC-A3CB16A3B538}|
|Microsoft-Windows-Winsock-AFD                                              |{E53C6823-7BB8-44BB-90DC-3F86090D48A6}|
|Microsoft-Windows-Winsock-NameResolution                                   |{55404E71-4DB9-4DEB-A5F5-8F86E46DDE56}|
|Microsoft-Windows-Winsock-SQM                                              |{093DA50C-0BB9-4D7D-B95C-3BB9FCDA5EE8}|
|Microsoft-Windows-Winsock-WS2HELP                                          |{D5C25F9A-4D47-493E-9184-40DD397A004D}|
|Microsoft-Windows-Winsrv                                                   |{9D55B53D-449B-4824-A637-24F9D69AA02F}|
|Microsoft-Windows-Wired-AutoConfig                                         |{B92CF7FD-DC10-4C6B-A72D-1613BF25E597}|
|Microsoft-Windows-WlanConn                                                 |{239CFB83-CBB7-4BBC-A02E-9BDB496AA7C2}|
|Microsoft-Windows-WlanDlg                                                  |{D4AFA0DC-4DD1-40AF-AFCE-CB0D0E6736A7}|
|Microsoft-Windows-WlanPref                                                 |{CA5BA219-C0D4-4EFA-9CEB-72AFF92672B0}|
|Microsoft-Windows-Wordpad                                                  |{54FFD262-99FE-4576-96E7-1ADB500370DC}|
|Microsoft-Windows-WorkFolders                                              |{34A3697E-0F10-4E48-AF3C-F869B5BABEBB}|
|Microsoft-Windows-Workplace Join                                           |{76AB12D5-C986-4E60-9D7C-2A092B284CDD}|
|Microsoft-Windows-XAML                                                     |{531A35AB-63CE-4BCF-AA98-F88C7A89E455}|
|Microsoft-Windows-XAML-Diagnostics                                         |{59E7A714-73A4-4147-B47E-0957048C75C4}|
|Microsoft-Windows-XAudio2                                                  |{1EE3ABDB-C1FC-4B43-9E56-11064ABBA866}|
|Microsoft-Windows-XWizards                                                 |{777BA8FE-2498-4875-933A-3067DE883070}|
|Microsoft-Windows-exFAT-SQM                                                |{494E7A3D-8DB9-4EC4-B43E-2844AF6E38D6}|
|Microsoft-Windows-mobsync                                                  |{B44AEC44-38F4-4B59-8DF3-10306ABF19B2}|
|Microsoft-Windows-msmpeg2venc                                              |{D17B213A-C505-49C9-98CC-734253EF65D4}|
|Microsoft-Windows-ntshrui                                                  |{676F167F-F72C-446E-A498-EDA43319A5E3}|
|Microsoft-Windows-osk                                                      |{4F768BE8-9C69-4BBC-87FC-95291D3F9D0C}|
|Microsoft-Windows-stobject                                                 |{86133982-63D7-4741-928E-EF1349B80219}|
|Microsoft-Windows-wmvdecod                                                 |{55BACC9F-9AC0-46F5-968A-A5A5DD024F8A}|
|Microsoft-WindowsPhone-ConfigManager2                                      |{2F94E1CC-A8C5-4FE7-A1C3-53D7BDA8E73E}|
|Microsoft-WindowsPhone-CoreMessaging                                       |{922CDCF3-6123-42DA-A877-1A24F23E39C5}|
|Microsoft-WindowsPhone-CoreUIComponents                                    |{A0B7550F-4E9A-4F03-AD41-B8042D06A2F7}|
|Microsoft-WindowsPhone-LocationServiceProvider                             |{4D13548F-C7B8-4174-BB7A-D7F64BF22D29}|
|Microsoft-WindowsPhone-Net-Cellcore-CellManager                            |{9A6615A6-902A-4705-804B-57B8813089B8}|
|Microsoft-WindowsPhone-Net-Cellcore-CellularAPI                            |{6B7B5E3A-F4DE-42D9-9545-BAE12852D778}|
|Microsoft-WindowsPhone-Ufx                                                 |{E98EBDBF-3058-4784-8521-47860B1D2B8E}|
|Microsoft-WindowsPhone-UfxSynopsys                                         |{49B12C7C-4BD5-4F93-BB75-30FCE739600B}|
|Microsoft.Windows.ResourceManager                                          |{4180C4F7-E238-5519-338F-EC214F0B49AA}|
|Mobility Center Performance Trace                                          |{8A8B5246-6EB6-4339-8B59-B0085B9F4890}|
|Mobility Center Trace                                                      |{082DFF20-F430-11D9-8CD6-0800200C9A66}|
|Mount Manager Trace                                                        |{467C1914-37F0-4C7D-B6DB-5CD7DFE7BD5E}|
|NTLM Security Protocol                                                     |{C92CF544-91B3-4DC0-8E11-C580339A0BF8}|
|Native WIFI Filter Driver Trace                                            |{D905AC1C-65E7-4242-99EA-FE66A8355DF8}|
|Native WIFI MSM Trace                                                      |{D905AC1D-65E7-4242-99EA-FE66A8355DF8}|
|NetJoin                                                                    |{9741FD4E-3757-479F-A3C6-FC49F6D5EDD0}|
|Network Location Awareness Trace                                           |{1AC55562-D4FF-4BC5-8EF3-A18E07C4668E}|
|Network Profile Manager                                                    |{D9131565-E1DD-4C9E-A728-951999C2ADB5}|
|NisDrvWFP Provider                                                         |{49D6AD7B-52C4-4F79-A164-4DCD908391E4}|
|Ntfs                                                                       |{DD70BC80-EF44-421B-8AC3-CD31DA613A4E}|
|Ntfs_NtfsLog                                                               |{B2FC00C4-2941-4D11-983B-B16E8AA4E25D}|
|ODBC.1                                                                     |{F34765F6-A1BE-4B9D-1400-B8A12921F704}|
|ODBCBCP.1                                                                  |{932B59F1-90C2-D8BA-0956-3975C344AE2B}|
|OLEDB.1                                                                    |{0DD082C4-66F2-271F-74BA-2BF1F9F65C66}|
|OfficeAirSpace                                                             |{F562BB8E-422D-4B5C-B20E-90D710F7D11C}|
|OfficeLoggingLiblet                                                        |{F50D9315-E17E-43C1-8370-3EDF6CC057BE}|
|OpenSSH                                                                    |{C4B57D35-0636-4BC3-A262-370F249F9802}|
|PNPX AssocDB Trace                                                         |{7311AD03-18D6-45AC-9B08-B020BDD6A590}|
|Portable Device Connectivity API Trace                                     |{02FE721A-0725-469E-A26D-37B3C09FAAC1}|
|PrintFilterPipelineSvc_ObjectsGuid                                         |{AEFE45F4-8548-42B4-B1C8-25673B07AD8B}|
|RSS Platform Backgroundsync Perf Trace                                     |{CA1CF55C-9E49-4AD3-8038-39CB6F66AF11}|
|RSS Platform Backgroundsync Trace                                          |{F59D1D86-CC03-4736-BC9C-4C7936871B3D}|
|RSS Platform Perf Trace                                                    |{2B240425-3141-43EE-931F-EC9F997C7D7E}|
|RSS Platform Trace                                                         |{8C50FA6E-394E-4B47-B6D1-A880A5F225A2}|
|RefsWppTrace                                                               |{740F3C34-57DF-4BAD-8EEA-72AC69AD5DF5}|
|Refsv1WppTrace                                                             |{6D2FD9C5-8BD8-4A5D-8AA8-01E5C3B2AE23}|
|RmClient_RestartManager                                                    |{0888E5EF-9B98-4695-979D-E92CE4247224}|
|RowsetHelper.1                                                             |{74A75B02-36D8-EDE6-D10E-95B691503408}|
|SBP2 Port Driver Tracing Provider                                          |{6710597F-7319-4AAE-9B85-C8D87136A56B}|
|SD Bus Trace                                                               |{3B9E3DA4-70B8-46D3-9EF2-3DDF128BDED8}|
|SQLOLEDB_1                                                                 |{C5BFFE2E-9D87-D568-A09E-08FC83D0C7C2}|
|SQLSRV32.1                                                                 |{4B647745-F438-0A42-F870-5DBD29949C99}|
|Schannel                                                                   |{1F678132-5938-4686-9FDC-C8FF68F15C85}|
|Security: Kerberos Authentication                                          |{6B510852-3583-4E2D-AFFE-A67F9F223438}|
|Security: NTLM Authentication                                              |{5BBB6C18-AA45-49B1-A15F-085F7ED0AA90}|
|Security: SChannel                                                         |{37D2C3CD-C5D4-4587-8531-4696C44244C8}|
|Security: TSPkg                                                            |{6165F3E2-AE38-45D4-9B23-6B4818758BD9}|
|Security: WDigest                                                          |{FB6A424F-B5D6-4329-B9D5-A975B3A93EAD}|
|Sensor ClassExtension Trace                                                |{A1E89BB0-EF73-4980-8C99-DD15F7271D7E}|
|Service Control Manager                                                    |{555908D1-A6D7-4695-8E1E-26931D2012F4}|
|Service Control Manager Trace                                              |{EBCCA1C2-AB46-4A1D-8C2A-906C2FF25F39}|
|TCPIP Service Trace                                                        |{EB004A05-9B1A-11D4-9123-0050047759BC}|
|TPM                                                                        |{1B6B0772-251B-4D42-917D-FACA166BC059}|
|TS Client ActiveX Control Trace                                            |{DAA6CAF5-6678-43F8-A6FE-B40EE096E06E}|
|TS Client Trace                                                            |{0C51B20C-F755-48A8-8123-BF6DA2ADC727}|
|TS RDP Shell Trace                                                         |{BFA655DC-6C51-11DA-8BDE-F66BAD1E3F3A}|
|TS Rdp Init Trace                                                          |{C127C1A8-6CEB-11DA-8BDE-F66BAD1E3F3A}|
|TS Rdp Sound End Point Trace                                               |{5A966D1C-6B48-11DA-8BDE-F66BAD1E3F3A}|
|TerminalServer-MediaFoundationPlugin                                       |{4199EE71-D55D-47D7-9F57-34A1D5B2C904}|
|Thread Pool                                                                |{C861D0E2-A2C1-4D36-9F9C-970BAB943A12}|
|UMB Trace                                                                  |{96AB095A-9519-4F5C-81EE-C510B0A45463}|
|UMDF - Driver Manager Trace                                                |{485E7DEA-0A80-11D8-AD15-505054503030}|
|UMDF - Framework Trace                                                     |{485E7DE9-0A80-11D8-AD15-505054503030}|
|UMDF - Host Process Trace                                                  |{485E7DF0-0A80-11D8-AD15-505054503030}|
|UMDF - Lpc Driver Trace                                                    |{485E7DED-0A80-11D8-AD15-505054503030}|
|UMDF - Lpc Trace                                                           |{485E7DEF-0A80-11D8-AD15-505054503030}|
|UMDF - Platform Library Trace                                              |{485E7DE8-0A80-11D8-AD15-505054503030}|
|UMDF - Reflector Trace                                                     |{485E7DEE-0A80-11D8-AD15-505054503030}|
|UMDF - Test Trace                                                          |{485E7DEB-0A80-11D8-AD15-505054503030}|
|UMDF - WDF Core                                                            |{485E7DE9-0A80-11D8-AD15-505054503030}|
|UMPass Driver Trace                                                        |{FF9E2BDD-0E24-437C-84BE-7CFCAE635808}|
|USB Storage Driver Tracing Provider                                        |{72FB9358-A9B3-41E0-AE41-E8DECA41E3A8}|
|UmBus Driver Trace                                                         |{F9BE9C98-10DB-4318-BB61-CB0DDEA08BF7}|
|User-mode PnP Manager Trace                                                |{A676B545-4CFB-4306-A067-502D9A0F2220}|
|User32                                                                     |{B0AA8734-56F7-41CC-B2F4-DE228E98B946}|
|VSS tracing provider                                                       |{9138500E-3648-4EDB-AA4C-859E9F7B7C38}|
|Volsnap                                                                    |{CB017CD2-1F37-4E65-82BC-3E91F6A37559}|
|WINSATAPI_ETW_PROVIDER                                                     |{617853D6-728B-4B59-8A78-C3A9A5EADE92}|
|WLAN AutoConfig Trace                                                      |{0C5A3172-2248-44FD-B9A6-8389CB1DC56A}|
|WLAN Diagnostics Trace                                                     |{637A0F36-DFF5-4B2F-83DD-B106C1C725E2}|
|WLAN Dialog Trace                                                          |{520319A9-B932-4EC7-943C-61E560939101}|
|WLAN Extensibility Trace                                                   |{E2EB5B52-08B1-4391-B670-F58317376247}|
|WLAN HC Diagnostics Trace                                                  |{6DA4DDCA-0901-4BAE-9AD4-7E6030BAB531}|
|WMI_Tracing                                                                |{1FF6B227-2CA7-40F9-9A66-980EADAA602E}|
|WMI_Tracing_Client_Operations                                              |{8E6B6962-AB54-4335-8229-3255B919DD0E}|
|WMP Network Sharing API                                                    |{8ED60A3A-8C12-49C5-A518-FDF451BC10FC}|
|WMP Network Sharing Service                                                |{A7EB57F6-145E-4F18-BD75-DBBF6F7E23A7}|
|WMP Network Sharing Taskbar                                                |{D804A67F-4C25-43C1-896F-89FF78B3A911}|
|WPD API Trace                                                              |{C3C5D8AF-2FD5-4500-A8E7-379C2D0BBE2E}|
|WPD Bluetooth MTP Emumerator Driver Trace                                  |{4B6EFB94-30EA-49A7-BB29-E9ED9DCE67DA}|
|WPD BusEnumService Trace                                                   |{0381564E-D5CB-4E48-AB35-BE24389B0F59}|
|WPD ClassExtension Trace                                                   |{A0A352C5-B8EC-41E9-9936-8452C1C0A6CF}|
|WPD ClassInstaller Trace                                                   |{45350D79-4497-42F1-BD1B-83587575B91A}|
|WPD Composite Driver Trace                                                 |{72891EE8-C088-4331-9745-5BF4AA7B344D}|
|WPD FSDriver Trace                                                         |{1311095B-B9FF-497A-8560-2F43CA5438E4}|
|WPD ShellExtension Trace                                                   |{A42C7BD1-5AF3-4B32-9BC6-B85EB31D3F4A}|
|WPD ShellServiceObject Trace                                               |{1AB5AC29-037F-43A1-9484-78C9DB61F869}|
|WPD Types Trace                                                            |{58E8F67D-29E9-456C-B23D-C6489E341BB0}|
|WPD WMDMCompat Trace                                                       |{17ABF473-982C-4D0E-B502-3A59D89E71DE}|
|WPD WiaCompat Trace                                                        |{B809F4FF-3023-473C-971B-AB594429EA57}|
|WSAT_TraceProvider                                                         |{7F3FE630-462B-47C5-AB07-67CA84934ABD}|
|Windows Connect Now                                                        |{C100BECE-D33A-4A4B-BF23-BBEF4663D017}|
|Windows Defender Firewall API                                              |{28C9F48F-D244-45A8-842F-DC9FBC9B6E92}|
|Windows Defender Firewall API - GP                                         |{0EFF663F-8B6E-4E6D-8182-087A8EAA29CB}|
|Windows Defender Firewall Driver                                           |{D5E09122-D0B2-4235-ADC1-C89FAAAF1069}|
|Windows Defender Firewall NetShell Plugin                                  |{28C9F48F-D244-45A8-842F-DC9FBC9B6E94}|
|Windows Defender Firewall Service                                          |{5EEFEBDB-E90C-423A-8ABF-0241E7C5B87D}|
|Windows Kernel Trace                                                       |{9E814AAD-3204-11D2-9A82-006008A86939}|
|Windows Media Player Trace                                                 |{A9C1A3B7-54F3-4724-ADCE-58BC03E3BC78}|
|Windows NetworkItemFactory Trace                                           |{D2A60D61-0F87-4673-A86C-9C461457FE27}|
|Windows Notification Facility Provider                                     |{42695762-EA50-497A-9068-5CBBB35E0B95}|
|Windows Remote Management Trace                                            |{04C6E16D-B99F-4A3A-9B3E-B8325BBC781E}|
|Windows Wininit Trace                                                      |{C2BA06E2-F7CE-44AA-9E7E-62652CDEFE97}|
|Windows Winlogon Trace                                                     |{D451642C-63A6-11D7-9720-00B0D03E0347}|
|Windows-ApplicationModel-Store-SDK                                         |{FF79A477-C45F-4A52-8AE0-2B324346D4E4}|
|Wireless Client Trace                                                      |{8A3CF0B5-E0BC-450B-AE4B-61728FFA1D58}|
|Wudfx02000_KmdfTraceGuid                                                   |{485E7DE9-0A80-11D8-AD15-505054503030}|
|XWizard Framework                                                          |{777BA8FF-2498-4875-933A-3067DE883070}|
|msiscsi_iScsi                                                              |{1BABEFB4-59CB-49E5-9698-FD38AC830A91}|

```

`doc/events-table.md`:

```md
<table>
 <tr>
  <th>Event ID</th>
  <th>Channel</th>
  <th>Fields</th>
 </tr>
 <tr>
  <td>
   1
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>Ancestors</b>: System|C:\\Windows\\System32\\smss.exe|C:\\Windows\\System3 <br>
2\\smss.exe|C:\\Windows\\System32\\wininit.exe|C:\\Windows\\System32\\services.e <br>
xe <br>
   <b>CommandLine</b>: C:\\Windows\\system32\\SecurityHealthService.exe <br>
   <b>Company</b>: Microsoft Corporation <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>Description</b>: Windows Security Health Service <br>
   <b>FileVersion</b>: 4.18.1901.16384 (WinBuild.160101.0800) <br>
   <b>Hashes</b>: SHA1=6506644A113031DF428C20CF4C278468B0C6E017,MD5=FB82EE231870 <br>
0D2A1CF497636A9B4710,SHA256=0F0FD4B9DFD555E4A53AE9070447E330EAAF96FF51F012CD9821 <br>
57DEDFDDD9A6,IMPHASH=6317654951BFF89546F311B469BB379F <br>
   <b>Image</b>: C:\\Windows\\System32\\SecurityHealthService.exe <br>
   <b>ImageSize</b>: 913168 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>IntegrityTimeout</b>: false <br>
   <b>LogonGuid</b>: {515cd0d1-6e1f-5f22-e703-000000000000} <br>
   <b>LogonId</b>: 0x3e7 <br>
   <b>OriginalFileName</b>: SecurityHealthService.exe <br>
   <b>ParentCommandLine</b>: C:\\Windows\\system32\\services.exe <br>
   <b>ParentImage</b>: C:\\Windows\\System32\\services.exe <br>
   <b>ParentIntegrityLevel</b>: System <br>
   <b>ParentProcessGuid</b>: {515cd0d1-6e1f-5f22-0b00-000000004100} <br>
   <b>ParentProcessId</b>: 632 <br>
   <b>ParentProcessIntegrity</b>: -1 <br>
   <b>ParentServices</b>: N/A <br>
   <b>ParentUser</b>: NT AUTHORITY\\SYSTEM <br>
   <b>ProcessGuid</b>: {515cd0d1-6e40-5f22-8100-000000004100} <br>
   <b>ProcessId</b>: 6540 <br>
   <b>ProcessIntegrity</b>: -1 <br>
   <b>Product</b>: Microsoft® Windows® Operating System <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: SecurityHealthService <br>
   <b>TerminalSessionId</b>: 0 <br>
   <b>User</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   2
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: \C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershe <br>
ll.exe\  <br>
   <b>CreationUtcTime</b>: 2019-06-12 11:03:38.768 <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>Image</b>: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe <br>
   <b>ImageHashes</b>: SHA1=36C5D12033B2EAF251BAE61C00690FFB17FDDC87,MD5=CDA48FC <br>
75952AD12D99E526D0B6BF70A,SHA256=908B64B1971A979C7E3E8CE4621945CBA84854CB98D7636 <br>
7B791A6E22B5F6D53,IMPHASH=A7CEFACDDA74B13CD330390769752481 <br>
   <b>IntegrityLevel</b>: High <br>
   <b>PreviousCreationUtcTime</b>: 2020-07-30 06:53:07.109 <br>
   <b>ProcessGuid</b>: {515cd0d1-6e50-5f22-9500-000000004100} <br>
   <b>ProcessId</b>: 7220 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: N/A <br>
   <b>TargetFilename</b>: C:\\Users\\Generic\\AppData\\Roaming\\Microsoft\\Windo <br>
ws\\Recent\\CustomDestinations\\JXABLM89H2JOOX8OVGPR.temp <br>
   <b>User</b>: DESKTOP-LJRVE06\\Generic <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   3
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: C:\\Windows\\system32\\svchost.exe -k LocalServiceNetwork <br>
Restricted -p -s Dhcp <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>DestinationHostname</b>: - <br>
   <b>DestinationIp</b>: ff02:0:0:0:0:0:1:2 <br>
   <b>DestinationIsIpv6</b>: true <br>
   <b>DestinationPort</b>: 547 <br>
   <b>DestinationPortName</b>: - <br>
   <b>Image</b>: C:\\Windows\\System32\\svchost.exe <br>
   <b>ImageHashes</b>: SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99 <br>
E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464 <br>
418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69 <br>
   <b>Initiated</b>: true <br>
   <b>IntegrityLevel</b>: System <br>
   <b>ProcessGuid</b>: {515cd0d1-6e20-5f22-2100-000000004100} <br>
   <b>ProcessId</b>: 1424 <br>
   <b>Protocol</b>: udp <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: Dhcp <br>
   <b>SourceHostname</b>: - <br>
   <b>SourceIp</b>: fe80:0:0:0:2ccd:2156:e8b4:895d <br>
   <b>SourceIsIpv6</b>: true <br>
   <b>SourcePort</b>: 546 <br>
   <b>SourcePortName</b>: - <br>
   <b>User</b>: NT AUTHORITY\\LOCAL SERVICE <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   4
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>SchemaVersion</b>: 4.32 <br>
   <b>State</b>: Started <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
   <b>Version</b>: 11.10 <br>
  </td>
 </tr>
 <tr>
  <td>
   5
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: \\SystemRoot\\System32\\smss.exe 000000ac 00000088  <br>
   <b>CurrentDirectory</b>: C:\\Windows\\ <br>
   <b>Image</b>: C:\\Windows\\System32\\smss.exe <br>
   <b>ImageHashes</b>: SHA1=913D1903C43636A9D760D084B821908139651790,MD5=6CE9396 <br>
7F7235F88940092E88AD18AAB,SHA256=14A5FB352FD89A8969147FEEE9473BE2086391AF7D5AF0D <br>
2D5583F4A324826DF,IMPHASH=BC32B6662261DE8469D6EB034C62A6A5 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>ProcessGuid</b>: {515cd0d1-6e1e-5f22-0500-000000004100} <br>
   <b>ProcessId</b>: 416 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: gpsvc <br>
   <b>User</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   6
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>Hashes</b>: SHA1=D1F95AB2E3B6EF27639E72AE1335D9D00007698B,MD5=7DE33B6BCD21 <br>
13B39090D005BA5CFE9E,SHA256=1E84F2E321BB303320F6A40CC1EF22328BC162C9E433E4559F7D <br>
42160058EA78,IMPHASH=DE167A0100AD87EB2C9E1534AB9385B4 <br>
   <b>ImageLoaded</b>: C:\\Windows\\System32\\drivers\\null.sys <br>
   <b>ImageLoadedSize</b>: 7680 <br>
   <b>RuleName</b>: - <br>
   <b>Signature</b>: Microsoft Windows <br>
   <b>SignatureStatus</b>: Valid <br>
   <b>Signed</b>: true <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   7
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: %%SystemRoot%%\\system32\\csrss.exe ObjectDirectory=\\Win <br>
dows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=bas <br>
esrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=sxssrv,4 Profile <br>
Control=Off MaxRequestThreads=16 <br>
   <b>Company</b>: Microsoft Corporation <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>Description</b>: Client Server Runtime Process <br>
   <b>FileVersion</b>: 10.0.18362.1 (WinBuild.160101.0800) <br>
   <b>Hashes</b>: SHA1=2038501676866B87CEE4514CEFF77DAEA9729F30,MD5=23019322FFEC <br>
B179746210BE52D6DE60,SHA256=F2C7D894ABE8AC0B4C2A597CAA6B3EFE7AD2BDB4226845798D95 <br>
4C5AB9C9BF15,IMPHASH=A96FA9912E09E361274AD77F1A4B252C <br>
   <b>Image</b>: C:\\Windows\\System32\\csrss.exe <br>
   <b>ImageHashes</b>: SHA1=2038501676866B87CEE4514CEFF77DAEA9729F30,MD5=2301932 <br>
2FFECB179746210BE52D6DE60,SHA256=F2C7D894ABE8AC0B4C2A597CAA6B3EFE7AD2BDB42268457 <br>
98D954C5AB9C9BF15,IMPHASH=A96FA9912E09E361274AD77F1A4B252C <br>
   <b>ImageLoaded</b>: C:\\Windows\\System32\\csrss.exe <br>
   <b>ImageLoadedSize</b>: 17808 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>OriginalFileName</b>: CSRSS.Exe <br>
   <b>ParentCommandLine</b>: \\SystemRoot\\System32\\smss.exe 000000ac 00000088  <br>
 <br>
   <b>ParentImage</b>: C:\\Windows\\System32\\smss.exe <br>
   <b>ProcessGuid</b>: {515cd0d1-6e1e-5f22-0600-000000004100} <br>
   <b>ProcessId</b>: 424 <br>
   <b>Product</b>: Microsoft® Windows® Operating System <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: N/A <br>
   <b>Signature</b>: Microsoft Windows Publisher <br>
   <b>SignatureStatus</b>: Valid <br>
   <b>Signed</b>: true <br>
   <b>User</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   8
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   9
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s wuaus <br>
erv <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>Device</b>: \\Device\\HarddiskVolume2 <br>
   <b>Image</b>: C:\\Windows\\System32\\svchost.exe <br>
   <b>ImageHashes</b>: SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99 <br>
E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464 <br>
418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>ProcessGuid</b>: {515cd0d1-6e21-5f22-3d00-000000004100} <br>
   <b>ProcessId</b>: 2296 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: wuauserv <br>
   <b>User</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   10
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CallTrace</b>: C:\\Windows\\SYSTEM32\\ntdll.dll+9c524|C:\\Windows\\System3 <br>
2\\KERNELBASE.dll+6a685|c:\\windows\\system32\\lsm.dll+ff97|C:\\Windows\\System3 <br>
2\\RPCRT4.dll+76963|C:\\Windows\\System32\\RPCRT4.dll+da036|C:\\Windows\\System3 <br>
2\\RPCRT4.dll+37a5c|C:\\Windows\\System32\\RPCRT4.dll+548d8|C:\\Windows\\System3 <br>
2\\RPCRT4.dll+2c931|C:\\Windows\\System32\\RPCRT4.dll+2c1eb|C:\\Windows\\System3 <br>
2\\RPCRT4.dll+1a86f|C:\\Windows\\System32\\RPCRT4.dll+19d1a|C:\\Windows\\System3 <br>
2\\RPCRT4.dll+19301|C:\\Windows\\System32\\RPCRT4.dll+18d6e|C:\\Windows\\System3 <br>
2\\RPCRT4.dll+169a5|C:\\Windows\\SYSTEM32\\ntdll.dll+333fd|C:\\Windows\\SYSTEM32 <br>
\\ntdll.dll+34152|C:\\Windows\\System32\\KERNEL32.DLL+17944|C:\\Windows\\SYSTEM3 <br>
2\\ntdll.dll+6ce71 <br>
   <b>GrantedAccess</b>: 0x1000 <br>
   <b>RuleName</b>: - <br>
   <b>SourceHashes</b>: SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A9 <br>
9E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A46 <br>
4418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69 <br>
   <b>SourceImage</b>: C:\\Windows\\system32\\svchost.exe <br>
   <b>SourceIntegrityLevel</b>: System <br>
   <b>SourceProcessGUID</b>: {515cd0d1-6e1f-5f22-1200-000000004100} <br>
   <b>SourceProcessId</b>: 928 <br>
   <b>SourceServices</b>: LSM <br>
   <b>SourceThreadId</b>: 956 <br>
   <b>SourceUser</b>: NT AUTHORITY\\SYSTEM <br>
   <b>TargetHashes</b>: SHA1=9FE3BA25E5660C23DFE478D577CFACDE5795870C,MD5=03C709 <br>
33698C6E3E466076DD9C3FAA18,SHA256=AA52B2D3DD4B9B47FF4496C0460BDEDDA791354018CF07 <br>
82B899EF28ACEE8D21,IMPHASH=09FDE88C65E2BC5F1F90E96B673C52B1 <br>
   <b>TargetImage</b>: C:\\Windows\\system32\\lsass.exe <br>
   <b>TargetIntegrityLevel</b>: System <br>
   <b>TargetParentProcessGuid</b>: {515cd0d1-6e1e-5f22-0800-000000004100} <br>
   <b>TargetProcessGUID</b>: {515cd0d1-6e1f-5f22-0c00-000000004100} <br>
   <b>TargetProcessId</b>: 652 <br>
   <b>TargetServices</b>: KeyIso,SamSs <br>
   <b>TargetUser</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   11
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: \C:\\Program Files\\WindowsApps\\Microsoft.WindowsStore_1 <br>
2007.1001.2.0_x64__8wekyb3d8bbwe\\WinStore.App.exe\ -ServerName:App.AppXc75wvwne <br>
d5vhz4xyxxecvgdjhdkgsdza.mca <br>
   <b>CreationUtcTime</b>: 2020-07-21 06:16:09.011 <br>
   <b>CurrentDirectory</b>: C:\\Program Files\\WindowsApps\\Microsoft.WindowsSto <br>
re_12007.1001.2.0_x64__8wekyb3d8bbwe\\ <br>
   <b>Image</b>: C:\\Program Files\\WindowsApps\\Microsoft.WindowsStore_12007.10 <br>
01.2.0_x64__8wekyb3d8bbwe\\WinStore.App.exe <br>
   <b>ImageHashes</b>: SHA1=A70B1B664DFAD439CFEFACCBC6690E157DC23633,MD5=C1B3806 <br>
40D11FEC6CBB35FF20F58A17E,SHA256=3AF6BE21B6DFC06E3A3A78CC726CFA2007854244E74C8A4 <br>
21B09ECBE0C12EC61,IMPHASH=CA878514C158EF3E1C1EE824024717CA <br>
   <b>IntegrityLevel</b>: AppContainer <br>
   <b>ProcessGuid</b>: {515cd0d1-6e6f-5f22-9f00-000000004100} <br>
   <b>ProcessId</b>: 7960 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: N/A <br>
   <b>TargetFilename</b>: C:\\Users\\Generic\\AppData\\Local\\Packages\\Microsof <br>
t.WindowsStore_8wekyb3d8bbwe\\LocalCache\\perUserCache_0\\index <br>
   <b>User</b>: DESKTOP-LJRVE06\\Generic <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   12
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>EventType</b>: CreateKey <br>
   <b>Image</b>: System <br>
   <b>ProcessGuid</b>: {515cd0d1-6e1b-5f22-0100-000000004100} <br>
   <b>ProcessId</b>: 4 <br>
   <b>RuleName</b>: - <br>
   <b>TargetObject</b>: HKLM\\System\\CurrentControlSet\\Enum\\PCI\\VEN_8086&amp <br>
;DEV_2668&amp;SUBSYS_76808384&amp;REV_01\\3&amp;267a616a&amp;0&amp;28\\Device Pa <br>
rameters\\Interrupt Management <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   13
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>Details</b>: Binary Data <br>
   <b>EventType</b>: SetValue <br>
   <b>Image</b>: System <br>
   <b>ProcessGuid</b>: {515cd0d1-6e1b-5f22-0100-000000004100} <br>
   <b>ProcessId</b>: 4 <br>
   <b>RuleName</b>: - <br>
   <b>TargetObject</b>: HKLM\\System\\CurrentControlSet\\Enum\\STORAGE\\Volume\\ <br>
{1eeaac07-8cf7-11e9-9661-806e6f6e6963}#0000000000100000\\Properties\\{83da6326-9 <br>
7a6-4088-9453-a1923f573b29}\\0066\\(Default) <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   14
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   15
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   16
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   17
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: C:\\Windows\\System32\\svchost.exe -k LocalServiceNetwork <br>
Restricted -p -s EventLog <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>EventType</b>: CreatePipe <br>
   <b>Image</b>: C:\\Windows\\System32\\svchost.exe <br>
   <b>ImageHashes</b>: SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99 <br>
E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464 <br>
418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>PipeName</b>: \\Winsock2\\CatalogChangeListener-4fc-0 <br>
   <b>ProcessGuid</b>: {515cd0d1-6e20-5f22-1d00-000000004100} <br>
   <b>ProcessId</b>: 1276 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: EventLog <br>
   <b>User</b>: NT AUTHORITY\\LOCAL SERVICE <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   18
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: C:\\Windows\\system32\\wbem\\wmiprvse.exe -secured -Embed <br>
ding <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>EventType</b>: ConnectPipe <br>
   <b>Image</b>: C:\\Windows\\system32\\wbem\\wmiprvse.exe <br>
   <b>ImageHashes</b>: SHA1=51B8646308EE0B68AD1F7F1291B85395434DE49A,MD5=801E800 <br>
3C257C8F540B20F1E0DECD3A6,SHA256=A75C85F3B089993E9C042FB82ECB7757E8F460ED8065FC7 <br>
991CAA38A6DE0F50C,IMPHASH=CC058866636CC184AD452F88EE39368A <br>
   <b>IntegrityLevel</b>: System <br>
   <b>PipeName</b>: \\lsass <br>
   <b>ProcessGuid</b>: {515cd0d1-6e21-5f22-4100-000000004100} <br>
   <b>ProcessId</b>: 2744 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: N/A <br>
   <b>User</b>: NT AUTHORITY\\NETWORK SERVICE <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   19
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   20
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   21
  </td>
  <td>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
   22
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>CommandLine</b>: C:\\Windows\\System32\\spoolsv.exe <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>Image</b>: C:\\Windows\\System32\\spoolsv.exe <br>
   <b>ImageHashes</b>: SHA1=D5F2D846DC244E840BE558D9D21BF4BEF5FAA4D6,MD5=1096F67 <br>
170CCD4DCE97D2DE3FC421712,SHA256=A26658A11FB78B9EDB9189A7DF3CB69DF24AF1B57941543 <br>
F53FE5A90E02FEB8C,IMPHASH=3908F13E6362FF821A5A7A58C7C88A99 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>ProcessGuid</b>: {515cd0d1-6e21-5f22-3f00-000000004100} <br>
   <b>ProcessId</b>: 2476 <br>
   <b>QueryName</b>: DESKTOP-LJRVE06 <br>
   <b>QueryResults</b>: 10.0.2.15; <br>
   <b>QueryStatus</b>: 0 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: Spooler <br>
   <b>User</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
 <tr>
  <td>
   23
  </td>
  <td>
   Microsoft-Windows-Sysmon/Operational
  </td>
  <td>
   <b>Archived</b>: true <br>
   <b>CommandLine</b>: C:\\Windows\\system32\\svchost.exe -k LocalSystemNetworkR <br>
estricted -p -s SysMain <br>
   <b>CurrentDirectory</b>: C:\\Windows\\system32\\ <br>
   <b>Hashes</b>: SHA1=C8180192DDCFAC99F0A4AA693D155D2F04AB4577,MD5=250748E3EAE1 <br>
5E3277916ED7EC8E6D95,SHA256=9514A9D8A33DA79A67167EA64DCE2AFDEAA5A9184A35B40674F8 <br>
784166D9168A,IMPHASH=00000000000000000000000000000000 <br>
   <b>Image</b>: C:\\Windows\\system32\\svchost.exe <br>
   <b>ImageHashes</b>: SHA1=75C5A97F521F760E32A4A9639A653EED862E9C61,MD5=9520A99 <br>
E77D6196D0D09833146424113,SHA256=DD191A5B23DF92E12A8852291F9FB5ED594B76A28A5A464 <br>
418442584AFD1E048,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69 <br>
   <b>IntegrityLevel</b>: System <br>
   <b>IsExecutable</b>: false <br>
   <b>ProcessGuid</b>: {515cd0d1-6e20-5f22-2700-000000004100} <br>
   <b>ProcessId</b>: 1716 <br>
   <b>RuleName</b>: - <br>
   <b>Services</b>: SysMain <br>
   <b>TargetFilename</b>: C:\\Windows\\Prefetch\\WSL.EXE-59D55F1E.pf <br>
   <b>User</b>: NT AUTHORITY\\SYSTEM <br>
   <b>UtcTime</b>: 4242-04-24 13:37:42.422 <br>
  </td>
 </tr>
</table>

```

`event/event.go`:

```go
package event

import (
	"bytes"
	"crypto"
	"fmt"
	"strconv"
	"strings"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-etw/etw"
	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/whids/utils"
)

var (
	emptySha1 = strings.Repeat("0", crypto.SHA1.Size()*2)
)

type EdrData struct {
	Endpoint struct {
		UUID     string
		IP       string
		Hostname string
		Group    string
	}
	Event struct {
		Hash        string
		Detection   bool
		ReceiptTime time.Time
	}
}

type InnerEvent struct {
	*etw.Event
	EdrData   *EdrData          `json:",omitempty"`
	Detection *engine.Detection `json:",omitempty"`
	skip      bool
}

type EdrEvent struct {
	Event InnerEvent
}

func NewEdrEvent(e *etw.Event) *EdrEvent {
	return &EdrEvent{InnerEvent{Event: e}}
}

func (e *EdrEvent) InitEdrData() {
	e.Event.EdrData = &EdrData{}
}

func (e *EdrEvent) Commit() {
	if e.Event.EdrData != nil {
		e.Event.EdrData.Event.Hash = e.Hash()
	}
}

func (e *EdrEvent) Hash() string {
	var b []byte
	var err error

	edrData := e.Event.EdrData
	// null out EdrData as it does not come into hash calculation
	e.Event.EdrData = nil

	b, err = utils.Json(e)
	// we restore EdrData
	e.Event.EdrData = edrData
	if err != nil {
		return emptySha1
	}

	return data.Sha1(bytes.Trim(b, " \n\r\t"))
}

func (e *EdrEvent) GetStringOr(p *engine.XPath, or string) string {
	if s, ok := e.GetString(p); ok {
		return s
	}
	return or
}

func (e *EdrEvent) GetString(p *engine.XPath) (s string, ok bool) {
	var i interface{}

	if i, ok = e.Get(p); ok {
		s, ok = i.(string)
		return
	}

	return
}

func (e *EdrEvent) GetInt(p *engine.XPath) (i int64, ok bool) {
	var s string
	var err error

	if s, ok = e.GetString(p); ok {
		if i, err = strconv.ParseInt(s, 0, 64); err == nil {
			return
		}
	}
	return
}

func (e *EdrEvent) GetIntOr(p *engine.XPath, or int64) int64 {
	if i, ok := e.GetInt(p); ok {
		return i
	}
	return or
}

func (e *EdrEvent) GetUint(p *engine.XPath) (i uint64, ok bool) {
	var s string
	var err error

	if s, ok = e.GetString(p); ok {
		if i, err = strconv.ParseUint(s, 0, 64); err == nil {
			return
		}
	}
	return
}

func (e *EdrEvent) GetUintOr(p *engine.XPath, or uint64) uint64 {
	if u, ok := e.GetUint(p); ok {
		return u
	}
	return or
}

func (e *EdrEvent) GetBool(p *engine.XPath) (b bool, ok bool) {
	var s string
	var err error

	if s, ok = e.GetString(p); ok {
		if b, err = strconv.ParseBool(s); err == nil {
			return
		}
	}

	return
}

// SetIfOr set value if cond == true
func (e *EdrEvent) SetIf(p *engine.XPath, value interface{}, cond bool) (err error) {
	if cond {
		return e.Set(p, value)
	}
	return nil
}

// SetIfOr set value if cond == true or other
func (e *EdrEvent) SetIfOr(p *engine.XPath, value interface{}, cond bool, other interface{}) (err error) {
	if cond {
		return e.Set(p, value)
	}
	return e.Set(p, other)
}

func (e *EdrEvent) SetIfMissing(p *engine.XPath, i interface{}) (err error) {
	if _, ok := e.Get(p); ok {
		// nothing to do as the field already exists
		return
	}

	return e.Set(p, i)
}

func (e *EdrEvent) Set(p *engine.XPath, i interface{}) (err error) {
	switch {
	case p.Flags.EventDataField:
		e.Event.EventData[p.Last()] = i
		return
	case p.Flags.UserDataField:
		e.Event.UserData[p.Last()] = i
		return
	}
	return fmt.Errorf("unknown path: %s", p)
}

func (e *EdrEvent) SetDetection(d *engine.Detection) {
	if d != nil {
		// we make the choice not to set detection when it is empty
		if d.Criticality > 0 || len(d.ATTACK) > 0 {
			e.Event.Detection = d
			return
		}
		if d.Signature != nil {
			if d.Signature.Len() > 0 {
				e.Event.Detection = d
				return
			}
		}
		if d.Actions != nil {
			if d.Actions.Len() > 0 {
				e.Event.Detection = d
				return

			}
		}
	}
}

func (e *EdrEvent) Get(p *engine.XPath) (i interface{}, ok bool) {
	switch {
	case p.Flags.EventDataField:
		i, ok = e.Event.EventData[p.Last()]
		return
	case p.Flags.UserDataField:
		i, ok = e.Event.UserData[p.Last()]
		return
	}
	return nil, false
}

func (e *EdrEvent) IsDetection() bool {
	if e.Event.Detection != nil {
		return e.Event.Detection.IsAlert()
	}
	return false
}

// Skip mark the event to be skipped subsequent calls
// to IsSkipped will return true
func (e *EdrEvent) Skip() {
	e.Event.skip = true
}

// IsSkipped returns true if the event has been marked
// to be skipped
func (e *EdrEvent) IsSkipped() bool {
	return e.Event.skip
}

func (e *EdrEvent) GetDetection() *engine.Detection {
	return e.Event.Detection
}

func (e *EdrEvent) Channel() string {
	return e.Event.System.Channel
}

func (e *EdrEvent) Computer() string {
	return e.Event.System.Computer
}

func (e *EdrEvent) EventID() int64 {
	return int64(e.Event.System.EventID)
}

func (e *EdrEvent) Timestamp() time.Time {
	return e.Event.System.TimeCreated.SystemTime
}

func (er *EdrEvent) Copy() (new *EdrEvent) {
	etwEvent := *er.Event.Event
	new = NewEdrEvent(&etwEvent)
	new.Event.EdrData = er.Event.EdrData
	new.Event.Detection = er.Event.Detection
	return
}

```

`event/event_test.go`:

```go
package event

import (
	"bytes"
	"encoding/json"
	"math/rand"
	"os"
	"testing"
	"time"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golang-utils/readers"
	"github.com/0xrawsec/toast"
)

var (
	eventFile = "./data/events.json"
	events    = make([]EdrEvent, 0)
	eventData = "/Event/EventData/"
)

const (
	day   = time.Hour * 24
	month = day * 30
)

func init() {
	data, err := os.ReadFile(eventFile)
	if err != nil {
		panic(err)
	}
	for line := range readers.Readlines(bytes.NewBuffer(data)) {
		event := EdrEvent{}
		json.Unmarshal(line, &event)
		events = append(events, event)
	}
}

func emitEvents(count int, random bool) (ce chan *EdrEvent) {
	ce = make(chan *EdrEvent)
	go func() {
		defer close(ce)
		for i := 0; i < count; i++ {
			i := rand.Int() % len(events)
			// we need to use a copy of the event as event
			// contains some pointer making shalow copy
			// copying that pointer too
			e := events[i].Copy()
			newTimestamp := time.Now()
			if random {
				delayMin := time.Duration(rand.Int()%120) * time.Minute
				if rand.Int()%2 == 0 {
					newTimestamp = newTimestamp.Add(-delayMin)
				} else {
					newTimestamp = newTimestamp.Add(delayMin)
				}
			}
			e.Event.System.TimeCreated.SystemTime = newTimestamp
			ce <- e
		}
	}()
	return
}

func TestEventWithAction(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)
	str := `{"Event":{"EventData":{"AccessList":"%%4416\r\n\t\t\t\t","AccessMask":"0x1","CommandLine":"\"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\" ","HandleId":"0x1350","ImageHashes":"SHA1=957004ABEEF46EF5B5365F668F26868434E4D040,MD5=74859601FB4BEEA84B40D874CCB56CAB,SHA256=A35C86CCD3E26316C45A0E63EFA9CDD1E9D3B01B23F7829EAD9106FA5340066D,IMPHASH=891D2BAFA4260189E94CAC8FB19F369A","ObjectName":"C:\\Windows\\readme.pdf","ObjectServer":"Security","ObjectType":"File","ProcessGuid":"{515cd0d1-2921-6152-721b-000000008200}","ProcessId":"0xD8C","ProcessName":"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe","ResourceAttributes":"S:AI","SubjectDomainName":"DESKTOP-LJRVE06","SubjectLogonId":"0x361D5","SubjectUserName":"Generic","SubjectUserSid":"S-1-5-21-2915380141-4195670196-3871645020-1001"},"System":{"Channel":"Security","Computer":"DESKTOP-LJRVE06","EventID":4663,"Execution":{"ProcessID":4,"ThreadID":7136},"Keywords":{"Value":9232379236109517000,"Name":""},"Level":{"Value":0,"Name":""},"Opcode":{"Value":0,"Name":"Info"},"Task":{"Value":0,"Name":""},"Provider":{"Guid":"{54849625-5478-4994-A5BA-3E3B0328C30D}","Name":"Microsoft-Windows-Security-Auditing"},"TimeCreated":{"SystemTime":"2021-09-27T20:27:28.7685432Z"}},"Detection":{"Signature":["Builtin:CanaryAccessed"],"Criticality":10,"Actions":["kill","memdump","filedump","blacklist","report"]}}}`
	event := EdrEvent{}
	if err := json.Unmarshal([]byte(str), &event); err != nil {
		t.Error(err)
	}
	h := event.Hash()
	tt.Assert(h != emptySha1)
	for i := 0; i < 10000; i++ {
		// testing hash stability
		tt.Assert(h == event.Hash())
	}
}

func TestEventHashStability(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)
	for event := range emitEvents(10000, true) {
		h := event.Hash()
		tt.Assert(h != emptySha1)
		for i := 0; i < 100; i++ {
			tt.Assert(h == event.Hash())
		}
	}
}

func TestEventGetters(t *testing.T) {
	t.Parallel()
	str := `
	{
	"Event": {
		"EventData": {
		"Ancestors": "C:\\Windows\\System32\\services.exe",
		"CommandLine": "\"C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe\" /svc",
		"Company": "Google LLC",
		"CurrentDirectory": "C:\\Windows\\system32\\",
		"Description": "Google Installer",
		"FileVersion": "1.3.36.81",
		"Hashes": "SHA1=12950D906FF703F3A1E0BD973FCA2B433E5AB207,MD5=9A66A3DE2589F7108426AF37AB7F6B41,SHA256=A913415626433D5D0F07D3EC4084A67FF6F5138C3C3F64E36DD0C1AE4C423C65,IMPHASH=7DF1816239C5BC855600D41210406C5B",
		"Image": "C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe",
		"ImageSize": "154456",
		"IntegrityLevel": "System",
		"LogonGuid": "{515cd0d1-405a-6126-e703-000000000000}",
		"LogonId": "0x3E7",
		"OriginalFileName": "GoogleUpdate.exe",
		"ParentCommandLine": "C:\\Windows\\system32\\services.exe",
		"ParentImage": "C:\\Windows\\System32\\services.exe",
		"ParentIntegrityLevel": "?",
		"ParentProcessGuid": "{515cd0d1-405a-6126-0b00-000000008200}",
		"ParentProcessId": "688",
		"ParentServices": "?",
		"ParentUser": "?",
		"ProcessGuid": "{515cd0d1-322e-614e-9c12-000000008200}",
		"ProcessId": "1928",
		"Product": "Google Update",
		"RuleName": "-",
		"Services": "gupdate",
		"TerminalSessionId": "0",
		"User": "NT AUTHORITY\\SYSTEM",
		"UtcTime": "2021-09-24 20:16:46.328"
		},
		"System": {
		"Channel": "Microsoft-Windows-Sysmon/Operational",
		"Computer": "DESKTOP-LJRVE06",
		"EventID": 1,
		"Execution": {
			"ProcessID": 3296,
			"ThreadID": 2628
		},
		"Keywords": {
			"Value": 9223372036854776000,
			"Name": ""
		},
		"Level": {
			"Value": 4,
			"Name": "Information"
		},
		"Opcode": {
			"Value": 0,
			"Name": "Info"
		},
		"Task": {
			"Value": 0,
			"Name": ""
		},
		"Provider": {
			"Guid": "{5770385F-C22A-43E0-BF4C-06F5698FFBD9}",
			"Name": "Microsoft-Windows-Sysmon"
		},
		"TimeCreated": {
			"SystemTime": "2021-08-28T14:49:40.20152Z"
		}
		},
		"EdrData": {
		"Endpoint": {
			"UUID": "03e31275-2277-d8e0-bb5f-480fac7ee4ef",
			"IP": "192.168.56.110",
			"Hostname": "DESKTOP-LJRVE06",
			"Group": "HR"
		},
		"Event": {
			"Hash": "e07dba161abdc26a7145b44019fb66ad6a6c26ed",
			"Detection": true,
			"ReceiptTime": "2021-09-24T20:16:47.84472107Z"
		}
		},
		"Detection": {
		"Signature": [
			"UnknownServices"
		],
		"Criticality": 10,
		"Actions": []
		}
	}
	}
	`
	tt := toast.FromT(t)
	event := EdrEvent{}

	tt.CheckErr(json.Unmarshal([]byte(str), &event))

	processId := engine.Path(eventData + "ProcessId")
	description := engine.Path(eventData + "Description")
	unknown := engine.Path(eventData + "Unknown")
	tt.CheckErr(event.SetIfOr(processId, "666", true, "1928"))
	tt.CheckErr(event.SetIfOr(processId, "666", false, "1928"))
	tt.CheckErr(event.SetIf(processId, "42", true))
	tt.CheckErr(event.SetIf(processId, "1928", true))
	tt.Assert(event.GetIntOr(processId, -1) == 1928)
	tt.Assert(event.GetIntOr(unknown, -1) == -1)
	tt.Assert(event.GetUintOr(processId, 0) == 1928)
	tt.Assert(event.GetUintOr(unknown, 0) == 0)
	tt.Assert(event.GetStringOr(description, "?") == "Google Installer")
	tt.Assert(event.GetStringOr(unknown, "?") == "?")

	// testing SetIfMissing
	// description is there so the attempt to set the value should fail
	tt.CheckErr(event.SetIfMissing(description, "?"))
	tt.Assert(event.GetStringOr(description, "?") == "Google Installer")
	// unknown is not set so it should set it
	tt.CheckErr(event.SetIfMissing(unknown, "unk"))
	tt.Assert(event.GetStringOr(unknown, "?") == "unk")

	// skip event
	tt.Assert(!event.IsSkipped())
	event.Skip()
	tt.Assert(event.IsSkipped())

	tt.Assert(event.Channel() == "Microsoft-Windows-Sysmon/Operational")
	tt.Assert(event.IsDetection())
	tt.Assert(event.GetDetection().Criticality == 10)
	event.SetDetection(nil)
	event.SetDetection(&engine.Detection{Criticality: 0})
	event.Event.Detection = nil
	tt.Assert(!event.IsDetection(), "Event should not be a detection")
	tt.Assert(event.Computer() == "DESKTOP-LJRVE06", "Wrong computer name")
	tt.Assert(event.EventID() == 1, "Wrong event ID")
	ts, _ := time.Parse(time.RFC3339Nano, "2021-08-28T14:49:40.20152Z")
	tt.Assert(event.Timestamp().Equal(ts), "Wrong timestamp")

	tt.Assert(event.Event.EdrData.Endpoint.Hostname == event.Computer(), "Wrong computer name")
	event.InitEdrData()
	tt.Assert(event.Event.EdrData.Endpoint.Hostname == "", "Computer name must be empty")
}

```

`go.mod`:

```mod
module github.com/0xrawsec/whids

require (
	github.com/0xrawsec/crony v1.0.4
	github.com/0xrawsec/gene/v2 v2.3.0
	github.com/0xrawsec/golang-etw v1.6.2
	github.com/0xrawsec/golang-utils v1.3.2
	github.com/0xrawsec/golang-win32 v1.0.14
	github.com/0xrawsec/golog v1.0.3
	github.com/0xrawsec/sod v1.10.1
	github.com/0xrawsec/toast v1.2.3
	github.com/google/shlex v0.0.0-20191202100458-e7afc7fbc510
	github.com/google/uuid v1.3.0
	github.com/gorilla/mux v1.8.0
	github.com/gorilla/websocket v1.4.2
	github.com/pelletier/go-toml/v2 v2.0.5
	golang.org/x/sys v0.0.0-20190909082730-f460065e899a
)

require (
	github.com/pelletier/go-toml v1.9.3 // indirect
	golang.org/x/tools v0.0.0-20190625160430-252024b82959 // indirect
)

go 1.18

```

`go.sum`:

```sum
github.com/0xrawsec/crony v1.0.3 h1:LQ3dQBTERz8pgY2fFv06l2VGpP0fDj6eXVt8akkH7yU=
github.com/0xrawsec/crony v1.0.3/go.mod h1:sa+qtzsdf/bV5pk4ens/1VtBJonBkHXUF6QD8pTQT48=
github.com/0xrawsec/crony v1.0.4 h1:MC/OBg6i98oYOnqyvrWA7iQDQJ0FLrUKH2/qjsOtR2k=
github.com/0xrawsec/crony v1.0.4/go.mod h1:sa+qtzsdf/bV5pk4ens/1VtBJonBkHXUF6QD8pTQT48=
github.com/0xrawsec/gene/v2 v2.3.0 h1:AuScsQ/PlD8DwPzIaJmRuhDB1SgGnKZaKBB95mih0Sc=
github.com/0xrawsec/gene/v2 v2.3.0/go.mod h1:Ns5p9jwmvCAAmzIBSMOL5hhMIlszxTXqVxBdJU/jm/w=
github.com/0xrawsec/golang-etw v1.5.3 h1:EYMebDfCwEX44a/pYwvdSH0CLiNVUEF0m3ExIZzV6rA=
github.com/0xrawsec/golang-etw v1.5.3/go.mod h1:GHtVXfU9Lyak04kZYiNstAlYn+zpPvJMEgdk88Y6Irk=
github.com/0xrawsec/golang-etw v1.6.0 h1:LFvsRO1P8V6T1wBQHXapnvQN68WlkeBll/JkZwPFBrA=
github.com/0xrawsec/golang-etw v1.6.0/go.mod h1:nTLqX2X4dxf/XpYiFmVfWSrjER/CO3A1WOsvc8cac6I=
github.com/0xrawsec/golang-etw v1.6.1 h1:587UQFLaVdu5B1C5+m1Haw6NoxiPCgtuOAKYD64zLrY=
github.com/0xrawsec/golang-etw v1.6.1/go.mod h1:nTLqX2X4dxf/XpYiFmVfWSrjER/CO3A1WOsvc8cac6I=
github.com/0xrawsec/golang-etw v1.6.2 h1:ZXOEL2+hfWBz7QK3iSPVhKeB1VYjz47xGl/WfdqdpzA=
github.com/0xrawsec/golang-etw v1.6.2/go.mod h1:nTLqX2X4dxf/XpYiFmVfWSrjER/CO3A1WOsvc8cac6I=
github.com/0xrawsec/golang-evtx v1.2.9 h1:DaL2BICXf3vnCkqsPIwth1Qpfsv4+UYdZ0zTajwYqrI=
github.com/0xrawsec/golang-evtx v1.2.9/go.mod h1:1dWPugn8hfETOcaZAdu70QWkeVLvT9AUUFz0j+caV00=
github.com/0xrawsec/golang-utils v1.1.3/go.mod h1:DADTtCFY10qXjWmUVhhJqQIZdSweaHH4soYUDEi8mj0=
github.com/0xrawsec/golang-utils v1.3.0/go.mod h1:DADTtCFY10qXjWmUVhhJqQIZdSweaHH4soYUDEi8mj0=
github.com/0xrawsec/golang-utils v1.3.1/go.mod h1:DADTtCFY10qXjWmUVhhJqQIZdSweaHH4soYUDEi8mj0=
github.com/0xrawsec/golang-utils v1.3.2 h1:ww4jrtHRSnX9xrGzJYbalx5nXoZewy4zPxiY+ubJgtg=
github.com/0xrawsec/golang-utils v1.3.2/go.mod h1:m7AzHXgdSAkFCD9tWWsApxNVxMlyy7anpPVOyT/yM7E=
github.com/0xrawsec/golang-win32 v1.0.6/go.mod h1:MAxVU7dr8lujwknuhf4TwjYm8tVEELi2zwx1zDTu/RM=
github.com/0xrawsec/golang-win32 v1.0.14 h1:Lj45Cd7qnhCbtnrNCBI3twefRVh759q/rDXrutxQQOo=
github.com/0xrawsec/golang-win32 v1.0.14/go.mod h1:LDGq8VzCwLZccK1qg7oKBc8n5DmPLi79w+wjew1UApg=
github.com/0xrawsec/golog v1.0.3 h1:XeFoRNNdRBuED8UiHgOYtkQgWTqjuclGbE7HbQ37XPg=
github.com/0xrawsec/golog v1.0.3/go.mod h1:1nAC7Q+Se87r/pf9FTR9qeuvlsPmebC7qOyhEdV1uLI=
github.com/0xrawsec/sod v1.10.1 h1:azLzCBbmCUPXfBpiYYuCmSLGIdQpK3/oCTzkES8B1C8=
github.com/0xrawsec/sod v1.10.1/go.mod h1:N1cEdcsJxJZ6F7dPK0vpEQ+NdBO8uKS3CFPJyOmEK5E=
github.com/0xrawsec/toast v1.2.3 h1:nTs5NyAdmSoDfxlYjMVMYb9wj3C/MFpnoIoQBPUsHXg=
github.com/0xrawsec/toast v1.2.3/go.mod h1:sRvfNYxqVoH1sZnE18s9Knm/lkbarTGNvaNVBf2/h1k=
github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
github.com/davecgh/go-spew v1.1.1 h1:vj9j/u1bqnvCEfJOwUhtlOARqs3+rkHYY13jYWTU97c=
github.com/davecgh/go-spew v1.1.1/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
github.com/golang/snappy v0.0.1/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/google/shlex v0.0.0-20191202100458-e7afc7fbc510 h1:El6M4kTTCOh6aBiKaUGG7oYTSPP8MxqL4YI3kZKwcP4=
github.com/google/shlex v0.0.0-20191202100458-e7afc7fbc510/go.mod h1:pupxD2MaaD3pAXIBCelhxNneeOaAeabZDe5s4K6zSpQ=
github.com/google/uuid v1.3.0 h1:t6JiXgmwXMjEs8VusXIJk2BXHsn+wx8BZdTaoZ5fu7I=
github.com/google/uuid v1.3.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
github.com/gorilla/mux v1.8.0 h1:i40aqfkR1h2SlN9hojwV5ZA91wcXFOvkdNIeFDP5koI=
github.com/gorilla/mux v1.8.0/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71So=
github.com/gorilla/websocket v1.4.2 h1:+/TMaTYc4QFitKJxsQ7Yye35DkWvkdLcvGKqM+x0Ufc=
github.com/gorilla/websocket v1.4.2/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/kr/fs v0.1.0/go.mod h1:FFnZGqtBN9Gxj7eW1uZ42v5BccTP0vu6NEaFoC2HwRg=
github.com/pelletier/go-toml v1.9.3 h1:zeC5b1GviRUyKYd6OJPvBU/mcVDVoL1OhT17FCt5dSQ=
github.com/pelletier/go-toml v1.9.3/go.mod h1:u1nR/EPcESfeI/szUZKdtJ0xRNbUoANCkoOuaOx1Y+c=
github.com/pelletier/go-toml/v2 v2.0.5 h1:ipoSadvV8oGUjnUbMub59IDPPwfxF694nG/jwbMiyQg=
github.com/pelletier/go-toml/v2 v2.0.5/go.mod h1:OMHamSCAODeSsVrwwvcJOaoN0LIUIaFVNZzmWyNfXas=
github.com/pkg/errors v0.8.1/go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=
github.com/pkg/sftp v1.10.0/go.mod h1:NxmoDg/QLVWluQDUYG7XBZTLUpKeFa8e3aMf1BfjyHk=
github.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM=
github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/segmentio/kafka-go v0.2.2/go.mod h1:X6itGqS9L4jDletMsxZ7Dz+JFWxM6JHfPOCvTvk+EJo=
github.com/stretchr/objx v0.1.0/go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=
github.com/stretchr/objx v0.4.0/go.mod h1:YvHI0jy2hoMjB+UWwv71VJQ9isScKT/TqJzVSSt89Yw=
github.com/stretchr/testify v1.7.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.8.0 h1:pSgiaMZlXftHpm5L7V1+rVB+AZJydKsMxsQBIJw4PKk=
github.com/stretchr/testify v1.8.0/go.mod h1:yNjHg4UonilssWZ8iaSj1OCr/vHnekPRkoO+kdMU+MU=
golang.org/x/crypto v0.0.0-20190308221718-c2843e01d9a2/go.mod h1:djNgcEr1/C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=
golang.org/x/crypto v0.0.0-20190621222207-cc06ce4a13d4/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/net v0.0.0-20190311183353-d8887717615a/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.0.0-20190620200207-3b0461eec859/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/sync v0.0.0-20190423024810-112230192c58/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190626150813-e07cf5db2756/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190909082730-f460065e899a h1:mIzbOulag9/gXacgxKlFVwpCOWSfBT3/pDyyCwGA9as=
golang.org/x/sys v0.0.0-20190909082730-f460065e899a/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=
golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=
golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
golang.org/x/tools v0.0.0-20190320215829-36c10c0a621f/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
golang.org/x/tools v0.0.0-20190625160430-252024b82959 h1:VuVDXrx1TCtYGfuoKtAHdDqlDBF4b1ygX9yjx+WokdE=
golang.org/x/tools v0.0.0-20190625160430-252024b82959/go.mod h1:/rFqwRUd4F7ZHNgwSSTFct+R/Kf4OFW1sUzUTQQTgfc=
gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.1 h1:fxVm/GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=
gopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=

```

`ioc/ioc.go`:

```go
package ioc

import (
	"crypto/sha256"
	"encoding/hex"
	"fmt"
	"hash"
	"regexp"
	"strings"
	"sync"

	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/utils"
)

var (
	reMd5    = regexp.MustCompile("(?i:[a-f0-9]{32})")
	reSha1   = regexp.MustCompile("(?i:[a-f0-9]{40})")
	reSha256 = regexp.MustCompile("(?i:[a-f0-9]{64})")
	reAny    = regexp.MustCompile(".*")
)

func FromObjects(obs ...sod.Object) (out []*IOC) {
	out = make([]*IOC, len(obs))

	for i, o := range obs {
		out[i] = o.(*IOC)
	}
	return
}

const (
	TypeMd5      = "md5"
	TypeSha1     = "sha1"
	TypeSha256   = "sha256"
	TypeImphash  = "imphash"
	TypeDomain   = "domain"
	TypeHostname = "hostname"
	TypeIpDst    = "ip-dst"
)

type IOC struct {
	sod.Item
	Uuid string `json:"uuid" sod:"unique,lower"`
	// GroupUuid can be used to group IoCs
	GroupUuid string `json:"guuid" sod:"index,lower"`
	Source    string `json:"source" sod:"index"`
	Value     string `json:"value" sod:"index"`
	Type      string `json:"type" sod:"index,lower"`
}

func HasValidType(ioc *IOC) bool {
	switch ioc.Type {
	case TypeMd5,
		TypeSha1, TypeSha256,
		TypeImphash,
		TypeDomain,
		TypeHostname,
		TypeIpDst:
		return true
	default:
		return false
	}
}

func (ioc *IOC) Transform() {
	ioc.Type = strings.ToLower(ioc.Type)
	ioc.GroupUuid = strings.ToLower(ioc.GroupUuid)

	switch ioc.Type {
	case TypeMd5, TypeSha1, TypeSha256, TypeImphash:
		ioc.Value = strings.ToLower(ioc.Value)
	}
}

func (ioc *IOC) Validate() error {
	if !utils.IsValidUUID(ioc.Uuid) {
		return fmt.Errorf("uuid field is not properly formatted")
	}
	if !utils.IsValidUUID(ioc.GroupUuid) {
		return fmt.Errorf("group uuid field is not properly formatted")
	}
	if ioc.Source == "" {
		return fmt.Errorf("source must not be empty")
	}
	if ioc.Value == "" {
		return fmt.Errorf("value must not be empty")
	}

	// validating IoC types
	if !HasValidType(ioc) {
		return fmt.Errorf("unknown IoC type %s", ioc.Type)
	} else {
		validRe := reAny

		switch ioc.Type {
		case TypeMd5, TypeImphash:
			validRe = reMd5
		case TypeSha1:
			validRe = reSha1
		case TypeSha256:
			validRe = reSha256
		}
		if !validRe.MatchString(ioc.Value) {
			return fmt.Errorf("%s not valid", ioc.Type)
		}
	}
	return nil
}

type IoCs struct {
	sync.Mutex
	iocs   *datastructs.Set
	sha256 hash.Hash
}

func NewIocs() *IoCs {
	return &IoCs{
		iocs:   datastructs.NewSet(),
		sha256: sha256.New(),
	}
}

func (i *IoCs) reHash() {
	i.sha256 = sha256.New()
	for _, ii := range i.iocs.SortSlice() {
		ioc := ii.(string)
		i.sha256.Write([]byte(ioc))
	}
}

func (i *IoCs) FromDB(db *sod.DB) error {
	if objects, err := db.All(&IOC{}); err != nil {
		return err
	} else {
		for _, o := range objects {
			ioc := o.(*IOC)
			i.Add(ioc)
		}
	}
	return nil
}

func (i *IoCs) StringSlice() (s []string) {
	i.Lock()
	defer i.Unlock()
	s = make([]string, 0, i.iocs.Len())
	for _, ii := range i.iocs.SortSlice() {
		s = append(s, ii.(string))
	}
	return
}

func (i *IoCs) Add(iocs ...*IOC) {
	i.Lock()
	defer i.Unlock()
	for _, ioc := range iocs {
		// if we don't make this check Add method
		// changes the order of insertion which is not
		// in line anymore with sha256 computation
		if !i.iocs.Contains(ioc.Value) {
			i.iocs.Add(ioc.Value)
			i.sha256.Write([]byte(ioc.Value))
		}
	}
}

func (i *IoCs) Del(iocs ...*IOC) {
	i.Lock()
	defer i.Unlock()
	for _, ioc := range iocs {
		i.iocs.Del(ioc.Value)
	}
	i.reHash()
}

func (i *IoCs) Hash() string {
	i.Lock()
	defer i.Unlock()
	return hex.EncodeToString(i.sha256.Sum(nil))
}

```

`ioc/ioc_test.go`:

```go
package ioc

import (
	"crypto/sha256"
	"encoding/hex"
	"fmt"
	"math/rand"
	"testing"

	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/utils"
)

const (
	dbpath = "data/database"
)

var (
	format = fmt.Sprintf
)

func uuidGen() string {
	return utils.UUIDOrPanic().String()
}

func createIocDB(t *testing.T, size int) (db *sod.DB) {

	tt := toast.FromT(t)

	db = sod.Open(dbpath)

	schema := sod.DefaultSchema
	schema.Cache = true
	tt.CheckErr(db.Create(&IOC{}, sod.DefaultSchema))

	n, err := db.Count(&IOC{})
	tt.CheckErr(err)
	if n != size {
		t.Logf("Dropping db n=%d size=%d", n, size)
		db.DeleteAll(&IOC{})
	} else {
		t.Logf("Db size n=%d", n)
		return
	}

	iocs := make([]sod.Object, 0)
	for i := 0; i < size; i++ {
		var ioc *IOC
		switch rand.Int() % 3 {
		case 0:
			ioc = &IOC{
				Uuid:      uuidGen(),
				GroupUuid: uuidGen(),
				Source:    "Whatever",
				Value:     fmt.Sprintf("%d.some.domain", i),
				Type:      "domain",
			}
		case 1:
			mod := i % 256
			ioc = &IOC{
				Uuid:      uuidGen(),
				GroupUuid: uuidGen(),
				Source:    "Whatever",
				Value:     fmt.Sprintf("%d.%d.%d.%d", mod, mod, mod, mod),
				Type:      "ip-dst",
			}
		case 2:
			s := sha256.New()
			v := fmt.Sprintf("random-value-%d", i)
			s.Write([]byte(v))
			ioc = &IOC{
				Uuid:      uuidGen(),
				GroupUuid: uuidGen(),
				Source:    "Whatever",
				Value:     hex.EncodeToString(s.Sum(nil)),
				Type:      "domain",
			}
		}
		iocs = append(iocs, ioc)
	}

	_, err = db.InsertOrUpdateMany(iocs...)
	tt.CheckErr(err)

	return db
}

func TestIocs(t *testing.T) {
	var db *sod.DB
	tt := toast.FromT(t)

	iocs := NewIocs()

	tt.TimeIt("creating DB", func() { db = createIocDB(t, 5000) })
	defer db.Drop()
	tt.CheckErr(iocs.FromDB(db))

	t.Logf("len(iocs)=%d", iocs.iocs.Len())
	hashSlice := utils.Sha256StringSlice(iocs.StringSlice())
	tt.Assert(iocs.Hash() == hashSlice, format("hash is not stable: iocs.Hash=%s hashSlice=%s", iocs.Hash(), hashSlice))

	del := make([]*IOC, 0)
	for _, v := range iocs.StringSlice() {
		if rand.Int()%2 == 0 {
			del = append(del, &IOC{Value: v})
		}
	}
	iocs.Del(del...)

	t.Logf("len(iocs)=%d", iocs.iocs.Len())
	hashSlice = utils.Sha256StringSlice(iocs.StringSlice())
	tt.Assert(iocs.Hash() == hashSlice, format("hash is not stable: iocs.Hash=%s hashSlice=%s", iocs.Hash(), hashSlice))
}

```

`logger/events.go`:

```go
package logger

import (
	"bytes"
	"encoding/json"
	"fmt"
	"strconv"
	"time"

	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/whids/event"
)

type RawEvent struct {
	Timestamp time.Time
	data      []byte
}

func NewRawEvent(e *event.EdrEvent) (r *RawEvent, err error) {
	r = &RawEvent{}
	r.Timestamp = e.Timestamp()
	r.data, err = json.Marshal(e)
	return
}

func DecodeRawEvent(b []byte) (r *RawEvent, err error) {
	var i int
	var intTS int64

	r = &RawEvent{}
	if i = bytes.Index(b, []byte(":")); i != -1 {
		if intTS, err = strconv.ParseInt(string(b[:i]), 10, 64); err != nil {
			return
		}
		r.Timestamp = time.Unix(0, intTS)
	}
	s := b[i+1:]
	r.data = make([]byte, len(s))
	copy(r.data, s)
	return
}

func (e *RawEvent) Less(other datastructs.Sortable) bool {
	return e.Timestamp.Before(other.(*RawEvent).Timestamp)
}

func (e *RawEvent) Encode() []byte {
	header := fmt.Sprintf("%d:", e.Timestamp.UTC().UnixNano())
	b := make([]byte, 0, len(e.data)+len(header))
	b = append(b, []byte(header)...)
	b = append(b, e.data...)
	return b
}

func (e *RawEvent) Event() (evt *event.EdrEvent, err error) {
	evt = &event.EdrEvent{}
	err = json.Unmarshal(e.data, &evt)
	return
}

```

`logger/index.go`:

```go
package logger

import (
	"bufio"
	"fmt"
	"os"
	"strconv"
	"strings"
	"time"

	"github.com/0xrawsec/golang-utils/datastructs"
)

// IndexFile represents an opened index file
type IndexFile struct {
	path string
	fd   *os.File
	s    *bufio.Scanner
	i    int
}

// OpenIndexFile opens an index file from a path
func OpenIndexFile(path string) (inf *IndexFile, err error) {
	inf = &IndexFile{path: path}
	if inf.fd, err = os.Open(path); err != nil {
		return
	}
	inf.s = bufio.NewScanner(inf.fd)
	return
}

// LogfilePaths returns the name of the IndexedLogFile
// associated to the IndexFile
func (inf *IndexFile) LogfilePath() string {
	return strings.TrimSuffix(inf.path, IndexExt)
}

// Next returns the next IndexEntry
// stop condition if ie == nil or err != nil
func (inf *IndexFile) Next() (ie *IndexEntry, err error) {
	// we skip header
	if inf.i == 0 {
		if ok := inf.s.Scan(); !ok {
			err = inf.s.Err()
			return
		}
	}
	// we read one line
	if ok := inf.s.Scan(); !ok {
		err = inf.s.Err()
		return
	}
	ie, err = IndexEntryFromCSV(inf.s.Text())
	ie.indexFile = inf
	inf.i++
	return
}

// Close closes the underlying file descriptor
func (inf *IndexFile) Close() error {
	return inf.fd.Close()
}

// IndexEntry represents encodes information about the
// events written in an IndexedLogfile
type IndexEntry struct {
	indexFile  *IndexFile
	Start      time.Time `json:"start"`
	Stop       time.Time `json:"stop"`
	Offset     int64     `json:"offset"`
	EventCount int64     `json:"count"`
}

// IndexEntryFromCSV returns an IndexEntry from a CSV line
func IndexEntryFromCSV(line string) (ie *IndexEntry, err error) {
	ie = &IndexEntry{}
	fields := strings.Split(strings.Trim(line, "\n"), ",")

	if ie.Start, err = parseTime(fields[0]); err != nil {
		return
	}

	if ie.Stop, err = parseTime(fields[1]); err != nil {
		return
	}

	if ie.Offset, err = strconv.ParseInt(fields[2], 0, 64); err != nil {
		return
	}

	if ie.EventCount, err = strconv.ParseInt(fields[3], 0, 64); err != nil {
		return
	}

	return
}

// UpdateTime must be used to update the Start and Stop timestamps
// of the IndexEntry structure
func (i *IndexEntry) UpdateTime(t time.Time) {
	if i.Start.IsZero() && i.Stop.IsZero() {
		i.Start = t
		i.Stop = t
		return
	}

	if t.Before(i.Start) {
		i.Start = t
	}

	if t.After(i.Stop) {
		i.Stop = t
	}
}

// Implements datastructs.Sortable interface
func (i *IndexEntry) Less(other datastructs.Sortable) bool {
	return i.Start.Before(other.(*IndexEntry).Start)
}

// In returns true if entry is fully in time range start < entry < stop
func (i *IndexEntry) In(start time.Time, stop time.Time) bool {
	return i.Start.After(start) && i.Stop.Before(stop)
}

// Overlaps returns true if entry has overlapping time with time range
func (i *IndexEntry) Overlaps(start time.Time, stop time.Time) bool {
	return (i.Start.After(start) && i.Stop.Before(stop)) || i.Contains(start) || i.Contains(stop) || (start.After(i.Start) && stop.Before(i.Stop))
}

// Contains returns true if time is in between entry start and stop
func (i *IndexEntry) Contains(ts time.Time) bool {
	return (ts.After(i.Start) && ts.Before(i.Stop)) || i.Start == ts || i.Stop == ts
}

// Before returns true if index is before another
func (i *IndexEntry) Before(other *IndexEntry) bool {
	return i.Start.Before(other.Start) && i.Stop.Before(other.Stop)
}

// ToCSV marshals an IndexEntry to CSV data
func (i *IndexEntry) ToCSV() string {
	return fmt.Sprintf("%s,%s,%d,%d", fmtTime(i.Start), fmtTime(i.Stop), i.Offset, i.EventCount)
}

```

`logger/logfile.go`:

```go
package logger

import (
	"bufio"
	"compress/gzip"
	"fmt"
	"io"
	"os"
	"path/filepath"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/whids/utils"
)

// RenameIndexedLogfile renames both an IndexLogfile and its associated IndexFile
func RenameIndexedLogfile(old, new string) (lastErr error) {
	if err := os.Rename(old, new); err != nil {
		lastErr = err
	}
	if err := os.Rename(IndexFileFromPath(old), IndexFileFromPath(new)); err != nil {
		lastErr = err
	}
	return
}

// RemoveIndexedLogfile removes both an IndexLogfile and its associated IndexFile
func RemoveIndexedLogfile(path string) (lastErr error) {
	if err := os.Remove(path); err != nil {
		lastErr = err
	}
	if err := os.Remove(path); err != nil {
		lastErr = err
	}
	return
}

// ArchiveFilename returns a standardized name to archive and IndexedLogfile
func ArchiveFilename(path string) string {
	now := time.Now()
	ext := filepath.Ext(path)
	rest := strings.TrimRight(path, ext)

	return fmt.Sprintf("%s-%d%s", rest, now.UTC().UnixNano(), ext)
}

// IndexedLogfile structure
type IndexedLogfile struct {
	sync.Mutex
	path       string
	fd         *os.File
	writer     *gzip.Writer
	indexEntry IndexEntry
}

// OpenIndexedLogfile opens an IndexedLogfile
func OpenIndexedLogfile(path string) (l *IndexedLogfile, err error) {
	l = &IndexedLogfile{path: path}
	if l.fd, err = os.OpenFile(path, os.O_APPEND|os.O_RDWR|os.O_CREATE, DefaultLogPerm); err != nil {
		return
	}

	if err == nil {
		l.writer = gzip.NewWriter(l.fd)
	}

	err = l.resetIndexEntry()
	return
}

// IndexFileFromPath returns a standardized IndexFile name from a path
func IndexFileFromPath(path string) string {
	return fmt.Sprintf("%s%s", path, IndexExt)
}

func (f *IndexedLogfile) resetIndexEntry() (err error) {
	f.indexEntry = IndexEntry{}
	if f.indexEntry.Offset, err = f.size(); err != nil {
		return fmt.Errorf("failed to reset index entry: %w", err)
	}
	return
}

// IndexFile returns the path of the IndexFile associated to the IndexedLogfile
func (f *IndexedLogfile) IndexFile() string {
	return fmt.Sprintf("%s%s", f.path, IndexExt)
}

func (f *IndexedLogfile) size() (size int64, err error) {
	var saved int64

	// we save current offset
	if saved, err = f.fd.Seek(0, io.SeekCurrent); err != nil {
		return
	}

	// we get the file size
	if size, err = f.fd.Seek(0, io.SeekEnd); err != nil {
		return
	}

	// we restore the offset
	if _, err = f.fd.Seek(saved, io.SeekStart); err != nil {
		return
	}

	return
}

// Size returns the size of the IndexedLogfile
func (f *IndexedLogfile) Size() (size int64, err error) {
	f.Lock()
	defer f.Unlock()
	return f.size()

}

// ReadRawEvents reads n RawEvents located at offset in IndexedLogfile
func (f *IndexedLogfile) ReadRawEvents(offset int64, n int64) (events []*RawEvent, err error) {
	f.Lock()
	defer f.Unlock()
	var r *gzip.Reader
	var saved int64
	var s *bufio.Scanner

	events = make([]*RawEvent, 0, n)

	// we save current offset
	if saved, err = f.fd.Seek(0, io.SeekCurrent); err != nil {
		return
	}

	// we go at wanted offset
	if _, err = f.fd.Seek(offset, io.SeekStart); err != nil {
		return
	}

	if r, err = gzip.NewReader(f.fd); err != nil {
		goto Cleanup
	}
	defer r.Close()

	s = bufio.NewScanner(r)
	for s.Scan() && int64(len(events)) < n {
		var raw *RawEvent
		if raw, err = DecodeRawEvent(s.Bytes()); err != nil {
			return
		}
		events = append(events, raw)
	}

Cleanup:
	// we restore the offset
	if _, e := f.fd.Seek(saved, io.SeekStart); e != nil {
		err = e
		return
	}

	return
}

// WriteRawEventWithTimestamp writes a RawEvent with an associated event timestamp in the IndexLogfile
func (f *IndexedLogfile) WriteRawEventWithTimestamp(e *RawEvent, timestamp time.Time) (n int, err error) {
	f.Lock()
	defer f.Unlock()

	var b []byte

	timestamp = stdTime(timestamp)

	// we go at the end of file
	if _, err = f.fd.Seek(0, io.SeekEnd); err != nil {
		return
	}

	// we update timestamps only if write succeded
	b = append(e.Encode(), '\n')
	if n, err = f.writer.Write(b); err == nil {
		f.indexEntry.UpdateTime(timestamp)

		// we increment the event counter
		f.indexEntry.EventCount += 1
	}

	return
}

// WriteRawEvent writes a RawEvent in IndexLogfile taking the event timestamp as reference time
func (f *IndexedLogfile) WriteRawEvent(e *RawEvent) (n int, err error) {
	return f.WriteRawEventWithTimestamp(e, e.Timestamp)
}

func (f *IndexedLogfile) flush() (err error) {
	var indexFd *os.File

	// we commit to index file only if we wrote at least one event
	if f.indexEntry.EventCount > 0 {
		header := !fsutil.Exists(f.IndexFile())
		if indexFd, err = os.OpenFile(f.IndexFile(), os.O_APPEND|os.O_RDWR|os.O_CREATE, utils.DefaultFilePerm); err != nil {
			return
		}
		defer indexFd.Close()

		if header {
			if _, err = indexFd.WriteString(IndexHeader + "\n"); err != nil {
				return fmt.Errorf("failed to write index file: %w", err)
			}
		}

		if _, err = indexFd.WriteString(f.indexEntry.ToCSV() + "\n"); err != nil {
			return fmt.Errorf("failed to write index file: %w", err)
		}

		if err = f.writer.Flush(); err != nil {
			return fmt.Errorf("failed at flushing gzip writer: %w", err)
		}
		return f.resetIndexEntry()
	}
	return
}

// Flush flushes the IndexedLogfile to disk
func (f *IndexedLogfile) Flush() (err error) {
	f.Lock()
	defer f.Unlock()

	return f.flush()
}

// Close flushes and closes an IndexedLogfile
func (f *IndexedLogfile) Close() (err error) {
	f.Lock()
	defer f.Unlock()

	if err = f.flush(); err != nil {
		return
	}

	// we close gzip writer
	f.writer.Close()
	// close the log file
	if e := f.fd.Close(); e != nil {
		err = e
	}
	return
}

```

`logger/loggers.go`:

```go
package logger

import (
	"fmt"
	"math/rand"
	"os"
	"path/filepath"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/utils"
)

const (
	// IndexExt is the file extension used for index files
	IndexExt = ".index"
	// IndexedLogfileExt is the file extension used by logfiles
	IndexedLogfileExt = ".gz"

	// DefaultLogPerm default logfile permission for Manager
	DefaultLogPerm = 0600

	tGranularity = time.Hour
)

var (
	TimeFormat  = time.RFC3339Nano
	IndexHeader = "Start,Stop,Offset,EventCount"
)

func stdTime(t time.Time) time.Time {
	return t.UTC()
}

func timestampToDir(t time.Time) string {
	t = stdTime(t)
	return filepath.Join(t.Format("20060102"), t.Format("15"))
}

func fmtTime(t time.Time) string {
	return stdTime(t).Format(TimeFormat)
}

func parseTime(s string) (time.Time, error) {
	return time.Parse(TimeFormat, s)
}

// TransactionId type to identify a logging session
type TransactionId uint64

// EventLogger structure used to log EDR events
type EventLogger struct {
	sync.RWMutex
	root        string
	base        string
	maxSize     int64
	cache       map[string]*IndexedLogfile
	transacting TransactionId
}

// NewEventLogger creates a new EventLogger
func NewEventLogger(root, base string, size int64) *EventLogger {
	root = strings.TrimRight(root, string(os.PathSeparator))
	return &EventLogger{
		root:    root,
		base:    base,
		maxSize: size,
		cache:   make(map[string]*IndexedLogfile),
	}
}

func (l *EventLogger) openLogfile(t time.Time, key string) (il *IndexedLogfile, err error) {
	var ok, rotate bool
	var stat os.FileInfo

	// key must not be empty
	if key == "" {
		err = fmt.Errorf("key must not be empty")
		return
	}

	dir := filepath.Join(l.root, key, timestampToDir(t))
	path := filepath.Join(dir, l.base)

	if stat, err = os.Stat(path); err == nil && stat.Mode().IsRegular() {
		if stat.Size() > l.maxSize {
			rotate = true
		}
	}

	// the file is already opened
	if il, ok = l.cache[path]; ok && !rotate {
		return
	} else if ok && rotate {
		il.Close()
		delete(l.cache, path)
	}

	if rotate {
		RenameIndexedLogfile(path, ArchiveFilename(path))
	}

	// we create output directory
	if err = os.MkdirAll(dir, utils.DefaultFilePerm); err != nil {
		return
	}

	il, err = OpenIndexedLogfile(path)
	l.cache[path] = il
	return
}

// InitTransaction initializes a new logging transaction
// only attempts to use WriteEvent with the proper id will succeed
func (l *EventLogger) InitTransaction() (id TransactionId) {
	l.Lock()

	for ; id == 0; id = TransactionId(rand.Uint64()) {
	}

	l.transacting = id
	return
}

// WriteEvent writes an event to an IndexedLogfile chosen according to
// the internal algorithm of the EventLogger
func (l *EventLogger) WriteEvent(id TransactionId, key string, evt *event.EdrEvent) (n int, err error) {
	var il *IndexedLogfile
	var re *RawEvent

	if l.transacting == id {
		if re, err = NewRawEvent(evt); err != nil {
			return
		}

		if il, err = l.openLogfile(re.Timestamp, key); err != nil {
			return 0, fmt.Errorf("failed to open logfile: %w", err)
		}

		return il.WriteRawEvent(re)

	}
	return 0, fmt.Errorf("invalid transaction id %d (expected: %d)", id, l.transacting)
}

// CountFiles returns the count of opened IndexedFiles
func (l *EventLogger) CountFiles() int {
	return len(l.cache)
}

func (l *EventLogger) endTransaction() {
	l.transacting = 0
}

// CommitTransaction commits a transaction leaving the place for a new one.
// A transaction needs to be committed before a new one can be initialized
// and used.
func (l *EventLogger) CommitTransaction() (lastErr error) {
	defer l.Unlock()
	l.endTransaction()
	return l.close()
}

func (l *EventLogger) close() (lastErr error) {
	for path, il := range l.cache {
		if err := il.Close(); err != nil {
			lastErr = err
		}
		delete(l.cache, path)
	}
	return
}

// Close closes an EventLogger
func (l *EventLogger) Close() (lastErr error) {
	l.Lock()
	l.endTransaction()
	defer l.Unlock()
	return l.close()
}

```

`logger/loggers_test.go`:

```go
package logger

import (
	"bytes"
	"encoding/json"
	"math/rand"
	"os"
	"sync"
	"testing"
	"time"

	"github.com/0xrawsec/golang-utils/readers"
	"github.com/0xrawsec/whids/event"
	"github.com/0xrawsec/whids/utils"
)

var (
	eventFile = "./data/events.json"
	events    = make([]event.EdrEvent, 0)
)

const (
	day   = time.Hour * 24
	month = day * 30
)

func init() {
	data, err := os.ReadFile(eventFile)
	if err != nil {
		panic(err)
	}
	for line := range readers.Readlines(bytes.NewBuffer(data)) {
		event := event.EdrEvent{}
		json.Unmarshal(line, &event)
		events = append(events, event)
	}
}

func emitEvents(count int, random bool) (ce chan *event.EdrEvent) {
	ce = make(chan *event.EdrEvent)
	go func() {
		defer close(ce)
		for i := 0; i < count; i++ {
			i := rand.Int() % len(events)
			// we need to use a copy of the event as event
			// contains some pointer making shalow copy
			// copying that pointer too
			e := events[i].Copy()
			newTimestamp := time.Now()
			if random {
				delayMin := time.Duration(rand.Int()%120) * time.Minute
				if rand.Int()%2 == 0 {
					newTimestamp = newTimestamp.Add(-delayMin)
				} else {
					newTimestamp = newTimestamp.Add(delayMin)
				}
			}
			e.Event.System.TimeCreated.SystemTime = newTimestamp
			ce <- e
		}
	}()
	return
}

func timeSearch(t *testing.T, s *EventSearcher, start, stop time.Time, key string, count, skip int) (n int) {
	var prev *RawEvent
	var bytesR int
	timer := time.Now()
	for e := range s.Events(start, stop, key, count, skip) {
		// we control events are comming in good order
		if prev != nil {
			if prev.Timestamp.After(e.Timestamp) {
				t.Errorf("Events are not ordered: %s after %s", prev.Timestamp.UTC(), e.Timestamp.UTC())
			}
		}
		prev = e
		bytesR += len(e.data)
		n++
	}
	delta := time.Since(timer)
	t.Logf("")
	t.Logf("Time to read %d events: %s", count, delta)
	t.Logf("Read throughput: %.1f MB/s", float64(bytesR)/(utils.Mega*delta.Seconds()))
	t.Logf("Total size read: %d MB", bytesR/utils.Mega)
	if s.Err() != nil {
		t.Error(s.Err())
		t.FailNow()
	}
	return
}
func TestEventLogger(t *testing.T) {
	var nExpEvents int

	wg := sync.WaitGroup{}
	root := "data/logs"
	nroutines := 2000
	bytesR, bytesW := 0, 0
	key := "03e31275-2277-d8e0-bb5f-480fac7ee4ef"

	l := NewEventLogger(root, "logs.gz", utils.Mega*1)
	defer l.Close()
	os.RemoveAll("data/logs")
	start := time.Now()
	for i := 0; i < nroutines; i++ {
		wg.Add(1)
		// simulate concurrent writes
		nevents := rand.Int() % 100
		nExpEvents += nevents
		go func() {
			defer wg.Done()
			id := l.InitTransaction()
			for e := range emitEvents(nevents, false) {
				if n, err := l.WriteEvent(id, key, e); err != nil {
					t.Errorf("cannot write event: %s", err)
				} else {
					bytesW += n
				}
			}
			l.CommitTransaction()
			// attempts to write files out of a transaction
			for e := range emitEvents(10, false) {
				if _, err := l.WriteEvent(id, key, e); err == nil {
					t.Errorf("writing out of a transaction is not allowed")
				}
			}
		}()
	}
	wg.Wait()
	delta := time.Since(start)
	t.Logf("Time to write files: %s", delta)
	t.Logf("Total size written (uncompressed): %.1fMB", float64(bytesW)/utils.Mega)
	t.Logf("Write throughput: %.1fMB/s", float64(bytesW)/(utils.Mega*delta.Seconds()))

	if l.CountFiles() != 0 {
		t.Errorf("All files should be closed, %d files still opened", l.CountFiles())
	}

	now := time.Now()
	skip := rand.Int() % nExpEvents
	s := NewEventSearcher(root)
	defer s.Close()

	var prev *RawEvent
	count := 0
	timer := time.Now()
	for e := range s.Events(now.Add(-1*month), now.Add(1*month), key, nExpEvents, skip) {
		// compute size for throughput
		bytesR += len(e.data)

		if prev != nil {
			// we control events are comming in good order
			if prev.Timestamp.After(e.Timestamp) {
				t.Errorf("Events are not ordered: %s after %s", prev.Timestamp.UTC(), e.Timestamp.UTC())
			}
		}
		prev = e
		count++
	}

	delta = time.Since(timer)
	t.Logf("Time to read events: %s", time.Since(timer))
	t.Logf("Read throughput: %.1f MB/s", float64(bytesR)/(utils.Mega*delta.Seconds()))
	t.Logf("Total size read: %d MB", bytesR/utils.Mega)

	if s.Err() != nil {
		t.Error(s.Err())
		t.FailNow()
	}

	if count != nExpEvents-skip {
		t.Errorf("(written) %d != %d (read)", nExpEvents, count)
	}

	t.Logf("Events read: %d", count)

	timeSearch(t, s, now.Add(-1*month), now.Add(1*month), key, 100000, 1000)
	timeSearch(t, s, now.Add(-1*month), now.Add(1*month), key, 50000, 1000)
	timeSearch(t, s, now.Add(-1*month), now.Add(1*month), key, 10000, 10000)
	timeSearch(t, s, now.Add(-1*month), now.Add(1*month), key, 1000, 1000)
}

```

`logger/search.go`:

```go
package logger

import (
	"fmt"
	"io/fs"
	"os"
	"path/filepath"
	"strings"
	"sync"
	"time"

	"github.com/0xrawsec/golang-utils/datastructs"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
)

const (
	MaxOpenedLogfile = 1024
)

func reverseIndex(index *datastructs.SortedSlice) {
	s := index.Slice()
	for i, j := 0, len(s)-1; i < j; i, j = i+1, j-1 {
		s[i], s[j] = s[j], s[i]
	}
}

type chunk struct {
	start   time.Time
	stop    time.Time
	entries []*IndexEntry
}

func newChunk() *chunk {
	return &chunk{entries: make([]*IndexEntry, 0)}
}

func (c *chunk) add(e *IndexEntry) {
	if e.Start.Before(c.start) {
		c.start = e.Start
	}
	if e.Stop.After(c.stop) {
		c.stop = e.Stop
	}
	c.entries = append(c.entries, e)
}

func (c *chunk) overlaps(e *IndexEntry) bool {
	return (c.start.After(e.Start) && c.stop.Before(e.Stop)) || c.contains(e.Start) || c.contains(e.Stop) || (e.Start.After(c.start) && e.Stop.Before(c.stop))
}

// contains returns true if time is in between entry start and stop
func (c *chunk) contains(ts time.Time) bool {
	return (ts.After(c.start) && ts.Before(c.stop)) || c.start == ts || c.stop == ts
}

// EventSearcher is used to search for events accross the file system
type EventSearcher struct {
	sync.Mutex
	root  string
	cache map[string]*IndexedLogfile
	err   error
}

// NewEventSearcher creates a new EventSearcher structure to be used to search logs
func NewEventSearcher(root string) (s *EventSearcher) {
	return &EventSearcher{
		root:  root,
		cache: make(map[string]*IndexedLogfile),
	}
}

func (s *EventSearcher) keys() (keys []string, err error) {
	var des []fs.DirEntry
	if des, err = os.ReadDir(s.root); err != nil {
		return
	}
	keys = make([]string, 0, len(des))
	for _, de := range des {
		if fsutil.IsDir(filepath.Join(s.root, de.Name())) {
			keys = append(keys, de.Name())
		}
	}
	return
}

func (s *EventSearcher) buildIndex(start, stop time.Time, key string) (index *datastructs.SortedSlice, err error) {
	var ifd *IndexFile
	var keys []string

	start = stdTime(start)
	stop = stdTime(stop)
	index = datastructs.NewSortedSlice()
	marked := datastructs.NewSet()

	if key == "" {
		if keys, err = s.keys(); err != nil {
			return
		}
	} else {
		keys = []string{key}
	}

	// we add our tGranularity to stop to make sure we cover all events
	for t := start; t.Before(stop.Add(tGranularity)); t = t.Add(tGranularity) {
		for _, key := range keys {
			dir := filepath.Join(s.root, key, timestampToDir(t))
			if fsutil.IsDir(dir) {
				if !marked.Contains(dir) {
					for wi := range fswalker.Walk(dir) {
						for _, fi := range wi.Files {
							if strings.HasSuffix(fi.Name(), IndexExt) {
								path := filepath.Join(wi.Dirpath, fi.Name())
								// we continue if key is not in path
								if key != "" && !strings.Contains(path, key) {
									continue
								}
								// opening index file
								if ifd, err = OpenIndexFile(path); err != nil {
									return
								}
								// appending index entries
								for indexEntry, err := ifd.Next(); indexEntry != nil && err == nil; indexEntry, err = ifd.Next() {
									// we append to the index only if it is relevant to our search
									if indexEntry.Overlaps(start, stop) {
										index.Insert(indexEntry)
									}
								}
								// closing index file
								ifd.Close()
								if err != nil {
									return
								}
							}
						}
					}
					marked.Add(dir)
				}
			}
		}
	}
	reverseIndex(index)
	return
}

func (s *EventSearcher) getFile(ie *IndexEntry) (il *IndexedLogfile, err error) {
	s.Lock()
	defer s.Unlock()

	var ok bool
	logPath := ie.indexFile.LogfilePath()

	if len(s.cache) > MaxOpenedLogfile {
		if err = s.close(); err != nil {
			err = fmt.Errorf("failed to close logfiles: %w", err)
			return
		}
	}

	if il, ok = s.cache[logPath]; !ok {
		if il, err = OpenIndexedLogfile(logPath); err != nil {
			err = fmt.Errorf("failed to open logfile from %s: %w", logPath, err)
			return
		}
		s.cache[logPath] = il
	}
	return
}

func (s *EventSearcher) readRawEvents(ie *IndexEntry) (events []*RawEvent, err error) {
	var il *IndexedLogfile

	logPath := ie.indexFile.LogfilePath()
	if il, err = s.getFile(ie); err != nil {
		return
	}

	events, err = il.ReadRawEvents(ie.Offset, ie.EventCount)
	if err != nil {
		err = fmt.Errorf("failed to read events from %s (index:%s): %w", logPath, ie.indexFile.path, err)
	}

	return
}

// Events returns a channel of RawEvents
func (s *EventSearcher) Events(start, stop time.Time, key string, count, skip int) (c chan *RawEvent) {
	var index *datastructs.SortedSlice
	c = make(chan *RawEvent)

	// times must always be UTC
	start = stdTime(start)
	stop = stdTime(stop)

	// if we fail at building the index
	if index, s.err = s.buildIndex(start, stop, key); s.err != nil {
		close(c)
		return
	}

	go func() {
		defer close(c)
		var err error
		var countEvents int
		var tmpEvents []*RawEvent

		sindex := index.Slice()
		// sindex is sorted with higher values first
		for i := 0; i < len(sindex) && countEvents < count; i++ {
			events := datastructs.NewSortedSlice()
			chunk := newChunk()

			for ; i < len(sindex); i++ {
				e := sindex[i].(*IndexEntry)
				chunk.add(e)
				if i == len(sindex)-1 {
					break
				}
				next := sindex[i+1].(*IndexEntry)
				if !chunk.overlaps(next) {
					break
				}
			}

			for _, ie := range chunk.entries {
				// we read events
				if tmpEvents, err = s.readRawEvents(ie); err != nil {
					s.err = err
					break
				}
				//for _, evt := range tmpEvents {
				for k := 0; k < len(tmpEvents) && countEvents < count; k++ {
					evt := tmpEvents[k]
					if skip > 0 {
						skip--
						continue
					}
					if (start.Before(evt.Timestamp) && stop.After(evt.Timestamp)) || evt.Timestamp == start || evt.Timestamp == stop {
						events.Insert(evt)
						countEvents++
					}
				}
			}

			for e := range events.ReversedIter() {
				c <- e.(*RawEvent)
			}
		}
	}()
	return
}

// Err returns any error which happened during a call to Events function
func (s *EventSearcher) Err() error {
	return s.err
}

func (s *EventSearcher) close() (lastErr error) {
	for p, il := range s.cache {
		if err := il.Close(); err != nil {
			lastErr = err
		}
		delete(s.cache, p)
	}
	return
}

// Close closes all the opened IndexedLogfile
func (s *EventSearcher) Close() (lastErr error) {
	s.Lock()
	defer s.Unlock()
	return s.close()
}

```

`los/os.go`:

```go
package los

import (
	"fmt"
	"os"
	"strings"
)

const (
	OSWindows = "windows"
	OSLinux   = "linux"
	OSDarwin  = "darwin"

	WinPathSep = `\`
	NixPathSep = "/"

	NixEnvVarSep  = ":"
	NixPathEnvVar = "PATH"

	WinEnvVarSep  = ";"
	WinPathEnvVar = "Path"
)

var (
	OS string

	PathSep string

	ExecExt    string
	LibraryExt string

	// Environment variable related
	EnvVarSep  string
	PathEnvVar string
)

func IsKnownOS(os string) bool {
	return os == OSWindows || os == OSLinux || os == OSDarwin
}

func GetPathEnv() string {
	return os.Getenv(PathEnvVar)
}

func BuildPathEnv(value ...string) string {
	// sanitizing values by removing leading and trailing separators
	for i := range value {
		value[i] = strings.Trim(value[i], EnvVarSep)
	}
	return strings.Join(value, EnvVarSep)
}

func TrimPathSep(path string) string {
	return strings.TrimRight(path, PathSep)
}

func ExecFilename(base string) string {
	return fmt.Sprintf("%s%s", base, ExecExt)
}

```

`los/os_darwin.go`:

```go
//go:build darwin
// +build darwin

package los

func init() {
	OS = OSDarwin

	ExecExt = ""
	LibraryExt = ".dylib"

	PathSep = NixPathSep

	EnvVarSep = NixEnvVarSep
	PathEnvVar = NixPathEnvVar
}

```

`los/os_linux.go`:

```go
//go:build linux
// +build linux

package los

func init() {
	OS = OSLinux

	ExecExt = ""
	LibraryExt = ".so"

	PathSep = NixPathSep

	EnvVarSep = NixEnvVarSep
	PathEnvVar = NixPathEnvVar
}

```

`los/os_windows.go`:

```go
//go:build windows
// +build windows

package los

func init() {
	OS = OSWindows

	ExecExt = ".exe"
	LibraryExt = ".dll"

	PathSep = WinPathSep

	EnvVarSep = WinEnvVarSep
	PathEnvVar = WinPathEnvVar
}

```

`make.sh`:

```sh
#!/usr/bin/bash

RELEASE=${GOPATH}/release
VERSION=$(git tag | tail -n 1)
TOOLS="utilities"

function check_err() {
    if [[ $? != 0 ]]
    then
        exit $?
    fi
}

pushd $TOOLS/sysmon && make -j 8 $@ || check_err && popd

pushd $TOOLS/whids && make -j 8 $@ || check_err && popd

pushd $TOOLS/manager && make -j 8 $@ || check_err && popd

pushd ${RELEASE}
# Remove previous bundles
rm *.zip
7z a -tzip whids-${VERSION}-release-bundle.zip *

popd



```

`sysmon/config.go`:

```go
package sysmon

import (
	"encoding/json"
	"encoding/xml"
	"fmt"
	"reflect"
	"regexp"
	"strings"

	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/los"
)

var (
	ValidOnMatch = []string{
		"include",
		"exclude",
		"",
	}

	ValidGroupRelation = []string{
		"and",
		"or",
		"",
	}

	ValidHashAlgorithm = []string{
		"IMPHASH",
		"MD5",
		"SHA1",
		"SHA256",
		"*",
		"",
	}

	ErrUnknownOS            = fmt.Errorf("unknown OS")
	ErrInvalidSchemaVersion = fmt.Errorf("invalid schema version")
	ErrInvalidGroupRelation = fmt.Errorf("invalid group relation")
	ErrInvalidCondition     = fmt.Errorf("invalid condition")
	ErrInvalidOnMatch       = fmt.Errorf("invalid onmatch")
	ErrInvalidHashAlgorithm = fmt.Errorf("invalid hash algorithm")

	schemaVersionRe = regexp.MustCompile(`\d+\.\d+`)
)

func validate(value string, in ...string) bool {
	for _, check := range in {
		if value == check {
			return true
		}
	}
	return false
}

type EventFilter struct {
	OnMatch string `xml:"onmatch,attr,omitempty" json:"onmatch,omitempty"`
}

func (e *EventFilter) Validate() error {
	if !validate(e.OnMatch, ValidOnMatch...) {
		return fmt.Errorf("%w %s", ErrInvalidOnMatch, e.OnMatch)
	}
	return nil
}

type Filter struct {
	Name      string `xml:"name,attr,omitempty" json:"name,omitempty"`
	Condition string `xml:"condition,attr,omitempty" json:"condition,omitempty"`
	Value     string `xml:",innerxml" json:"value"`
}

func (f *Filter) Validate() error {
	if !validate(f.Condition, Conditions...) {
		return fmt.Errorf("%w %s on value %s", ErrInvalidCondition, f.Condition, f.Value)
	}
	return nil
}

// Method of Filters structure not wanted to be overwritten by auto generation

func (f *Filters) Validate() error {
	// we get the value of the struct and not of the pointer
	v := reflect.ValueOf(f).Elem()
	for i := 0; i < v.NumField(); i++ {
		evtFilter := v.Field(i)
		if evtFilter.IsNil() {
			continue
		}
		filterName := v.Type().Field(i).Name
		method := evtFilter.MethodByName("Validate")
		res := method.Call([]reflect.Value{})
		if !res[0].IsNil() {
			return fmt.Errorf("%s %w", filterName, res[0].Interface().(error))
		}

		evtFilter = evtFilter.Elem()
		for k := 0; k < evtFilter.NumField(); k++ {
			field := evtFilter.Field(k)
			i := field.Interface()
			if filters, ok := i.([]Filter); ok {
				for _, f := range filters {
					if err := f.Validate(); err != nil {
						return fmt.Errorf("%s bad %s filter: %w", filterName, evtFilter.Type().Field(k).Name, err)
					}
				}
			}
		}
	}
	return nil
}

type RuleGroup struct {
	Filters
	Name     string `xml:"name,attr,omitempty" json:",omitempty"`
	Relation string `xml:"groupRelation,attr,omitempty" json:"groupRelation,omitempty"`
}

func (g *RuleGroup) Validate() error {
	if !validate(g.Relation, ValidGroupRelation...) {
		return fmt.Errorf("%w %s", ErrInvalidGroupRelation, g.Relation)
	}

	return g.Filters.Validate()
}

type EventFiltering struct {
	Filters
	RuleGroup []RuleGroup
}

type InnerConfig struct {
	XMLName                xml.Name  `xml:"Sysmon" json:"-"`
	SchemaVersion          string    `xml:"schemaversion,attr" json:"schemaversion"`
	ArchiveDirectory       string    `xml:",omitempty" json:",omitempty"`
	CheckRevocation        bool      `xml:",omitempty"`
	CopyOnDeletePE         bool      `xml:",omitempty"`
	CopyOnDeleteSIDs       csstrings `xml:",omitempty" json:",omitempty"`
	CopyOnDeleteExtensions csstrings `xml:",omitempty" json:",omitempty"`
	CopyOnDeleteProcesses  csstrings `xml:",omitempty" json:",omitempty"`
	DriverName             string    `xml:",omitempty" json:",omitempty"`
	DnsLookup              bool      `xml:",omitempty"`
	HashAlgorithms         csstrings `xml:",omitempty" json:",omitempty"`
	EventFiltering         EventFiltering
	// Don't validate Sysmon XML DTD
	XmlSha256 string `xml:"-"`
	OS        string `xml:"-"`
}

type Config struct {
	sod.Item
	InnerConfig
}

func (c Config) MarshalJSON() (b []byte, err error) {
	if c.XmlSha256, err = c.Sha256(); err != nil {
		return
	}
	return json.MarshalIndent(c.InnerConfig, "", "  ")
}

func (c *Config) Validate() (err error) {
	if !schemaVersionRe.MatchString(c.SchemaVersion) {
		return fmt.Errorf("%w %s", ErrInvalidSchemaVersion, c.SchemaVersion)
	}

	if !los.IsKnownOS(c.OS) {
		return fmt.Errorf("%w %s", ErrUnknownOS, c.OS)
	}

	for _, ha := range c.HashAlgorithms {
		if !validate(ha, ValidHashAlgorithm...) {
			return fmt.Errorf("%w %s", ErrInvalidHashAlgorithm, ha)
		}
	}

	if err = c.EventFiltering.Validate(); err != nil {
		return
	}

	for _, rg := range c.EventFiltering.RuleGroup {
		if err = rg.Validate(); err != nil {
			return
		}
	}

	return
}

func (c *Config) XML() (b []byte, err error) {
	return xml.MarshalIndent(c, "", "  ")
}

func (c *Config) Sha256() (sha256 string, err error) {
	var b []byte

	if b, err = c.XML(); err != nil {
		return
	}

	sha256 = data.Sha256(b)

	return
}

// to manage comma separated strings used by some Sysmon config fields
type csstrings []string

func (s csstrings) MarshalXML(e *xml.Encoder, start xml.StartElement) error {
	return e.EncodeElement(strings.Join(s, ","), start)
}

func (s *csstrings) UnmarshalXML(d *xml.Decoder, start xml.StartElement) (err error) {
	var csstring string
	if err = d.DecodeElement(&csstring, &start); err != nil {
		return
	}
	*s = strings.Split(csstring, ",")
	return
}

```

`sysmon/default.go`:

```go
package sysmon

import (
	"encoding/xml"
	"fmt"

	"github.com/0xrawsec/whids/los"
)

var (
	agnosticConfig = `<Sysmon schemaversion="%s">
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>
    <ProcessCreate onmatch="exclude"></ProcessCreate>

    <FileCreateTime onmatch="exclude"></FileCreateTime>

    <NetworkConnect onmatch="exclude"></NetworkConnect>

    <ProcessTerminate onmatch="exclude"></ProcessTerminate>

    <DriverLoad onmatch="exclude"></DriverLoad>

    <CreateRemoteThread onmatch="exclude"></CreateRemoteThread>

    <RawAccessRead onmatch="exclude"></RawAccessRead>

    <FileCreate onmatch="exclude"></FileCreate>

    <FileCreateStreamHash onmatch="exclude"></FileCreateStreamHash>

    <PipeEvent onmatch="exclude"></PipeEvent>

    <WmiEvent onmatch="exclude"></WmiEvent>

    <FileDelete onmatch="exclude"></FileDelete>

    <ClipboardChange onmatch="exclude"></ClipboardChange>

    <ProcessTampering onmatch="exclude"></ProcessTampering>

    <FileDeleteDetected onmatch="exclude"></FileDeleteDetected>

	  <ImageLoad onmatch="exclude"></ImageLoad>

    <ProcessAccess onmatch="exclude">
      <GrantedAccess condition="is">0x2000</GrantedAccess>
      <GrantedAccess condition="is">0x100000</GrantedAccess>
      <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
      <!-- Microsoft Defender -->
		  <SourceImage condition="contains all">C:\ProgramData\Microsoft\Windows Defender\Platform\;\MsMpEng.exe</SourceImage>
    </ProcessAccess>

	  <RegistryEvent onmatch="exclude">
		  <EventType condition="is not">SetValue</EventType>
	  </RegistryEvent>

	  <DnsQuery onmatch="exclude"></DnsQuery>
  </EventFiltering>
</Sysmon>`
)

func SetAgnosticConfig(template string) {
	agnosticConfig = template
}

func AgnosticConfig(schemaversion string) (c *Config, err error) {

	config := []byte(fmt.Sprintf(agnosticConfig, schemaversion))

	if err = xml.Unmarshal(config, &c); err != nil {
		return
	}

	// set sha256 of config structure
	if c.XmlSha256, err = c.Sha256(); err != nil {
		return
	}

	// Config struct needs a valid OS to be validated
	c.OS = los.OS
	err = c.Validate()
	return
}

```

`sysmon/filters.go`:

```go
package sysmon

/*
   This file has been auto-generated, do not edit it directly
   as it may be overwritten in the future
*/

var (
	Conditions = []string{
		"is",
		"is not",
		"contains",
		"contains any",
		"is any",
		"contains all",
		"excludes",
		"excludes any",
		"excludes all",
		"begin with",
		"not begin with",
		"end with",
		"not end with",
		"less than",
		"more than",
		"image",
	}
)

type ProcessCreate struct {
	EventFilter
	RuleName          []Filter `json:",omitempty"`
	UtcTime           []Filter `json:",omitempty"`
	ProcessGuid       []Filter `json:",omitempty"`
	ProcessId         []Filter `json:",omitempty"`
	Image             []Filter `json:",omitempty"`
	FileVersion       []Filter `json:",omitempty"`
	Description       []Filter `json:",omitempty"`
	Product           []Filter `json:",omitempty"`
	Company           []Filter `json:",omitempty"`
	OriginalFileName  []Filter `json:",omitempty"`
	CommandLine       []Filter `json:",omitempty"`
	CurrentDirectory  []Filter `json:",omitempty"`
	User              []Filter `json:",omitempty"`
	LogonGuid         []Filter `json:",omitempty"`
	LogonId           []Filter `json:",omitempty"`
	TerminalSessionId []Filter `json:",omitempty"`
	IntegrityLevel    []Filter `json:",omitempty"`
	Hashes            []Filter `json:",omitempty"`
	ParentProcessGuid []Filter `json:",omitempty"`
	ParentProcessId   []Filter `json:",omitempty"`
	ParentImage       []Filter `json:",omitempty"`
	ParentCommandLine []Filter `json:",omitempty"`
}

type FileCreateTime struct {
	EventFilter
	RuleName                []Filter `json:",omitempty"`
	UtcTime                 []Filter `json:",omitempty"`
	ProcessGuid             []Filter `json:",omitempty"`
	ProcessId               []Filter `json:",omitempty"`
	Image                   []Filter `json:",omitempty"`
	TargetFilename          []Filter `json:",omitempty"`
	CreationUtcTime         []Filter `json:",omitempty"`
	PreviousCreationUtcTime []Filter `json:",omitempty"`
}

type NetworkConnect struct {
	EventFilter
	RuleName            []Filter `json:",omitempty"`
	UtcTime             []Filter `json:",omitempty"`
	ProcessGuid         []Filter `json:",omitempty"`
	ProcessId           []Filter `json:",omitempty"`
	Image               []Filter `json:",omitempty"`
	User                []Filter `json:",omitempty"`
	Protocol            []Filter `json:",omitempty"`
	Initiated           []Filter `json:",omitempty"`
	SourceIsIpv6        []Filter `json:",omitempty"`
	SourceIp            []Filter `json:",omitempty"`
	SourceHostname      []Filter `json:",omitempty"`
	SourcePort          []Filter `json:",omitempty"`
	SourcePortName      []Filter `json:",omitempty"`
	DestinationIsIpv6   []Filter `json:",omitempty"`
	DestinationIp       []Filter `json:",omitempty"`
	DestinationHostname []Filter `json:",omitempty"`
	DestinationPort     []Filter `json:",omitempty"`
	DestinationPortName []Filter `json:",omitempty"`
}

type ProcessTerminate struct {
	EventFilter
	RuleName    []Filter `json:",omitempty"`
	UtcTime     []Filter `json:",omitempty"`
	ProcessGuid []Filter `json:",omitempty"`
	ProcessId   []Filter `json:",omitempty"`
	Image       []Filter `json:",omitempty"`
}

type DriverLoad struct {
	EventFilter
	RuleName        []Filter `json:",omitempty"`
	UtcTime         []Filter `json:",omitempty"`
	ImageLoaded     []Filter `json:",omitempty"`
	Hashes          []Filter `json:",omitempty"`
	Signed          []Filter `json:",omitempty"`
	Signature       []Filter `json:",omitempty"`
	SignatureStatus []Filter `json:",omitempty"`
}

type ImageLoad struct {
	EventFilter
	RuleName         []Filter `json:",omitempty"`
	UtcTime          []Filter `json:",omitempty"`
	ProcessGuid      []Filter `json:",omitempty"`
	ProcessId        []Filter `json:",omitempty"`
	Image            []Filter `json:",omitempty"`
	ImageLoaded      []Filter `json:",omitempty"`
	FileVersion      []Filter `json:",omitempty"`
	Description      []Filter `json:",omitempty"`
	Product          []Filter `json:",omitempty"`
	Company          []Filter `json:",omitempty"`
	OriginalFileName []Filter `json:",omitempty"`
	Hashes           []Filter `json:",omitempty"`
	Signed           []Filter `json:",omitempty"`
	Signature        []Filter `json:",omitempty"`
	SignatureStatus  []Filter `json:",omitempty"`
}

type CreateRemoteThread struct {
	EventFilter
	RuleName          []Filter `json:",omitempty"`
	UtcTime           []Filter `json:",omitempty"`
	SourceProcessGuid []Filter `json:",omitempty"`
	SourceProcessId   []Filter `json:",omitempty"`
	SourceImage       []Filter `json:",omitempty"`
	TargetProcessGuid []Filter `json:",omitempty"`
	TargetProcessId   []Filter `json:",omitempty"`
	TargetImage       []Filter `json:",omitempty"`
	NewThreadId       []Filter `json:",omitempty"`
	StartAddress      []Filter `json:",omitempty"`
	StartModule       []Filter `json:",omitempty"`
	StartFunction     []Filter `json:",omitempty"`
}

type RawAccessRead struct {
	EventFilter
	RuleName    []Filter `json:",omitempty"`
	UtcTime     []Filter `json:",omitempty"`
	ProcessGuid []Filter `json:",omitempty"`
	ProcessId   []Filter `json:",omitempty"`
	Image       []Filter `json:",omitempty"`
	Device      []Filter `json:",omitempty"`
}

type ProcessAccess struct {
	EventFilter
	RuleName          []Filter `json:",omitempty"`
	UtcTime           []Filter `json:",omitempty"`
	SourceProcessGUID []Filter `json:",omitempty"`
	SourceProcessId   []Filter `json:",omitempty"`
	SourceThreadId    []Filter `json:",omitempty"`
	SourceImage       []Filter `json:",omitempty"`
	TargetProcessGUID []Filter `json:",omitempty"`
	TargetProcessId   []Filter `json:",omitempty"`
	TargetImage       []Filter `json:",omitempty"`
	GrantedAccess     []Filter `json:",omitempty"`
	CallTrace         []Filter `json:",omitempty"`
}

type FileCreate struct {
	EventFilter
	RuleName        []Filter `json:",omitempty"`
	UtcTime         []Filter `json:",omitempty"`
	ProcessGuid     []Filter `json:",omitempty"`
	ProcessId       []Filter `json:",omitempty"`
	Image           []Filter `json:",omitempty"`
	TargetFilename  []Filter `json:",omitempty"`
	CreationUtcTime []Filter `json:",omitempty"`
}

type RegistryEvent struct {
	EventFilter
	RuleName     []Filter `json:",omitempty"`
	EventType    []Filter `json:",omitempty"`
	UtcTime      []Filter `json:",omitempty"`
	ProcessGuid  []Filter `json:",omitempty"`
	ProcessId    []Filter `json:",omitempty"`
	Image        []Filter `json:",omitempty"`
	TargetObject []Filter `json:",omitempty"`
}

type FileCreateStreamHash struct {
	EventFilter
	RuleName        []Filter `json:",omitempty"`
	UtcTime         []Filter `json:",omitempty"`
	ProcessGuid     []Filter `json:",omitempty"`
	ProcessId       []Filter `json:",omitempty"`
	Image           []Filter `json:",omitempty"`
	TargetFilename  []Filter `json:",omitempty"`
	CreationUtcTime []Filter `json:",omitempty"`
	Hash            []Filter `json:",omitempty"`
	Contents        []Filter `json:",omitempty"`
}

type PipeEvent struct {
	EventFilter
	RuleName    []Filter `json:",omitempty"`
	EventType   []Filter `json:",omitempty"`
	UtcTime     []Filter `json:",omitempty"`
	ProcessGuid []Filter `json:",omitempty"`
	ProcessId   []Filter `json:",omitempty"`
	PipeName    []Filter `json:",omitempty"`
	Image       []Filter `json:",omitempty"`
}

type WmiEvent struct {
	EventFilter
	RuleName       []Filter `json:",omitempty"`
	EventType      []Filter `json:",omitempty"`
	UtcTime        []Filter `json:",omitempty"`
	Operation      []Filter `json:",omitempty"`
	User           []Filter `json:",omitempty"`
	EventNamespace []Filter `json:",omitempty"`
	Name           []Filter `json:",omitempty"`
	Query          []Filter `json:",omitempty"`
}

type DnsQuery struct {
	EventFilter
	RuleName     []Filter `json:",omitempty"`
	UtcTime      []Filter `json:",omitempty"`
	ProcessGuid  []Filter `json:",omitempty"`
	ProcessId    []Filter `json:",omitempty"`
	QueryName    []Filter `json:",omitempty"`
	QueryStatus  []Filter `json:",omitempty"`
	QueryResults []Filter `json:",omitempty"`
	Image        []Filter `json:",omitempty"`
}

type FileDelete struct {
	EventFilter
	RuleName       []Filter `json:",omitempty"`
	UtcTime        []Filter `json:",omitempty"`
	ProcessGuid    []Filter `json:",omitempty"`
	ProcessId      []Filter `json:",omitempty"`
	User           []Filter `json:",omitempty"`
	Image          []Filter `json:",omitempty"`
	TargetFilename []Filter `json:",omitempty"`
	Hashes         []Filter `json:",omitempty"`
	IsExecutable   []Filter `json:",omitempty"`
	Archived       []Filter `json:",omitempty"`
}

type ClipboardChange struct {
	EventFilter
	RuleName    []Filter `json:",omitempty"`
	UtcTime     []Filter `json:",omitempty"`
	ProcessGuid []Filter `json:",omitempty"`
	ProcessId   []Filter `json:",omitempty"`
	Image       []Filter `json:",omitempty"`
	Session     []Filter `json:",omitempty"`
	ClientInfo  []Filter `json:",omitempty"`
	Hashes      []Filter `json:",omitempty"`
	Archived    []Filter `json:",omitempty"`
}

type ProcessTampering struct {
	EventFilter
	RuleName    []Filter `json:",omitempty"`
	UtcTime     []Filter `json:",omitempty"`
	ProcessGuid []Filter `json:",omitempty"`
	ProcessId   []Filter `json:",omitempty"`
	Image       []Filter `json:",omitempty"`
	Type        []Filter `json:",omitempty"`
}

type FileDeleteDetected struct {
	EventFilter
	RuleName       []Filter `json:",omitempty"`
	UtcTime        []Filter `json:",omitempty"`
	ProcessGuid    []Filter `json:",omitempty"`
	ProcessId      []Filter `json:",omitempty"`
	User           []Filter `json:",omitempty"`
	Image          []Filter `json:",omitempty"`
	TargetFilename []Filter `json:",omitempty"`
	Hashes         []Filter `json:",omitempty"`
	IsExecutable   []Filter `json:",omitempty"`
}

type Filters struct {
	ProcessCreate        *ProcessCreate        `xml:",omitempty" json:",omitempty"`
	FileCreateTime       *FileCreateTime       `xml:",omitempty" json:",omitempty"`
	NetworkConnect       *NetworkConnect       `xml:",omitempty" json:",omitempty"`
	ProcessTerminate     *ProcessTerminate     `xml:",omitempty" json:",omitempty"`
	DriverLoad           *DriverLoad           `xml:",omitempty" json:",omitempty"`
	ImageLoad            *ImageLoad            `xml:",omitempty" json:",omitempty"`
	CreateRemoteThread   *CreateRemoteThread   `xml:",omitempty" json:",omitempty"`
	RawAccessRead        *RawAccessRead        `xml:",omitempty" json:",omitempty"`
	ProcessAccess        *ProcessAccess        `xml:",omitempty" json:",omitempty"`
	FileCreate           *FileCreate           `xml:",omitempty" json:",omitempty"`
	RegistryEvent        *RegistryEvent        `xml:",omitempty" json:",omitempty"`
	FileCreateStreamHash *FileCreateStreamHash `xml:",omitempty" json:",omitempty"`
	PipeEvent            *PipeEvent            `xml:",omitempty" json:",omitempty"`
	WmiEvent             *WmiEvent             `xml:",omitempty" json:",omitempty"`
	DnsQuery             *DnsQuery             `xml:",omitempty" json:",omitempty"`
	FileDelete           *FileDelete           `xml:",omitempty" json:",omitempty"`
	ClipboardChange      *ClipboardChange      `xml:",omitempty" json:",omitempty"`
	ProcessTampering     *ProcessTampering     `xml:",omitempty" json:",omitempty"`
	FileDeleteDetected   *FileDeleteDetected   `xml:",omitempty" json:",omitempty"`
}

```

`sysmon/scripts/codegen.sh`:

```sh
#!/bin/bash

if [ -f "$1" ]
then
    xq '.' "$1" | python genstruct.py - | gofmt
else
    echo "Usage: $(basename $0) SYSMON_SCHEMA_XML"
fi
```

`sysmon/scripts/genstruct.py`:

```py
#!/usr/bin/env python
import sys
import json
import argparse
import os

package = os.path.dirname((os.path.realpath(__file__))).split(os.path.sep)[-2]

def convert_type(t: str) -> str:
    return "[]Filter"
    '''if t in ["win:UnicodeString", "win:GUID"]:
        return "string"
    if t == "win:UInt32":
        return "uint32"
    if t == "win:HexInt32":
        return "int32"
    if t == "win:HexInt64":
        return "int64"
    if t == "win:Boolean":
        return "bool"
    if t == "win:UInt16":
        return "uint16"
    raise TypeError(t)'''

def emit_struct(d: dict) -> str:
    name = d["@rulename"]
    data = d["data"]
    out = [
        f"type {name} struct {{",
        "\tEventFilter",
    ]
    for d in data:
        fname = d["@name"]
        intype = convert_type(d["@inType"])
        out.append(f'\t{fname} {intype} `json:",omitempty"`')
    out.append("}")
    return "\n".join(out)

def emit_conditions(text: str) -> str:
    conditions = text.split(",")
    out = [
        "Conditions = []string{"
    ]
    for c in conditions:
        out.append(f'"{c}",')
    out.append("}")
    return "\n".join(out)

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("JSON_SCHEMA", help="JSON schema generated with xq")

    args = parser.parse_args()

    if args.JSON_SCHEMA == "-":
        schema = json.load(sys.stdin)
    else:
        with open(args.JSON_SCHEMA) as fd:
            schema = json.load(fd)
    
    print(f"package {package}\n")
    
    print('''
    /*
    This file has been auto-generated, do not edit it directly
    as it may be overwritten in the future
    */
    \n''')

    # variables
    print("var (")
    print(emit_conditions(schema["manifest"]["configuration"]["filters"]["#text"]))
    print(")")


    done = []
    for event in schema["manifest"]["events"]["event"]:
        if "@rulename" not in event:
            continue
        if event["@rulename"] in done:
            continue
        struct = emit_struct(event)
        print(struct, end="\n\n")
        done.append(event["@rulename"])
    
    print("type Filters struct {")
    for t in done:
        print(f'{t} *{t} `xml:",omitempty" json:",omitempty"`')
    print("}")



```

`sysmon/sysmon.go`:

```go
package sysmon

import "fmt"

var (
	ErrSysmonNotInstalled = fmt.Errorf("sysmon is not installed")
)

type Info struct {
	Version string `json:"version"`

	Service struct {
		Name   string `json:"name"`
		Image  string `json:"image"`
		Sha256 string `json:"sha256"`
	} `json:"service"`
	Driver struct {
		Name   string `json:"name"`
		Image  string `json:"image"`
		Sha256 string `json:"sha256"`
	} `json:"driver"`
	Config struct {
		Version struct {
			Schema string `json:"schema"`
			Binary string `json:"binary"`
		} `json:"version"`
		Hash string `json:"hash"`
	} `json:"config"`
}

```

`sysmon/sysmon_test.go`:

```go
package sysmon

import (
	"encoding/json"
	"encoding/xml"
	"testing"

	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/los"
)

var (
	config = `<Sysmon schemaversion="4.70">
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>
    <ProcessCreate onmatch="exclude"></ProcessCreate>
    <FileCreateTime onmatch="exclude"></FileCreateTime>
    <NetworkConnect onmatch="exclude"></NetworkConnect>
    <ProcessTerminate onmatch="exclude"></ProcessTerminate>
    <DriverLoad onmatch="exclude"></DriverLoad>
    <CreateRemoteThread onmatch="exclude"></CreateRemoteThread>
    <RawAccessRead onmatch="exclude"></RawAccessRead>
    <FileCreate onmatch="exclude"></FileCreate>
    <FileCreateStreamHash onmatch="exclude"></FileCreateStreamHash>
    <PipeEvent onmatch="exclude"></PipeEvent>
    <WmiEvent onmatch="exclude"></WmiEvent>
    <FileDelete onmatch="exclude"></FileDelete>
    <ClipboardChange onmatch="exclude"></ClipboardChange>
    <ProcessTampering onmatch="exclude"></ProcessTampering>
    <FileDeleteDetected onmatch="exclude"></FileDeleteDetected>
    <RuleGroup groupRelation="or">
      <ImageLoad onmatch="exclude">
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        <Signature condition="is">Microsoft Windows Publisher</Signature>
        <Signature condition="is">Microsoft Corporation</Signature>
        <Signature condition="is">Microsoft Windows</Signature>
      </ImageLoad>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <ProcessAccess onmatch="exclude">
        <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        <GrantedAccess condition="is">0x1000</GrantedAccess>
        <GrantedAccess condition="is">0x2000</GrantedAccess>
        <GrantedAccess condition="is">0x3000</GrantedAccess>
        <GrantedAccess condition="is">0x100000</GrantedAccess>
        <GrantedAccess condition="is">0x101000</GrantedAccess>
      </ProcessAccess>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <RegistryEvent onmatch="exclude">
        <EventType condition="is not">SetValue</EventType>
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
      </RegistryEvent>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <DnsQuery onmatch="exclude">
        <Image condition="is">C:\Windows\Sysmon.exe</Image>
        <Image condition="is">C:\Windows\Sysmon64.exe</Image>
      </DnsQuery>
    </RuleGroup>
  </EventFiltering>
</Sysmon>`
)

func TestConfig(t *testing.T) {
	var sha256 string
	tt := toast.FromT(t)
	c := Config{}
	c.OS = los.OS

	if err := xml.Unmarshal([]byte(config), &c); err != nil {
		t.Error(err)
	} else {
		sha256, err = c.Sha256()
		tt.CheckErr(err)

		xml, err := c.XML()
		tt.CheckErr(err)
		tt.Assert(string(xml) == config, "xml marshaling is not stable")
		t.Log(string(xml))

		// we marshal config to json
		js, err := json.MarshalIndent(c, "", "  ")
		tt.CheckErr(err)
		t.Log(string(js))
		new, _ := c.Sha256()
		tt.Assert(new == sha256, "bad sha256")

		same := Config{}
		tt.CheckErr(json.Unmarshal(js, &same))

		sameSha256, err := same.Sha256()
		tt.CheckErr(err)
		tt.Assert(sameSha256 == sha256, "JSON marshaling is not stable")

		tt.CheckErr(same.Validate())
	}
}

func TestValidation(t *testing.T) {
	tt := toast.FromT(t)

	c := Config{}

	tt.ExpectErr(c.Validate(), ErrInvalidSchemaVersion)
	c.SchemaVersion = "4.70"

	// should return non nil error as os is not correct
	tt.ExpectErr(c.Validate(), ErrUnknownOS)
	c.OS = los.OS

	// testing onmatch validity
	tt.CheckErr(xml.Unmarshal([]byte(config), &c))
	c.EventFiltering.ProcessCreate = &ProcessCreate{}
	c.EventFiltering.ProcessCreate.OnMatch = "reject"
	tt.ExpectErr(c.Validate(), ErrInvalidOnMatch)
	c.EventFiltering.ProcessCreate.OnMatch = "exclude"
	tt.CheckErr(c.Validate())
	c.EventFiltering.ProcessCreate.OnMatch = "include"
	tt.CheckErr(c.Validate())

	// testing hash algorithm validity
	c.HashAlgorithms = []string{"SHA512"}
	tt.ExpectErr(c.Validate(), ErrInvalidHashAlgorithm)
	for _, ha := range ValidHashAlgorithm {
		c.HashAlgorithms = []string{ha}
		tt.CheckErr(c.Validate())
	}

	// testing condition validity
	c.EventFiltering.ProcessCreate.CommandLine = make([]Filter, 1)
	filter := &c.EventFiltering.ProcessCreate.CommandLine[0]
	filter.Condition = "has"
	tt.ExpectErr(c.Validate(), ErrInvalidCondition)
	for _, cdt := range Conditions {
		filter.Condition = cdt
		tt.CheckErr(c.Validate())
	}

	// testing rule group validity
	rg := &c.EventFiltering.RuleGroup[0]
	rg.Relation = "not and"
	tt.ExpectErr(c.Validate(), ErrInvalidGroupRelation)
	for _, rel := range ValidGroupRelation {
		rg.Relation = rel
		tt.CheckErr(c.Validate())
	}
}

```

`sysmon/sysmon_windows.go`:

```go
//go:build windows
// +build windows

package sysmon

import (
	"errors"
	"fmt"
	"io"
	"os"
	"path/filepath"
	"regexp"
	"strings"
	"time"

	"github.com/0xrawsec/golang-utils/crypto/file"
	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/golang-utils/regexp/submatch"
	"github.com/0xrawsec/golang-win32/win32"
	"github.com/0xrawsec/golang-win32/win32/advapi32"
	"github.com/0xrawsec/whids/utils"
	"github.com/0xrawsec/whids/utils/command"
)

const (
	servicesPath = `HKLM\SYSTEM\CurrentControlSet\Services`
	driverPath   = `C:\Windows`
)

var (
	versionRe = regexp.MustCompile(
		`(?s:System\sMonitor\s(?P<version>v\d+(\.\d+)?)\s-[.\s].*` +
			`<manifest schemaversion="(?P<schemaversion>\d+(\.\d+)?)" binaryversion="(?P<binaryversion>\d+(\.\d+)?)">)`,
	)

	DefaultTimeout = 5 * time.Second
)

func stdCmdOutput(b []byte) []byte {
	if len(b) >= 2 {
		// check UTF16 BOM
		if b[1] == '\xfe' && b[0] == '\xff' {
			b = []byte(win32.UTF16BytesToString(b))
		}
	}
	return b
}

func Versions(image string) (version, schema, binary string, err error) {
	var out []byte

	sh := submatch.NewHelper(versionRe)

	if fsutil.IsFile(image) {

		c := command.CommandTimeout(
			DefaultTimeout,
			image,
			"-s",
		)
		defer c.Terminate()

		if out, err = c.CombinedOutput(); err != nil {
			err = fmt.Errorf("failed to run sysmon schema command: %s", err)
			return
		}

		// standardize output
		out = stdCmdOutput(out)

		sh.Prepare(out)
		if v, err := sh.GetBytes("version"); err == nil {
			version = string(v)
		}
		if sv, err := sh.GetBytes("schemaversion"); err == nil {
			schema = string(sv)
		}
		if bv, err := sh.GetBytes("binaryversion"); err == nil {
			binary = string(bv)
		}
	}

	return
}

func InstallOrUpdate(image string) (err error) {
	var out []byte

	// we first uninstall existing installation
	// if Sysmon is not installed yet we should not get any error
	if err = Uninstall(); err != nil && !errors.Is(err, ErrSysmonNotInstalled) {
		return
	}

	// we run install
	c := command.CommandTimeout(DefaultTimeout, image, "-accepteula", "-i")
	defer c.Terminate()
	if out, err = c.CombinedOutput(); err != nil {
		out = stdCmdOutput(out)
		return fmt.Errorf("failed to install sysmon: %w\n%s", err, out)
	}

	return
}

func Configure(r io.Reader) (err error) {
	var tmp, config string
	var i *Info

	// retrieve sysmon information
	if i, err = NewSysmonInfo(); err != nil {
		return
	}

	image := i.Service.Image

	if !fsutil.IsFile(image) {
		return ErrSysmonNotInstalled
	}

	if tmp, err = utils.HidsMkTmpDir(); err != nil {
		return fmt.Errorf("failed to create tmp dir: %w", err)
	}
	// remove temporary file
	defer os.RemoveAll(tmp)

	config = filepath.Join(tmp, "sysmon.xml")
	if err = utils.HidsWriteReader(config, r, false); err != nil {
		return fmt.Errorf("failed to create config file: %w", err)
	}

	c := command.CommandTimeout(DefaultTimeout, image, "-c", config)
	defer c.Terminate()
	if err = c.Run(); err != nil {
		return fmt.Errorf("command to configure sysmon failed: %w", err)
	}

	return
}

func Uninstall() (err error) {
	var i *Info
	var out []byte

	// retrieve sysmon information
	if i, err = NewSysmonInfo(); err != nil {
		return
	}

	image := i.Service.Image

	//means sysmon is already installed
	if fsutil.IsFile(image) {
		// we uninstall it
		// force flag forces all components to uninstall
		c := command.CommandTimeout(DefaultTimeout, image, "-u", "force")
		defer c.Terminate()

		if out, err = c.CombinedOutput(); err != nil {
			out = stdCmdOutput(out)
			return fmt.Errorf("failed to uninstall sysmon: %w\n%s", err, string(out))
		}

		if err = os.Remove(image); err != nil {
			return fmt.Errorf("failed to remove sysmon binary: %w", err)
		}
	}

	// we don't return any error if Sysmon is not yet installed
	return
}

func findMatchingSysmonServiceKeys() (keys []string) {
	keys = make([]string, 0)

	if skeys, err := advapi32.RegEnumKeys(servicesPath); err != nil {
		return
	} else {
		for _, skey := range skeys {
			fullSubKey := utils.RegJoin(servicesPath, skey)
			descValue := utils.RegJoin(fullSubKey, "Description")
			if desc := utils.RegValueToString(descValue); desc != "" {
				if strings.EqualFold(desc, "System Monitor service") {
					keys = append(keys, skey)
				}
			}
		}
	}
	return
}

func NewSysmonInfo() (i *Info, err error) {
	var sysmonRegPath string

	i = &Info{}

	// validate that we find only one entry in registry
	keys := findMatchingSysmonServiceKeys()

	// sysmon is not installed
	if len(keys) == 0 {
		err = ErrSysmonNotInstalled
		return
	}

	// more than one key found -> not normal
	if len(keys) > 1 {
		err = fmt.Errorf("more than one key looking like Sysmon: %v", keys)
		return
	}

	i.Service.Name = keys[0]

	sysmonRegPath = utils.RegJoin(servicesPath, i.Service.Name)
	i.Service.Image = utils.RegValueToString(sysmonRegPath, "ImagePath")
	i.Service.Sha256, _ = file.Sha256(i.Service.Image)

	i.Driver.Name = i.DriverName()
	i.Driver.Image = filepath.Join(driverPath, utils.RegValueToString(i.DriverRegistry(), "ImagePath"))
	i.Driver.Sha256, _ = file.Sha256(i.Driver.Image)

	i.Config.Hash = i.ConfigHash()

	// parse schema and populate version information
	err = i.parseSchema()

	return
}

func (i *Info) ServiceRegistry() string {
	return utils.RegJoin(servicesPath, i.Service.Name)
}

func (i *Info) ServiceParametersRegistry() string {
	return utils.RegJoin(servicesPath, i.Service.Name, "Parameters")
}

func (i *Info) DriverName() string {
	if i.Driver.Name != "" {
		return i.Driver.Name
	}
	return utils.RegValueToString(i.ServiceParametersRegistry(), "DriverName")
}

func (i *Info) DriverRegistry() string {
	return utils.RegJoin(servicesPath, i.DriverName())
}

func (i *Info) DriverParametersRegistry() string {
	return utils.RegJoin(i.DriverRegistry(), "Parameters")
}

func (i *Info) ConfigHash() string {
	if i.Config.Hash != "" {
		return i.Config.Hash
	}
	hash := utils.RegValueToString(i.DriverParametersRegistry(), "ConfigHash")
	if i := strings.Index(hash, "="); i > -1 && i+1 < len(hash) {
		hash = strings.ToLower(hash[i+1:])
	}
	return hash
}

func (i *Info) parseSchema() (err error) {
	var version, schema, binary string

	version, schema, binary, err = Versions(i.Service.Image)
	i.Version = version
	i.Config.Version.Schema = schema
	i.Config.Version.Binary = binary

	return
}

```

`sysmon/sysmon_windows_test.go`:

```go
//go:build windows
// +build windows

package sysmon

import (
	"bytes"
	"encoding/xml"
	"testing"
	"time"

	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/utils"
)

func init() {
	// testing on WSL makes Windows command
	// very long to respond
	DefaultTimeout = 60 * time.Second
}

func TestSysmonInfo(t *testing.T) {
	var c *Config

	tt := toast.FromT(t)

	// we run uninstall first
	Uninstall()
	defer Uninstall()

	_, err := NewSysmonInfo()

	tt.ExpectErr(err, ErrSysmonNotInstalled)

	tt.CheckErr(InstallOrUpdate("./data/Sysmon64.exe"))

	i, err := NewSysmonInfo()
	t.Log(utils.PrettyJsonOrPanic(i))
	tt.CheckErr(err)

	// we deserialize config
	tt.CheckErr(xml.Unmarshal([]byte(config), &c))
	// we force the good schema version to be the one of sysmon installed
	c.SchemaVersion = i.Config.Version.Schema
	xmlConfig, err := c.XML()
	tt.CheckErr(err)

	// configuring Sysmon
	tt.CheckErr(Configure(bytes.NewBuffer(xmlConfig)))

	i, err = NewSysmonInfo()
	tt.CheckErr(err)

	sha256, err := c.Sha256()
	tt.CheckErr(err)
	tt.Assert(i.Config.Hash == sha256)

	tt.CheckErr(Uninstall())
}

```

`tools/tools.go`:

```go
package tools

import (
	"fmt"
	"os"
	"path/filepath"
	"strings"

	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/sod"
	"github.com/0xrawsec/whids/los"
	"github.com/0xrawsec/whids/utils"
)

const (
	ToolSysmon   = "sysmon"
	ToolOSQueryi = "osqueryi"
)

func WithExecExt(name string) string {
	return fmt.Sprintf("%s%s", name, los.ExecExt)
}

type Metadata struct {
	Md5    string `sod:"lower,index" json:"md5"`
	Sha1   string `sod:"lower,index" json:"sha1"`
	Sha256 string `sod:"lower,index" json:"sha256"`
	Sha512 string `sod:"lower,index" json:"sha512"`
}

type Tool struct {
	sod.Item
	Uuid     string   `sod:"index,unique" json:"uuid"`
	OS       string   `sod:"index" json:"os"`
	Name     string   `sod:"index" json:"name"`
	Alias    string   `json:"alias"`
	Metadata Metadata `json:"metadata"`
	Binary   []byte   `json:"binary,omitempty"`
}

func New(os, name, alias string, binary []byte) (t *Tool) {

	if alias == "" {
		alias, _, _ = strings.Cut(name, ".")
	}

	t = &Tool{
		OS:    os,
		Name:  name,
		Alias: alias,
	}

	// using tool's uuid for object storage
	t.Uuid = utils.UnsafeUUID().String()
	t.Initialize(t.Uuid)

	t.Update(binary)

	return
}

func (t *Tool) Update(binary []byte) {
	t.Binary = binary
	t.Metadata = Metadata{
		Md5:    data.Md5(binary),
		Sha1:   data.Sha1(binary),
		Sha256: data.Sha256(binary),
		Sha512: data.Sha512(binary),
	}
}

func (t *Tool) Filepath(dir string) string {
	base := fmt.Sprintf("%s%s", t.Name, los.ExecExt)
	return filepath.Join(dir, base)
}

func (t *Tool) Dump(dir string) error {
	if err := utils.HidsMkdirAll(dir); err != nil {
		return err
	}
	return utils.HidsWriteData(t.Filepath(dir), t.Binary)
}

func (t *Tool) Remove(dir string) error {
	return os.Remove(t.Filepath(dir))
}

// Validate function triggered by database insertion
// Structure will not be inserted if any error is returned by
// this function
func (t *Tool) Validate() error {

	if strings.Contains(t.Name, los.WinPathSep) || strings.Contains(t.Name, los.NixPathSep) {
		return fmt.Errorf("tool name must not contain any path separator")
	}

	if !los.IsKnownOS(t.OS) {
		return fmt.Errorf("unknown OS %s", t.OS)
	}

	return nil
}

```

`utilities/manager/makefile`:

```
TEST=$(GOPATH)/test
MAIN_BASEN_SRC=whids-man
RELEASE=$(GOPATH)/release/$(MAIN_BASEN_SRC)
VERSION=$(shell git tag | tail -1 | sed 's/^v//')
COMMITID=$(shell git rev-parse HEAD)

# Strips symbols and dwarf to make binary smaller
OPTS=-ldflags "-s -w" -trimpath
ifdef DEBUG
	OPTS=
endif

all:
	$(MAKE) clean
	$(MAKE) init
	$(MAKE) buildversion
	$(MAKE) compile

test: all
	cp -r $(RELEASE) $(TEST)


init:
	mkdir -p $(RELEASE)
	mkdir -p $(RELEASE)/windows
	mkdir -p $(RELEASE)/linux
	mkdir -p $(RELEASE)/darwin

install:
	go install $(OPTS) $(MAIN_BASEN_SRC).go

compile:
	$(MAKE) windows
	$(MAKE) linux
	$(MAKE) darwin

windows:
	GOARCH=386 GOOS=windows go build $(OPTS) -o $(RELEASE)/windows/$(MAIN_BASEN_SRC)-v$(VERSION)-386.exe *.go
	GOARCH=amd64 GOOS=windows go build $(OPTS) -o $(RELEASE)/windows/$(MAIN_BASEN_SRC)-v$(VERSION)-amd64.exe *.go
	cd $(RELEASE)/windows; shasum -a 256 * > sha256.txt
	#cd $(RELEASE)/windows; tar -cvzf ../$(MAIN_BASEN_SRC)-windows-$(VERSION).tar.gz *

linux:
	GOARCH=386 GOOS=linux go build $(OPTS) -o $(RELEASE)/linux/$(MAIN_BASEN_SRC)-v$(VERSION)-386 *.go
	GOARCH=amd64 GOOS=linux go build $(OPTS) -o $(RELEASE)/linux/$(MAIN_BASEN_SRC)-v$(VERSION)-amd64 *.go
	cd $(RELEASE)/linux; shasum -a 256 * > sha256.txt
	#cd $(RELEASE)/linux; tar -cvzf ../$(MAIN_BASEN_SRC)-linux-$(VERSION).tar.gz *

darwin:
	#GOARCH=386 GOOS=darwin go build $(OPTS) -o $(RELEASE)/darwin/$(MAIN_BASEN_SRC)-v$(VERSION)-386 *.go
	GOARCH=amd64 GOOS=darwin go build $(OPTS) -o $(RELEASE)/darwin/$(MAIN_BASEN_SRC)-v$(VERSION)-amd64 *.go
	cd $(RELEASE)/darwin; shasum -a 256 * > sha256.txt
	#cd $(RELEASE)/darwin; tar -cvzf ../$(MAIN_BASEN_SRC)-darwin-$(VERSION).tar.gz *

buildversion:
	printf "package main\n\nconst(\n    version=\"$(VERSION)\"\n    commitID=\"$(COMMITID)\"\n)\n" > version.go

clean:
	rm -rf $(RELEASE)/*

```

`utilities/manager/whids-man.go`:

```go
package main

import (
	"flag"
	"fmt"
	"io"
	"os"
	"os/signal"
	"path/filepath"
	"time"

	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/whids/api"
	"github.com/0xrawsec/whids/api/server"
	"github.com/0xrawsec/whids/utils"
	"github.com/pelletier/go-toml/v2"
)

const (
	copyright = "WHIDS Copyright (C) 2017 RawSec SARL (@0xrawsec)"
	license   = `AGPLv3: This program comes with ABSOLUTELY NO WARRANTY.`

	exitFail = 1
)

var (
	manager   *server.Manager
	osSignals = make(chan os.Signal)

	// Used for certificate generation
	defaultOrg          = "WHIDS Manager"
	defaultCertValidity = time.Hour * 24 * 365

	simpleManagerConfig = server.ManagerConfig{
		AdminAPI: server.AdminAPIConfig{
			Host: "localhost",
			Port: api.AdmAPIDefaultPort,
		},
		EndpointAPI: server.EndpointAPIConfig{
			Host: "0.0.0.0",
			Port: api.EptAPIDefaultPort,
		},
		Logging: server.ManagerLogConfig{
			Root:        "./data/logs",
			LogBasename: "forwarded",
		},
		DumpDir:  "./data/dumps",
		Database: "./data/database",
	}
)

/////////////////////////// generate_cert.go ///////////////////////////////////

func generateCert(hosts []string) (err error) {
	var key, cert []byte

	if key, cert, err = utils.GenerateCert(defaultOrg, hosts, defaultCertValidity); err != nil {
		return
	}

	if err = utils.HidsWriteData("key.pem", key); err != nil {
		return
	}

	if err = utils.HidsWriteData("cert.pem", cert); err != nil {
		return
	}

	return
}

func printInfo(writer io.Writer) {
	fmt.Fprintf(writer, "Version: %s (commit: %s)\nCopyright: %s\nLicense: %s\n\n", version, commitID, copyright, license)
}

var (
	keygen      bool
	certgen     bool
	dumpConfig  bool
	openapi     bool
	repairDB    bool
	fingerprint string
	user        string
	imprules    string

	logger *golog.Logger
)

func main() {

	flag.BoolVar(&keygen, "key", keygen, "Generate a random client API key. Both client and manager configuration file will needs to be updated with it.")
	flag.BoolVar(&certgen, "certgen", certgen, "Generate a couple (key and cert) to be used for TLS connections."+
		"The certificate gets generated for the IP address specified in the configuration file.")
	flag.BoolVar(&dumpConfig, "dump-config", dumpConfig, "Dumps a skeleton of manager configuration")
	flag.BoolVar(&openapi, "openapi", openapi, "Prints JSON formatted OpenAPI definition")
	flag.BoolVar(&repairDB, "repair", repairDB, "Attempt to repair database")
	flag.StringVar(&fingerprint, "fingerprint", fingerprint, "Retrieve fingerprint of certificate to set in client configuration")
	flag.StringVar(&user, "user", user, "Creates a new user")
	flag.StringVar(&imprules, "import", imprules, "Import Gene rules from a directory")

	flag.Usage = func() {
		printInfo(os.Stderr)
		fmt.Fprintf(os.Stderr, "Usage: %s [OPTIONS] CONFIG_FILE\n", filepath.Base(os.Args[0]))
		flag.PrintDefaults()
	}

	flag.Parse()

	config := flag.Arg(0)

	if keygen {
		var key string
		var err error

		if key, err = utils.NewKey(api.DefaultKeySize); err != nil {
			logger.Abort(exitFail, "failed to generate new key:", err)
		}

		fmt.Printf("New API key: %s\n", key)
		fmt.Printf("Please manually update client and manager configuration file to make it effective\n")
		os.Exit(0)
	}

	if fingerprint != "" {
		fing, err := utils.CertFileSha256(fingerprint)
		if err != nil {
			logger.Abort(exitFail, fmt.Errorf("failed at computing fingerprint: %s", err))
		}
		fmt.Printf("Certificate fingerprint to set in client configuration to enable certificate pinning\n%s\n", fing)
		os.Exit(0)
	}

	if dumpConfig {
		enc := toml.NewEncoder(os.Stdout)
		//enc.Order(toml.OrderPreserve)
		if err := enc.Encode(simpleManagerConfig); err != nil {
			panic(err)
		}
		os.Exit(0)
	}

	if openapi {
		fmt.Println(server.OpenAPIDefinition)
		os.Exit(0)
	}

	managerConf, err := server.LoadManagerConfig(config)
	if err != nil {
		logger.Abort(exitFail, fmt.Errorf("failed to load manager configuration: %s", err))
	}

	if user != "" {

		u := &server.AdminAPIUser{
			Uuid:       utils.UUIDOrPanic().String(),
			Identifier: user,
			Key:        utils.NewKeyOrPanic(api.DefaultKeySize),
		}

		manager, err = server.NewManager(managerConf)

		if err != nil {
			logger.Abort(exitFail, fmt.Errorf("failed to create manager: %s", err))
		}

		if err = manager.CreateNewAdminAPIUser(u); err != nil {
			logger.Abort(exitFail, err)
		}

		logger.Infof("New user successfully created: %s", utils.PrettyJsonOrPanic(u))

		logger.Abort(0, "User creation: SUCCESS")
	}

	if imprules != "" {
		manager, err = server.NewManager(managerConf)
		if err != nil {
			logger.Abort(exitFail, fmt.Errorf("failed to create manager: %s", err))
		}

		if err = manager.ImportRules(imprules); err != nil {
			logger.Abort(exitFail, err)
		}

		logger.Abort(0, "Rules import: SUCCESS")
	}

	if certgen {
		err = generateCert([]string{managerConf.EndpointAPI.Host, managerConf.AdminAPI.Host})
		if err != nil {
			logger.Abort(exitFail, fmt.Errorf("failed to generate key/cert pair: %s", err))
		}
		logger.Infof("Certificate and key generated should be used for testing purposes only.")
		os.Exit(0)
	}

	managerConf.Repair = repairDB
	if repairDB {
		logger.Infof("Attempting to repair broken database")
	}

	manager, err = server.NewManager(managerConf)
	if err != nil {
		logger.Abort(exitFail, fmt.Errorf("failed to create manager: %s", err))
	}

	// Registering signal handler for sig interrupt
	signal.Notify(osSignals, os.Interrupt)
	go func() {
		<-osSignals
		logger.Infof("Received SIGINT, shutting the manager down properly")
		manager.Shutdown()
	}()
	// Running the manager
	manager.Run()
	manager.Wait()
}

```

`utilities/sysmon/makefile`:

```
RELEASE=$(GOPATH)/release/sysmon
TEST=$(GOPATH)/test
WGET=/usr/bin/wget
STRINGS=/usr/bin/strings

all: clean
	mkdir -p $(RELEASE)
	$(MAKE) download
	$(MAKE) cpconfig
	$(MAKE) cpsysmon
	$(MAKE) finish

download:
	$(WGET) https://live.sysinternals.com/Sysmon64.exe
	
#test: clean
test:
	#echo "We do nothing"
	#mkdir -p $(RELEASE)
	$(MAKE) cpconfig
	#$(MAKE) finish
	#cp -r $(RELEASE) $(TEST)

cpconfig:
	cp -r v* $(RELEASE)
	
cpsysmon: 
	$(eval major := $(shell $(STRINGS) -e l Sysmon64.exe | grep -A 1 ProductVersion | tail -n 1 | cut -d '.' -f 1))
	#mkdir -p $(RELEASE)/v$(major)
	mkdir -p v$(major)/
	$(STRINGS) -e l Sysmon64.exe | grep -A 1 ProductVersion | tail -n 1 > v$(major)/version.txt
	mv Sysmon64.exe v$(major)/
	mkdir -p $(RELEASE)/
	cp -r v* $(RELEASE)/

finish:
	cd $(RELEASE); find -type f -not -name 'sha256.txt' | xargs shasum -a 256 > sha256.txt

clean:
	rm -rf $(RELEASE)/*
```

`utilities/sysmon/v10/sysmon-v10.4x-all.xml`:

```xml
<Sysmon schemaversion="4.22">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v10/sysmon-v10.4x-optimal.xml`:

```xml
<Sysmon schemaversion="4.22">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v10/sysmon-v10.4x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.22">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v10/sysmon-v10.x-all.xml`:

```xml
<Sysmon schemaversion="4.21">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v10/sysmon-v10.x-optimal.xml`:

```xml
<Sysmon schemaversion="4.21">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v10/sysmon-v10.x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.21">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v11/schema.xml`:

```xml

System Monitor v11.10 - System activity monitor
Copyright (C) 2014-2020 Mark Russinovich and Thomas Garnier
Sysinternals - www.sysinternals.com

<manifest schemaversion="4.32" binaryversion="9.20">
  <configuration>
    <options>
      <!-- Command-line only options -->
      <option switch="i" name="Install" argument="optional" noconfig="true" exclusive="true" />
      <option switch="c" name="Configuration" argument="optional" noconfig="true" exclusive="true" />
      <option switch="u" name="UnInstall" argument="optional" noconfig="true" exclusive="true" />
      <option switch="m" name="Manifest" argument="none" noconfig="true" exclusive="true" />
      <option switch="t" name="DebugMode" argument="optional" noconfig="true" />
      <option switch="s" name="PrintSchema" argument="optional" noconfig="true" exclusive="true" />
      <option switch="nologo" name="NoLogo" argument="none" noconfig="true" />
      <option switch="accepteula" name="AcceptEula" argument="none" noconfig="true" />
      <option switch="-" name="ConfigDefault" argument="none" noconfig="true" />
      <!-- Configuration file -->
      <option switch="a" name="ArchiveDirectory" argument="required" />
      <option switch="d" name="DriverName" argument="required" />
      <option switch="dns" name="DnsQuery" argument="optional" rule="true" />
      <option switch="g" name="PipeMonitoring" argument="required" rule="true" forceconfig="true" />
      <option switch="h" name="HashAlgorithms" argument="required" />
      <option name="DnsLookup" argument="required" />
      <option switch="k" name="ProcessAccess" argument="required" rule="true" forceconfig="true" />
      <option switch="l" name="ImageLoad" argument="optional" rule="true" />
      <option switch="n" name="NetworkConnect" argument="optional" rule="true" />
      <option switch="r" name="CheckRevocation" argument="none" />
    </options>
    <filters default="is">is,is not,contains,contains any,is any,contains all,excludes,excludes any,excludes all,begin with,end with,less than,more than,image</filters>
  </configuration>
  <events>
    <event name="SYSMON_ERROR" value="255" level="Error" template="Error report" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ID" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_CREATE_PROCESS" value="1" level="Informational" template="Process Create" rulename="ProcessCreate" ruledefault="include" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="FileVersion" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
      <data name="Product" inType="win:UnicodeString" outType="xs:string" />
      <data name="Company" inType="win:UnicodeString" outType="xs:string" />
      <data name="OriginalFileName" inType="win:UnicodeString" outType="xs:string" />
      <data name="CommandLine" inType="win:UnicodeString" outType="xs:string" />
      <data name="CurrentDirectory" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="LogonGuid" inType="win:GUID" />
      <data name="LogonId" inType="win:HexInt64" />
      <data name="TerminalSessionId" inType="win:UInt32" />
      <data name="IntegrityLevel" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="ParentProcessGuid" inType="win:GUID" />
      <data name="ParentProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="ParentImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="ParentCommandLine" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_FILE_TIME" value="2" level="Informational" template="File creation time changed" rulename="FileCreateTime" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="PreviousCreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_NETWORK_CONNECT" value="3" level="Informational" template="Network connection detected" rulename="NetworkConnect" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Protocol" inType="win:UnicodeString" outType="xs:string" />
      <data name="Initiated" inType="win:Boolean" />
      <data name="SourceIsIpv6" inType="win:Boolean" />
      <data name="SourceIp" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceHostname" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourcePort" inType="win:UInt16" />
      <data name="SourcePortName" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationIsIpv6" inType="win:Boolean" />
      <data name="DestinationIp" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationHostname" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationPort" inType="win:UInt16" />
      <data name="DestinationPortName" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_SERVICE_STATE_CHANGE" value="4" level="Informational" template="Sysmon service state changed" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="State" inType="win:UnicodeString" outType="xs:string" />
      <data name="Version" inType="win:UnicodeString" outType="xs:string" />
      <data name="SchemaVersion" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_PROCESS_TERMINATE" value="5" level="Informational" template="Process terminated" rulename="ProcessTerminate" ruledefault="include" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_DRIVER_LOAD" value="6" level="Informational" template="Driver loaded" rulename="DriverLoad" version="4">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ImageLoaded" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signed" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signature" inType="win:UnicodeString" outType="xs:string" />
      <data name="SignatureStatus" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_IMAGE_LOAD" value="7" level="Informational" template="Image loaded" rulename="ImageLoad" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="ImageLoaded" inType="win:UnicodeString" outType="xs:string" />
      <data name="FileVersion" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
      <data name="Product" inType="win:UnicodeString" outType="xs:string" />
      <data name="Company" inType="win:UnicodeString" outType="xs:string" />
      <data name="OriginalFileName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signed" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signature" inType="win:UnicodeString" outType="xs:string" />
      <data name="SignatureStatus" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_CREATE_REMOTE_THREAD" value="8" level="Informational" template="CreateRemoteThread detected" rulename="CreateRemoteThread" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceProcessGuid" inType="win:GUID" />
      <data name="SourceProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="SourceImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetProcessGuid" inType="win:GUID" />
      <data name="TargetProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="TargetImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="NewThreadId" inType="win:UInt32" />
      <data name="StartAddress" inType="win:UnicodeString" outType="xs:string" />
      <data name="StartModule" inType="win:UnicodeString" outType="xs:string" />
      <data name="StartFunction" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_RAWACCESS_READ" value="9" level="Informational" template="RawAccessRead detected" rulename="RawAccessRead" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Device" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_ACCESS_PROCESS" value="10" level="Informational" template="Process accessed" rulename="ProcessAccess" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceProcessGUID" inType="win:GUID" />
      <data name="SourceProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="SourceThreadId" inType="win:UInt32" />
      <data name="SourceImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetProcessGUID" inType="win:GUID" />
      <data name="TargetProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="TargetImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="GrantedAccess" inType="win:HexInt32" />
      <data name="CallTrace" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_FILE_CREATE" value="11" level="Informational" template="File created" rulename="FileCreate" ruledefault="include" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_REG_KEY" value="12" level="Informational" template="Registry object added or deleted" rulename="RegistryEvent" ruledefault="include" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_REG_SETVALUE" value="13" level="Informational" template="Registry value set" rulename="RegistryEvent" ruledefault="include" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
      <data name="Details" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_REG_NAME" value="14" level="Informational" template="Registry object renamed" rulename="RegistryEvent" ruledefault="include" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
      <data name="NewName" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_FILE_CREATE_STREAM_HASH" value="15" level="Informational" template="File stream created" rulename="FileCreateStreamHash" ruledefault="include" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hash" inType="win:UnicodeString" outType="xs:string" />
      <data name="Contents" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_SERVICE_CONFIGURATION_CHANGE" value="16" level="Informational" template="Sysmon config state changed" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Configuration" inType="win:UnicodeString" outType="xs:string" />
      <data name="ConfigurationFileHash" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_CREATE_NAMEDPIPE" value="17" level="Informational" template="Pipe Created" rulename="PipeEvent" ruledefault="exclude" version="1">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="PipeName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_CONNECT_NAMEDPIPE" value="18" level="Informational" template="Pipe Connected" rulename="PipeEvent" ruledefault="exclude" version="1">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="PipeName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_WMI_FILTER" value="19" level="Informational" template="WmiEventFilter activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventNamespace" inType="win:UnicodeString" outType="xs:string" />
      <data name="Name" inType="win:UnicodeString" outType="xs:string" />
      <data name="Query" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_WMI_CONSUMER" value="20" level="Informational" template="WmiEventConsumer activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Name" inType="win:UnicodeString" outType="xs:string" />
      <data name="Type" inType="win:UnicodeString" outType="xs:string" />
      <data name="Destination" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_WMI_BINDING" value="21" level="Informational" template="WmiEventConsumerToFilter activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Consumer" inType="win:UnicodeString" outType="xs:string" />
      <data name="Filter" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_DNS_QUERY" value="22" level="Informational" template="Dns query" rulename="DnsQuery" ruledefault="exclude" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="QueryName" inType="win:UnicodeString" outType="xs:string" />
      <data name="QueryStatus" inType="win:UnicodeString" outType="xs:string" />
      <data name="QueryResults" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMON_FILE_DELETE" value="23" level="Informational" template="File Delete" rulename="FileDelete" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="IsExecutable" inType="win:Boolean" />
      <data name="Archived" inType="win:UnicodeString" outType="xs:string" />
    </event>
  </events>
</manifest>

```

`utilities/sysmon/v11/sysmon-v11.1x-all.xml`:

```xml
<Sysmon schemaversion="4.32">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->

  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />
      
  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v11/sysmon-v11.1x-optimal.xml`:

```xml
<Sysmon schemaversion="4.32">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>
      
      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v11/sysmon-v11.1x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.32">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v11/version.txt`:

```txt
11.11

```

`utilities/sysmon/v12/sysmon-v12.x-all.xml`:

```xml
<Sysmon schemaversion="4.40">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->

  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />
      
  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v12/sysmon-v12.x-optimal.xml`:

```xml
<Sysmon schemaversion="4.40">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>
      
      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v12/sysmon-v12.x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.40">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v12/version.txt`:

```txt
12.02

```

`utilities/sysmon/v13/v13.0x/sysmon-v13.0x-all.xml`:

```xml
<Sysmon schemaversion="4.50">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->

  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />
      
  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.0x/sysmon-v13.0x-optimal.xml`:

```xml
<Sysmon schemaversion="4.50">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>
      
      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.0x/sysmon-v13.0x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.50">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />
      
      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.1x/schema.xml`:

```xml

System Monitor v13.10 - System activity monitor
Copyright (C) 2014-2021 Mark Russinovich and Thomas Garnier
Using libxml2. libxml2 is Copyright (C) 1998-2012 Daniel Veillard. All Rights Reserved.
Sysinternals - www.sysinternals.com

<manifest schemaversion="4.60" binaryversion="14.0">
  <configuration>
    <options>
      <!-- Command-line only options -->
      <option switch="i" name="Install" argument="optional" noconfig="true" exclusive="true" />
      <option switch="c" name="Configuration" argument="optional" noconfig="true" exclusive="true" />
      <option switch="u" name="UnInstall" argument="optional" noconfig="true" exclusive="true" />
      <option switch="m" name="Manifest" argument="none" noconfig="true" exclusive="true" />
      <option switch="z" name="ClipboardInstance" argument="required" noconfig="true" exclusive="true" />
      <option switch="t" name="DebugMode" argument="optional" noconfig="true" />
      <option switch="s" name="PrintSchema" argument="optional" noconfig="true" exclusive="true" />
      <option switch="nologo" name="NoLogo" argument="none" noconfig="true" />
      <option switch="accepteula" name="AcceptEula" argument="none" noconfig="true" />
      <option switch="-" name="ConfigDefault" argument="none" noconfig="true" />
      <!-- Configuration file -->
      <option switch="a" name="ArchiveDirectory" argument="required" />
      <option name="CaptureClipboard" argument="none" />
      <option switch="d" name="DriverName" argument="required" />
      <option switch="dns" name="DnsQuery" argument="optional" rule="true" />
      <option switch="g" name="PipeMonitoring" argument="required" rule="true" forceconfig="true" />
      <option switch="h" name="HashAlgorithms" argument="required" />
      <option name="DnsLookup" argument="required" />
      <option switch="k" name="ProcessAccess" argument="required" rule="true" forceconfig="true" />
      <option switch="l" name="ImageLoad" argument="optional" rule="true" />
      <option switch="n" name="NetworkConnect" argument="optional" rule="true" />
      <option switch="r" name="CheckRevocation" argument="optional" />
    </options>
    <filters default="is">is,is not,contains,contains any,is any,contains all,excludes,excludes any,excludes all,begin with,end with,less than,more than,image</filters>
  </configuration>
  <events>
    <event name="SYSMONEVENT_ERROR" value="255" level="Error" template="Error report" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ID" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CREATE_PROCESS" value="1" level="Informational" template="Process Create" rulename="ProcessCreate" ruledefault="include" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="FileVersion" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
      <data name="Product" inType="win:UnicodeString" outType="xs:string" />
      <data name="Company" inType="win:UnicodeString" outType="xs:string" />
      <data name="OriginalFileName" inType="win:UnicodeString" outType="xs:string" />
      <data name="CommandLine" inType="win:UnicodeString" outType="xs:string" />
      <data name="CurrentDirectory" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="LogonGuid" inType="win:GUID" />
      <data name="LogonId" inType="win:HexInt64" />
      <data name="TerminalSessionId" inType="win:UInt32" />
      <data name="IntegrityLevel" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="ParentProcessGuid" inType="win:GUID" />
      <data name="ParentProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="ParentImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="ParentCommandLine" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_TIME" value="2" level="Informational" template="File creation time changed" rulename="FileCreateTime" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="PreviousCreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_NETWORK_CONNECT" value="3" level="Informational" template="Network connection detected" rulename="NetworkConnect" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Protocol" inType="win:UnicodeString" outType="xs:string" />
      <data name="Initiated" inType="win:Boolean" />
      <data name="SourceIsIpv6" inType="win:Boolean" />
      <data name="SourceIp" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceHostname" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourcePort" inType="win:UInt16" />
      <data name="SourcePortName" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationIsIpv6" inType="win:Boolean" />
      <data name="DestinationIp" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationHostname" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationPort" inType="win:UInt16" />
      <data name="DestinationPortName" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_SERVICE_STATE_CHANGE" value="4" level="Informational" template="Sysmon service state changed" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="State" inType="win:UnicodeString" outType="xs:string" />
      <data name="Version" inType="win:UnicodeString" outType="xs:string" />
      <data name="SchemaVersion" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_PROCESS_TERMINATE" value="5" level="Informational" template="Process terminated" rulename="ProcessTerminate" ruledefault="include" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_DRIVER_LOAD" value="6" level="Informational" template="Driver loaded" rulename="DriverLoad" version="4">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ImageLoaded" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signed" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signature" inType="win:UnicodeString" outType="xs:string" />
      <data name="SignatureStatus" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_IMAGE_LOAD" value="7" level="Informational" template="Image loaded" rulename="ImageLoad" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="ImageLoaded" inType="win:UnicodeString" outType="xs:string" />
      <data name="FileVersion" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
      <data name="Product" inType="win:UnicodeString" outType="xs:string" />
      <data name="Company" inType="win:UnicodeString" outType="xs:string" />
      <data name="OriginalFileName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signed" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signature" inType="win:UnicodeString" outType="xs:string" />
      <data name="SignatureStatus" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CREATE_REMOTE_THREAD" value="8" level="Informational" template="CreateRemoteThread detected" rulename="CreateRemoteThread" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceProcessGuid" inType="win:GUID" />
      <data name="SourceProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="SourceImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetProcessGuid" inType="win:GUID" />
      <data name="TargetProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="TargetImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="NewThreadId" inType="win:UInt32" />
      <data name="StartAddress" inType="win:UnicodeString" outType="xs:string" />
      <data name="StartModule" inType="win:UnicodeString" outType="xs:string" />
      <data name="StartFunction" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_RAWACCESS_READ" value="9" level="Informational" template="RawAccessRead detected" rulename="RawAccessRead" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Device" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_ACCESS_PROCESS" value="10" level="Informational" template="Process accessed" rulename="ProcessAccess" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceProcessGUID" inType="win:GUID" />
      <data name="SourceProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="SourceThreadId" inType="win:UInt32" />
      <data name="SourceImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetProcessGUID" inType="win:GUID" />
      <data name="TargetProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="TargetImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="GrantedAccess" inType="win:HexInt32" />
      <data name="CallTrace" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_CREATE" value="11" level="Informational" template="File created" rulename="FileCreate" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_REG_KEY" value="12" level="Informational" template="Registry object added or deleted" rulename="RegistryEvent" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_REG_SETVALUE" value="13" level="Informational" template="Registry value set" rulename="RegistryEvent" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
      <data name="Details" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_REG_NAME" value="14" level="Informational" template="Registry object renamed" rulename="RegistryEvent" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
      <data name="NewName" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_CREATE_STREAM_HASH" value="15" level="Informational" template="File stream created" rulename="FileCreateStreamHash" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hash" inType="win:UnicodeString" outType="xs:string" />
      <data name="Contents" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_SERVICE_CONFIGURATION_CHANGE" value="16" level="Informational" template="Sysmon config state changed" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Configuration" inType="win:UnicodeString" outType="xs:string" />
      <data name="ConfigurationFileHash" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CREATE_NAMEDPIPE" value="17" level="Informational" template="Pipe Created" rulename="PipeEvent" ruledefault="exclude" version="1">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="PipeName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CONNECT_NAMEDPIPE" value="18" level="Informational" template="Pipe Connected" rulename="PipeEvent" ruledefault="exclude" version="1">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="PipeName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_WMI_FILTER" value="19" level="Informational" template="WmiEventFilter activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventNamespace" inType="win:UnicodeString" outType="xs:string" />
      <data name="Name" inType="win:UnicodeString" outType="xs:string" />
      <data name="Query" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_WMI_CONSUMER" value="20" level="Informational" template="WmiEventConsumer activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Name" inType="win:UnicodeString" outType="xs:string" />
      <data name="Type" inType="win:UnicodeString" outType="xs:string" />
      <data name="Destination" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_WMI_BINDING" value="21" level="Informational" template="WmiEventConsumerToFilter activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Consumer" inType="win:UnicodeString" outType="xs:string" />
      <data name="Filter" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_DNS_QUERY" value="22" level="Informational" template="Dns query" rulename="DnsQuery" ruledefault="exclude" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="QueryName" inType="win:UnicodeString" outType="xs:string" />
      <data name="QueryStatus" inType="win:UnicodeString" outType="xs:string" />
      <data name="QueryResults" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_DELETE" value="23" level="Informational" template="File Delete archived" rulename="FileDelete" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="IsExecutable" inType="win:Boolean" />
      <data name="Archived" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CLIPBOARD" value="24" level="Informational" template="Clipboard changed" rulename="ClipboardChange" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Session" inType="win:UInt32" />
      <data name="ClientInfo" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Archived" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_PROCESS_IMAGE_TAMPERING" value="25" level="Informational" template="Process Tampering" rulename="ProcessTampering" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Type" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_DELETE_DETECTED" value="26" level="Informational" template="File Delete logged" rulename="FileDeleteDetected" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="IsExecutable" inType="win:Boolean" />
    </event>
  </events>
</manifest>

```

`utilities/sysmon/v13/v13.1x/sysmon-v13.1x-all.xml`:

```xml
<Sysmon schemaversion="4.60">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->

  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

      <!-- EventID: 26 -->
      <!-- Log all -->
      <FileDeleteDetected onmatch="exclude" />
      
  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.1x/sysmon-v13.1x-optimal.xml`:

```xml
<Sysmon schemaversion="4.60">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>
      
      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

      <!-- EventID: 26 -->
      <!-- Log all -->
      <FileDeleteDetected onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.1x/sysmon-v13.1x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.60">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />
      
      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

      <!-- EventID: 26 -->
      <!-- Log all -->
      <FileDeleteDetected onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.2x/schema.xml`:

```xml

System Monitor v13.22 - System activity monitor
Copyright (C) 2014-2021 Mark Russinovich and Thomas Garnier
Using libxml2. libxml2 is Copyright (C) 1998-2012 Daniel Veillard. All Rights Reserved.
Sysinternals - www.sysinternals.com

<manifest schemaversion="4.70" binaryversion="14.1">
  <configuration>
    <options>
      <!-- Command-line only options -->
      <option switch="i" name="Install" argument="optional" noconfig="true" exclusive="true" />
      <option switch="c" name="Configuration" argument="optional" noconfig="true" exclusive="true" />
      <option switch="u" name="UnInstall" argument="optional" noconfig="true" exclusive="true" />
      <option switch="m" name="Manifest" argument="none" noconfig="true" exclusive="true" />
      <option switch="z" name="ClipboardInstance" argument="required" noconfig="true" exclusive="true" />
      <option switch="t" name="DebugMode" argument="optional" noconfig="true" />
      <option switch="s" name="PrintSchema" argument="optional" noconfig="true" exclusive="true" />
      <option switch="nologo" name="NoLogo" argument="none" noconfig="true" />
      <option switch="accepteula" name="AcceptEula" argument="none" noconfig="true" />
      <option switch="-" name="ConfigDefault" argument="none" noconfig="true" />
      <!-- Configuration file -->
      <option switch="a" name="ArchiveDirectory" argument="required" />
      <option name="CaptureClipboard" argument="none" />
      <option switch="d" name="DriverName" argument="required" />
      <option switch="dns" name="DnsQuery" argument="optional" rule="true" />
      <option switch="g" name="PipeMonitoring" argument="required" rule="true" forceconfig="true" />
      <option switch="h" name="HashAlgorithms" argument="required" />
      <option name="DnsLookup" argument="required" />
      <option switch="k" name="ProcessAccess" argument="required" rule="true" forceconfig="true" />
      <option switch="l" name="ImageLoad" argument="optional" rule="true" />
      <option switch="n" name="NetworkConnect" argument="optional" rule="true" />
      <option switch="r" name="CheckRevocation" argument="optional" />
    </options>
    <filters default="is">is,is not,contains,contains any,is any,contains all,excludes,excludes any,excludes all,begin with,not begin with,end with,not end with,less than,more than,image</filters>
  </configuration>
  <events>
    <event name="SYSMONEVENT_ERROR" value="255" level="Error" template="Error report" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ID" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CREATE_PROCESS" value="1" level="Informational" template="Process Create" rulename="ProcessCreate" ruledefault="include" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="FileVersion" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
      <data name="Product" inType="win:UnicodeString" outType="xs:string" />
      <data name="Company" inType="win:UnicodeString" outType="xs:string" />
      <data name="OriginalFileName" inType="win:UnicodeString" outType="xs:string" />
      <data name="CommandLine" inType="win:UnicodeString" outType="xs:string" />
      <data name="CurrentDirectory" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="LogonGuid" inType="win:GUID" />
      <data name="LogonId" inType="win:HexInt64" />
      <data name="TerminalSessionId" inType="win:UInt32" />
      <data name="IntegrityLevel" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="ParentProcessGuid" inType="win:GUID" />
      <data name="ParentProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="ParentImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="ParentCommandLine" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_TIME" value="2" level="Informational" template="File creation time changed" rulename="FileCreateTime" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="PreviousCreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_NETWORK_CONNECT" value="3" level="Informational" template="Network connection detected" rulename="NetworkConnect" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Protocol" inType="win:UnicodeString" outType="xs:string" />
      <data name="Initiated" inType="win:Boolean" />
      <data name="SourceIsIpv6" inType="win:Boolean" />
      <data name="SourceIp" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceHostname" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourcePort" inType="win:UInt16" />
      <data name="SourcePortName" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationIsIpv6" inType="win:Boolean" />
      <data name="DestinationIp" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationHostname" inType="win:UnicodeString" outType="xs:string" />
      <data name="DestinationPort" inType="win:UInt16" />
      <data name="DestinationPortName" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_SERVICE_STATE_CHANGE" value="4" level="Informational" template="Sysmon service state changed" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="State" inType="win:UnicodeString" outType="xs:string" />
      <data name="Version" inType="win:UnicodeString" outType="xs:string" />
      <data name="SchemaVersion" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_PROCESS_TERMINATE" value="5" level="Informational" template="Process terminated" rulename="ProcessTerminate" ruledefault="include" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_DRIVER_LOAD" value="6" level="Informational" template="Driver loaded" rulename="DriverLoad" version="4">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ImageLoaded" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signed" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signature" inType="win:UnicodeString" outType="xs:string" />
      <data name="SignatureStatus" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_IMAGE_LOAD" value="7" level="Informational" template="Image loaded" rulename="ImageLoad" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="ImageLoaded" inType="win:UnicodeString" outType="xs:string" />
      <data name="FileVersion" inType="win:UnicodeString" outType="xs:string" />
      <data name="Description" inType="win:UnicodeString" outType="xs:string" />
      <data name="Product" inType="win:UnicodeString" outType="xs:string" />
      <data name="Company" inType="win:UnicodeString" outType="xs:string" />
      <data name="OriginalFileName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signed" inType="win:UnicodeString" outType="xs:string" />
      <data name="Signature" inType="win:UnicodeString" outType="xs:string" />
      <data name="SignatureStatus" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CREATE_REMOTE_THREAD" value="8" level="Informational" template="CreateRemoteThread detected" rulename="CreateRemoteThread" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceProcessGuid" inType="win:GUID" />
      <data name="SourceProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="SourceImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetProcessGuid" inType="win:GUID" />
      <data name="TargetProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="TargetImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="NewThreadId" inType="win:UInt32" />
      <data name="StartAddress" inType="win:UnicodeString" outType="xs:string" />
      <data name="StartModule" inType="win:UnicodeString" outType="xs:string" />
      <data name="StartFunction" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_RAWACCESS_READ" value="9" level="Informational" template="RawAccessRead detected" rulename="RawAccessRead" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Device" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_ACCESS_PROCESS" value="10" level="Informational" template="Process accessed" rulename="ProcessAccess" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="SourceProcessGUID" inType="win:GUID" />
      <data name="SourceProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="SourceThreadId" inType="win:UInt32" />
      <data name="SourceImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetProcessGUID" inType="win:GUID" />
      <data name="TargetProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="TargetImage" inType="win:UnicodeString" outType="xs:string" />
      <data name="GrantedAccess" inType="win:HexInt32" />
      <data name="CallTrace" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_CREATE" value="11" level="Informational" template="File created" rulename="FileCreate" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_REG_KEY" value="12" level="Informational" template="Registry object added or deleted" rulename="RegistryEvent" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_REG_SETVALUE" value="13" level="Informational" template="Registry value set" rulename="RegistryEvent" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
      <data name="Details" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_REG_NAME" value="14" level="Informational" template="Registry object renamed" rulename="RegistryEvent" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetObject" inType="win:UnicodeString" outType="xs:string" />
      <data name="NewName" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_CREATE_STREAM_HASH" value="15" level="Informational" template="File stream created" rulename="FileCreateStreamHash" ruledefault="exclude" version="2">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="CreationUtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hash" inType="win:UnicodeString" outType="xs:string" />
      <data name="Contents" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_SERVICE_CONFIGURATION_CHANGE" value="16" level="Informational" template="Sysmon config state changed" version="3">
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Configuration" inType="win:UnicodeString" outType="xs:string" />
      <data name="ConfigurationFileHash" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CREATE_NAMEDPIPE" value="17" level="Informational" template="Pipe Created" rulename="PipeEvent" ruledefault="exclude" version="1">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="PipeName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CONNECT_NAMEDPIPE" value="18" level="Informational" template="Pipe Connected" rulename="PipeEvent" ruledefault="exclude" version="1">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="PipeName" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_WMI_FILTER" value="19" level="Informational" template="WmiEventFilter activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventNamespace" inType="win:UnicodeString" outType="xs:string" />
      <data name="Name" inType="win:UnicodeString" outType="xs:string" />
      <data name="Query" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_WMI_CONSUMER" value="20" level="Informational" template="WmiEventConsumer activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Name" inType="win:UnicodeString" outType="xs:string" />
      <data name="Type" inType="win:UnicodeString" outType="xs:string" />
      <data name="Destination" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_WMI_BINDING" value="21" level="Informational" template="WmiEventConsumerToFilter activity detected" rulename="WmiEvent" ruledefault="exclude" version="3">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="EventType" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="Operation" inType="win:UnicodeString" outType="xs:string" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Consumer" inType="win:UnicodeString" outType="xs:string" />
      <data name="Filter" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_DNS_QUERY" value="22" level="Informational" template="Dns query" rulename="DnsQuery" ruledefault="exclude" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="QueryName" inType="win:UnicodeString" outType="xs:string" />
      <data name="QueryStatus" inType="win:UnicodeString" outType="xs:string" />
      <data name="QueryResults" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_DELETE" value="23" level="Informational" template="File Delete archived" rulename="FileDelete" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="IsExecutable" inType="win:Boolean" />
      <data name="Archived" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_CLIPBOARD" value="24" level="Informational" template="Clipboard changed" rulename="ClipboardChange" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Session" inType="win:UInt32" />
      <data name="ClientInfo" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="Archived" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_PROCESS_IMAGE_TAMPERING" value="25" level="Informational" template="Process Tampering" rulename="ProcessTampering" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="Type" inType="win:UnicodeString" outType="xs:string" />
    </event>
    <event name="SYSMONEVENT_FILE_DELETE_DETECTED" value="26" level="Informational" template="File Delete logged" rulename="FileDeleteDetected" version="5">
      <data name="RuleName" inType="win:UnicodeString" outType="xs:string" />
      <data name="UtcTime" inType="win:UnicodeString" outType="xs:string" />
      <data name="ProcessGuid" inType="win:GUID" />
      <data name="ProcessId" inType="win:UInt32" outType="win:PID" />
      <data name="User" inType="win:UnicodeString" outType="xs:string" />
      <data name="Image" inType="win:UnicodeString" outType="xs:string" />
      <data name="TargetFilename" inType="win:UnicodeString" outType="xs:string" />
      <data name="Hashes" inType="win:UnicodeString" outType="xs:string" />
      <data name="IsExecutable" inType="win:Boolean" />
    </event>
  </events>
</manifest>

```

`utilities/sysmon/v13/v13.2x/sysmon-v13.2x-all.xml`:

```xml
<Sysmon schemaversion="4.70">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->

  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Log all -->
      <ProcessAccess onmatch="exclude" />

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- Log all registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <!-- Log all -->
      <DnsQuery onmatch="exclude" />

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

      <!-- EventID: 26 -->
      <!-- Log all -->
      <FileDeleteDetected onmatch="exclude" />
      
  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.2x/sysmon-v13.2x-optimal.xml`:

```xml
<Sysmon schemaversion="4.70">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>
      
      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />

      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

      <!-- EventID: 26 -->
      <!-- Log all -->
      <FileDeleteDetected onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/v13.2x/sysmon-v13.2x-vbox-optimal.xml`:

```xml
<Sysmon schemaversion="4.70">
  <!-- Capture All Hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <DnsLookup>False</DnsLookup>
  <!-- <ArchiveDirectory></ArchiveDirectory> -->
  
  <EventFiltering>

      <!-- EventID: 1 -->
      <!-- Log all process creation -->
      <ProcessCreate onmatch="exclude"/>

      <!-- EventID: 2 -->
      <!-- Log all file creation time stamps -->
      <FileCreateTime onmatch="exclude"/>

      <!-- EventID: 3 -->
      <!-- Log all network connections -->
      <NetworkConnect onmatch="exclude"/>

      <!-- EventID: 5 -->
      <!-- Log all process termination -->
      <ProcessTerminate onmatch="exclude" />

      <!-- EventID: 6 -->
      <!-- Log all Drivers Loaded -->
      <DriverLoad onmatch="exclude" />

      <!-- EventID: 7 -->
      <!-- Log all image loaded-->
      <!-- There is way too much image loaded by Sysmon.exe in this version -->
      <!-- Mostly due to the new feature of File Information -->
      <!-- This Schema needs to be adapted with the name of the service -->
      <RuleGroup groupRelation="or">
        <ImageLoad onmatch="exclude">
          <Image condition="is">C:\Windows\Sysmon.exe</Image>
          <Image condition="is">C:\Windows\Sysmon64.exe</Image>
          <!-- Whitelist MS signatures -->
          <!-- Might cause some detection rules not to work -->
          <!-- example: checking for loading of vaultcli.dll -->
          <Signature condition="is">Microsoft Windows Publisher</Signature>
          <Signature condition="is">Microsoft Corporation</Signature>
          <Signature condition="is">Microsoft Windows</Signature>
        </ImageLoad>
      </RuleGroup>


      <!-- EventID: 8 -->
      <!-- Log all RemoteThread created -->
      <CreateRemoteThread onmatch="exclude" />

      <!-- EventID: 9 -->
      <!-- Log all -->
      <RawAccessRead onmatch="exclude" />

      <!-- EventID: 10 -->
      <!-- Filtered out the more noisy entries -->
      <RuleGroup groupRelation="or">
        <ProcessAccess onmatch="exclude">
          <!-- 0x1000    // PROCESS_QUERY_LIMITED_INFORMATION  Second most frequent -->
          <GrantedAccess condition="is">0x1000</GrantedAccess>
          <!-- 0x2000    // UNKNOWN rights -->
          <GrantedAccess condition="is">0x2000</GrantedAccess>
          <!-- 0x3000    // UNKNOWN | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x3000</GrantedAccess>
          <!-- 0x100000  // SYNCHRONIZE -->
          <GrantedAccess condition="is">0x100000</GrantedAccess>
          <!-- 0x101000  // SYNCHRONIZE | PROCESS_QUERY_LIMITED_INFORMATION -->
          <GrantedAccess condition="is">0x101000</GrantedAccess>
          <!-- responsible for a lot of ProcessAccess -->
          <SourceImage condition="is">C:\Windows\system32\wbem\wmiprvse.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\System32\VBoxService.exe</SourceImage>
          <SourceImage condition="is">C:\Windows\system32\taskmgr.exe</SourceImage>
        </ProcessAccess>
      </RuleGroup>

      <!-- EventID: 11 -->
      <!-- Log all -->
      <FileCreate onmatch="exclude" />

      <!-- EventID: 12/13/14 -->
      <!-- CreateKey and DeleteKey are not taken to limit the number of registry operations -->
      <RuleGroup groupRelation="or">
          <RegistryEvent onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
            <!-- CreateKey and DeleteKey not taken -->
            <EventType condition="is not">SetValue</EventType>
          </RegistryEvent>
      </RuleGroup>

      <!-- EventID: 15 -->
      <!-- Log all -->
      <FileCreateStreamHash onmatch="exclude" />

      <!-- EventID: 17/18 -->
      <!-- Log all -->
      <PipeEvent onmatch="exclude" />

      <!-- EventID: 19/20/21 -->
      <!-- Log all -->
      <WmiEvent onmatch="exclude" />

      <!-- EventID: 22 -->
      <RuleGroup groupRelation="or">
        <DnsQuery onmatch="exclude">
            <Image condition="is">C:\Windows\Sysmon.exe</Image>
            <Image condition="is">C:\Windows\Sysmon64.exe</Image>
        </DnsQuery>
      </RuleGroup>

      <!-- EventID: 23 -->
      <!-- Log all -->
      <FileDelete onmatch="exclude" />

      <!-- EventID: 24 -->
      <!-- Log all -->
      <ClipboardChange onmatch="exclude" />
      
      <!-- EventID: 25 -->
      <!-- Log all -->
      <ProcessTampering onmatch="exclude" />

      <!-- EventID: 26 -->
      <!-- Log all -->
      <FileDeleteDetected onmatch="exclude" />

  </EventFiltering>
</Sysmon>

```

`utilities/sysmon/v13/version.txt`:

```txt
13.34

```

`utilities/whids/main.go`:

```go
package main

import (
	"bytes"
	"flag"
	"fmt"
	"io"
	"net/http"
	_ "net/http/pprof"
	"os"
	"os/exec"
	"os/signal"
	"path/filepath"

	"github.com/0xrawsec/gene/v2/engine"
	"github.com/0xrawsec/golog"
	"github.com/0xrawsec/whids/agent"
	"github.com/0xrawsec/whids/agent/config"
	"github.com/0xrawsec/whids/agent/sysinfo"
	"github.com/0xrawsec/whids/utils"
	"github.com/pelletier/go-toml/v2"
	"golang.org/x/sys/windows/svc"

	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/golang-utils/fsutil"
)

const (
	exitFail    = 1
	exitSuccess = 0
	banner      = `
	██╗    ██╗██╗  ██╗██╗██████╗ ███████╗
	██║    ██║██║  ██║██║██╔══██╗██╔════╝
	██║ █╗ ██║███████║██║██║  ██║███████╗
	██║███╗██║██╔══██║██║██║  ██║╚════██║
	╚███╔███╔╝██║  ██║██║██████╔╝███████║
	 ╚══╝╚══╝ ╚═╝  ╚═╝╚═╝╚═════╝ ╚══════╝
	           Windows Host IDS
	`
	copyright = "WHIDS Copyright (C) 2017 RawSec SARL (@0xrawsec)"
	license   = `AGPLv3: This program comes with ABSOLUTELY NO WARRANTY.`

	svcName = "WHIDS"
)

var (
	abs, _ = filepath.Abs(filepath.Dir(os.Args[0]))

	// DefaultHIDSConfig is the default HIDS configuration
	DefaultHIDSConfig = agent.BuildDefaultConfig(abs)
)

var (
	flagDumpConfig bool
	flagConfigure  bool
	flagInstall    bool
	flagUninstall  bool
	flagDryRun     bool
	flagPrintAll   bool
	flagDebug      bool
	flagVersion    bool
	flagProfile    bool
	flagRestore    bool
	flagAutologger bool

	edrAgent *agent.Agent

	importRules string

	configFile  = filepath.Join(abs, "config.toml")
	logFallback = filepath.Join(abs, "fallback.log")

	osSignals = make(chan os.Signal)

	logger = golog.Stdout
)

func printInfo(writer io.Writer) {
	fmt.Fprintf(writer, "%s\nVersion: %s (commit: %s)\nCopyright: %s\nLicense: %s\n\n", banner, version, commitID, copyright, license)
}

func configure() error {
	var writer *os.File
	var err error

	if writer, err = utils.HidsCreateFile(configFile); err != nil {
		return err
	}
	defer writer.Close()

	enc := toml.NewEncoder(writer)
	//enc.Order(toml.OrderPreserve)
	if err := enc.Encode(DefaultHIDSConfig); err != nil {
		return err
	}
	return nil
}

func updateAutologger(c *config.Agent) error {
	if err := c.EtwConfig.ConfigureAutologger(); err != nil {
		return err
	}
	return nil
}

func restoreAuditPolicies(c *config.Agent) {
	// Removing ACLs found in config
	logger.Infof("Restoring global File System Audit ACLs")
	ac := c.AuditConfig
	for _, ap := range ac.AuditPolicies {
		if err := utils.DisableAuditPolicy(ap); err != nil {
			logger.Errorf("Failed to disable audit policy %s: %s", ap, err)
		}
	}

	dirs := utils.StdDirs(utils.ExpandEnvs(ac.AuditDirs...)...)
	if err := utils.RemoveEDRAuditACL(dirs...); err != nil {
		logger.Errorf("Error while restoring File System Audit ACLs: %s", err)
	}

	if err := c.CanariesConfig.RestoreACLs(); err != nil {
		logger.Errorf("failed to restore canary files ACL: %s", err)
	}
}

func cleanCanaries(c *config.Agent) {
	logger.Infof("Restoring canary File System Audit ACLs")
	if err := c.CanariesConfig.RestoreACLs(); err != nil {
		logger.Errorf("errore restoring canary files ACL: %s", err)
	}

	logger.Infof("Deleting canary files")
	if err := c.CanariesConfig.Clean(); err != nil {
		logger.Errorf("error deleting canary files: %s", err)
	}
}

func deleteAutologger() error {
	return config.Autologger.Delete()
}

func runHids(service bool) {
	var err error
	var hidsConf config.Agent

	logger.Infof("Running EDR as Windows service: %t", service)

	hidsConf, err = config.LoadAgentConfig(configFile)
	if err != nil {
		logger.Abort(exitFail, fmt.Errorf("failed to load configuration: %s", err))
	}

	edrAgent, err = agent.NewAgent(&hidsConf)
	if err != nil {
		logger.Abort(exitFail, fmt.Errorf("failed to create EDR: %s", err))
	}

	edrAgent.DryRun = flagDryRun
	edrAgent.PrintAll = flagPrintAll

	// If not a service we need to be able to stop the HIDS
	if !service {
		// Register SIGINT handler to stop listening on channels
		signal.Notify(osSignals, os.Interrupt)
		go func() {
			<-osSignals
			logger.Infof("Received SIGINT")
			// runs stop on sigint
			edrAgent.Stop()
		}()
	}

	// Runs HIDS and wait for the output
	if err = edrAgent.Run(); err != nil {
		logger.Abort(exitFail, fmt.Errorf("failed to run EDR: %s", err))
	}

	if !service {
		edrAgent.Wait()
	}
}

func proctectDir(dir string) {
	var out []byte
	var err error

	// we first need to reset the ACLs otherwise next command does not work
	cmd := []string{"icacls", dir, "/reset"}
	if out, err = exec.Command(cmd[0], cmd[1:]...).CombinedOutput(); err != nil {
		logger.Errorf("failed to reset installation directory ACLs: %s", err)
		logger.Errorf("icacls output: %s", string(out))
		return
	}

	// we grant Administrators and SYSTEM full access rights
	cmd = []string{"icacls", dir, "/inheritance:r", "/grant:r", "Administrators:(OI)(CI)F", "/grant:r", "SYSTEM:(OI)(CI)F"}
	if out, err = exec.Command(cmd[0], cmd[1:]...).CombinedOutput(); err != nil {
		logger.Errorf("failed to protect installation directory with ACLs: %s", err)
		logger.Errorf("icacls output: %s", string(out))
		return
	}

	logger.Infof("Successfully protected installation directory with ACLs")
}

func main() {

	flag.BoolVar(&flagDumpConfig, "dump-conf", flagDumpConfig, "Dumps default configuration to stdout")
	flag.BoolVar(&flagInstall, "install", flagInstall, "Install EDR")
	flag.BoolVar(&flagAutologger, "autologger", flagAutologger, "Update EDR's ETW autologger configuration")
	flag.BoolVar(&flagUninstall, "uninstall", flagUninstall, "Uninstall EDR")
	flag.BoolVar(&flagDryRun, "dry", flagDryRun, "Dry run (do everything except listening on channels)")
	flag.BoolVar(&flagPrintAll, "all", flagPrintAll, "Print all events passing through HIDS")
	flag.BoolVar(&flagVersion, "v", flagVersion, "Print version information and exit")
	flag.BoolVar(&flagProfile, "prof", flagProfile, "Profile program")
	flag.BoolVar(&flagDebug, "d", flagDebug, "Enable debugging messages")
	flag.BoolVar(&flagRestore, "restore", flagRestore, "Restore Audit Policies and File System Audit ACLs according to configuration file")
	flag.StringVar(&configFile, "c", configFile, "Configuration file")
	flag.StringVar(&importRules, "import", importRules, "Import rules")

	flag.Usage = func() {
		printInfo(os.Stderr)
		fmt.Fprintf(os.Stderr, "Usage: %s [OPTIONS]\n", filepath.Base(os.Args[0]))
		flag.PrintDefaults()
		os.Exit(exitSuccess)
	}

	flag.Parse()

	// registering EdrInfo to make version info available from APIs
	i := &sysinfo.EdrInfo{
		Version: version,
		Commit:  commitID,
	}

	sysinfo.RegisterEdrInfo(i)

	isIntSess, err := svc.IsAnInteractiveSession()
	if err != nil {
		logger.Abort(exitFail, fmt.Errorf("failed to determine if we are running in an interactive session: %v", err))
	}

	if flagInstall || flagAutologger {

		// Only when installing
		if flagInstall {
			// dump configuration first as config is needed
			// by subsequent functions
			if err := configure(); err != nil {
				logger.Errorf("failed to build configuration: %s", err)
				os.Exit(exitFail)
			}
		}

		conf, err := config.LoadAgentConfig(configFile)
		if err != nil {
			logger.Errorf("failed to load configuration: %s", err)
			os.Exit(exitFail)
		}

		if err := deleteAutologger(); err != nil {
			logger.Errorf("failed to delete autologger: %s", err)
			// do not exit as autologger might not be existing but still report error
			//os.Exit(exitFail)
		}

		if err := updateAutologger(&conf); err != nil {
			logger.Errorf("failed to update autologger: %s", err)
			os.Exit(exitFail)
		}

		os.Exit(exitSuccess)
	}

	if flagUninstall {
		// we should not abort uninstallation if error
		var conf config.Agent

		rc := exitSuccess

		if conf, err = config.LoadAgentConfig(configFile); err == nil {
			// ToDo return error and set rc accordingly
			cleanCanaries(&conf)
			restoreAuditPolicies(&conf)
		} else {
			logger.Errorf("failed to load configuration: %s", err)
			rc = exitFail
		}

		if err := deleteAutologger(); err != nil {
			logger.Errorf("failed to delete autologger: %s", err)
			rc = exitFail
		}

		os.Exit(rc)
	}

	// profile the program
	if flagProfile {
		go func() {
			logger.Info("Running profiling server", http.ListenAndServe("0.0.0.0:4242", nil))
		}()
	}

	// Print version information and exit
	if flagVersion {
		printInfo(os.Stderr)
		os.Exit(exitSuccess)
	}

	if flagDumpConfig || flagConfigure {
		writer := os.Stdout
		enc := toml.NewEncoder(writer)
		//enc.Order(toml.OrderPreserve)
		if err := enc.Encode(DefaultHIDSConfig); err != nil {
			logger.Abort(exitFail, err)
		}
		os.Exit(exitSuccess)
	}

	// Enabling debug if needed
	if flagDebug {
		logger.Level = golog.LevelDebug
	}

	agentCfg, err := config.LoadAgentConfig(configFile)
	if err != nil {
		logger.Abort(exitFail, fmt.Sprintf("failed to load configuration: %s", err))
	}

	if flagRestore {
		restoreAuditPolicies(&agentCfg)
		os.Exit(exitSuccess)
	}

	// has to be there so that we print logs to stdout
	if importRules != "" {
		// in order not to write logs into file
		// TODO: add a stream handler to log facility
		agentCfg.Logfile = ""
		logger.Infof("Importing rules from %s", importRules)
		eng := engine.NewEngine()
		eng.SetDumpRaw(true)

		if err := eng.LoadDirectory(importRules); err != nil {
			logger.Abort(exitFail, fmt.Sprintf("failed to import rules: %s", err))
		}

		prules, psha256 := agentCfg.RulesConfig.RulesPaths()
		rules := new(bytes.Buffer)
		for rule := range eng.GetRawRule(".*") {
			if _, err := rules.Write([]byte(rule + "\n")); err != nil {
				logger.Abort(exitFail, fmt.Sprintf("failed to import rules: %s", err))
			}
		}

		if err := os.WriteFile(prules, rules.Bytes(), utils.DefaultFilePerm); err != nil {
			logger.Abort(exitFail, fmt.Sprintf("failed to import rules: %s", err))
		}

		if err := os.WriteFile(psha256, []byte(data.Sha256(rules.Bytes())), utils.DefaultFilePerm); err != nil {
			logger.Abort(exitFail, fmt.Sprintf("failed to import rules: %s", err))
		}

		logger.Infof("IMPORT SUCCESSFUL: %s", prules)
		os.Exit(0)
	}

	// if we run from command line (interactive session)
	if isIntSess {
		runHids(false)
		edrAgent.LogStats()
		return
	}

	// if it is called by the Windows Service Manager (not interactive)

	// set logfile the time the service starts
	if agentCfg.Logfile != "" {
		if logger, err = golog.FromPath(agentCfg.Logfile, utils.DefaultFilePerm); err != nil {
			golog.Stdout.Error("failed to open logfile", agentCfg.Logfile, err)
		}
	}

	// if we failed at opening logfile configured
	if logger == nil {
		if logger, err = golog.FromPath(logFallback, utils.DefaultFilePerm); err != nil {
			golog.Stdout.Error("failed to open logfile", err)
			logger = golog.Stdout
		}
	}

	// if running as service we protect installation directory with appropriate ACLs
	if fsutil.IsDir(abs) {
		proctectDir(abs)
	}

	runService(svcName, false)

}

```

`utilities/whids/makefile`:

```
TEST=$(GOPATH)/test
MAIN_BASEN_SRC=whids
RELEASE=$(GOPATH)/release/$(MAIN_BASEN_SRC)
VERSION=$(shell git tag | tail -1 | sed 's/^v//')
COMMITID=$(shell git rev-parse HEAD)

# Strips symbols and dwarf to make binary smaller
OPTS=-ldflags "-s -w" -trimpath
ifdef DEBUG
	OPTS=
endif

all:
	$(MAKE) clean
	$(MAKE) init
	$(MAKE) buildversion
	$(MAKE) compile
	$(MAKE) installer
	$(MAKE) sysmon
	$(MAKE) dlrules

test:
	$(MAKE) clean
	$(MAKE) init
	$(MAKE) buildversion
	$(MAKE) compile
	$(MAKE) installer
	$(MAKE) sysmon
	$(MAKE) testrules
	cp -r $(RELEASE)/.. $(TEST)

init:
	mkdir -p $(RELEASE)
	mkdir -p $(RELEASE)/windows

install:
	go install $(OPTS) $(MAIN_BASEN_SRC).go

compile: windows

windows:
	GOARCH=386 GOOS=windows go build $(OPTS) -o $(RELEASE)/windows/$(MAIN_BASEN_SRC)-v$(VERSION)-386.exe ./
	GOARCH=amd64 GOOS=windows go build $(OPTS) -o $(RELEASE)/windows/$(MAIN_BASEN_SRC)-v$(VERSION)-amd64.exe ./
	#cp -r conf $(RELEASE)/windows
	cd $(RELEASE)/windows; find -type f | xargs -I "{}" shasum -a 256 {} >> sha256.txt
	#cd $(RELEASE)/windows; tar -cvzf ../$(MAIN_BASEN_SRC)-windows-$(VERSION).tar.gz *

buildversion:
	printf "package main\n\nconst(\n    version=\"$(VERSION)\"\n    commitID=\"$(COMMITID)\"\n)\n" > version.go

installer:
	sed -E -e "s/set VERSION=.*?/set VERSION=$(VERSION)/" -e "s/set COMMITID=.*?/set COMMITID=$(COMMITID)/" manage.bat > $(RELEASE)/windows/manage.bat

sysmon:
	#mv $(RELEASE)/../sysmon $(RELEASE)/windows/

dlrules:
	mkdir $(RELEASE)/windows/rules/
	curl https://raw.githubusercontent.com/0xrawsec/gene-rules/master/compiled.gen > $(RELEASE)/windows/rules/compiled.gen
	curl https://raw.githubusercontent.com/0xrawsec/gene-rules/master/compiled.gen.sha256 > $(RELEASE)/windows/rules/compiled.gen.sha256

testrules:
	mkdir $(RELEASE)/windows/rules/
	cp $(TEST_RULES)/compiled.gen $(RELEASE)/windows/rules/compiled.gen
	cp $(TEST_RULES)/compiled.gen.sha256 $(RELEASE)/windows/rules/compiled.gen.sha256

clean:
	rm -rf $(RELEASE)/*

```

`utilities/whids/manage.bat`:

```bat
@echo off

set BASENAME=Whids.exe
set INSTALL_DIR=%programfiles%\Whids
set UNINSTALL_SCRIPT=%INSTALL_DIR%\Uninstall.bat
set BINPATH=%INSTALL_DIR%\%BASENAME%
set CONFIG=%INSTALL_DIR%\config.toml
REM default during installation used to clean
set LOGS=%INSTALL_DIR%\Logs
set ALERTS=%INSTALL_DIR%\Logs\Alerts
set DUMPS=%INSTALL_DIR%\Dumps
set VERSION="REPLACED BY MAKEFILE"
set COMMITID="REPLACED BY MAKEFILE"
set SVC=Whids

set RULES_IMPORT="%~dp0\rules"

:choice
echo  [i]  Install WHIDS from scratch (removes older installation)
echo [un]  Uninstall previous installation
echo [up]  Update WHIDS binary and rules (keeps current config)
echo [st]  Start service
echo [sp]  Stop service
echo  [d]  Disable service
echo  [r]  Restart service
echo  [g]  Remove alerts logs and dumps
echo  [e]  Edit WHIDS configuration with a registered application
echo [en]  Edit WHIDS configuration with notepad
echo  [c]  Clear screen
echo  [q]  Quit
echo.

echo Whids version: %VERSION% (commit: %COMMITID%)
SET /P _in= "Please select option (can be combined with +):"
SET _in_ch="%_in%"


:FORLOOP
FOR /F "tokens=1* delims=+" %%A IN (%_in_ch%) DO (
    
    IF "%%A"=="i" (
        call :StopSvcs
        call :Uninstall
        call :Install
        call :CreateWhidsSvc
        call :ImportRules
        call :GenUninstall
        call :PromptStartSvcs
    )
    IF "%%A"=="un" (
        call :Uninstall
    )
    IF "%%A"=="up" (
        call :StopSvcs
        call :CopyBin
        call :ImportRules
        call :PromptStartSvcs
    )
    IF "%%A"=="st" (
        call :StartSvcs
    )
    IF "%%A"=="sp" (
        call :StopSvcs
    )
    IF "%%A"=="d" (
        call :DisableSvc
    )
    IF "%%A"=="r" (
        call :StopSvcs
        call :StartSvcs
    )
    IF "%%A"=="g" (
        call :Groom
    )
    IF "%%A"=="e" (
        start "" "%CONFIG%"
        cls
    )
    IF "%%A"=="en" (
        notepad "%CONFIG%"
        cls
    )
    IF "%%A"=="c" (
        cls
    )
    IF "%%A"=="q" (
        EXIT 0
    )

    set _in_ch="%%B"
    if NOT %_in_ch%=="" goto FORLOOP

)

echo.
GOTO :choice

:Groom
IF exist "%LOGS%" (
    echo.
    echo [+] Removing directory: "%LOGS%"
    rmdir /S /Q "%LOGS%"
)

IF exist "%DUMPS%" (
    echo [+] Removing directory: "%DUMPS%"
    rmdir /S /Q "%DUMPS%"
    echo.
)
EXIT /B 0

:Uninstall
echo.
IF exist "%UNINSTALL_SCRIPT%" (
    echo [+] Running uninstallation script
    cmd /c "%UNINSTALL_SCRIPT%"
    echo [+] Uninstallation finished
)
EXIT /B 0

:CopyBin
echo [+] Installing %BASENAME% (%PROCESSOR_ARCHITECTURE%) in %INSTALL_DIR%
if %PROCESSOR_ARCHITECTURE%==AMD64 (
    echo F | xcopy /Y /X "%~dp0whids-v%VERSION%-amd64.exe" "%BINPATH%"
) else (
    echo F | xcopy /Y /X "%~dp0whids-v%VERSION%-386.exe" "%BINPATH%"
)
EXIT /B 0

:Install
echo.
echo [+] Creating Installation Directory: %INSTALL_DIR%
mkdir "%INSTALL_DIR%"

call :CopyBin

echo [+] Setting up rights to installation directory
icacls "%INSTALL_DIR%" /inheritance:r /grant:r Administrators:(OI)(CI)F /grant:r SYSTEM:(OI)(CI)F

echo [+] Installing
"%BINPATH%" -install
EXIT /B 0

:ImportRules
:ask_import
echo.
SET /P _input= "[+] Do you want to import detection rules shipped with project [Y/N]:"
IF "%_input%"=="Y" GOTO :import
IF "%_input%"=="N" GOTO :end_import
GOTO :ask_import
:import
"%BINPATH%" -import "%RULES_IMPORT%"
:end_import
EXIT /B 0

:CreateWhidsSvc
echo.
echo [+] Creating WHIDS service
sc.exe create %SVC% binPath= "%BINPATH%" start= auto
sc.exe description %SVC% "Windows Host IDS (v%VERSION%)"
sc.exe failure whids reset= 0 actions= restart/0

EXIT /B 0

:GenUninstall 
echo.
echo [+] Generating Uninstall Script
echo @echo off > "%UNINSTALL_SCRIPT%"
echo "%BINPATH%" -uninstall >> "%UNINSTALL_SCRIPT%"
echo cd "%PROGRAMFILES%" >> "%UNINSTALL_SCRIPT%"
echo net.exe stop %SVC% /yes >> "%UNINSTALL_SCRIPT%"
echo sc.exe delete %SVC% >> "%UNINSTALL_SCRIPT%"
echo timeout 10 >> "%UNINSTALL_SCRIPT%"
echo cmd /c rmdir /S /Q "%INSTALL_DIR%" >> "%UNINSTALL_SCRIPT%"
EXIT /B 0

:StartSvcs
echo.
echo [+] Running %SVC% service
sc.exe config %SVC% start= auto
net.exe start %SVC%
EXIT /B 0

:PromptStartSvcs
echo.
:ask_start
SET /P _input= "[+] Do you want to start service [Y/N]:"
IF "%_input%"=="Y" GOTO :start
IF "%_input%"=="N" GOTO :end_start
GOTO :ask_start
:start
call :StartSvcs
:end_start
EXIT /B 0

:StopSvcs
echo.
echo [+] Stopping %SVC% service
net.exe stop %SVC% /yes
EXIT /B 0

:DisableSvc
echo.
echo [+] Disabling %SVC% service
net.exe stop %SVC% /yes
:: we might need this in case the service is crashing and restarting constently
sc.exe config %SVC% start= disabled
EXIT /B 0
```

`utilities/whids/service.go`:

```go
package main

//build +windows

import (
	"golang.org/x/sys/windows/svc"
)

type WhidsService struct{}

// Execute kind of main function for the service
func (m *WhidsService) Execute(args []string, r <-chan svc.ChangeRequest, changes chan<- svc.Status) (ssec bool, errno uint32) {
	const cmdsAccepted = svc.AcceptStop
	changes <- svc.Status{State: svc.StartPending}

	// Start up WHIDS without waiting the engine to be done
	runHids(true)

	changes <- svc.Status{State: svc.Running, Accepts: cmdsAccepted}

loop:
	for c := range r {
		switch c.Cmd {
		case svc.Interrogate:
			changes <- c.CurrentStatus
		case svc.Stop:
			changes <- svc.Status{State: svc.StopPending}
			// Stop WHIDS there
			edrAgent.Stop()
			edrAgent.Wait()
			edrAgent.LogStats()
			break loop
		}
	}

	changes <- svc.Status{State: svc.Stopped}
	return
}

func runService(name string, isDebug bool) {
	var err error

	run := svc.Run
	err = run(name, &WhidsService{})

	if err != nil {
		return
	}
}

```

`utilities/whids/whitelistexts.go`:

```go
package main

import (
	"github.com/0xrawsec/golang-utils/datastructs"
)

var (
	whitelistedExts = datastructs.NewInitSyncedSet(
		".acl",
		".acm",
		".adml",
		".admx",
		".am",
		".amd64",
		".amx",
		".ani",
		".apl",
		".ascx",
		".asp",
		".aspx",
		".aux",
		".avi",
		".ax",
		".bat",
		".bcf",
		".bcm",
		".bin",
		".blf",
		".bmp",
		".btr",
		".bud",
		".cab",
		".cache",
		".camp",
		".cap",
		".cat",
		".cdmp",
		".cfg",
		".chk",
		".chm",
		".chr",
		".chs",
		".cht",
		".clb",
		".cmb",
		".cmd",
		".cmf",
		".com",
		".cov",
		".cpa",
		".cpl",
		".cpx",
		".crt",
		".cs",
		".csd",
		".css",
		".csv",
		".cty",
		".cur",
		".cw",
		".dat",
		".data",
		".db",
		".dcf",
		".dic",
		".dir",
		".dll",
		".dlm",
		".dls",
		".dnl",
		".drv",
		".ds",
		".dtd",
		".dub",
		".dun",
		".dvd",
		".dxt",
		".ebd",
		".ecf",
		".edb",
		".efi",
		".emf",
		".etl",
		".ev1",
		".ev2",
		".ev3",
		".evm",
		".evtx",
		".exe",
		".exp",
		".fe",
		".fon",
		".frm",
		".fx",
		".fxh",
		".gdl",
		".gif",
		".gmmp",
		".gpd",
		".grl",
		".grm",
		".gz",
		".h1c",
		".h1k",
		".h1s",
		".h1t",
		".hex",
		".hit",
		".hkf",
		".hlp",
		".hpi",
		".htm",
		".html",
		".hxx",
		".icc",
		".icm",
		".ico",
		".idx",
		".iec",
		".iem",
		".imd",
		".ime",
		".inc",
		".inf",
		".ini",
		".ins",
		".ird",
		".isp",
		".jnt",
		".jpg",
		".jpn",
		".jrs",
		".js",
		".json",
		".jtp",
		".kor",
		".lex",
		".lng",
		".lnk",
		".log",
		".log1",
		".log2",
		".lts",
		".lxa",
		".man",
		".map",
		".mfl",
		".mib",
		".mid",
		".mllr",
		".mni",
		".mof",
		".mp3",
		".mp4",
		".mpg",
		".msc",
		".msi",
		".msp",
		".msu",
		".mui",
		".mum",
		".mzz",
		".ngr",
		".nlp",
		".nls",
		".nlt",
		".ntf",
		".obe",
		".ocx",
		".olb",
		".old",
		".phn",
		".pnf",
		".png",
		".ppd",
		".prm",
		".props",
		".prx",
		".ps1",
		".psc1",
		".psd",
		".psd1",
		".psm1",
		".ptxml",
		".que",
		".rat",
		".reg",
		".resx",
		".rll",
		".rom",
		".rpo",
		".rs",
		".rsp",
		".rtf",
		".s3",
		".sam",
		".scp",
		".scr",
		".sdb",
		".sdi",
		".sep",
		".ses",
		".sh",
		".shp",
		".smp",
		".sql",
		".stl",
		".stp",
		".sys",
		".t4",
		".tasks",
		".tbl",
		".tha",
		".theme",
		".tif",
		".tlb",
		".tme",
		".tmp",
		".toc",
		".tsp",
		".ttc",
		".ttf",
		".tts",
		".txt",
		".uce",
		".udt",
		".uni",
		".unt",
		".url",
		".vbs",
		".vdf",
		".vp",
		".vrg",
		".wav",
		".wdf",
		".wih",
		".wim",
		".wma",
		".wmf",
		".wmv",
		".wmz",
		".wsc",
		".wsf",
		".wtv",
		".wwd",
		".x86",
		".xbap",
		".xex",
		".xml",
		".xsd",
		".xsl",
		".xst")
)

func isWhitelistedExt(ext string) bool {
	return whitelistedExts.Contains(ext)
}

```

`utils/audit.go`:

```go
package utils

import (
	"fmt"
	"os/exec"

	"github.com/0xrawsec/whids/utils/powershell"
)

const (
	auditPolEnable  = `auditpol /set /subcategory:"%s" /failure:enable /success:enable`
	auditPolDisable = `auditpol /set /subcategory:"%s" /failure:disable /success:disable`
)

var (
	auditPolMap = map[string]string{
		"Security System Extension":              "{0CCE9211-69AE-11D9-BED3-505054503030}",
		"System Integrity":                       "{0CCE9212-69AE-11D9-BED3-505054503030}",
		"IPsec Driver":                           "{0CCE9213-69AE-11D9-BED3-505054503030}",
		"Other System Events":                    "{0CCE9214-69AE-11D9-BED3-505054503030}",
		"Security State Change":                  "{0CCE9210-69AE-11D9-BED3-505054503030}",
		"Logon":                                  "{0CCE9215-69AE-11D9-BED3-505054503030}",
		"Logoff":                                 "{0CCE9216-69AE-11D9-BED3-505054503030}",
		"Account Lockout":                        "{0CCE9217-69AE-11D9-BED3-505054503030}",
		"IPsec Main Mode":                        "{0CCE9218-69AE-11D9-BED3-505054503030}",
		"IPsec Quick Mode":                       "{0CCE9219-69AE-11D9-BED3-505054503030}",
		"IPsec Extended Mode":                    "{0CCE921A-69AE-11D9-BED3-505054503030}",
		"Special Logon":                          "{0CCE921B-69AE-11D9-BED3-505054503030}",
		"Other Logon/Logoff Events":              "{0CCE921C-69AE-11D9-BED3-505054503030}",
		"Network Policy Server":                  "{0CCE9243-69AE-11D9-BED3-505054503030}",
		"User / Device Claims":                   "{0CCE9247-69AE-11D9-BED3-505054503030}",
		"Group Membership":                       "{0CCE9249-69AE-11D9-BED3-505054503030}",
		"File System":                            "{0CCE921D-69AE-11D9-BED3-505054503030}",
		"Registry":                               "{0CCE921E-69AE-11D9-BED3-505054503030}",
		"Kernel Object":                          "{0CCE921F-69AE-11D9-BED3-505054503030}",
		"SAM":                                    "{0CCE9220-69AE-11D9-BED3-505054503030}",
		"Certification Services":                 "{0CCE9221-69AE-11D9-BED3-505054503030}",
		"Application Generated":                  "{0CCE9222-69AE-11D9-BED3-505054503030}",
		"Handle Manipulation":                    "{0CCE9223-69AE-11D9-BED3-505054503030}",
		"File Share":                             "{0CCE9224-69AE-11D9-BED3-505054503030}",
		"Filtering Platform Packet Drop":         "{0CCE9225-69AE-11D9-BED3-505054503030}",
		"Filtering Platform Connection":          "{0CCE9226-69AE-11D9-BED3-505054503030}",
		"Other Object Access Events":             "{0CCE9227-69AE-11D9-BED3-505054503030}",
		"Detailed File Share":                    "{0CCE9244-69AE-11D9-BED3-505054503030}",
		"Removable Storage":                      "{0CCE9245-69AE-11D9-BED3-505054503030}",
		"Central Policy Staging":                 "{0CCE9246-69AE-11D9-BED3-505054503030}",
		"Non Sensitive Privilege Use":            "{0CCE9229-69AE-11D9-BED3-505054503030}",
		"Other Privilege Use Events":             "{0CCE922A-69AE-11D9-BED3-505054503030}",
		"Sensitive Privilege Use":                "{0CCE9228-69AE-11D9-BED3-505054503030}",
		"Process Creation":                       "{0CCE922B-69AE-11D9-BED3-505054503030}",
		"Process Termination":                    "{0CCE922C-69AE-11D9-BED3-505054503030}",
		"DPAPI Activity":                         "{0CCE922D-69AE-11D9-BED3-505054503030}",
		"RPC Events":                             "{0CCE922E-69AE-11D9-BED3-505054503030}",
		"Plug and Play Events":                   "{0CCE9248-69AE-11D9-BED3-505054503030}",
		"Token Right Adjusted Events":            "{0CCE924A-69AE-11D9-BED3-505054503030}",
		"Audit Policy Change":                    "{0CCE922F-69AE-11D9-BED3-505054503030}",
		"Authentication Policy Change":           "{0CCE9230-69AE-11D9-BED3-505054503030}",
		"Authorization Policy Change":            "{0CCE9231-69AE-11D9-BED3-505054503030}",
		"MPSSVC Rule-Level Policy Change":        "{0CCE9232-69AE-11D9-BED3-505054503030}",
		"Filtering Platform Policy Change":       "{0CCE9233-69AE-11D9-BED3-505054503030}",
		"Other Policy Change Events":             "{0CCE9234-69AE-11D9-BED3-505054503030}",
		"Computer Account Management":            "{0CCE9236-69AE-11D9-BED3-505054503030}",
		"Security Group Management":              "{0CCE9237-69AE-11D9-BED3-505054503030}",
		"Distribution Group Management":          "{0CCE9238-69AE-11D9-BED3-505054503030}",
		"Application Group Management":           "{0CCE9239-69AE-11D9-BED3-505054503030}",
		"Other Account Management Events":        "{0CCE923A-69AE-11D9-BED3-505054503030}",
		"User Account Management":                "{0CCE9235-69AE-11D9-BED3-505054503030}",
		"Directory Service Access":               "{0CCE923B-69AE-11D9-BED3-505054503030}",
		"Directory Service Changes":              "{0CCE923C-69AE-11D9-BED3-505054503030}",
		"Directory Service Replication":          "{0CCE923D-69AE-11D9-BED3-505054503030}",
		"Detailed Directory Service Replication": "{0CCE923E-69AE-11D9-BED3-505054503030}",
		"Kerberos Service Ticket Operations":     "{0CCE9240-69AE-11D9-BED3-505054503030}",
		"Other Account Logon Events":             "{0CCE9241-69AE-11D9-BED3-505054503030}",
		"Kerberos Authentication Service":        "{0CCE9242-69AE-11D9-BED3-505054503030}",
		"Credential Validation":                  "{0CCE923F-69AE-11D9-BED3-505054503030}",
	}
)

func resolveSubcategory(subCatOrGuid string) string {
	if guid, ok := auditPolMap[subCatOrGuid]; ok {
		return guid
	}
	for _, guid := range auditPolMap {
		if subCatOrGuid == guid {
			return guid
		}
	}
	return ""
}

func SetAuditPolicy(subCatOrGuid string, success, failure bool) error {
	var guid string

	aSuccess := "/success:disable"
	aFailure := "/failure:disable"

	if guid = resolveSubcategory(subCatOrGuid); guid == "" {
		return fmt.Errorf("Unknown Audit Policy subcategory: %s", subCatOrGuid)
	}

	if success {
		aSuccess = "/success:enable"
	}

	if failure {
		aFailure = "/failure:enable"
	}

	args := []string{
		"/set",
		fmt.Sprintf("/subcategory:%s", guid),
		aFailure,
		aSuccess,
	}

	return exec.Command("auditpol", args...).Run()
}

func EnableAuditPolicy(subCatOrGuid string) error {
	return SetAuditPolicy(subCatOrGuid, true, true)
}

func DisableAuditPolicy(subCatOrGuid string) error {
	return SetAuditPolicy(subCatOrGuid, false, false)
}

const (
	// source of inspiration: https://technochat.in/set-file-system-auditing-via-powershell/
	funcAuditACL = `Function SetAudit-ACL {
	[cmdletbinding()]
	Param (
	[string]$TargetFolder,
	[string]$AuditUser,
	[string]$AuditRules,
	[string]$InheritType,
	[string]$AuditType
	)
	$AccessRule = New-Object System.Security.AccessControl.FileSystemAuditRule($AuditUser,$AuditRules,$InheritType,"None",$AuditType)
	$ACL = Get-Acl -Audit $TargetFolder
	foreach ( $a in $ACL.Audit )
	{ 
		if ( $a.FileSystemRights -eq $AccessRule.FileSystemRights -And $a.AuditFlags -eq $AccessRule.AuditFlags -And $a.IdentityReference -eq $AccessRule.IdentityReference)
		{
			return
		}
	}
	$ACL.AddAuditRule($AccessRule)
	$ACL | Set-Acl $TargetFolder
	}

	Function RemoveAudit-Acl {
	[cmdletbinding()]
	Param (
	[string]$TargetFolder,
	[string]$AuditUser,
	[string]$AuditRules,
	[string]$InheritType,
	[string]$AuditType
	)
		$AccessRule = New-Object System.Security.AccessControl.FileSystemAuditRule($AuditUser,$AuditRules,$InheritType,"None",$AuditType)
		$ACL = Get-Acl -Audit $TargetFolder
		$ACL.RemoveAuditRuleSpecific($AccessRule)
		$ACL | Set-Acl $TargetFolder
	}
	`

	setAuditACLFmt    = `SetAudit-ACL -TargetFolder "%s" -AuditUser "Everyone" -AuditRules "Delete,DeleteSubdirectoriesAndFiles,Modify,ChangePermissions,Takeownership" -InheritType "ContainerInherit,ObjectInherit" -AuditType "Success, Failure"`
	removeAuditACLFmt = `RemoveAudit-ACL -TargetFolder "%s" -AuditUser "Everyone" -AuditRules "Delete,DeleteSubdirectoriesAndFiles,Modify,ChangePermissions,Takeownership" -InheritType "ContainerInherit,ObjectInherit" -AuditType "Success, Failure"`
)

func SetEDRAuditACL(directories ...string) (err error) {
	var p *powershell.Powershell

	if len(directories) == 0 {
		return nil
	}

	if p, err = powershell.NewShell(); err != nil {
		return fmt.Errorf("Failed at spawning a new shell: %w", err)
	}

	p.ImportFunction(funcAuditACL)
	for _, d := range directories {
		p.ExecuteString(fmt.Sprintf(setAuditACLFmt, StdDir(d)))
	}

	return p.Exit()
}

func RemoveEDRAuditACL(directories ...string) (err error) {
	var p *powershell.Powershell

	if len(directories) == 0 {
		return nil
	}

	if p, err = powershell.NewShell(); err != nil {
		return fmt.Errorf("Failed at spawning a new shell: %w", err)
	}

	p.ImportFunction(funcAuditACL)
	for _, d := range directories {
		p.ExecuteString(fmt.Sprintf(removeAuditACLFmt, StdDir(d)))
	}

	return p.Exit()
}

```

`utils/command/command.go`:

```go
package command

import (
	"context"
	"os/exec"
	"time"
)

type Cmd struct {
	*exec.Cmd
	ctx    context.Context
	cancel context.CancelFunc
}

func Command(name string, arg ...string) (c *Cmd) {
	c = &Cmd{}
	c.ctx, c.cancel = context.WithCancel(context.Background())
	c.Cmd = exec.CommandContext(c.ctx, name, arg...)
	return
}

func CommandTimeout(timeout time.Duration, name string, arg ...string) (c *Cmd) {
	c = &Cmd{}
	c.ctx, c.cancel = context.WithTimeout(context.Background(), timeout)
	c.Cmd = exec.CommandContext(c.ctx, name, arg...)
	return
}

func (c *Cmd) Terminate() {
	if c.cancel != nil {
		c.cancel()
	}
}

```

`utils/command/command_test.go`:

```go
package command

import (
	"os/exec"
	"runtime"
	"testing"
	"time"

	"github.com/0xrawsec/toast"
)

func TestCommandTimeout(t *testing.T) {
	var name string

	args := make([]string, 0)

	tt := toast.FromT(t)

	switch runtime.GOOS {
	case "windows":
		name = "cmd"
		args = append(args, "/c", "timeout", "30")
	case "linux":
		name = "yes"
	}

	c := CommandTimeout(1*time.Second, name, args...)
	defer c.Terminate()
	err := c.Run()
	_, ok := err.(*exec.ExitError)
	tt.Assert(ok)

	c = Command(name, args...)
	tt.CheckErr(c.Start())
	c.Terminate()
	err = c.Wait()
	_, ok = err.(*exec.ExitError)
	tt.Assert(ok)
}

```

`utils/crypto.go`:

```go
package utils

import (
	"bytes"
	"crypto/ecdsa"
	"crypto/rand"
	"crypto/rsa"
	"crypto/x509"
	"crypto/x509/pkix"
	"encoding/pem"
	"fmt"
	"io"
	"io/ioutil"
	"math/big"
	"net"
	"os"
	"time"

	"github.com/0xrawsec/golang-utils/crypto/data"
)

func publicKey(priv interface{}) interface{} {
	switch k := priv.(type) {
	case *rsa.PrivateKey:
		return &k.PublicKey
	case *ecdsa.PrivateKey:
		return &k.PublicKey
	default:
		return nil
	}
}

func pemBlockForKey(priv interface{}) *pem.Block {
	switch k := priv.(type) {
	case *rsa.PrivateKey:
		return &pem.Block{Type: "RSA PRIVATE KEY", Bytes: x509.MarshalPKCS1PrivateKey(k)}
	case *ecdsa.PrivateKey:
		b, err := x509.MarshalECPrivateKey(k)
		if err != nil {
			fmt.Fprintf(os.Stderr, "Unable to marshal ECDSA private key: %v", err)
			os.Exit(2)
		}
		return &pem.Block{Type: "EC PRIVATE KEY", Bytes: b}
	default:
		return nil
	}
}

func GenerateCert(org string, hosts []string, validity time.Duration) (key, cert []byte, err error) {
	var priv interface{}

	if len(hosts) == 0 {
		err = fmt.Errorf("no host specified")
		return
	}

	// generate RSA key
	priv, err = rsa.GenerateKey(rand.Reader, 4096)

	if err != nil {
		err = fmt.Errorf("failed to generate private key: %s", err)
		return
	}

	notBefore := time.Now()
	notAfter := notBefore.Add(validity)

	serialNumberLimit := new(big.Int).Lsh(big.NewInt(1), 128)
	serialNumber, err := rand.Int(rand.Reader, serialNumberLimit)

	if err != nil {
		err = fmt.Errorf("failed to generate serial number: %s", err)
		return
	}

	template := x509.Certificate{
		SerialNumber: serialNumber,
		Subject: pkix.Name{
			Organization: []string{org},
		},
		NotBefore:             notBefore,
		NotAfter:              notAfter,
		KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature,
		ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth},
		BasicConstraintsValid: true,
	}

	for _, h := range hosts {
		if ip := net.ParseIP(h); ip != nil {
			template.IPAddresses = append(template.IPAddresses, ip)
		} else {
			template.DNSNames = append(template.DNSNames, h)
		}
	}

	derBytes, err := x509.CreateCertificate(rand.Reader, &template, &template, publicKey(priv), priv)

	if err != nil {
		err = fmt.Errorf("failed to create certificate: %s", err)
		return
	}

	certOut := new(bytes.Buffer)

	if err = pem.Encode(certOut, &pem.Block{Type: "CERTIFICATE", Bytes: derBytes}); err != nil {
		return
	}

	cert = certOut.Bytes()

	keyOut := new(bytes.Buffer)

	if err = pem.Encode(keyOut, pemBlockForKey(priv)); err != nil {
		return
	}

	key = keyOut.Bytes()

	return
}

func CertFileSha256(certPath string) (fingerprint string, err error) {
	var certFd *os.File

	if certFd, err = os.Open(certPath); err != nil {
		return
	}
	defer certFd.Close()

	fingerprint, err = CertSha256(certFd)
	return
}

func CertSha256(r io.Reader) (fingerprint string, err error) {
	pemBytes, err := ioutil.ReadAll(r)
	if err != nil {
		return
	}

	block, _ := pem.Decode(pemBytes)

	cert, err := x509.ParseCertificate(block.Bytes)
	if err != nil {
		return
	}

	der, err := x509.MarshalPKIXPublicKey(cert.PublicKey)
	if err != nil {
		return
	}
	fingerprint = data.Sha256(der)
	return
}

```

`utils/crypto_test.go`:

```go
package utils

import (
	"bytes"
	"os"
	"path/filepath"
	"testing"
	"time"

	"github.com/0xrawsec/toast"
)

func TestGenerateCert(t *testing.T) {
	tt := toast.FromT(t)

	tmp := t.TempDir()
	certPath := filepath.Join(tmp, "cert.pem")

	_, cert, err := GenerateCert("TestOrg", []string{"localhost"}, time.Hour*24*365)
	tt.CheckErr(err)

	tt.CheckErr(os.WriteFile(certPath, cert, 0777))

	sha256, err := CertSha256(bytes.NewBuffer(cert))
	tt.CheckErr(err)

	sameSha256, err := CertFileSha256(certPath)
	tt.CheckErr(err)

	tt.Assert(sha256 == sameSha256)
}

```

`utils/encoding.go`:

```go
package utils

import (
	"bytes"
	"encoding/json"

	"github.com/pelletier/go-toml/v2"
)

// PrettyJsonOrPanic returns a JSON pretty string out of i
func PrettyJsonOrPanic(i interface{}) string {
	b, err := json.MarshalIndent(i, "", "    ")
	if err != nil {
		panic(err)
	}
	return string(b)
}

func JsonOrPanic(i interface{}) []byte {
	b, err := Json(i)
	if err != nil {
		panic(err)
	}
	return b
}

// JsonStringOrPanic returns a Json string out of i
func JsonStringOrPanic(i interface{}) string {
	return string(JsonOrPanic(i))
}

func Json(i any) ([]byte, error) {
	return json.Marshal(i)
}

func JsonString(i any) (s string, err error) {
	var b []byte
	if b, err = Json(i); err != nil {
		return
	}
	s = string(b)
	return
}

func Toml(i interface{}) (b []byte, err error) {
	buf := new(bytes.Buffer)
	enc := toml.NewEncoder(buf)

	if err = enc.Encode(i); err != nil {
		return
	}

	b = buf.Bytes()
	return
}

func TomlString(i any) (s string, err error) {
	var b []byte
	b, err = Toml(i)
	s = string(b)
	return
}

```

`utils/encoding_test.go`:

```go
package utils

import (
	"testing"

	"github.com/0xrawsec/toast"
)

func TestEncoding(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	ts := testStruct{}

	tt.Assert(PrettyJsonOrPanic(ts) != "")
	tt.Assert(JsonOrPanic(ts) != nil)
	tt.Assert(JsonStringOrPanic(ts) != "")
	js, err := JsonString(ts)
	tt.CheckErr(err)
	tt.Assert(js != "")
	toml, err := Toml(ts)
	tt.CheckErr(err)
	tt.Assert(toml != nil)
	tomls, err := TomlString(ts)
	tt.CheckErr(err)
	tt.Assert(tomls != "")
}

```

`utils/files.go`:

```go
package utils

import (
	"compress/gzip"
	"fmt"
	"io"
	"io/fs"
	"os"
	"path/filepath"
	"strings"

	"github.com/0xrawsec/golang-utils/fsutil/fswalker"
	"github.com/google/uuid"
)

const (
	// DefaultFilePerm default permissions for output files
	DefaultFilePerm = 0740

	permUserFullAccess = 0700
)

// CountFiles counts files in a directory
func CountFiles(directory string) (cnt int) {
	for wi := range fswalker.Walk(directory) {
		cnt += len(wi.Files)
	}
	return
}

// GzipFileBestSpeed compresses a file to gzip and deletes the original file
func GzipFileBestSpeed(path string) (last error) {
	var src, dst *os.File

	fname := fmt.Sprintf("%s.gz", path)
	partname := fmt.Sprintf("%s.part", fname)

	if src, last = os.Open(path); last != nil {
		return
	}
	defer src.Close()

	if dst, last = os.Create(partname); last != nil {
		return
	}
	defer dst.Close()

	// if valid level error returned is nil so no need to handle it
	w, _ := gzip.NewWriterLevel(dst, gzip.BestSpeed)
	defer w.Close()
	if _, err := io.Copy(w, src); err != nil {
		return err
	}

	// gzip writer
	w.Flush()
	w.Close()
	// original file
	src.Close()
	// part file
	dst.Close()

	if err := os.Remove(path); err != nil {
		last = fmt.Errorf("cannot remove original dumpfile: %w", err)
	}

	if err := os.Rename(partname, fname); err != nil {
		last = err
	}

	// rename the file to its final name
	return last
}

// HidsMkdirAll is a wrapper around os.MkdirAll with appropriate
// permissions
func HidsMkdirAll(dir string) error {
	return os.MkdirAll(dir, DefaultFilePerm)
}

func HidsMkTmpDir() (dir string, err error) {
	// genererating random uuid to drop binary in
	randDir, err := uuid.NewRandom()
	if err != nil {
		err = fmt.Errorf("failed to create random directory: %w", err)
		return
	}

	// creating temporary directory
	dir = filepath.Join(os.TempDir(), randDir.String())
	// allow full access only to user
	err = os.MkdirAll(dir, permUserFullAccess)

	return
}

// HidsCreateFile creates a file with the good permissions
func HidsCreateFile(filename string) (*os.File, error) {
	return os.OpenFile(filename, os.O_CREATE|os.O_TRUNC|os.O_RDWR, DefaultFilePerm)
}

// HidsWriteData is a wrapper around os.WriteFile to write a file
// with the good permissions
func HidsWriteData(dest string, data []byte) error {
	return os.WriteFile(dest, data, DefaultFilePerm)
}

// HidsWriteReader writes the content of a reader to a destination file. If
// compress is true .gz extension is added to destination file name.
func HidsWriteReader(dst string, content io.Reader, compress bool) (err error) {
	var out *os.File
	var w io.WriteCloser

	if compress && !strings.HasSuffix(dst, ".gz") {
		dst = fmt.Sprintf("%s.gz", dst)
	}

	if out, err = HidsCreateFile(dst); err != nil {
		return
	}
	defer out.Close()

	// default value for writer
	w = out
	if compress {
		if w, err = gzip.NewWriterLevel(out, gzip.BestSpeed); err != nil {
			return
		}
		defer w.Close()
	}

	if _, err = io.Copy(w, content); err != nil {
		return
	}

	return w.Close()
}

// IsPipePath checks whether the argument path is a pipe
func IsPipePath(path string) bool {
	return strings.HasPrefix(path, `\\.\`)
}

// ReadFileAsString reads bytes from a file
func ReadFileAsString(path string) (string, error) {
	b, err := os.ReadFile(path)
	return string(b), err
}

func ReadGzipFile(path string) (b []byte, err error) {
	var fd *os.File
	var r *gzip.Reader

	if fd, err = os.Open(path); err != nil {
		return
	}
	defer fd.Close()

	if r, err = gzip.NewReader(fd); err != nil {
		return
	}

	if b, err = io.ReadAll(r); err != nil {
		return
	}

	return
}

func ReadGzipFileAsString(path string) (string, error) {
	b, err := ReadGzipFile(path)
	return string(b), err
}

// StdDir makes a directory ending with os separator
func StdDir(dir string) string {
	sep := string(os.PathSeparator)
	return fmt.Sprintf("%s%s", strings.TrimRight(dir, sep), sep)
}

// StdDirs makes sure directories are ending with os separator
func StdDirs(directories ...string) (o []string) {
	o = make([]string, len(directories))
	for i, d := range directories {
		o[i] = StdDir(d)
	}
	return
}

// BinRelativePath builds a path relative to current binary directory
func BinRelativePath(path string) string {
	return filepath.Join(filepath.Dir(os.Args[0]), path)
}

func IsDirEmpty(dir string) (empty bool, err error) {
	var fd *os.File
	var entries []fs.DirEntry

	if fd, err = os.Open(dir); err != nil {
		return
	}

	defer fd.Close()

	if entries, err = fd.ReadDir(1); err != nil && err != io.EOF {
		return
	}

	return len(entries) == 0, nil
}

```

`utils/files_test.go`:

```go
package utils

import (
	"bytes"
	"fmt"
	"os"
	"path/filepath"
	"strings"
	"testing"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/los"
)

func TestIsDirEmpty(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp := t.TempDir()
	ok, err := IsDirEmpty(tmp)
	tt.CheckErr(err)
	tt.Assert(ok)

	newFile := filepath.Join(tmp, "new_file")
	tt.CheckErr(os.WriteFile(newFile, []byte{}, 0777))
	ok, err = IsDirEmpty(tmp)
	tt.CheckErr(err)
	tt.Assert(!ok)

	// removing the file we've just created
	tt.CheckErr(os.Remove(newFile))

	newDir := filepath.Join(tmp, "new_dir")
	tt.CheckErr(os.Mkdir(newDir, 0777))
	ok, err = IsDirEmpty(tmp)
	tt.CheckErr(err)
	tt.Assert(!ok)
}

func createFiles(dir string, n int) {
	for i := 0; i < n; i++ {
		if err := os.WriteFile(filepath.Join(dir, fmt.Sprintf("file_%d", i)), []byte{}, 0700); err != nil {
			panic(err)
		}
	}
}

func TestCountFiles(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp := t.TempDir()
	subTmp := filepath.Join(tmp, "subdir")
	tt.CheckErr(os.Mkdir(subTmp, 0777))

	createFiles(tmp, 100)
	tt.Assert(CountFiles(tmp) == 100)
	createFiles(subTmp, 200)
	tt.Assert(CountFiles(subTmp) == 200)
	tt.Assert(CountFiles(tmp) == 300)
}

func TestGzipFileBestSpeed(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp := t.TempDir()
	fp := filepath.Join(tmp, "togzip.txt")
	tt.CheckErr(os.WriteFile(fp, []byte{}, 0700))

	tt.Assert(fsutil.IsFile(fp))
	tt.CheckErr(GzipFileBestSpeed(fp))
	tt.Assert(!fsutil.IsFile(fp))
	// file with .gz must have been created
	tt.Assert(fsutil.IsFile(fmt.Sprintf("%s.gz", fp)))
}

func TestHidsMkdirAll(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp := t.TempDir()
	dir := filepath.Join(tmp, "directory")
	tt.CheckErr(HidsMkdirAll(dir))

	fi, err := os.Stat(dir)
	tt.CheckErr(err)
	if los.OS != "windows" {
		tt.Assert(fi.Mode().Perm() == DefaultFilePerm)
	}
}

func TestHidsMkTmpDir(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp, err := HidsMkTmpDir()
	tt.CheckErr(err)

	tt.Assert(strings.HasPrefix(tmp, os.TempDir()))

	fi, err := os.Stat(tmp)
	tt.Assert(fi.IsDir())
	tt.CheckErr(err)
	if los.OS != "windows" {
		tt.Assert(fi.Mode().Perm() == permUserFullAccess)
	}
}

func TestHidsCreateFile(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	fp := filepath.Join(t.TempDir(), "testfile")
	fd, err := HidsCreateFile(fp)
	tt.CheckErr(err)
	fd.WriteString("testing")
	tt.CheckErr(fd.Close())

	fi, err := os.Stat(fp)
	tt.CheckErr(err)
	tt.Assert(fi.Mode().IsRegular())
	if los.OS != "windows" {
		tt.Assert(fi.Mode().Perm() == DefaultFilePerm)
	}
}

func TestHidsWriteData(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	fp := filepath.Join(t.TempDir(), "testfile")
	tt.CheckErr(HidsWriteData(fp, []byte("testing")))

	fi, err := os.Stat(fp)
	tt.CheckErr(err)
	tt.Assert(fi.Mode().IsRegular())
	if los.OS != "windows" {
		tt.Assert(fi.Mode().Perm() == DefaultFilePerm)
	}
}

func TestHidsWriteReader(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	fp := filepath.Join(t.TempDir(), "testfile")
	tt.CheckErr(HidsWriteReader(fp, bytes.NewBufferString("testing"), false))

	fi, err := os.Stat(fp)
	tt.CheckErr(err)
	tt.Assert(fi.Mode().IsRegular())
	if los.OS != "windows" {
		tt.Assert(fi.Mode().Perm() == DefaultFilePerm)
	}

	read, err := ReadFileAsString(fp)
	tt.CheckErr(err)
	tt.Assert(read == "testing")

	fpgz := fmt.Sprintf("%s.gz", fp)
	tt.CheckErr(HidsWriteReader(fp, bytes.NewBufferString("testing"), true))
	fi, err = os.Stat(fpgz)
	tt.CheckErr(err)
	tt.Assert(fi.Mode().IsRegular())
	if los.OS != "windows" {
		tt.Assert(fi.Mode().Perm() == DefaultFilePerm)
	}

	read, err = ReadGzipFileAsString(fpgz)
	tt.CheckErr(err)
	tt.Assert(read == "testing")
}

func TestStDirs(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tmp := t.TempDir()
	ps := string(os.PathSeparator)

	tt.Assert(!strings.HasSuffix(tmp, ps))

	testDirs := []string{
		tmp,
		"/this/is/sometest",
		"/this/is/another/test////",
	}

	for _, d := range StdDirs(testDirs...) {
		// check that path ends with path sep
		tt.Assert(strings.HasSuffix(d, ps))
		// check that path ends does not end with several path sep
		tt.Assert(!strings.HasSuffix(d, ps+ps))
	}
}

func TestRelativePath(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	fp := BinRelativePath("testfile")
	t.Log(fp)
	tt.Assert(strings.HasPrefix(fp, filepath.Dir(os.Args[0])))
}

func TestIsPipePath(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	tt.Assert(IsPipePath(`\\.\WindowsPipe`))
	tt.Assert(!IsPipePath(`WindowsPipe`))
}

```

`utils/net.go`:

```go
package utils

import "net"

// derived from: https://gist.github.com/kotakanbe/d3059af990252ba89a82
func NextIP(ip net.IP) net.IP {
	nip := net.IP(make(net.IP, len(ip)))
	copy(nip, ip)
	for j := len(nip) - 1; j >= 0; j-- {
		nip[j]++
		if nip[j] > 0 {
			break
		}
	}
	return nip
}

// derived from: https://gist.github.com/kotakanbe/d3059af990252ba89a82
func PrevIP(ip net.IP) net.IP {
	nip := net.IP(make(net.IP, len(ip)))
	copy(nip, ip)
	for j := len(nip) - 1; j >= 0; j-- {
		nip[j]--
		if nip[j] < 255 {
			break
		}
	}
	return nip
}

```

`utils/net_test.go`:

```go
package utils

import (
	"net"
	"testing"

	"github.com/0xrawsec/toast"
)

func TestPrevNextIP(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	ip := net.ParseIP("192.168.1.42")
	tt.Assert(PrevIP(ip).String() == "192.168.1.41")
	tt.Assert(NextIP(ip).String() == "192.168.1.43")
}

```

`utils/powershell/powershell.go`:

```go
package powershell

import (
	"bytes"
	"context"
	"io"
	"io/ioutil"
	"os/exec"
)

// Powershell structure
type Powershell struct {
	handle *exec.Cmd
	ctx    context.Context
	cancel context.CancelFunc
	stdin  io.WriteCloser
	stdout io.ReadCloser
	stderr io.ReadCloser
}

// NewShell returns a new pointer to a Powershell structure
func NewShell() (p *Powershell, err error) {
	p = &Powershell{}
	p.ctx, p.cancel = context.WithCancel(context.Background())
	p.handle = exec.CommandContext(p.ctx, "powershell", "-Command", "-")
	p.stdin, err = p.handle.StdinPipe()
	if err != nil {
		return
	}
	p.stdout, err = p.handle.StdoutPipe()
	if err != nil {
		return
	}
	p.stderr, err = p.handle.StderrPipe()
	if err != nil {
		return
	}
	// Start powershell command
	err = p.handle.Start()
	return
}

// execute from any kind of reader
func (p *Powershell) execute(r io.Reader) {
	b, _ := ioutil.ReadAll(r)
	b = append(bytes.TrimRight(b, "\n"), '\n')
	p.stdin.Write(b)
}

// ExecuteString instruct the shell to execute the script provided as parameter
func (p *Powershell) ExecuteString(script string) {
	p.execute(bytes.NewReader([]byte(script)))
}

// HitReturn sends a new line to stdin
func (p *Powershell) HitReturn() {
	p.ExecuteString("\n")
}

// ImportFunction imports a function into running shell
func (p *Powershell) ImportFunction(code string) {
	p.ExecuteString(code)
	p.HitReturn()
}

// Exit exits the powershell console
func (p *Powershell) Exit() error {
	p.ExecuteString("Exit")
	return p.handle.Wait()
}

// Kill kills the current shell struct
func (p *Powershell) Kill() error {
	p.cancel()
	p.stdin.Close()
	p.stdout.Close()
	p.stderr.Close()
	return p.handle.Wait()
}

```

`utils/rand.go`:

```go
package utils

import (
	"crypto/rand"
	mrand "math/rand"

	"github.com/google/uuid"
)

func randByte() (byte, error) {
	var b [1]byte
	if _, err := rand.Reader.Read(b[:]); err != nil {
		return 0, err
	}
	return b[0], nil
}

// UnsafeUUID generates a random UUID
func UnsafeUUID() uuid.UUID {
	uuid := uuid.UUID{}
	for i := 0; i < len(uuid); i++ {
		uuid[i] = uint8(mrand.Uint32() >> 24)
	}
	return uuid
}

func UUIDOrPanic() (u uuid.UUID) {
	var err error

	if u, err = NewUUID(); err != nil {
		panic(err)
	}

	return
}

// UUIDGen generates a random UUID
func NewUUIDString() (string, error) {
	var u uuid.UUID
	var err error
	if u, err = NewUUID(); err != nil {
		return "", err
	}
	return u.String(), err
}

// NewUUID generates a random UUID
func NewUUID() (uuid.UUID, error) {
	return uuid.NewRandom()
}

func NewKeyOrPanic(size int) (key string) {
	var err error

	if key, err = NewKey(size); err != nil {
		panic(err)
	}

	return
}

// NewKey is an API key generator, supposed to generate an [[:alnum:]] key
func NewKey(size int) (key string, err error) {
	var b byte
	tmp := make([]byte, 0, size)
	for len(tmp) < size {
		//b := uint8(rand.Uint32() >> 24)
		if b, err = randByte(); err != nil {
			return
		}
		switch {
		case b > 47 && b < 58:
			// 0 to 9
			tmp = append(tmp, b)
		case b > 65 && b < 90:
			// A to Z
			tmp = append(tmp, b)
		case b > 96 && b < 123:
			// a to z
			tmp = append(tmp, b)
		}
	}
	key = string(tmp)
	return
}

func UUIDKeyPair(skey int) (suuid, key string, err error) {
	var u uuid.UUID

	if u, err = NewUUID(); err != nil {
		return
	}
	suuid = u.String()

	if key, err = NewKey(skey); err != nil {
		return
	}

	return
}

```

`utils/rand_test.go`:

```go
package utils

import (
	"testing"

	"github.com/0xrawsec/toast"
)

func TestRand(t *testing.T) {
	tt := toast.FromT(t)

	t.Log(UnsafeUUID().String())
	t.Log(UUIDOrPanic().String())
	uuid, err := NewUUIDString()
	tt.CheckErr(err)
	t.Log(uuid)
	tt.Assert(len(NewKeyOrPanic(32)) == 32)
	tt.Assert(len(NewKeyOrPanic(42)) == 42)
	tt.Assert(len(NewKeyOrPanic(4242)) == 4242)

	uuid, key, err := UUIDKeyPair(42)
	tt.CheckErr(err)
	tt.Assert(len(key) == 42)
	t.Log(uuid)
}

```

`utils/sizes.go`:

```go
package utils

const (
	_ = 1 << (iota * 10)
	Kilo
	Mega
	Giga
)

```

`utils/utils.go`:

```go
package utils

import (
	"bytes"
	"crypto/sha256"
	"encoding/gob"
	"encoding/hex"
	"fmt"
	"math"
	"os"
	"regexp"
	"unicode/utf16"
	"unicode/utf8"

	"github.com/0xrawsec/golang-utils/crypto/data"
	"github.com/0xrawsec/golang-utils/datastructs"
)

var (
	RegexUuid = regexp.MustCompile(`^(?i:[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12})$`)
)

func IsValidUUID(uuid string) bool {
	return RegexUuid.MatchString(uuid)
}

// ExpandEnvs expands several strings with environment variable
// it is just a loop calling os.ExpandEnv for every element
func ExpandEnvs(s ...string) (o []string) {
	o = make([]string, len(s))
	for i := range s {
		o[i] = os.ExpandEnv(s[i])
	}
	return
}

func gobBytes(i any) (b []byte, err error) {
	buf := new(bytes.Buffer)
	enc := gob.NewEncoder(buf)

	err = enc.Encode(i)
	b = buf.Bytes()

	return
}

// Sha256StringSlice utility
func Sha256StringSlice(array []string) string {
	sha256 := sha256.New()
	for _, e := range array {
		sha256.Write([]byte(e))
	}
	return hex.EncodeToString(sha256.Sum(nil))
}

func Sha256Interface(i interface{}) (h string, err error) {
	var b []byte

	if b, err = gobBytes(i); err != nil {
		return
	}

	return data.Sha256(b), nil
}

func DedupStringSlice(in []string) (out []string) {
	s := datastructs.NewSet()
	for _, v := range in {
		if !s.Contains(v) {
			out = append(out, v)
			s.Add(v)
		}
	}
	return
}

// Round float f to precision
func Round(f float64, precision int) float64 {
	pow := math.Pow10(precision)
	i := int64(f * pow)
	if i%10 > 5 {
		i++
	}
	return float64(i) / pow
}

// Utf16ToUtf8 converts a utf16 encoded byte slice to utf8 byte slice
// it returns error if there is any decoding / encoding issue
// Inspired by: https://gist.github.com/bradleypeabody/185b1d7ed6c0c2ab6cec#file-gistfile1-go
func Utf16ToUtf8(b []byte) ([]byte, error) {

	u16s := make([]uint16, 1)
	ret := &bytes.Buffer{}
	b8buf := make([]byte, 4)

	if len(b)%2 != 0 {
		return nil, fmt.Errorf("expecting even data length")
	}

	for i := 0; i < len(b); i += 2 {
		u16s[0] = uint16(b[i]) + (uint16(b[i+1]) << 8)
		r := utf16.Decode(u16s)[0]
		// skip BOM
		if i == 0 && r == '\ufeff' {
			continue
		}
		if r == utf8.RuneError {
			return nil, fmt.Errorf("invalid UTF-16 code point")
		}
		if !utf8.ValidRune(r) {
			return nil, fmt.Errorf("cannot UTF-16 code point to UTF-8")
		}
		n := utf8.EncodeRune(b8buf, r)
		ret.Write(b8buf[:n])
	}

	return ret.Bytes(), nil
}

```

`utils/utils_test.go`:

```go
package utils

import (
	"crypto/sha256"
	"encoding/hex"
	"fmt"
	"testing"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/toast"
	"github.com/0xrawsec/whids/los"
	"github.com/pelletier/go-toml/v2"
)

var (
	pid = 604
)

var (
	format = fmt.Sprintf
)

func TestIsValidUUID(t *testing.T) {
	tt := toast.FromT(t)

	for i := 0; i < 1000; i++ {
		uuid := UUIDOrPanic().String()
		tt.Assert(IsValidUUID(uuid))
		tt.Assert(!IsValidUUID(format("%s42", uuid)))
		tt.Assert(!IsValidUUID(format("42%s", uuid)))
	}
}

type testStruct struct {
	F []string
}

func controlHashStability(t *testing.T, test testStruct) (hash string) {
	var err error
	tt := toast.FromT(t)

	hash, err = Sha256Interface(test)
	tt.CheckErr(err)

	tomls, err := Toml(test)
	tt.CheckErr(err)
	toml.Unmarshal(tomls, &test)
	//new, err := Sha256Interface(test)
	new, err := Sha256Interface(test)
	tt.CheckErr(err)

	tt.Assert(hash == new)
	return
}

func TestSha256Interface(t *testing.T) {
	tt := toast.FromT(t)

	test := testStruct{}
	initTest := testStruct{[]string{"test", "toast"}}
	//h, err := Sha256Interface(test)
	hashEmpty := controlHashStability(t, test)
	hashInit := controlHashStability(t, initTest)

	tt.Assert(hashEmpty != hashInit)
}

func TestExpandEnvs(t *testing.T) {
	var envs []string

	tt := toast.FromT(t)

	switch los.OS {
	case los.OSWindows:
		envs = []string{"$Systemroot", "$systemdrive", "$programfiles", "$localappdata"}
	default:
		envs = []string{"$HOME", "$PWD"}
	}

	for i, exp := range ExpandEnvs(envs...) {
		t.Logf("%s=%s", envs[i], exp)
		tt.Assert(exp != "", fmt.Sprintf("failed to resolve environment variable %s", envs[i]))
		tt.Assert(fsutil.Exists(exp))
	}
}

func TestSha256StringSlice(t *testing.T) {
	t.Parallel()

	var s []string

	tt := toast.FromT(t)

	h := sha256.New()

	for i := 0; i < 100; i++ {
		k := NewKeyOrPanic(50)
		s = append(s, k)
		h.Write([]byte(k))
	}

	tt.Assert(Sha256StringSlice(s) == hex.EncodeToString(h.Sum(nil)))
}

func TestDedupStringSlice(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	s := []string{
		"test",
		"test",
		"toast",
		"toast",
		"roast",
	}

	dedup := DedupStringSlice(s)

	tt.Assert(len(dedup) == 3)
	tt.Assert(dedup[0] == "test")
	tt.Assert(dedup[1] == "toast")
	tt.Assert(dedup[2] == "roast")
}

func TestRound(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	tt.Assert(fmt.Sprintf("%.2f", Round(1.6333333, 2)) == "1.63")
	tt.Assert(fmt.Sprintf("%.2f", Round(1.6555555, 2)) == "1.65")
	tt.Assert(fmt.Sprintf("%.2f", Round(1.6666666, 2)) == "1.67")
}

func TestUtf16ToUtf8(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	utf16 := []byte{255, 254, 13, 0, 10, 0, 13, 0, 10, 0, 32, 0, 32, 0, 32, 0, 32, 0, 68, 0, 105, 0, 114, 0, 101, 0, 99, 0, 116, 0, 111, 0, 114, 0, 121, 0, 58, 0, 32, 0, 67, 0, 58, 0, 92, 0, 13, 0, 10, 0, 13, 0, 10, 0, 13, 0, 10, 0, 77, 0, 111, 0, 100, 0, 101, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 76, 0, 97, 0, 115, 0, 116, 0, 87, 0, 114, 0, 105, 0, 116, 0, 101, 0, 84, 0, 105, 0, 109, 0, 101, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 76, 0, 101, 0, 110, 0, 103, 0, 116, 0, 104, 0, 32, 0, 78, 0, 97, 0, 109, 0, 101, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 32, 0, 13, 0, 10, 0}

	utf8, err := Utf16ToUtf8(utf16)

	tt.CheckErr(err)
	// we have to take BOM into account for length caculation
	tt.Assert(len(utf8) == (len(utf16)-2)/2)

	t.Log(string(utf8))

}

```

`utils/windows.go`:

```go
//go:build windows
// +build windows

package utils

import (
	"fmt"
	"regexp"
	"strings"
	"syscall"

	"github.com/0xrawsec/golang-win32/win32/advapi32"
	"github.com/0xrawsec/golang-win32/win32/kernel32"
)

var (
	cDriveDeviceRe *regexp.Regexp
)

// ArgvFromCommandLine returns an argv slice given a command line
// provided in argument
func ArgvFromCommandLine(cl string) (argv []string, err error) {
	argc := int32(0)
	utf16ClPtr, err := syscall.UTF16PtrFromString(cl)
	if err != nil {
		return
	}
	utf16Argv, err := syscall.CommandLineToArgv(utf16ClPtr, &argc)
	if err != nil {
		return
	}
	argv = make([]string, argc)
	for i, utf16Ptr := range utf16Argv[:argc] {
		argv[i] = syscall.UTF16ToString((*utf16Ptr)[:])
	}
	return
}

func GetFileAttributes(filename string) (attrs uint32, err error) {
	var filenameW *uint16
	if filenameW, err = syscall.UTF16PtrFromString(filename); err != nil {
		return
	}
	return syscall.GetFileAttributes(filenameW)
}

// HideFile hides a file in Windows explorer
// source: https://stackoverflow.com/questions/54139606/how-to-create-a-hidden-file-in-windows-mac-linux
func HideFile(filename string) error {
	filenameW, err := syscall.UTF16PtrFromString(filename)
	if err != nil {
		return err
	}
	err = syscall.SetFileAttributes(filenameW, syscall.FILE_ATTRIBUTE_HIDDEN)
	if err != nil {
		return err
	}
	return nil
}

func ResolveCDrive(path string) string {
	var devs []string
	var err error

	if cDriveDeviceRe == nil {
		if devs, err = kernel32.QueryDosDevice("C:"); err != nil {
			return path
		}
		if len(devs) > 0 {
			if cDriveDeviceRe, err = regexp.Compile(regexp.QuoteMeta(devs[0])); err != nil {
				return path
			}
		}
	}

	if cDriveDeviceRe != nil {
		res := cDriveDeviceRe.ReplaceAllString(path, "C:")
		return res
	}

	return path
}

func RegValue(path string) (i interface{}, err error) {
	var data []byte
	var dtype uint32

	if data, dtype, err = advapi32.RegGetValueFromString(path); err != nil {
		return
	} else {
		if i, err = advapi32.ParseRegValue(data, dtype); err != nil {
			return
		} else {
			return
		}
	}
}

func RegJoin(s ...string) string {
	for i := range s {
		s[i] = strings.Trim(s[i], `\`)
	}
	return strings.Join(s, `\`)
}

func RegValueToString(elems ...string) string {
	if i, err := RegValue(RegJoin(elems...)); err == nil {
		return fmt.Sprintf("%v", i)
	}
	return ""
}

```

`utils/windows_test.go`:

```go
//go:build windows
// +build windows

package utils

import (
	"path/filepath"
	"syscall"
	"testing"

	"github.com/0xrawsec/golang-utils/fsutil"
	"github.com/0xrawsec/toast"
)

var (
	aclDirectories = []string{"C:\\Windows\\System32"}
)

func TestSetAuditACL(t *testing.T) {
	if err := SetEDRAuditACL(aclDirectories...); err != nil {
		t.Logf("Failed at setting Audit ACL: %s", err)
		t.FailNow()
	}
	t.Logf("Successfully set audit ACL")
}
func TestRemoveAuditACL(t *testing.T) {
	if err := RemoveEDRAuditACL(aclDirectories...); err != nil {
		t.Logf("Failed at setting Audit ACL: %s", err)
		t.FailNow()
	}
	t.Logf("Successfully set audit ACL")
}

func TestDisableFSAuditing(t *testing.T) {
	if err := DisableAuditPolicy("File System"); err != nil {
		t.Errorf("Failed at disabling FS Auditing: %s", err)
	}
}

func TestEnableFSAuditing(t *testing.T) {
	if err := EnableAuditPolicy("{0CCE921D-69AE-11D9-BED3-505054503030}"); err != nil {
		t.Errorf("Failed at enabling FS Auditing: %s", err)
	}
}

func TestRegValueToString(t *testing.T) {
	t.Parallel()

	pathBuildInfo := `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\`
	pathSystemInfo := `HKLM\SYSTEM\CurrentControlSet\Control\SystemInformation\`
	pathProcInfo := `HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\`

	tt := toast.FromT(t)

	pn := RegValueToString(pathBuildInfo, "ProductName")
	t.Log(pn)
	tt.Assert(pn != "")

	bv := RegValueToString(pathSystemInfo, "BIOSVersion")
	t.Log(bv)
	tt.Assert(bv != "")

	cpu := RegValueToString(pathProcInfo, "0", "ProcessorNameString")
	t.Log(cpu)
	tt.Assert(cpu != "")
}

func TestResolveCDdrive(t *testing.T) {
	t.Parallel()

	tt := toast.FromT(t)

	// we need to first call a bogus resolve
	ResolveCDrive("test")

	rawC := cDriveDeviceRe.String()
	// existing dirs from C:
	dirs := []string{"Windows", "Program Files", "Windows\\System32"}

	for _, d := range dirs {
		raw := filepath.Join(rawC, d)
		t.Logf("resolving %s", raw)
		tt.Assert(fsutil.IsDir(ResolveCDrive(raw)))
	}

	system32 := `Windows\System32\`
	// files available in system32
	files := []string{"cmd.exe", "conhost.exe", "wmi.dll", "advapi32.dll"}
	for _, f := range files {
		raw := filepath.Join(rawC, system32, f)
		t.Logf("resolving %s", raw)
		tt.Assert(fsutil.IsFile(ResolveCDrive(raw)))
	}
}

func TestHideFile(t *testing.T) {
	t.Parallel()
	tt := toast.FromT(t)

	hidden := filepath.Join(t.TempDir(), "hidden.txt")
	tt.CheckErr(HidsWriteData(hidden, nil))
	visible := filepath.Join(t.TempDir(), "hidden.txt")
	tt.CheckErr(HidsWriteData(visible, nil))

	// testing hidden file
	tt.CheckErr(HideFile(hidden))
	attrs, err := GetFileAttributes(hidden)
	tt.CheckErr(err)
	tt.Assert(attrs&syscall.FILE_ATTRIBUTE_HIDDEN != 0)

	attrs, err = GetFileAttributes(visible)
	tt.CheckErr(err)
	tt.Assert(attrs&syscall.FILE_ATTRIBUTE_HIDDEN == 0)
}

func TestArgvFromCommandLine(t *testing.T) {
	t.Parallel()

	cmdLine := `%%SystemRoot%%\\system32\\csrss.exe ObjectDirectory=\\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16`

	tt := toast.FromT(t)
	argv, err := ArgvFromCommandLine(cmdLine)
	tt.CheckErr(err)
	t.Log(JsonStringOrPanic(argv))
}

```