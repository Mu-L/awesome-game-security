Project Path: arc_dNop90_dOffset_yh58py23

Source Tree:

```txt
arc_dNop90_dOffset_yh58py23
├── Cheat Engine
│   └── autorun
│       └── dOffset.lua
├── IDA Pro
│   └── plugins
│       └── dOffset.py
├── LICENSE
├── README.md
└── images
    ├── ce1.png
    ├── ce2.png
    ├── ida1.png
    └── ida2.png

```

`Cheat Engine/autorun/dOffset.lua`:

```lua
function isHex(str)
    return str:match("^%x+$") ~= nil
end

function GetOffsetResult(Address, bWithModuleName)
    if((not Address) or (not inModule(Address))) then
        return nil
    end

    local ModuleName = getNameFromAddress(Address, _, false)
    if(isHex(ModuleName)) then
        return nil
    end

    if(bWithModuleName) then
        return ModuleName
    end

    local SubStrings = {}
    for text in string.gmatch(ModuleName, "[^+]+") do
        table.insert(SubStrings, text)
    end

    return SubStrings[2]
end

function dOffset_GetOffset(bDisassembler)
    local CurrentSelectedAddress = nil
    if(bDisassembler) then
        CurrentSelectedAddress = getMemoryViewForm().DisassemblerView.SelectedAddress
    else
        CurrentSelectedAddress = getMemoryViewForm().HexadecimalView.SelectionStart
    end
    
    local Offset = GetOffsetResult(CurrentSelectedAddress, false)
    if(not Offset) then
        showMessage("Unable to get offset")
        return
    end

    writeToClipboard(Offset)
end

function dOffset_GetModuleOffset(bDisassembler)
    local CurrentSelectedAddress = nil
    if(bDisassembler) then
        CurrentSelectedAddress = getMemoryViewForm().DisassemblerView.SelectedAddress
    else
        CurrentSelectedAddress = getMemoryViewForm().HexadecimalView.SelectionStart
    end

    local Offset = GetOffsetResult(CurrentSelectedAddress, true)
    if(not Offset) then
        showMessage("Unable to get offset")
        return
    end

    writeToClipboard(Offset)
end

function Add_dOffsetMenu(bDisassembler)
    local MainPopupMenu = nil
    if(bDisassembler) then
        MainPopupMenu = getMemoryViewForm().DisassemblerView.PopupMenu
    else
        MainPopupMenu = getMemoryViewForm().HexadecimalView.PopupMenu
    end

    -- Menu
    local dOffsetMenu_Main = createMenuItem(MainPopupMenu)
    dOffsetMenu_Main.Caption = 'dOffset'
    MainPopupMenu.Items.add(dOffsetMenu_Main)

    -- Sub menu
    local dOffsetMenu_GetOffset = createMenuItem(dOffsetMenu_Main)
    dOffsetMenu_GetOffset.Caption = 'Get offset'
    dOffsetMenu_GetOffset.OnClick = function(sender)
        dOffset_GetOffset(bDisassembler)
    end
    dOffsetMenu_Main.add(dOffsetMenu_GetOffset)

    local dOffsetMenu_GetModuleOffset = createMenuItem(dOffsetMenu_Main)
    dOffsetMenu_GetModuleOffset.Caption = 'Get module name + offset'
    dOffsetMenu_GetModuleOffset.OnClick = function(sender)
        dOffset_GetModuleOffset(bDisassembler)
    end
    dOffsetMenu_Main.add(dOffsetMenu_GetModuleOffset)
end

-- Add to CE
Add_dOffsetMenu(true)
Add_dOffsetMenu(false)
```

`IDA Pro/plugins/dOffset.py`:

```py
#------------------------------------------------------------------------------
#   IDA Plugin
#   dOffset
#   
#   Go to offset or copy offset from current line
#------------------------------------------------------------------------------

VERSION = '1.0.0'
AUTHOR = 'dNop90'
PLUGIN_NAME = "dOffset"


import idc
import idaapi
import PyQt5.QtGui as QtGui
import PyQt5.QtCore as QtCore
import PyQt5.QtWidgets as QtWidgets
from PyQt5.Qt import QApplication

class dOffset(idaapi.plugin_t):
    flags = idaapi.PLUGIN_PROC | idaapi.PLUGIN_HIDE
    comment = "Get current address offset or jump to specific offset"
    wanted_name = PLUGIN_NAME
    
    def init(self):
        self.AddActions()
        self._init_hooks()
        
        print(f"[{PLUGIN_NAME}] Loaded")
        return idaapi.PLUGIN_KEEP
        
    def run(self, arg):
        pass
        
    def term(self):
        self.RemoveAllActions()
        self._hooks.unhook()
        
    def _init_hooks(self):
        self._hooks = Hooks()
        self._hooks.ready_to_run = self._init_hexrays_hooks
        self._hooks.hook()

    def _init_hexrays_hooks(self):
        if idaapi.init_hexrays_plugin():
            idaapi.install_hexrays_callback(self._hooks.hxe_callback)
        
    ACTION_NAME_MAINCTX = "dOffset"
    ACTION_NAME_GETOFFSET = "dOffset:GetOffset"
    ACTION_NAME_GETMODULEWITHOFFSET = "dOffset:GetModuleWithOffset"
    ACTION_NAME_JUMPTOOFFSET = "dOffset:JumpToOffset"
    def AddActions(self):
        action_desc_offset = idaapi.action_desc_t(
            self.ACTION_NAME_GETOFFSET,
            "Get offset",
            GetOffsetHandler(),
            None,
            "Get current address offset"
        )
        action_desc_module_offset = idaapi.action_desc_t(
            self.ACTION_NAME_GETMODULEWITHOFFSET,
            "Get module name + offset",
            GetModuleOffsetHandler(),
            None,
            "Get current module name with current address offset"
        )
        action_desc_jump_offset = idaapi.action_desc_t(
            self.ACTION_NAME_JUMPTOOFFSET,
            "Jump to offset",
            JumpToOffsetHandler(),
            None,
            "Jump to address offset"
        )

        idaapi.register_action(action_desc_offset)
        idaapi.register_action(action_desc_module_offset)
        idaapi.register_action(action_desc_jump_offset)

        self.AttachActionToMenu()

    def AttachActionToMenu(self):
        idaapi.attach_action_to_menu(
            "Jump/dOffset/",
            self.ACTION_NAME_JUMPTOOFFSET,
            idaapi.SETMENU_APP
        )
    
    def RemoveAllActions(self):
        idaapi.unregister_action(self.ACTION_NAME_GETOFFSET)
        idaapi.unregister_action(self.ACTION_NAME_GETMODULEWITHOFFSET)
        idaapi.unregister_action(self.ACTION_NAME_JUMPTOOFFSET)


def PLUGIN_ENTRY():
    return dOffset()
    
    
class Hooks(idaapi.UI_Hooks):
    def __init__(self):
        super(Hooks, self).__init__()

    def finish_populating_widget_popup(self, widget, popup):
        if idaapi.get_widget_type(widget) == idaapi.BWN_DISASMS:
            idaapi.attach_action_to_popup(
                widget,
                popup,
                dOffset.ACTION_NAME_MAINCTX,
                "dOffset",
                idaapi.SETMENU_APP
            )
            idaapi.attach_action_to_popup(
                widget,
                popup,
                dOffset.ACTION_NAME_GETOFFSET,
                dOffset.ACTION_NAME_MAINCTX + "/"
            )
            idaapi.attach_action_to_popup(
                widget,
                popup,
                dOffset.ACTION_NAME_GETMODULEWITHOFFSET,
                dOffset.ACTION_NAME_MAINCTX + "/"
            ) 
        return 0
    
    def hxe_callback(self, event, *args):
        if event == idaapi.hxe_populating_popup:
            form, popup, vu = args
            
            if get_cursor_func_ref() == idaapi.BADADDR:
                return 0
            
            idaapi.attach_action_to_popup(
                form,
                popup,
                dOffset.ACTION_NAME_MAINCTX,
                "dOffset",
                idaapi.SETMENU_APP
            )
            idaapi.attach_action_to_popup(
                form,
                popup,
                dOffset.ACTION_NAME_GETOFFSET,
                dOffset.ACTION_NAME_MAINCTX + "/"
            )
            idaapi.attach_action_to_popup(
                form,
                popup,
                dOffset.ACTION_NAME_GETMODULEWITHOFFSET,
                dOffset.ACTION_NAME_MAINCTX + "/"
            )
        
        return 0


#Action Handlers
class GetOffsetHandler(idaapi.action_handler_t):
    def __init__(self):
        idaapi.action_handler_t.__init__(self)
        
    def activate(self, ctx):
        CurrentOffset = idaapi.get_screen_ea() - idaapi.get_imagebase()
        
        clipboard = QApplication.clipboard()
        clipboard.clear(mode=clipboard.Clipboard )
        clipboard.setText(f'{CurrentOffset:X}', mode=clipboard.Clipboard)
        
        print("[%s] %X -> 0x%X" % (PLUGIN_NAME, idaapi.get_screen_ea(), CurrentOffset))
        return 1
    
    def update(self, ctx):
        return idaapi.AST_ENABLE_ALWAYS
    
class GetModuleOffsetHandler(idaapi.action_handler_t):
    def __init__(self):
        idaapi.action_handler_t.__init__(self)
        
    def activate(self, ctx):
        CurrentOffset = idaapi.get_screen_ea() - idaapi.get_imagebase()
        file_name = idc.get_root_filename()
        
        clipboard = QApplication.clipboard()
        clipboard.clear(mode=clipboard.Clipboard )
        clipboard.setText(f'{file_name}+{CurrentOffset:X}', mode=clipboard.Clipboard)
        
        print("[%s] %X -> %s+0x%X" % (PLUGIN_NAME, idaapi.get_screen_ea(), file_name, CurrentOffset))
        return 1
    
    def update(self, ctx):
        return idaapi.AST_ENABLE_ALWAYS
    
class JumpToOffsetHandler(idaapi.action_handler_t):
    def __init__(self):
        idaapi.action_handler_t.__init__(self)
        
    def activate(self, ctx):
        InputOffset = idaapi.ask_str("", 0, "Offset:")
        if (InputOffset is None):
            return 1
        
        if "0x" in InputOffset:
            InputOffset = InputOffset.replace("0x", "")

        if(not is_hex(InputOffset)):
            print("[%s] Invalid offset value %s" % (PLUGIN_NAME, InputOffset))
            return 1
        
        InputOffsetInt = int(InputOffset.lower(), 16)
        AddressToJump = idaapi.get_imagebase() + InputOffsetInt
        if(idaapi.jumpto(AddressToJump)):
            print("[%s] 0x%X -> %X" % (PLUGIN_NAME, InputOffsetInt, AddressToJump))
        else:
            print("[%s] Failed to jump to address with offset 0x%X" % (PLUGIN_NAME, InputOffsetInt))

        return 1
    
    def update(self, ctx):
        return idaapi.AST_ENABLE_ALWAYS

#Other
def is_hex(s):
    try:
        int(s.lower(), 16)
        return True
    except ValueError:
        return False
```

`LICENSE`:

```
MIT License

Copyright (c) 2024 D

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

```

`README.md`:

```md
# dOffset
dOffset is a plugin designed for IDA Pro and Cheat Engine, offering a convenient way to obtain the offset of the current module. This enables users to navigate to specific addresses in other reverse engineering software easily. It is beneficial when performing static analysis of a file while simultaneously debugging with multiple tools, including IDA Pro, Cheat Engine, x64dbg, and others.


## IDA Pro
IDA Pro version 7.4+ and Python 3

### Features
- Jump to specific offset
- Get offset
- Get module name and offset

### Installation
Place the `dOffset.py` file in the `plugins` folder where your IDA Pro is installed.

### Usage
Right-click on any line in the IDA view, and you should see the `dOffset` option. Select either `Get offset` or `Get module name + offset`, and the result will be copied to your clipboard.<br>
To jump to a specific offset, navigate to the `Jump` menu, then select `dOffset` and `Jump to offset`. Enter the desired offset.

### Screenshots
![IDA1](/images/ida1.png)

![IDA1](/images/ida2.png)


## Cheat Engine

### Features
- Get offset (Disassembler and Hexadecimal view)
- Get module name and offset (Disassembler and Hexadecimal view)

### Installation
Place the `dOffset.lua` file in the `autorun` folder where your Cheat Engine is installed.

### Usage
Right-click on any line in the Disassembler or on any hex in the Hexadecimal viewer, then you should see the `dOffset` option. Select either `Get offset` or `Get module name + offset`, and the result will be copied to your clipboard. If the current address is not part of any module, you will not be able to get the offset.

### Screenshots
![CE1](/images/ce1.png)

![CE2](/images/ce2.png)


```