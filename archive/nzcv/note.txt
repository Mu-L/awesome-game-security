Project Path: arc_nzcv_note_2pbx0nvs

Source Tree:

```txt
arc_nzcv_note_2pbx0nvs
├── AdbMemMonitor.exe
├── README.md
├── arm
│   ├── 00.1complement.md
│   │   └── readme.md
│   ├── 01register.md
│   │   └── readme.md
│   ├── 02read_pc.md
│   │   └── readme.md
│   ├── 03.10args.md
│   │   └── readme.md
│   ├── 03.11stack.push_pop.md
│   │   └── readme.md
│   ├── 03.1brk
│   │   └── readme.md
│   ├── 03.2ldr_str.md
│   │   └── readme.md
│   ├── 03.3add_sub_mul_div.md
│   │   └── readme.md
│   ├── 03.4and_orr_eor_orn_bic.md
│   │   └── readme.md
│   ├── 03.5lsl_lsr_asr_ror_rrx_mov_mvn.md
│   │   └── readme.md
│   ├── 03.6nzcv.md
│   │   └── readme.md
│   ├── 03.7b_bl.md
│   │   └── readme.md
│   ├── 03.8conditional_execution.eq_ne_ge_lt.md
│   │   └── readme.md
│   ├── 03.9pc_sp_b_bl_bx.md
│   │   └── readme.md
│   ├── 03data_processing.md
│   │   └── readme.md
│   ├── 04msr_mrs.md
│   │   └── readme.md
│   ├── 05div.md
│   │   └── readme.md
│   ├── 07condition.md
│   │   └── readme.md
│   ├── 08canary.md
│   │   └── readme.md
│   ├── 09if_switch.md
│   │   └── readme.md
│   ├── 11for_while.md
│   │   └── readme.md
│   ├── 12stack_aligin.md
│   │   └── readme.md
│   ├── 13array.md
│   │   └── readme.md
│   ├── 14struct.md
│   │   └── readme.md
│   ├── 15pointer.md
│   │   └── readme.md
│   ├── 16bit_operand.md
│   │   └── readme.md
│   ├── 17logic_operand.md
│   │   └── readme.md
│   ├── 18mix_c_asm.__asm.md
│   │   └── readme.md
│   ├── README.md
│   ├── cheatsheetv1.3-1920x1080.png
│   └── img
│       ├── cset2.png
│       ├── ida_dcqdwb.png
│       ├── if_switch.png
│       ├── if_switch2.png
│       ├── mvn.png
│       ├── nzcv.png
│       ├── pointer01.png
│       ├── pointer05.png
│       ├── struct01.png
│       ├── struct03_sizeof.png
│       └── tbnz.png
├── caddy2
│   ├── antdesign.md
│   │   └── readme.md
│   └── readme.md
├── cpp
│   ├── 64template_ref.md
│   │   └── readme.md
│   └── virtual_fun.md
│       └── readme.md
├── csapp
│   └── 01.BigEndianandLittleEndian
│       └── readme.md
├── flutter
│   └── readme.md
├── ida
│   ├── 01dcb_dcw_dcd.md
│   │   └── readme.md
│   ├── 02idapython.md
│   │   └── readme.md
│   └── ida_struct.md
├── ios
│   ├── MemoryInfo.cpp
│   ├── malloc history
│   ├── malloc_history_tool.py
│   └── memory_limit.md
├── kernel
│   ├── 02.task_cred.md
│   └── kerneldump.md
│       └── readme.md
├── linker
│   ├── 00elf.md
│   │   └── readme.md
│   ├── 01elfheader.md
│   │   └── readme.md
│   ├── 02mmap.md
│   │   └── readme.md
│   ├── 03programheader
│   │   └── readme.md
│   ├── 04.1pt_load.md
│   │   └── readme.md
│   ├── 04.2pt_dyn.md
│   │   └── readme.md
│   ├── 05symtab.md
│   │   └── readme.md
│   ├── 06import_dyn.plt.md
│   │   └── readme.md
│   ├── 07hasthtable.md
│   │   └── readme.md
│   ├── 08dyn.rel.md
│   │   └── readme.md
│   ├── 09section.md
│   │   └── readme.md
│   ├── 10why_three.md
│   │   └── readme.md
│   └── readme.md
├── lldb
│   ├── 02.hardwarebreakpoint.md
│   └── readme.md
├── magsik
│   └── readme.md
├── ok
├── renderdoc
│   ├── android.build.log
│   ├── build.md
│   ├── rdc.md
│   ├── rdc_callstack.md
│   ├── readme.md
│   ├── renderdoccmd.md
│   ├── scripts
│   │   └── stats.py
│   └── tmp.c
├── rust
│   ├── 01expr.md
│   ├── 02datatype.md
│   ├── 2022-05-22-21-58-17.png
│   ├── 2022-05-22-21-58-18.png
│   ├── 2022-05-22-21-59-45.png
│   ├── 2022-05-22-22-01-11.png
│   ├── 2022-05-22-22-02-44.png
│   ├── 2022-05-22-22-03-13.png
│   ├── 2022-05-22-22-17-09.png
│   ├── 2022-05-22-22-17-59.png
│   ├── 2022-05-22-22-19-24.png
│   ├── 2022-05-22-22-21-57.png
│   ├── 2022-05-22-22-22-32.png
│   ├── 2022-05-22-22-23-07.png
│   ├── 2022-05-22-22-23-41.png
│   ├── 2022-05-22-22-24-38.png
│   ├── 2022-05-22-22-25-03.png
│   ├── 2022-05-22-22-25-32.png
│   ├── 2022-05-22-22-28-45.png
│   ├── 2022-05-22-22-29-38.png
│   ├── 2022-05-22-22-32-26.png
│   └── 2022-05-22-22-33-57.png
├── sofixer
│   └── 01elfheader.md
│       └── readme.md
├── vcpkg
│   └── readme.md
├── vulkan
│   └── memory.md
└── wx_dijiaskal.png

```

`README.md`:

```md
# note

## 讨论区

https://github.com/nzcv/note/discussions/categories/q-a

## Arm64汇编学习(B站视频, 欢迎关注)

[晓梦学汇编01. Arm汇编进位标志位Carry Flag](https://www.bilibili.com/video/BV1Gg1mYrEyZ/?share_source=copy_web&vd_source=1bfa7ae67809f98778bc9000f433e622)

## Arm64汇编学习(站在编译器的角度学习)

[01.Arm寄存器](https://github.com/nzcv/note/tree/master/arm/01register.md)

[02.Arm32读PC寄存器](https://github.com/nzcv/note/tree/master/arm/02read_pc.md)

[03.Arm数据访问指令](https://github.com/nzcv/note/tree/master/arm/03data_processing.md)

[04.Arm读取状态寄存器](https://github.com/nzcv/note/tree/master/arm/04msr_mrs.md)

[05.Arm整数移位除法](https://github.com/nzcv/note/tree/master/arm/05div.md)

[06.Arm调用约定](https://github.com/nzcv/note/tree/master/arm/06args.md)

[07.Arm条件指令](https://github.com/nzcv/note/tree/master/arm/07condition.md)

[08.Arm64堆栈保护机制](https://github.com/nzcv/note/tree/master/arm/08canary.md)

[09.Arm IF Switch对应实现](https://github.com/nzcv/note/tree/master/arm/09if_switch.md)

[10.NZCV标志位](https://github.com/nzcv/note/tree/master/arm/10nzcv.md)

[11.ForWhile汇编解析](https://github.com/nzcv/note/tree/master/arm/11for_while.md)

[12.堆栈对齐stack_aligin汇编解析.md](https://github.com/nzcv/note/tree/master/arm/12stack_aligin.md)

[13.数组array汇编解析.md](https://github.com/nzcv/note/tree/master/arm/13array.md)

[14.结构体struct汇编解析.md](https://github.com/nzcv/note/tree/master/arm/14struct.md)

[15.指针pointer汇编解析.md](https://github.com/nzcv/note/tree/master/arm/15pointer.md)

[16.移位位运算汇编解析.md](https://github.com/nzcv/note/tree/master/arm/16bit_operand.md)

[17.逻辑位运算汇编解析.md](https://github.com/nzcv/note/tree/master/arm/17logic_operand.md)

## Arm64相关文档

[Arm64官方手册_查阅C6.2](https://github.com/nzcv/note/releases/download/note_books/DDI0487G_a_armv8_arm.pdf)

## ELF文件解析与自己编写linker

https://github.com/nzcv/note/tree/master/linker/00elf.md

https://github.com/nzcv/note/tree/master/linker/01elfheader.md 

https://github.com/nzcv/note/tree/master/linker/02mmap.md

https://github.com/nzcv/note/tree/master/linker/05symtab.md

https://github.com/nzcv/note/tree/master/linker/06import_dyn.plt.md

https://github.com/nzcv/note/tree/master/linker/07hasthtable.md

https://github.com/nzcv/note/tree/master/linker/08dyn.rel.md

https://github.com/nzcv/note/tree/master/linker/09section.md

代码实现:

https://github.com/nzcv/note/releases/download/note_books/mylinker.zip

## NDK对应clang版本号

```shell
android-ndk-r20  -> clang version 8.0.7
android-ndk-r21e -> clang version 9.0.9
android-ndk-r22b -> clang varsion 11.0.5 (match https://godbolt.org/)
```

## 其他帮助学习网站

[https://yifengyou.gitbooks.io/learn-c/content/](https://yifengyou.gitbooks.io/learn-c/content/)

[https://www.one-tab.com/page/KxuI8ZPrQh66sloC1hb0gg](https://www.one-tab.com/page/KxuI8ZPrQh66sloC1hb0gg)

[https://github.com/keystone-engine/keypatch](https://github.com/keystone-engine/keypatch)

[31寸显示器你需要它](https://rectangleapp.com/)

## Join Us(定期拉群)

![](./wx_dijiaskal.png)




```

`arm/01register.md/readme.md`:

```md


前段时间通篇概览一遍[汇编语言程序设计——基于ARM体系结构(第4版)](https://item.jd.com/10027570912314.html), 总感觉纸上得来终觉浅, 并不能够让我产生一种读汇编就跟读C代码一样那种流畅的感觉. 如果我们越熟悉, 越发觉得他们是有规律可循的, 这里做一下对应的记录, 互相共勉.

## 通用寄存器并不通用

表面上arm为我们提供了31个通用寄存器, 但其实他们并不通用, 或者说编译在编译代码时, 并不是随意的给寄存器赋值的, 他们都被划分为了不同的用途和含义, 我们需要记住这些用途,看汇编看起来就不会无从着手了.

ARM64提供了31个通用寄存器，其用途如下表：

x0~x7：传递子程序的参数和返回值，使用时不需要保存，多余的参数用堆栈传递，64位的返回结果保存在x0中。

**x8：用于保存子程序的返回地址，使用时不需要保存。**

x9~x15：临时寄存器，也叫可变寄存器，子程序使用时不需要保存。

x16~x17：子程序内部调用寄存器（IPx），使用时不需要保存，尽量不要使用。

x18：平台寄存器，它的使用与平台相关，尽量不要使用。

x19~x28：临时寄存器，子程序使用时必须保存。

x29：帧指针寄存器（FP），用于连接栈帧，使用时必须保存。

x30：链接寄存器（LR），用于保存子程序的返回地址。

x31：堆栈指针寄存器（SP），用于指向每个函数的栈顶。

![20211123091457](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211123091457.png)

![20211122173258](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122173258.png)


### 比较重要的寄存器 FP, LR, SP, PC, PSR

![20211122145005](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122145005.png)

1. 通过PC寄存器状态信息可以了解到目前PC寄存器在等待SVC调用, 处于read函数+4的偏移位置

2. 通过LR寄存器了解到上一层调用来自__sread, 调用链为__sread()->read()

3. PSR寄存器有好几种模式, 目前显示的是用户模式下面的CPSR寄存器的状态信息, 不同的位,具有不同的含义, 图片内已经做了详细的注释信息

### 次重要寄存器

```asm
hello:00000056C73836C4 SUB             SP, SP, #0x10           ; CODE XREF: main:loc_56C7383710↓p
hello:00000056C73836C8 MOV             W8, #1                  ; w8 = 1         ;
hello:00000056C73836CC MOV             W9, #2                  ; w9 = 2         ;
hello:00000056C73836D0 STR             W8, [SP,#0x10+var_4]    ; var_4 = w8 = 1 ;临时变量初始化为1
hello:00000056C73836D4 STR             W9, [SP,#0x10+var_8]    ; var_8 = w9 = 2 ;临时变量初始化2
hello:00000056C73836D8 STR             WZR, [SP,#0x10+var_C]   ; var_c = 0      ;临时变量初始化0     使用wzr寄存器
hello:00000056C73836DC LDR             W8, [SP,#0x10+var_4]    ; w8 = var_4 = 1 ;临时变量到寄存器w8
hello:00000056C73836E0 LDR             W9, [SP,#0x10+var_8]    ; w9 = var_8 = 2 ;临时变量到寄存器w9
hello:00000056C73836E4 ADD             W8, W8, W9              ; w8 = w8 + w9 = 3;执行加法
hello:00000056C73836E8 STR             W8, [SP,#0x10+var_C]    ; var_c = w8 = 3  ;存储结果
hello:00000056C73836EC LDR             W0, [SP,#0x10+var_C]    ; w0 = var_c = 3  ;返回结果 因为返回值是int, 因此使用w. w0便存储了对应的返回值
hello:00000056C73836F0 ADD             SP, SP, #0x10           ; ;pop stack      ;回收临时变量
hello:00000056C73836F4 RET
```

1. X0寄存器: 保存返回值

2. X8, X9寄存器: tmp

3. WZR/XZR寄存器: zero寄存器, 一般用来进行零时变量初始化

### PC寄存器

因为PC寄存器比较重要, 因此单独列出来

[https://github.com/yhnu/note/tree/master/arm/02register_pc.md](https://github.com/yhnu/note/tree/master/arm/02register_pc.md)

### 指令的设计

1. 没有隐式内存操作指令

所有的内存操作都有对应的指令(LDR/STR)

2. 不同的指令都有对应的操作数{内存/立即数/寄存器}(对应数量1-3个)

(1) 内存操作数和立即数操作数不能同时存在

(2) 内存操作数至多出现一次

(3) 寄存器操作数总在最前面

### 常用的指令

1. SUB 

将某一寄存器的值和另一寄存器的值 相减 并将结果保存在另一寄存器中

```asm
SUB             x0, x1, x2   ; x0 = x1 - x2
SUB             SP, SP, #0x30; 更新栈顶寄存器的值,(可以看出:申请 0x30 字节占空间为临时变量)
```

2. STP(stp：store pair)

入栈指令（str 的变种指令，可以同时操作两个寄存器）, var_xxx(xxx代表偏移,一般为负数)

```asm
STP             X29, X30, [SP,#0x20+var_s0] ; 入栈指令（str 的变种指令，可以同时操作两个寄存器）, 保存X29, X30, X29为FP寄存器, X30为LR寄存器
```

3. ADD

将某一寄存器的值和另一寄存器的值 相加 并将结果保存在另一寄存器中

```asm
add x0, x0, #1    ; x0 = x0 + 1
add x0, x1, x2    ; x0 = x1 + x2
add x0, x1, [x2]  ; x0 = x1 + mem(x2)

ADD             X29, SP, #0x20; X29 = SP + 0x20, 前面已经保存了寄存器,这里开始使用寄存器
```

4. ADR

    这是一条小范围的地址读取指令，它将基于PC的相对偏移的地址读到目标寄存器中；
    使用格式：ADR register exper

5. ADRP

用来定位数据段中的数据用, 因为 aslr 会导致代码及数据的地址随机化, 用 adrp 来根据 pc 做辅助定位

```asm
ADRP            X8, #aGoing@PAGE        ; "going ...... \n"
ADD             X8, X8, #aGoing@PAGEOFF ; "going ...... \n"
```

* 得到一个大小为4KB的页的基址，而且在该页中有全局变量aGoing的地址；ADRP就是讲该页的基址存到寄存器X8中；
* ADD指令会算出g的地址，X8+#aGoing@PAGEOFF，#aGoing@PAGEOFF是一个偏移量；这样就得到了g的地址X8;

![20211122213837](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122213837.png)

对应原理：

* 编译时，首先会计算出当前PC到exper的偏移量#offset_to_exper
* pc的低12位清零，然后加上偏移量，给register, 得到的地址，是含有label的4KB对齐内存区域的base地址；

6. STUR/STR

ST开头的为存数据,比如说STR、STP、STUR

U: 表示负数
P: PAIR

```asm
STUR            WZR, [X29,#var_4]       ; var_4 = 0
STUR            W0, [X29,#var_8]        ; var_8 = w0; w0 is argc
STR             X1, [SP,#0x20+var_10]   ; var_10 = x1; x1 is argv
STR             X8, [SP,#0x20+var_18]   ; var_18 = x8;
```

7. LDR

```asm
LDR             X0, [SP,#0x20+var_18]   ; x0 = var_18 = x8 = "going" is printf arg0
```

8. BL/B/BR

BL: Branch with Link            (−16MB to +16MB)

B : Branch                      (−2KB to +2KB)

BR: Branch to register          (Any value in register)

[B指令ARM官方文档](https://developer.arm.com/documentation/dui0497/a/the-cortex-m0-instruction-set/branch-and-control-instructions/b--bl--bx--and-blx?lang=en)

```asm
BL              unk_639712B640          ; jump to printf with save lr
BL              unk_639712B650          ; jump to getchar with save lr
B               loc_639712B738          ; while(1)
BR              X17                     ; printf
```
### hello 添加对应注释

![20211122190626](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122190626.png)

### PLT 调用特征

```asm
loc_639712B640                            ; CODE XREF: main+28↓p
ADRP            X16, #off_639713BFB0@PAGE ; X16 = PAGE(0x110000)
LDR             X17, [X16,#off_639713BFB0@PAGEOFF] ;  X17 = mem(X16 + offset) ; offset=00112000
ADD             X16, X16, #off_639713BFB0@PAGEOFF  ; X16 = X16 + offset
BR              X17                                ; printf
```

![20211122193628](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122193628.png)

通过printf的plt调用过程,他们使用的策略都是一样的:

* 使用x16, x17寄存器
* 首先使用ADRP找到页基址, 然后加载对应页偏移, BR进行寄存器跳转

## help link

[https://github.com/yhnu/note/tree/master/arm/01register](https://github.com/yhnu/note/tree/master/arm/01register)

[https://github.com/yhnu/op7t](https://github.com/yhnu/op7t)

[https://github.com/yhnu/note/files/7585646/DDI01001.pdf](https://github.com/yhnu/note/files/7585646/DDI01001.pdf)
```

`arm/02read_pc.md/readme.md`:

```md

### PC寄存器

    32位thumb也是采用三级流水线结构,但是每个指令位2个字节因此+4


1. thumb模式读PC寄存器

```asm
mov r0, pc ; thumb mode r0 = pc + 4
```

![20211123161050](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211123161050.png)

```asm
LDR             R1, =(aLd - 0xAC3B62C)
ADD             R1, PC                  ; "%ld\n"
```
![20211123155731](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211123155731.png)

2. thumb模式使用LDR使用PC进行间接寻址

```asm
如果pc为非4字节对齐, pc会向上对齐
```

3. arm模式读PC寄存器

```asm
mov r0, pc ; arm mode r0 = pc + 8
```

![20211123170732](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211123170732.png)

```asm
ldr r0, [pc, #2] ; r0 = mem(pc + 8 + offset(2))
```

![20211123172421](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211123172421.png)

## 背后原理

1. 32位arm,采用3级流水线结构

![20220116171257](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220116171257.png)

2. 64位arm,采用5级流水线结构体
![20220116171719](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220116171719.png)

```

`arm/03.10args.md/readme.md`:

```md

![20211205185052](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211205185052.png)

参数传递的本质: 将上层函数变量复制一份, 传给下层函数.

# 过程调用标准AAPC(Arm Architecture Procedure Call)

![20220118084646](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118084646.png)
有了标准, 才能够进行C调用汇编或者汇编调用C


# ARM32调用约定

![20220118084824](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118084824.png)

参数是不同位数传参情况, 额外的参数被caller进行入栈, callee进行出栈

## 寄存器传参

![20220118085114](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118085114.png)

## 寄存器返回

![20220118085234](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118085234.png)

## 汇编调用C程序/C调用汇编程序

![20220118085619](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118085619.png)

## 32位实现64位加法运算

![20220118085751](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118085751.png)

## Arm的栈结构

![20220118085916](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118085916.png)

## 堆栈传参数与栈平衡

![20220118090516](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118090516.png)

## 子程序需要保存的寄存器

![20220118091115](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118091115.png)

![20220118091308](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118091308.png)

## 子程序返回PUSH {LR}/ POP {PC}

![20220118091739](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118091739.png)

## 结构体传参

```c
void my_argIsStruct(TPoint3D a1, int a2, int a3) {    
    //结构体作为参数，会把其字段按顺序依次放入寄存器或者栈，相当于把结构体拆解为多个参数，按照ARM传递参数规则来传递
    a1.dx_0 = 0;
    a1.dy_4 = 4;
    a1.dz_8 = 8;
    printf("结构体参数，其字段1：%d", a1.dx_0);
    printf("结构体参数，其字段2：%d", a1.dy_4);
    printf("结构体参数，其字段3：%d", a1.dz_8);
    printf("结构体参数之后的第2个int参数：%d", a2);
    printf("结构体参数之后的第3个int参数：%d", a3);
}
```

    结构体作为参数，会把其字段按顺序依次放入寄存器或者栈，相当于把结构体拆解为多个参数，按照ARM传递参数规则来传递

```asm
hello32:0286B5BA STR             R2, [SP,#0x18+var_C]    ; varc = r2
hello32:0286B5BC STR             R1, [SP,#0x18+var_10]   ; var10 = r1
hello32:0286B5BE STR             R0, [SP,#0x18+var_14]   ; var14 = r0
hello32:0286B5C0 STR             R3, [SP,#0x18+var_18]   ; var18 = r3
hello32:0286B5C2 MOVS            R0, #0
hello32:0286B5C4 STR             R0, [SP,#0x18+var_14]   ; var14 = 0
hello32:0286B5C6 MOVS            R0, #4
hello32:0286B5C8 STR             R0, [SP,#0x18+var_10]   ; var10 = 4
hello32:0286B5CA MOVS            R0, #8
hello32:0286B5CC STR             R0, [SP,#0x18+var_C]    ; varc = 8
```
    R0-3会作为参数进行传递, 其他参数会压栈处理, 并且R7会赋值为SP,后面基于R7(SP)进行寻址操作

```asm
hello32:0286B5B0 my_argIsStruct
hello32:0286B5B0
hello32:0286B5B0 var_18= -0x18
hello32:0286B5B0 var_14= -0x14
hello32:0286B5B0 var_10= -0x10
hello32:0286B5B0 var_C= -0xC
hello32:0286B5B0
hello32:0286B5B0 PUSH            {R7,LR}                 ; save r7, lr. r7 will as sp
hello32:0286B5B2 MOV             R7, SP                  ; r7 = sp
hello32:0286B5B4 SUB             SP, SP, #0x10           ; local var
hello32:0286B5B6 LDR.W           R12, [R7,#8]            ; ????????????????????????????????????
hello32:0286B5BA STR             R2, [SP,#0x18+var_C]    ; varc = r2
hello32:0286B5BC STR             R1, [SP,#0x18+var_10]   ; var10 = r1
hello32:0286B5BE STR             R0, [SP,#0x18+var_14]   ; var14 = r0
hello32:0286B5C0 STR             R3, [SP,#0x18+var_18]   ; var18 = r3
hello32:0286B5C2 MOVS            R0, #0
hello32:0286B5C4 STR             R0, [SP,#0x18+var_14]   ; var14 = 0
hello32:0286B5C6 MOVS            R0, #4
hello32:0286B5C8 STR             R0, [SP,#0x18+var_10]   ; var10 = 4
hello32:0286B5CA MOVS            R0, #8
hello32:0286B5CC STR             R0, [SP,#0x18+var_C]    ; varc = 8
hello32:0286B5CE LDR             R1, [SP,#0x18+var_14]   ; r1 is arg1 0
hello32:0286B5D0 LDR             R0, =(unk_286B485 - 0x286B5D6)
hello32:0286B5D2 ADD             R0, PC                  ; unk_286B485 ; r0 is arg0 is str
hello32:0286B5D4 BLX             unk_286B6D0             ; printf(r0, r1)
hello32:0286B5D8 LDR             R1, [SP,#0x18+var_10]
hello32:0286B5DA LDR             R0, =(unk_286B463 - 0x286B5E0)
hello32:0286B5DC ADD             R0, PC                  ; unk_286B463
hello32:0286B5DE BLX             unk_286B6D0
hello32:0286B5E2 LDR             R1, [SP,#0x18+var_C]
hello32:0286B5E4 LDR             R0, =(unk_286B3E5 - 0x286B5EA)
hello32:0286B5E6 ADD             R0, PC                  ; unk_286B3E5
hello32:0286B5E8 BLX             unk_286B6D0
hello32:0286B5EC LDR             R1, [SP,#0x18+var_18]   ; var18 = r3
hello32:0286B5EE LDR             R0, =(unk_286B435 - 0x286B5F4)
hello32:0286B5F0 ADD             R0, PC                  ; unk_286B435
hello32:0286B5F2 BLX             unk_286B6D0             ; printf(r0, r3)
hello32:0286B5F6 LDR             R1, [R7,#8]             ; stack var [r7+8]
hello32:0286B5F8 LDR             R0, =(unk_286B407 - 0x286B5FE)
hello32:0286B5FA ADD             R0, PC                  ; unk_286B407
hello32:0286B5FC BLX             unk_286B6D0             ; printf(r0, stack var[r7+8])
hello32:0286B600 ADD             SP, SP, #0x10
hello32:0286B602 POP             {R7,PC}
hello32:0286B602 ; End of function my_argIsStruct
```

## 相关重点


    Q: 为什么会将SP赋值给R7 ?

    A: R7会赋值为SP,后面基于R7(SP)进行寻址操作, 所以为什么local var都是负数偏移

    Q: LDR.W R12, [R7,#8] 又有什么意义?

    A: 目前并不清楚, 和友人一起确认就是废物代码

# ARM64调用约定

参数1~参数8 分别保存到 X0~X7 寄存器中 ，剩下的参数从右往左依次入栈，被调用者实现栈平衡，返回值存放在 X0 中。


[https://docs.microsoft.com/zh-cn/cpp/build/arm64-windows-abi-conventions?view=msvc-170](https://docs.microsoft.com/zh-cn/cpp/build/arm64-windows-abi-conventions?view=msvc-170)

[AArch64状态下的Canary机制](https://cataloc.gitee.io/blog/2021/04/24/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84Canary%E6%9C%BA%E5%88%B6/#AArch32%E7%8A%B6%E6%80%81%E4%B8%8B%E7%9A%84Canary%E6%9C%BA%E5%88%B6)

```c
int test9(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int stack1) {
    return a1 + a2 + a3 + a4 + a5 + a7 + a8 + stack1;
}

// ## arm learn 01
int main(int argc, char const *argv[]) {
    while (1) {
        //arm 64 args
        test9(1, 2, 3, 4, 5, 6, 7, 8, 9);
        sleep(5);
    }
    return 0;
}
```

```asm
hello:0000005C45037910 SUB             SP, SP, #0x30
hello:0000005C45037914 LDR             W8, [SP,#0x30+arg_0]    ; stack_var1 to r8
hello:0000005C45037918 STR             W0, [SP,#0x30+var_4]    ; r0 to var4
hello:0000005C4503791C STR             W1, [SP,#0x30+var_8]    ; r1 to var8
hello:0000005C45037920 STR             W2, [SP,#0x30+var_C]    ; r2 to varc
hello:0000005C45037924 STR             W3, [SP,#0x30+var_10]   ; r3 to var16
hello:0000005C45037928 STR             W4, [SP,#0x30+var_14]   ; r4 to var20
hello:0000005C4503792C STR             W5, [SP,#0x30+var_18]   ; r5 to var24
hello:0000005C45037930 STR             W6, [SP,#0x30+var_1C]   ; r6 to var28
hello:0000005C45037934 STR             W7, [SP,#0x30+var_20]   ; r7 to var32
hello:0000005C45037938 STR             W8, [SP,#0x30+var_24]   ; r8 = stack_var1 to var36
hello:0000005C4503793C LDR             W8, [SP,#0x30+var_4]    ; r8 = 1
hello:0000005C45037940 LDR             W9, [SP,#0x30+var_8]    ; r9 = 2
hello:0000005C45037944 ADD             W8, W8, W9
hello:0000005C45037948 LDR             W9, [SP,#0x30+var_C]
hello:0000005C4503794C ADD             W8, W8, W9
hello:0000005C45037950 LDR             W9, [SP,#0x30+var_10]
hello:0000005C45037954 ADD             W8, W8, W9
hello:0000005C45037958 LDR             W9, [SP,#0x30+var_14]
hello:0000005C4503795C ADD             W8, W8, W9
hello:0000005C45037960 LDR             W9, [SP,#0x30+var_1C]
hello:0000005C45037964 ADD             W8, W8, W9
hello:0000005C45037968 LDR             W9, [SP,#0x30+var_20]
hello:0000005C4503796C ADD             W8, W8, W9
hello:0000005C45037970 LDR             W9, [SP,#0x30+var_24]
hello:0000005C45037974 ADD             W0, W8, W9              ; ret var use w0
hello:0000005C45037978 ADD             SP, SP, #0x30
hello:0000005C4503797C RET
```

![20211202220612](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211202220612.png)

![20211202221224](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211202221224.png)

![20211202222442](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211202222442.png)

**我们通过堆栈数据的展示可以了解到堆栈是8字节对齐模式存储的** 

![20211202223118](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211202223118.png)

```c
void my_argIsStruct(TPoint3D a1, int a2, int a3) {    
    //结构体作为参数，会把其字段按顺序依次放入寄存器或者栈，相当于把结构体拆解为多个参数，按照ARM传递参数规则来传递
    a1.dx_0 = 0xb1;
    a1.dy_4 = 0xb2;
    a1.dz_8 = 0xb3;
    printf("filed1:%d\n", a1.dx_0);
    printf("filed2:%d\n", a1.dy_4);
    printf("filed2:%d\n", a1.dz_8);
    printf("a2:%d\n", a2);
    printf("a3:%d\n", a3);
}

int main() {
    ...
    TPoint3D a1={0xa1, 0xa2, 0xa3};
    my_argIsStruct(a1, 0xa4, 0xa5);
    ...
}
```

```asm
hello:00000056BBEAF810 ; =============== S U B R O U T I N E =======================================
hello:00000056BBEAF810
hello:00000056BBEAF810 ; Attributes: bp-based frame
hello:00000056BBEAF810
hello:00000056BBEAF810 my_argIsStruct
hello:00000056BBEAF810
hello:00000056BBEAF810 var_60= -0x60
hello:00000056BBEAF810 var_58= -0x58
hello:00000056BBEAF810 var_50= -0x50
hello:00000056BBEAF810 var_48= -0x48
hello:00000056BBEAF810 var_3C= -0x3C
hello:00000056BBEAF810 var_38= -0x38
hello:00000056BBEAF810 var_34= -0x34
hello:00000056BBEAF810 var_30= -0x30
hello:00000056BBEAF810 var_2C= -0x2C
hello:00000056BBEAF810 var_28= -0x28
hello:00000056BBEAF810 var_24= -0x24
hello:00000056BBEAF810 var_20= -0x20
hello:00000056BBEAF810 var_18= -0x18
hello:00000056BBEAF810 var_C= -0xC
hello:00000056BBEAF810 var_8= -8
hello:00000056BBEAF810 var_4= -4
hello:00000056BBEAF810 var_s0=  0
hello:00000056BBEAF810
hello:00000056BBEAF810 SUB             SP, SP, #0x70
hello:00000056BBEAF814 STP             X29, X30, [SP,#0x60+var_s0]                      ;save fp, lr
hello:00000056BBEAF818 ADD             X29, SP, #0x60                                   ;这句
hello:00000056BBEAF81C MOV             X8, #0xC                                         ;sizeof(TPoint3D)
hello:00000056BBEAF820 MOV             W9, #0xB1                                        ;to reg9
hello:00000056BBEAF824 MOV             W10, #0xB2                                       ;to reg10
hello:00000056BBEAF828 MOV             W11, #0xB3                                       ;to reg11
hello:00000056BBEAF82C ADRP            X12, #aFiled1D@PAGE     ; "filed1:%d\n"          ;to reg12 with pc rel
hello:00000056BBEAF830 ADD             X12, X12, #aFiled1D@PAGEOFF ; "filed1:%d\n"       
hello:00000056BBEAF834 ADRP            X13, #aFiled2D@PAGE     ; "filed2:%d\n"          ;to reg13 with pc rel
hello:00000056BBEAF838 ADD             X13, X13, #aFiled2D@PAGEOFF ; "filed2:%d\n"
hello:00000056BBEAF83C ADRP            X14, #aA2D@PAGE         ; "a2:%d\n"              ;to reg14 with pc rel
hello:00000056BBEAF840 ADD             X14, X14, #aA2D@PAGEOFF ; "a2:%d\n"
hello:00000056BBEAF844 ADRP            X15, #aA3D@PAGE         ; "a3:%d\n"              ;to reg15 with pc rel
hello:00000056BBEAF848 ADD             X15, X15, #aA3D@PAGEOFF ; "a3:%d\n"              
hello:00000056BBEAF84C SUB             X16, X29, #-var_C                                ;
hello:00000056BBEAF850 SUB             X17, X29, #-var_20
hello:00000056BBEAF854 STUR            X0, [X29,#var_20]                                ;                          stack_var_20 = x0 = 0XA10XA2
hello:00000056BBEAF858 STUR            X1, [X29,#var_18]                                ;                          stack_var_18 = x1 = 0XA3
hello:00000056BBEAF85C MOV             X0, X16                                          ;                          x0 = stack_var_C
hello:00000056BBEAF860 MOV             X1, X17                                          ;                          x1 = stack_var_20
hello:00000056BBEAF864 STUR            W2, [X29,#var_2C]                                ;                          stack_var_2c = w2 = 0XA4
hello:00000056BBEAF868 MOV             X2, X8                                           ;                          x2 = x8 = 12 = sizeof(TPoint3D) 
hello:00000056BBEAF86C STR             W3, [SP,#0x60+var_30]                            ;[r->s] w3 -> var30
hello:00000056BBEAF870 STR             W9, [SP,#0x60+var_34]                            ;[r->s] w9 -> var34
hello:00000056BBEAF874 STR             W10, [SP,#0x60+var_38]                           ;[r->s] w10-> var38
hello:00000056BBEAF878 STR             W11, [SP,#0x60+var_3C]                           ;[r->s] w11-> var3c
hello:00000056BBEAF87C STR             X12, [SP,#0x60+var_48]                           ;[r->s] w12-> var48
hello:00000056BBEAF880 STR             X13, [SP,#0x60+var_50]                           ;[r->s] w13-> var50
hello:00000056BBEAF884 STR             X14, [SP,#0x60+var_58]                           ;[r->s] w14-> var58
hello:00000056BBEAF888 STR             X15, [SP,#0x60+var_60]                           ;[r->s] w15-> var60
hello:00000056BBEAF88C BL              loc_56BBEAF6A0                                   ;                           memcpy
hello:00000056BBEAF890 LDUR            W9, [X29,#var_2C]
hello:00000056BBEAF894 STUR            W9, [X29,#var_24]
hello:00000056BBEAF898 LDR             W10, [SP,#0x60+var_30]
hello:00000056BBEAF89C STUR            W10, [X29,#var_28]
hello:00000056BBEAF8A0 LDR             W11, [SP,#0x60+var_34]
hello:00000056BBEAF8A4 STUR            W11, [X29,#var_C]
hello:00000056BBEAF8A8 LDR             W3, [SP,#0x60+var_38]
hello:00000056BBEAF8AC STUR            W3, [X29,#var_8]
hello:00000056BBEAF8B0 LDR             W4, [SP,#0x60+var_3C]
hello:00000056BBEAF8B4 STUR            W4, [X29,#var_4]
hello:00000056BBEAF8B8 LDUR            W1, [X29,#var_C]
hello:00000056BBEAF8BC LDR             X0, [SP,#0x60+var_48]
hello:00000056BBEAF8C0 BL              loc_56BBEAF680
hello:00000056BBEAF8C4 LDUR            W1, [X29,#var_8]
hello:00000056BBEAF8C8 LDR             X8, [SP,#0x60+var_50]
hello:00000056BBEAF8CC MOV             X0, X8
hello:00000056BBEAF8D0 BL              loc_56BBEAF680
hello:00000056BBEAF8D4 LDUR            W1, [X29,#var_4]
hello:00000056BBEAF8D8 LDR             X8, [SP,#0x60+var_50]
hello:00000056BBEAF8DC MOV             X0, X8
hello:00000056BBEAF8E0 BL              loc_56BBEAF680
hello:00000056BBEAF8E4 LDUR            W1, [X29,#var_24]
hello:00000056BBEAF8E8 LDR             X8, [SP,#0x60+var_58]
hello:00000056BBEAF8EC MOV             X0, X8
hello:00000056BBEAF8F0 BL              loc_56BBEAF680
hello:00000056BBEAF8F4 LDUR            W1, [X29,#var_28]
hello:00000056BBEAF8F8 LDR             X8, [SP,#0x60+var_60]
hello:00000056BBEAF8FC MOV             X0, X8
hello:00000056BBEAF900 BL              loc_56BBEAF680
hello:00000056BBEAF904 LDP             X29, X30, [SP,#0x60+var_s0]
hello:00000056BBEAF908 ADD             SP, SP, #0x70
hello:00000056BBEAF90C RET
hello:00000056BBEAF90C ; End of function my_argIsStruct
```

## 通过上面的汇编代码我们知道，loc_56BBEAF6A0是memcpy， 但是为什么会产生memcpy呢？

![20211205134956](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211205134956.png)

我最开始一直没搞明白，如果编译器只是把寄存器存储到栈，那么挨个赋值不就完事儿了么？类似于下面的2句，也就完成了结构体到堆栈的传输

```asm
hello:00000056BBEAF854 STUR            X0, [X29,#var_20]                                ;                          stack_var_20 = x0 = 0XA10XA2
hello:00000056BBEAF858 STUR            X1, [X29,#var_18]                                ;                          stack_var_18 = x1 = 0XA3
```


[https://www.cnblogs.com/sinferwu/p/12810595.html](https://www.cnblogs.com/sinferwu/p/12810595.html)
```

`arm/03.11stack.push_pop.md/readme.md`:

```md
# ARM堆栈向下增长
 
![20220118092731](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118092731.png)


# PUSH/POP

![20220118092847](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118092847.png)

    寄存器ID越大越先PUSH, 最后POP


![20220118093050](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118093050.png)



```

`arm/03.1brk/readme.md`:

```md
```c
int test22() {
}
```

```asm
test22():                             // @test22()
        brk     #0x1
```

![20211209153045](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211209153045.png)
```

`arm/03.2ldr_str.md/readme.md`:

```md
# CPU并不直接访问内存
![20220117001150](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117001150.png)

![20220117001245](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117001245.png)

    原因: 寄存器可以更快的进行访问

# 存取指令集

![20220117002417](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117002417.png)

## LDR

![20220117001540](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117001540.png)

## STR

![20220117002142](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117002142.png)


# 寻址模式

![20220117071214](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117071214.png)

## Pre-index

![20220117071415](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117071415.png)

## Post-index

![20220117071836](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117071836.png)

## Pre-index With update

![20220117072108](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117072108.png)


```

`arm/03.3add_sub_mul_div.md/readme.md`:

```md
# 算术运算

## 加法运算(寄存器寻址)

![20220117073248](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117073248.png)

## 加法运算(寄存器间接寻址)

![20220117073636](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117073636.png)

## 其他算术运算

![20220117074144](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117074144.png)

```

`arm/03.4and_orr_eor_orn_bic.md/readme.md`:

```md
# 逻辑运算


```

`arm/03.5lsl_lsr_asr_ror_rrx_mov_mvn.md/readme.md`:

```md
# 位操作

## 移位运算

![20220117074752](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117074752.png)

## 数据传输指令

![20220117075015](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117075015.png)


# 灵活的2nd操作数
 
![20220117075442](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117075442.png)

## Set a bit

    a |= (1 << 5)

![20220117075656](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117075656.png)

## Clear a bit
    a &= ~(1 << 5)

![20220117080042](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117080042.png)

## Toggling a bt

    a ^= 1<<5

![20220117080342](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117080342.png)
```

`arm/03.6nzcv.md/readme.md`:

```md
# NZCV

![20220117083401](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117083401.png)

    N: negative 算术逻辑运算单元运算结果为负1/正0
    Z: zero     算术逻辑运算单元运算结果为零1/非零0
    C: 3cases:
                    1             0
        加法      Carray      | Not Carray
        减法      Not Borrow  |   Borrow(Not Carray)
        移位      Bit Shifted |  Rotated Out
    V: 后面详细阐述
 
![20211208222116](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211208222116.png)


![20211206163627](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211206163627.png)


https://www.chegg.com/homework-help/questions-and-answers/values-nzcv-bits-arm-processor-following-computation-performed-assume-32-bit-data-type-sig-q10937775

# 更新NZCV

![20220117083722](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117083722.png)

## 示例程序

![20220117084438](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117084438.png)

![20220117084702](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117084702.png)


# 移位更新NZCV

![20220117084848](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117084848.png)

## 示例程序

![20220117085109](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117085109.png)

![20220117085206](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117085206.png)
```

`arm/03.7b_bl.md/readme.md`:

```md
# 任何算法可通过下面的三种模式组合而成

![20220117221804](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117221804.png)

## 条件跳转和无条件跳转

![20220117221926](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117221926.png)

## 条件命名规则

![20220117222322](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117222322.png)

## 关于比较的一些哲学问题

![20220117223351](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117223351.png)


## 汇编实现if else

![20220117224233](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117224233.png)

![20220117224703](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117224703.png)

## 汇编实现loop

![20220117224957](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117224957.png)

![20220117225036](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117225036.png)


```

`arm/03.8conditional_execution.eq_ne_ge_lt.md/readme.md`:

```md
# 条件执行

![20220117230125](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117230125.png)

# 条件执行加法

![20220117225638](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117225638.png)

## 条件执行可以实现简单的if, 但是不要更新状态寄存器

![20220117225830](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117225830.png)

## 多重||运算

![20220117225948](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117225948.png)

## 关于GE的解释

![20220117230537](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117230537.png)

![20220117230606](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220117230606.png)
```

`arm/03.9pc_sp_b_bl_bx.md/readme.md`:

```md
 # PC和LR寄存器

 ![20220118081922](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118081922.png)

 ## BL

 ![20220118082024](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118082024.png)

 ## BX LR

 ![20220118082141](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118082141.png)

 ## 示例程序

 ![20220118082314](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118082314.png)

## Cortex并不支持arm模式, LR末位是奇数

 ![20220118083659](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118083659.png)
```

`arm/03data_processing.md/readme.md`:

```md

前面我们已经知道了寄存器对应的作用, 通过下面的例子我们可以学习到以下指令, 这里重点关注数据处理相关指令

1. 数据处理指令: SUB/MOVS/CMP/ADD

2. 跳转指令: B/BLE/BX

3. 存取指令: STR/LDR


相关示例:

```c
long test2() {
    int a = 1, b =2;
    if(a > b) {
        return a;
    } 
    return b;
}
```

```asm
.text:0000060C ; int test2()
.text:0000060C                 EXPORT test2
.text:0000060C test2                                   ; CODE XREF: main+16↓p
.text:0000060C
.text:0000060C var_C           = -0xC
.text:0000060C var_8           = -8
.text:0000060C var_4           = -4
.text:0000060C
.text:0000060C                 SUB             SP, SP, #0xC
.text:0000060E                 MOVS            R0, #1  ; r0 = 1
.text:00000610                 STR             R0, [SP,#0xC+var_8] ; var_8 = r0 = 1
.text:00000612                 MOVS            R0, #2  ; r0 = 2
.text:00000614                 STR             R0, [SP,#0xC+var_C] ; var_c = r0 = 2
.text:00000616                 LDR             R0, [SP,#0xC+var_8] ; r0 = var_8 = 1
.text:00000618                 LDR             R1, [SP,#0xC+var_C] ; r1 = var_c = 2
.text:0000061A                 CMP             R0, R1  ; r0 != r1
.text:0000061C                 BLE             loc_626 ; nop
.text:0000061E                 B               loc_620 ; r0 = var_8 = 1
.text:00000620 ; ---------------------------------------------------------------------------
.text:00000620
.text:00000620 loc_620                                 ; CODE XREF: test2+12↑j
.text:00000620                 LDR             R0, [SP,#0xC+var_8] ; r0 = var_8 = 1
.text:00000622                 STR             R0, [SP,#0xC+var_4] ; var_4 = r0 = 1
.text:00000624                 B               loc_62C ; r0 = var_4 = 2
.text:00000626 ; ---------------------------------------------------------------------------
.text:00000626
.text:00000626 loc_626                                 ; CODE XREF: test2+10↑j
.text:00000626                 LDR             R0, [SP,#0xC+var_C] ; r0 = var_c = 2
.text:00000628                 STR             R0, [SP,#0xC+var_4] ; var_4 = r0 = 2
.text:0000062A                 B               loc_62C ; r0 = var_4 = 2
.text:0000062C ; ---------------------------------------------------------------------------
.text:0000062C ; 2:   return 2;
.text:0000062C
.text:0000062C loc_62C                                 ; CODE XREF: test2+18↑j
.text:0000062C                                         ; test2+1E↑j
.text:0000062C                 LDR             R0, [SP,#0xC+var_4] ; r0 = var_4 = 2
.text:0000062E                 ADD             SP, SP, #0xC ; destory local var
.text:00000630                 BX              LR      ; return
.text:00000630 ; End of function test2
```

关于数据操作指令有16个, 其中比较常用的指令已经标红处理:


![20211124153203](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211124153203.png)

4. MOV指令

```asm
## 16位立即数

MOV #0x1234

## 可循环移位立即数

MOV #0x80000000

## 32位立即数

MOV #0x5678
MOVT #0x1234
```

5. 编译器如何访问立即数


```

`arm/04msr_mrs.md/readme.md`:

```md

# 程序状态寄存器访问指令


![20211125094433](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211125094433.png)

## 关于MRS

1. 用户模式读取状态寄存器T flag is awalys 0

对应原因:

    ·T标志位：该位反映处理器的运行状态。当该位为1时，程序运行于THUMB状态，否则运行于ARM状态。该信号反映在外部引脚TBIT上。在程序中不得修改CPSR中的TBIT位，否则处理器工作状态不能确定。

2. 特权模式CPSR的低8位（包括I、F、T和M[4：0]）称为控制位，当发生异常时这些位可以被改变。如果处理器运行于特权模式时，这些位也可以由程序修改。

```c
void test3() {
    asm volatile(
        "MRS r0, CPSR\n"
        // "MRS r15, CPSR\n"   // rx 不允许是r15
        // "MRS r0, SPSR\n"    // 用户模式会触发异常
        "MRS CPSR_n, #1\n"

        "MRS R0,CPSR\n"          // Read CPSR, T Flag is awalys 0

                                 // >>> CPSR bin(0x80070030)
                                 //     '0b10000000000001110000000000110000'
                                 // >>> R0 bin(0x80070010)           t
                                 //     '0b10000000000001110000000000010000'

        "BIC R0,R0,#0x1F\n"      // modify by removing current mode
                                 // >>> R0 bin(0x80070000)
                                 //     '0b10000000000001110000000000000000'
        
        "MOV R0,#0x20000000\n"   // and substituting Supervisor mode
        "MSR CPSR_f,R0\n"        // Write the result back to CPSR        
        "nop\n");
}
```

## 关于MSR

1. Fields

![20211125161358](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211125161358.png)

对应赋值对位域有影响.

2. Immediate

8bit: range 0x00-0xff

### 不同模式权限不一样

![20211125162615](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211125162615.png)

用户模式读取SPSR, 会造成异常

![20211124170010](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211124170010.png)
```

`arm/05div.md/readme.md`:

```md
今天有小伙伴遇到了关于有符号数除的2的N次幂使用移位运算加速的理解问题,这里做一下对应记录.

# 遇到的问题

![20211129173426](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129173426.png)

# 除法的实现

早期计算机并没有设计专门的除法电路, 也就没有专门的指令. 数学家们总是可以找到高效的除法计算方法

于是就有了借助移位运算进行高效除法计算的理论基础以及对应的实现.

![20211129172021](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129172021.png)

## 无符号除2的幂示例代码

```c
unsigned int test5(unsigned int a1)
{
  // 无符号int除以2的倍数
  // LSRS            R1, R0, #12
  return a1 / 4096;
}
```

```asm
hello32:0D8AD4BE test5
hello32:0D8AD4BE
hello32:0D8AD4BE var_4= -4
hello32:0D8AD4BE
hello32:0D8AD4BE SUB             SP, SP, #4
hello32:0D8AD4C0 STR             R0, [SP,#4+var_4]       ; var_4 = r0 = 0x55
hello32:0D8AD4C2 LDR             R0, [SP,#4+var_4]       ; r0 = var_4 = 0x55
hello32:0D8AD4C4 LSRS            R0, R0, #0xC            ; lsrs is thumb provides the unsigned value of a register divided by a variable power of two. r0 = 0x55 >> 0xc = 0
hello32:0D8AD4C6 ADD             SP, SP, #4
hello32:0D8AD4C8 BX              LR
hello32:0D8AD4C8 ; End of function test5
```

### 重要研究LSR指令


![20211129100432](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129100432.png)

    实例中的lsrs采用的是上面这种情况. r0 = r0(0x55) >> 0xc = 0

![20211129100451](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129100451.png)

### ARM64位对应指令UDIV

```asm
; arm64 code
.text:00000000000007A4 ; unsigned int __cdecl test5(unsigned int a1)
.text:00000000000007A4                 EXPORT test5
.text:00000000000007A4 test5                                   ; CODE XREF: main+54↓p
.text:00000000000007A4
.text:00000000000007A4 var_4           = -4
.text:00000000000007A4 a1              =  0xC
.text:00000000000007A4
.text:00000000000007A4 ; __unwind {
.text:00000000000007A4                 SUB             SP, SP, #0x10
.text:00000000000007A8                 MOV             W8, #0x1000 ; w8 is tmp var
.text:00000000000007AC                 STR             W0, [SP,#0x10+var_4] ; var_4 = 0x55
.text:00000000000007B0                 LDR             W0, [SP,#0x10+var_4] ; w8 = var_4 = 0x55
.text:00000000000007B4                 UDIV            W0, W0, W8 ; Unsigned Divide; https://developer.arm.com/documentation/dui0801/g/A32-and-T32-Instructions/UDIV
.text:00000000000007B8                 ADD             SP, SP, #0x10
.text:00000000000007BC                 RET
.text:00000000000007BC ; } // starts at 7A4
.text:00000000000007BC ; End of function test5
```


## 有符号除2的N次幂示例代码2
```c
int test6(signed int a1)
{
  // 有符号int除以2的倍数
  // ASRS            R1, R0, #31       //R0为要操作的数，如果R0为正，R1恒为0；如果R0为负，R1恒为-1；
  // ADD.W           R0, R0, R1,LSR#20 //R0为要操作的数，R0+=R1逻辑右移一定位数，具体位数等于32-幂
  // ASRS            R0, R0, #12       //R0为要操作的数，R0算数右移一定位数，具体位数等于幂
  return a1 / 4096;
}
```
```asm
hello32:01DCD4BE test6
hello32:01DCD4BE
hello32:01DCD4BE var_4= -4
hello32:01DCD4BE
hello32:01DCD4BE SUB             SP, SP, #4
hello32:01DCD4C0 STR             R0, [SP,#4+var_4]       ; var_4 = r0 = 0x55
hello32:01DCD4C2 LDR             R0, [SP,#4+var_4]       ; r0 = var_4 = 0x55
hello32:01DCD4C4 ASRS            R1, R0, #0x1F           ; r1 = r0(0x55) >> 0x1f = 0 ; 提取符号位
hello32:01DCD4C6 ADD.W           R0, R0, R1,LSR#20       ; r0 = r0 + r1 >> 20; r0 = 0x55
hello32:01DCD4CA ASRS            R0, R0, #0xC            ; r0 = r0 >> 0xc = 0
hello32:01DCD4CC ADD             SP, SP, #4
hello32:01DCD4CE BX              LR
hello32:01DCD4CE ; End of function test6
```

![20211129103915](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129103915.png)

    示例程序使用上面的指令, 采用算术右移进行除法运算

![20211129104019](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129104019.png)

    Q: 为什么会有R1 = R0 >> 0x1f(31)呢?
    A: usigned 32 is 32bit, the 32bit is flag. 

### 背后的原理

通过脑图我们已经知道有符号除2^N运算的公式是, 至于为什么数学家已经论证了见help link

    (x + (1<<N) - 1) >> N


    示例代码中N = 12 (0xc)


    ASRS R1, R0, #0x1F;

    ADD.W R0, R0, R1, LSR#20; 1 << N - 1 等价于 -1 >> (32 - N)

                            ; 1 << 12 -1 等价于 -1 >> 20


下面是两种指令得到的结果可以看到r0和r1是相等, 至于为什么使用 -1 >> (32-N)呢? 我们看一下指令的条数就知道了, 编译器并不想浪费任何一条指令.

![20211129171348](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129171348.png)

![20211129171520](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211129171520.png)


## help link

参考书籍 <<深入理解计算机系统>>





```

`arm/07condition.md/readme.md`:

```md
# ARM条件执行

![20211201203121](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211201203121.png)

注意对应的名词解释

![20211201182224](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211201182224.png)


# 20bit S标记位

对应列为奇数进行标志位更新，对应列为偶数不进行标志位更新


??事例程序待补充

# SUBS SUB CMP/ADDS ADD CMN


```

`arm/08canary.md/readme.md`:

```md


![20211205233422](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211205233422.png)


# 一条奇怪的指令

前段时间在做Arm64结构体传参时，看到一个奇怪的指令MRS X23, #3, c13, c0, #2，这其实是AArch64状态下对于Canary机制的实现。本篇介绍Canary机制与其中的一些特征。

# 什么是Canary机制

Canary 的意思是金丝雀，来源于英国矿井工人用来探查井下气体是否有毒的金丝雀笼子。工人们每次下井都会带上一只金丝雀。如果井下的气体有毒，金丝雀由于对毒性敏感就会停止鸣叫甚至死亡，从而使工人们得到预警。

Canary机制是一种栈保护机制，**在函数开始执行的时候，会先在栈底插入cookie信息，在函数真正返回的时候，会验证cookie的值是否合法（栈帧销毁前测试该值是否被改变)，如果不合法就停止程序运行 (防止栈溢出发生)。这个cookie信息也被称为Canary**。由于Canary机制的实现简单高效，它被普遍用于Linux系统上预防栈溢出的第一道防线。而Android基于Linux微内核，因而也采用这一机制对栈溢出进行检验。本篇主要介绍Canary机制的特征码，其它知识点不再展开。


# AArch64状态下的Canary机制

因为我是在Arm64上面遇到了对应的问题， Arm32应该也有类似的机制，这里并不讨论，后期遇到了再进行添加。 

![20211205234657](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211205234657.png)

我通过./ghidra和ida进行查看，发现他们翻译成了不同的指令，显然ghida给我了我们搜索到线索，X8, #3, c13, c0, #2代表的意思是“**以读写权限访问非调试系统寄存器TPIDR_EL0，并将其中的值保存到X8寄存器中**”


# 什么是TPIDR_EL0

这回，弄明白了上面的指令的作用后，又有了新的问题，这个TPIDR_EL0寄存器是干什么的？为什么要取它保存的值？文章中对TPIDR_EL0的描述是，软件运行在EL0级别下，可被读写的线程ID寄存器。换句话说，软件在EL0运行级别下，这个寄存器可以存储线程身份信息以便于管理，其作用相当于TLS（Thread Local Storage）。

![20211205235004](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211205235004.png)

# 相关示例程序以及对应的流程信息

下面的一个示例程序会导致堆栈溢出，引发堆栈保护， 详细的跟踪记录，见最上面的事例图便可以了解对应的工作原理了。

```c
int test11() {
    int a = 0xa1;
    int b = 0xa2;
    //tigger stack overflow
    int *c = &a;
    c[0] = 0xb0;
    c[1] = 0xb1;
    c[2] = 0xb2;
    c[3] = 0xb3;
    c[4] = 0xb4;
    c[5] = 0xb5;
    c[6] = 0xb6;
    c[7] = 0xb7;
    return a;
}
```


```asm
hello:0000005FA6FDFB54 test11
hello:0000005FA6FDFB54
hello:0000005FA6FDFB54 var_90= -0x90
hello:0000005FA6FDFB54 var_88= -0x88
hello:0000005FA6FDFB54 var_80= -0x80
hello:0000005FA6FDFB54 var_78= -0x78
hello:0000005FA6FDFB54 var_70= -0x70
hello:0000005FA6FDFB54 var_68= -0x68
hello:0000005FA6FDFB54 var_60= -0x60
hello:0000005FA6FDFB54 var_30= -0x30
hello:0000005FA6FDFB54 var_28= -0x28
hello:0000005FA6FDFB54 var_1C= -0x1C
hello:0000005FA6FDFB54 var_18= -0x18
hello:0000005FA6FDFB54 var_10= -0x10
hello:0000005FA6FDFB54 var_8= -8
hello:0000005FA6FDFB54 var_s0=  0
hello:0000005FA6FDFB54
hello:0000005FA6FDFB54 SUB             SP, SP, #0x30           ; CODE XREF: test11+1B0↓p
hello:0000005FA6FDFB58 STP             X29, X30, [SP,#0x20+var_s0]
hello:0000005FA6FDFB5C ADD             X29, SP, #0x20
hello:0000005FA6FDFB60 MRS             X8, #3, c13, c0, #2
hello:0000005FA6FDFB64 LDR             X9, [X8,#0x28]
hello:0000005FA6FDFB68 STUR            X9, [X29,#var_8]
hello:0000005FA6FDFB6C MOV             W10, #0xA1
hello:0000005FA6FDFB70 STUR            W10, [X29,#var_10+4]
hello:0000005FA6FDFB74 MOV             W10, #0xA2
hello:0000005FA6FDFB78 STR             W10, [SP,#0x20+var_10]
hello:0000005FA6FDFB7C SUB             X9, X29, #-(var_10+4)
hello:0000005FA6FDFB80 STR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFB84 LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFB88 MOV             W10, #0xB0
hello:0000005FA6FDFB8C STR             W10, [X9]
hello:0000005FA6FDFB90 LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFB94 MOV             W10, #0xB1
hello:0000005FA6FDFB98 STR             W10, [X9,#4]
hello:0000005FA6FDFB9C LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFBA0 MOV             W10, #0xB2
hello:0000005FA6FDFBA4 STR             W10, [X9,#8]
hello:0000005FA6FDFBA8 LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFBAC MOV             W10, #0xB3
hello:0000005FA6FDFBB0 STR             W10, [X9,#0xC]
hello:0000005FA6FDFBB4 LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFBB8 MOV             W10, #0xB4
hello:0000005FA6FDFBBC STR             W10, [X9,#0x10]
hello:0000005FA6FDFBC0 LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFBC4 MOV             W10, #0xB5
hello:0000005FA6FDFBC8 STR             W10, [X9,#0x14]
hello:0000005FA6FDFBCC LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFBD0 MOV             W10, #0xB6
hello:0000005FA6FDFBD4 STR             W10, [X9,#0x18]
hello:0000005FA6FDFBD8 LDR             X9, [SP,#0x20+var_18]
hello:0000005FA6FDFBDC MOV             W10, #0xB7
hello:0000005FA6FDFBE0 STR             W10, [X9,#0x1C]
hello:0000005FA6FDFBE4 LDUR            W10, [X29,#var_10+4]
hello:0000005FA6FDFBE8 LDR             X8, [X8,#0x28]
hello:0000005FA6FDFBEC LDUR            X9, [X29,#var_8]
hello:0000005FA6FDFBF0 SUBS            X8, X8, X9
hello:0000005FA6FDFBF4 STR             W10, [SP,#0x20+var_1C]
hello:0000005FA6FDFBF8 B.NE            loc_5FA6FDFC10
hello:0000005FA6FDFBFC B               loc_5FA6FDFC00
hello:0000005FA6FDFC00 ; ---------------------------------------------------------------------------
hello:0000005FA6FDFC00
hello:0000005FA6FDFC00 loc_5FA6FDFC00                          ; CODE XREF: test11+A8↑j
hello:0000005FA6FDFC00 LDR             W0, [SP,#0x20+var_1C]
hello:0000005FA6FDFC04 LDP             X29, X30, [SP,#0x20+var_s0]
hello:0000005FA6FDFC08 ADD             SP, SP, #0x30
hello:0000005FA6FDFC0C RET
hello:0000005FA6FDFC10 ; ---------------------------------------------------------------------------
hello:0000005FA6FDFC10
hello:0000005FA6FDFC10 loc_5FA6FDFC10                          ; CODE XREF: test11+A4↑j
hello:0000005FA6FDFC10 BL              unk_5FA6FDF6E0
```


```asm
0000007FE6B805D0  00000005000000B3  
0000007FE6B805D8  000000A2000000A1  
0000007FE6B805E0  00000000000000A3  
0000007FE6B805E8  95E90E95548E982B  
0000007FE6B805F0  0000007FE6B80660  [stack]:0000007FE6B80660
0000007FE6B805F8  0000005CB3ACAD08  test11+1B4
0000007FE6B80600  0000005C00000009  
```

```asm
0000007FE6B805D0  00000005000000B3  
0000007FE6B805D8  0000007FE6B805E4  [stack]:0000007FE6B805E4  == &a
0000007FE6B805E0  000000A1000000A2  
0000007FE6B805E8  95E90E95548E982B  
0000007FE6B805F0  0000007FE6B80660  [stack]:0000007FE6B80660
0000007FE6B805F8  0000005CB3ACAD08  test11+1B4
0000007FE6B80600  0000005C00000009  
```


# help link

[https://blog.iret.xyz/article.aspx/thread_pointer_aarch64](https://blog.iret.xyz/article.aspx/thread_pointer_aarch64)

[Android逆向中的Canary机制](https://cataloc.gitee.io/blog/2021/04/24/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84Canary%E6%9C%BA%E5%88%B6/#AArch32%E7%8A%B6%E6%80%81%E4%B8%8B%E7%9A%84Canary%E6%9C%BA%E5%88%B6)

[https://www.cnblogs.com/leo0000/p/5719186.html](https://www.cnblogs.com/leo0000/p/5719186.html)

[https://www.keil.com/support/man/docs/armclang_ref/armclang_ref_cjh1548250046139.htm](https://www.keil.com/support/man/docs/armclang_ref/armclang_ref_cjh1548250046139.htm)

[https://www.cnblogs.com/gt-xy/p/7749725.html](https://www.cnblogs.com/gt-xy/p/7749725.html)
```

`arm/09if_switch.md/readme.md`:

```md

![20211206175821](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211206175821.png)

# if/switch汇编实现原理

研究if/switch语句必然少不了对应的条件判断, 以及对应的条件跳转.

![20211207105140](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211207105140.png)

# 再次熟悉一下CMP指令

在Arm64位下, 硬件并没有实现对应的CMP指令, Compare, like SUBS but without destination register. 

![20211206171643](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211206171643.png)

CMP指令被分为了3个大类:

![20211206143310](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211206143310.png)

# 再次熟悉一下NZCV标志位

![20211206144733](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211206144733.png)

请注意:

    ALU subtraction no borrow为1, borrow为0
      
    ALU addition Carry out为1, no carried out为0

# 熟悉CSET(C is Conditional not Carry)

![cset2](https://cdn.jsdelivr.net/gh/nzcv/picgo/cset2.png)


# 熟悉TBNZ(Test bit and Branch if Nonzero)

![tbnz](https://cdn.jsdelivr.net/gh/nzcv/picgo/tbnz.png)

# 示例程序

```c
int test12(int n) {    
    int ret = 0xa0;
    if (n == 1) {
        ret = 0xa1;
    } else if (n == 2) {
        ret = 0xa2;
    } else if (n == 3) {
        ret = 0xa3;
    } else if (n == 4) {
        ret = 0xa4;
    } else if (n == 5) {
        ret = 0xa5;
    }
    return ret;
}

int test13(int n) {
    int ret = 0xa0;
    switch (n) {
        case 1:
            ret = 0xa1;
            break;
        case 2:
            ret = 0xa2;
            break;
        case 3:
            ret = 0xa3;
            break;
        case 4:
            ret = 0xa4;
            break;
        case 5:
            ret = 0xa5;
            break;
        default:
            ret = 0xa6;
            break;
    }
    return ret;
}
```

有了上面的基础,我们就能够理解下面的核心代码

```asm
.text:0000000000000968                 SUB             SP, SP, #0x10
.text:000000000000096C                 MOV             W8, #1                   ;w8 临时变量
.text:0000000000000970                 STR             W0, [SP,#0x10+var_8]     ;var8 = w0
.text:0000000000000974                 LDR             W0, [SP,#0x10+var_8]     ;
.text:0000000000000978                 CMP             W0, W8                   ;NZCV0010
.text:000000000000097C                 CSET            W8, EQ                   ;W8 = Z = 0
.text:0000000000000980                 TBNZ            W8, #0, loc_988          ;NZ
.text:0000000000000984                 B               loc_994
.text:0000000000000988 ; ---------------------------------------------------------------------------
.text:0000000000000988
.text:0000000000000988 loc_988                                 ; CODE XREF: test12+18↑j
.text:0000000000000988                 MOV             W8, #0xA1
.text:000000000000098C                 STR             W8, [SP,#0x10+var_4]
.text:0000000000000990                 B               loc_A2C
```
![20211206225053](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211206225053.png)


# 关于Switch

1. 假设 switch 内分支比较多的时候，在编译的时候会生成一个表（跳转表每个地址四个字节）；

2. 假设 switch 内分支比较少的时候（例如3，少于4的时候没有意义），就没有必要使用此结构，相当于if...else语句的结构；

3. 假设 switch 内各个分支常量的差值较大的时候，编译器会在效率还是内存之间进行取舍，如果效率优先的情况下，这个时候编译器还是会编译成类似于if..else的结构。


```shell
注意: 这里只在godbolt进行了复现, 在ndk-23上面并没有得到相同结果
```

[https://godbolt.org/z/M3YTjxMr9](https://godbolt.org/z/M3YTjxMr9)

[https://www.jianshu.com/p/7e1eb1d72c83](https://www.jianshu.com/p/7e1eb1d72c83)

```

`arm/11for_while.md/readme.md`:

```md
# For循环的实现没什么特别的

![20211207215744](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211207215744.png)

指令都学过了, 简单看看就好

```c
int test15() {
    int ret = 0;
    for(int i=0; i < 100; i ++) {
        ret += i;
    }
    return ret;
}
```

```asm
.text:0000000000000CC0 ; int __cdecl test15()
.text:0000000000000CC0                 EXPORT test15
.text:0000000000000CC0 test15                                  ; CODE XREF: main+12C↓p
.text:0000000000000CC0
.text:0000000000000CC0 var_8           = -8
.text:0000000000000CC0 var_4           = -4
.text:0000000000000CC0 i               =  8
.text:0000000000000CC0 ret             =  0xC
.text:0000000000000CC0
.text:0000000000000CC0 ; __unwind {
.text:0000000000000CC0                 SUB             SP, SP, #0x10
.text:0000000000000CC4                 STR             WZR, [SP,#0x10+var_4]
.text:0000000000000CC8                 STR             WZR, [SP,#0x10+var_8]
.text:0000000000000CCC
.text:0000000000000CCC loc_CCC                                 ; CODE XREF: test15+40↓j
.text:0000000000000CCC                 MOV             W8, #0x64
.text:0000000000000CD0                 LDR             W9, [SP,#0x10+var_8]
.text:0000000000000CD4                 CMP             W9, W8
.text:0000000000000CD8                 CSET            W8, LT
.text:0000000000000CDC                 TBNZ            W8, #0, loc_CE4
.text:0000000000000CE0                 B               loc_D04
.text:0000000000000CE4 ; ---------------------------------------------------------------------------
.text:0000000000000CE4
.text:0000000000000CE4 loc_CE4                                 ; CODE XREF: test15+1C↑j
.text:0000000000000CE4                 LDR             W8, [SP,#0x10+var_8]
.text:0000000000000CE8                 LDR             W9, [SP,#0x10+var_4]
.text:0000000000000CEC                 ADD             W8, W9, W8
.text:0000000000000CF0                 STR             W8, [SP,#0x10+var_4]
.text:0000000000000CF4                 LDR             W8, [SP,#0x10+var_8]
.text:0000000000000CF8                 ADD             W8, W8, #1
.text:0000000000000CFC                 STR             W8, [SP,#0x10+var_8]
.text:0000000000000D00                 B               loc_CCC
.text:0000000000000D04 ; ---------------------------------------------------------------------------
.text:0000000000000D04
.text:0000000000000D04 loc_D04                                 ; CODE XREF: test15+20↑j
.text:0000000000000D04                 LDR             W0, [SP,#0x10+var_4]
.text:0000000000000D08                 ADD             SP, SP, #0x10
.text:0000000000000D0C                 RET
.text:0000000000000D0C ; } // starts at CC0
```

# 关于do While循环


```c
int test16() {
    int ret = 0;
    int i = 0;
    while (i < 100)
    {
        ret += i;
        i++;
    }    
    return ret;
}
```

```asm
.text:0000000000000D84                 EXPORT test16
.text:0000000000000D84 test16                                  ; CODE XREF: main+B8↓p
.text:0000000000000D84
.text:0000000000000D84 var_8           = -8
.text:0000000000000D84 var_4           = -4
.text:0000000000000D84
.text:0000000000000D84 ; __unwind {
.text:0000000000000D84                 SUB             SP, SP, #0x10
.text:0000000000000D88                 STR             WZR, [SP,#0x10+var_4]                                    ;var4 = 0
.text:0000000000000D8C                 STR             WZR, [SP,#0x10+var_8]                                    ;var8 = 0
.text:0000000000000D90
.text:0000000000000D90 loc_D90                                 ; CODE XREF: test16+34↓j
.text:0000000000000D90                 LDR             W8, [SP,#0x10+var_8]                                     ;w8 = var8 = 0
.text:0000000000000D94                 SUBS            W8, W8, #0x64                                            ;w8 = w8 - 100 = -100
.text:0000000000000D98                 B.GE            loc_DBC                                                  ;if w8 >= 0 break
.text:0000000000000D9C                 LDR             W9, [SP,#0x10+var_8]                                     ;w9 = var8 = 0
.text:0000000000000DA0                 LDR             W8, [SP,#0x10+var_4]                                     ;w8 = var4 = 0
.text:0000000000000DA4                 ADD             W8, W8, W9                                               ;w8 = w8 + w9 = 0
.text:0000000000000DA8                 STR             W8, [SP,#0x10+var_4]                                     ;var4 = 0
.text:0000000000000DAC                 LDR             W8, [SP,#0x10+var_8]                                     ;w8 = var8 = 0
.text:0000000000000DB0                 ADD             W8, W8, #1                                               ;w8 += 1
.text:0000000000000DB4                 STR             W8, [SP,#0x10+var_8]                                     ;var8 = w8 = 1
.text:0000000000000DB8                 B               loc_D90                                                  ;loop
.text:0000000000000DBC ; ---------------------------------------------------------------------------
.text:0000000000000DBC
.text:0000000000000DBC loc_DBC                                 ; CODE XREF: test16+14↑j
.text:0000000000000DBC                 LDR             W0, [SP,#0x10+var_4]
.text:0000000000000DC0                 ADD             SP, SP, #0x10
.text:0000000000000DC4                 RET
.text:0000000000000DC4 ; } // starts at D84
```

```c
int test17() {
    int ret = 0;
    int i = 0;
    do
    {
        ret += i;
        i++;
    } while(i < 100);
    return ret;
}
```

```asm
.text:0000000000000D60 ; int __cdecl test17()
.text:0000000000000D60                 EXPORT test17
.text:0000000000000D60 test17                                  ; CODE XREF: main+134↓p
.text:0000000000000D60
.text:0000000000000D60 var_8           = -8
.text:0000000000000D60 var_4           = -4
.text:0000000000000D60 i               =  8
.text:0000000000000D60 ret             =  0xC
.text:0000000000000D60
.text:0000000000000D60 ; __unwind {
.text:0000000000000D60                 SUB             SP, SP, #0x10
.text:0000000000000D64                 STR             WZR, [SP,#0x10+var_4]        ;var4 = 0
.text:0000000000000D68                 STR             WZR, [SP,#0x10+var_8]        ;var8 = 0
.text:0000000000000D6C
.text:0000000000000D6C loc_D6C                                 ; CODE XREF: test17+38↓j 
.text:0000000000000D6C                 LDR             W8, [SP,#0x10+var_8]         ;w8 = var8 = 0
.text:0000000000000D70                 LDR             W9, [SP,#0x10+var_4]         ;w9 = var4 = 0
.text:0000000000000D74                 ADD             W8, W9, W8                   ;w8 = w8 + w9 = 0
.text:0000000000000D78                 STR             W8, [SP,#0x10+var_4]         ;var4 = w8 = 0
.text:0000000000000D7C                 LDR             W8, [SP,#0x10+var_8]         ;w8 = var8 = 0
.text:0000000000000D80                 ADD             W8, W8, #1                   ;w8 = w8 + 1 = 1
.text:0000000000000D84                 STR             W8, [SP,#0x10+var_8]         ;var8 = w8 = 1
.text:0000000000000D88                 MOV             W8, #0x64                    ;w8 = 100
.text:0000000000000D8C                 LDR             W9, [SP,#0x10+var_8]         ;w9 = var8 = 1
.text:0000000000000D90                 CMP             W9, W8                       ;w9 < w8
.text:0000000000000D94                 CSET            W8, LT                       ;w8 = 1
.text:0000000000000D98                 TBNZ            W8, #0, loc_D6C              ;jump if w8 == 9
.text:0000000000000D9C                 LDR             W0, [SP,#0x10+var_4]         ;
.text:0000000000000DA0                 ADD             SP, SP, #0x10
.text:0000000000000DA4                 RET
.text:0000000000000DA4 ; } // starts at D60
```
```

`arm/12stack_aligin.md/readme.md`:

```md
# 栈的对齐

ARM64里面 对栈的操作是16字节对齐的, 也就是一次开辟栈空间至少是16字节, 或者是16的倍数, 如果不是这个值会报错

## 通过汇编我们来简单理解下什么是16字节对齐

```c
void test10_2() {
    uint8_t a;
}
```

```asm
.text:0000000000000A38 ; void __cdecl test10_2()
.text:0000000000000A38                 EXPORT test10_2
.text:0000000000000A38 test10_2                                ; CODE XREF: main+14C↓p
.text:0000000000000A38
.text:0000000000000A38 a               =  0xF
.text:0000000000000A38
.text:0000000000000A38 ; __unwind {
.text:0000000000000A38                 SUB             SP, SP, #16
.text:0000000000000A3C                 ADD             SP, SP, #16
.text:0000000000000A40                 RET
.text:0000000000000A40 ; } // starts at A38
```

## SP一次最少拉伸16个字节

```asm
.text                           ;代码段
.global _A,_B                   ;定义两个全局函数 A和B

_A:
	mov x0 ,#0xaaaa             ;arm汇编中数据用#开头
	str x30,[sp,#-0x10]!        ;在调用下一个函数之前临时保存lr寄存器中的地址, lr保存bl _A的下一条指令地址
	bl _B
	mov x0,#0xcccc
	ldr x30,[sp],#0x10          ;lr恢复
	ret                         ;返回到bl指令所对应的下一条指令

_B:
	add x0, x0,#0x10
	ret
```

[https://juejin.cn/post/7022413524034912269](https://juejin.cn/post/7022413524034912269)
```

`arm/13array.md/readme.md`:

```md

![20211208170055](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211208170055.png)

# memset进行初始化, 然后进行单个初始化

```c
int test18() {
    // a[0] = 0x55 , other is 0, use memset
    char a[100] = {0x55};
}
```

```asm
.text:0000000000000E40 ; int __cdecl test18()
.text:0000000000000E40                 EXPORT test18
.text:0000000000000E40 test18                                  ; CODE XREF: main+190↓p
.text:0000000000000E40
.text:0000000000000E40 var_78          = -0x78
.text:0000000000000E40 var_74          = -0x74
.text:0000000000000E40 var_10          = -0x10
.text:0000000000000E40 a               =  0xC
.text:0000000000000E40
.text:0000000000000E40 ; __unwind {
.text:0000000000000E40                 SUB             SP, SP, #0x80
.text:0000000000000E44                 STR             X30, [SP,#0x80+var_10]
.text:0000000000000E48                 MOV             X2, #0x64
.text:0000000000000E4C                 MOV             W8, #0x55
.text:0000000000000E50                 ADD             X0, SP, #0x80+var_74
.text:0000000000000E54                 MOV             W1, #0
.text:0000000000000E58                 STR             W8, [SP,#0x80+var_78]
.text:0000000000000E5C                 BL              .memset
.text:0000000000000E60                 LDR             W8, [SP,#0x80+var_78]
.text:0000000000000E64                 STRB            W8, [SP,#0x80+var_74]
.text:0000000000000E68                 BRK             #1
.text:0000000000000E68 ; } // starts at E40
```

# memcpy直接进行拷贝初始化

```c
//## array
int test18() {
    // 一直都是使用memcpy
    char a[16] = {0x55};
    char a[10] = {0xa1, 0xa2, 0xa3, 0xa4};
}
```

```asm
hello:000000583B9EDE40 SUB             SP, SP, #0x20           ; CODE XREF: test18+1B0↓p
hello:000000583B9EDE44 STR             X30, [SP,#0x20+var_10]
hello:000000583B9EDE48 ADRP            X1, #unk_583B9EE090@PAGE
hello:000000583B9EDE4C ADD             X1, X1, #unk_583B9EE090@PAGEOFF
hello:000000583B9EDE50 MOV             X2, #0x10
hello:000000583B9EDE54 MOV             X0, SP
hello:000000583B9EDE58 BL              unk_583B9ED6E0
hello:000000583B9EDE5C BRK             #1
```

![20211208165742](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211208165742.png)


# 汇编特征

等宽连续
```

`arm/14struct.md/readme.md`:

```md

# 结构体字节对齐

```c
typedef struct {
    int a;
    char b; //字节对齐, 占用4个字节
} klass;


int test20() {
    klass k = {0};
}
```

![struct01](https://cdn.jsdelivr.net/gh/nzcv/picgo/struct01.png)


## 关于数组当参数对应sizeof

![struct03_sizeof](https://cdn.jsdelivr.net/gh/nzcv/picgo/struct03_sizeof.png)
```

`arm/15pointer.md/readme.md`:

```md
# 指针的本质

对编译器而言, 指针仅仅就是一种类型

![20211212192549](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211212192549.png)


## 声明/赋值/Sizeof

![20211209163004](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211209163004.png)

Arm64 带*号就是8个字节

## 自增++/--

![20211209163657](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211209163657.png)

    ++/-- 等价于 +=1/-=1

    对应数值为去掉一个*,对应的宽度

## 加减运算+/-

![pointer01](https://cdn.jsdelivr.net/gh/nzcv/picgo/pointer01.png)


总结：

1、带*类型的变量可以加、减一个整数，但不能乘或者除；

2、带*类型变量与其他整数相加或者相减时：

    带*类型变量 + N = 带*类型变量 + N*(去掉一个*后类型的宽度)；
    
    带*类型变量 - N = 带*类型变量 - N*(去掉一个*后类型的宽度)。

## 指针相减

    带*类型变量1 - 带*类型变量2  = (v(带*类型变量1) - v(带*类型变量2))/去掉一个*后类型的宽度

![20211210104915](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211210104915.png)


## &符号的使用

    & 可以获取任何一个变量的地址
    &a 的类型 就是a的类型+*

```c
int a;
void test01() {
    int b;
    int* pa = &a;
}

void test02() {
    int p = 10;

    int *******p7;
    int ******p6;
    int *****p5;
    int ****p4;
    int ***p3;
    int **p2;
    int *p1;

    p1 = &p;
    p2 = &p1;
    p3 = &p2;
    p4 = &p3;
    p5 = &p4;
    p6 = &p5;
    p7 = &p6;
}

void test03() {
    char a = 0xa1;
    short b = 0xa2;
    int c = 0xa3;

    char *pa= &a;
    short *pb = &b;
    int *pc = &c;

    char **ppa = &pa;
    short **ppb = &pb;
    int **ppc = &pc;
}
```
![20211210083548](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211210083548.png)


![20211210084340](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211210084340.png)

## *符号的使用

```c
int x = 10;

int *px = &x;
int &&ppx = &px;
int *px1 = *ppx;
```

![20211210140053](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211210140053.png)


## 指针与数组

![pointer05](https://cdn.jsdelivr.net/gh/nzcv/picgo/pointer05.png)


## 字符串与数组和指针

```c
char  *x = "china";
char y[] = "china";

void testb() {
    *(x+1) = "A"; // 非法修改
    y[1] = "A";
}
```

```c
char *a = "if"
char *b = "for"
char *c = "while"

char keyword[] = {
    "if",
    "for",
    "while".
}
```

## 指针与结构体

```c
struct Arg
{
    int a;
    int b;
    int c;
};

void testc() {
    //宽度 ++ -- +N -N SUB CMP
    Arg a;
    Arg* pArg = &a;
    //pArg = 
}
```

## 指针分类(指针/结构体指针/数组指针/函数指针)

1. 指针

2. 结构体指针

3. 数组指针
 
```c
int *a[5];          //指针数组
int a[5];           //数组
int (*pa)[5];       //数组指针
```

```c
#include <stdio.h>

void test() {
    int a[5] = {1, 2, 3, 4, 5};
    int (*pa)[2];
    
    pa = (int (*)[2])a;

    printf("%lx, %lx\n", pa , *pa);

    printf("%lx\n", *(*(pa + 0) + 0)); //pa[0][0] 0*2 + 0
    printf("%lx\n", *(*(pa + 1) + 1)); //pa[1][1] 1*2 + 1
    printf("%lx\n", *(*(pa + 3) + 3)); //pa[1][1] 3*2 + 3

    char (*pb)[2][3];
    pb = (char (*)[2][3])a;
    printf("%lx\n", *(*(*(pb + 0) + 0) + 0)); // (0*2 + 0)*3 + 0
    printf("%lx\n", *(*(*(pb + 2) + 3) + 4)); // (2*2 + 3)*3 + 4 = 25
    printf("%lx\n", *(*(*(pb + 3) + 2) + 5)); // (3*2 + 2)*3 + 5 = 29
    printf("%lx\n", *(*(*(pb + 2) + 2) + 2)); // (2*2 + 2)*3 + 2 = 20


}
```

![20211212192259](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211212192259.png)

4. 函数指针

![20211212232514](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211212232514.png)

```c
int fun(int a, int b); //函数
int (*pfun)(int a, int b); //函数指针
```
```

`arm/16bit_operand.md/readme.md`:

```md
# 位运算


ARM的位运算是如此的重要,以至于对应的执行单元,其中一个操作数带有移位操作功能. 

![20211213113955](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213113955.png)

ARM 微处理器内嵌的桶型移位器（Barrel Shifter），支持数据的各种移位操作，移位操作在 ARM 指令集中不作为单独的指令使用，它只能作为指令格式中是一个字段，在汇编语言中表示为指令中的选项。

## Barrel Shift包含5种运算

![20211213131806](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213131806.png)


![20211213154747](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213154747.png)

逻辑左移和算术左移计算结果是一模一样的.

```c
void test25() {
    asm volatile(
        "mov r1, #0xffffffff\n"
        "lsls r0, r1, #1\n"         //逻辑左移, 影响标志位
        
        "mov r1, #0xffffffff\n"
        "movs r0, r1, LSL#1\n"      //shift op 逻辑左移, 影响标志位

        "mov r1, #0xffffffff\n"
        //"asl r0, r1, #1\n"         //算术左移, 指令不存在

        "mov r1, #0xffffffff\n"
        "lsl r0, r1, #1\n");       //逻辑/算术左移动, 不影响标志位
}
```

```asm
hello:05694448 test25
hello:05694448 MOV.W           R1, #0xFFFFFFFF
hello:0569444C LSLS            R0, R1, #1
hello:0569444E MOV.W           R1, #0xFFFFFFFF
hello:05694452 LSLS            R0, R1, #1
hello:05694454 MOV.W           R1, #0xFFFFFFFF
hello:05694458 MOV.W           R1, #0xFFFFFFFF
hello:0569445C MOV.W           R0, R1,LSL#1
hello:05694460 BX              LR
hello:05694460 ; End of function test25
```



```

`arm/17logic_operand.md/readme.md`:

```md
# 逻辑运算

![20211213164411](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213164411.png)

## 真值表

![20211213164449](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213164449.png)


## 语法与C语言对比

![20211213164608](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213164608.png)



[https://cseweb.ucsd.edu/classes/fa15/cse30/lectures/lec7_detailed.pdf](https://cseweb.ucsd.edu/classes/fa15/cse30/lectures/lec7_detailed.pdf)

## MVN

![20211213192948](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213192948.png)

## Help

[https://cseweb.ucsd.edu/classes/fa15/cse30/syllabus.html](https://cseweb.ucsd.edu/classes/fa15/cse30/syllabus.html)
```

`arm/18mix_c_asm.__asm.md/readme.md`:

```md


![20220118094327](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118094327.png)

# 内嵌汇编(__asm)

![20220118094414](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118094414.png)

## 使用C语言无法使用的指令

![20220118094527](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118094527.png)

## inline asm
![20220118094618](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118094618.png)

# C调用汇编/汇编调用C(独立的文件)

![20220118093551](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118093551.png)

![20220118093633](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118093633.png) 

## 汇编访问C变量

![20220118093856](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118093856.png)

## C访问汇编变量

![20220118094003](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118094003.png)

## 汇编里面使用weak, 代表有不同的实现

![20220118094141](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220118094141.png)
```

`arm/README.md`:

```md
# my_arm

arm学习笔记

![cheatsheetv1.3-1920x1080.png](https://cdn.jsdelivr.net/gh/yhnu/note/arm/cheatsheetv1.3-1920x1080.png)



[https://www.processon.com/mindmap/619d8e440791292b97eb9ad9](https://www.processon.com/mindmap/619d8e440791292b97eb9ad9)

## ida 

https://github.com/zyantific/IDASkins


## github fast

[https://github.com/topics/hosts-file](https://github.com/topics/hosts-file)

```

`caddy2/antdesign.md/readme.md`:

```md
搭建服务器的时候,遇到了反向代理和文件服务的问题

https://caddy.community/t/file-server-reverse-proxy/10664/3

```shell
emr.cure.org {

	handle_path /metabase* {
		reverse_proxy localhost:3000
	}

	handle {
		root * /usr/share/caddy
		file_server
	}
}
```
```

`caddy2/readme.md`:

```md
```shell
# Caddyfile
{
	auto_https off
}

:8080 {
	bind 0.0.0.0
	root * D:\\Android
	file_server browse
}
```

<!-- windows服务 -->
nssm.exe


.\nssm.exe install caddy2 I:\thirdshot\Caddy2\caddy.exe
```

`cpp/64template_ref.md/readme.md`:

```md
# 模板的本质

# 模板函数实现交换

```c
#include <stdio.h>

template<class T>
void myswap(T &l, T &r) {
    T tmp;
    tmp = r;
    r = l;
    l = tmp;
}

int main(int argc, char** argv) {
    int a = 10, b = 20;
    myswap(a, b);
    return 0;
}
```

```asm
void myswap<int>(int&, int&):                    // @void myswap<int>(int&, int&)
        sub     sp, sp, #32                     // =32
        str     x0, [sp, #24]
        str     x1, [sp, #16]
        ldr     x8, [sp, #16]
        ldr     w9, [x8]
        str     w9, [sp, #12]
        ldr     x8, [sp, #24]
        ldr     w9, [x8]
        ldr     x8, [sp, #16]
        str     w9, [x8]
        ldr     w9, [sp, #12]
        ldr     x8, [sp, #24]
        str     w9, [x8]
        add     sp, sp, #32                     // =32
        ret
```

# 模板函数实现折半查找
```c
#include <stdio.h>

template<class T>
int Search_Bin(T ST[], int len, T key)
{
    int low = 1;
    int high = len;
    int mid;
    while (low <= high) {
        mid = (low+high) / 2;
        if (ST[mid] == key)
        if(true)
        {
            return mid;
        } else if(ST[mid] > key)
        {
            high = mid-1;
        }
        else {
            low = mid + 1;
       }
    }

    return 0;
}

struct Person {
    const char* name;
    int age;
};

int main(int argc, char** argv) {
    Person p[] = {
        {"Name", 10},
    };
    Person k = {"Name", 10};

    Search_Bin(p, 2, k);
    return 0;
}
```
![20211222232108](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211222232108.png)


# 引用

C++为了规避指针的灵活性, 使用引用类型达到相同目的, 底层没区别. 但是更加安全

```c
#include <stdio.h>

int Test1(int *x) {
    *x = 1;
}

int Test2(int &x) {
    x = 1;
}
```

![20211222232257](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211222232257.png)

1. 引用是C++新增类型
2. 引用类型只能赋值一次, 不能重新赋值
3. 引用是变量的一个别名
4. 引用可以想指针那样去访问, 修改对象的内存, 但是更加安全


# 友元函数
```c
#include <stdio.h>
#include <iostream>

template<class T>
int Search_Bin(T ST[], int len, T key)
{
    int low = 1;
    int high = len;
    int mid;
    while (low <= high) {
        mid = (low+high) / 2;
        if (ST[mid] == key)
        {
            return mid;
        } else if(ST[mid] > key)
        {
            high = mid-1;
        }
        else {
            low = mid + 1;
       }
    }

    return 0;
}

class Person {
public:
    const char* name;
    int age;
    friend void Print(Person &p); 
};

void Print(Person &p) {
    std::cout << p.name << p.age;
}

int main(int argc, char** argv) {
    Person p[] = {
        {"Name", 10},
    };
    Person k = {"Name", 10};

    Search_Bin(p, 2, k);
    return 0;
}
```

用途:
![20211223001836](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211223001836.png)
1. 运行符重载在某些场合需要使用友元
2. 两个类需要共享数据

区别:

1. 成员函数有this指针, 友元函数没有this指针

2. 友元函数不能被继承

# 运算符重载

和普通函数没区别


```

`cpp/virtual_fun.md/readme.md`:

```md
# 虚函数

```c
#include <stdio.h>

class Base {
    public:
    void Fun1() {
        printf("Fun\n");
    }
    virtual void Fun2() {
        printf("Fun\n");
    }
};

int main() {
    Base a;
    Base* pb = &a;
    a.Fun1();
    a.Fun2();

    pb->Fun1();
    pb->Fun2();
    return 0;
}
```


## 虚函数表


    当类声明中有虚函数时, 编译器会自动生成虚函数表, 并在构造函数中进行初始化.

![20211220083147](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211220083147.png)



## 虚函数调用

![20211220083701](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211220083701.png)


1. 直接调用和普通函数没有任何区别

![20211220083408](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211220083408.png)

2. 间接调用

通过x10寄存器来确认具体应该调用哪一个函数

![20211220083543](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211220083543.png)


# 单继承无函数覆盖

![20211220214019](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211220214019.png)

# 单继承有函数覆盖

![20211220214130](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211220214130.png)

# 多继承无函数覆盖

几个父类几个虚函数表

# 多继承有函数覆盖

覆盖了哪个函数在哪个虚函数表

 
```

`csapp/01.BigEndianandLittleEndian/readme.md`:

```md
![20220116231946](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220116231946.png)

![20220116232130](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220116232130.png)

# ARM大小端可配置, Android手机采用LittleEndian

```

`flutter/readme.md`:

```md

# 自动化构建flutter

https://flutterchina.club/get-started/editor/

[](https://github.com/waifu-project/movie/blob/master/.github/workflows/release.yml)

# CLion配置dartSDK环境

I:\thirdsoft\flutter\bin\cache\dart-sdk


```

`ida/01dcb_dcw_dcd.md/readme.md`:

```md
# 数据宽度

![20211213175101](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211213175101.png)

    DCB data control byte(byte)
    DCW data control half word(short)
    DCD data control word(int)
    DCQ data control (long)
![20220116224329](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220116224329.png)


## KEIL汇编和GNU汇编的区别

![20220116224519](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220116224519.png)


## IDA关于please position the cursor within a funtion的解决

```shell
我是在C/C++反编译中出现的问题，因为在动态调试的时候IDA不能解析出函数段导致：

解决办法：

步骤1：右键code，会出现汇编代码；

步骤2：右键creat fun 

完成步骤1和步骤2，就可以正常的反编译出伪代码。
```

https://blog.csdn.net/yiheliangmaoqian/article/details/78140793


## IDA Pro F5 出现 positive sp value has been found

https://bbs.pediy.com/thread-254990.htm

## IDA查看机器指令

![20220124223257](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220124223257.png)

## IDA切换主题

Options->Color

![20220120113228](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220120113228.png)

## 在十六进制窗口中，这个内存位置的内容显示为 ?? ?? ?? ??

![20220124222520](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220124222520.png)

因为 IDA 是一种静态分析工具，它无法获知程序在执行时会在这个内存位置输入什么地址

导入窗口还提供与 objdump (-T) 、 readelf (-s) 和 dumpbin (/IMPORTS) 等命令行工具类似的功能

导入窗口仅显示二进制文件想要动态加载器自动处理的符号，二进制文件选择使用 dlopen/dlsym 或 LoadLibrary/GetProcAddress 等机制自行加载的符号将不会在导入窗口中显示


## 实线箭头表示非条件跳转，虚线箭头则表示条件跳转

![20220124224249](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220124224249.png)

## IAD文本视图

![20220124224532](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220124224532.png)


# HelpLink

[详细解释每个窗体的含义](https://www.cnblogs.com/sch01ar/p/9476340.html)


```

`ida/02idapython.md/readme.md`:

```md
# 

# help
chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=https%3A%2F%2Fgitee.com%2Fit-ebooks%2Fit-ebooks-2018-04to07%2Fraw%2Fmaster%2FIDAPython%2520%25E5%2588%259D%25E5%25AD%25A6%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597.pdf

chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=https%3A%2F%2Fgitee.com%2Fit-ebooks%2Fit-ebooks-2018-04to07%2Fraw%2Fmaster%2FIDAPython%2520%25E5%2588%259D%25E5%25AD%25A6%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597.pdf

chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=https%3A%2F%2Frecon.cx%2F2017%2Fmontreal%2Fresources%2Fslides%2FRECON-MTL-2017-IDAPython.pdf

```

`ida/ida_struct.md`:

```md
导入自定义结构体

https://blog.csdn.net/weixin_45799954/article/details/115009760

```

`ios/MemoryInfo.cpp`:

```cpp
#include "UnityPrefix.h"
#include "Configuration/UnityConfigure.h"

#include "Runtime/Misc/SystemInfo.h"
#include "Runtime/Logging/LogAssert.h"
#include <mach/mach.h>
#include <mach/mach_host.h>
#include <mach/vm_region.h>
#include <sys/sysctl.h>

#include <unistd.h>

#if ENABLE_PROFILER
#if PLATFORM_OSX
#include <libproc.h>
#elif PLATFORM_APPLE_NONDESKTOP
//On iPhone, this gets pulled in dynamically through libproc.dylib
extern "C" int proc_regionfilename(int pid, uint64_t address, void * buffer, uint32_t buffersize);
#endif
#endif

void systeminfo::GetAppCommittedMemoryRegionsSlow(dynamic_array<MemoryRegionInfo> &results)
{
    mach_port_t task = mach_task_self();

    // Iterate all VM regions within valid address range and
    // report these which belong to the Unity proccess
    vm_size_t regionSize = 0;
    int prevUserTag = -1;
    for (vm_address_t queryAddr = MACH_VM_MIN_ADDRESS; queryAddr <= MACH_VM_MAX_ADDRESS; queryAddr += regionSize)
    {
        mach_port_t objectName;
        mach_msg_type_number_t count = VM_REGION_EXTENDED_INFO_COUNT;
        struct vm_region_extended_info info;
        kern_return_t retCode = vm_region_64(task, &queryAddr, &regionSize, VM_REGION_EXTENDED_INFO, (vm_region_info_t)&info, &count, &objectName);
        if (retCode != KERN_SUCCESS)
            break;

        // We don't count all the regions that have shared_mode == SM_EMPTY
        // SM_EMPTY - region that has no kernel page backing such as stack guards,
        // reserved and shared regions
        if (info.share_mode == SM_EMPTY)
            continue;

        // Treat copy-on-write regions with single reference as private
        if ((info.share_mode == SM_COW) && (info.ref_count == 1))
            info.share_mode = SM_PRIVATE;

        MemoryRegionInfo region(kMemMemoryProfiler);
        region.address = static_cast<uint64_t>(queryAddr);
        region.size = regionSize;
        region.residentSize = info.pages_resident * PAGE_SIZE;

        // Deduce memory type based on usage (user_tag) and share mode
        // IOKit & IOAccelerator - device driver memory
        // Any non-private pages - shared memory
        region.type = MemoryRegionInfo::Type::Private;
        if ((info.user_tag == VM_MEMORY_IOKIT) || (info.user_tag == VM_MEMORY_IOACCELERATOR) || (info.user_tag == VM_MEMORY_IOSURFACE))
            region.type = MemoryRegionInfo::Type::Device;
        else if ((info.share_mode != SM_PRIVATE) && (info.share_mode != SM_LARGE_PAGE))
            region.type = MemoryRegionInfo::Type::Shared;

#if ENABLE_PROFILER
        #define VM_USER_TAG_NAME(TagID) \
            case VM_MEMORY_##TagID:     \
                region.name = #TagID;   \
                break;

        // Generate name based on region user-tag
        // These should closly match names shown by Xcode Instruments
        switch (info.user_tag)
        {
            VM_USER_TAG_NAME(MALLOC);
            VM_USER_TAG_NAME(MALLOC_SMALL);
            VM_USER_TAG_NAME(MALLOC_LARGE);
            VM_USER_TAG_NAME(MALLOC_HUGE);
            VM_USER_TAG_NAME(MALLOC_TINY);
            VM_USER_TAG_NAME(MALLOC_LARGE_REUSABLE);
            VM_USER_TAG_NAME(MALLOC_LARGE_REUSED);
            VM_USER_TAG_NAME(ANALYSIS_TOOL);
            VM_USER_TAG_NAME(MALLOC_NANO);
            VM_USER_TAG_NAME(MALLOC_MEDIUM);
            VM_USER_TAG_NAME(STACK);

            VM_USER_TAG_NAME(IOKIT);
            VM_USER_TAG_NAME(IOACCELERATOR);
            VM_USER_TAG_NAME(FOUNDATION);
            VM_USER_TAG_NAME(CORESERVICES);

            VM_USER_TAG_NAME(COREGRAPHICS);
            VM_USER_TAG_NAME(COREGRAPHICS_DATA);
            VM_USER_TAG_NAME(COREGRAPHICS_SHARED);
            VM_USER_TAG_NAME(COREGRAPHICS_FRAMEBUFFERS);
            VM_USER_TAG_NAME(COREGRAPHICS_BACKINGSTORES);

            VM_USER_TAG_NAME(DYLIB);
            VM_USER_TAG_NAME(DYLD_MALLOC);
            VM_USER_TAG_NAME(OBJC_DISPATCHERS);

            VM_USER_TAG_NAME(SHARED_PMAP);
            VM_USER_TAG_NAME(UNSHARED_PMAP);

            VM_USER_TAG_NAME(LAYERKIT);
            VM_USER_TAG_NAME(CGIMAGE);
            VM_USER_TAG_NAME(COREIMAGE);
            VM_USER_TAG_NAME(COREUI);
            VM_USER_TAG_NAME(IOSURFACE);
        }
#undef VM_USER_TAG_NAME
        if (info.user_tag == 0)
        {
            // If we can't classify the region by a user tag,
            // try  to check if it's a mapped file region
            pid_t pid = getpid();
            char regionName[PATH_MAX];
            int ret = proc_regionfilename(pid, queryAddr, regionName, PATH_MAX);
            if (ret > 0)
            {
                regionName[ret] = '\0';
                region.name.assign(regionName, ret);
                region.type = MemoryRegionInfo::Type::Mapped;
            }
        }
#endif // ENABLE_PROFILER

        // Regions can be reported as separate, even when really contiguous -
        // this led to the size of certain objects in the memory profiler reporting
        // a lower native size than expected, eg. Texture2DArrays listing at most
        // a native size of 128MB when they were actually larger.
        // Therefore, if two memory regions are conceptually the same -
        // adjacent, with same flags etc. - merge them.
        //
        // N.B. not sure if this is caused by our allocation setup, or MacOS.
        if (results.empty())
        {
            results.push_back(region);
        }
        else
        {
            auto& prevRegion = results.back();
            if (prevRegion.type == region.type &&
                prevUserTag == info.user_tag &&
                prevRegion.address + prevRegion.size == region.address &&
                (info.user_tag != 0 || prevRegion.name == region.name))
            {
                prevRegion.size += region.size;
            }
            else
            {
                results.push_back(region);
            }
        }

        prevUserTag = info.user_tag;
    }
}

```

`ios/malloc history`:

```
malloc_history -callTree -invert 2.75gb.memgraph > 2.75gb.ct
python3 malloc_history_tool.py 2.92gb.ict 99 ''

```

`ios/malloc_history_tool.py`:

```py
import re
import json

class SpeedScopeTree:
    def __init__(self):
        self._root = {'root': { 'size': 0, 'children': {} }}
    
    def add_path(self, path, value):
        cur = self._root['root']
        for node in path:
            if node not in cur['children']:
                cur['children'][node] = { 'size': 0, 'children': {} }
            cur = cur['children'][node]
        cur['size'] += value

    def dump(self, filename):
        ''' 输出 SpeedScope 格式文件 '''
        data = { 'head': self.__dump_child('root', self._root['root']) }
        with open(filename, 'w', encoding='utf-8') as json_file:
            json.dump(data, json_file, ensure_ascii=False, indent=2)
    
    def __create_speedscope_node(self, name, node, children=[]):
        # 不支持负数
        if node['size'] < 0:
            return { 'callFrame': { 'functionName': name}, 'selfSize': 0, 'children': children }
        return { 'callFrame': { 'functionName': name}, 'selfSize': node['size'], 'children': children }

    def __dump_child(self, name, node):
        if len(node['children']) == 0:
            return self.__create_speedscope_node(name, node)
        
        children = []
        for cname, cnode in node['children'].items():
            children.append(self.__dump_child(cname, cnode))
        
        return self.__create_speedscope_node(name, node, children)


def tobyte(size, unit):
    if 'M' == unit:
        return size * 1024 * 1024
    if 'K' == unit:
        return size * 1024
    if 'bytes' == unit:
        return size

def topath(stack):
    path = []
    for item in stack:
        path.append(item[1])

# 满足条件的才会记录
def check(path, value, tag=''):
    if tag == '':
        return True
    # if 'malloc' not in path[-1]:
    #     return False
    for line in path:
        if tag in line:        # il2cpp虚拟机 先忽略
            return True
    return False

def main(file, max_depth, tag=''):
    sst = SpeedScopeTree()
    with open(file, 'r') as f:
        data = f.read()
        lines = re.findall(r'^\W{4}([ +!:|]*)(\d+) \(([\d.]+)([MKbytes]+)\) (.*)$', data, re.M)
    
    stack = []
    for m in lines:
        depth = len(m[0]) / 2
        if depth > max_depth:
            continue

        while depth < len(stack):
            path = []
            value = stack[-1][0]
            for item in stack:
                item[0] -= value
                path.append(item[1])

            # 只有满足条件才会记录
            if check(path, value, tag):
                sst.add_path(path, value)
            stack.pop()

        bsize = tobyte(float(m[2]), m[3])
        name = m[4]

        stack.append([bsize, name])
    sst.dump(f'{file}_{tag}.json')



if __name__ == '__main__':
    import sys
    print(f'input: {sys.argv[1]}')
    print(f'max depth: {sys.argv[2]}')
    main(sys.argv[1], int(sys.argv[2]), sys.argv[3])

```

`ios/memory_limit.md`:

```md
* IOS增加内存上限

1. 直接开发者证书, cap里面添加

https://imzlp.com/posts/56381/

2. 直接entry里面添加

https://lvv.me/posts/2025/10/19_increased_memory_limit_on_ios/

```

`kernel/02.task_cred.md`:

```md
linux 进程安全上下文对应原理

https://onestraw.github.io/linux/linux-struct-cred/


```

`kernel/kerneldump.md/readme.md`:

```md
## 内核层dump

```c
#include <asm/fcntl.h>
#include <asm/pgtable.h>
#include <asm/processor.h>
#include <asm/uaccess.h>
#include <linux/dcache.h>
#include <linux/err.h>
#include <linux/errno.h>
#include <linux/fs.h>
#include <linux/init.h>
#include <linux/string.h>
#include <linux/kernel.h>
#include <linux/mm.h>
#include <linux/module.h>
#include <linux/moduleparam.h>
#include <linux/sched.h>
#include <linux/sched/signal.h>

static ulong start = 0x3f80000;
static int pid = 1361;
static ulong end = 0x3f90000;

static int __init dump_init(void) {
  ulong size = end - start;
  struct task_struct *tsk;
  char *vaddr;
  int retval = 0;
  int ret;

  pgd_t *pgd = NULL;
  pud_t *pud = NULL;
  pmd_t *pmd = NULL;
  pte_t *pte = NULL;  
  struct page *page;

  for_each_process(tsk) {
     if (tsk->pid == pid) {       
       break;
     }
  }

  pgd = pgd_offset(tsk->mm, start);
  if (pgd_none(*pgd)) {
    printk("not mapped in pgd\n");
    return -1;
  }

  pud = pud_offset((pgd_t *)pgd, start);
  if (pud_none(*pud)) {
    printk("not mapped in pud\n");
    return -1;
  }

  pmd = pmd_offset(pud, start);
  if (pmd_none(*pmd)) {
    printk("not mapped in pmd\n");
    return -1;
  }

  pte = pte_offset_kernel(pmd, start);
  if (pte_none(*pte)) {
    printk("not mapped in pte\n");
    return -1;
  }
  page = pte_page(*pte);
  vaddr = page_address(page);
  
  do
  {
    struct file *fp;
    mm_segment_t old_fs;
    loff_t pos;
    fp = filp_open("/data/local/tmp/dump.bin", O_RDWR | O_CREAT, 0644);
    if (IS_ERR(fp)) {
      ret = PTR_ERR(fp);
      printk(KERN_INFO "/data/local/tmp/dump.bin = %d\n", ret);
      return ret;
    }
    old_fs = get_fs();
    set_fs(KERNEL_DS);
    pos = fp->f_pos;
    vfs_write(fp, vaddr, size, &pos);
    fp->f_pos = pos;
    set_fs(old_fs);
    filp_close(fp, NULL);
  } while(0);
  return 0;
}

static void __exit dump_exit(void) {
  printk("dump exit");
}

module_init(dump_init);
module_exit(dump_exit);
MODULE_LICENSE("GPL");
```
```

`linker/00elf.md/readme.md`:

```md
![20211228151809](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211228151809.png)



帮助网站:

https://embeddedsecurity.io/sec-c.html#sec:c-elf

https://developer.arm.com/documentation/dui0474/m/image-structure-and-generation/the-structure-of-an-arm-elf-image/views-of-the-image-at-each-link-stage

https://fasterthanli.me/series/making-our-own-executable-packer/part-16

https://nathanotterness.com/2021/10/tiny_elf_modernized.html

https://my.oschina.net/FEEDFACF/blog/1623352
https://my.oschina.net/FEEDFACF/blog/1629696


FAQ:

https://blog.csdn.net/weixin_30349597/article/details/95598236

```

`linker/01elfheader.md/readme.md`:

```md
# ELFHEADER
![20211228142842](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211228142842.png)

![20211226102348](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211226102348.png)

![20211226101644](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211226101644.png)

## 有些信息抹除掉
![20211228145355](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211228145355.png)


## ET_DYN/ET_EXE

![20211226103546](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211226103546.png)

    ET_DYN 代表有重定位
    ET_EXE 代表没有重定位, 并不是可执行文件的意思


## 帮助网站

https://nathanotterness.com/2021/10/tiny_elf_modernized.html
```

`linker/02mmap.md/readme.md`:

```md
# mmap文件映射

![20211226221439](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211226221439.png)

1. 映射大小超过文件大小1个page, 读取的时候会出现Bus Error. 因为并没有分配真实的物理内存.

2. Segment Error, 代表有真实的物理内存. 但是权限不匹配

3. 按页分配, 且页边界对齐

![20211230091945](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211230091945.png)

## mmap的一些原理

早期搞内核的时候, 已经详细的了解对应的使用规则, https://bbs.pediy.com/thread-269784.htm

## 一些mmap值得考虑的问题

为什么mmap能防止用户态和内核态的内存拷贝


## linker load elf with mmap

todo??
```

`linker/03programheader/readme.md`:

```md
todo
```

`linker/04.1pt_load.md/readme.md`:

```md
todo
```

`linker/04.2pt_dyn.md/readme.md`:

```md
todo
```

`linker/05symtab.md/readme.md`:

```md
# 符号和函数存在多对一的关系

![20211229150451](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211229150451.png)

# 符号表

本质: 地址和字符串的对应关系

```c
/* Symbol table entry.  */
typedef struct
{
  Elf32_Word	st_name;		/* Symbol name (string tbl index) */
  Elf32_Addr	st_value;		/* Symbol value */
  Elf32_Word	st_size;		/* Symbol size */
  unsigned char	st_info;		/* Symbol type and binding */
  unsigned char	st_other;		/* Symbol visibility */
  Elf32_Section	st_shndx;		/* Section index */
} Elf32_Sym;
```

![20211227081625](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211227081625.png)

st_info(符号绑定信息)，低4位表示符号类型（Symbol Type）,高28位表示符号绑定信息（Symbol Binding）

![20211227081859](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211227081859.png)

![20211227081913](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211227081913.png)

st_shndx(符号所在段) 如果符号是定义在目标文件中，那么符号的意思就是符号所在的段的在段表中的下标 ，此外还有几种特殊的定义如下：

![20211227081954](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211227081954.png)

st_value(符号值) 符号如果是一个函数或者变量，符号值表示函数或者变量的地址，特殊地st_value还有以下几种可能：

* 在目标文件中，符号类型不是COMMON类型（st_shndx!=SHN_COMMON），st_value表示符号在段中的偏移，即符号位于st_shndx所在的段偏移st_value，在该例子中的global_init_var、func1、main都属于这种类型。
* 在目标文件中，符号类型是COMMON类型（st_shndx=SHN_COMMON），st_value表示符号的对其属性，在该例子中的global_uninit_var的Value值为0000000000000004，表示对其长度为4字节，即为global_uninit_var类型（int）的字节长度
* 在可执行文件中，st_value表示符号的虚拟地址，动态链接需要使用到

```c
int a[1024];

int b[10] = {0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55};

const int c[5] = {0xbb, 0xbc};
int d;
int e = 0x88;

// link with liblog.so
void say_hello(const  char* msg) {
    __android_log_print(ANDROID_LOG_DEBUG, "minidl", "%s", msg);
}

// link with libc.so
void printf_hello(const  char* msg, int i) {
    b[0] = c[i];
    printf("%s", msg);
}
```

```shell
[12] .text             PROGBITS        000007cc 0007cc 00190c 00  AX  0   0  4
[21] .data             PROGBITS        00004000 003000 000034 00  WA  0   0  4
[22] .bss              NOBITS          00004034 003034 001005 00  WA  0   0  4
```

```shell
 nchain=25:
[ LOCAL]0x00000000, size=00000000, STT_NOTYPE   STBLOCAL ndx=UNDEF name=
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__cxa_finalize
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__cxa_atexit
#say_hello定义在目标文件中，ndx值为12表示位于代码段.text中
[EXPORT]0x00000809, size=00000056,   STT_FUNC STB_GLOBAL ndx=   12 name=say_hello
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__android_log_print
#printf_hello定义在目标文件中，ndx值为12表示位于代码段.text中
[EXPORT]0x00000841, size=00000064,   STT_FUNC STB_GLOBAL ndx=   12 name=printf_hello
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=printf
#b符号在.data区, 属于OBJECT类型
[EXPORT]0x00004004, size=00000040, STT_OBJECT STB_GLOBAL ndx=   21 name=b
#a符号在.bss区, 属于OBJECT类型
[EXPORT]0x00004034, size=00004096, STT_OBJECT STB_GLOBAL ndx=   22 name=a
#d符号在.bss区, 属于OBJECT类型
[EXPORT]0x00005034, size=00000004, STT_OBJECT STB_GLOBAL ndx=   22 name=d
#e符号在.data区, 属于OBJECT类型
[EXPORT]0x0000402c, size=00000004, STT_OBJECT STB_GLOBAL ndx=   21 name=e
[   ABS]0x00004034, size=00000000, STT_NOTYPE STB_GLOBAL ndx=  ABS name=_edata
[   ABS]0x00005039, size=00000000, STT_NOTYPE STB_GLOBAL ndx=  ABS name=_end
[   ABS]0x00004034, size=00000000, STT_NOTYPE STB_GLOBAL ndx=  ABS name=__bss_start
[IMPORT]0x00000000, size=00000000, STT_OBJECT STB_GLOBAL ndx=UNDEF name=__stack_chk_guard
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__stack_chk_fail
#printf符号在目标文件中没有定义，所以ndx值为UND
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=fprintf
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=fflush
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=abort
[IMPORT]0x00000000, size=00000000, STT_OBJECT STB_GLOBAL ndx=UNDEF name=__sF
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__aeabi_memcpy
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__aeabi_memclr8
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=snprintf
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=dladdr
[IMPORT]0x00000000, size=00000000,   STT_FUNC STB_GLOBAL ndx=UNDEF name=__gnu_Unwind_Find_exidx
```
     STB_GLOBAL/STBLOCAL
     STB_GLOBAL，表示符号绑定信息为全局符号，外部可见
     STBLOCAL  , 局部符号, 对于目标文件外部, 不可见


## 使用 readelf -s 命令查看目标文件的所有符号详细信息
```shell
λ readelf20.bat -s built\armeabi-v7a\libdemo.so

Symbol table '.dynsym' contains 25 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_finalize@LIBC (2)
     2: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_atexit@LIBC (2)
     3: 00000809    56 FUNC    GLOBAL DEFAULT   12 say_hello
     4: 00000000     0 FUNC    GLOBAL DEFAULT  UND __android_log_print
     5: 00000841    64 FUNC    GLOBAL DEFAULT   12 printf_hello
     6: 00000000     0 FUNC    GLOBAL DEFAULT  UND printf@LIBC (2)
     7: 00004004    40 OBJECT  GLOBAL DEFAULT   21 b
     8: 00004034  4096 OBJECT  GLOBAL DEFAULT   22 a
     9: 00005034     4 OBJECT  GLOBAL DEFAULT   22 d
    10: 0000402c     4 OBJECT  GLOBAL DEFAULT   21 e
    11: 00004034     0 NOTYPE  GLOBAL DEFAULT  ABS _edata
    12: 00005039     0 NOTYPE  GLOBAL DEFAULT  ABS _end
    13: 00004034     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start
    14: 00000000     0 OBJECT  GLOBAL DEFAULT  UND __stack_chk_guard@LIBC (2)
    15: 00000000     0 FUNC    GLOBAL DEFAULT  UND __stack_chk_fail@LIBC (2)
    16: 00000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@LIBC (2)
    17: 00000000     0 FUNC    GLOBAL DEFAULT  UND fflush@LIBC (2)
    18: 00000000     0 FUNC    GLOBAL DEFAULT  UND abort@LIBC (2)
    19: 00000000     0 OBJECT  GLOBAL DEFAULT  UND __sF@LIBC (2)
    20: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memcpy
    21: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memclr8
    22: 00000000     0 FUNC    GLOBAL DEFAULT  UND snprintf@LIBC (2)
    23: 00000000     0 FUNC    GLOBAL DEFAULT  UND dladdr@LIBC (3)
    24: 00000000     0 FUNC    GLOBAL DEFAULT  UND __gnu_Unwind_Find_exidx
```

## 使用 readelf -S 查看目标文件的所有段信息，后面分析符号信息的时候会作为参照使用到。
```shell
root@localhost simple-secion-linux-elf]# readelf -S libdemo.o
[12] .text             PROGBITS        000007cc 0007cc 00190c 00  AX  0   0  4
[21] .data             PROGBITS        00004000 003000 000034 00  WA  0   0  4
[22] .bss              NOBITS          00004034 003034 001005 00  WA  0   0  4
```

几个重要的符号解释：

```shell
1. printf_hello 和 say_hello定义在目标文件中，Ndx值为12表示位于代码段中（参照 readelf -S 结果中的 [Nr] 值 ）
     Bind值为GLOBAL，表示符号绑定信息为全局符号，外部可见
     Type值为FUNC，  表示符号类四个函数或其他可执行代码
     Size值表示符号大小
     Value符号所在的地址
```

```shell
printf符号在目标文件中没有定义，所以Ndx值为UND
```

```shell
(1)a符号是未初始化的全局变量，Ndx值为22表示位于.bss数据段，
     Bind值为OBJECT，表示符号类型为STT_OBJECT，变量数组的符号类型都为该值
     Size  为4096，  表示符号大小占用4096字节
     Value 为22，    表示该符号位于Ndx段的第22个位置

```

```shell
(1)有部分Name未定义的符号，符号名就是段名，比如Num为2、Ndx为1的的符号表示.text段，他的符号名就是段名
```

```shell
SimpleSection.c符号的Ndx为ABS、Type为FILE，表示文件名的符号
     DT_JMPREL: 重定位记录的开始地址, 指向.rela.plt节在内存中保存的地址
     DT_PLTREL: 重定位记录的类型 RELA或RE, 这里是RELAL
     DT_PLTRELSZ: 重定位记录的总大小, 这里是24 * 2 = 48
```

# 导入表和导出表都需要依赖符号表

![20211229193137](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211229193137.png)


# 讲解导入导出之前, 我们需要了解下重定位

```c
typedef struct elf32_rel {
  Elf32_Addr    r_offset; //r_offset表示重定位入口的偏移。对于可重定位文件来说，这个值是该重定位入口所要修正的位置的第一个字节相对于节起始的偏移；对于可执行文件或共享对象文件来说，这个值是该重定位入口所要修正的位置的第一个字节的虚拟地址
  Elf32_Word    r_info; //r_info表示重定位入口的类型和符号。这个成员的高8位表示重定位入口的类型，低24位表示重定位入口的符号在符号表中的下标
} Elf32_Rel;
```

![20211229193555](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211229193555.png)

# 欸外知识

我定义了一个const数组, 但是符号表解析并没有找到对应的数据, 原因是对应数据进入rodata区

![20211229201456](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211229201456.png)

# 帮助

[https://blog.csdn.net/weixin_33895475/article/details/91930494](https://blog.csdn.net/weixin_33895475/article/details/91930494)

[https://malware.news/t/executable-and-linkable-format-101-part-2-symbols/17960](https://malware.news/t/executable-and-linkable-format-101-part-2-symbols/17960)

[https://www.freebuf.com/articles/system/193646.html](https://www.freebuf.com/articles/system/193646.html)


[https://lwn.net/Articles/192624/](https://lwn.net/Articles/192624/)
```

`linker/06import_dyn.plt.md/readme.md`:

```md
# 导入表

1. 导入函数

2. 导入结构体

3. 导入全局变量

4. 导入数组

## PLT重定位(导入表)


ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/sysroot/usr/include/bits/elf_arm.h

定义了全部需要重定位的类型


```c
LOGD("================import================");
for (int i = 0; i < soinfo.plt_rela_count_; i++) {
    auto reloc                  = soinfo.plt_rela_[i];
    const uint32_t r_type       = ELF32_R_TYPE(reloc.r_info);
    const uint32_t r_sym_offset = ELF32_R_SYM(reloc.r_info);  //符号表偏移

    Elf32_Addr* const rel_target = reinterpret_cast<Elf32_Addr*>(soinfo.load_bias_ + reloc.r_offset);

    const Elf32_Sym* sym = nullptr;
    const char* sym_name = nullptr;
    Elf32_Addr sym_addr  = 0;
    // get symbol name
    if (r_sym_offset != 0) {
        sym      = soinfo.symtab_ + r_sym_offset;
        sym_name = soinfo.strtab_ + sym->st_name;
    }
    //LOGD("[%d] sym=%s type=%d offset=%p", i, sym_name, r_type, reloc.r_offset);

    // find symbol by name
    if (r_sym_offset == 0) {
        // Do nothing
    } else {
        for (size_t n = 0; n < soinfo.needed_so_len; n++) {
            sym_addr = (Elf32_Addr)dlsym(soinfo.needed_so[n], sym_name);
            if (sym_addr) {
                //LOGD("so=%s sym=%s, addr=%p", soinfo.needed_so_name[n], sym_name, sym_addr);
                break;
            }
        }
    }

    // relocate entry by type
    switch (r_type) {
        case R_ARM_JUMP_SLOT: /* Create PLT entry.  */
        {
            // LOGD("R_ARM_JUMP_SLOT %p to %p", rel_target[0], sym_addr);
            *reinterpret_cast<Elf32_Addr*>(rel_target) = sym_addr;
        } break;
        default:
            LOGE("Unsupported reloc entry: r_sym=%u(%s), r_type=%u, r_offset=0x%08lx, addend=0x%08lx.", r_sym_offset, sym_name, r_type, reloc.r_offset, nullptr);
            break;
    }

    if(sym != nullptr)
    {
        const char* sym_name = soinfo.strtab_ + sym->st_name;
        int type = sym->st_info & 0xf; //STT_NOTYPE, STT_OBJECT, STT_FUNC, STT_SECTION STT_FILE
        int bind = sym->st_info > 0x4; //STBLOCAL, STB_GLOBAL, STB_WEAK
        auto ndx = sym->st_shndx;        
        LOGD("\t[IMPORT]address=0x%08lx, size=%08lu, type=%10s bind=%10s ndx=%4x name=%s", rel_target, sym->st_size, s_type[type], s_bind[bind], ndx, sym_name);
    }
}
```

## Dump输出

void DumpRelocs(const MemSoInfo* soinfo, const char* type, Elf64_Rela* rela, size_t rela_count) {
    LOGD("Relocs(%s):", type);
    for (size_t i = 0; i < rela_count; ++i) {
        Elf64_Rela* reloc = rela + i;   //重定位信息
        void* const rel_target = reinterpret_cast<void*>(soinfo->load_bias_ + reloc->r_offset); //重定位地址
        const uint32_t r_type = ELF64_R_TYPE(reloc->r_info);                                    //重定位类型
        const uint32_t r_sym = ELF64_R_SYM(reloc->r_info);                                      //重定位符号偏移
        Elf64_Sym* sym = soinfo->symtab_ + r_sym;                                               //重定位符号
        const char* sym_name = soinfo->strtab_ + sym->st_name;                                  //符号名称
        LOGD("\treloc rel_target=%p, type=%u, sym=%u, sym_name=%s, addend=0x%08lx.", rel_target, r_type, r_sym, sym_name, reloc->r_addend); //打印
    }
}

## linker4.4 官方实现(剔除了一些跨平台实现)

```c
static int soinfo_relocate(soinfo* si, Elf32_Rel* rel, unsigned count,
                           soinfo* needed[])
{
    Elf32_Sym* symtab = si->symtab;
    const char* strtab = si->strtab;
    Elf32_Sym* s;
    Elf32_Rel* start = rel;
    soinfo* lsi;

    for (size_t idx = 0; idx < count; ++idx, ++rel) {
        unsigned type = ELF32_R_TYPE(rel->r_info);
        unsigned sym = ELF32_R_SYM(rel->r_info);
        Elf32_Addr reloc = static_cast<Elf32_Addr>(rel->r_offset + si->load_bias);
        Elf32_Addr sym_addr = 0;
        char* sym_name = NULL;

        DEBUG("Processing '%s' relocation at index %d", si->name, idx);
        if (type == 0) { // R_*_NONE
            continue;
        }
        if (sym != 0) {
            sym_name = (char *)(strtab + symtab[sym].st_name);
            s = soinfo_do_lookup(si, sym_name, &lsi, needed);
            if (s == NULL) {
                /* We only allow an undefined symbol if this is a weak
                   reference..   */
                s = &symtab[sym];
                if (ELF32_ST_BIND(s->st_info) != STB_WEAK) {
                    DL_ERR("cannot locate symbol \"%s\" referenced by \"%s\"...", sym_name, si->name);
                    return -1;
                }

                /* IHI0044C AAELF 4.5.1.1:

                   Libraries are not searched to resolve weak references.
                   It is not an error for a weak reference to remain
                   unsatisfied.

                   During linking, the value of an undefined weak reference is:
                   - Zero if the relocation type is absolute
                   - The address of the place if the relocation is pc-relative
                   - The address of nominal base address if the relocation
                     type is base-relative.
                  */

                switch (type) {
                case R_ARM_JUMP_SLOT:
                case R_ARM_GLOB_DAT:
                case R_ARM_ABS32:
                case R_ARM_RELATIVE:    /* Don't care. */
                    /* sym_addr was initialized to be zero above or relocation
                       code below does not care about value of sym_addr.
                       No need to do anything.  */
                    break;

                case R_ARM_COPY:
                    /* Fall through.  Can't really copy if weak symbol is
                       not found in run-time.  */
                default:
                    DL_ERR("unknown weak reloc type %d @ %p (%d)",
                                 type, rel, (int) (rel - start));
                    return -1;
                }
            } else {
                /* We got a definition.  */
#if 0
                if ((base == 0) && (si->base != 0)) {
                        /* linking from libraries to main image is bad */
                    DL_ERR("cannot locate \"%s\"...",
                           strtab + symtab[sym].st_name);
                    return -1;
                }
#endif
                sym_addr = static_cast<Elf32_Addr>(s->st_value + lsi->load_bias);
            }
            count_relocation(kRelocSymbol);
        } else {
            s = NULL;
        }

/* TODO: This is ugly. Split up the relocations by arch into
 * different files.
 */
        switch(type){
        case R_ARM_JUMP_SLOT:
            count_relocation(kRelocAbsolute);
            MARK(rel->r_offset);
            TRACE_TYPE(RELO, "RELO JMP_SLOT %08x <- %08x %s", reloc, sym_addr, sym_name);
            *reinterpret_cast<Elf32_Addr*>(reloc) = sym_addr;
            break;
        case R_ARM_GLOB_DAT:
            count_relocation(kRelocAbsolute);
            MARK(rel->r_offset);
            TRACE_TYPE(RELO, "RELO GLOB_DAT %08x <- %08x %s", reloc, sym_addr, sym_name);
            *reinterpret_cast<Elf32_Addr*>(reloc) = sym_addr;
            break;
        case R_ARM_ABS32:
            count_relocation(kRelocAbsolute);
            MARK(rel->r_offset);
            TRACE_TYPE(RELO, "RELO ABS %08x <- %08x %s", reloc, sym_addr, sym_name);
            *reinterpret_cast<Elf32_Addr*>(reloc) += sym_addr;
            break;
        case R_ARM_REL32:
            count_relocation(kRelocRelative);
            MARK(rel->r_offset);
            TRACE_TYPE(RELO, "RELO REL32 %08x <- %08x - %08x %s",
                       reloc, sym_addr, rel->r_offset, sym_name);
            *reinterpret_cast<Elf32_Addr*>(reloc) += sym_addr - rel->r_offset;
            break;
        case R_ARM_RELATIVE:
            count_relocation(kRelocRelative);
            MARK(rel->r_offset);
            if (sym) {
                DL_ERR("odd RELATIVE form...");
                return -1;
            }
            TRACE_TYPE(RELO, "RELO RELATIVE %08x <- +%08x", reloc, si->base);
            *reinterpret_cast<Elf32_Addr*>(reloc) += si->base;
            break;
        case R_ARM_COPY:
            if ((si->flags & FLAG_EXE) == 0) {
                /*
                 * http://infocenter.arm.com/help/topic/com.arm.doc.ihi0044d/IHI0044D_aaelf.pdf
                 *
                 * Section 4.7.1.10 "Dynamic relocations"
                 * R_ARM_COPY may only appear in executable objects where e_type is
                 * set to ET_EXEC.
                 *
                 * TODO: FLAG_EXE is set for both ET_DYN and ET_EXEC executables.
                 * We should explicitly disallow ET_DYN executables from having
                 * R_ARM_COPY relocations.
                 */
                DL_ERR("%s R_ARM_COPY relocations only supported for ET_EXEC", si->name);
                return -1;
            }
            count_relocation(kRelocCopy);
            MARK(rel->r_offset);
            TRACE_TYPE(RELO, "RELO %08x <- %d @ %08x %s", reloc, s->st_size, sym_addr, sym_name);
            if (reloc == sym_addr) {
                Elf32_Sym *src = soinfo_do_lookup(NULL, sym_name, &lsi, needed);

                if (src == NULL) {
                    DL_ERR("%s R_ARM_COPY relocation source cannot be resolved", si->name);
                    return -1;
                }
                if (lsi->has_DT_SYMBOLIC) {
                    DL_ERR("%s invalid R_ARM_COPY relocation against DT_SYMBOLIC shared "
                           "library %s (built with -Bsymbolic?)", si->name, lsi->name);
                    return -1;
                }
                if (s->st_size < src->st_size) {
                    DL_ERR("%s R_ARM_COPY relocation size mismatch (%d < %d)",
                           si->name, s->st_size, src->st_size);
                    return -1;
                }
                memcpy((void*)reloc, (void*)(src->st_value + lsi->load_bias), src->st_size);
            } else {
                DL_ERR("%s R_ARM_COPY relocation target cannot be resolved", si->name);
                return -1;
            }
            break;
        default:
            DL_ERR("unknown reloc type %d @ %p (%d)",
                   type, rel, (int) (rel - start));
            return -1;
        }
    }
    return 0;
}
```
```

`linker/07hasthtable.md/readme.md`:

```md
# 导出函数与变量

符号表

```shell
[ LOCAL]address=0x00000000, size=00000000, type=STT_NOTYPE bind=  STBLOCAL ndx=   0 name=
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__cxa_finalize
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__cxa_atexit
# 导出函数
[EXPORT]address=0x000007b9, size=00000056, type=  STT_FUNC bind=STB_GLOBAL ndx=   c name=say_hello
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__android_log_print
# 导出函数
[EXPORT]address=0x000007f1, size=00000040, type=  STT_FUNC bind=STB_GLOBAL ndx=   c name=printf_hello
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=printf
# 导出全局变量
[EXPORT]address=0x00004008, size=00004096, type=STT_OBJECT bind=STB_GLOBAL ndx=  16 name=a
[   ABS]address=0x00004008, size=00000000, type=STT_NOTYPE bind=STB_GLOBAL ndx=fff1 name=_edata
[   ABS]address=0x00005009, size=00000000, type=STT_NOTYPE bind=STB_GLOBAL ndx=fff1 name=_end
[   ABS]address=0x00004008, size=00000000, type=STT_NOTYPE bind=STB_GLOBAL ndx=fff1 name=__bss_start
[IMPORT]address=0x00000000, size=00000000, type=STT_OBJECT bind=STB_GLOBAL ndx=   0 name=__stack_chk_guard
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__stack_chk_fail
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=fprintf
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=fflush
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=abort
[IMPORT]address=0x00000000, size=00000000, type=STT_OBJECT bind=STB_GLOBAL ndx=   0 name=__sF
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__aeabi_memcpy
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__aeabi_memclr8
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=dladdr
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=snprintf
[IMPORT]address=0x00000000, size=00000000, type=  STT_FUNC bind=STB_GLOBAL ndx=   0 name=__gnu_Unwind_Find_exidx
```

## HASH表

![20211229150103](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211229150103.png)

### DT_HASH

https://flapenguin.me/elf-dt-hash

```c
// 查找导出函数
static Elf32_Sym* soinfo_elf_lookup(soinfo* si, unsigned hash, const char* name) {
    Elf32_Sym* symtab = si->symtab;
    const char* strtab = si->strtab;

    TRACE_TYPE(LOOKUP, "SEARCH %s in %s@0x%08x %08x %d",
               name, si->name, si->base, hash, hash % si->nbucket);

    for (unsigned n = si->bucket[hash % si->nbucket]; n != 0; n = si->chain[n]) {
        Elf32_Sym* s = symtab + n;
        if (strcmp(strtab + s->st_name, name)) continue;

            /* only concern ourselves with global and weak symbol definitions */
        switch(ELF32_ST_BIND(s->st_info)){
        case STB_GLOBAL:
        case STB_WEAK:
            if (s->st_shndx == SHN_UNDEF) {
                continue;
            }

            TRACE_TYPE(LOOKUP, "FOUND %s in %s (%08x) %d",
                       name, si->name, s->st_value, s->st_size);
            return s;
        }
    }

    return NULL;
}
```

```c
LOGD("================export================");
    for (int i = 0; i < soinfo.nbucket; i++) {
        for (int n = soinfo.bucket[i]; n != 0; n = soinfo.chain[n]) {
            Elf32_Sym* s = soinfo.symtab_ + n;
            auto bind    = ELF32_ST_BIND(s->st_info);
            auto type    = ELF32_ST_TYPE(s->st_info);
            if (s->st_shndx == SHN_UNDEF) {
                continue;
            }
            switch (ELF32_ST_BIND(s->st_info)) {
                case STB_GLOBAL: //export
                case STB_WEAK: {
                    if (s->st_shndx == SHN_UNDEF) {
                        continue;
                    }
                    auto bind_type = bind == STB_GLOBAL? "STB_GLOBAL" : "STB_WEAK";
                    auto export_name = soinfo.strtab_ + s->st_name;
                    auto addr        = soinfo.load_bias_ + s->st_value;
                    LOGD("[%s]%25s,addr=%p", bind_type, export_name, addr);
                } break;
                case STB_LOCAL: {
                    LOGD("[STB_LOCAL]");
                } break;
            }
        }
    }
```

其实符号表给了我们种种迹象, 让我们识别是什么是export函数

### DT_GNU_HASH

![20211228013603](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211228013603.png)

![gnu_hash](https://cdn.jsdelivr.net/gh/nzcv/picgo/gnu_hash.png)


https://flapenguin.me/elf-dt-gnu-hash

文章里面已经讲解的很详细了,这里就不过多的废话了
```

`linker/08dyn.rel.md/readme.md`:

```md
# dyn.rela

主要针对一些目标文件的一些内部重定向, 和dyn.plt没什么区别
```

`linker/10why_three.md/readme.md`:

```md
## 为什么so里面有两个PT_LOAD段, 在maps文件里面却有三段映射

        其中一个疑惑便是为什么elf文件里面只有2个段, 但是到内存后却有3段映射.

这里尝试做一些解答.

### 对应现象

1. 通过ida观察elf具有两个PT_LOAD段

![linker](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211116095810.png)

2. 通过maps文件观察, 具有3个映射段

![linker](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211116095257.png)

3. 通过源码观察, 确实只加载2个段

![linker](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211115132401.png)


### 内核层mmap观察分配情况

```shell
130|OnePlus7T:/data/local/tmp # dmesg -w|grep kr|grep sotest
[ 3142.307841] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b51953000, len=0x1d0 prot=1, off=0x0(ReadProgramHeaders)
[ 3142.307861] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b51952000, len=0xae0 prot=1, off=0x35000(ReadSectionHeaders)
[ 3142.307891] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b51950000, len=0x1ca0 prot=1, off=0x34000(ReadDynamicSection)
[ 3142.307906] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b5194f000, len=0xaeb prot=1, off=0x0(ReadDynamicSection)
[ 3142.308172] [info]kr_mmap mmap file libsotest.so. vaddr=0x7abcd88000, len=0x34988 prot=5, off=0x0(LoadSegments)
[ 3142.308199] [info]kr_mmap mmap file libsotest.so. vaddr=0x7abcdcc000, len=0x11f8 prot=3, off=0x34000(LoadSegments)
```

通过上面的日志信息可以了解到, linker在Android10上面总计进行了6次mmap, 分别为

(1) ReadProgramHeaders

(2) ReadSectionHeaders

(3) ReadDynamicSection

(4) ReadDynamicSection

(5) LoadSegments(通过文件偏移, 可以知晓这里对应elf的第一个段)

(6) LoadSegments(通过文件偏移, 可以知道这里对应elf的第二个段)

其中最后2次映射由LoadSegments引发,也就是我们真正要关注的问题点. 通过mmap观察走两次mmap为正常行为,为什么maps有3段呢? 我们还需要进一步分析, 因此我又hook了mprotect的方法

(tips: 如果大家仔细观察, 这里又会有另外一个小疑问, 为什么mmap的偏移是0x34000, 但是elf的fileoffset是0x34D18. 这里后面再做详细解答)

### 详细堆栈信息如下

```shell
----------------------------------
kr_openat tgid=7635 path=/proc/7635/maps
kr_openat vaddr=0x7b51953000
        pc=0x7b52dace58 sp=0x7fe046bc00 c->sp=0x7fe046bc00 c->pc=0x7b52dace58 regs_len=320 stack_len=1024 path_len=1024
        #00 0x7b52dace58 /apex/com.android.runtime/bin/linker64+fce58(__dl_mmap64)
        #01 0x7b52cff5e8 /apex/com.android.runtime/bin/linker64+4f5e8(__dlMappedFileFragment::Map(int, long, unsigned long, unsigned long))
        #02 0x7b52cffeb0 /apex/com.android.runtime/bin/linker64+4feb0(__dlElfReader::ReadProgramHeaders())
        #03 0x7b52cff790 /apex/com.android.runtime/bin/linker64+4f790(__dlElfReader::Read(char const*, int, long, long))
        #04 0x7b52cf35ac /apex/com.android.runtime/bin/linker64+435ac(__dlload_library(android_namespace_t*, LoadTask*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, bool))
        #05 0x7b52cf23f0 /apex/com.android.runtime/bin/linker64+423f0(__dlload_library(android_namespace_t*, LoadTask*, ZipArchiveCache*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, bool))
----------------------------------
kr_openat tgid=7635 path=/proc/7635/maps
kr_openat vaddr=0x7b51952000
        pc=0x7b52dace58 sp=0x7fe046bc00 c->sp=0x7fe046bc00 c->pc=0x7b52dace58 regs_len=320 stack_len=1024 path_len=1024
        #00 0x7b52dace58 /apex/com.android.runtime/bin/linker64+fce58(__dl_mmap64)
        #01 0x7b52cff5e8 /apex/com.android.runtime/bin/linker64+4f5e8(__dlMappedFileFragment::Map(int, long, unsigned long, unsigned long))
        #02 0x7b52d000b4 /apex/com.android.runtime/bin/linker64+500b4(__dlElfReader::ReadSectionHeaders())
        #03 0x7b52cff79c /apex/com.android.runtime/bin/linker64+4f79c(__dlElfReader::Read(char const*, int, long, long))
        #04 0x7b52cf35ac /apex/com.android.runtime/bin/linker64+435ac(__dlload_library(android_namespace_t*, LoadTask*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, bool))
        #05 0x7b52cf23f0 /apex/com.android.runtime/bin/linker64+423f0(__dlload_library(android_namespace_t*, LoadTask*, ZipArchiveCache*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, bool)
----------------------------------
kr_openat tgid=7635 path=/proc/7635/maps
kr_openat vaddr=0x7b51950000
        pc=0x7b52dace58 sp=0x7fe046bbf0 c->sp=0x7fe046bbf0 c->pc=0x7b52dace58 regs_len=320 stack_len=1040 path_len=1024
        #00 0x7b52dace58 /apex/com.android.runtime/bin/linker64+fce58(__dl_mmap64)
        #01 0x7b52cff5e8 /apex/com.android.runtime/bin/linker64+4f5e8(__dlMappedFileFragment::Map(int, long, unsigned long, unsigned long))
        #02 0x7b52d00630 /apex/com.android.runtime/bin/linker64+50630(__dlElfReader::ReadDynamicSection())
        #03 0x7b52cff7a8 /apex/com.android.runtime/bin/linker64+4f7a8(__dlElfReader::Read(char const*, int, long, long))
        #04 0x7b52cf35ac /apex/com.android.runtime/bin/linker64+435ac(__dlload_library(android_namespace_t*, LoadTask*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, bool))
        #05 0x7b52cf23f0 /apex/com.android.runtime/bin/linker64+423f0(__dlload_library(android_namespace_t*, LoadTask*, ZipArchiveCache*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, bool)
----------------------------------
kr_openat tgid=7635 path=/proc/7635/maps
kr_openat vaddr=0x7b5194f000
        pc=0x7b52dace58 sp=0x7fe046bbf0 c->sp=0x7fe046bbf0 c->pc=0x7b52dace58 regs_len=320 stack_len=1040 path_len=1024
        #00 0x7b52dace58 /apex/com.android.runtime/bin/linker64+fce58(__dl_mmap64)
        #01 0x7b52cff5e8 /apex/com.android.runtime/bin/linker64+4f5e8(__dlMappedFileFragment::Map(int, long, unsigned long, unsigned long))
        #02 0x7b52d006a8 /apex/com.android.runtime/bin/linker64+506a8(__dlElfReader::ReadDynamicSection())
        #03 0x7b52cff7a8 /apex/com.android.runtime/bin/linker64+4f7a8(__dlElfReader::Read(char const*, int, long, long))
        #04 0x7b52cf35ac /apex/com.android.runtime/bin/linker64+435ac(__dlload_library(android_namespace_t*, LoadTask*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, bool))
        #05 0x7b52cf23f0 /apex/com.android.runtime/bin/linker64+423f0(__dlload_library(android_namespace_t*, LoadTask*, ZipArchiveCache*, std::__1::vector<LoadTask*, std::__1::allocator<LoadTask*> >*, int, bool)
----------------------------------
kr_openat tgid=7635 path=/proc/7635/maps
kr_openat vaddr=0x7abcd88000
        pc=0x7b52dace58 sp=0x7fe046c050 c->sp=0x7fe046c050 c->pc=0x7b52dace58 regs_len=320 stack_len=16304 path_len=1024
        #00 0x7b52dace58 /apex/com.android.runtime/bin/linker64+fce58(__dl_mmap64)
        #01 0x7b52d00be4 /apex/com.android.runtime/bin/linker64+50be4(__dlElfReader::LoadSegments())
        #02 0x7b52d007fc /apex/com.android.runtime/bin/linker64+507fc(__dlElfReader::Load(address_space_params*))
        #03 0x7b52cea6e4 /apex/com.android.runtime/bin/linker64+3a6e4(__dlLoadTask::load(address_space_params*))
        #04 0x7b52ce9d04 /apex/com.android.runtime/bin/linker64+39d04(__dlfind_libraries(android_namespace_t*, soinfo*, char const* const*, unsigned long, soinfo**, std::__1::vector<soinfo*, std::__1::allocator<soinfo*> >*, unsigned long, int, android_dlextinfo const*, bool, bool, std::__1::vector<android_namespace_t*, std::__1::allocator<android_namespace_t*> >*))
        #05 0x7b52cecba0 /apex/com.android.runtime/bin/linker64+3cba0(__dldo_dlopen(char const*, int, android_dlextinfo const*, void const*))
        #06 0x7b52ce80dc /apex/com.android.runtime/bin/linker64+380dc(__dl___loader_android_dlopen_ext)
        #07 0x7b4df5b0b8 /apex/com.android.runtime/lib64/bionic/libdl.so+10b8
        #08 0x7b4e2dcfd8 /apex/com.android.runtime/lib64/libnativeloader.so+7fd8
        #09 0x7b4e2dcc5c /apex/com.android.runtime/lib64/libnativeloader.so+7c5c
        #10 0x7acb748938 /apex/com.android.runtime/lib64/libart.so+37b938
        #11 0x7ac16e10e0 /apex/com.android.runtime/lib64/libopenjdkjvm.so+50e0
        #12 0x7164aaf4 /system/framework/arm64/boot.oat+b9af4
----------------------------------
kr_openat tgid=7635 path=/proc/7635/maps
kr_openat vaddr=0x7abcdcc000
        pc=0x7b52dace58 sp=0x7fe046c050 c->sp=0x7fe046c050 c->pc=0x7b52dace58 regs_len=320 stack_len=16304 path_len=1024
        #00 0x7b52dace58 /apex/com.android.runtime/bin/linker64+fce58(__dl_mmap64)
        #01 0x7b52d00be4 /apex/com.android.runtime/bin/linker64+50be4(__dlElfReader::LoadSegments())
        #02 0x7b52d007fc /apex/com.android.runtime/bin/linker64+507fc(__dlElfReader::Load(address_space_params*))
        #03 0x7b52cea6e4 /apex/com.android.runtime/bin/linker64+3a6e4(__dlLoadTask::load(address_space_params*))
        #04 0x7b52ce9d04 /apex/com.android.runtime/bin/linker64+39d04(__dlfind_libraries(android_namespace_t*, soinfo*, char const* const*, unsigned long, soinfo**, std::__1::vector<soinfo*, std::__1::allocator<soinfo*> >*, unsigned long, int, android_dlextinfo const*, bool, bool, std::__1::vector<android_namespace_t*, std::__1::allocator<android_namespace_t*> >*))
        #05 0x7b52cecba0 /apex/com.android.runtime/bin/linker64+3cba0(__dldo_dlopen(char const*, int, android_dlextinfo const*, void const*))
        #06 0x7b52ce80dc /apex/com.android.runtime/bin/linker64+380dc(__dl___loader_android_dlopen_ext)
        #07 0x7b4df5b0b8 /apex/com.android.runtime/lib64/bionic/libdl.so+10b8
        #08 0x7b4e2dcfd8 /apex/com.android.runtime/lib64/libnativeloader.so+7fd8
        #09 0x7b4e2dcc5c /apex/com.android.runtime/lib64/libnativeloader.so+7c5c
        #10 0x7acb748938 /apex/com.android.runtime/lib64/libart.so+37b938
        #11 0x7ac16e10e0 /apex/com.android.runtime/lib64/libopenjdkjvm.so+50e0       
```

### 补全hook信息

```shell
[18391.525011] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b5195a000, len=0x1d0 prot=1, off=0x0
[18391.525027] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b51959000, len=0xae0 prot=1, off=0x35000
[18391.525055] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b51957000, len=0x1ca0 prot=1, off=0x34000
[18391.525069] [info]kr_mmap mmap file libsotest.so. vaddr=0x7b51956000, len=0xaeb prot=1, off=0x0
[18391.525315] [info]kr_mmap mmap file libsotest.so. vaddr=0x7abcd16000, len=0x34988 prot=5, off=0x0
[18391.525343] [info]kr_mmap mmap file libsotest.so. vaddr=0x7abcd5a000, len=0x11f8 prot=3, off=0x34000 
[18391.525629] [20211115_17:03:46.098714]@6 [info]kr_mprotect start=0x7abcd5a000 len=0x1000 prot=1(关键信息)
[18391.525670] [20211115_17:03:46.098754]@6 [info]kr_mprotect start=0x7b51955000 len=0x1000 prot=1
[18391.525769] [20211115_17:03:46.098853]@6 [info]kr_mprotect start=0x7b51b82000 len=0x64000 prot=1
[18391.525851] [20211115_17:03:46.098936]@6 [info]kr_mprotect start=0x7b51c3a000 len=0x64000 prot=1
[18391.525933] [20211115_17:03:46.099017]@6 [info]kr_mprotect start=0x7b51aeb000 len=0x64000 prot=1
[18391.526019] [20211115_17:03:46.099104]@6 [info]kr_mprotect start=0x7b51a87000 len=0x64000 prot=1
[18391.533599] [20211115_17:03:46.106682]@6 [info]kr_mprotect start=0x7a63101000 len=0x2c000 prot=3
[18391.533950] [20211115_17:03:46.107034]@6 [info]kr_mprotect start=0x7a63101000 len=0x1a2b8 prot=5
[18391.534488] [20211115_17:03:46.107573]@6 [info]kr_mprotect start=0x7a63132000 len=0x12000 prot=3
[18391.534601] [20211115_17:03:46.107685]@6 [info]kr_mprotect start=0x7a63132000 len=0xa78 prot=5
[18391.534683] [20211115_17:03:46.107768]@6 [info]kr_mprotect start=0x7a63101000 len=0x2c000 prot=3
```

第二次采集的时候通过hook补全了mprotect权限, 发现为了一行关键信息. linker使用mprotect进行了权限修改, 因此内核层便进行了maps分割

这里简单画了下对应信息, 方便能够理解背后的行为.

![20211116191000](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211116191000.png)

通过上面的分析的,便解答了心中的疑惑. 那么我们进一步思考linker为什么需要进行上面的行为呢? 这个问题我们就需要去linker源码里面寻找答案了, 

堆栈信息已经给我们提供了阅读代码的线索, 我们也就可以去大海里遨游不怕迷路了.

### linker LoadSegments详细分析

ElfReader::ReadProgramHeaders 进行mmap, 在析构函数进行 munmap

ElfReader::ReadSectionHeaders 后续再分析

ElfReader::ReadDynamicSection 后续再分析

ElfReader::ReadDynamicSection 后续再分析

ElfReader::LoadSegments 这里进行一下详细阐述, linker其实是操作系统和elf的连接器, 既要满足elf的要求, 又要满足mmap的一些限制. 

比如:

mmap需要按页分配, elf需要对齐

下图详细描述了虚拟地址空间映射和so文件之间的关系

![linker](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122090406.png)

因为mmap时使用但是PAGE_START(phdr->p_offset), elf的fileoffset是0x34D18, 向上页对齐便是0x34000. 心里的疑惑也就解开了.

### bss段在什么地方?

.bss 也叫做全局变量段

![20211117100643](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211117100643.png)

自己也做了对应的实验,  开辟一个非常大的全局变量. 其中memsize和

![20211122104726](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122104726.png)

### mprotect由谁调用的?

```shell
[13208.302913] [20211117_15:08:06.310817]@5 [info]kr_mmap mmap file libsotest.so. vaddr=0x7e57126000, len=0x1d0 prot=1, off=0x0
[13208.302926] [20211117_15:08:06.310830]@5 [info]kr_mmap mmap file libsotest.so. vaddr=0x7e57125000, len=0xae0 prot=1, off=0x35000
[13208.302949] [20211117_15:08:06.310852]@5 [info]kr_mmap mmap file libsotest.so. vaddr=0x7e57123000, len=0x1ca0 prot=1, off=0x34000
[13208.302959] [20211117_15:08:06.310863]@5 [info]kr_mmap mmap file libsotest.so. vaddr=0x7e57122000, len=0xaeb prot=1, off=0x0
[13208.303170] [20211117_15:08:06.311073]@5 [info]kr_mmap mmap file libsotest.so. vaddr=0x7dc2382000, len=0x34988 prot=5, off=0x0
[13208.303185] [20211117_15:08:06.311088]@5 [info]kr_mmap mmap file libsotest.so. vaddr=0x7dc23c6000, len=0x11f8 prot=3, off=0x34000
[13208.303481] [20211117_15:08:06.311385]@5 [info]kr_mprotect start=0x7dc23c6000 len=0x1000 prot=1 tgid=13596(由谁触发?)
[13208.303536] [20211117_15:08:06.311440]@5 [info]kr_mprotect start=0x7e57121000 len=0x1000 prot=1 tgid=13596
```

```shell
kr_gid tgid=13596 path=/proc/13596/maps mtim=1637132869
kr_tag start=0x7dc23c6000
	pc=0x7e58578e78 sp=0x7ffd9dd960 c->sp=0x7ffd9dd960 c->pc=0x7e58578e78 regs_len=320 stack_len=9888 tag_len=1024
	#00 0x7e58578e78 /apex/com.android.runtime/bin/linker64+fce78(__dl_mprotect)
	#01 0x7e584cd160 /apex/com.android.runtime/bin/linker64+51160(__dlphdr_table_protect_gnu_relro(elf64_phdr const*, unsigned long, unsigned long long))
	#02 0x7e584bc7f8 /apex/com.android.runtime/bin/linker64+407f8(__dlsoinfo::protect_relro())
	#03 0x7e584baff0 /apex/com.android.runtime/bin/linker64+3eff0(__dlsoinfo::link_image(LinkedList<soinfo, SoinfoListAllocator> const&, LinkedList<soinfo, SoinfoListAllocator> const&, android_dlextinfo const*, unsigned long*))
	#04 0x7e584b6324 /apex/com.android.runtime/bin/linker64+3a324(__dlfind_libraries(android_namespace_t*, soinfo*, char const* const*, unsigned long, soinfo**, std::__1::vector<soinfo*, std::__1::allocator<soinfo*> >*, unsigned long, int, android_dlextinfo const*, bool, bool, std::__1::vector<android_namespace_t*, std::__1::allocator<android_namespace_t*> >*))
	#05 0x7e584b8ba0 /apex/com.android.runtime/bin/linker64+3cba0(__dldo_dlopen(char const*, int, android_dlextinfo const*, void const*))
	#06 0x7e584b40dc /apex/com.android.runtime/bin/linker64+380dc(__dl___loader_android_dlopen_ext)
	#07 0x7e550790b8 /apex/com.android.runtime/lib64/bionic/libdl.so+10b8
	#08 0x7e55024fd8 /apex/com.android.runtime/lib64/libnativeloader.so+7fd8
	#09 0x7e55024c5c /apex/com.android.runtime/lib64/libnativeloader.so+7c5c
	#10 0x7dd0e10938 /apex/com.android.runtime/lib64/libart.so+37b938
	#11 0x7dc6ea60e0 /apex/com.android.runtime/lib64/libopenjdkjvm.so+50e0
	#12 0x71e9eaf4 /system/framework/arm64/boot.oat+b9af4
	#13 0x71ebbcac /system/framework/arm64/boot.oat+d6cac
	#14 0x71ebcc94 /system/framework/arm64/boot.oat+d7c94
	#15 0x71ec1870 /system/framework/arm64/boot.oat+dc870
```

![linker](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211117151714.png)

### 为什么需要使用mprotect?

![20211122112623](https://cdn.jsdelivr.net/gh/yhnu/PicBed/20211122112623.png)

因为elf里面有个对应Read-only After Relocation段(R__) GNU Read-only After Relocation, 因此linker需要在进行relocation后进行只读权限设置, 因此使用mprotect


### 其他比较好的讲解

[liner底层原理](https://wooyun.js.org/drops/Android%20Linker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html)

```

`linker/readme.md`:

```md

帮助网站

[https://fasterthanli.me/series/making-our-own-executable-packer/part-16](https://fasterthanli.me/series/making-our-own-executable-packer/part-16)
```

`lldb/02.hardwarebreakpoint.md`:

```md
# 断点都是通过触发程序异常，来达到使程序断下的目的

1.普通断点：常规的有使用int 3，还有调试器平时的断点，这2种都为该类型断点，通过执行int 3达到触发异常，让程序断下的目的。但该断点修改了代码段，在反调试中容易被察觉。

2.条件断点：在普通断点的基础上，增加限定条件。适用于某一下断处会被多地方调用，则加上限定条件（例：[esp-4]!=某一地址），以达到真正需要断下时触发。

3.内存断点：通过修改内存的属性来达到触发异常。可设置触发条件为读、写、执行。但该断点会消耗较大资源，因为内存断点会将目标地址所在的一整个内存页中下断点，当同内存页非下断位置被读、写、访问也会触发，此时调试器会对比数据，看触发的断点位置是否为当初下断处。虽然内存断点的效率经常很不理想，但是因为仅仅是修改了一个内存属性，所以内存断点可以下数量非常多、单断点范围非常大。这是它的优势。

4.硬件断点：硬件断点为CPU提供给我们的断点，由4个寄存器（DR0-DR3）存放断点地址，断点属性可设置为读、写、执行，由于寄存器数量有限，只能存在4个硬件断点，这4个断点是否执行由DR7的0、2、4、6位决定，当置为1时，断点生效。

读：当被下断位置被执行读取操作后，在执行这个操作的位置断下。 例：a的地址为0x123；在123下读的断点后，0x456 为 if(a==1),则程序会在0x456处断下。

写：当被下断位置被执行写操作后，在执行这个操作的位置断下。例：a的地址为0x123；在123下写的断点后，0x456 为a=1,则程序会在0x456处断下。

执行：当运行到下断位置时，在该位置断下。 例：例如0x123456处的代码为c=a+b；在执行到这句时，会在0x123456处断下。

以上断点的地址都在内存中，不能为寄存器。

```

`lldb/readme.md`:

```md


1. 查看地址偏移

image lookup --address 0x04396372

2. 查看堆栈

bt

3. 查看寄存器

re read r0
re read -a

4. 打印字符串

po (const char*)0xef1bb030
```

`magsik/readme.md`:

```md

```shell
magisk resetprop ro.debuggable 1
stop;start;
```

help:

https://blog.xhyeax.com/2019/09/15/magisk-set-debuggable/

```

`ok`:

```
ok

```

`renderdoc/android.build.log`:

```log

Administrator@KING-20180416BY MINGW64 ~
$ cd /f

Administrator@KING-20180416BY MINGW64 /f
$ cd F202
F2021-05/ F2021-07/ F2021-10/ F2021-11/ F2021-12/ F2022-01/ F2022-02/

Administrator@KING-20180416BY MINGW64 /f
$ cd F2022-02/

Administrator@KING-20180416BY MINGW64 /f/F2022-02
$ cd
Unreal Projects/ renderdoc/

Administrator@KING-20180416BY MINGW64 /f/F2022-02
$ cd renderdoc/

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ 
CMake Error: The source directory "F:/F2022-02" does not appear to contain CMakeLists.txt.
Specify --help for usage, or press the help button on the CMake GUI.

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ cd build-android/

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ ls
CMakeCache.txt  CMakeFiles  git_HEAD  git_ref

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ rm -rf *

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
-- Using JAVA_HOME = D:\Unity3d\2020.3.7f1\Editor\Data\PlaybackEngines\AndroidPlayer\OpenJDK
-- Java in JAVA_HOME is 1.8
-- Using Android SDK found in D:\Android\sdk
-- Using Android NDK found in D:\Android\sdk\ndk\21.4.7075529
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: D:/Android/sdk/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin/clang++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: D:/Android/sdk/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin/clang.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Calculating version
-- Building RenderDoc version 1.19
-- Disabling GL driver on android
-- Disabling qrenderdoc for android build
-- Disabling renderdoc python modules for android build
-- Using Android ABI armeabi-v7a
-- Using Android native API level 21
-- Interceptor-lib not enabled (USE_INTERCEPTOR_LIB) - android hooking will use sometimes less reliable PLT-interception method.
CMake Error at I:/msys64/mingw64/share/cmake-3.22/Modules/FindPackageHandleStandardArgs.cmake:230 (message):
  Could NOT find Java (missing: Java_JAVA_EXECUTABLE Java_JAR_EXECUTABLE
  Java_JAVAC_EXECUTABLE Java_JAVAH_EXECUTABLE Java_JAVADOC_EXECUTABLE)
Call Stack (most recent call first):
  I:/msys64/mingw64/share/cmake-3.22/Modules/FindPackageHandleStandardArgs.cmake:594 (_FPHSA_FAILURE_MESSAGE)
  I:/msys64/mingw64/share/cmake-3.22/Modules/FindJava.cmake:336 (find_package_handle_standard_args)
  renderdoccmd/CMakeLists.txt:95 (find_package)


-- Configuring incomplete, errors occurred!
See also "F:/F2022-02/renderdoc/build-android/CMakeFiles/CMakeOutput.log".

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ cd ..

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ git s
git: 's' is not a git command. See 'git --help'.

The most similar commands are
        show
        status
        switch
        svn

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ git status
Refresh index: 100% (5587/5587), done.
On branch v1.x
Your branch is up to date with 'origin/v1.x'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        220_build_cmake.bat
        _build_armeabi-v7a/

nothing added to commit but untracked files present (use "git add" to track)

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
CMake Error: The source directory "F:/F2022-02" does not appear to contain CMakeLists.txt.
Specify --help for usage, or press the help button on the CMake GUI.

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ cd build-android/

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
-- Using JAVA_HOME = D:\Unity3d\2020.3.7f1\Editor\Data\PlaybackEngines\AndroidPlayer\OpenJDK
-- Java in JAVA_HOME is 1.8
-- Using Android SDK found in D:\Android\sdk
-- Using Android NDK found in D:\Android\sdk\ndk\21.4.7075529
-- Calculating version
-- Building RenderDoc version 1.19
-- Disabling qrenderdoc for android build
-- Disabling renderdoc python modules for android build
-- Using Android ABI armeabi-v7a
-- Using Android native API level 21
-- Interceptor-lib not enabled (USE_INTERCEPTOR_LIB) - android hooking will use sometimes less reliable PLT-interception method.
CMake Error at I:/msys64/mingw64/share/cmake-3.22/Modules/FindPackageHandleStandardArgs.cmake:230 (message):
  Could NOT find Java (missing: Java_JAVA_EXECUTABLE Java_JAR_EXECUTABLE
  Java_JAVAC_EXECUTABLE Java_JAVAH_EXECUTABLE Java_JAVADOC_EXECUTABLE)
Call Stack (most recent call first):
  I:/msys64/mingw64/share/cmake-3.22/Modules/FindPackageHandleStandardArgs.cmake:594 (_FPHSA_FAILURE_MESSAGE)
  I:/msys64/mingw64/share/cmake-3.22/Modules/FindJava.cmake:336 (find_package_handle_standard_args)
  renderdoccmd/CMakeLists.txt:95 (find_package)


-- Configuring incomplete, errors occurred!
See also "F:/F2022-02/renderdoc/build-android/CMakeFiles/CMakeOutput.log".

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
-- Using JAVA_HOME = D:\Unity3d\2020.3.7f1\Editor\Data\PlaybackEngines\AndroidPlayer\OpenJDK
-- Java in JAVA_HOME is 1.8
-- Using Android SDK found in D:\Android\sdk
-- Using Android NDK found in D:\Android\sdk\ndk\21.4.7075529
-- Calculating version
-- Building RenderDoc version 1.19
-- Disabling qrenderdoc for android build
-- Disabling renderdoc python modules for android build
-- Using Android ABI armeabi-v7a
-- Using Android native API level 21
-- Interceptor-lib not enabled (USE_INTERCEPTOR_LIB) - android hooking will use sometimes less reliable PLT-interception method.
-- Found Java: D:/Unity3d/2020.3.7f1/Editor/Data/PlaybackEngines/AndroidPlayer/OpenJDK/bin/java.exe (found version "1.8.0-adoptopenjdk")
-- Using Java of version 1.8.0
-- Using Android build-tools version 29.0.2
-- Using android.jar from platform android-28
-- Building APK versionCode 119, versionName 6bd8bcee606dc697c39c57ee3ecaded22eea9ccf
-- Enabled APIs:
--   - OpenGL ES (EGL)
--   - Vulkan
-- Configuring done
-- Generating done
-- Build files have been written to: F:/F2022-02/renderdoc/build-android

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ mingw32-make -j8
[  0%] Building CXX object renderdoc/CMakeFiles/renderdoc_libentry.dir/os/posix/posix_libentry.cpp.o
[  0%] Building CXX object renderdoc/CMakeFiles/rdoc_version.dir/replay/version.cpp.o
[  0%] Building CXX object renderdoc/driver/ihv/intel/CMakeFiles/rdoc_intel.dir/intel_gl_counters.cpp.o
[  0%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_common.cpp.o
[  0%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_common.cpp.o
[  0%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/common/common.cpp.o
[  0%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/glslang_compile.cpp.o
[  0%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/arm_counters.cpp.o
[  0%] Built target rdoc_version
[  0%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_counters.cpp.o
[  1%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/common/dds_readwrite.cpp.o
[  1%] Linking CXX static library librenderdoc_libentry.a
[  1%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard_api.cpp.o
[  1%] Built target renderdoc_libentry
[  2%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_next_chains.cpp.o
[  2%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/common/threading_tests.cpp.o
[  2%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_common.cpp.o
[  2%] Built target rdoc_intel
[  3%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_debug.cpp.o
[  3%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/core.cpp.o
[  4%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard.cpp.o
[  5%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_editor.cpp.o
[  5%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_core.cpp.o
[  6%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_counters.cpp.o
[  7%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/image_viewer.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard_counter.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_isa.cpp.o
[  7%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_gen.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard_communication.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_isa_devices.cpp.o
[  7%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_postvs.cpp.o
[  7%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/target_control.cpp.o
[  8%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_isa_posix.cpp.o
[  8%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_counters.cpp.o
[  9%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/hwcpipe_communication.cpp.o
[  9%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_rgp.cpp.o
[  9%] Built target rdoc_amd
[  9%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_compile.cpp.o
[  9%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/hwcpipe_api.cpp.o
[  9%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_overlay.cpp.o
[ 10%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_debug.cpp.o
[ 10%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/gatord_xml_reader.cpp.o
[ 10%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/remote_server.cpp.o
[ 11%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_debug_setup.cpp.o
[ 12%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/gator_api.cpp.o
[ 13%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_outputwindow.cpp.o
[ 14%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/settings.cpp.o
[ 14%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/gator_message.cpp.o
[ 14%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/message_util.cpp.o
[ 15%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/socket.cpp.o
[ 15%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_postvs.cpp.o
[ 15%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/hwcpipe.cpp.o
[ 15%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_rendermesh.cpp.o
[ 15%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_debug_glsl450.cpp.o
[ 15%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/vendor/arm/mali/mali_profiler.cpp.o
[ 15%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_rendertexture.cpp.o
[ 15%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_debug.cpp.o
[ 15%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/replay_proxy.cpp.o
[ 15%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_shader_feedback.cpp.o
[ 15%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/vendor/arm/pmu/pmu_counter.cpp.o
[ 15%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/intervals_tests.cpp.o
[ 16%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_reflect.cpp.o
[ 17%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_rendertext.cpp.o
[ 18%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_overlay.cpp.o
[ 19%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/vendor/arm/pmu/pmu_profiler.cpp.o
[ 19%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_msaa_array_conv.cpp.o
[ 19%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_processor.cpp.o
[ 19%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/bit_flag_iterator_tests.cpp.o
[ 19%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_msaa_array_conv.cpp.o
[ 19%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_driver.cpp.o
[ 19%] Built target rdoc_arm
[ 19%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_disassemble.cpp.o
[ 20%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android.cpp.o
[ 20%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_initstate.cpp.o
[ 20%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_patch.cpp.o
[ 20%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_outputwindow.cpp.o
[ 21%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_manager.cpp.o
[ 22%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_stringise.cpp.o
[ 23%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_rendermesh.cpp.o
[ 23%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/OGLCompilersDLL/InitializeDll.cpp.o
[ 23%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_renderstate.cpp.o
[ 23%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/GlslangToSpv.cpp.o
[ 23%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_rendertexture.cpp.o
[ 23%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_tools.cpp.o
[ 23%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/InReadableOrder.cpp.o
[ 23%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_replay.cpp.o
[ 25%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/Logger.cpp.o
[ 25%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_utils.cpp.o
[ 26%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_resources.cpp.o
[ 26%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_manifest.cpp.o
[ 26%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_rendertext.cpp.o
[ 26%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_program_iterate.cpp.o
[ 26%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/SpvBuilder.cpp.o
[ 26%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/jdwp.cpp.o
[ 26%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_shader_cache.cpp.o
[ 26%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/SpvTools.cpp.o
[ 27%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/jdwp_util.cpp.o
[ 27%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_shader_refl.cpp.o
[ 27%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/jdwp_connection.cpp.o
[ 28%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_dispatchtables.cpp.o
[ 29%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/SpvPostProcess.cpp.o
[ 29%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/plugins.cpp.o
[ 29%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/GenericCodeGen/CodeGen.cpp.o
[ 30%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_stringise.cpp.o
[ 31%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/resource_manager.cpp.o
[ 31%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/GenericCodeGen/Link.cpp.o
[ 31%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_buffer_funcs.cpp.o
[ 31%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/sparse_page_table.cpp.o
[ 31%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_image_states.cpp.o
[ 32%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Constant.cpp.o
[ 32%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_debug_funcs.cpp.o
[ 32%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/hooks/hooks.cpp.o
[ 32%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_info.cpp.o
[ 32%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/camera.cpp.o
[ 33%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_draw_funcs.cpp.o
[ 33%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/glslang_tab.cpp.o
[ 34%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/formatpacking.cpp.o
[ 34%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_emulated.cpp.o
[ 35%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_initstate.cpp.o
[ 35%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/matrix.cpp.o
[ 35%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/iomapper.cpp.o
[ 35%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/vec.cpp.o
[ 36%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/os_specific.cpp.o
[ 36%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/app_api.cpp.o
[ 36%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_manager.cpp.o
[ 36%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/basic_types_tests.cpp.o
[ 36%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/InfoSink.cpp.o
[ 37%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/capture_options.cpp.o
[ 37%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_memory.cpp.o
[ 37%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/dummy_driver.cpp.o
[ 37%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_framebuffer_funcs.cpp.o
[ 38%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Initialize.cpp.o
[ 38%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/capture_file.cpp.o
[ 38%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Intermediate.cpp.o
[ 39%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_pixelhistory.cpp.o
[ 40%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/entry_points.cpp.o
[ 40%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_get_funcs.cpp.o
[ 40%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/replay_driver.cpp.o
[ 40%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/intermOut.cpp.o
[ 41%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_interop_funcs.cpp.o
[ 41%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/replay_output.cpp.o
[ 41%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_replay.cpp.o
[ 41%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_query_funcs.cpp.o
[ 42%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/IntermTraverse.cpp.o
[ 42%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/replay_controller.cpp.o
[ 42%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_resources.cpp.o
[ 42%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_sampler_funcs.cpp.o
[ 42%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/limits.cpp.o
[ 43%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/serialiser.cpp.o
[ 43%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/linkValidate.cpp.o
[ 44%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_shaderdebug.cpp.o
[ 44%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/lz4io.cpp.o
[ 45%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/parseConst.cpp.o
[ 45%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_state.cpp.o
[ 46%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_shader_funcs.cpp.o
[ 46%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/zstdio.cpp.o
[ 46%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/ParseContextBase.cpp.o
[ 47%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/streamio.cpp.o
[ 47%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_serialise.cpp.o
[ 47%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/rdcfile.cpp.o
[ 47%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_state_funcs.cpp.o
[ 47%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/codecs/xml_codec.cpp.o
[ 47%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/ParseHelper.cpp.o
[ 47%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_texture_funcs.cpp.o
[ 48%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/PoolAlloc.cpp.o
[ 49%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/codecs/chrome_json_codec.cpp.o
[ 50%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_uniform_funcs.cpp.o
[ 50%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/comp_io_tests.cpp.o
[ 50%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/serialiser_tests.cpp.o
[ 50%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_stringise.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/streamio_tests.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/strings/grisu2.cpp.o
[ 51%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/propagateNoContraction.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/strings/string_utils.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/strings/utf8printf.cpp.o
[ 52%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/jpeg-compressor/jpgd.cpp.o
[ 52%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_hooks.cpp.o
[ 53%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_layer.cpp.o
[ 53%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/jpeg-compressor/jpge.cpp.o
[ 53%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpAtom.cpp.o
[ 53%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/imagestate_tests.cpp.o
[ 53%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/catch/catch.cpp.o
[ 53%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/egl_platform.cpp.o
[ 54%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/pugixml/pugixml.cpp.o
[ 54%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/imgrefs_tests.cpp.o
[ 55%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/egl_hooks.cpp.o
[ 55%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpContext.cpp.o
[ 55%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/lz4/lz4.c.o
[ 56%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_cmd_funcs.cpp.o
[ 57%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/Pp.cpp.o
[ 57%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/md5/md5.c.o
[ 58%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/miniz/miniz.c.o
[ 58%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_descriptor_funcs.cpp.o
[ 58%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/superluminal/superluminal.cpp.o
[ 58%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpScanner.cpp.o
[ 58%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_device_funcs.cpp.o
[ 58%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/debug.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/entropy_common.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/error_private.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/fse_compress.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/fse_decompress.c.o
[ 60%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/hist.c.o
[ 61%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_draw_funcs.cpp.o
[ 61%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/huf_compress.c.o
[ 61%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/huf_decompress.c.o
[ 62%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/pool.c.o
[ 62%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/threading.c.o
[ 62%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpTokens.cpp.o
[ 62%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/xxhash.c.o
[ 63%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_common.c.o
[ 63%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_compress.c.o
[ 63%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_decompress.c.o
[ 64%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/reflection.cpp.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_double_fast.c.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_fast.c.o
[ 65%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/RemoveTree.cpp.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_lazy.c.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_ldm.c.o
[ 66%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_opt.c.o
[ 66%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_dynamic_funcs.cpp.o
[ 66%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Scan.cpp.o
[ 66%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstdmt_compress.c.o
[ 67%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/ShaderLang.cpp.o
[ 67%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/stb/stb_impl.c.o
[ 68%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/tinyexr/tinyexr.cpp.o
[ 68%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/SymbolTable.cpp.o
[ 68%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/tinyfiledialogs/tinyfiledialogs.c.o
[ 68%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_get_funcs.cpp.o
[ 68%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Versions.cpp.o
[ 68%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_stringio.cpp.o
[ 69%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_misc_funcs.cpp.o
[ 70%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/attribute.cpp.o
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_callstack.cpp.o
[ 71%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/OSDependent/Unix/ossource.cpp.o
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_process.cpp.o
[ 71%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_queue_funcs.cpp.o
[ 71%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_resource_funcs.cpp.o
[ 71%] Built target rdoc_gl
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_threading.cpp.o
[ 71%] Built target rdoc_spirv
[ 72%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_sync_funcs.cpp.o
[ 72%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_shader_funcs.cpp.o
[ 72%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_hook.cpp.o
[ 73%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_network.cpp.o
[ 73%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_wsi_funcs.cpp.o
[ 73%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_network.cpp.o
[ 73%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_process.cpp.o
[ 74%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_stringio.cpp.o
[ 74%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_threading.cpp.o
[ 74%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_posix.cpp.o
[ 74%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/data/glsl_shaders.cpp.o
[ 74%] Built target rdoc
[ 75%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_android.cpp.o
[ 75%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_layer_android.cpp.o
[ 75%] Built target rdoc_vulkan
[ 75%] Generating ../bin/include-bin
'c++' is not recognized as an internal or external command,
operable program or batch file.
mingw32-make[2]: *** [renderdoc\CMakeFiles\renderdoc.dir\build.make:290: bin/include-bin] Error 1
mingw32-make[1]: *** [CMakeFiles\Makefile2:315: renderdoc/CMakeFiles/renderdoc.dir/all] Error 2
mingw32-make: *** [Makefile:135: all] Error 2

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ pacman -S mingw-w64-x86_64-gcc
resolving dependencies...
looking for conflicting packages...

Packages (7) mingw-w64-x86_64-binutils-2.37-4  mingw-w64-x86_64-crt-git-9.0.0.6373.5be8fcd83-1
             mingw-w64-x86_64-headers-git-9.0.0.6373.5be8fcd83-1  mingw-w64-x86_64-isl-0.24-1
             mingw-w64-x86_64-windows-default-manifest-6.4-3  mingw-w64-x86_64-winpthreads-git-9.0.0.6373.5be8fcd83-1
             mingw-w64-x86_64-gcc-11.2.0-8

Total Download Size:    43.79 MiB
Total Installed Size:  381.20 MiB

:: Proceed with installation? [Y/n]
:: Retrieving packages...
 mingw-w64-x86_64-isl-0.24-1-any                        949.7 KiB   334 KiB/s 00:03 [###############################################] 100%
 mingw-w64-x86_64-winpthreads-git-9.0.0.6373.5be8f...    38.5 KiB  30.7 KiB/s 00:01 [###############################################] 100%
 mingw-w64-x86_64-windows-default-manifest-6.4-3-any     12.9 KiB  39.7 KiB/s 00:00 [###############################################] 100%
 mingw-w64-x86_64-crt-git-9.0.0.6373.5be8fcd83-1-any      3.3 MiB   468 KiB/s 00:07 [###############################################] 100%
 mingw-w64-x86_64-headers-git-9.0.0.6373.5be8fcd83...     5.3 MiB   662 KiB/s 00:08 [###############################################] 100%
 mingw-w64-x86_64-binutils-2.37-4-any                     5.7 MiB   657 KiB/s 00:09 [###############################################] 100%
 mingw-w64-x86_64-gcc-11.2.0-8-any                       28.6 MiB   607 KiB/s 00:48 [###############################################] 100%
 Total (7/7)                                             43.8 MiB   914 KiB/s 00:49 [###############################################] 100%
(7/7) checking keys in keyring                                                      [###############################################] 100%
(7/7) checking package integrity                                                    [###############################################] 100%
(7/7) loading package files                                                         [###############################################] 100%
(7/7) checking for file conflicts                                                   [###############################################] 100%
(7/7) checking available disk space                                                 [###############################################] 100%
:: Processing package changes...
(1/7) installing mingw-w64-x86_64-binutils                                          [###############################################] 100%
(2/7) installing mingw-w64-x86_64-headers-git                                       [###############################################] 100%
(3/7) installing mingw-w64-x86_64-crt-git                                           [###############################################] 100%
(4/7) installing mingw-w64-x86_64-isl                                               [###############################################] 100%
(5/7) installing mingw-w64-x86_64-windows-default-manifest                          [###############################################] 100%
(6/7) installing mingw-w64-x86_64-winpthreads-git                                   [###############################################] 100%
(7/7) installing mingw-w64-x86_64-gcc                                               [###############################################] 100%

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ mingw32-make -j8
Consolidate compiler generated dependencies of target rdoc_version
[  0%] Built target rdoc_version
Consolidate compiler generated dependencies of target renderdoc_libentry
Consolidate compiler generated dependencies of target rdoc_intel
[  0%] Built target renderdoc_libentry
[  0%] Built target rdoc_intel
Consolidate compiler generated dependencies of target rdoc_amd
Consolidate compiler generated dependencies of target rdoc_arm
[  2%] Built target rdoc_amd
Consolidate compiler generated dependencies of target rdoc_gl
[  7%] Built target rdoc_arm
Consolidate compiler generated dependencies of target rdoc_vulkan
Consolidate compiler generated dependencies of target rdoc_spirv
[ 18%] Built target rdoc_gl
Consolidate compiler generated dependencies of target rdoc
[ 32%] Built target rdoc_vulkan
[ 47%] Built target rdoc_spirv
[ 75%] Built target rdoc
[ 75%] Generating ../bin/include-bin
[ 76%] Generating CMakeFiles/data.src/data/glsl/blit.vert.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/checkerboard.frag.c
[ 78%] Generating CMakeFiles/data.src/driver/vulkan/renderdoc.json.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/array2ms.comp.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/depthms2arr.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/discard.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/fixedcol.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/glsl_globals.h.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/gl_texsample.h.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/gltext.frag.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/glsl_ubos.h.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/gles_texsample.h.c
[ 80%] Generating CMakeFiles/data.src/data/glsl/histogram.comp.c
[ 81%] Generating CMakeFiles/data.src/data/glsl/gltext.vert.c
[ 81%] Generating CMakeFiles/data.src/data/glsl/mesh.comp.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.frag.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.geom.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.vert.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/minmaxresult.comp.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/ms2array.comp.c
[ 83%] Generating CMakeFiles/data.src/data/glsl/minmaxtile.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/quadresolve.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/texdisplay.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/quadwrite.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/texremap.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/trisize.geom.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/trisize.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vk_texsample.h.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vktext.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vktext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/sourcecodepro.ttf.c
[ 86%] Generating ../bin/include-bin
[ 86%] Generating CMakeFiles/data.src/data/glsl/checkerboard.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/glsl_ubos.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/glsl_globals.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/fixedcol.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/blit.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/histogram.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/minmaxresult.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.geom.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/minmaxtile.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/quadresolve.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/quadwrite.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/texdisplay.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/texremap.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gl_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gles_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vk_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gltext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gltext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vktext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vktext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/ms2array.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/array2ms.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/trisize.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/trisize.geom.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/depthms2arr.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/discard.frag.c
[ 86%] Generating CMakeFiles/data.src/data/sourcecodepro.ttf.c
[ 87%] Generating CMakeFiles/data.src/driver/vulkan/renderdoc.json.c
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/blit.vert.c.o
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/glsl_ubos.h.c.o
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/checkerboard.frag.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/glsl_globals.h.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/fixedcol.frag.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/histogram.comp.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.comp.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.frag.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.geom.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.vert.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/minmaxresult.comp.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/minmaxtile.comp.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/quadresolve.frag.c.o
[ 91%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/quadwrite.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/texdisplay.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/texremap.frag.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gles_texsample.h.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gl_texsample.h.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gltext.frag.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vk_texsample.h.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gltext.vert.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vktext.frag.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vktext.vert.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/array2ms.comp.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/ms2array.comp.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/trisize.geom.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/trisize.frag.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/discard.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/depthms2arr.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/sourcecodepro.ttf.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/driver/vulkan/renderdoc.json.c.o
[ 98%] Linking CXX shared library ..\lib\libVkLayer_GLES_RenderDoc.so
[ 98%] Built target renderdoc
[ 99%] Building CXX object renderdoccmd/CMakeFiles/renderdoccmd.dir/renderdoccmd_android.cpp.o
[ 99%] Building CXX object renderdoccmd/CMakeFiles/renderdoccmd.dir/renderdoccmd.cpp.o
[ 99%] Building C object renderdoccmd/CMakeFiles/renderdoccmd.dir/D_/Android/sdk/ndk/21.4.7075529/sources/android/native_app_glue/android_native_app_glue.c.o
[100%] Linking CXX shared library ..\lib\librenderdoccmd.so
[100%] Built target renderdoccmd
[100%] Generating debug.keystore

Warning:
JKS ▒▒Կ▒▒ʹ▒▒ר▒ø▒ʽ▒▒▒▒▒▒ʹ▒▒ "keytool -importkeystore -srckeystore F:/F2022-02/renderdoc/build-android/renderdoccmd/debug.keystore -destkeystore F:/F2022-02/renderdoc/build-android/renderdoccmd/debug.keystore -deststoretype pkcs12" Ǩ▒Ƶ▒▒▒ҵ▒▒׼▒▒ʽ PKCS12▒▒
[100%] Generating ../bin/org.renderdoc.renderdoccmd.arm32.apk
Warning in obj\org\renderdoc\renderdoccmd\arm32\Loader.class:
  Type `java.lang.System` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm32.Loader.<clinit>()`
Warning in obj\org\renderdoc\renderdoccmd\arm32\Loader.class:
  Type `android.app.NativeActivity` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm32.Loader.onCreate(android.os.Bundle)`
Warning in obj\org\renderdoc\renderdoccmd\arm32\Loader.class:
  Type `java.lang.Thread` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm32.Loader.onCreate(android.os.Bundle)`
[100%] Built target apk

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ mingw32-make -j8
[  0%] Built target rdoc_version
[  0%] Built target renderdoc_libentry
[  0%] Built target rdoc_intel
[  5%] Built target rdoc_arm
[ 16%] Built target rdoc_gl
[ 30%] Built target rdoc_vulkan
[ 32%] Built target rdoc_amd
[ 47%] Built target rdoc_spirv
[ 75%] Built target rdoc
[ 75%] Generating ../bin/include-bin
[ 75%] Generating CMakeFiles/data.src/data/glsl/blit.vert.c
[ 77%] Generating CMakeFiles/data.src/driver/vulkan/renderdoc.json.c
[ 77%] Generating CMakeFiles/data.src/data/glsl/array2ms.comp.c
[ 77%] Generating CMakeFiles/data.src/data/glsl/checkerboard.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/discard.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/depthms2arr.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/fixedcol.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/gl_texsample.h.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/glsl_globals.h.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/glsl_ubos.h.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/gles_texsample.h.c
[ 80%] Generating CMakeFiles/data.src/data/glsl/gltext.vert.c
[ 80%] Generating CMakeFiles/data.src/data/glsl/gltext.frag.c
[ 81%] Generating CMakeFiles/data.src/data/glsl/histogram.comp.c
[ 81%] Generating CMakeFiles/data.src/data/glsl/mesh.comp.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.geom.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.frag.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.vert.c
[ 83%] Generating CMakeFiles/data.src/data/glsl/minmaxtile.comp.c
[ 83%] Generating CMakeFiles/data.src/data/glsl/minmaxresult.comp.c
[ 83%] Generating CMakeFiles/data.src/data/glsl/ms2array.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/quadresolve.frag.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/texremap.frag.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/quadwrite.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/texdisplay.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/trisize.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/trisize.geom.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vk_texsample.h.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vktext.vert.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vktext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/sourcecodepro.ttf.c
Consolidate compiler generated dependencies of target renderdoc
[ 86%] Generating ../bin/include-bin
[ 86%] Generating CMakeFiles/data.src/data/glsl/blit.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/glsl_ubos.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/glsl_globals.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/checkerboard.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/histogram.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/fixedcol.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.geom.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/minmaxtile.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/minmaxresult.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/quadresolve.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/quadwrite.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/texdisplay.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/texremap.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gles_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gl_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vk_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gltext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vktext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vktext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gltext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/array2ms.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/trisize.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/ms2array.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/trisize.geom.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/discard.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/depthms2arr.frag.c
[ 86%] Generating CMakeFiles/data.src/driver/vulkan/renderdoc.json.c
[ 86%] Generating CMakeFiles/data.src/data/sourcecodepro.ttf.c
[ 86%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/checkerboard.frag.c.o
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/blit.vert.c.o
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/glsl_ubos.h.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/glsl_globals.h.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/fixedcol.frag.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/histogram.comp.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.comp.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.frag.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.vert.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/minmaxresult.comp.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.geom.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/minmaxtile.comp.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/quadresolve.frag.c.o
[ 91%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/quadwrite.frag.c.o
[ 91%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/texdisplay.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/texremap.frag.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gl_texsample.h.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gles_texsample.h.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gltext.frag.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vk_texsample.h.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gltext.vert.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vktext.frag.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vktext.vert.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/array2ms.comp.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/ms2array.comp.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/trisize.frag.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/trisize.geom.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/depthms2arr.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/discard.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/sourcecodepro.ttf.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/driver/vulkan/renderdoc.json.c.o
[ 98%] Linking CXX shared library ..\lib\libVkLayer_GLES_RenderDoc.so
[ 98%] Built target renderdoc
Consolidate compiler generated dependencies of target renderdoccmd
[ 99%] Linking CXX shared library ..\lib\librenderdoccmd.so
[100%] Built target renderdoccmd
[100%] Generating ../bin/org.renderdoc.renderdoccmd.arm32.apk
Warning in obj\org\renderdoc\renderdoccmd\arm32\Loader.class:
  Type `java.lang.System` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm32.Loader.<clinit>()`
Warning in obj\org\renderdoc\renderdoccmd\arm32\Loader.class:
  Type `android.app.NativeActivity` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm32.Loader.onCreate(android.os.Bundle)`
Warning in obj\org\renderdoc\renderdoccmd\arm32\Loader.class:
  Type `java.lang.Thread` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm32.Loader.onCreate(android.os.Bundle)`
[100%] Built target apk

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ start .

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android
$ cd ..

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ mkdir mkdir build-android64

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc
$ cd build-android64

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android64
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=arm64-v8a -G "MinGW Makefiles" ..
-- Using JAVA_HOME = D:\Unity3d\2020.3.7f1\Editor\Data\PlaybackEngines\AndroidPlayer\OpenJDK
-- Java in JAVA_HOME is 1.8
-- Using Android SDK found in D:\Android\sdk
-- Using Android NDK found in D:\Android\sdk\ndk\21.4.7075529
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: D:/Android/sdk/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin/clang++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: D:/Android/sdk/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin/clang.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Calculating version
-- Building RenderDoc version 1.19
-- Disabling GL driver on android
-- Disabling qrenderdoc for android build
-- Disabling renderdoc python modules for android build
-- Using Android ABI arm64-v8a
-- Using Android native API level 21
-- Interceptor-lib not enabled (USE_INTERCEPTOR_LIB) - android hooking will use sometimes less reliable PLT-interception method.
-- Found Java: D:/Unity3d/2020.3.7f1/Editor/Data/PlaybackEngines/AndroidPlayer/OpenJDK/bin/java.exe (found version "1.8.0-adoptopenjdk")
-- Using Java of version 1.8.0
-- Using Android build-tools version 29.0.2
-- Using android.jar from platform android-28
-- Building APK versionCode 119, versionName 6bd8bcee606dc697c39c57ee3ecaded22eea9ccf
-- Enabled APIs:
--   - OpenGL ES (EGL)
--   - Vulkan
-- Configuring done
-- Generating done
-- Build files have been written to: F:/F2022-02/renderdoc/build-android64

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android64
$ mingw32-make -j8
[  0%] Building CXX object renderdoc/CMakeFiles/rdoc_version.dir/replay/version.cpp.o
[  0%] Building CXX object renderdoc/CMakeFiles/renderdoc_libentry.dir/os/posix/posix_libentry.cpp.o
[  0%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_common.cpp.o
[  0%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/arm_counters.cpp.o
[  0%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/common/common.cpp.o
[  0%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_common.cpp.o
[  0%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/glslang_compile.cpp.o
[  0%] Building CXX object renderdoc/driver/ihv/intel/CMakeFiles/rdoc_intel.dir/intel_gl_counters.cpp.o
[  0%] Built target rdoc_version
[  0%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_counters.cpp.o
[  1%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/common/dds_readwrite.cpp.o
[  1%] Linking CXX static library librenderdoc_libentry.a
[  1%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard_api.cpp.o
[  1%] Built target renderdoc_libentry
[  2%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_next_chains.cpp.o
[  2%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_common.cpp.o
[  2%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/common/threading_tests.cpp.o
[  2%] Built target rdoc_intel
[  3%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard.cpp.o
[  4%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_debug.cpp.o
[  4%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/core.cpp.o
[  5%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_editor.cpp.o
[  5%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_core.cpp.o
[  6%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_counters.cpp.o
[  6%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard_counter.cpp.o
[  7%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/image_viewer.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_isa.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/lizard_communication.cpp.o
[  7%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_gen.cpp.o
[  7%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_postvs.cpp.o
[  7%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_isa_devices.cpp.o
[  8%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/hwcpipe_communication.cpp.o
[  9%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_isa_posix.cpp.o
[  9%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_counters.cpp.o
[  9%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_compile.cpp.o
[  9%] Building CXX object renderdoc/driver/ihv/amd/CMakeFiles/rdoc_amd.dir/amd_rgp.cpp.o
[  9%] Built target rdoc_amd
[  9%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/target_control.cpp.o
[  9%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/hwcpipe_api.cpp.o
[ 10%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_debug.cpp.o
[ 10%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_overlay.cpp.o
[ 10%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/gatord_xml_reader.cpp.o
[ 11%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_debug_setup.cpp.o
[ 12%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_outputwindow.cpp.o
[ 13%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/gator_api.cpp.o
[ 13%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/remote_server.cpp.o
[ 13%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/gator_message.cpp.o
[ 13%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/message_util.cpp.o
[ 14%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/socket.cpp.o
[ 14%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_postvs.cpp.o
[ 14%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_rendermesh.cpp.o
[ 14%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/hwcpipe.cpp.o
[ 14%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_debug_glsl450.cpp.o
[ 15%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/settings.cpp.o
[ 15%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/vendor/arm/mali/mali_profiler.cpp.o
[ 15%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_rendertexture.cpp.o
[ 15%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_debug.cpp.o
[ 15%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_shader_feedback.cpp.o
[ 15%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/vendor/arm/pmu/pmu_counter.cpp.o
[ 16%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_reflect.cpp.o
[ 17%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_overlay.cpp.o
[ 18%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_rendertext.cpp.o
[ 18%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/replay_proxy.cpp.o
[ 18%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_processor.cpp.o
[ 19%] Building CXX object renderdoc/driver/ihv/arm/CMakeFiles/rdoc_arm.dir/official/lizard/thirdparty/hwcpipe/vendor/arm/pmu/pmu_profiler.cpp.o
[ 19%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_msaa_array_conv.cpp.o
[ 19%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/intervals_tests.cpp.o
[ 19%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_disassemble.cpp.o
[ 19%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_driver.cpp.o
[ 19%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_msaa_array_conv.cpp.o
[ 19%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/bit_flag_iterator_tests.cpp.o
[ 20%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/spirv_stringise.cpp.o
[ 20%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_outputwindow.cpp.o
[ 20%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_initstate.cpp.o
[ 20%] Built target rdoc_arm
[ 21%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android.cpp.o
[ 21%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/OGLCompilersDLL/InitializeDll.cpp.o
[ 21%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/GlslangToSpv.cpp.o
[ 22%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_rendermesh.cpp.o
[ 23%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_manager.cpp.o
[ 23%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/InReadableOrder.cpp.o
[ 23%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_patch.cpp.o
[ 23%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_renderstate.cpp.o
[ 23%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_rendertexture.cpp.o
[ 24%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/Logger.cpp.o
[ 24%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_rendertext.cpp.o
[ 24%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_tools.cpp.o
[ 24%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_shader_cache.cpp.o
[ 24%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_replay.cpp.o
[ 24%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/SpvBuilder.cpp.o
[ 25%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_utils.cpp.o
[ 26%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_dispatchtables.cpp.o
[ 26%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/android_manifest.cpp.o
[ 26%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/SpvTools.cpp.o
[ 26%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_image_states.cpp.o
[ 26%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/jdwp.cpp.o
[ 27%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_resources.cpp.o
[ 28%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/SPIRV/SpvPostProcess.cpp.o
[ 29%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/jdwp_util.cpp.o
[ 29%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_program_iterate.cpp.o
[ 29%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/GenericCodeGen/CodeGen.cpp.o
[ 29%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_shader_refl.cpp.o
[ 29%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/android/jdwp_connection.cpp.o
[ 29%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_info.cpp.o
[ 29%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/plugins.cpp.o
[ 30%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_initstate.cpp.o
[ 30%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/GenericCodeGen/Link.cpp.o
[ 30%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_manager.cpp.o
[ 31%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/resource_manager.cpp.o
[ 32%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_stringise.cpp.o
[ 33%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Constant.cpp.o
[ 33%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/core/sparse_page_table.cpp.o
[ 33%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_memory.cpp.o
[ 33%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/glslang_tab.cpp.o
[ 33%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/hooks/hooks.cpp.o
[ 34%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_pixelhistory.cpp.o
[ 34%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_buffer_funcs.cpp.o
[ 34%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/camera.cpp.o
[ 35%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/formatpacking.cpp.o
[ 35%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/iomapper.cpp.o
[ 35%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_debug_funcs.cpp.o
[ 35%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/matrix.cpp.o
[ 35%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_replay.cpp.o
[ 36%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_draw_funcs.cpp.o
[ 35%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/maths/vec.cpp.o
[ 36%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/InfoSink.cpp.o
[ 37%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/os_specific.cpp.o
[ 37%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/app_api.cpp.o
[ 37%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_resources.cpp.o
[ 37%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/basic_types_tests.cpp.o
[ 38%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/capture_options.cpp.o
[ 39%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Initialize.cpp.o
[ 40%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_shaderdebug.cpp.o
[ 40%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/dummy_driver.cpp.o
[ 40%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Intermediate.cpp.o
[ 40%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/capture_file.cpp.o
[ 40%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_state.cpp.o
[ 40%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_emulated.cpp.o
[ 41%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/entry_points.cpp.o
[ 41%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/intermOut.cpp.o
[ 41%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_serialise.cpp.o
[ 41%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/replay_driver.cpp.o
[ 41%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_framebuffer_funcs.cpp.o
[ 41%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/replay_output.cpp.o
[ 42%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/IntermTraverse.cpp.o
[ 42%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_stringise.cpp.o
[ 42%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_get_funcs.cpp.o
[ 42%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/replay/replay_controller.cpp.o
[ 42%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/limits.cpp.o
[ 43%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_interop_funcs.cpp.o
[ 43%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/linkValidate.cpp.o
[ 44%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_layer.cpp.o
[ 45%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/serialiser.cpp.o
[ 46%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/parseConst.cpp.o
[ 46%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_query_funcs.cpp.o
[ 46%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/lz4io.cpp.o
[ 46%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/ParseContextBase.cpp.o
[ 46%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/imagestate_tests.cpp.o
[ 46%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/zstdio.cpp.o
[ 46%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_sampler_funcs.cpp.o
[ 46%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/imgrefs_tests.cpp.o
[ 47%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/streamio.cpp.o
[ 48%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_shader_funcs.cpp.o
[ 48%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/rdcfile.cpp.o
[ 48%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/ParseHelper.cpp.o
[ 49%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_cmd_funcs.cpp.o
[ 49%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/codecs/xml_codec.cpp.o
[ 50%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/PoolAlloc.cpp.o
[ 50%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_descriptor_funcs.cpp.o
[ 50%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_state_funcs.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/codecs/chrome_json_codec.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/comp_io_tests.cpp.o
[ 51%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_device_funcs.cpp.o
[ 51%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/serialiser_tests.cpp.o
[ 51%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/propagateNoContraction.cpp.o
[ 52%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/serialise/streamio_tests.cpp.o
[ 52%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/strings/grisu2.cpp.o
[ 53%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_draw_funcs.cpp.o
[ 53%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/strings/string_utils.cpp.o
[ 53%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_texture_funcs.cpp.o
[ 53%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/strings/utf8printf.cpp.o
[ 54%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/jpeg-compressor/jpgd.cpp.o
[ 54%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpAtom.cpp.o
[ 55%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/jpeg-compressor/jpge.cpp.o
[ 55%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/wrappers/gl_uniform_funcs.cpp.o
[ 55%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/catch/catch.cpp.o
[ 56%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/pugixml/pugixml.cpp.o
[ 56%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpContext.cpp.o
[ 56%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/lz4/lz4.c.o
[ 56%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/gl_hooks.cpp.o
[ 57%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/Pp.cpp.o
[ 57%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/md5/md5.c.o
[ 58%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/miniz/miniz.c.o
[ 58%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_dynamic_funcs.cpp.o
[ 58%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpScanner.cpp.o
[ 58%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/superluminal/superluminal.cpp.o
[ 58%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_get_funcs.cpp.o
[ 58%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/debug.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/entropy_common.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/error_private.c.o
[ 59%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/preprocessor/PpTokens.cpp.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/fse_compress.c.o
[ 59%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/fse_decompress.c.o
[ 60%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/hist.c.o
[ 60%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/huf_compress.c.o
[ 60%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/huf_decompress.c.o
[ 60%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/egl_platform.cpp.o
[ 61%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_misc_funcs.cpp.o
[ 62%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/pool.c.o
[ 62%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/threading.c.o
[ 62%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/xxhash.c.o
[ 63%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/reflection.cpp.o
[ 64%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_common.c.o
[ 64%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_compress.c.o
[ 64%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_queue_funcs.cpp.o
[ 64%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_decompress.c.o
[ 64%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/RemoveTree.cpp.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_double_fast.c.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_fast.c.o
[ 65%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_lazy.c.o
[ 66%] Building CXX object renderdoc/driver/gl/CMakeFiles/rdoc_gl.dir/egl_hooks.cpp.o
[ 66%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_ldm.c.o
[ 66%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Scan.cpp.o
[ 67%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstd_opt.c.o
[ 68%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/ShaderLang.cpp.o
[ 68%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/zstd/zstdmt_compress.c.o
[ 68%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/stb/stb_impl.c.o
[ 68%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_resource_funcs.cpp.o
[ 69%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/3rdparty/tinyexr/tinyexr.cpp.o
[ 69%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_shader_funcs.cpp.o
[ 69%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/SymbolTable.cpp.o
[ 69%] Building C object renderdoc/CMakeFiles/rdoc.dir/3rdparty/tinyfiledialogs/tinyfiledialogs.c.o
[ 69%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_stringio.cpp.o
[ 70%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_sync_funcs.cpp.o
[ 70%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/Versions.cpp.o
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_callstack.cpp.o
[ 71%] Built target rdoc_gl
[ 71%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/wrappers/vk_wsi_funcs.cpp.o
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_process.cpp.o
[ 71%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_posix.cpp.o
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_threading.cpp.o
[ 71%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_hook.cpp.o
[ 72%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/MachineIndependent/attribute.cpp.o
[ 73%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/android/android_network.cpp.o
[ 73%] Building CXX object renderdoc/driver/shaders/spirv/CMakeFiles/rdoc_spirv.dir/__/__/__/3rdparty/glslang/glslang/OSDependent/Unix/ossource.cpp.o
[ 73%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_network.cpp.o
[ 74%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_android.cpp.o
[ 74%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_process.cpp.o
[ 75%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_stringio.cpp.o
[ 75%] Built target rdoc_spirv
[ 75%] Building CXX object renderdoc/driver/vulkan/CMakeFiles/rdoc_vulkan.dir/vk_layer_android.cpp.o
[ 75%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/os/posix/posix_threading.cpp.o
[ 75%] Building CXX object renderdoc/CMakeFiles/rdoc.dir/data/glsl_shaders.cpp.o
[ 75%] Built target rdoc
[ 75%] Built target rdoc_vulkan
[ 75%] Generating ../bin/include-bin
[ 78%] Generating CMakeFiles/data.src/driver/vulkan/renderdoc.json.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/blit.vert.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/array2ms.comp.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/checkerboard.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/depthms2arr.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/discard.frag.c
[ 78%] Generating CMakeFiles/data.src/data/glsl/fixedcol.frag.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/glsl_globals.h.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/gl_texsample.h.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/glsl_ubos.h.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/gles_texsample.h.c
[ 79%] Generating CMakeFiles/data.src/data/glsl/gltext.frag.c
[ 80%] Generating CMakeFiles/data.src/data/glsl/mesh.comp.c
[ 80%] Generating CMakeFiles/data.src/data/glsl/gltext.vert.c
[ 81%] Generating CMakeFiles/data.src/data/glsl/histogram.comp.c
[ 81%] Generating CMakeFiles/data.src/data/glsl/mesh.frag.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.geom.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/mesh.vert.c
[ 82%] Generating CMakeFiles/data.src/data/glsl/minmaxresult.comp.c
[ 83%] Generating CMakeFiles/data.src/data/glsl/minmaxtile.comp.c
[ 83%] Generating CMakeFiles/data.src/data/glsl/ms2array.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/quadresolve.frag.c
[ 84%] Generating CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/quadwrite.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/texdisplay.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/trisize.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/texremap.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/trisize.geom.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vk_texsample.h.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vktext.frag.c
[ 85%] Generating CMakeFiles/data.src/data/glsl/vktext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/sourcecodepro.ttf.c
[ 86%] Generating ../bin/include-bin
[ 86%] Generating CMakeFiles/data.src/data/glsl/checkerboard.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/blit.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/glsl_ubos.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/glsl_globals.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/histogram.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/fixedcol.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/mesh.geom.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/minmaxresult.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/minmaxtile.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/quadresolve.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/quadwrite.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/texremap.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/texdisplay.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gl_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gles_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vk_texsample.h.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gltext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vktext.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/gltext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/vktext.vert.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/array2ms.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/ms2array.comp.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/trisize.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/trisize.geom.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/depthms2arr.frag.c
[ 86%] Generating CMakeFiles/data.src/data/glsl/discard.frag.c
[ 86%] Generating CMakeFiles/data.src/data/sourcecodepro.ttf.c
[ 86%] Generating CMakeFiles/data.src/driver/vulkan/renderdoc.json.c
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/blit.vert.c.o
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/glsl_ubos.h.c.o
[ 87%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/checkerboard.frag.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/glsl_globals.h.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/fixedcol.frag.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.comp.c.o
[ 88%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/histogram.comp.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.geom.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.frag.c.o
[ 89%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/mesh.vert.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/minmaxresult.comp.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/minmaxtile.comp.c.o
[ 90%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/quadresolve.frag.c.o
[ 91%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/quadwrite.frag.c.o
[ 91%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_mscopy.comp.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_primid.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/pixelhistory_mscopy_depth.comp.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/shaderdebug_sample.vert.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/texdisplay.frag.c.o
[ 92%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/texremap.frag.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gl_texsample.h.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vk_texsample.h.c.o
[ 93%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gles_texsample.h.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gltext.frag.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/gltext.vert.c.o
[ 94%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vktext.frag.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/vktext.vert.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/array2ms.comp.c.o
[ 95%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/ms2array.comp.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/trisize.frag.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/trisize.geom.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/deptharr2ms.frag.c.o
[ 96%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/depthms2arr.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/glsl/discard.frag.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/data/sourcecodepro.ttf.c.o
[ 97%] Building C object renderdoc/CMakeFiles/renderdoc.dir/CMakeFiles/data.src/driver/vulkan/renderdoc.json.c.o
[ 98%] Linking CXX shared library ..\lib\libVkLayer_GLES_RenderDoc.so
[ 98%] Built target renderdoc
[ 99%] Building CXX object renderdoccmd/CMakeFiles/renderdoccmd.dir/renderdoccmd.cpp.o
[ 99%] Building CXX object renderdoccmd/CMakeFiles/renderdoccmd.dir/renderdoccmd_android.cpp.o
[ 99%] Building C object renderdoccmd/CMakeFiles/renderdoccmd.dir/D_/Android/sdk/ndk/21.4.7075529/sources/android/native_app_glue/android_native_app_glue.c.o
[100%] Linking CXX shared library ..\lib\librenderdoccmd.so
[100%] Built target renderdoccmd
[100%] Generating debug.keystore

Warning:
JKS ▒▒Կ▒▒ʹ▒▒ר▒ø▒ʽ▒▒▒▒▒▒ʹ▒▒ "keytool -importkeystore -srckeystore F:/F2022-02/renderdoc/build-android64/renderdoccmd/debug.keystore -destkeystore F:/F2022-02/renderdoc/build-android64/renderdoccmd/debug.keystore -deststoretype pkcs12" Ǩ▒Ƶ▒▒▒ҵ▒▒׼▒▒ʽ PKCS12▒▒
[100%] Generating ../bin/org.renderdoc.renderdoccmd.arm64.apk
Warning in obj\org\renderdoc\renderdoccmd\arm64\Loader.class:
  Type `java.lang.System` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm64.Loader.<clinit>()`
Warning in obj\org\renderdoc\renderdoccmd\arm64\Loader.class:
  Type `android.app.NativeActivity` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm64.Loader.onCreate(android.os.Bundle)`
Warning in obj\org\renderdoc\renderdoccmd\arm64\Loader.class:
  Type `java.lang.Thread` was not found, it is required for default or static interface methods desugaring of `void org.renderdoc.renderdoccmd.arm64.Loader.onCreate(android.os.Bundle)`
[100%] Built target apk

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android64
$ start .

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android64
$ cd .

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android64
$ code .
bash: code: command not found

Administrator@KING-20180416BY MINGW64 /f/F2022-02/renderdoc/build-android64
$

```

`renderdoc/build.md`:

```md

## RenderDoc编译

```shell

pacman -S mingw-w64-x86_64-gcc

mkdir build-android
cd build-android
cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
mingw32-make.exe -j8

mkdir build-android64
cd build-android64
cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
mingw32-make.exe -j8
```

```shell

$ cd build-android/
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=armeabi-v7a -G "MinGW Makefiles" ..
$ mingw32-make -j8
$ pacman -S mingw-w64-x86_64-gcc

$ mkdir build-android64
$ cd build-android64
$ cmake -DBUILD_ANDROID=On -DANDROID_ABI=arm64-v8a -G "MinGW Makefiles" ..
$ mingw32-make -j8
```

```
Android  PID  30661: [17:33:50]                   DEBUG(0) - Fatal   - #01 pc 0000000000326328  /vendor/lib64/egl/libGLESv2_adreno.so (BuildId: 8f58bda1c70fa129f4e013d6faea0796)
Android  PID  30661: [17:33:50]                   DEBUG(0) - Fatal   - #02 pc 00000000002fcf84  /data/app/~~I24wdy6z_mDknwbevQIPLQ==/org.renderdoc.renderdoccmd.arm64-LXyx77_s43GH2ByH4_QeIg==/lib/arm64/libVkLayer_GLES_RenderDoc.so (WrappedOpenGL::glDeleteBuffers(int, unsigned int const*)+428) (BuildId: 1d2ed789c210126bd808bb12076cd7f66ac64c3e)
```
```

`renderdoc/rdc.md`:

```md
adb pull  /sdcard/Android/media/com.xxx.xx/files/RenderDoc

```

`renderdoc/rdc_callstack.md`:

```md
[28 tools called]

## Python Callstack Workflow

- RenderDoc only writes CPU callstack addresses when the capture options `captureCallstacks` (and optionally `captureCallstacksOnlyActions`) are set before the capture is made. These options correspond to the Python `renderdoc.CaptureOptions` members shown below, so be sure to enable them via the injected application or when launching through the Python API:

```114:134:api/replay/capture_options.h
  DOCUMENT(R"(Capture CPU callstacks for API events
...
  bool captureCallstacks;
  DOCUMENT(R"(When capturing CPU callstacks, only capture them from actions.
...
  bool captureCallstacksOnlyActions;
```

- After opening a capture file or connecting to a remote server, the shared `ICaptureAccess` interface exposes the methods you need: `HasCallstacks()` lets you check whether the capture actually contains stacks, `InitResolver()` loads the resolve database and symbols, and `GetResolve()` turns the raw addresses into human-readable frames once the resolver is ready. The relevant API surface is documented here:

```1295:1328:api/replay/renderdoc_replay.h
  virtual bool HasCallstacks() = 0;
  virtual ResultDetails InitResolver(bool interactive, RENDERDOC_ProgressCallback progress) = 0;
  virtual rdcarray<rdcstr> GetResolve(const rdcarray<uint64_t> &callstack) = 0;
```

- The per-event callstack data itself lives on each structured-data chunk’s metadata. Every `ActionDescription` contains a list of `APIEvent`s (each one points at a chunk index), and each chunk’s `metadata.callstack` is exactly the array you pass to `GetResolve()`:

```252:301:api/replay/structured_data.h
.. data:: HasCallstack
  This chunk has a callstack.
...
struct SDChunkMetaData
{
  uint32_t chunkID = 0;
  SDChunkFlags flags = SDChunkFlags::NoFlags;
  ...
  rdcarray<uint64_t> callstack;
};
```

- Putting that together in Python typically looks like this:

```python
import renderdoc as rd

cap = rd.OpenCaptureFile()
res = cap.OpenFile(r"c:\captures\demo.rdc", "", None)
if res != rd.ResultCode.Succeeded:
    raise RuntimeError(res.message)

if not cap.HasCallstacks():
    print("Capture has no callstacks")
else:
    cap.InitResolver(interactive=False, progress=None)

    replay_controller = cap.OpenCapture(rd.ReplayOptions(), None)[1]
    structured = replay_controller.GetStructuredFile()

    def resolve_action(action: rd.ActionDescription):
        for evt in action.events:
            if evt.chunkIndex == rd.APIEvent.NoChunk:
                continue
            frames = structured.chunks[evt.chunkIndex].metadata.callstack
            if frames:
                return cap.GetResolve(frames)
        return []

    first_draw = replay_controller.GetRootActions()[0]
    print(resolve_action(first_draw))
```

  - `structured.chunks[evt.chunkIndex].metadata.callstack` yields the raw addresses.
  - Pass that list to `cap.GetResolve(...)` (or to a remote server handle) **after** `InitResolver` succeeds.
  - If you only want action-level callstacks, iterate `ActionDescription` objects from `replay_controller.GetRootActions()` (and descend into `children` as needed).

- Verification tips: ensure symbols for your platform are accessible before calling `InitResolver(False, …)`; if you need interactive selection of PDBs/dSYMs, pass `interactive=True`. Always guard the resolve path with `HasCallstacks()` so you can bail out early on captures where the option wasn’t enabled.

```

`renderdoc/readme.md`:

```md
## windows 出包

https://zhuanlan.zhihu.com/p/339673291

https://www.msys2.org/wiki/MSYS2-reinstallation/

注意:
如果以前有使用vcpkg. 删除vcpkg环境变量 CMAKE_TOOLCHAIN_FILE D:\vcpkg

## Android原理解析

![20220222094301](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220222094301.png)

1. 权限

```xml
<uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE"/>
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
<uses-permission android:name="android.permission.INTERNET"/>
```
2. opengles3.0

```xml
<uses-feature android:glEsVersion="0x00030000" android:required="true"/>
```

3. Loader.java
```java
// 保持屏幕常亮
getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);

// 权限获取与跳转应用信息界面
Intent viewIntent = new Intent( "android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION"  /*android.provider.Settings.ACTION_MANAGE_ALL_FILES_ACCESS_PERMISSION*/);
startActivity(viewIntent);

// 加载renderdoccmd
System.loadLibrary("renderdoccmd"); // this will load VkLayer_GLES_RenderDoc as well
```

4. 关于VKLayer

https://developer.android.com/ndk/guides/graphics

```

`renderdoc/renderdoccmd.md`:

```md
renderdoccmd使用安卓启动后,第一个加载的so文件. 这里面是跨平台实现的.

## 需要阅读的源码有:

```shell
renderdoccmd.cpp
renderdoccmd.h
3rdparty/cmdline/cmdline.h

renderdoccmd_android.cpp
android_native_app_glue.c //这个再ndk目录下
```

## 使用CMake编译进行apk编译, 具体实现为在RenderDocCmd的CMakeLists.txt里面:

```shell
1. 使用java8以上
2. 检查是否需要剔除符号
3. 查找最新的buildTools
4. 查找最新的ANDROID_PLATFORM
5. 生成证书
6. APK_VERSION_CODE/APK_VERSION_NAME用的git的commit hash
7. 打包成APK, 其中重要的依赖renderdoc/renderdoccmd
8. 签名生成APK
```
## 使用了原生Android开发

https://developer.android.com/ndk/samples/sample_na

![20220222110201](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220222110201.png)


## 重点关注cmdthread

```shell
Core 17612 11:21:38 android_tools.cpp(321) Log COMMAND: D:/Android/sdk/platform-tools/adb '-s e06bd82c shell am start -n org.renderdoc.renderdoccmd.arm64/.Loader -e renderdoccmd remoteserver'

Core 17612 11:44:47 android_tools.cpp(321) Log COMMAND: D:/Android/sdk/platform-tools/adb '-s e06bd82c push "C:\Users\Administrator\AppData\Roaming\renderdoc\renderdoc.conf" /sdcard/Android/data/org.renderdoc.renderdoccmd.arm64/files/renderdoc.conf'
```

```c
void *cmdthread(void *)
{
  std::vector<std::string> args = getRenderdoccmdArgs();
  if(args.size())
  {    
    ANDROID_LOG("Entering cmd thread, args:");
    for(auto &e: args) {
      ANDROID_LOG("%s", e.c_str()); //renderdoccmd,remoteserver 
    }    
    m_CmdLock.lock();
    GlobalEnvironment env;
    renderdoccmd(env, args); //命令解析
    m_CmdLock.unlock();
    ANDROID_LOG("Exiting cmd thread");
  }

  // activity is done and should be closed
  ANativeActivity_finish(android_state->activity);

  return NULL;
}
```

### vulkanlayer命令

### RemoteServerCommand

Start up a server listening as a host for remote replays.

判断renderdoc在哪个平台以何种方式启动

```c++
//RenderDoc/core.cpp
RDCLOG("RenderDoc v%s %s %s %s (%s) %s", MAJOR_MINOR_VERSION_STRING, platform,
         sizeof(uintptr_t) == sizeof(uint64_t) ? "64-bit" : "32-bit",
         ENABLED(RDOC_RELEASE) ? "Release" : "Development", GitVersionHash,
         IsReplayApp() ? "loaded in replay application" : "capturing application");
```

默认情况以replay模式启动

```shell
RenderDoc v1.19 Android 64-bit Development (6bd8bcee606dc697c39c57ee3ecaded22eea9ccf) loaded in replay application
```

当你使用launchApplication方式启动时

```shell
RenderDoc v1.19 Android 64-bit Development (6bd8bcee606dc697c39c57ee3ecaded22eea9ccf) capturing application
```

针对Android10, 带有native GPU layering.

```c++
if(Android::SupportsNativeLayers(m_deviceID))
    {
      RDCLOG("Using Android 10 native GPU layering");

      // if we have Android 10 native layering, don't use JDWP hooking
      hookWithJDWP = false;
```

如何使用native debug layering的?

```c++
D:/Android/sdk/platform-tools/adb '-s e06bd82c shell settings put global enable_gpu_debug_layers 1'
D:/Android/sdk/platform-tools/adb '-s e06bd82c shell settings put global gpu_debug_app com.YourCompany.Demo'
D:/Android/sdk/platform-tools/adb '-s e06bd82c shell settings put global gpu_debug_layer_app org.renderdoc.renderdoccmd.arm64'
D:/Android/sdk/platform-tools/adb '-s e06bd82c shell settings put global gpu_debug_layers VK_LAYER_RENDERDOC_Capture'
D:/Android/sdk/platform-tools/adb '-s e06bd82c shell settings put global gpu_debug_layers_gles libVkLayer_GLES_RenderDoc.so'
```

https://community.arm.com/cn/b/blog/posts/gl_5f00_khr_5f00_debug-arm-mali-gpu-opengl-es

https://hub.vive.com/storage/docs/zh-cn/UnrealPlugin/RenderDoc/Unreal_RenderDoc.html


## 关于Android10 使用GLES图层问题

https://developer.android.google.cn/ndk/guides/rootless-debug-gles?hl=zh-cn

重点关注 AndroidGLESLayer_Initialize

eglCreateContext_renderdoc_hooked






```

`renderdoc/scripts/stats.py`:

```py
import renderdoc as rd
from collections import deque
import struct

statistic_range = [[]]

def get_all_actions(controller: rd.ReplayController) -> dict:
    ret = dict()
    root_actions = controller.GetRootActions()
    temp_buffer = deque()

    for r in root_actions:
        temp_buffer.append(r)
    while len(temp_buffer) != 0:
        temp_top = temp_buffer.popleft()
        for d in temp_top.children:
            temp_buffer.append(d)
        ret[temp_top.eventId] = temp_top
    return ret

def get_all_time_duration(controller: rd.ReplayController, all_actions: dict) -> dict:
    counters = controller.EnumerateCounters()
    if rd.GPUCounter.EventGPUDuration not in counters:
        raise RuntimeError("GPU dose not support read time duration")

    samplePassedVal = controller.FetchCounters([rd.GPUCounter.EventGPUDuration])

    time_cost_result = dict()
    for result in samplePassedVal:
        temp_act = all_actions[result.eventId]
        if not (temp_act.flags & rd.ActionFlags.Drawcall):
            continue
        val = result.value.u64
        double_value = struct.unpack('d', struct.pack('Q', val))[0] * 1000
        time_cost_result[result.eventId] = double_value

    return time_cost_result

def get_triangle_count(all_actions: dict, time_cost_dict: dict, event_range: list):
    triangle_count = 0
    draw_count = 0
    time_cost = 0
    for action_id in all_actions:
        if len(event_range) == 2 and (action_id < event_range[0] or action_id > event_range[1]):
            continue
        rd_action = all_actions[action_id]
        if not (rd_action.flags & rd.ActionFlags.Drawcall):
            continue
        triangle_count += int((rd_action.numIndices / 3) * rd_action.numInstances)
        draw_count += 1
        time_cost += time_cost_dict[action_id]
    return triangle_count, draw_count, time_cost


def list_simple_info(all_actions: dict, time_cost: dict, event_range: list):
    for action_id in all_actions:
        if len(event_range) == 2 and (action_id < event_range[0] or action_id > event_range[1]):
            continue
        rd_action = all_actions[action_id]
        event_id = action_id
        if not (rd_action.flags & rd.ActionFlags.Drawcall):
            continue
        triangle_count = int((rd_action.numIndices / 3) * rd_action.numInstances)
        print("{},{},{}".format(event_id, triangle_count, time_cost[event_id]))

def run_quest(controller: rd.ReplayController):
    all_action = get_all_actions(controller)
    time_cost = get_all_time_duration(controller, all_action)

    print("Range,Triangle,DrawCall,TimeCost")
    for range in statistic_range:
        result = get_triangle_count(all_action, time_cost, range)
        print("{},{},{},{}".format(range, result[0], result[1], result[2]))

if __name__ == '__main__':
    # pyrenderdoc.SetEventID([], 51, 51)
    pyrenderdoc.Replay().BlockInvoke(run_quest)
    # pyrenderdoc.Replay().BlockInvoke(run_get_draw_index)


```

`renderdoc/tmp.c`:

```c
since we're not pumping this continually and we only draw when we need to, we can just do the
full initialisation and teardown every time. This means we don't have to pay attention to
whether something else needs to create a context on the window - we just do it
opportunistically when we can hold the draw lock.
This only takes about 30ms anyway, so it's still technically realtime, right!?

fetch everything dynamically. We can't link against libEGL otherwise it messes with the hooking
  in the main library. Just declare local function pointers with the real names
```

`rust/01expr.md`:

```md

## 左值/右值

![](2022-05-22-21-58-17.png)

![](2022-05-22-21-59-45.png)

栈内存, 堆内存, 静态存储区

## 位置表达式和值表达式的分类

![](2022-05-22-22-01-11.png)

![](2022-05-22-22-02-44.png)

![](2022-05-22-22-03-13.png)

```

`rust/02datatype.md`:

```md
# 类型系统和类型安全

类型和行为

![](2022-05-22-22-17-09.png)

![](2022-05-22-22-17-59.png)

![](2022-05-22-22-19-24.png)

![](2022-05-22-22-22-32.png)

![](2022-05-22-22-23-07.png)

![](2022-05-22-22-23-41.png)

![](2022-05-22-22-24-38.png)

![](2022-05-22-22-25-03.png)

![](2022-05-22-22-25-32.png)

![](2022-05-22-22-28-45.png)

![](2022-05-22-22-29-38.png)

# 泛型

![](2022-05-22-22-32-26.png)

# 特定类型

![](2022-05-22-22-33-57.png)

```

`sofixer/01elfheader.md/readme.md`:

```md
# ELF修复基本工作原理

![20220107175810](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220107175810.png)

本文参考[https://github.com/F8LEFT/SoFixer](https://github.com/F8LEFT/SoFixer)相关代码进行了代码的review, 尝试梳理内部流程, 也算是自己对于linker的一个阶段性总结

## 分析

# tmp.so 和原始文件比较
![20220107174615](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220107174615.png)

![20211231165901](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211231165901.png)

![20211231165939](https://cdn.jsdelivr.net/gh/nzcv/picgo/20211231165939.png)

#帮助文档

http://pareto.fun/?p=292

# elf剔除

[android-elf-cleaner](https://github.com/kost/android-elf-cleaner)

# elf修复

1. 由于从内存中dump，将文件偏移和大小 覆写为 内存大小和偏移。

2. 从program header 中获取找到PT_DYNAMIC 。将dynamic 作为构建section header 的关键信息。

3. PT_DYNAMIC包含了部分节信息, 还原这部分内容

4. 


[frida_dump](https://github.com/lasting-yang/frida_dump)
```

`vcpkg/readme.md`:

```md
CMAKE_TOOLCHAIN_FILE D:\vcpkg

![20220221173151](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220221173151.png)

![20220221173207](https://cdn.jsdelivr.net/gh/nzcv/picgo/20220221173207.png)
```

`vulkan/memory.md`:

```md
查找选择 128KB 作为移动平台分配块大小的依据：


[3 tools called]


查找更多关于内存分配大小选择的上下文信息：


[3 tools called]


基于代码分析，选择 128KB 的依据如下：

## 选择 128KB 的依据分析

### 1. 内存总量限制
从代码注释（第 3653 行）：
```cpp
// 512MB (may get doubled in case we share the allocator for buffers and images, see below)
```
- 移动平台总池：512MB = 4096 块 × 128KB
- 桌面平台总池：2GB = 1024 块 × 2MB
- 移动平台内存更受限，需要更小的块以降低浪费

### 2. 2 的幂次对齐
- 128KB = 2^17 字节，符合 Buddy 分配器的对齐要求
- 便于高效分割与合并

### 3. 块数量与粒度平衡
- 移动：4096 块 × 128KB = 512MB
- 桌面：1024 块 × 2MB = 2GB
- 移动平台使用更多更小的块，可更精细地管理内存

### 4. 移动平台特性
- GPU 内存通常更小（常见 1–4GB）
- 需要更小的分配粒度以减少碎片
- 128KB 是常见内存页/对齐大小的倍数（如 4KB、64KB）

### 5. 可配置性
代码第 3656-3659 行允许通过配置覆盖：
```cpp
if (s_VulkanSuballocatorThreshold > 0)
    maxAllocSizeBytes = NextPowerOfTwo(s_VulkanSuballocatorThreshold);
if (s_VulkanSuballocatorBlocks > 0)
    numMaxAllocSizeBlocks = s_VulkanSuballocatorBlocks;
```

### 总结
选择 128KB 是综合考虑移动平台内存限制、Buddy 分配器对齐需求、碎片控制与总池大小（512MB）后的折中。代码中未明确说明具体依据，但上述因素共同支撑该选择。

查看超出 `numMaxAllocSizeBlocks` 后的处理逻辑：


[3 tools called]


查看 BuddyAllocator 元数据分配失败时的处理逻辑：


[3 tools called]


## 超出 `numMaxAllocSizeBlocks` 后的处理流程

### 1. Buddy 分配器分配失败

在 `MemoryTypeAllocator::Alloc()` (第 1121-1125 行)：

```cpp
allocutil::Chunk chunk = m_AllocationMetaData.Alloc(size);
if (chunk == allocutil::kInvalidChunk)
    return kInvalidMemory;  // 分配失败，返回无效内存
```

当 Buddy 分配器无法分配时（例如所有块已用完或没有足够连续空间），`m_AllocationMetaData.Alloc(size)` 返回 `kInvalidChunk`，函数返回 `kInvalidMemory`。

### 2. 回退到默认分配器

在 `BuddyMemoryAllocator::AllocateImpl()` (第 1262-1266 行)：

```cpp
Memory mem = memTypeAlloc->Alloc(device, physicalDeviceProperties, size, memoryTypeIndex);
if (mem != kInvalidMemory)
    return mem;

// 如果 Buddy 分配器失败，回退到默认分配器
return GetDefaultAllocator().Allocate(device, physicalDeviceProperties, size, memoryTypeIndex, alignment, memoryAllocationFlags, priority);
```

如果 Buddy 分配器返回 `kInvalidMemory`，会回退到 `GetDefaultAllocator().Allocate()`，直接调用 Vulkan 的 `vkAllocateMemory`。

### 3. 默认分配器的行为

`DefaultMemoryAllocator::AllocateImpl()` (第 835-892 行) 会：
- 直接调用 `vkAllocateMemory` 分配所需大小的内存
- 不受 `numMaxAllocSizeBlocks` 限制
- 每次分配都是独立的 Vulkan 内存对象

### 4. 关键点

- `numMaxAllocSizeBlocks` 限制的是 Buddy 分配器管理的块数量，不是总分配上限
- 超出后不会崩溃，而是回退到直接分配
- 回退后每次分配都是独立的 `vkAllocateMemory` 调用，可能增加分配次数和碎片

### 5. 实际影响

- 性能：回退后失去 Buddy 分配器的合并优势，可能产生更多碎片
- 内存：回退分配不受 Buddy 池限制，可能占用更多内存
- 分配次数：回退后每次分配都是独立的 Vulkan 调用，可能增加开销

### 总结

超出 `numMaxAllocSizeBlocks` 后，系统会回退到默认分配器，直接调用 `vkAllocateMemory`。这是设计上的回退机制，确保在 Buddy 分配器资源耗尽时仍能继续分配，但可能带来性能和碎片方面的代价。

```